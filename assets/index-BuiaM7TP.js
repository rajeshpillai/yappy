const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./morph-animator-BpfWiBsW.js","./vendor-rendering-BE0CBX_5.js","./solid-framework-CtC0wtKI.js","./vendor-export-B6WwIQ1_.js","./help-dialog-B-vnWkTg.js","./help-dialog-BuEFoCdI.css","./load-export-dialog-J1pFiQLr.js","./load-export-dialog-BI080PEg.css","./file-open-dialog-PHTS1dYJ.js","./file-open-dialog-fDkqaZuJ.css","./export-dialog-M-8V96yN.js","./export-dialog-B7S2OIzO.css","./save-dialog-CAbBXWVK.js","./save-dialog-DKlfwlwa.css","./template-browser-D9UEXFFK.js","./template-browser-wA56mJ0X.css","./property-panel-DuLghQ5v.js","./property-panel-CW7Mq4oS.css","./layer-panel-DVP54OLJ.js","./layer-panel-DzFDmrZc.css","./command-palette-C89pcrZQ.js","./command-palette-CVDazVxS.css","./state-panel-Bd_Kjd8P.js","./state-panel-Clr9NUEJ.css","./mindmap-action-toolbar-b_LcN_SE.js","./mindmap-action-toolbar-CAFnKVn8.css","./slide-navigator-CS4Qm1E2.js","./slide-navigator-DzoiUQ2M.css","./slide-control-toolbar-iF66UYSP.js","./presentation-controls-BTpdyBJg.js"])))=>i.map(i=>d[i]);
import{d as Kt,t as it,i as F,c as Ie,a as Pl,b as $l,x as qo,e as Ht,s as xt,m as On,f as Ft,u as Ot,g as Mo,h as we,j as Fi,k as Be,P as ze,p as Cl,l as Tl,n as We,o as jo,q as Vs,r as Il,v as Qo,w as Ll,y as El,z as Al,A as Rl,B as Vo,C as Dl,D as Js,E as Ks,F as Ol,G as _l,H as Bl,I as zl,J as Zs,K as Wl,L as Xl,M as Yl,N as Hl,O as Nl,Q as tr,R as Fl,S as Ul,T as Gl,U as er,V as ql,W as jl,X as Ql,Y as Vl,Z as Jl,_ as Kl,$ as Zl,a0 as tc,a1 as ec,a2 as nc,a3 as ic,a4 as Jo,a5 as nr,a6 as Ko,a7 as oc,a8 as gn,a9 as sc,aa as rc,ab as ac,ac as lc,ad as cc,ae as dc,af as hc,ag as uc,ah as fc,ai as pc,aj as yc,ak as gc,al as mc,am as xc,an as wc,ao as bc,ap as vc,aq as co,ar as Sc,as as kc,at as Mc,au as Pc,av as $c,aw as Cs,ax as Cc,ay as Tc,az as Ic,aA as Lc,aB as Ec,aC as Ac,aD as Rc,aE as Dc,aF as Oc,aG as _c}from"./vendor-rendering-BE0CBX_5.js";import{_ as le,E as Ts,P as Bc}from"./vendor-export-B6WwIQ1_.js";import{$ as sn,i as je,j as Is,k as Po,e as wt,h as E,S as vt,a as gt,l as rn,F as tn,o as te,d as Ut,u as oi,n as de,p as ir}from"./solid-framework-CtC0wtKI.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const $o=Symbol("store-raw"),vn=Symbol("store-node"),De=Symbol("store-has"),or=Symbol("store-self");function sr(n){let t=n[sn];if(!t&&(Object.defineProperty(n,sn,{value:t=new Proxy(n,Xc)}),!Array.isArray(n))){const e=Object.keys(n),s=Object.getOwnPropertyDescriptors(n);for(let i=0,o=e.length;i<o;i++){const r=e[i];s[r].get&&Object.defineProperty(n,r,{enumerable:s[r].enumerable,get:s[r].get.bind(t)})}}return t}function Li(n){let t;return n!=null&&typeof n=="object"&&(n[sn]||!(t=Object.getPrototypeOf(n))||t===Object.prototype||Array.isArray(n))}function _n(n,t=new Set){let e,s,i,o;if(e=n!=null&&n[$o])return e;if(!Li(n)||t.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):t.add(n);for(let r=0,a=n.length;r<a;r++)i=n[r],(s=_n(i,t))!==i&&(n[r]=s)}else{Object.isFrozen(n)?n=Object.assign({},n):t.add(n);const r=Object.keys(n),a=Object.getOwnPropertyDescriptors(n);for(let l=0,c=r.length;l<c;l++)o=r[l],!a[o].get&&(i=n[o],(s=_n(i,t))!==i&&(n[o]=s))}return n}function Ei(n,t){let e=n[t];return e||Object.defineProperty(n,t,{value:e=Object.create(null)}),e}function Bn(n,t,e){if(n[t])return n[t];const[s,i]=wt(e,{equals:!1,internal:!0});return s.$=i,n[t]=s}function zc(n,t){const e=Reflect.getOwnPropertyDescriptor(n,t);return!e||e.get||!e.configurable||t===sn||t===vn||(delete e.value,delete e.writable,e.get=()=>n[sn][t]),e}function rr(n){Po()&&Bn(Ei(n,vn),or)()}function Wc(n){return rr(n),Reflect.ownKeys(n)}const Xc={get(n,t,e){if(t===$o)return n;if(t===sn)return e;if(t===Is)return rr(n),e;const s=Ei(n,vn),i=s[t];let o=i?i():n[t];if(t===vn||t===De||t==="__proto__")return o;if(!i){const r=Object.getOwnPropertyDescriptor(n,t);Po()&&(typeof o!="function"||n.hasOwnProperty(t))&&!(r&&r.get)&&(o=Bn(s,t,o)())}return Li(o)?sr(o):o},has(n,t){return t===$o||t===sn||t===Is||t===vn||t===De||t==="__proto__"?!0:(Po()&&Bn(Ei(n,De),t)(),t in n)},set(){return!0},deleteProperty(){return!0},ownKeys:Wc,getOwnPropertyDescriptor:zc};function Ai(n,t,e,s=!1){if(!s&&n[t]===e)return;const i=n[t],o=n.length;e===void 0?(delete n[t],n[De]&&n[De][t]&&i!==void 0&&n[De][t].$()):(n[t]=e,n[De]&&n[De][t]&&i===void 0&&n[De][t].$());let r=Ei(n,vn),a;if((a=Bn(r,t,i))&&a.$(()=>e),Array.isArray(n)&&n.length!==o){for(let l=n.length;l<o;l++)(a=r[l])&&a.$();(a=Bn(r,"length",o))&&a.$(n.length)}(a=r[or])&&a.$()}function ar(n,t){const e=Object.keys(t);for(let s=0;s<e.length;s+=1){const i=e[s];Ai(n,i,t[i])}}function Yc(n,t){if(typeof t=="function"&&(t=t(n)),t=_n(t),Array.isArray(t)){if(n===t)return;let e=0,s=t.length;for(;e<s;e++){const i=t[e];n[e]!==i&&Ai(n,e,i)}Ai(n,"length",s)}else ar(n,t)}function An(n,t,e=[]){let s,i=n;if(t.length>1){s=t.shift();const r=typeof s,a=Array.isArray(n);if(Array.isArray(s)){for(let l=0;l<s.length;l++)An(n,[s[l]].concat(t),e);return}else if(a&&r==="function"){for(let l=0;l<n.length;l++)s(n[l],l)&&An(n,[l].concat(t),e);return}else if(a&&r==="object"){const{from:l=0,to:c=n.length-1,by:d=1}=s;for(let h=l;h<=c;h+=d)An(n,[h].concat(t),e);return}else if(t.length>1){An(n[s],t,[s].concat(e));return}i=n[s],e=[s].concat(e)}let o=t[0];typeof o=="function"&&(o=o(i,e),o===i)||s===void 0&&o==null||(o=_n(o),s===void 0||Li(i)&&Li(o)&&!Array.isArray(o)?ar(i,o):Ai(n,s,o))}function Hc(...[n,t]){const e=_n(n||{}),s=Array.isArray(e),i=sr(e);function o(...r){je(()=>{s&&r.length===1?Yc(e,r[0]):An(e,r)})}return[i,o]}const zn={type:"none",duration:500,easing:"easeInOutQuad"},Zo=(n,t,e=0,s=0)=>({id:crypto.randomUUID(),name:t||"Slide 1",spatialPosition:{x:e,y:s},dimensions:{width:1920,height:1080},backgroundColor:"#ffffff",order:0,transition:{...zn}}),lr=(n,t="slides")=>({version:4,metadata:{name:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),docType:t},elements:[],layers:[{id:"default-layer",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent"}],slides:[Zo()],globalSettings:{},gridSettings:{enabled:!1,snapToGrid:!1,objectSnapping:!0,gridSize:20,gridColor:"#cccccc",gridOpacity:.5,style:"lines"}});var Nc=it("<div><div class=toast-icon></div><div class=toast-message></div><button class=toast-close>");const[fn,Co]=wt({message:"",type:"info",visible:!1});let Dn;const Wt=(n,t="info",e=3e3)=>{Co({message:n,type:t,visible:!0}),Dn&&clearTimeout(Dn),Dn=window.setTimeout(()=>{Co(s=>({...s,visible:!1}))},e)},cr=()=>{Co(n=>({...n,visible:!1})),Dn&&clearTimeout(Dn)},Fc=()=>E(vt,{get when(){return fn().visible},get children(){var n=Nc(),t=n.firstChild,e=t.nextSibling,s=e.nextSibling;return F(t,E(vt,{get when(){return fn().type==="success"},get children(){return E(Ie,{size:18})}}),null),F(t,E(vt,{get when(){return fn().type==="error"},get children(){return E(Pl,{size:18})}}),null),F(t,E(vt,{get when(){return fn().type==="info"},get children(){return E($l,{size:18})}}),null),F(e,()=>fn().message),s.$$click=cr,F(s,E(qo,{size:14})),gt(()=>Ht(n,`toast toast-${fn().type}`)),n}});Kt(["click"]);const Uc=Object.freeze(Object.defineProperty({__proto__:null,default:Fc,hideToast:cr,showToast:Wt},Symbol.toStringTag,{value:"Module"})),Ls=["#e03131","#1971c2","#2f9e44","#f08c00","#9c36b5","#0b7285","#748ffc","#f76707","#099268"];class dr{hSpacing=100;vSpacing=40;buildTree(t,e){const s=e.find(r=>r.id===t);if(!s)return null;const i={id:s.id,element:s,children:[],width:s.width,height:s.height,x:s.x,y:s.y},o=e.filter(r=>r.parentId===t);for(const r of o){const a=this.buildTree(r.id,e);a&&i.children.push(a)}return i}layoutHorizontal(t,e="right"){this.calculateSubtreeHeights(t),this.assignHorizontalPositions(t,t.x,t.y,e)}layoutVertical(t,e="down"){this.calculateSubtreeWidths(t),this.assignVerticalPositions(t,t.x,t.y,e)}calculateSubtreeHeights(t){if(t.children.length===0)return t.totalHeight=t.height,t.totalHeight;const e=t.children.reduce((i,o)=>i+this.calculateSubtreeHeights(o),0),s=(t.children.length-1)*this.vSpacing;return t.totalHeight=Math.max(t.height,e+s),t.totalHeight}assignHorizontalPositions(t,e,s,i){if(t.x=e,t.y=s,t.children.length===0)return;const o=i==="right"?e+t.width+this.hSpacing:e-this.hSpacing;let r=s-t.totalHeight/2+t.children[0].totalHeight/2;const a=t.children.reduce((l,c)=>l+c.totalHeight,0)+(t.children.length-1)*this.vSpacing;r=s+t.height/2-a/2;for(const l of t.children){const c=i==="right"?o:o-l.width,d=r+l.totalHeight/2-l.height/2;this.assignHorizontalPositions(l,c,d,i),r+=l.totalHeight+this.vSpacing}}calculateSubtreeWidths(t){if(t.children.length===0)return t.totalWidth=t.width,t.totalWidth;const e=t.children.reduce((i,o)=>i+this.calculateSubtreeWidths(o),0),s=(t.children.length-1)*this.hSpacing;return t.totalWidth=Math.max(t.width,e+s),t.totalWidth}assignVerticalPositions(t,e,s,i){if(t.x=e,t.y=s,t.children.length===0)return;const o=i==="down"?s+t.height+this.vSpacing:s-this.vSpacing,r=t.children.reduce((l,c)=>l+c.totalWidth,0)+(t.children.length-1)*this.hSpacing;let a=e+t.width/2-r/2;for(const l of t.children){const c=i==="down"?o:o-l.height,d=a+l.totalWidth/2-l.width/2;this.assignVerticalPositions(l,d,c,i),a+=l.totalWidth+this.hSpacing}}layoutRadial(t){this.assignRadialPositions(t,t.x,t.y,0,Math.PI*2,250)}assignRadialPositions(t,e,s,i,o,r){if(t.x=e,t.y=s,t.children.length===0)return;const a=e+t.width/2,l=s+t.height/2,d=(o-i)/t.children.length;for(let h=0;h<t.children.length;h++){const p=t.children[h],y=i+(h+.5)*d,m=a+Math.cos(y)*(r+t.width/2),g=l+Math.sin(y)*(r+t.height/2),w=m-p.width/2,x=g-p.height/2,b=Math.min(Math.PI/2,d*.9);this.assignRadialPositions(p,w,x,y-b/2,y+b/2,r*.8)}}applySemanticStyling(t,e){t.styleUpdates={},t.children.forEach((s,i)=>{const o=Ls[i%Ls.length];this.styleSubtree(s,o,1,e)})}styleSubtree(t,e,s,i){const o=Math.max(1,4-s*.5),r=Math.max(40,100-s*10);t.styleUpdates={strokeColor:e,strokeWidth:o,opacity:r},i.find(a=>(a.type==="arrow"||a.type==="line"||a.type==="bezier")&&a.endBinding?.elementId===t.id);for(const a of t.children)this.styleSubtree(a,e,s+1,i)}getUpdates(t,e,s=new Map){const i={x:t.x,y:t.y,...t.styleUpdates};s.set(t.id,i);const o=e.find(r=>(r.type==="arrow"||r.type==="line"||r.type==="bezier")&&r.endBinding?.elementId===t.id);o&&t.styleUpdates&&s.set(o.id,{strokeColor:t.styleUpdates.strokeColor,strokeWidth:t.styleUpdates.strokeWidth,opacity:t.styleUpdates.opacity});for(const r of t.children)this.getUpdates(r,e,s);return s}}function hr(n=170,t=26,e=1,s=0){return i=>{if(i===0||i===1)return i;const r=i*1,a=Math.max(e,.01),l=Math.max(n,.01),c=Math.sqrt(l/a),d=t/(2*Math.sqrt(l*a)),h=-1,p=s;let y;const m=.001;if(d<1-m){const g=c*Math.sqrt(1-d*d),w=Math.exp(-d*c*r),x=h,b=(p+d*c*h)/g;y=1+w*(x*Math.cos(g*r)+b*Math.sin(g*r))}else if(d>1+m){const g=-c*(d+Math.sqrt(d*d-1)),w=-c*(d-Math.sqrt(d*d-1)),x=(p-w*h)/(g-w),b=h-x;y=1+x*Math.exp(g*r)+b*Math.exp(w*r)}else y=1+Math.exp(-c*r)*(h+(p+c*h)*r);return y}}const nn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,10*(2*n-1))/2:(2-Math.pow(2,-10*(2*n-1)))/2,easeOutBounce:n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,easeInBounce:n=>1-nn.easeOutBounce(1-n),easeInOutBounce:n=>n<.5?(1-nn.easeOutBounce(1-2*n))/2:(1+nn.easeOutBounce(2*n-1))/2,easeOutElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*t)+1},easeInElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*t)},easeOutBack:n=>1+2.70158*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),easeInBack:n=>2.70158*n*n*n-1.70158*n*n,easeSpring:hr(170,26,1,0)};function To(n){return n?typeof n=="function"?n:nn[n]??nn.linear:nn.linear}function ge(n,t,e){return isNaN(n)?t:isNaN(t)?n:n+(t-n)*e}function Gc(n,t,e){if(!n)return t||"#000000";if(!t)return n;const s=y=>{const m=y.replace("#","");return m.length<6?[0,0,0]:[parseInt(m.substring(0,2),16)||0,parseInt(m.substring(2,4),16)||0,parseInt(m.substring(4,6),16)||0]},[i,o,r]=s(n),[a,l,c]=s(t),d=Math.round(ge(i,a,e)),h=Math.round(ge(o,l,e)),p=Math.round(ge(r,c,e));return`#${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${p.toString(16).padStart(2,"0")}`}const[qc,jc]=wt(0),[Es,Qc]=wt(0),[Sy,As]=wt(!1),[pn,Vc]=wt(!1),[Re,Jc]=wt(!1);class Kc{animations=new Map;rafId=null;isRunning=!1;forceTicker=!1;lastTickTime=0;setForceTicker(t){this.forceTicker=t,t&&this.ensureLoopRunning()}create(t,e,s){const i={id:t,state:"idle",startTime:0,pauseTime:null,duration:s.duration??0,delay:s.delay??0,easing:To(s.easing),onUpdate:e,onComplete:s.onComplete,onStart:s.onStart,loop:s.loop??!1,loopCount:s.loopCount??1/0,currentLoop:0,alternate:s.alternate??!1,direction:1};return this.animations.set(t,i),t}start(t){const e=this.animations.get(t);if(e){if(e.state==="paused"&&e.pauseTime!==null){const s=e.pauseTime-e.startTime;e.startTime=performance.now()-s,e.pauseTime=null}else e.startTime=performance.now(),e.currentLoop=0,e.direction=1;e.state="running",e.onStart?.(),this.ensureLoopRunning()}}pause(t){const e=this.animations.get(t);!e||e.state!=="running"||(e.state="paused",e.pauseTime=performance.now())}stop(t){const e=this.animations.get(t);e&&(e.state="completed",this.animations.delete(t),this.animations.size===0&&!this.forceTicker&&this.stopLoop())}reset(t){const e=this.animations.get(t);e&&(e.state="idle",e.startTime=0,e.pauseTime=null,e.currentLoop=0,e.direction=1,e.onUpdate(0))}getState(t){return this.animations.get(t)?.state??null}has(t){return this.animations.has(t)}stopAll(){this.animations.clear(),this.stopLoop()}pauseAll(){for(const t of this.animations.values())t.state==="running"&&(t.state="paused",t.pauseTime=performance.now())}resumeAll(){const t=performance.now();for(const e of this.animations.values())if(e.state==="paused"&&e.pauseTime!==null){const s=e.pauseTime-e.startTime;e.startTime=t-s,e.pauseTime=null,e.state="running"}this.ensureLoopRunning()}tick=t=>{if(!this.isRunning){this.lastTickTime=0;return}this.lastTickTime===0&&(this.lastTickTime=t);const e=t-this.lastTickTime;this.lastTickTime=t;const s=f.globalSettings?.animationEnabled??!0;let i=!1;je(()=>{jc(t),Re()||Qc(r=>r+e);for(const r of this.animations.values()){if(r.state!=="running")continue;if(i=!0,!s){r.onUpdate(1),r.state="completed",r.onComplete?.(),this.animations.delete(r.id);continue}const a=t-r.startTime-r.delay;if(a<0)continue;let l=Math.min(a/r.duration,1);r.direction===-1&&(l=1-l);const c=r.easing(l);r.onUpdate(c),a>=r.duration&&(r.loop&&r.currentLoop<r.loopCount-1?(r.currentLoop++,r.startTime=t,r.alternate&&(r.direction=r.direction===1?-1:1)):(r.state="completed",r.onComplete?.(),this.animations.delete(r.id)))}});let o=!1;if(!i){for(const r of this.animations.values())if(r.state==="paused"){o=!0;break}}Vc(i),Jc(o),i||this.animations.size>0||this.forceTicker?this.rafId=requestAnimationFrame(this.tick):this.stopLoop()};ensureLoopRunning(){this.isRunning||(this.isRunning=!0,As(!0),this.rafId=requestAnimationFrame(this.tick))}stopLoop(){this.isRunning=!1,As(!1),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}const Bt=new Kc;let Zc=0;function Ri(n="anim"){return`${n}-${Date.now()}-${++Zc}`}function ho(n){const{width:t,height:e}=n.dimensions,{x:s,y:i}=n.spatialPosition,o=40,r=window.innerWidth-o*2,a=window.innerHeight-o*2,l=r/t,c=a/e,d=Math.min(l,c),h=(window.innerWidth-t*d)/2-s*d,p=(window.innerHeight-e*d)/2-i*d;return{scale:d,panX:h,panY:p}}class td{activeAnimationId=null;isTransitioning=!1;fadeOverlay=null;get transitioning(){return this.isTransitioning}async transitionTo(t,e){if(t<0||t>=f.slides.length||t===f.activeSlideIndex&&!this.isTransitioning)return;this.cancelActiveTransition();const s=f.activeSlideIndex,i=f.slides[s],o=f.slides[t],r=o.transition||zn,a=t>s?"forward":"backward",l={fromSlide:i,toSlide:o,fromIndex:s,toIndex:t,direction:a};if(e?.skipAnimation||r.type==="none"||f.globalSettings?.animationEnabled===!1||f.globalSettings?.reducedMotion===!0){this.applyImmediateSwitch(t);return}this.isTransitioning=!0;try{await this.executeTransition(l,r)}finally{this.isTransitioning=!1,this.activeAnimationId=null}}applyImmediateSwitch(t){$("activeSlideIndex",t);const e=f.slides[t];if(e){const s=ho(e);Zt(s)}}cancelActiveTransition(){this.activeAnimationId&&(Bt.stop(this.activeAnimationId),this.activeAnimationId=null),this.removeFadeOverlay(),this.isTransitioning=!1}async executeTransition(t,e){switch(e.type){case"fade":return this.executeFade(t,e);case"slide-left":case"slide-right":case"slide-up":case"slide-down":return this.executeSlide(t,e);case"zoom-in":case"zoom-out":return this.executeZoom(t,e);default:this.applyImmediateSwitch(t.toIndex)}}executeFade(t,e){return new Promise(s=>{const i=e.duration/2,o=t.toSlide.backgroundColor||"#ffffff";this.fadeOverlay=document.createElement("div"),this.fadeOverlay.style.cssText=`
                position: fixed;
                inset: 0;
                z-index: 99999;
                background: ${o};
                opacity: 0;
                pointer-events: none;
                transition: opacity ${i}ms ease-in-out;
            `,document.body.appendChild(this.fadeOverlay),requestAnimationFrame(()=>{this.fadeOverlay&&(this.fadeOverlay.style.opacity="1")}),setTimeout(()=>{this.applyImmediateSwitch(t.toIndex),this.fadeOverlay&&(this.fadeOverlay.style.opacity="0"),setTimeout(()=>{this.removeFadeOverlay(),s()},i)},i)})}executeSlide(t,e){return new Promise(s=>{const i={...f.viewState},o=ho(t.toSlide);let r=0,a=0;const l=200;switch(e.type){case"slide-left":r=t.direction==="forward"?-l:l;break;case"slide-right":r=t.direction==="forward"?l:-l;break;case"slide-up":a=t.direction==="forward"?-l:l;break;case"slide-down":a=t.direction==="forward"?l:-l;break}$("activeSlideIndex",t.toIndex);const c=Ri("slide-transition");this.activeAnimationId=c;const d=To(e.easing);Bt.create(c,h=>{const p=d(h),y=ge(i.panX+r,o.panX,p),m=ge(i.panY+a,o.panY,p),g=ge(i.scale,o.scale,p);Zt({panX:y,panY:m,scale:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,Zt(o),s()}}),Bt.start(c)})}executeZoom(t,e){return new Promise(s=>{const i={...f.viewState},o=ho(t.toSlide),r=e.type==="zoom-in";$("activeSlideIndex",t.toIndex);const a=Ri("zoom-transition");this.activeAnimationId=a;const l=To(e.easing),c=r?.3:1.5,d=o.scale*c;Bt.create(a,h=>{const p=l(h);let y,m,g;if(h<.5){const w=p*2;y=ge(i.scale,d,w),m=ge(i.panX,(i.panX+o.panX)/2,w),g=ge(i.panY,(i.panY+o.panY)/2,w)}else{const w=(p-.5)*2;y=ge(d,o.scale,w),m=ge((i.panX+o.panX)/2,o.panX,w),g=ge((i.panY+o.panY)/2,o.panY,w)}Zt({scale:y,panX:m,panY:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,Zt(o),s()}}),Bt.start(a)})}removeFadeOverlay(){this.fadeOverlay&&this.fadeOverlay.parentNode&&(this.fadeOverlay.parentNode.removeChild(this.fadeOverlay),this.fadeOverlay=null)}async previewTransition(t){if(!(t<0||t>=f.slides.length))if(t===0){const e=f.slides[0],s=e.transition||zn;await this.executeTransition({fromSlide:e,toSlide:e,fromIndex:-1,toIndex:0,direction:"forward"},s)}else await this.transitionTo(t-1,{skipAnimation:!0}),await new Promise(e=>setTimeout(e,300)),await this.transitionTo(t)}}const uo=new td,me=new Map;function Ui(n){const t=me.get(n);t&&(t.forEach(e=>Bt.stop(e)),me.delete(n))}function ed(n){const t=me.get(n);return t?t.size>0:!1}function nd(n,t){return n[t]}function Z(n,t,e){const s=f.elements.find(c=>c.id===n);if(!s)return console.warn(`animateElement: Element ${n} not found`),"";const i=Ri("el");Ui(n),me.has(n)||me.set(n,new Set),me.get(n).add(i);const o={},r=[],a=[],l={};for(const c of Object.keys(t)){const d=nd(s,c);d!==void 0?(o[c]=d,typeof d=="number"?r.push(c):typeof d=="string"&&a.push(c)):l[c]=t[c]}return Object.keys(l).length>0&&nt(n,l,!1),Bt.create(i,c=>{const d={},h={};for(const p of r){const y=o[p],m=t[p],g=ge(y,m,c);d[p]=g,h[p]=g}for(const p of a){const y=o[p],m=t[p];if(y&&m&&y.startsWith("#")&&m.startsWith("#")){const g=Gc(y,m,c);d[p]=g,h[p]=g}}nt(n,d,!1),e.onUpdate?.(h)},{duration:e.duration,easing:e.easing,delay:e.delay,onStart:e.onStart,onComplete:()=>{const c=me.get(n);c&&(c.delete(i),c.size===0&&me.delete(n)),e.onComplete?.()},loop:e.loop,loopCount:e.loopCount,alternate:e.alternate}),Bt.start(i),i}function ur(n,t,e,s=0){return n.map((i,o)=>Z(i,t,{...e,delay:(e.delay??0)+s*o}))}function fr(n){Bt.stop(n)}function pr(n){Bt.pause(n)}function yr(n){Bt.start(n)}function gr(n,t=300,e={}){return nt(n,{opacity:0},!1),Z(n,{opacity:100},{duration:t,easing:"easeOutQuad",...e})}function mr(n,t=300,e={}){return Z(n,{opacity:0},{duration:t,easing:"easeOutQuad",...e})}function ts(n,t=300,e={}){const s=f.elements.find(h=>h.id===n);if(!s)return"";const i=s.x,o=s.y,r=s.width,a=s.height,l=100,c=i+r/2,d=o+a/2;return nt(n,{width:0,height:0,x:c,y:d,opacity:0},!1),Z(n,{width:r,height:a,x:i,y:o,opacity:l},{duration:t,easing:"easeOutBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function Gi(n,t=450,e={}){const s=f.elements.find(r=>r.id===n);if(!s)return"";const i=e.intensity??20,o=s.y;return Z(n,{y:o-i},{duration:t*.33,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{y:o},{duration:t*.67,easing:"easeOutBounce",onComplete:e.onComplete})}})}function qi(n,t=300,e={}){const s=f.elements.find(y=>y.id===n);if(!s)return"";const i=e.scale??1.1,o=s.width,r=s.height,a=s.x,l=s.y,c=o*i,d=r*i,h=(c-o)/2,p=(d-r)/2;return Z(n,{width:c,height:d,x:a-h,y:l-p},{duration:t/2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{width:o,height:r,x:a,y:l},{duration:t/2,easing:"easeOutQuad",onComplete:e.onComplete})}})}function es(n,t=1e3,e={}){return Z(n,{opacity:0},{duration:t/4,easing:"linear",loop:!0,loopCount:2,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:e.onComplete})}function ns(n,t=1e3,e={}){const s=f.elements.find(l=>l.id===n);if(!s)return"";const i=s.width,o=s.height,r=s.x,a=s.y;return Z(n,{width:i*1.25,height:o*.75,x:r-i*.25/2,y:a+o*.25/2},{duration:t*.3,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{width:i*.75,height:o*1.25,x:r+i*.25/2,y:a-o*.25/2},{duration:t*.3,easing:"easeInOutQuad",onComplete:()=>{Z(n,{width:i,height:o,x:r,y:a},{duration:t*.4,easing:"easeOutElastic",onComplete:e.onComplete})}})}})}function ji(n,t=400,e={}){const s=f.elements.find(r=>r.id===n);if(!s)return"";const i=e.intensity??10,o=s.x;return Z(n,{x:o+i},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{nt(n,{x:o},!1),e.onComplete?.()}})}function is(n,t=400,e={}){const s=f.elements.find(r=>r.id===n);if(!s)return"";const i=e.intensity??10,o=s.y;return Z(n,{y:o+i},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{nt(n,{y:o},!1),e.onComplete?.()}})}function xr(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return Z(n,{x:i-6},{duration:t/5,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{x:i+5},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{Z(n,{x:i-3},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{Z(n,{x:i+2},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{Z(n,{x:i},{duration:t/5,easing:"easeInOutQuad",onComplete:e.onComplete})}})}})}})}})}function wr(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.angle;return Z(n,{angle:i+.25},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{angle:i-.17},{duration:t*.2,easing:"linear",onComplete:()=>{Z(n,{angle:i+.08},{duration:t*.2,easing:"linear",onComplete:()=>{Z(n,{angle:i-.05},{duration:t*.2,easing:"linear",onComplete:()=>{Z(n,{angle:i},{duration:t*.2,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function br(n,t=1e3,e={}){const s=f.elements.find(c=>c.id===n);if(!s)return"";const i=s.width,o=s.height,r=s.x,a=s.y,l=s.angle;return Z(n,{width:i*.9,height:o*.9,x:r+i*.1/2,y:a+o*.1/2,angle:l-.05},{duration:t*.1,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{width:i*1.1,height:o*1.1,x:r-i*.1/2,y:a-o*.1/2,angle:l+.05},{duration:t*.3,easing:"linear",loop:!0,loopCount:3,alternate:!0,onComplete:()=>{Z(n,{width:i,height:o,x:r,y:a,angle:l},{duration:t*.1,easing:"linear",onComplete:e.onComplete})}})}})}function vr(n,t=1e3,e={}){const s=f.elements.find(r=>r.id===n);if(!s)return"";const i=s.x,o=s.angle;return Z(n,{x:i-s.width*.25,angle:o-.08},{duration:t*.15,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{x:i+s.width*.2,angle:o+.05},{duration:t*.15,easing:"linear",onComplete:()=>{Z(n,{x:i-s.width*.15,angle:o-.05},{duration:t*.15,easing:"linear",onComplete:()=>{Z(n,{x:i+s.width*.1,angle:o+.03},{duration:t*.15,easing:"linear",onComplete:()=>{Z(n,{x:i,angle:o},{duration:t*.15,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function Sr(n,t=1e3,e={}){const s=f.elements.find(l=>l.id===n);if(!s)return"";const i=s.width,o=s.height,r=s.x,a=s.y;return Z(n,{width:i*1.1,height:o*.9,x:r-i*.1/2,y:a+o*.1/2},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{width:i*.9,height:o*1.1,x:r+i*.1/2,y:a-o*.1/2},{duration:t*.2,easing:"linear",onComplete:()=>{Z(n,{width:i*1.05,height:o*.95,x:r-i*.05/2,y:a+o*.05/2},{duration:t*.2,easing:"linear",onComplete:()=>{Z(n,{width:i,height:o,x:r,y:a},{duration:t*.4,easing:"easeOutQuad",onComplete:e.onComplete})}})}})}})}function kr(n,t=1300,e={}){const s=f.elements.find(l=>l.id===n);if(!s)return"";const i=s.width,o=s.height,r=s.x,a=s.y;return Z(n,{width:i*1.3,height:o*1.3,x:r-i*.3/2,y:a-o*.3/2},{duration:t*.2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{width:i,height:o,x:r,y:a},{duration:t*.2,easing:"easeInQuad",onComplete:()=>{Z(n,{width:i*1.3,height:o*1.3,x:r-i*.3/2,y:a-o*.3/2},{duration:t*.2,easing:"easeOutQuad",onComplete:()=>{Z(n,{width:i,height:o,x:r,y:a},{duration:t*.4,easing:"easeInQuad",onComplete:e.onComplete})}})}})}})}function Mr(n,t=300,e={}){const s=f.elements.find(r=>r.id===n);if(!s)return"";const i=s.x+s.width/2,o=s.y+s.height/2;return Z(n,{width:0,height:0,x:i,y:o,opacity:0},{duration:t,easing:"easeInBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function id(n,t=300,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return nt(n,{x:-s.width,opacity:0},!1),Z(n,{x:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function od(n,t=300,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return nt(n,{x:window.innerWidth+100,opacity:0},!1),Z(n,{x:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function sd(n,t=300,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.y;return nt(n,{y:-s.height,opacity:0},!1),Z(n,{y:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function rd(n,t=300,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.y;return nt(n,{y:window.innerHeight+100,opacity:0},!1),Z(n,{y:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function ad(n,t=300,e={}){const s=f.elements.find(i=>i.id===n);return s?Z(n,{x:-s.width,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function ld(n,t=300,e={}){return Z(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function cd(n,t=300,e={}){const s=f.elements.find(i=>i.id===n);return s?Z(n,{y:-s.height,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function dd(n,t=300,e={}){return Z(n,{y:window.innerHeight+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function Qi(n,t,e,s={}){const i=f.elements.find(a=>a.id===n);if(!i)return"";const o=i.x,r=i.y;return nt(n,{x:t.x??o,y:t.y??r,opacity:70,width:i.width*.7,height:i.height*.7},!1),Z(n,{x:o,y:r,opacity:100,width:i.width,height:i.height},{duration:e,easing:"easeOutBack",...s})}function Pr(n,t=1e3,e={}){return Qi(n,{y:-window.innerHeight},t,e)}function $r(n,t=1e3,e={}){return Qi(n,{x:-window.innerWidth},t,e)}function Cr(n,t=1e3,e={}){return Qi(n,{x:window.innerWidth+100},t,e)}function Tr(n,t=1e3,e={}){return Qi(n,{y:window.innerHeight+100},t,e)}function Vi(n,t,e,s={}){const i=f.elements.find(o=>o.id===n);return i?Z(n,{x:t.x??i.x,y:t.y??i.y,opacity:0,width:i.width*.7,height:i.height*.7},{duration:e,easing:"easeInBack",...s}):""}function Ir(n,t=1e3,e={}){return Vi(n,{y:window.innerHeight+100},t,e)}function Lr(n,t=1e3,e={}){return Vi(n,{x:-window.innerWidth},t,e)}function Er(n,t=1e3,e={}){return Vi(n,{x:window.innerWidth+100},t,e)}function Ar(n,t=1e3,e={}){return Vi(n,{y:-window.innerHeight},t,e)}function Wn(n,t,e,s={}){const i=f.elements.find(a=>a.id===n);if(!i)return"";const o=i.x,r=i.y;return nt(n,{x:t.x??o,y:t.y??r,opacity:0,width:i.width*.3,height:i.height*.3},!1),Z(n,{x:o,y:r,opacity:100,width:i.width,height:i.height},{duration:e,easing:"easeOutBounce",...s})}function Rr(n,t=750,e={}){return Wn(n,{},t,e)}function Dr(n,t=1e3,e={}){return Wn(n,{y:-window.innerHeight},t,e)}function Or(n,t=1e3,e={}){return Wn(n,{x:-window.innerWidth},t,e)}function _r(n,t=1e3,e={}){return Wn(n,{x:window.innerWidth+100},t,e)}function Br(n,t=1e3,e={}){return Wn(n,{y:window.innerHeight+100},t,e)}function Xn(n,t,e,s={}){const i=f.elements.find(o=>o.id===n);return i?Z(n,{x:t.x??i.x,y:t.y??i.y,opacity:0,width:i.width*.3,height:i.height*.3},{duration:e,easing:"easeInBounce",...s}):""}function zr(n,t=750,e={}){return Xn(n,{},t,e)}function Wr(n,t=1e3,e={}){return Xn(n,{y:window.innerHeight+100},t,e)}function Xr(n,t=1e3,e={}){return Xn(n,{x:-window.innerWidth},t,e)}function Yr(n,t=1e3,e={}){return Xn(n,{x:window.innerWidth+100},t,e)}function Hr(n,t=1e3,e={}){return Xn(n,{y:-window.innerHeight},t,e)}function Se(n,t,e,s={}){const i=f.elements.find(a=>a.id===n);if(!i)return"";const o=i.x,r=i.y;return nt(n,{x:t.x??o,y:t.y??r,opacity:0},!1),Z(n,{x:o,y:r,opacity:100},{duration:e,easing:"easeOutQuad",...s})}function Nr(n,t=1e3,e={}){return Se(n,{y:(f.selection.length>0,-100)},t,e)}function Fr(n,t=1e3,e={}){return Se(n,{y:-window.innerHeight},t,e)}function Ur(n,t=1e3,e={}){return Se(n,{x:-100},t,e)}function Gr(n,t=1e3,e={}){return Se(n,{x:-window.innerWidth},t,e)}function qr(n,t=1e3,e={}){return Se(n,{x:window.innerWidth+100},t,e)}function jr(n,t=1e3,e={}){return Se(n,{x:window.innerWidth+2e3},t,e)}function Qr(n,t=1e3,e={}){return Se(n,{y:100},t,e)}function Vr(n,t=1e3,e={}){return Se(n,{y:window.innerHeight+100},t,e)}function Jr(n,t=1e3,e={}){return Se(n,{x:-100,y:-100},t,e)}function Kr(n,t=1e3,e={}){return Se(n,{x:100,y:-100},t,e)}function Zr(n,t=1e3,e={}){return Se(n,{x:-100,y:100},t,e)}function ta(n,t=1e3,e={}){return Se(n,{x:100,y:100},t,e)}function ke(n,t,e,s={}){const i=f.elements.find(o=>o.id===n);return i?Z(n,{x:t.x??i.x,y:t.y??i.y,opacity:0},{duration:e,easing:"easeInQuad",...s}):""}function ea(n,t=1e3,e={}){return ke(n,{y:100},t,e)}function na(n,t=1e3,e={}){return ke(n,{y:window.innerHeight+100},t,e)}function ia(n,t=1e3,e={}){return ke(n,{x:-100},t,e)}function oa(n,t=1e3,e={}){return ke(n,{x:-window.innerWidth},t,e)}function sa(n,t=1e3,e={}){return ke(n,{x:100},t,e)}function ra(n,t=1e3,e={}){return ke(n,{x:window.innerWidth+100},t,e)}function aa(n,t=1e3,e={}){return ke(n,{y:-100},t,e)}function la(n,t=1e3,e={}){return ke(n,{y:-window.innerHeight},t,e)}function ca(n,t=1e3,e={}){return ke(n,{x:-100,y:-100},t,e)}function da(n,t=1e3,e={}){return ke(n,{x:100,y:-100},t,e)}function ha(n,t=1e3,e={}){return ke(n,{x:-100,y:100},t,e)}function ua(n,t=1e3,e={}){return ke(n,{x:100,y:100},t,e)}function fa(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.angle;return Z(n,{angle:i+Math.PI},{duration:t/2,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{angle:i+Math.PI*2},{duration:t/2,easing:"easeInOutQuad",onComplete:()=>{nt(n,{angle:i},!1),e.onComplete?.()}})}})}function pa(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.height;return nt(n,{height:0,opacity:0},!1),Z(n,{height:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function ya(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.width;return nt(n,{width:0,opacity:0},!1),Z(n,{width:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function ga(n,t=1e3,e={}){return Z(n,{height:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function ma(n,t=1e3,e={}){return Z(n,{width:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function xa(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return nt(n,{x:window.innerWidth+100,opacity:0},!1),Z(n,{x:i,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function wa(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return nt(n,{x:-window.innerWidth,opacity:0},!1),Z(n,{x:i,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function ba(n,t=1e3,e={}){return Z(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInExpo",...e})}function va(n,t=1e3,e={}){return Z(n,{x:-window.innerWidth,opacity:0},{duration:t,easing:"easeInExpo",...e})}function Yn(n,t,e,s={}){const i=f.elements.find(l=>l.id===n);if(!i)return"";const o=i.x,r=i.y,a=i.angle;return nt(n,{x:t.x??o,y:t.y??r,angle:t.angle??a-Math.PI*2,opacity:0},!1),Z(n,{x:o,y:r,angle:a,opacity:100},{duration:e,easing:"easeOutQuad",...s})}function Sa(n,t=1e3,e={}){return Yn(n,{},t,e)}function ka(n,t=1e3,e={}){return Yn(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function Ma(n,t=1e3,e={}){return Yn(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function Pa(n,t=1e3,e={}){return Yn(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function $a(n,t=1e3,e={}){return Yn(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function Hn(n,t,e,s={}){const i=f.elements.find(o=>o.id===n);return i?Z(n,{x:t.x??i.x,y:t.y??i.y,angle:t.angle??i.angle+Math.PI*2,opacity:0},{duration:e,easing:"easeInQuad",...s}):""}function Ca(n,t=1e3,e={}){return Hn(n,{},t,e)}function Ta(n,t=1e3,e={}){return Hn(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function Ia(n,t=1e3,e={}){return Hn(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function La(n,t=1e3,e={}){return Hn(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function Ea(n,t=1e3,e={}){return Hn(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function hd(n,t=2e3,e={}){const s=f.elements.find(h=>h.id===n);if(!s)return"";const o=(e.params||{}).radius??50,r=s.x,a=s.y,l=r+o,c=a,d=Ri("revolve");return Ui(n),me.has(n)||me.set(n,new Set),me.get(n).add(d),Bt.create(d,h=>{const p=h*Math.PI*2,y=l-o*Math.cos(p),m=c-o*Math.sin(p);nt(n,{x:y,y:m},!1)},{duration:t,easing:e.easing||"linear",delay:e.delay,loop:e.loop,loopCount:e.loopCount,alternate:e.alternate,onComplete:()=>{const h=me.get(n);h&&(h.delete(d),h.size===0&&me.delete(n)),e.onComplete?.()}}),Bt.start(d),d}function Aa(n,t=2e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.angle;return Z(n,{angle:i+1.2},{duration:t*.4,easing:"easeInOutQuad",alternate:!0,loop:!0,loopCount:2,delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{y:window.innerHeight+500,opacity:0},{duration:t*.6,easing:"easeInQuad",onComplete:e.onComplete})}})}function Ra(n,t=1e3,e={}){const s=f.elements.find(l=>l.id===n);if(!s)return"";const i=s.width,o=s.height,r=s.x,a=s.y;return nt(n,{width:0,height:0,x:r+i/2,y:a+o/2,angle:-.5,opacity:0},!1),Z(n,{width:i,height:o,x:r,y:a,angle:0,opacity:100},{duration:t,easing:"easeOutBack",...e})}function Da(n,t=1e3,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.x;return nt(n,{x:i-400,angle:-Math.PI*2,opacity:0},!1),Z(n,{x:i,angle:0,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Oa(n,t=1e3,e={}){const s=f.elements.find(i=>i.id===n);return s?Z(n,{x:s.x+400,angle:Math.PI*2,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function Nn(n,t,e,s={}){const i=f.elements.find(m=>m.id===n);if(!i)return"";const o=i.x,r=i.y,a=i.width,l=i.height,c=t.scale??.1,d=a*c,h=l*c,p=(t.x??o)+(a-d)/2,y=(t.y??r)+(l-h)/2;return nt(n,{x:p,y,width:d,height:h,opacity:0},!1),Z(n,{x:o,y:r,width:a,height:l,opacity:100},{duration:e,easing:"easeOutQuad",...s})}function _a(n,t=1e3,e={}){return Nn(n,{},t,e)}function Ba(n,t=1e3,e={}){return Nn(n,{y:-window.innerHeight},t,e)}function za(n,t=1e3,e={}){return Nn(n,{x:-window.innerWidth},t,e)}function Wa(n,t=1e3,e={}){return Nn(n,{x:window.innerWidth+100},t,e)}function Xa(n,t=1e3,e={}){return Nn(n,{y:window.innerHeight+100},t,e)}function Fn(n,t,e,s={}){const i=f.elements.find(r=>r.id===n);if(!i)return"";const o=t.scale??.1;return Z(n,{x:(t.x??i.x)+i.width*(1-o)/2,y:(t.y??i.y)+i.height*(1-o)/2,width:i.width*o,height:i.height*o,opacity:0},{duration:e,easing:"easeInQuad",...s})}function Ya(n,t=1e3,e={}){return Fn(n,{},t,e)}function Ha(n,t=1e3,e={}){return Fn(n,{y:window.innerHeight+100},t,e)}function Na(n,t=1e3,e={}){return Fn(n,{x:-window.innerWidth},t,e)}function Fa(n,t=1e3,e={}){return Fn(n,{x:window.innerWidth+100},t,e)}function Ua(n,t=1e3,e={}){return Fn(n,{y:-window.innerHeight},t,e)}function Ga(n,t=1500,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.opacity??100;return nt(n,{drawProgress:0,opacity:0},!1),Z(n,{drawProgress:100},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{nt(n,{drawProgress:void 0,opacity:i},!1),e.onComplete?.()}})}function qa(n,t=1500,e={}){const s=f.elements.find(o=>o.id===n);if(!s)return"";const i=s.opacity??100;return nt(n,{drawProgress:100,opacity:0},!1),Z(n,{drawProgress:0},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{nt(n,{drawProgress:void 0,opacity:i},!1),e.onComplete?.()}})}const Oe=new Map;function ja(n){return Oe.get(n)}function ud(n,t={}){const e=f.elements.find(d=>d.id===n);if(!e)return"";const s=e.entranceAnimation??"none",i=e.animationDuration??300,{isPreview:o=!0,onComplete:r}=t;o&&!Oe.has(n)&&Oe.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const a=o?Oe.get(n):null,l=()=>{o&&a&&(nt(n,a,!1),Oe.delete(n)),r?.()},c={onComplete:l};switch(s){case"fadeIn":return nt(n,{opacity:0},!1),Z(n,{opacity:100},{duration:i,easing:"easeOutQuad",onComplete:l});case"fadeInDown":return Nr(n,i,c);case"fadeInDownBig":return Fr(n,i,c);case"fadeInLeft":return Ur(n,i,c);case"fadeInLeftBig":return Gr(n,i,c);case"fadeInRight":return qr(n,i,c);case"fadeInRightBig":return jr(n,i,c);case"fadeInUp":return Qr(n,i,c);case"fadeInUpBig":return Vr(n,i,c);case"fadeInTopLeft":return Jr(n,i,c);case"fadeInTopRight":return Kr(n,i,c);case"fadeInBottomLeft":return Zr(n,i,c);case"fadeInBottomRight":return ta(n,i,c);case"bounce":return Gi(n,i,c);case"flash":return es(n,i,c);case"pulse":return qi(n,i,{scale:1.1,...c});case"rubberBand":return ns(n,i,c);case"shakeX":return ji(n,i,{intensity:10,...c});case"shakeY":return is(n,i,{intensity:10,...c});case"headShake":return xr(n,i);case"swing":return wr(n,i);case"tada":return br(n,i);case"wobble":return vr(n,i);case"jello":return Sr(n,i);case"heartBeat":return kr(n,i);case"backInDown":return Pr(n,i,c);case"backInLeft":return $r(n,i,c);case"backInRight":return Cr(n,i,c);case"backInUp":return Tr(n,i,c);case"bounceIn":return Rr(n,i,c);case"bounceInDown":return Dr(n,i,c);case"bounceInLeft":return Or(n,i,c);case"bounceInRight":return _r(n,i,c);case"bounceInUp":return Br(n,i,c);case"zoomIn":return _a(n,i,c);case"zoomInDown":return Ba(n,i,c);case"zoomInLeft":return za(n,i,c);case"zoomInRight":return Wa(n,i,c);case"zoomInUp":return Xa(n,i,c);case"slideInDown":{const d=e.y;return nt(n,{y:-e.height,opacity:0},!1),Z(n,{y:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:l})}case"slideInLeft":{const d=e.x;return nt(n,{x:-e.width,opacity:0},!1),Z(n,{x:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:l})}case"slideInRight":{const d=e.x;return nt(n,{x:window.innerWidth+100,opacity:0},!1),Z(n,{x:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:l})}case"slideInUp":{const d=e.y;return nt(n,{y:window.innerHeight+100,opacity:0},!1),Z(n,{y:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:l})}case"rotateIn":return Sa(n,i,c);case"rotateInDownLeft":return ka(n,i,c);case"rotateInDownRight":return Ma(n,i,c);case"rotateInUpLeft":return Pa(n,i,c);case"rotateInUpRight":return $a(n,i,c);case"flip":return fa(n,i,c);case"flipInX":return pa(n,i,c);case"flipInY":return ya(n,i,c);case"lightSpeedInRight":return xa(n,i,c);case"lightSpeedInLeft":return wa(n,i,c);case"rollIn":return Da(n,i,c);case"jackInTheBox":return Ra(n,i,c);case"scaleIn":return ts(n,i,c);case"drawIn":return Ga(n,i,c);default:return""}}function fd(n,t={}){const e=f.elements.find(d=>d.id===n);if(!e)return"";const s=e.exitAnimation??"none",i=e.animationDuration??300,{isPreview:o=!0,onComplete:r}=t;o&&!Oe.has(n)&&Oe.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const a=o?Oe.get(n):null,l=()=>{o&&a&&(nt(n,a,!1),Oe.delete(n)),r?.()},c={onComplete:l};switch(s){case"fadeOut":return Z(n,{opacity:0},{duration:i,easing:"easeOutQuad",onComplete:l});case"fadeOutDown":return ea(n,i,c);case"fadeOutDownBig":return na(n,i,c);case"fadeOutLeft":return ia(n,i,c);case"fadeOutLeftBig":return oa(n,i,c);case"fadeOutRight":return sa(n,i,c);case"fadeOutRightBig":return ra(n,i,c);case"fadeOutUp":return aa(n,i,c);case"fadeOutUpBig":return la(n,i,c);case"fadeOutTopLeft":return ca(n,i,c);case"fadeOutTopRight":return da(n,i,c);case"fadeOutBottomLeft":return ha(n,i,c);case"fadeOutBottomRight":return ua(n,i,c);case"backOutDown":return Ir(n,i,c);case"backOutLeft":return Lr(n,i,c);case"backOutRight":return Er(n,i,c);case"backOutUp":return Ar(n,i,c);case"bounceOut":return zr(n,i,c);case"bounceOutDown":return Wr(n,i,c);case"bounceOutLeft":return Xr(n,i,c);case"bounceOutRight":return Yr(n,i,c);case"bounceOutUp":return Hr(n,i,c);case"zoomOut":return Ya(n,i,c);case"zoomOutDown":return Ha(n,i,c);case"zoomOutLeft":return Na(n,i,c);case"zoomOutRight":return Fa(n,i,c);case"zoomOutUp":return Ua(n,i,c);case"slideOutDown":return Z(n,{y:window.innerHeight+100,opacity:0},{duration:i,easing:"easeInQuad",onComplete:l});case"slideOutLeft":return Z(n,{x:-e.width,opacity:0},{duration:i,easing:"easeInQuad",onComplete:l});case"slideOutRight":return Z(n,{x:window.innerWidth+100,opacity:0},{duration:i,easing:"easeInQuad",onComplete:l});case"slideOutUp":return Z(n,{y:-e.height,opacity:0},{duration:i,easing:"easeInQuad",onComplete:l});case"bounce":return Gi(n,i,c);case"flash":return es(n,i,c);case"pulse":return qi(n,i,{scale:1.1,...c});case"rubberBand":return ns(n,i,c);case"shakeX":return ji(n,i,{intensity:10,...c});case"shakeY":return is(n,i,{intensity:10,...c});case"rotateOut":return Ca(n,i,c);case"rotateOutDownLeft":return Ta(n,i,c);case"rotateOutDownRight":return Ia(n,i,c);case"rotateOutUpLeft":return La(n,i,c);case"rotateOutUpRight":return Ea(n,i,c);case"flipOutX":return ga(n,i,c);case"flipOutY":return ma(n,i,c);case"lightSpeedOutRight":return ba(n,i,c);case"lightSpeedOutLeft":return va(n,i,c);case"rollOut":return Oa(n,i,c);case"hinge":return Aa(n,i,c);case"scaleOut":return Mr(n,i,c);case"drawOut":return qa(n,i,c);default:return""}}const pd=Object.freeze(Object.defineProperty({__proto__:null,animateElement:Z,animateElements:ur,backInDown:Pr,backInLeft:$r,backInRight:Cr,backInUp:Tr,backOutDown:Ir,backOutLeft:Lr,backOutRight:Er,backOutUp:Ar,bounce:Gi,bounceIn:Rr,bounceInDown:Dr,bounceInLeft:Or,bounceInRight:_r,bounceInUp:Br,bounceOut:zr,bounceOutDown:Wr,bounceOutLeft:Xr,bounceOutRight:Yr,bounceOutUp:Hr,drawIn:Ga,drawOut:qa,fadeIn:gr,fadeInBottomLeft:Zr,fadeInBottomRight:ta,fadeInDown:Nr,fadeInDownBig:Fr,fadeInLeft:Ur,fadeInLeftBig:Gr,fadeInRight:qr,fadeInRightBig:jr,fadeInTopLeft:Jr,fadeInTopRight:Kr,fadeInUp:Qr,fadeInUpBig:Vr,fadeOut:mr,fadeOutBottomLeft:ha,fadeOutBottomRight:ua,fadeOutDown:ea,fadeOutDownBig:na,fadeOutLeft:ia,fadeOutLeftBig:oa,fadeOutRight:sa,fadeOutRightBig:ra,fadeOutTopLeft:ca,fadeOutTopRight:da,fadeOutUp:aa,fadeOutUpBig:la,flash:es,flip:fa,flipInX:pa,flipInY:ya,flipOutX:ga,flipOutY:ma,getElementPreviewBaseState:ja,headShake:xr,heartBeat:kr,hinge:Aa,isElementAnimating:ed,jackInTheBox:Ra,jello:Sr,lightSpeedInLeft:wa,lightSpeedInRight:xa,lightSpeedOutLeft:va,lightSpeedOutRight:ba,pauseElementAnimation:pr,playEntranceAnimation:ud,playExitAnimation:fd,pulse:qi,resumeElementAnimation:yr,revolve:hd,rollIn:Da,rollOut:Oa,rotateIn:Sa,rotateInDownLeft:ka,rotateInDownRight:Ma,rotateInUpLeft:Pa,rotateInUpRight:$a,rotateOut:Ca,rotateOutDownLeft:Ta,rotateOutDownRight:Ia,rotateOutUpLeft:La,rotateOutUpRight:Ea,rubberBand:ns,scaleIn:ts,scaleOut:Mr,shakeX:ji,shakeY:is,slideInDown:rd,slideInLeft:id,slideInRight:od,slideInUp:sd,slideOutDown:dd,slideOutLeft:ad,slideOutRight:ld,slideOutUp:cd,stopAllElementAnimations:Ui,stopElementAnimation:fr,swing:wr,tada:br,wobble:vr,zoomIn:_a,zoomInDown:Ba,zoomInLeft:za,zoomInRight:Wa,zoomInUp:Xa,zoomOut:Ya,zoomOutDown:Ha,zoomOutLeft:Na,zoomOutRight:Fa,zoomOutUp:Ua},Symbol.toStringTag,{value:"Module"}));class yd{activeSequences=new Set;playSequence(t,e="programmatic"){const s=f.elements.find(c=>c.id===t),i=s?.animations&&s.animations.length>0,o=s?.spinEnabled||s?.orbitEnabled;if(!s||!i&&!(e==="programmatic"&&o))return;let r=null;e==="programmatic"&&(this.activeSequences.add(t),si(!0),Bt.setForceTicker(!0),r={x:s.x,y:s.y,width:s.width,height:s.height,opacity:s.opacity,angle:s.angle,strokeColor:s.strokeColor,backgroundColor:s.backgroundColor});const a=s.animations?s.animations.filter((c,d)=>e==="programmatic"?!0:d===0?c.trigger===e||c.trigger==="after-prev":!0):[];if(a.length===0)return void 0;const l=()=>{e==="programmatic"&&(this.activeSequences.delete(t),this.activeSequences.size===0&&(si(!1),Bt.setForceTicker(!1))),r&&setTimeout(()=>{nt(t,r,!1)},500)};this.runStep(t,a,0,l)}stopSequence(t){Ui(t),this.activeSequences.has(t)&&(this.activeSequences.delete(t),this.activeSequences.size===0&&(si(!1),Bt.setForceTicker(!1)))}playAll(t="programmatic",e){(e?f.elements.filter(i=>e.includes(i.id)):f.elements).forEach(i=>{this.playSequence(i.id,t)})}stopAll(){this.activeSequences.clear(),si(!1),Bt.setForceTicker(!1),f.elements.forEach(t=>{this.stopSequence(t.id)})}runStep(t,e,s,i){if(s>=e.length){i?.();return}const o=e[s],r=s+1,a=()=>{o.restoreAfter&&f.elements.find(p=>p.id===t)&&l&&nt(t,l,!1);let d=r;for(;d<e.length&&e[d].trigger==="with-prev";)d++;d<e.length?this.runStep(t,e,d,i):i?.()};let l=null;if(o.restoreAfter){const d=f.elements.find(h=>h.id===t);d&&(l={...d})}let c=r;for(;c<e.length;){const d=e[c];if(d.trigger==="with-prev")this.executeAnimation(t,d,()=>{d.restoreAfter}),c++;else break}this.executeAnimation(t,o,a)}playAnimation(t,e,s){this.executeAnimation(t,e,s)}executeAnimation(t,e,s){const i={duration:e.duration,delay:e.delay,easing:e.easing,onComplete:s,params:e.params,loop:e.repeat===-1,loopCount:e.repeat!==-1&&(e.repeat||0)>0?e.repeat:void 0,alternate:e.yoyo};if(e.type==="preset"){const o=pd[e.name];typeof o=="function"?o(t,e.duration,i):(console.warn(`Unknown preset: ${e.name}`),s())}else e.type==="property"?this.animateProperty(t,e,i):e.type==="rotate"?this.animateRotate(t,e,i):e.type==="path"&&(console.warn("Path animation not yet implemented"),s())}animateRotate(t,e,s){const i=f.elements.find(r=>r.id===t);if(!i){s.onComplete?.();return}const o=e.relative?(i.angle||0)+e.toAngle*Math.PI/180:e.toAngle*Math.PI/180;Z(t,{angle:o},s)}animateProperty(t,e,s){const i={},o=e.to;e.property==="opacity"||e.property==="x"||e.property==="y"||e.property==="width"||e.property==="height"||e.property==="angle"||e.property==="strokeWidth"||e.property==="roughness"?i[e.property]=Number(o):(e.property==="strokeColor"||e.property==="backgroundColor")&&(i[e.property]=String(o)),Z(t,i,s)}}const Di=new yd,gd=(n,t,e)=>{const s=e[n];if(!s)return[];const{x:i,y:o}=s.spatialPosition,{width:r,height:a}=s.dimensions;return t.filter(l=>{const c=l.x+(l.width||0)/2,d=l.y+(l.height||0)/2;return c>=i&&c<=i+r&&d>=o&&d<=o+a})};class md{buildSequence=[];isPlaying=!1;init(t){this.reset();const e=gd(t,f.elements,f.slides),s=[];e.forEach(i=>{i.animations&&i.animations.length>0&&i.animations.forEach(o=>{s.push({elementId:i.id,animation:o,played:!1})})}),console.log(`[BuildManager] Initialized for slide ${t}. Found ${s.length} total animations.`),s.forEach(i=>console.log(`  - Element ${i.elementId}: ${i.animation.type} (trigger: ${i.animation.trigger})`)),this.buildSequence=s.sort((i,o)=>{const r=e.find(l=>l.id===i.elementId),a=e.find(l=>l.id===o.elementId);if(r.layerId!==a.layerId){const l=f.layers.find(d=>d.id===r.layerId),c=f.layers.find(d=>d.id===a.layerId);return(l?.order??0)-(c?.order??0)}return i.elementId===o.elementId?(r.animations?.indexOf(i.animation)??0)-(a.animations?.indexOf(o.animation)??0):i.elementId.localeCompare(o.elementId)}),console.log(`[BuildManager] Initialized with ${this.buildSequence.length} steps for slide ${t}`)}reset(){this.buildSequence=[],this.isPlaying=!1,Di.stopAll()}playInitial(){f.appMode==="presentation"&&this.buildSequence.forEach((t,e)=>{t.animation.trigger==="on-load"&&!t.played&&this.executeStep(e)})}hasMoreSteps(){return this.buildSequence.some(t=>!t.played&&t.animation.trigger==="on-click")}async playNext(){if(this.isPlaying)return console.log("[BuildManager] Already playing, ignoring click"),!0;const t=this.buildSequence.findIndex(e=>!e.played&&e.animation.trigger==="on-click");return t===-1?(console.log("[BuildManager] No more on-click steps found"),!1):(console.log(`[BuildManager] Executing on-click step ${t}`),this.isPlaying=!0,await this.executeStep(t),this.isPlaying=!1,!0)}executeStep(t){const e=this.buildSequence[t];return!e||e.played?Promise.resolve():(e.played=!0,new Promise(s=>{const i=()=>{this.triggerAfterPrev(t).then(s)};Di.playAnimation(e.elementId,e.animation,i),this.triggerWithPrev(t)}))}triggerWithPrev(t){let e=t+1;for(;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="with-prev";)this.executeStep(e),e++}async triggerAfterPrev(t){let e=t+1;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="after-prev"&&await this.executeStep(e)}}const kn=new md,xd={rectangle:"rect",circle:"circ",triangle:"tria",diamond:"diam",hexagon:"hexa",octagon:"octa",parallelogram:"para",arrow:"arrw",line:"line",text:"text",image:"imag",ink:"ink_",laser:"lasr",group:"grup",slide:"slid",layer:"layr",star:"star",cloud:"clou",heart:"hear",cross:"cros",checkmark:"chck",capsule:"caps",stickyNote:"note",callout:"call",burst:"brst",speechBubble:"bubl",ribbon:"ribb",database:"data",document:"docu",server:"serv",user:"user",firewall:"fire",browser:"brow"},fe=n=>{let t=xd[n];t||(t=n.substring(0,4).toLowerCase()),t.length<4&&(t=t.padEnd(4,"_"));const e=`${t}-`;let s=0;return f.elements.forEach(i=>{if(i.id.startsWith(e)){const o=i.id.substring(e.length),r=parseInt(o,10);!isNaN(r)&&String(r)===o&&r>s&&(s=r)}}),`${e}${s+1}`},wd=(n,t,e)=>{const s=t.filter(h=>n.includes(h.id));if(s.length<2)return[];let i=1/0,o=1/0,r=-1/0,a=-1/0;s.forEach(h=>{i=Math.min(i,h.x),o=Math.min(o,h.y),r=Math.max(r,h.x+h.width),a=Math.max(a,h.y+h.height)});const l=i+(r-i)/2,c=o+(a-o)/2,d=[];return s.forEach(h=>{const p={};switch(e){case"left":p.x=i;break;case"center":p.x=l-h.width/2;break;case"right":p.x=r-h.width;break;case"top":p.y=o;break;case"middle":p.y=c-h.height/2;break;case"bottom":p.y=a-h.height;break}(p.x!==void 0||p.y!==void 0)&&d.push({id:h.id,updates:p})}),d},bd=(n,t,e)=>{const s=t.filter(a=>n.includes(a.id));if(s.length<3)return[];const i=[...s].sort((a,l)=>e==="horizontal"?a.x+a.width/2-(l.x+l.width/2):a.y+a.height/2-(l.y+l.height/2)),o=i[0],r=i[i.length-1];if(e==="horizontal"){const a=o.x+o.width/2,d=(r.x+r.width/2-a)/(i.length-1),h=[];return i.forEach((p,y)=>{if(y===0||y===i.length-1)return;const g=a+d*y-p.width/2;h.push({id:p.id,updates:{x:g}})}),h}else{const a=o.y+o.height/2,d=(r.y+r.height/2-a)/(i.length-1),h=[];return i.forEach((p,y)=>{if(y===0||y===i.length-1)return;const g=a+d*y-p.height/2;h.push({id:p.id,updates:{y:g}})}),h}},Tn=lr(),bn={elements:Tn.elements,viewState:{scale:.5,panX:0,panY:0},layers:Tn.layers,activeLayerId:Tn.layers[0].id,gridSettings:Tn.gridSettings,canvasBackgroundColor:"#ffffff",dimensions:{width:1920,height:1080},slides:Tn.slides,activeSlideIndex:0,docType:"infinite",canvasTexture:"none",isPreviewing:!1,selectedTool:"selection",selectedUmlType:"umlClass",selection:[],flowTick:0,isRecording:!1,defaultElementStyles:{strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,renderStyle:"sketch",opacity:100,angle:0,roundness:null,locked:!1,fontSize:20,fontFamily:"hand-drawn",fontWeight:!1,fontStyle:!1,textAlign:"left",startArrowhead:null,endArrowhead:null,autoResize:!1,flowColor:void 0,seed:0,shadowEnabled:!1,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:10,shadowOffsetX:5,shadowOffsetY:5,gradientStart:"#ffffff",gradientEnd:"#000000",gradientDirection:45,smoothing:3,taperAmount:.15,velocitySensitivity:.5},toolStyles:{},theme:localStorage.getItem("theme")||"light",globalSettings:{animationEnabled:!0,reducedMotion:!1,renderStyle:"sketch",showMindmapToolbar:!0},showCanvasProperties:!1,undoStackLength:0,redoStackLength:0,showPropertyPanel:!1,showLayerPanel:!1,isPropertyPanelMinimized:!1,isLayerPanelMinimized:!1,minimapVisible:!1,zenMode:!1,appMode:"design",showCommandPalette:!1,selectedPenType:"fineliner",selectedShapeType:"triangle",selectedInfraType:"server",selectedMathType:"trapezoid",selectedSketchnoteType:"starPerson",selectedWireframeType:"browserWindow",layerGroupingModeEnabled:!1,maxLayers:20,selectedTechnicalType:"dfdProcess",states:[],showStatePanel:!1,showSlideNavigator:!0,showSlideToolbar:!0,showMainToolbar:!0,slideToolbarPosition:{x:window.innerWidth/2-150,y:window.innerHeight-80},showExportDialog:!1,showUtilityToolbar:!0},[f,$]=Hc(bn),Ee=[],on=[],Pt=()=>{const n={elements:JSON.parse(JSON.stringify(f.elements)),layers:JSON.parse(JSON.stringify(f.layers))};Ee.push(n),Ee.length>50&&Ee.shift(),on.length=0,$("undoStackLength",Ee.length),$("redoStackLength",0)},os=()=>{if(Ee.length===0)return;const n={elements:JSON.parse(JSON.stringify(f.elements)),layers:JSON.parse(JSON.stringify(f.layers))};on.push(n);const t=Ee.pop();t&&($("elements",t.elements),$("layers",t.layers),$("selection",[])),$("undoStackLength",Ee.length),$("redoStackLength",on.length)},Oi=()=>{if(on.length===0)return;const n={elements:JSON.parse(JSON.stringify(f.elements)),layers:JSON.parse(JSON.stringify(f.layers))};Ee.push(n);const t=on.pop();t&&($("elements",t.elements),$("layers",t.layers),$("selection",[])),$("undoStackLength",Ee.length),$("redoStackLength",on.length)},en=n=>{Pt(),$("elements",t=>[...t,n])},ss=n=>{const t=f.elements.find(l=>l.id===n);if(!t)return;Pt();const e=fe(t.type),s=150,o={...f.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:t.backgroundColor,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:e,type:t.type==="image"||t.type==="line"||t.type==="arrow"?"rectangle":t.type,x:t.x+t.width+s,y:t.y+0,width:t.width>0?t.width:100,height:t.height>0?t.height:60,layerId:f.activeLayerId,parentId:t.id,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},r={...f.defaultElementStyles,id:fe("arrow"),type:"arrow",x:t.x+t.width,y:t.y+t.height/2,width:s,height:0,layerId:f.activeLayerId,startBinding:{elementId:t.id,gap:5,position:"right",focus:0},endBinding:{elementId:e,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,s,0]},a=r.id;return $("elements",l=>[...l,o,r]),$("elements",l=>l.id===n,"boundElements",l=>[...l||[],{id:a,type:"arrow"}]),$("elements",l=>l.id===e,"boundElements",l=>[...l||[],{id:a,type:"arrow"}]),$("selection",[e]),e},rs=n=>{const t=f.elements.find(l=>l.id===n);if(!t)return;const e=t.parentId;if(!e)return;Pt();const s=fe(t.type),i=t.height+40,o={...f.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:s,type:t.type,x:t.x,y:t.y+i,width:t.width,height:t.height,layerId:f.activeLayerId,parentId:e,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},r={...f.defaultElementStyles,id:fe("arrow"),type:"arrow",x:t.x-150,y:t.y+i+t.height/2,width:150,height:0,layerId:f.activeLayerId,startBinding:{elementId:e,gap:5,position:"right",focus:0},endBinding:{elementId:s,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,150,0]},a=r.id;return $("elements",l=>[...l,o,r]),$("elements",l=>l.id===e,"boundElements",l=>[...l||[],{id:a,type:"arrow"}]),$("elements",l=>l.id===s,"boundElements",l=>[...l||[],{id:a,type:"arrow"}]),$("selection",[s]),s},Qa=()=>{f.selection.length!==0&&(Pt(),$("elements",n=>f.selection.includes(n.id),n=>({isCollapsed:!n.isCollapsed})))},Rs=n=>{$("showCanvasProperties",n),n&&($("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1))},Ue=n=>{n.length!==0&&(Pt(),$("elements",t=>t.filter(e=>!n.includes(e.id))),$("selection",[]))},as=n=>{n.length!==0&&(Pt(),$("elements",t=>{const e=t.filter(i=>n.includes(i.id));return[...t.filter(i=>!n.includes(i.id)),...e]}))},ls=n=>{n.length!==0&&(Pt(),$("elements",t=>{const e=t.filter(i=>n.includes(i.id)),s=t.filter(i=>!n.includes(i.id));return[...e,...s]}))},vd=()=>{const n=f.elements.some(t=>t.flowAnimation);Bt.setForceTicker(n)},nt=(n,t,e=!1)=>{e&&Pt(),$("elements",s=>s.id===n,t),"flowAnimation"in t&&vd()},ky=(n,t,e,s=!1)=>{s&&Pt(),$("elements",i=>i.id===n,"animations",i=>i.id===t,e)},My=(n,t,e,s=!0)=>{const i=f.elements.find(c=>c.id===n);if(!i||!i.animations)return;const o=[...i.animations],r=o.findIndex(c=>c.id===t);if(r===-1)return;const a=e==="up"?r-1:r+1;if(a<0||a>=o.length)return;s&&Pt();const[l]=o.splice(r,1);o.splice(a,0,l),$("elements",c=>c.id===n,"animations",o)},Va=(n,t,e=!1)=>{f.selection.length!==0&&(e&&Pt(),$("elements",s=>f.selection.includes(s.id),s=>({x:s.x+n,y:s.y+t})))},Zt=n=>{$("viewState",t=>({...t,...n}))},Tt=n=>{const t=f.selectedTool;if(t!=="selection"){const e=JSON.parse(JSON.stringify(f.defaultElementStyles));$("toolStyles",t,e)}if($("selectedTool",n),n!=="selection"&&n!=="pan"&&n!=="eraser"&&$("selection",[]),n!=="selection"){const e=f.toolStyles[n];e&&Fe(e)}n==="arrow"?Fe({endArrowhead:"arrow"}):n==="line"&&Fe({endArrowhead:null}),Fe(n==="starPerson"||n==="scroll"||n==="wavyDivider"||n==="doubleBanner"||n==="lightbulb"||n==="signpost"||n==="burstBlob"||n==="browserWindow"||n==="mobilePhone"||n==="ghostButton"||n==="inputField"?{autoResize:!1}:{autoResize:!1})},Fe=n=>{$("defaultElementStyles",t=>({...t,...n}))},Py=n=>{$("globalSettings",t=>({...t,...n})),n.renderStyle&&Fe({renderStyle:n.renderStyle})},Sd=(n,t)=>{$("slides",n,"thumbnail",t)},cs=()=>{const n=f.activeSlideIndex;if(n<0||n>=f.slides.length)return;const t={backgroundColor:f.canvasBackgroundColor,dimensions:JSON.parse(JSON.stringify(f.dimensions)),thumbnail:f.slides[f.activeSlideIndex].thumbnail};$("slides",n,t)},an=async(n,t)=>{if(n<0||n>=f.slides.length||n===f.activeSlideIndex&&!uo.transitioning)return;$("selection",[]),f.appMode==="presentation"&&!0?await uo.transitionTo(n):await uo.transitionTo(n,{skipAnimation:!0});const s=f.slides[n];s&&(s.backgroundColor&&$("canvasBackgroundColor",s.backgroundColor),$("dimensions",JSON.parse(JSON.stringify(s.dimensions))),f.appMode==="presentation"&&(kn.init(n),kn.playInitial())),Wt(`Slide ${n+1}`,"info")},Ja=async()=>{if(f.states.findIndex(t=>t.id===f.activeStateId)<f.states.length-1){ds();return}if(kn.hasMoreSteps()){await kn.playNext();return}f.activeSlideIndex<f.slides.length-1&&await an(f.activeSlideIndex+1)},kd=async()=>{if(f.states.findIndex(t=>t.id===f.activeStateId)>0){hs();return}f.activeSlideIndex>0&&await an(f.activeSlideIndex-1)},Ka=()=>{cs();const n=f.slides.length,t=f.slides[f.slides.length-1],e=t?t.spatialPosition.x+2e3:0,s=Zo(void 0,`Slide ${n+1}`,e,0);s.order=n,$("slides",i=>[...i,s]),an(n),Wt("Slide added","success")},$y=n=>{if(n<0||n>=f.slides.length)return;Pt(),cs();const t=f.slides[n],{x:e,y:s}=t.spatialPosition,{width:i,height:o}=t.dimensions,r=f.elements.filter(m=>{const g=m.x+(m.width||0)/2,w=m.y+(m.height||0)/2;return g>=e&&g<=e+i&&w>=s&&w<=s+o}),l=f.slides.reduce((m,g)=>m.spatialPosition.x>g.spatialPosition.x?m:g).spatialPosition.x+2e3,c={x:l-e,y:0},d=new Map;r.forEach(m=>d.set(m.id,crypto.randomUUID()));const h=r.map(m=>{const g=d.get(m.id),w=JSON.parse(JSON.stringify(m));return w.id=g,w.x+=c.x,w.y+=c.y,w.seed=Math.floor(Math.random()*2147483647),w.startBinding&&d.has(w.startBinding.elementId)?w.startBinding.elementId=d.get(w.startBinding.elementId):w.startBinding&&(w.startBinding=void 0),w.endBinding&&d.has(w.endBinding.elementId)?w.endBinding.elementId=d.get(w.endBinding.elementId):w.endBinding&&(w.endBinding=void 0),w.boundElements&&(w.boundElements=w.boundElements.filter(x=>d.has(x.id)).map(x=>({...x,id:d.get(x.id)}))),w.parentId&&d.has(w.parentId)?w.parentId=d.get(w.parentId):w.parentId&&(w.parentId=void 0),w}),p={...JSON.parse(JSON.stringify(t)),id:crypto.randomUUID(),name:`${t.name} (Copy)`,spatialPosition:{x:l,y:0},order:n+1,thumbnail:void 0},y=[...f.slides];y.splice(n+1,0,p),y.forEach((m,g)=>m.order=g),je(()=>{$("slides",y),$("elements",m=>[...m,...h]),an(n+1)}),Wt("Slide duplicated","success")},Md=n=>{if(f.slides.length<=1){Wt("Cannot delete the last slide","error");return}const t=f.slides.filter((s,i)=>i!==n);t.forEach((s,i)=>s.order=i);let e=f.activeSlideIndex;e>=t.length&&(e=t.length-1),je(()=>{$("slides",t),an(e)}),Wt("Slide deleted","info")},Pd=(n,t)=>{if(n===t)return;const e=[...f.slides],[s]=e.splice(n,1);e.splice(t,0,s),e.forEach((o,r)=>o.order=r);let i=f.activeSlideIndex;f.activeSlideIndex===n?i=t:n<f.activeSlideIndex&&t>=f.activeSlideIndex?i--:n>f.activeSlideIndex&&t<=f.activeSlideIndex&&i++,$("slides",e),$("activeSlideIndex",i)},$d=(n,t)=>{if(n<0||n>=f.slides.length)return;const e=f.slides[n]?.transition||{...zn};$("slides",n,"transition",{...e,...t})},Cd=(n,t)=>{n<0||n>=f.slides.length||($("slides",n,"backgroundColor",t),n===f.activeSlideIndex&&$("canvasBackgroundColor",t))},_i=n=>{je(()=>{let t=[],e=[],s=[],i=n.gridSettings||bn.gridSettings,o=n.states||[];if(n.version===4)t=n.elements,e=n.slides,s=n.layers,o=n.states||[],i=n.gridSettings||i;else if(n.version===3){s=n.slides[0]?.layers||bn.layers;const a=2e3;n.slides.forEach((l,c)=>{const d=c*a,h=0,p=l.elements.map(y=>({...y,x:y.x+d,y:y.y+h}));t.push(...p),e.push({id:l.id,name:l.name,spatialPosition:{x:d,y:h},dimensions:l.dimensions||{width:1920,height:1080},order:c,backgroundColor:l.backgroundColor,thumbnail:l.thumbnail}),l.states&&o.push(...l.states)})}else t=n.elements||[],s=n.layers||bn.layers,e=[Zo()];e.forEach(a=>{a.transition||(a.transition={...zn})}),$("elements",JSON.parse(JSON.stringify(t))),$("slides",JSON.parse(JSON.stringify(e))),$("layers",JSON.parse(JSON.stringify(s))),$("states",JSON.parse(JSON.stringify(o))),$("gridSettings",JSON.parse(JSON.stringify(i))),$("globalSettings",n.globalSettings||bn.globalSettings);const r=n.metadata?.docType||(n.version>=3?"slides":"infinite");$("docType",r),$("showSlideNavigator",r==="slides"),$("showSlideToolbar",!0),$("showUtilityToolbar",!0),$("activeSlideIndex",0),$("selection",[]),s.some(a=>a.id===f.activeLayerId)||$("activeLayerId",s[0]?.id||"default-layer"),setTimeout(()=>vs(),100)}),tl()},Td=n=>{je(()=>{$("docType",n),$("showSlideNavigator",n==="slides")})},Za=n=>{$("showStatePanel",n??!f.showStatePanel)},Id=n=>{const t=crypto.randomUUID(),e={};f.elements.forEach(i=>{e[i.id]={x:i.x,y:i.y,width:i.width,height:i.height,opacity:i.opacity,angle:i.angle,backgroundColor:i.backgroundColor,strokeColor:i.strokeColor,text:i.text}});const s={id:t,name:n,overrides:e};$("states",i=>[...i,s]),$("activeStateId",t),Wt(`State "${n}" captured`,"success")},Ld=n=>{const t=f.states.findIndex(s=>s.id===n);if(t===-1)return;const e={};f.elements.forEach(s=>{e[s.id]={x:s.x,y:s.y,width:s.width,height:s.height,opacity:s.opacity,angle:s.angle,backgroundColor:s.backgroundColor,strokeColor:s.strokeColor,text:s.text}}),$("states",t,"overrides",e),Wt("State updated","success")},Ed=n=>{$("states",t=>t.filter(e=>e.id!==n)),f.activeStateId===n&&$("activeStateId",void 0),Wt("State deleted","info")},Ji=async(n,t=!0)=>{const e=f.states.find(s=>s.id===n);if(e)if($("activeStateId",n),t){const{MorphAnimator:s}=await le(async()=>{const{MorphAnimator:i}=await import("./morph-animator-BpfWiBsW.js");return{MorphAnimator:i}},__vite__mapDeps([0,1,2,3]),import.meta.url);s.morphTo(e)}else je(()=>{Object.entries(e.overrides).forEach(([s,i])=>{nt(s,i,!1)})})},ds=async()=>{if(f.states.length===0)return;const t=(f.states.findIndex(e=>e.id===f.activeStateId)+1)%f.states.length;await Ji(f.states[t].id)},hs=async()=>{if(f.states.length===0)return;let t=f.states.findIndex(e=>e.id===f.activeStateId)-1;t<0&&(t=f.states.length-1),await Ji(f.states[t].id)},tl=()=>{Ee.length=0,on.length=0,$("undoStackLength",0),$("redoStackLength",0)},el=(n="slides")=>{const t=lr("Untitled",n);_i(t),$("showSlideToolbar",!0),$("showUtilityToolbar",!0),Wt(`New ${n==="slides"?"presentation":"sketch"} created`,"info")},nl=n=>{const t=f.elements.find(o=>o.id===n);if(!t)return;Pt();const e=fe(t.type),s=10/f.viewState.scale,i={...t,id:e,x:t.x+s,y:t.y+s,points:t.points?t.pointsEncoding==="flat"?[...t.points]:t.points.map(o=>({...o})):void 0,roundness:t.roundness?{...t.roundness}:null,crop:t.crop?{...t.crop}:null,boundElements:null,groupIds:t.groupIds?[...t.groupIds]:void 0,seed:Math.floor(Math.random()*2147483647)};$("elements",o=>[...o,i]),$("selection",[e])},us=()=>{if(f.selection.length<2)return;Pt();const n=fe("group");$("elements",t=>f.selection.includes(t.id),"groupIds",t=>[...t||[],n])},fs=()=>{if(f.selection.length===0)return;const n=new Set;f.elements.forEach(t=>{f.selection.includes(t.id)&&t.groupIds&&t.groupIds.length>0&&n.add(t.groupIds[t.groupIds.length-1])}),n.size!==0&&(Pt(),$("elements",t=>{if(!t.groupIds||t.groupIds.length===0)return!1;const e=t.groupIds[t.groupIds.length-1];return n.has(e)},"groupIds",t=>t&&t.slice(0,-1)))},Io=(n,t)=>{const e=f.elements.findIndex(s=>s.id===n);e!==-1&&(Pt(),$("elements",s=>{const i=[...s],o=i.splice(e,1)[0];if(t==="front")i.push(o);else if(t==="back")i.unshift(o);else if(t==="forward"){const r=Math.min(i.length,e+1);i.splice(r,0,o)}else if(t==="backward"){const r=Math.max(0,e-1);i.splice(r,0,o)}return i}))},il=()=>{const n=f.theme==="light"?"dark":"light";$("theme",n),localStorage.setItem("theme",n),document.documentElement.setAttribute("data-theme",n)},ps=()=>{if(f.elements.length===0){$("viewState",{scale:1,panX:0,panY:0});return}let n=1/0,t=1/0,e=-1/0,s=-1/0;f.elements.forEach(w=>{n=Math.min(n,w.x),e=Math.max(e,w.x+w.width),t=Math.min(t,w.y),s=Math.max(s,w.y+w.height)});const i=e-n,o=s-t;if(i===0&&o===0){const w=n,x=t,b=window.innerWidth/2,S=window.innerHeight/2;$("viewState",{scale:1,panX:-w+b,panY:-x+S});return}const r=50,a=window.innerWidth,l=window.innerHeight,c=(a-r*2)/i,d=(l-r*2)/o;let h=Math.min(c,d);h=Math.min(Math.max(h,.1),2);const p=n+i/2,y=t+o/2,m=a/2,g=l/2;$("viewState",{scale:h,panX:-p*h+m,panY:-y*h+g})},ol=(n,t)=>{if(f.layers.length>=f.maxLayers){console.warn(`Layer limit reached (${f.maxLayers} layers max)`);return}Pt();const e=crypto.randomUUID(),s=Math.max(...f.layers.map(o=>o.order),-1),i={id:e,name:n||`Layer ${f.layers.length+1}`,visible:!0,locked:!1,opacity:1,order:s+1,backgroundColor:"transparent",colorTag:void 0,parentId:t,isGroup:!1,expanded:!0};return $("layers",[...f.layers,i]),$("activeLayerId",e),e},Ad=n=>{if(f.layers.length<=1){Wt("Cannot delete the last layer.","error");return}const t=f.layers.find(s=>s.id===n);if(!t)return;const e=f.elements.filter(s=>s.layerId===n);if(e.length>0){const s=confirm(`Layer "${t.name}" contains ${e.length} element(s).

Click "OK" to delete the layer AND all its elements.
Click "Cancel" to delete the layer but move elements to another layer.`);if(Pt(),s)$("elements",f.elements.filter(i=>i.layerId!==n));else{const i=f.layers.find(o=>o.id!==n);i&&f.elements.forEach((o,r)=>{o.layerId===n&&$("elements",r,"layerId",i.id)})}}else Pt();$("layers",f.layers.filter(s=>s.id!==n)),f.activeLayerId===n&&$("activeLayerId",f.layers[0]?.id||"default-layer")},Rd=(n,t)=>{const e=f.layers.findIndex(s=>s.id===n);e!==-1&&$("layers",e,t)},Dd=n=>{if(f.layers.length>=f.maxLayers){console.warn(`Layer limit reached (${f.maxLayers} layers max)`);return}const t=f.layers.find(a=>a.id===n);if(!t)return;Pt();const e=crypto.randomUUID(),s={...t,id:e,name:`${t.name} Copy`,opacity:t.opacity??1,order:t.order+.5,backgroundColor:t.backgroundColor||"transparent",parentId:t.parentId,isGroup:t.isGroup,expanded:t.expanded},o=f.elements.filter(a=>a.layerId===n).map(a=>({...a,id:crypto.randomUUID(),layerId:e,x:a.x+10,y:a.y+10}));$("layers",[...f.layers,s]),$("elements",[...f.elements,...o]),[...f.layers].sort((a,l)=>a.order-l.order).forEach((a,l)=>{const c=f.layers.findIndex(d=>d.id===a.id);$("layers",c,"order",l)}),$("activeLayerId",e)},Lo=(n,t)=>{if(n===t)return;Pt();const e=[...f.layers],[s]=e.splice(n,1);e.splice(t,0,s),e.forEach((i,o)=>{i.order=o}),$("layers",e)},ys=n=>{f.layers.find(e=>e.id===n)&&$("activeLayerId",n)},Od=n=>{const e=[...f.layers].sort((s,i)=>s.order-i.order).reverse()[n];e&&ys(e.id)},_d=n=>{const t=f.layers.findIndex(i=>i.id===n);if(t<=0)return;const e=f.layers[t],s=f.layers[t-1];Pt(),$("elements",i=>i.layerId===e.id,"layerId",s.id),$("layers",i=>i.filter(o=>o.id!==e.id)),f.activeLayerId===e.id&&$("activeLayerId",s.id)},Bd=()=>{if(f.layers.length<=1)return;Pt();const n=f.layers[0];$("elements",t=>t.layerId!==n.id,"layerId",n.id),$("layers",[n]),$("activeLayerId",n.id)},Le=n=>{const t=f.layers.find(e=>e.id===n);return!t||t.visible===!1?!1:f.layerGroupingModeEnabled&&t.parentId?Le(t.parentId):!0},gs=n=>{const t=f.layers.find(e=>e.id===n);return t?t.locked?!0:f.layerGroupingModeEnabled&&t.parentId?gs(t.parentId):t.locked||!1:!1},zd=n=>{f.layers.forEach((t,e)=>{t.id!==n?$("layers",e,"visible",!1):$("layers",e,"visible",!0)})},Wd=()=>{f.layers.forEach((n,t)=>{$("layers",t,"visible",!0)})},Xd=(n,t)=>{f.layers.find(s=>s.id===t)&&(Pt(),n.forEach(s=>{const i=f.elements.findIndex(o=>o.id===s);i!==-1&&$("elements",i,"layerId",t)}))},ms=()=>{$("gridSettings","enabled",!f.gridSettings.enabled)},xs=()=>{$("gridSettings","snapToGrid",!f.gridSettings.snapToGrid)},Cy=n=>{$("gridSettings",n)},Yd=n=>{$("canvasBackgroundColor",n)},Hd=n=>{$("canvasTexture",n)},Nd=n=>{$("selectedPenType",n)},Fd=n=>{$("selectedShapeType",n)},Ud=n=>{$("selectedInfraType",n)},Gd=n=>{$("selectedMathType",n)},qd=n=>{$("selectedSketchnoteType",n)},jd=n=>{$("selectedWireframeType",n)},Ty=n=>{$("gridSettings","style",n)},Iy=n=>$("maxLayers",n),si=n=>$("isPreviewing",n),Sn=n=>{f.isPropertyPanelMinimized&&(n===void 0||n===!0)?($("isPropertyPanelMinimized",!1),$("showPropertyPanel",!0)):$("showPropertyPanel",n??!f.showPropertyPanel)},Bi=n=>{$("showLayerPanel",t=>n??!t)},Qd=n=>{$("showSlideToolbar",t=>n??!t)},Ly=(n,t)=>{$("slideToolbarPosition",{x:n,y:t})},vi=n=>{$("showExportDialog",n)},Vd=n=>{$("showUtilityToolbar",t=>!t)},Ey=n=>{$("isPropertyPanelMinimized",t=>!t)},Ay=n=>{$("isLayerPanelMinimized",t=>n??!t)},Ry=()=>{$("layerGroupingModeEnabled",n=>!n)},Jd=n=>{Pt();const t=crypto.randomUUID(),e=Math.max(...f.layers.map(i=>i.order),-1),s={id:t,name:n||`Group ${f.layers.filter(i=>i.isGroup).length+1}`,visible:!0,locked:!1,opacity:1,order:e+1,backgroundColor:"transparent",isGroup:!0,expanded:!0};return $("layers",[...f.layers,s]),$("activeLayerId",t),t},Kd=n=>{$("layers",t=>t.id===n,"expanded",t=>!t)},Ki=n=>{$("minimapVisible",t=>n??!t)},ws=n=>{$("zenMode",t=>n??!t)},bs=n=>{$("showSlideNavigator",t=>n??!t)},Zd=n=>{$("showMainToolbar",t=>!t)},vs=()=>{const n=f.slides[f.activeSlideIndex];if(!n)return;const{width:t,height:e}=n.dimensions,{x:s,y:i}=n.spatialPosition,o=40,r=window.innerWidth-o*2,a=window.innerHeight-o*2,l=r/t,c=a/e,d=Math.min(l,c),h=(window.innerWidth-t*d)/2-s*d,p=(window.innerHeight-e*d)/2-i*d;$("viewState",{scale:d,panX:h,panY:p})},Si=n=>{const t=f.appMode==="presentation",e=n??!t;je(()=>{$("appMode",e?"presentation":"design"),e&&(vs(),$("selection",[]),kn.init(f.activeSlideIndex),kn.playInitial())}),e?document.documentElement.requestFullscreen?.().catch(s=>{console.warn("Fullscreen failed:",s)}):document.fullscreenElement&&document.exitFullscreen?.()},th=n=>{$("selectedTechnicalType",n)},eh=n=>{$("selectedUmlType",n)},sl=n=>{$("showCommandPalette",t=>n??!t)};document.documentElement.setAttribute("data-theme",bn.theme);const nh=n=>{if(f.selection.length<2)return;const t=wd(f.selection,f.elements,n);t.length>0&&(Pt(),$("elements",e=>t.some(s=>s.id===e.id),e=>{const s=t.find(i=>i.id===e.id)?.updates;return s?{...e,...s}:e}))},ih=()=>{if(f.selection.length===0){const n=["solid","dashed","dotted"],t=f.defaultElementStyles.strokeStyle||"solid",e=n[(n.indexOf(t)+1)%n.length];Fe({strokeStyle:e});return}Pt(),$("elements",n=>f.selection.includes(n.id),n=>{const t=["solid","dashed","dotted"],e=n.strokeStyle||"solid";return{strokeStyle:t[(t.indexOf(e)+1)%t.length]}})},oh=()=>{if(f.selection.length===0){const n=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],t=f.defaultElementStyles.fillStyle||"hachure",e=n[(n.indexOf(t)+1)%n.length];Fe({fillStyle:e});return}Pt(),$("elements",n=>f.selection.includes(n.id),n=>{const t=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],e=n.fillStyle||"hachure";return{fillStyle:t[(t.indexOf(e)+1)%t.length]}})},sh=n=>{if(f.selection.length<3)return;const t=bd(f.selection,f.elements,n);t.length>0&&(Pt(),$("elements",e=>t.some(s=>s.id===e.id),e=>{const s=t.find(i=>i.id===e.id)?.updates;return s?{...e,...s}:e}))},rl=n=>{tl(),$({elements:n.elements,layers:n.layers,activeLayerId:n.layers[0]?.id||"default-layer",viewState:n.viewState||{scale:1,panX:0,panY:0},gridSettings:n.gridSettings||f.gridSettings,globalSettings:n.globalSettings||f.globalSettings,canvasBackgroundColor:n.canvasBackgroundColor||f.canvasBackgroundColor,selection:[]})},Eo=n=>{const t=f.elements.find(e=>e.id===n);t&&nt(n,{isCollapsed:!t.isCollapsed},!0)},al=(n,t)=>{nt(n,{parentId:t},!0)},rh=n=>{nt(n,{parentId:null},!0)},mn=(n,t)=>{const e=new dr,s=e.buildTree(n,f.elements);if(!s)return;Pt(),t.startsWith("horizontal")?e.layoutHorizontal(s,t==="horizontal-right"?"right":"left"):t.startsWith("vertical")?e.layoutVertical(s,t==="vertical-down"?"down":"up"):t==="radial"&&e.layoutRadial(s);const i=e.getUpdates(s,f.elements),o=f.elements.map(r=>{const a=i.get(r.id);return a?{...r,...a}:r});$("elements",o),Wt(`Mindmap layout updated (${t})`,"success")},ll=n=>{const t=new dr,e=t.buildTree(n,f.elements);if(!e)return;Pt(),t.applySemanticStyling(e,f.elements);const s=t.getUpdates(e,f.elements),i=f.elements.map(o=>{const r=s.get(o.id);return r?{...o,...r}:o});$("elements",i),Wt("Semantic styling applied to branch","success")};typeof window<"u"&&setInterval(()=>{const n=Date.now(),t=f.elements.filter(e=>e.ttl&&n>e.ttl).map(e=>e.id);t.length>0&&$("elements",e=>e.filter(s=>!t.includes(s.id)))},500);const Dy=(n,t)=>{if(!(!t||n===t)){if(f.elements.some(e=>e.id===t)){Wt("ID already exists","error");return}Pt(),$("elements",e=>e.map(s=>{if(s.id===n)return{...s,id:t};let i={};return s.parentId===n&&(i.parentId=t),s.orbitCenterId===n&&(i.orbitCenterId=t),s.startBinding?.elementId===n&&(i.startBinding={...s.startBinding,elementId:t}),s.endBinding?.elementId===n&&(i.endBinding={...s.endBinding,elementId:t}),Object.keys(i).length>0?{...s,...i}:s})),f.selection.includes(n)&&$("selection",e=>e.map(s=>s===n?t:s))}},cl=(n,t,e,s,i=new Set,o=!1)=>{if(s.has(n.id))return s.get(n.id);if(i.has(n.id))return{x:n.x,y:n.y,angle:n.angle||0,opacity:n.opacity||100};i.add(n.id);let r=n.x,a=n.y,l=n.angle||0;const c=n.orbitSpeed!==void 0?Number(n.orbitSpeed):1,d=n.orbitRadius!==void 0?Number(n.orbitRadius):150;if(n.orbitEnabled&&n.orbitCenterId&&!isNaN(d)&&!isNaN(c)){const y=e.get(n.orbitCenterId);if(y){const m=cl(y,t,e,s,i,o),g=Number(m.x)||0,w=Number(m.y)||0,x=Number(y.width)||0,b=Number(y.height)||0,S=g+x/2,P=w+b/2;if(o){const R=t*.001*c,B=S+d*Math.cos(R),U=P+d*Math.sin(R);r=B-(Number(n.width)||0)/2,a=U-(Number(n.height)||0)/2}}}const h=n.spinSpeed!==void 0?Number(n.spinSpeed):5;if(n.spinEnabled&&!isNaN(h)&&o){const y=t*.001;l+=y*(h*Math.PI/3)}isNaN(r)&&(r=n.x),isNaN(a)&&(a=n.y),isNaN(l)&&(l=n.angle||0);const p={x:r,y:a,angle:l,opacity:n.opacity||100};return s.set(n.id,p),i.delete(n.id),p},fo=(n,t,e=!1)=>{const s=new Map;n.forEach(r=>s.set(r.id,r));const i=new Map,o=new Set;return n.forEach(r=>{cl(r,t,s,i,o,e)}),i};function Ao(n,t,e){if(n&&n.length){const[s,i]=t,o=Math.PI/180*e,r=Math.cos(o),a=Math.sin(o);for(const l of n){const[c,d]=l;l[0]=(c-s)*r-(d-i)*a+s,l[1]=(c-s)*a+(d-i)*r+i}}}function ah(n,t,e){const s=[];n.forEach(i=>s.push(...i)),Ao(s,t,e)}function lh(n,t){return n[0]===t[0]&&n[1]===t[1]}function ch(n,t,e,s=1){const i=e,o=Math.max(t,.1),r=n[0]&&n[0][0]&&typeof n[0][0]=="number"?[n]:n,a=[0,0];if(i)for(const c of r)Ao(c,a,i);const l=dh(r,o,s);if(i){for(const c of r)Ao(c,a,-i);ah(l,a,-i)}return l}function dh(n,t,e){const s=[];for(const c of n){const d=[...c];lh(d[0],d[d.length-1])||d.push([d[0][0],d[0][1]]),d.length>2&&s.push(d)}const i=[];t=Math.max(t,.1);const o=[];for(const c of s)for(let d=0;d<c.length-1;d++){const h=c[d],p=c[d+1];if(h[1]!==p[1]){const y=Math.min(h[1],p[1]);o.push({ymin:y,ymax:Math.max(h[1],p[1]),x:y===h[1]?h[0]:p[0],islope:(p[0]-h[0])/(p[1]-h[1])})}}if(o.sort((c,d)=>c.ymin<d.ymin?-1:c.ymin>d.ymin?1:c.x<d.x?-1:c.x>d.x?1:c.ymax===d.ymax?0:(c.ymax-d.ymax)/Math.abs(c.ymax-d.ymax)),!o.length)return i;let r=[],a=o[0].ymin,l=0;for(;r.length||o.length;){if(o.length){let c=-1;for(let h=0;h<o.length&&!(o[h].ymin>a);h++)c=h;o.splice(0,c+1).forEach(h=>{r.push({s:a,edge:h})})}if(r=r.filter(c=>!(c.edge.ymax<=a)),r.sort((c,d)=>c.edge.x===d.edge.x?0:(c.edge.x-d.edge.x)/Math.abs(c.edge.x-d.edge.x)),(e!==1||l%t===0)&&r.length>1)for(let c=0;c<r.length;c=c+2){const d=c+1;if(d>=r.length)break;const h=r[c].edge,p=r[d].edge;i.push([[Math.round(h.x),a],[Math.round(p.x),a]])}a+=e,r.forEach(c=>{c.edge.x=c.edge.x+e*c.edge.islope}),l++}return i}function Un(n,t){var e;const s=t.hachureAngle+90;let i=t.hachureGap;i<0&&(i=t.strokeWidth*4),i=Math.round(Math.max(i,.1));let o=1;return t.roughness>=1&&(((e=t.randomizer)===null||e===void 0?void 0:e.next())||Math.random())>.7&&(o=i),ch(n,i,s,o||1)}class Ss{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const s=Un(t,e);return{type:"fillSketch",ops:this.renderLines(s,e)}}renderLines(t,e){const s=[];for(const i of t)s.push(...this.helper.doubleLineOps(i[0][0],i[0][1],i[1][0],i[1][1],e));return s}}function Zi(n){const t=n[0],e=n[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}class hh extends Ss{fillPolygons(t,e){let s=e.hachureGap;s<0&&(s=e.strokeWidth*4),s=Math.max(s,.1);const i=Object.assign({},e,{hachureGap:s}),o=Un(t,i),r=Math.PI/180*e.hachureAngle,a=[],l=s*.5*Math.cos(r),c=s*.5*Math.sin(r);for(const[h,p]of o)Zi([h,p])&&a.push([[h[0]-l,h[1]+c],[...p]],[[h[0]+l,h[1]-c],[...p]]);return{type:"fillSketch",ops:this.renderLines(a,e)}}}class uh extends Ss{fillPolygons(t,e){const s=this._fillPolygons(t,e),i=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),o=this._fillPolygons(t,i);return s.ops=s.ops.concat(o.ops),s}}class fh{constructor(t){this.helper=t}fillPolygons(t,e){e=Object.assign({},e,{hachureAngle:0});const s=Un(t,e);return this.dotsOnLines(s,e)}dotsOnLines(t,e){const s=[];let i=e.hachureGap;i<0&&(i=e.strokeWidth*4),i=Math.max(i,.1);let o=e.fillWeight;o<0&&(o=e.strokeWidth/2);const r=i/4;for(const a of t){const l=Zi(a),c=l/i,d=Math.ceil(c)-1,h=l-d*i,p=(a[0][0]+a[1][0])/2-i/4,y=Math.min(a[0][1],a[1][1]);for(let m=0;m<d;m++){const g=y+h+m*i,w=p-r+Math.random()*2*r,x=g-r+Math.random()*2*r,b=this.helper.ellipse(w,x,o,o,e);s.push(...b.ops)}}return{type:"fillSketch",ops:s}}}class ph{constructor(t){this.helper=t}fillPolygons(t,e){const s=Un(t,e);return{type:"fillSketch",ops:this.dashedLine(s,e)}}dashedLine(t,e){const s=e.dashOffset<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashOffset,i=e.dashGap<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashGap,o=[];return t.forEach(r=>{const a=Zi(r),l=Math.floor(a/(s+i)),c=(a+i-l*(s+i))/2;let d=r[0],h=r[1];d[0]>h[0]&&(d=r[1],h=r[0]);const p=Math.atan((h[1]-d[1])/(h[0]-d[0]));for(let y=0;y<l;y++){const m=y*(s+i),g=m+s,w=[d[0]+m*Math.cos(p)+c*Math.cos(p),d[1]+m*Math.sin(p)+c*Math.sin(p)],x=[d[0]+g*Math.cos(p)+c*Math.cos(p),d[1]+g*Math.sin(p)+c*Math.sin(p)];o.push(...this.helper.doubleLineOps(w[0],w[1],x[0],x[1],e))}}),o}}class yh{constructor(t){this.helper=t}fillPolygons(t,e){const s=e.hachureGap<0?e.strokeWidth*4:e.hachureGap,i=e.zigzagOffset<0?s:e.zigzagOffset;e=Object.assign({},e,{hachureGap:s+i});const o=Un(t,e);return{type:"fillSketch",ops:this.zigzagLines(o,i,e)}}zigzagLines(t,e,s){const i=[];return t.forEach(o=>{const r=Zi(o),a=Math.round(r/(2*e));let l=o[0],c=o[1];l[0]>c[0]&&(l=o[1],c=o[0]);const d=Math.atan((c[1]-l[1])/(c[0]-l[0]));for(let h=0;h<a;h++){const p=h*2*e,y=(h+1)*2*e,m=Math.sqrt(2*Math.pow(e,2)),g=[l[0]+p*Math.cos(d),l[1]+p*Math.sin(d)],w=[l[0]+y*Math.cos(d),l[1]+y*Math.sin(d)],x=[g[0]+m*Math.cos(d+Math.PI/4),g[1]+m*Math.sin(d+Math.PI/4)];i.push(...this.helper.doubleLineOps(g[0],g[1],x[0],x[1],s),...this.helper.doubleLineOps(x[0],x[1],w[0],w[1],s))}}),i}}const he={};function gh(n,t){let e=n.fillStyle||"hachure";if(!he[e])switch(e){case"zigzag":he[e]||(he[e]=new hh(t));break;case"cross-hatch":he[e]||(he[e]=new uh(t));break;case"dots":he[e]||(he[e]=new fh(t));break;case"dashed":he[e]||(he[e]=new ph(t));break;case"zigzag-line":he[e]||(he[e]=new yh(t));break;default:e="hachure",he[e]||(he[e]=new Ss(t));break}return he[e]}function mh(){return Math.floor(Math.random()*2**31)}class xh{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const wh=0,Ro=1,dl=2,ri={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function bh(n){const t=new Array;for(;n!=="";)if(n.match(/^([ \t\r\n,]+)/))n=n.substr(RegExp.$1.length);else if(n.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:wh,text:RegExp.$1},n=n.substr(RegExp.$1.length);else if(n.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:Ro,text:`${parseFloat(RegExp.$1)}`},n=n.substr(RegExp.$1.length);else return[];return t[t.length]={type:dl,text:""},t}function po(n,t){return n.type===t}function ks(n){const t=[],e=bh(n);let s="BOD",i=0,o=e[i];for(;!po(o,dl);){let r=0;const a=[];if(s==="BOD")if(o.text==="M"||o.text==="m")i++,r=ri[o.text],s=o.text;else return ks("M0,0"+n);else po(o,Ro)?r=ri[s]:(i++,r=ri[o.text],s=o.text);if(i+r<e.length){for(let l=i;l<i+r;l++){const c=e[l];if(po(c,Ro))a[a.length]=+c.text;else throw new Error("Param not a number: "+s+","+c.text)}if(typeof ri[s]=="number"){const l={key:s,data:a};t.push(l),i+=r,o=e[i],s==="M"&&(s="L"),s==="m"&&(s="l")}else throw new Error("Bad segment: "+s)}else throw new Error("Path data ended short")}return t}function hl(n){let t=0,e=0,s=0,i=0;const o=[];for(const{key:r,data:a}of n)switch(r){case"M":o.push({key:"M",data:[...a]}),[t,e]=a,[s,i]=a;break;case"m":t+=a[0],e+=a[1],o.push({key:"M",data:[t,e]}),s=t,i=e;break;case"L":o.push({key:"L",data:[...a]}),[t,e]=a;break;case"l":t+=a[0],e+=a[1],o.push({key:"L",data:[t,e]});break;case"C":o.push({key:"C",data:[...a]}),t=a[4],e=a[5];break;case"c":{const l=a.map((c,d)=>d%2?c+e:c+t);o.push({key:"C",data:l}),t=l[4],e=l[5];break}case"Q":o.push({key:"Q",data:[...a]}),t=a[2],e=a[3];break;case"q":{const l=a.map((c,d)=>d%2?c+e:c+t);o.push({key:"Q",data:l}),t=l[2],e=l[3];break}case"A":o.push({key:"A",data:[...a]}),t=a[5],e=a[6];break;case"a":t+=a[5],e+=a[6],o.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],t,e]});break;case"H":o.push({key:"H",data:[...a]}),t=a[0];break;case"h":t+=a[0],o.push({key:"H",data:[t]});break;case"V":o.push({key:"V",data:[...a]}),e=a[0];break;case"v":e+=a[0],o.push({key:"V",data:[e]});break;case"S":o.push({key:"S",data:[...a]}),t=a[2],e=a[3];break;case"s":{const l=a.map((c,d)=>d%2?c+e:c+t);o.push({key:"S",data:l}),t=l[2],e=l[3];break}case"T":o.push({key:"T",data:[...a]}),t=a[0],e=a[1];break;case"t":t+=a[0],e+=a[1],o.push({key:"T",data:[t,e]});break;case"Z":case"z":o.push({key:"Z",data:[]}),t=s,e=i;break}return o}function ul(n){const t=[];let e="",s=0,i=0,o=0,r=0,a=0,l=0;for(const{key:c,data:d}of n){switch(c){case"M":t.push({key:"M",data:[...d]}),[s,i]=d,[o,r]=d;break;case"C":t.push({key:"C",data:[...d]}),s=d[4],i=d[5],a=d[2],l=d[3];break;case"L":t.push({key:"L",data:[...d]}),[s,i]=d;break;case"H":s=d[0],t.push({key:"L",data:[s,i]});break;case"V":i=d[0],t.push({key:"L",data:[s,i]});break;case"S":{let h=0,p=0;e==="C"||e==="S"?(h=s+(s-a),p=i+(i-l)):(h=s,p=i),t.push({key:"C",data:[h,p,...d]}),a=d[0],l=d[1],s=d[2],i=d[3];break}case"T":{const[h,p]=d;let y=0,m=0;e==="Q"||e==="T"?(y=s+(s-a),m=i+(i-l)):(y=s,m=i);const g=s+2*(y-s)/3,w=i+2*(m-i)/3,x=h+2*(y-h)/3,b=p+2*(m-p)/3;t.push({key:"C",data:[g,w,x,b,h,p]}),a=y,l=m,s=h,i=p;break}case"Q":{const[h,p,y,m]=d,g=s+2*(h-s)/3,w=i+2*(p-i)/3,x=y+2*(h-y)/3,b=m+2*(p-m)/3;t.push({key:"C",data:[g,w,x,b,y,m]}),a=h,l=p,s=y,i=m;break}case"A":{const h=Math.abs(d[0]),p=Math.abs(d[1]),y=d[2],m=d[3],g=d[4],w=d[5],x=d[6];h===0||p===0?(t.push({key:"C",data:[s,i,w,x,w,x]}),s=w,i=x):(s!==w||i!==x)&&(fl(s,i,w,x,h,p,y,m,g).forEach(function(S){t.push({key:"C",data:S})}),s=w,i=x);break}case"Z":t.push({key:"Z",data:[]}),s=o,i=r;break}e=c}return t}function vh(n){return Math.PI*n/180}function In(n,t,e){const s=n*Math.cos(e)-t*Math.sin(e),i=n*Math.sin(e)+t*Math.cos(e);return[s,i]}function fl(n,t,e,s,i,o,r,a,l,c){const d=vh(r);let h=[],p=0,y=0,m=0,g=0;if(c)[p,y,m,g]=c;else{[n,t]=In(n,t,-d),[e,s]=In(e,s,-d);const ht=(n-e)/2,pt=(t-s)/2;let mt=ht*ht/(i*i)+pt*pt/(o*o);mt>1&&(mt=Math.sqrt(mt),i=mt*i,o=mt*o);const At=a===l?-1:1,_t=i*i,rt=o*o,ft=_t*rt-_t*pt*pt-rt*ht*ht,Rt=_t*pt*pt+rt*ht*ht,Dt=At*Math.sqrt(Math.abs(ft/Rt));m=Dt*i*pt/o+(n+e)/2,g=Dt*-o*ht/i+(t+s)/2,p=Math.asin(parseFloat(((t-g)/o).toFixed(9))),y=Math.asin(parseFloat(((s-g)/o).toFixed(9))),n<m&&(p=Math.PI-p),e<m&&(y=Math.PI-y),p<0&&(p=Math.PI*2+p),y<0&&(y=Math.PI*2+y),l&&p>y&&(p=p-Math.PI*2),!l&&y>p&&(y=y-Math.PI*2)}let w=y-p;if(Math.abs(w)>Math.PI*120/180){const ht=y,pt=e,mt=s;l&&y>p?y=p+Math.PI*120/180*1:y=p+Math.PI*120/180*-1,e=m+i*Math.cos(y),s=g+o*Math.sin(y),h=fl(e,s,pt,mt,i,o,r,0,l,[y,ht,m,g])}w=y-p;const x=Math.cos(p),b=Math.sin(p),S=Math.cos(y),P=Math.sin(y),R=Math.tan(w/4),B=4/3*i*R,U=4/3*o*R,D=[n,t],Q=[n+B*b,t-U*x],ot=[e+B*P,s-U*S],st=[e,s];if(Q[0]=2*D[0]-Q[0],Q[1]=2*D[1]-Q[1],c)return[Q,ot,st].concat(h);{h=[Q,ot,st].concat(h);const ht=[];for(let pt=0;pt<h.length;pt+=3){const mt=In(h[pt][0],h[pt][1],d),At=In(h[pt+1][0],h[pt+1][1],d),_t=In(h[pt+2][0],h[pt+2][1],d);ht.push([mt[0],mt[1],At[0],At[1],_t[0],_t[1]])}return ht}}const Sh={randOffset:Ch,randOffsetWithRange:Th,ellipse:Ph,doubleLineOps:Ih};function pl(n,t,e,s,i){return{type:"path",ops:Ge(n,t,e,s,i)}}function ki(n,t,e){const s=(n||[]).length;if(s>2){const i=[];for(let o=0;o<s-1;o++)i.push(...Ge(n[o][0],n[o][1],n[o+1][0],n[o+1][1],e));return t&&i.push(...Ge(n[s-1][0],n[s-1][1],n[0][0],n[0][1],e)),{type:"path",ops:i}}else if(s===2)return pl(n[0][0],n[0][1],n[1][0],n[1][1],e);return{type:"path",ops:[]}}function kh(n,t){return ki(n,!0,t)}function Mh(n,t,e,s,i){const o=[[n,t],[n+e,t],[n+e,t+s],[n,t+s]];return kh(o,i)}function Ds(n,t){if(n.length){const s=typeof n[0][0]=="number"?[n]:n,i=ai(s[0],1*(1+t.roughness*.2),t),o=t.disableMultiStroke?[]:ai(s[0],1.5*(1+t.roughness*.22),Bs(t));for(let r=1;r<s.length;r++){const a=s[r];if(a.length){const l=ai(a,1*(1+t.roughness*.2),t),c=t.disableMultiStroke?[]:ai(a,1.5*(1+t.roughness*.22),Bs(t));for(const d of l)d.op!=="move"&&i.push(d);for(const d of c)d.op!=="move"&&o.push(d)}}return{type:"path",ops:i.concat(o)}}return{type:"path",ops:[]}}function Ph(n,t,e,s,i){const o=yl(e,s,i);return Do(n,t,i,o).opset}function yl(n,t,e){const s=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(n/2,2)+Math.pow(t/2,2))/2)),i=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*s)),o=Math.PI*2/i;let r=Math.abs(n/2),a=Math.abs(t/2);const l=1-e.curveFitting;return r+=St(r*l,e),a+=St(a*l,e),{increment:o,rx:r,ry:a}}function Do(n,t,e,s){const[i,o]=zs(s.increment,n,t,s.rx,s.ry,1,s.increment*zi(.1,zi(.4,1,e),e),e);let r=Wi(i,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[a]=zs(s.increment,n,t,s.rx,s.ry,1.5,0,e),l=Wi(a,null,e);r=r.concat(l)}return{estimatedPoints:o,opset:{type:"path",ops:r}}}function Os(n,t,e,s,i,o,r,a,l){const c=n,d=t;let h=Math.abs(e/2),p=Math.abs(s/2);h+=St(h*.01,l),p+=St(p*.01,l);let y=i,m=o;for(;y<0;)y+=Math.PI*2,m+=Math.PI*2;m-y>Math.PI*2&&(y=0,m=Math.PI*2);const g=Math.PI*2/l.curveStepCount,w=Math.min(g/2,(m-y)/2),x=Ws(w,c,d,h,p,y,m,1,l);if(!l.disableMultiStroke){const b=Ws(w,c,d,h,p,y,m,1.5,l);x.push(...b)}return r&&(a?x.push(...Ge(c,d,c+h*Math.cos(y),d+p*Math.sin(y),l),...Ge(c,d,c+h*Math.cos(m),d+p*Math.sin(m),l)):x.push({op:"lineTo",data:[c,d]},{op:"lineTo",data:[c+h*Math.cos(y),d+p*Math.sin(y)]})),{type:"path",ops:x}}function _s(n,t){const e=ul(hl(ks(n))),s=[];let i=[0,0],o=[0,0];for(const{key:r,data:a}of e)switch(r){case"M":{o=[a[0],a[1]],i=[a[0],a[1]];break}case"L":s.push(...Ge(o[0],o[1],a[0],a[1],t)),o=[a[0],a[1]];break;case"C":{const[l,c,d,h,p,y]=a;s.push(...Lh(l,c,d,h,p,y,o,t)),o=[p,y];break}case"Z":s.push(...Ge(o[0],o[1],i[0],i[1],t)),o=[i[0],i[1]];break}return{type:"path",ops:s}}function yo(n,t){const e=[];for(const s of n)if(s.length){const i=t.maxRandomnessOffset||0,o=s.length;if(o>2){e.push({op:"move",data:[s[0][0]+St(i,t),s[0][1]+St(i,t)]});for(let r=1;r<o;r++)e.push({op:"lineTo",data:[s[r][0]+St(i,t),s[r][1]+St(i,t)]})}}return{type:"fillPath",ops:e}}function xn(n,t){return gh(t,Sh).fillPolygons(n,t)}function $h(n,t,e,s,i,o,r){const a=n,l=t;let c=Math.abs(e/2),d=Math.abs(s/2);c+=St(c*.01,r),d+=St(d*.01,r);let h=i,p=o;for(;h<0;)h+=Math.PI*2,p+=Math.PI*2;p-h>Math.PI*2&&(h=0,p=Math.PI*2);const y=(p-h)/r.curveStepCount,m=[];for(let g=h;g<=p;g=g+y)m.push([a+c*Math.cos(g),l+d*Math.sin(g)]);return m.push([a+c*Math.cos(p),l+d*Math.sin(p)]),m.push([a,l]),xn([m],r)}function Ch(n,t){return St(n,t)}function Th(n,t,e){return zi(n,t,e)}function Ih(n,t,e,s,i){return Ge(n,t,e,s,i,!0)}function Bs(n){const t=Object.assign({},n);return t.randomizer=void 0,n.seed&&(t.seed=n.seed+1),t}function gl(n){return n.randomizer||(n.randomizer=new xh(n.seed||0)),n.randomizer.next()}function zi(n,t,e,s=1){return e.roughness*s*(gl(e)*(t-n)+n)}function St(n,t,e=1){return zi(-n,n,t,e)}function Ge(n,t,e,s,i,o=!1){const r=o?i.disableMultiStrokeFill:i.disableMultiStroke,a=Oo(n,t,e,s,i,!0,!1);if(r)return a;const l=Oo(n,t,e,s,i,!0,!0);return a.concat(l)}function Oo(n,t,e,s,i,o,r){const a=Math.pow(n-e,2)+Math.pow(t-s,2),l=Math.sqrt(a);let c=1;l<200?c=1:l>500?c=.4:c=-.0016668*l+1.233334;let d=i.maxRandomnessOffset||0;d*d*100>a&&(d=l/10);const h=d/2,p=.2+gl(i)*.2;let y=i.bowing*i.maxRandomnessOffset*(s-t)/200,m=i.bowing*i.maxRandomnessOffset*(n-e)/200;y=St(y,i,c),m=St(m,i,c);const g=[],w=()=>St(h,i,c),x=()=>St(d,i,c),b=i.preserveVertices;return r?g.push({op:"move",data:[n+(b?0:w()),t+(b?0:w())]}):g.push({op:"move",data:[n+(b?0:St(d,i,c)),t+(b?0:St(d,i,c))]}),r?g.push({op:"bcurveTo",data:[y+n+(e-n)*p+w(),m+t+(s-t)*p+w(),y+n+2*(e-n)*p+w(),m+t+2*(s-t)*p+w(),e+(b?0:w()),s+(b?0:w())]}):g.push({op:"bcurveTo",data:[y+n+(e-n)*p+x(),m+t+(s-t)*p+x(),y+n+2*(e-n)*p+x(),m+t+2*(s-t)*p+x(),e+(b?0:x()),s+(b?0:x())]}),g}function ai(n,t,e){if(!n.length)return[];const s=[];s.push([n[0][0]+St(t,e),n[0][1]+St(t,e)]),s.push([n[0][0]+St(t,e),n[0][1]+St(t,e)]);for(let i=1;i<n.length;i++)s.push([n[i][0]+St(t,e),n[i][1]+St(t,e)]),i===n.length-1&&s.push([n[i][0]+St(t,e),n[i][1]+St(t,e)]);return Wi(s,null,e)}function Wi(n,t,e){const s=n.length,i=[];if(s>3){const o=[],r=1-e.curveTightness;i.push({op:"move",data:[n[1][0],n[1][1]]});for(let a=1;a+2<s;a++){const l=n[a];o[0]=[l[0],l[1]],o[1]=[l[0]+(r*n[a+1][0]-r*n[a-1][0])/6,l[1]+(r*n[a+1][1]-r*n[a-1][1])/6],o[2]=[n[a+1][0]+(r*n[a][0]-r*n[a+2][0])/6,n[a+1][1]+(r*n[a][1]-r*n[a+2][1])/6],o[3]=[n[a+1][0],n[a+1][1]],i.push({op:"bcurveTo",data:[o[1][0],o[1][1],o[2][0],o[2][1],o[3][0],o[3][1]]})}}else s===3?(i.push({op:"move",data:[n[1][0],n[1][1]]}),i.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):s===2&&i.push(...Oo(n[0][0],n[0][1],n[1][0],n[1][1],e,!0,!0));return i}function zs(n,t,e,s,i,o,r,a){const l=a.roughness===0,c=[],d=[];if(l){n=n/4,d.push([t+s*Math.cos(-n),e+i*Math.sin(-n)]);for(let h=0;h<=Math.PI*2;h=h+n){const p=[t+s*Math.cos(h),e+i*Math.sin(h)];c.push(p),d.push(p)}d.push([t+s*Math.cos(0),e+i*Math.sin(0)]),d.push([t+s*Math.cos(n),e+i*Math.sin(n)])}else{const h=St(.5,a)-Math.PI/2;d.push([St(o,a)+t+.9*s*Math.cos(h-n),St(o,a)+e+.9*i*Math.sin(h-n)]);const p=Math.PI*2+h-.01;for(let y=h;y<p;y=y+n){const m=[St(o,a)+t+s*Math.cos(y),St(o,a)+e+i*Math.sin(y)];c.push(m),d.push(m)}d.push([St(o,a)+t+s*Math.cos(h+Math.PI*2+r*.5),St(o,a)+e+i*Math.sin(h+Math.PI*2+r*.5)]),d.push([St(o,a)+t+.98*s*Math.cos(h+r),St(o,a)+e+.98*i*Math.sin(h+r)]),d.push([St(o,a)+t+.9*s*Math.cos(h+r*.5),St(o,a)+e+.9*i*Math.sin(h+r*.5)])}return[d,c]}function Ws(n,t,e,s,i,o,r,a,l){const c=o+St(.1,l),d=[];d.push([St(a,l)+t+.9*s*Math.cos(c-n),St(a,l)+e+.9*i*Math.sin(c-n)]);for(let h=c;h<=r;h=h+n)d.push([St(a,l)+t+s*Math.cos(h),St(a,l)+e+i*Math.sin(h)]);return d.push([t+s*Math.cos(r),e+i*Math.sin(r)]),d.push([t+s*Math.cos(r),e+i*Math.sin(r)]),Wi(d,null,l)}function Lh(n,t,e,s,i,o,r,a){const l=[],c=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.3];let d=[0,0];const h=a.disableMultiStroke?1:2,p=a.preserveVertices;for(let y=0;y<h;y++)y===0?l.push({op:"move",data:[r[0],r[1]]}):l.push({op:"move",data:[r[0]+(p?0:St(c[0],a)),r[1]+(p?0:St(c[0],a))]}),d=p?[i,o]:[i+St(c[y],a),o+St(c[y],a)],l.push({op:"bcurveTo",data:[n+St(c[y],a),t+St(c[y],a),e+St(c[y],a),s+St(c[y],a),d[0],d[1]]});return l}function Ln(n){return[...n]}function Xs(n,t=0){const e=n.length;if(e<3)throw new Error("A curve must have at least three points.");const s=[];if(e===3)s.push(Ln(n[0]),Ln(n[1]),Ln(n[2]),Ln(n[2]));else{const i=[];i.push(n[0],n[0]);for(let a=1;a<n.length;a++)i.push(n[a]),a===n.length-1&&i.push(n[a]);const o=[],r=1-t;s.push(Ln(i[0]));for(let a=1;a+2<i.length;a++){const l=i[a];o[0]=[l[0],l[1]],o[1]=[l[0]+(r*i[a+1][0]-r*i[a-1][0])/6,l[1]+(r*i[a+1][1]-r*i[a-1][1])/6],o[2]=[i[a+1][0]+(r*i[a][0]-r*i[a+2][0])/6,i[a+1][1]+(r*i[a][1]-r*i[a+2][1])/6],o[3]=[i[a+1][0],i[a+1][1]],s.push(o[1],o[2],o[3])}}return s}function Eh(n,t){return Math.sqrt(Mi(n,t))}function Mi(n,t){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function Ah(n,t,e){const s=Mi(t,e);if(s===0)return Mi(n,t);let i=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/s;return i=Math.max(0,Math.min(1,i)),Mi(n,Ze(t,e,i))}function Ze(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e]}function Rh(n,t){const e=n[t+0],s=n[t+1],i=n[t+2],o=n[t+3];let r=3*s[0]-2*e[0]-o[0];r*=r;let a=3*s[1]-2*e[1]-o[1];a*=a;let l=3*i[0]-2*o[0]-e[0];l*=l;let c=3*i[1]-2*o[1]-e[1];return c*=c,r<l&&(r=l),a<c&&(a=c),r+a}function _o(n,t,e,s){const i=s||[];if(Rh(n,t)<e){const o=n[t+0];i.length?Eh(i[i.length-1],o)>1&&i.push(o):i.push(o),i.push(n[t+3])}else{const r=n[t+0],a=n[t+1],l=n[t+2],c=n[t+3],d=Ze(r,a,.5),h=Ze(a,l,.5),p=Ze(l,c,.5),y=Ze(d,h,.5),m=Ze(h,p,.5),g=Ze(y,m,.5);_o([r,d,y,g],0,e,i),_o([g,m,p,c],0,e,i)}return i}function Dh(n,t){return Xi(n,0,n.length,t)}function Xi(n,t,e,s,i){const o=i||[],r=n[t],a=n[e-1];let l=0,c=1;for(let d=t+1;d<e-1;++d){const h=Ah(n[d],r,a);h>l&&(l=h,c=d)}return Math.sqrt(l)>s?(Xi(n,t,c+1,s,o),Xi(n,c,e,s,o)):(o.length||o.push(r),o.push(a)),o}function Bo(n,t=.15,e){const s=[],i=(n.length-1)/3;for(let o=0;o<i;o++){const r=o*3;_o(n,r,t,s)}return e&&e>0?Xi(s,0,s.length,e):s}function Oh(n,t,e){const s=ks(n),i=ul(hl(s)),o=[];let r=[],a=[0,0],l=[];const c=()=>{l.length>=4&&r.push(...Bo(l,t)),l=[]},d=()=>{c(),r.length&&(o.push(r),r=[])};for(const{key:p,data:y}of i)switch(p){case"M":d(),a=[y[0],y[1]],r.push(a);break;case"L":c(),r.push([y[0],y[1]]);break;case"C":if(!l.length){const m=r.length?r[r.length-1]:a;l.push([m[0],m[1]])}l.push([y[0],y[1]]),l.push([y[2],y[3]]),l.push([y[4],y[5]]);break;case"Z":c(),r.push([a[0],a[1]]);break}if(d(),!e)return o;const h=[];for(const p of o){const y=Dh(p,e);y.length&&h.push(y)}return h}const ye="none";class Yi{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return mh()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,s){return{shape:t,sets:e||[],options:s||this.defaultOptions}}line(t,e,s,i,o){const r=this._o(o);return this._d("line",[pl(t,e,s,i,r)],r)}rectangle(t,e,s,i,o){const r=this._o(o),a=[],l=Mh(t,e,s,i,r);if(r.fill){const c=[[t,e],[t+s,e],[t+s,e+i],[t,e+i]];r.fillStyle==="solid"?a.push(yo([c],r)):a.push(xn([c],r))}return r.stroke!==ye&&a.push(l),this._d("rectangle",a,r)}ellipse(t,e,s,i,o){const r=this._o(o),a=[],l=yl(s,i,r),c=Do(t,e,r,l);if(r.fill)if(r.fillStyle==="solid"){const d=Do(t,e,r,l).opset;d.type="fillPath",a.push(d)}else a.push(xn([c.estimatedPoints],r));return r.stroke!==ye&&a.push(c.opset),this._d("ellipse",a,r)}circle(t,e,s,i){const o=this.ellipse(t,e,s,s,i);return o.shape="circle",o}linearPath(t,e){const s=this._o(e);return this._d("linearPath",[ki(t,!1,s)],s)}arc(t,e,s,i,o,r,a=!1,l){const c=this._o(l),d=[],h=Os(t,e,s,i,o,r,a,!0,c);if(a&&c.fill)if(c.fillStyle==="solid"){const p=Object.assign({},c);p.disableMultiStroke=!0;const y=Os(t,e,s,i,o,r,!0,!1,p);y.type="fillPath",d.push(y)}else d.push($h(t,e,s,i,o,r,c));return c.stroke!==ye&&d.push(h),this._d("arc",d,c)}curve(t,e){const s=this._o(e),i=[],o=Ds(t,s);if(s.fill&&s.fill!==ye)if(s.fillStyle==="solid"){const r=Ds(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(r.ops)})}else{const r=[],a=t;if(a.length){const c=typeof a[0][0]=="number"?[a]:a;for(const d of c)d.length<3?r.push(...d):d.length===3?r.push(...Bo(Xs([d[0],d[0],d[1],d[2]]),10,(1+s.roughness)/2)):r.push(...Bo(Xs(d),10,(1+s.roughness)/2))}r.length&&i.push(xn([r],s))}return s.stroke!==ye&&i.push(o),this._d("curve",i,s)}polygon(t,e){const s=this._o(e),i=[],o=ki(t,!0,s);return s.fill&&(s.fillStyle==="solid"?i.push(yo([t],s)):i.push(xn([t],s))),s.stroke!==ye&&i.push(o),this._d("polygon",i,s)}path(t,e){const s=this._o(e),i=[];if(!t)return this._d("path",i,s);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const o=s.fill&&s.fill!=="transparent"&&s.fill!==ye,r=s.stroke!==ye,a=!!(s.simplification&&s.simplification<1),l=a?4-4*(s.simplification||1):(1+s.roughness)/2,c=Oh(t,1,l),d=_s(t,s);if(o)if(s.fillStyle==="solid")if(c.length===1){const h=_s(t,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(h.ops)})}else i.push(yo(c,s));else i.push(xn(c,s));return r&&(a?c.forEach(h=>{i.push(ki(h,!1,s))}):i.push(d)),this._d("path",i,s)}opsToPath(t,e){let s="";for(const i of t.ops){const o=typeof e=="number"&&e>=0?i.data.map(r=>+r.toFixed(e)):i.data;switch(i.op){case"move":s+=`M${o[0]} ${o[1]} `;break;case"bcurveTo":s+=`C${o[0]} ${o[1]}, ${o[2]} ${o[3]}, ${o[4]} ${o[5]} `;break;case"lineTo":s+=`L${o[0]} ${o[1]} `;break}}return s.trim()}toPaths(t){const e=t.sets||[],s=t.options||this.defaultOptions,i=[];for(const o of e){let r=null;switch(o.type){case"path":r={d:this.opsToPath(o),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:ye};break;case"fillPath":r={d:this.opsToPath(o),stroke:ye,strokeWidth:0,fill:s.fill||ye};break;case"fillSketch":r=this.fillSketch(o,s);break}r&&i.push(r)}return i}fillSketch(t,e){let s=e.fillWeight;return s<0&&(s=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||ye,strokeWidth:s,fill:ye}}_mergedShape(t){return t.filter((e,s)=>s===0?!0:e.op!=="move")}}class _h{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new Yi(e)}draw(t){const e=t.sets||[],s=t.options||this.getDefaultOptions(),i=this.ctx,o=t.options.fixedDecimalPlaceDigits;for(const r of e)switch(r.type){case"path":i.save(),i.strokeStyle=s.stroke==="none"?"transparent":s.stroke,i.lineWidth=s.strokeWidth,s.strokeLineDash&&i.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(i.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(i,r,o),i.restore();break;case"fillPath":{i.save(),i.fillStyle=s.fill||"";const a=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(i,r,o,a),i.restore();break}case"fillSketch":this.fillSketch(i,r,s);break}}fillSketch(t,e,s){let i=s.fillWeight;i<0&&(i=s.strokeWidth/2),t.save(),s.fillLineDash&&t.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(t.lineDashOffset=s.fillLineDashOffset),t.strokeStyle=s.fill||"",t.lineWidth=i,this._drawToContext(t,e,s.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,s,i="nonzero"){t.beginPath();for(const o of e.ops){const r=typeof s=="number"&&s>=0?o.data.map(a=>+a.toFixed(s)):o.data;switch(o.op){case"move":t.moveTo(r[0],r[1]);break;case"bcurveTo":t.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"lineTo":t.lineTo(r[0],r[1]);break}}e.type==="fillPath"?t.fill(i):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,s,i,o){const r=this.gen.line(t,e,s,i,o);return this.draw(r),r}rectangle(t,e,s,i,o){const r=this.gen.rectangle(t,e,s,i,o);return this.draw(r),r}ellipse(t,e,s,i,o){const r=this.gen.ellipse(t,e,s,i,o);return this.draw(r),r}circle(t,e,s,i){const o=this.gen.circle(t,e,s,i);return this.draw(o),o}linearPath(t,e){const s=this.gen.linearPath(t,e);return this.draw(s),s}polygon(t,e){const s=this.gen.polygon(t,e);return this.draw(s),s}arc(t,e,s,i,o,r,a=!1,l){const c=this.gen.arc(t,e,s,i,o,r,a,l);return this.draw(c),c}curve(t,e){const s=this.gen.curve(t,e);return this.draw(s),s}path(t,e){const s=this.gen.path(t,e);return this.draw(s),s}}const li="http://www.w3.org/2000/svg";class Bh{constructor(t,e){this.svg=t,this.gen=new Yi(e)}draw(t){const e=t.sets||[],s=t.options||this.getDefaultOptions(),i=this.svg.ownerDocument||window.document,o=i.createElementNS(li,"g"),r=t.options.fixedDecimalPlaceDigits;for(const a of e){let l=null;switch(a.type){case"path":{l=i.createElementNS(li,"path"),l.setAttribute("d",this.opsToPath(a,r)),l.setAttribute("stroke",s.stroke),l.setAttribute("stroke-width",s.strokeWidth+""),l.setAttribute("fill","none"),s.strokeLineDash&&l.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${s.strokeLineDashOffset}`);break}case"fillPath":{l=i.createElementNS(li,"path"),l.setAttribute("d",this.opsToPath(a,r)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",s.fill||""),(t.shape==="curve"||t.shape==="polygon")&&l.setAttribute("fill-rule","evenodd");break}case"fillSketch":{l=this.fillSketch(i,a,s);break}}l&&o.appendChild(l)}return o}fillSketch(t,e,s){let i=s.fillWeight;i<0&&(i=s.strokeWidth/2);const o=t.createElementNS(li,"path");return o.setAttribute("d",this.opsToPath(e,s.fixedDecimalPlaceDigits)),o.setAttribute("stroke",s.fill||""),o.setAttribute("stroke-width",i+""),o.setAttribute("fill","none"),s.fillLineDash&&o.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&o.setAttribute("stroke-dashoffset",`${s.fillLineDashOffset}`),o}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,s,i,o){const r=this.gen.line(t,e,s,i,o);return this.draw(r)}rectangle(t,e,s,i,o){const r=this.gen.rectangle(t,e,s,i,o);return this.draw(r)}ellipse(t,e,s,i,o){const r=this.gen.ellipse(t,e,s,i,o);return this.draw(r)}circle(t,e,s,i){const o=this.gen.circle(t,e,s,i);return this.draw(o)}linearPath(t,e){const s=this.gen.linearPath(t,e);return this.draw(s)}polygon(t,e){const s=this.gen.polygon(t,e);return this.draw(s)}arc(t,e,s,i,o,r,a=!1,l){const c=this.gen.arc(t,e,s,i,o,r,a,l);return this.draw(c)}curve(t,e){const s=this.gen.curve(t,e);return this.draw(s)}path(t,e){const s=this.gen.path(t,e);return this.draw(s)}}const qe={canvas(n,t){return new _h(n,t)},svg(n,t){return new Bh(n,t)},generator(n){return new Yi(n)},newSeed(){return Yi.newSeed()}},wn=(n,t,e)=>{if((n.type==="line"||n.type==="arrow")&&n.endBinding){const o=n.endBinding.elementId,r=e?e.get(o):t.find(a=>a.id===o);if(r&&wn(r,t,e))return!0}if(!n.parentId)return!1;let s=n.parentId;const i=new Set;for(;s&&!i.has(s);){i.add(s);const o=s,r=e?e.get(o):t.find(a=>a.id===o);if(!r)break;if(r.isCollapsed)return!0;s=r.parentId||null}return!1},go=(n,t)=>{const e=[],s=[n],i=new Set;for(;s.length>0;){const o=s.shift();if(i.has(o))continue;i.add(o);const r=t.filter(a=>a.parentId===o);e.push(...r),s.push(...r.map(a=>a.id))}return e};class zh{renderers=new Map;register(t,e){this.renderers.set(t,e)}getRenderer(t){return this.renderers.get(t)}}const qt=new zh,Yt=n=>{if(!n||n.length===0)return[];if(typeof n[0]=="number"){const t=[];for(let e=0;e<n.length-1;e+=2)t.push({x:n[e],y:n[e+1]});return t}return n},ci=(n,t,e,s,i)=>{const o=1-i;return o*o*o*n+3*o*o*i*t+3*o*i*i*e+i*i*i*s},_e=(n,t,e,s=!1,i=1)=>{const o=qt.getRenderer(e.type);if(o){o.render({rc:n,ctx:t,element:e,isDarkMode:s,layerOpacity:i});return}console.warn(`No renderer registered for element type: ${e.type}`)},Wh=(n,t)=>{let e=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const o=t[s].x,r=t[s].y,a=t[i].x,l=t[i].y;r>n.y!=l>n.y&&n.x<(a-o)*(n.y-r)/(l-r)+o&&(e=!e)}return e},zo=(n,t,e)=>{const s=n.x,i=n.y,o=t.x,r=t.y,a=e.x,l=e.y,c=s-o,d=i-r,h=a-o,p=l-r,y=c*h+d*p,m=h*h+p*p;let g=-1;m!==0&&(g=y/m);let w,x;g<0?(w=o,x=r):g>1?(w=a,x=l):(w=o+g*h,x=r+g*p);const b=s-w,S=i-x;return Math.sqrt(b*b+S*S)},Hi=(n,t,e,s,i)=>{const o=1-i;return o*o*o*n+3*o*o*i*t+3*o*i*i*e+i*i*i*s},Xh=(n,t,e,s,i)=>{const o=3*(1-i)*(1-i)*(t.x-n.x)+6*(1-i)*i*(e.x-t.x)+3*i*i*(s.x-e.x),r=3*(1-i)*(1-i)*(t.y-n.y)+6*(1-i)*i*(e.y-t.y)+3*i*i*(s.y-e.y);return Math.atan2(r,o)},Ys=(n,t,e,s,i)=>{const r=Math.max(i*8,4),a=Math.max(i*2,2),l=[],c=[];for(let d=0;d<=20;d++){const h=d/20,p=Hi(n.x,e.x,s.x,t.x,h),y=Hi(n.y,e.y,s.y,t.y,h),m=Xh(n,e,s,t,h),w=(r+(a-r)*h)/2,x=Math.cos(m+Math.PI/2)*w,b=Math.sin(m+Math.PI/2)*w;l.push({x:p+x,y:y+b}),c.push({x:p-x,y:y-b})}return[...l,...c.reverse()]},Yh=(n,t,e,s,i=20)=>{const o=[];for(let r=0;r<=i;r++){const a=r/i;o.push({x:Hi(n.x,t.x,e.x,s.x,a),y:Hi(n.y,t.y,e.y,s.y,a)})}return o},di=(n,t,e,s,i,o)=>{const r=Yh(t,e,s,i,20);return Pi(n,r,o)},Pi=(n,t,e)=>{if(t.length<2)return!1;for(let s=0;s<t.length-1;s++)if(zo(n,t[s],t[s+1])<=e)return!0;return!1},Hh=(n,t,e,s,i,o=0)=>{const r=Math.abs(s/2)+o,a=Math.abs(i/2)+o,l=t+s/2,c=e+i/2;return r<=0||a<=0?!1:Math.pow(n.x-l,2)/Math.pow(r,2)+Math.pow(n.y-c,2)/Math.pow(a,2)<=1},ue=(n,t,e,s,i)=>{const o=Math.cos(i),r=Math.sin(i);return{x:o*(n-e)-r*(t-s)+e,y:r*(n-e)+o*(t-s)+s}},mo=(n,t,e=0)=>{const s=n.x+n.width/2,i=n.y+n.height/2;if(n.type==="rectangle"||n.type==="image"||n.type==="text"){let o={x:t.x,y:t.y};n.angle&&(o=ue(t.x,t.y,s,i,-n.angle));const r=n.width,a=n.height,l=s-r/2-e,c=s+r/2+e,d=i-a/2-e,h=i+a/2+e,p=o.x-s,y=o.y-i;if(p===0&&y===0)return{x:s,y:i};let m=1/0;if(p!==0){const x=(l-s)/p;x>0&&(m=Math.min(m,x));const b=(c-s)/p;b>0&&(m=Math.min(m,b))}if(y!==0){const x=(d-i)/y;x>0&&(m=Math.min(m,x));const b=(h-i)/y;b>0&&(m=Math.min(m,b))}if(m===1/0)return null;const g=s+p*m,w=i+y*m;return n.angle?ue(g,w,s,i,n.angle):{x:g,y:w}}else if(n.type==="circle"){const o=n.width/2+e,r=n.height/2+e;let a={x:t.x,y:t.y};n.angle&&(a=ue(t.x,t.y,s,i,-n.angle));const l=a.x-s,c=a.y-i;if(l===0&&c===0)return null;const d=l*l/(o*o)+c*c/(r*r),h=1/Math.sqrt(d),p=s+l*h,y=i+c*h;return n.angle?ue(p,y,s,i,n.angle):{x:p,y}}else if(n.type==="diamond"){let o={x:t.x,y:t.y};n.angle&&(o=ue(t.x,t.y,s,i,-n.angle));const r=n.width/2+e,a=n.height/2+e,l=o.x-s,c=o.y-i;if(l===0&&c===0)return{x:s,y:i};const d=Math.atan2(c,l),h=Math.abs(Math.tan(d)),p=1/(1/r+h/a),y=s+(l>0?1:-1)*p,m=i+(l>0?1:-1)*p*Math.tan(d);return n.angle?ue(y,m,s,i,n.angle):{x:y,y:m}}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"||n.type==="cloud"||n.type==="heart"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="fineliner"||n.type==="inkbrush"||n.type==="marker"){let o={x:t.x,y:t.y};n.angle&&(o=ue(t.x,t.y,s,i,-n.angle));const r=n.width,a=n.height,l=s-r/2-e,c=s+r/2+e,d=i-a/2-e,h=i+a/2+e,p=o.x-s,y=o.y-i;if(p===0&&y===0)return{x:s,y:i};let m=1/0;if(p!==0){const x=(l-s)/p;x>0&&(m=Math.min(m,x));const b=(c-s)/p;b>0&&(m=Math.min(m,b))}if(y!==0){const x=(d-i)/y;x>0&&(m=Math.min(m,x));const b=(h-i)/y;b>0&&(m=Math.min(m,b))}if(m===1/0)return null;const g=s+p*m,w=i+y*m;return n.angle?ue(g,w,s,i,n.angle):{x:g,y:w}}return null};function $i(n){const t=n.x+n.width/2,e=n.y+n.height/2,s=n.width,i=n.height;let o=[];if(n.type==="rectangle"||n.type==="image"||n.type==="text"){const r=[{x:t-s/2,y:e-i/2,position:"top-left"},{x:t+s/2,y:e-i/2,position:"top-right"},{x:t-s/2,y:e+i/2,position:"bottom-left"},{x:t+s/2,y:e+i/2,position:"bottom-right"},{x:t,y:e-i/2,position:"top"},{x:t+s/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-s/2,y:e,position:"left"}];n.angle?o=r.map(a=>({...ue(a.x,a.y,t,e,n.angle),position:a.position})):o=r}else if(n.type==="circle"){const r=s/2,a=i/2,l=[{x:t,y:e-a,position:"top"},{x:t+r,y:e,position:"right"},{x:t,y:e+a,position:"bottom"},{x:t-r,y:e,position:"left"}];n.angle?o=l.map(c=>({...ue(c.x,c.y,t,e,n.angle),position:c.position})):o=l}else if(n.type==="diamond"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+s/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-s/2,y:e,position:"left"}];n.angle?o=r.map(a=>({...ue(a.x,a.y,t,e,n.angle),position:a.position})):o=r}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+s/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-s/2,y:e,position:"left"}];n.angle?o=r.map(a=>({...ue(a.x,a.y,t,e,n.angle),position:a.position})):o=r}else if(n.type==="cloud"||n.type==="heart"||n.type==="checkmark"||n.type==="cross"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+s/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-s/2,y:e,position:"left"}];n.angle?o=r.map(a=>({...ue(a.x,a.y,t,e,n.angle),position:a.position})):o=r}else{const r=[{x:t,y:e-i/2,position:"top"},{x:t+s/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-s/2,y:e,position:"left"}];n.angle?o=r.map(a=>({...ue(a.x,a.y,t,e,n.angle),position:a.position})):o=r}return o}function Nh(n,t,e=15){const s=$i(n);let i=null,o=e;for(const r of s){const a=r.x-t.x,l=r.y-t.y,c=Math.sqrt(a*a+l*l);c<o&&(o=c,i=r)}return i}const xo=(n,t,e,s)=>{const i=[{x:n.x,y:n.y}],o=20;if(!e&&!s){const h=(n.x+t.x)/2;return i.push({x:h,y:n.y}),i.push({x:h,y:t.y}),i.push({x:t.x,y:t.y}),Wo(i)}const r=(h,p)=>p==="top"?{x:h.x,y:h.y-o}:p==="bottom"?{x:h.x,y:h.y+o}:p==="left"?{x:h.x-o,y:h.y}:p==="right"?{x:h.x+o,y:h.y}:h;let a=n;e&&(a=r(n,e),i.push(a));let l=t;s&&(l=r(t,s));const c=h=>h==="top"||h==="bottom",d=h=>h==="left"||h==="right";return c(s)?i.push({x:l.x,y:a.y}):d(s)?i.push({x:a.x,y:l.y}):c(e)?i.push({x:t.x,y:a.y}):d(e)?i.push({x:a.x,y:t.y}):Math.abs(t.y-n.y)>Math.abs(t.x-n.x)?i.push({x:a.x,y:t.y}):i.push({x:t.x,y:a.y}),s&&i.push(l),i.push({x:t.x,y:t.y}),Wo(i)},Wo=n=>{if(n.length<2)return n;const t=[n[0]];for(let e=1;e<n.length;e++){const s=t[t.length-1],i=n[e];if(!(Math.abs(s.x-i.x)<.1&&Math.abs(s.y-i.y)<.1)){if(t.length>=2){const o=t[t.length-2];if(Math.abs(o.x-s.x)<.1&&Math.abs(s.x-i.x)<.1||Math.abs(o.y-s.y)<.1&&Math.abs(s.y-i.y)<.1){t[t.length-1]=i;continue}}t.push(i)}}return t},Fh=(n,t,e,s,i,o,r)=>{const c=e.filter(D=>{if(D.type==="line"||D.type==="arrow"||D.type==="text")return!1;const Q=Math.min(n.x,t.x)-100,ot=Math.max(n.x,t.x)+100,st=Math.min(n.y,t.y)-100,ht=Math.max(n.y,t.y)+100;return!(D.x>ot||D.x+D.width<Q||D.y>ht||D.y+D.height<st)});if(c.length===0)return xo(n,t,o,r);const d=new Set([n.x,t.x]),h=new Set([n.y,t.y]);c.forEach(D=>{const Q=D.x-15,ot=D.x+D.width+15,st=D.y-15,ht=D.y+D.height+15;d.add(Q),d.add(ot),h.add(st),h.add(ht),d.add(D.x+D.width/2),h.add(D.y+D.height/2)});const p=(D,Q)=>{Q&&(Q==="top"&&(d.add(D.x),h.add(D.y-20)),Q==="bottom"&&(d.add(D.x),h.add(D.y+20)),Q==="left"&&(d.add(D.x-20),h.add(D.y)),Q==="right"&&(d.add(D.x+20),h.add(D.y)))};p(n,o),p(t,r);const y=Array.from(d).sort((D,Q)=>D-Q),m=Array.from(h).sort((D,Q)=>D-Q),g=y.findIndex(D=>Math.abs(D-n.x)<.1),w=m.findIndex(D=>Math.abs(D-n.y)<.1),x=y.findIndex(D=>Math.abs(D-t.x)<.1),b=m.findIndex(D=>Math.abs(D-t.y)<.1);if(g===-1||w===-1||x===-1||b===-1)return xo(n,t,o,r);const S=[{gx:g,gy:w,g:0,h:Math.abs(n.x-t.x)+Math.abs(n.y-t.y),parent:null,dir:null}],P=new Set,R=(D,Q,ot)=>c.some(st=>st.id===ot?!1:D>st.x+1&&D<st.x+st.width-1&&Q>st.y+1&&Q<st.y+st.height-1),B=(D,Q,ot,st)=>{const ht=(D+ot)/2,pt=(Q+st)/2;return c.some(mt=>{const _t=mt.id===s?.id||mt.id===i?.id?3:1;return ht>mt.x+_t&&ht<mt.x+mt.width-_t&&pt>mt.y+_t&&pt<mt.y+mt.height-_t})};let U=0;for(;S.length>0&&U<800;){U++,S.sort((ot,st)=>ot.g+ot.h-(st.g+st.h));const D=S.shift();if(D.gx===x&&D.gy===b){const ot=[];let st=D;for(;st;)ot.push({x:y[st.gx],y:m[st.gy]}),st=st.parent;return Wo(ot.reverse())}P.add(`${D.gx},${D.gy}`);const Q=[{dx:-1,dy:0,dir:"h",name:"left"},{dx:1,dy:0,dir:"h",name:"right"},{dx:0,dy:-1,dir:"v",name:"top"},{dx:0,dy:1,dir:"v",name:"bottom"}];for(const ot of Q){const st=D.gx+ot.dx,ht=D.gy+ot.dy;if(st<0||st>=y.length||ht<0||ht>=m.length||P.has(`${st},${ht}`))continue;const pt=Qt=>["top","bottom","left","right"].includes(Qt||"");if(D.gx===g&&D.gy===w&&pt(o)&&ot.name!==o)continue;if(st===x&&ht===b&&pt(r)){const Qt={top:"bottom",bottom:"top",left:"right",right:"left"}[r];if(ot.name!==Qt)continue}const mt=y[D.gx],At=m[D.gy],_t=y[st],rt=m[ht];if(B(mt,At,_t,rt))continue;const ft=Math.abs(_t-mt)+Math.abs(rt-At),Rt=D.dir&&D.dir!==ot.dir?100:0,Dt=R(_t,rt)?500:0,jt=D.g+ft+Rt+Dt,It=S.find(Qt=>Qt.gx===st&&Qt.gy===ht);It?jt<It.g&&(It.g=jt,It.parent=D,It.dir=ot.dir):S.push({gx:st,gy:ht,g:jt,h:Math.abs(_t-t.x)+Math.abs(rt-t.y),parent:D,dir:ot.dir})}}return xo(n,t,o,r)};var Uh=it("<div class=context-menu>"),Gh=it("<span class=menu-item-icon style=font-size:20px;line-height:1>"),qh=it("<span class=menu-item-shortcut>"),jh=it("<span class=menu-item-arrow>"),Qh=it("<button><span class=menu-item-check>"),Vh=it("<div class=menu-item-wrapper style=position:relative>"),Jh=it("<div class=context-menu-separator>"),Kh=it("<span class=menu-item-label>");const ml=n=>{let t;const[e,s]=wt({x:n.x,y:n.y}),[i,o]=wt(null);rn(()=>{if(!n.parent){if(t){const d=t.getBoundingClientRect(),h=window.innerWidth,p=window.innerHeight;let y=n.x,m=n.y;n.x+d.width>h&&(y=h-d.width-10),n.y+d.height>p&&(m=p-d.height-10),s({x:y,y:m})}const l=d=>{d.target.closest(".context-menu")||n.onClose()},c=d=>{d.key==="Escape"&&n.onClose()};document.addEventListener("mousedown",l),document.addEventListener("keydown",c),te(()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",c)})}});const r=(l,c)=>{l.disabled||l.separator||(l.submenu?o(i()===c?null:c):(l.onClick?.(),n.onClose()))},a=l=>{n.items[l].submenu?o(l):o(null)};return(()=>{var l=Uh(),c=t;return typeof c=="function"?Ot(c,l):t=l,F(l,E(tn,{get each(){return n.items},children:(d,h)=>(()=>{var p=Vh();return p.addEventListener("mouseenter",()=>a(h())),F(p,E(vt,{get when(){return!d.separator},get fallback(){return Jh()},get children(){return[(()=>{var y=Qh(),m=y.firstChild;return y.$$click=()=>r(d,h()),F(m,()=>d.checked?"":""),F(y,E(vt,{get when(){return d.icon},get fallback(){return(()=>{var g=Kh();return F(g,()=>d.label),g})()},get children(){var g=Gh();return F(g,()=>d.icon),g}}),null),F(y,E(vt,{get when(){return d.shortcut},get children(){var g=qh();return F(g,()=>d.shortcut),g}}),null),F(y,E(vt,{get when(){return d.submenu},get children(){return jh()}}),null),gt(g=>{var w=`context-menu-item ${d.disabled?"disabled":""} ${i()===h()?"active":""}`,x=d.disabled,b=d.tooltip||d.label;return w!==g.e&&Ht(y,g.e=w),x!==g.t&&(y.disabled=g.t=x),b!==g.a&&xt(y,"title",g.a=b),g},{e:void 0,t:void 0,a:void 0}),y})(),E(vt,{get when(){return On(()=>!!d.submenu)()&&i()===h()},get children(){return E(ml,{get x(){const y=t?.querySelector(`.menu-item-wrapper:nth-child(${h()+1}) button`)?.getBoundingClientRect();return y?y.right:0},get y(){const y=t?.querySelector(`.menu-item-wrapper:nth-child(${h()+1}) button`)?.getBoundingClientRect();return y?y.top:0},get items(){return d.submenu},get onClose(){return n.onClose},parent:!1,get gridColumns(){return d.gridColumns}})}})]}})),p})()})),gt(d=>{var h=n.parent?"100%":`${e().x}px`,p=n.parent?"0":`${e().y}px`,y=n.parent?"absolute":"fixed",m=n.parent?"-4px":"0",g=n.gridColumns?"grid":"block",w=n.gridColumns?`repeat(${n.gridColumns}, 1fr)`:void 0,x=n.gridColumns?"4px":void 0,b=n.gridColumns?"8px":void 0;return h!==d.e&&Ft(l,"left",d.e=h),p!==d.t&&Ft(l,"top",d.t=p),y!==d.a&&Ft(l,"position",d.a=y),m!==d.o&&Ft(l,"margin-left",d.o=m),g!==d.i&&Ft(l,"display",d.i=g),w!==d.n&&Ft(l,"grid-template-columns",d.n=w),x!==d.s&&Ft(l,"gap",d.s=x),b!==d.h&&Ft(l,"padding",d.h=b),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),l})()};Kt(["click"]);const Hs=(n,t)=>Math.round(n/t)*t,wo=(n,t,e)=>({x:Hs(n,e),y:Hs(t,e)}),bo=new Map,hi=new Set;let Xo=null;const Zh=n=>{Xo=n},tu=n=>{if(bo.has(n))return bo.get(n);if(!hi.has(n)){hi.add(n);const t=new Image;t.src=n,t.onload=()=>{bo.set(n,t),hi.delete(n),Xo&&Xo()},t.onerror=()=>{hi.delete(n)}}return null},eu=(n,t,e,s,i)=>{const o=t.filter(P=>n.includes(P.id));if(o.length===0)return{dx:e,dy:s,guides:[]};const r=Math.min(...o.map(P=>P.x))+e,a=Math.max(...o.map(P=>P.x+P.width))+e,l=Math.min(...o.map(P=>P.y))+s,c=Math.max(...o.map(P=>P.y+P.height))+s,d=(r+a)/2,h=(l+c)/2,p=[r,d,a],y=[l,h,c],m=[];let g=0,w=0,x=i+1,b=i+1;const S=t.filter(P=>!n.includes(P.id)&&P.layerId===o[0].layerId);for(const P of S){const R=P.x,B=P.x+P.width,U=(R+B)/2,D=[R,U,B],Q=P.y,ot=P.y+P.height,st=(Q+ot)/2,ht=[Q,st,ot];for(const pt of p)for(const mt of D){const At=Math.abs(pt-mt);At<x&&(x=At,g=mt-pt)}for(const pt of y)for(const mt of ht){const At=Math.abs(pt-mt);At<b&&(b=At,w=mt-pt)}}if(x<=i)for(const P of S){const R=P.x,B=P.x+P.width,U=(R+B)/2,D=[R,U,B];for(const Q of p)for(const ot of D)Math.abs(Q+g-ot)<.1&&m.push({type:"vertical",coordinate:ot,elementIds:[P.id]})}if(b<=i)for(const P of S){const R=P.y,B=P.y+P.height,U=(R+B)/2,D=[R,U,B];for(const Q of y)for(const ot of D)Math.abs(Q+w-ot)<.1&&m.push({type:"horizontal",coordinate:ot,elementIds:[P.id]})}return{dx:e+(x<=i?g:0),dy:s+(b<=i?w:0),guides:m}},nu=(n,t,e,s,i)=>{const o=t.filter(b=>n.includes(b.id));if(o.length===0)return{dx:e,dy:s,guides:[]};let r={minX:Math.min(...o.map(b=>b.x))+e,maxX:Math.max(...o.map(b=>b.x+b.width))+e,minY:Math.min(...o.map(b=>b.y))+s,maxY:Math.max(...o.map(b=>b.y+b.height))+s,centerX:0,centerY:0};r.centerX=(r.minX+r.maxX)/2,r.centerY=(r.minY+r.maxY)/2;const a=t.filter(b=>!n.includes(b.id)&&b.layerId===o[0].layerId).map(b=>({...b,minX:b.x,maxX:b.x+b.width,minY:b.y,maxY:b.y+b.height,centerX:b.x+b.width/2,centerY:b.y+b.height/2}));if(a.length<2)return{dx:e,dy:s,guides:[]};let l=0,c=0,d=i+1,h=i+1;const p=[],y=(b,S)=>Math.max(0,Math.min(b.maxY,S.maxY)-Math.max(b.minY,S.minY))>0;for(let b=0;b<a.length;b++){const S=a[b];if(y(r,S))for(let P=b+1;P<a.length;P++){const R=a[P];if(!y(r,R)||!y(S,R))continue;const B=[{id:"active",...r},S,R];B.sort((pt,mt)=>pt.minX-mt.minX);const[U,D,Q]=B,ot=D.minX-U.maxX,st=Q.minX-D.maxX;let ht=0;U.id==="active"?ht=D.minX-st-U.maxX:D.id==="active"?ht=(U.maxX+Q.minX)/2-D.centerX:Q.id==="active"&&(ht=D.maxX+ot-Q.minX),Math.abs(ht)<d&&(d=Math.abs(ht),l=ht),p.push({type:"gap",orientation:"horizontal",gap:(ot+st)/2,start:U.maxX,variableCoordinate:(U.centerY+D.centerY+Q.centerY)/3,elements:[U.id,D.id,Q.id],segments:[{from:U.maxX,to:D.minX},{from:D.maxX,to:Q.minX}],_correction:ht})}}const m=(b,S)=>Math.max(0,Math.min(b.maxX,S.maxX)-Math.max(b.minX,S.minX))>0;for(let b=0;b<a.length;b++){const S=a[b];if(m(r,S))for(let P=b+1;P<a.length;P++){const R=a[P];if(!m(r,R)||!m(S,R))continue;const B=[{id:"active",...r},S,R];B.sort((pt,mt)=>pt.minY-mt.minY);const[U,D,Q]=B,ot=D.minY-U.maxY,st=Q.minY-D.maxY;let ht=0;U.id==="active"?ht=D.minY-st-U.maxY:D.id==="active"?ht=(U.maxY+Q.minY)/2-D.centerY:Q.id==="active"&&(ht=D.maxY+ot-Q.minY),Math.abs(ht)<h&&(h=Math.abs(ht),c=ht),p.push({type:"gap",orientation:"vertical",gap:(ot+st)/2,start:U.maxY,variableCoordinate:(U.centerX+D.centerX+Q.centerX)/3,elements:[U.id,D.id,Q.id],segments:[{from:U.maxY,to:D.minY},{from:D.maxY,to:Q.minY}],_correction:ht})}}const g=d<=i?l:0,w=h<=i?c:0,x=p.filter(b=>b.orientation==="horizontal"?g!==0&&Math.abs(b._correction-g)<.1:w!==0&&Math.abs(b._correction-w)<.1);return x.forEach(b=>delete b._correction),{dx:e+g,dy:s+w,guides:x}};var iu=it('<div class=minimap-container><div class=minimap-header><span class=minimap-title>Navigator</span><button class=minimap-close title="Close minimap (Alt+M)"></button></div><canvas width=200 height=150 class=minimap-canvas>');const ou=n=>{let t,e,s=!1;const i=200,o=150,r=10,a=()=>{if(f.elements.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800,width:1e3,height:800};let m=1/0,g=1/0,w=-1/0,x=-1/0;f.elements.forEach(S=>{m=Math.min(m,S.x),w=Math.max(w,S.x+S.width),g=Math.min(g,S.y),x=Math.max(x,S.y+S.height)});const b=50;return m-=b,g-=b,w+=b,x+=b,{minX:m,minY:g,maxX:w,maxY:x,width:w-m,height:x-g}},l=m=>{const g=(i-r*2)/m.width,w=(o-r*2)/m.height;return Math.min(g,w)},c=m=>{if(!t)return;const g=t.getContext("2d");if(!g)return;const w=a(),x=l(w);g.clearRect(0,0,i,o);const b=f.theme==="dark";let S=f.canvasBackgroundColor;S||(S=b?"#121212":"#fafafa"),g.fillStyle=S,g.fillRect(0,0,i,o),g.save(),g.translate(r,r),g.scale(x,x),g.translate(-w.minX,-w.minY),f.elements.forEach(ht=>{const pt=f.layers.find(mt=>mt.id===ht.layerId);pt?.visible&&_e(m,g,ht,f.theme==="dark",pt?.opacity??1)}),g.restore();const P=-f.viewState.panX/f.viewState.scale,R=-f.viewState.panY/f.viewState.scale,B=n.canvasWidth/f.viewState.scale,U=n.canvasHeight/f.viewState.scale,D=(P-w.minX)*x+r,Q=(R-w.minY)*x+r,ot=B*x,st=U*x;g.save(),g.strokeStyle=f.theme==="dark"?"#60a5fa":"#3b82f6",g.lineWidth=2,g.fillStyle=f.theme==="dark"?"rgba(96, 165, 250, 0.1)":"rgba(59, 130, 246, 0.1)",g.fillRect(D,Q,ot,st),g.strokeRect(D,Q,ot,st),g.restore()},d=m=>{if(s)return;const g=t?.getBoundingClientRect();if(!g)return;const w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=l(b),P=(w-r)/S+b.minX,R=(x-r)/S+b.minY;Zt({panX:-P*f.viewState.scale+n.canvasWidth/2,panY:-R*f.viewState.scale+n.canvasHeight/2})},h=m=>{if(!t)return;const g=t.getBoundingClientRect(),w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=l(b),P=-f.viewState.panX/f.viewState.scale,R=-f.viewState.panY/f.viewState.scale,B=n.canvasWidth/f.viewState.scale,U=n.canvasHeight/f.viewState.scale,D=(P-b.minX)*S+r,Q=(R-b.minY)*S+r,ot=B*S,st=U*S;w>=D&&w<=D+ot&&x>=Q&&x<=Q+st&&(s=!0,t.setPointerCapture(m.pointerId))},p=m=>{if(!s||!t)return;const g=t.getBoundingClientRect(),w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=l(b),P=(w-r)/S+b.minX,R=(x-r)/S+b.minY;Zt({panX:-P*f.viewState.scale+n.canvasWidth/2,panY:-R*f.viewState.scale+n.canvasHeight/2})},y=m=>{s&&t&&(t.releasePointerCapture(m.pointerId),s=!1)};return Ut(()=>{if(!t)return;const m=Mo.canvas(t);f.elements.forEach(x=>{if(x.points?.length,x.x,x.y,x.width,x.height,x.opacity,x.layerId,x.strokeColor,x.backgroundColor,x.renderStyle,x.points){const b=Yt(x.points);if(b.length>0){const S=b[b.length-1];S.x,S.y}}}),f.viewState.panX,f.viewState.panY,f.viewState.scale,f.theme,f.layers.forEach(x=>{x.visible,x.opacity});const w=requestAnimationFrame(()=>c(m));te(()=>cancelAnimationFrame(w))}),rn(()=>{if(t&&(t.addEventListener("click",d),t.addEventListener("pointerdown",h),t.addEventListener("pointermove",p),t.addEventListener("pointerup",y),t.addEventListener("pointercancel",y)),te(()=>{t&&(t.removeEventListener("click",d),t.removeEventListener("pointerdown",h),t.removeEventListener("pointermove",p),t.removeEventListener("pointerup",y),t.removeEventListener("pointercancel",y))}),t){const m=Mo.canvas(t);c(m)}}),(()=>{var m=iu(),g=m.firstChild,w=g.firstChild,x=w.nextSibling,b=g.nextSibling,S=e;typeof S=="function"?Ot(S,m):e=m,x.$$click=()=>Ki(!1),F(x,E(qo,{size:14}));var P=t;return typeof P=="function"?Ot(P,b):t=b,m})()};Kt(["click"]);const to=async()=>{if(f.selection.length===0)return;const t={type:"yappy-elements",elements:f.elements.filter(e=>f.selection.includes(e.id))};try{await navigator.clipboard.writeText(JSON.stringify(t))}catch(e){console.error("Failed to copy: ",e)}},Ms=async()=>{await to(),Ue(f.selection)},Ni=async()=>{try{const n=await navigator.clipboard.readText();if(!n)return;const t=JSON.parse(n);if(t.type==="yappy-elements"&&Array.isArray(t.elements)){Pt();const e=[],s=-f.viewState.panX/f.viewState.scale+window.innerWidth/2/f.viewState.scale,i=-f.viewState.panY/f.viewState.scale+window.innerHeight/2/f.viewState.scale;let o=1/0,r=1/0,a=-1/0,l=-1/0;t.elements.forEach(y=>{o=Math.min(o,y.x),r=Math.min(r,y.y),a=Math.max(a,y.x+y.width),l=Math.max(l,y.y+y.height)});const c=o+(a-o)/2,d=r+(l-r)/2,h=s-c,p=i-d;t.elements.forEach(y=>{const m=fe(y.type),g={...y,id:m,x:y.x+h,y:y.y+p,layerId:f.activeLayerId,groupIds:[]};$("elements",w=>[...w,g]),e.push(m)}),$("selection",e)}}catch(n){console.error("Failed to paste: ",n)}},Ns=n=>{if(f.selection.length===0)return;Pt();let t=1/0,e=-1/0;f.elements.forEach(i=>{f.selection.includes(i.id)&&(n==="horizontal"?(t=Math.min(t,i.x),e=Math.max(e,i.x+i.width)):(t=Math.min(t,i.y),e=Math.max(e,i.y+i.height)))});const s=t+(e-t)/2;f.selection.forEach(i=>{const o=f.elements.find(r=>r.id===i);if(o)if(n==="horizontal"){const a=o.x+o.width/2-s,l=s-a-o.width/2;if(o.points){const c=Yt(o.points);if(c.length>0){const d=c.map(h=>({x:o.width-h.x,y:h.y}));nt(i,{x:l,points:d,pointsEncoding:void 0,seed:o.seed+1},!1)}else(!o.points||o.points.length===0)&&nt(i,{x:l,seed:o.seed+1},!1)}else nt(i,{x:l,seed:o.seed+1},!1)}else{const a=o.y+o.height/2-s,l=s-a-o.height/2;if(o.points){const c=Yt(o.points);if(c.length>0){const d=c.map(h=>({x:h.x,y:o.height-h.y}));nt(i,{y:l,points:d,pointsEncoding:void 0,seed:o.seed+1},!1)}else nt(i,{y:l,seed:o.seed+1},!1)}else nt(i,{y:l,seed:o.seed+1},!1)}})},su=n=>{f.selection.forEach(t=>{nt(t,{locked:n})})};let Yo=null;const Ps=()=>{if(f.selection.length!==1)return;const n=f.elements.find(t=>t.id===f.selection[0]);n&&(Yo={strokeColor:n.strokeColor,backgroundColor:n.backgroundColor,fillStyle:n.fillStyle,strokeWidth:n.strokeWidth,strokeStyle:n.strokeStyle,roughness:n.roughness,opacity:n.opacity,fontFamily:n.fontFamily,fontSize:n.fontSize,textAlign:n.textAlign,roundness:n.roundness,gradientStart:n.gradientStart,gradientEnd:n.gradientEnd,gradientDirection:n.gradientDirection,gradientStops:n.gradientStops?JSON.parse(JSON.stringify(n.gradientStops)):void 0,gradientType:n.gradientType,gradientHandlePositions:n.gradientHandlePositions?JSON.parse(JSON.stringify(n.gradientHandlePositions)):void 0,shadowEnabled:n.shadowEnabled,shadowColor:n.shadowColor,shadowBlur:n.shadowBlur,shadowOffsetX:n.shadowOffsetX,shadowOffsetY:n.shadowOffsetY,drawInnerBorder:n.drawInnerBorder,innerBorderColor:n.innerBorderColor,innerBorderDistance:n.innerBorderDistance,strokeLineJoin:n.strokeLineJoin,fillDensity:n.fillDensity,renderStyle:n.renderStyle,flowAnimation:n.flowAnimation,flowSpeed:n.flowSpeed,flowStyle:n.flowStyle})},$s=()=>{!Yo||f.selection.length===0||(Pt(),f.selection.forEach(n=>{nt(n,Yo)}))};class ru{frameCount=0;lastReportTime=0;slowFrames=0;totalDrawTime=0;enabled;constructor(t=!0){this.enabled=t,this.lastReportTime=performance.now()}measureFrame(t,e,s){if(!this.enabled)return;this.frameCount++,this.totalDrawTime+=t,t>16.67&&this.slowFrames++;const i=performance.now();if(i-this.lastReportTime>=1e3){const o=i-this.lastReportTime,r=this.frameCount/o*1e3,a=this.totalDrawTime/this.frameCount,l=s!==void 0?` | ${s} visible`:"";console.log(`[Perf] ${r.toFixed(1)} FPS | ${a.toFixed(2)}ms avg | ${e} elements${l} | ${this.slowFrames} slow frames`),this.frameCount=0,this.slowFrames=0,this.totalDrawTime=0,this.lastReportTime=i}}setEnabled(t){this.enabled=t}}const au=new ru(!1),eo=n=>{const t=n.fontSize||20,e=n.fontFamily==="sans-serif"?"Inter, sans-serif":n.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",s=n.fontWeight?typeof n.fontWeight=="string"?n.fontWeight+" ":"bold ":"";return`${n.fontStyle?typeof n.fontStyle=="string"?n.fontStyle+" ":"italic ":""}${s}${t}px ${e}`};let vo=null;const lu=()=>(vo||(vo=document.createElement("canvas").getContext("2d")),vo),cu=(n,t,e)=>{const s=t.split(/\s+/),i=[];let o="";for(const r of s){if(!r)continue;const a=o?`${o} ${r}`:r;n.measureText(a).width>e&&o?(i.push(o),o=r):o=a}return o&&i.push(o),i},xe=(n,t,e,s)=>{const i=t.fontSize||20;n.save(),n.font=eo(t);let o=s;t.type==="circle"||t.type==="diamond"?o=s*.707:t.type==="doubleBanner"?o=s*.65:t.type==="lightbulb"?o=s*.7:t.type==="signpost"?o=s*.8:t.type==="burstBlob"&&(o=s*.6);const r=e.split(`
`),a=[];r.forEach(d=>{if(d==="")a.push("");else{const h=cu(n,d,o);a.push(...h)}});const l=i*1.2;let c=0;return a.forEach(d=>{c=Math.max(c,n.measureText(d).width)}),n.restore(),{textWidth:c,textHeight:a.length*l,lines:a,lineHeight:l}},Fs=(n,t,e)=>{if(!e||e.trim()==="")return{width:t.width||100,height:t.height||60};const s=32,i=t.fontSize||20,o=e.length,r=Math.sqrt(o*i*i*1.5);let a=Math.max(60,Math.min(500,r)),l=xe(n,t,e,a);const c=t.type==="circle"||t.type==="diamond"?.707:t.type==="doubleBanner"?.65:t.type==="lightbulb"?.7:t.type==="signpost"?.8:t.type==="burstBlob"?.6:1;let d=l.textWidth/c+s,h=l.textHeight/c+s;if(t.type==="circle"||t.type==="diamond"){const p=Math.max(d,h);return{width:p,height:p}}return(t.type==="parallelogram"||t.type==="trapezoid")&&(d+=40),{width:d,height:h}},Us=(n,t,e=!0)=>{const s=f.elements.find(l=>l.id===n);if(!s||s.type===t)return;const i=l=>["line","arrow","bezier","organicBranch"].includes(l),o=i(s.type),r=i(t);if(o!==r){console.warn(`Cannot transform ${s.type} to ${t}: Incompatible families.`);return}const a={type:t};if(r)if(t==="bezier"||t==="organicBranch"){if(a.curveType="bezier",!s.controlPoints||s.controlPoints.length!==2){const l=s.x,c=s.y,d=s.x+s.width,h=s.y+s.height,p=d-l,y=h-c,m={x:l+p*.25,y:c+y*.1},g={x:d-p*.25,y:h-y*.1};a.controlPoints=[m,g]}}else(s.type==="bezier"||s.type==="organicBranch")&&(a.curveType="straight",a.controlPoints=void 0);nt(n,a,e)},Gs=n=>{const t=["line","arrow","bezier","organicBranch"],e=["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","cross","checkmark","capsule","stickyNote","callout","speechBubble","burst","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","mobilePhone","browserWindow"];return t.includes(n)?t.filter(s=>s!==n):e.includes(n)?e.filter(s=>s!==n):[]},qs=n=>({line:"",arrow:"",bezier:"",organicBranch:"",straight:"",elbow:"",rectangle:"",circle:"",diamond:"",triangle:"",hexagon:"",octagon:"",parallelogram:"",star:"",cloud:"",heart:"",cross:"",checkmark:"",database:"",document:"",predefinedProcess:"",internalStorage:"",server:"",loadBalancer:"",firewall:"",user:"",messageQueue:"",lambda:"",router:"",browser:"",capsule:"",stickyNote:"",callout:"",speechBubble:"",burst:"",trapezoid:"",rightTriangle:"",pentagon:"",septagon:"",browserWindow:"",mobilePhone:""})[n]||"",js=n=>n.charAt(0).toUpperCase()+n.slice(1).replace(/([A-Z])/g," $1"),du=n=>["straight","bezier","elbow"].filter(t=>t!==n),hu=n=>({straight:"",bezier:"",elbow:""})[n]||"",uu=n=>n.charAt(0).toUpperCase()+n.slice(1);function fu(n,t){const e=t.filter(a=>a.groupIds&&a.groupIds.includes(n));if(e.length===0)return null;let s=1/0,i=1/0,o=-1/0,r=-1/0;return e.forEach(a=>{const l=a.x,c=a.y,d=a.x+a.width,h=a.y+a.height;s=Math.min(s,l),i=Math.min(i,c),o=Math.max(o,d),r=Math.max(r,h)}),{x:s,y:i,width:o-s,height:r-i}}function pu(n,t,e,s){const i=fu(e,s);return i?n>=i.x&&n<=i.x+i.width&&t>=i.y&&t<=i.y+i.height:!1}function yu(n,t){const e=new Map;return n.forEach((s,i)=>{if(s.groupIds&&s.groupIds.length>0){const o=s.groupIds[s.groupIds.length-1];if(!e.has(o)){const r=t.find(a=>a.id===s.layerId);e.set(o,{layerOrder:r?.order??999,elementIndex:i})}}}),Array.from(e.entries()).map(([s,{layerOrder:i,elementIndex:o}])=>({groupId:s,layerOrder:i,elementIndex:o})).sort((s,i)=>s.layerOrder!==i.layerOrder?i.layerOrder-s.layerOrder:i.elementIndex-s.elementIndex)}const gu=async(n,t,e)=>{let s=f.elements;if(e){if(f.selection.length===0)return;s=s.filter(g=>f.selection.includes(g.id))}if(s.length===0)return;let i=1/0,o=1/0,r=-1/0,a=-1/0;s.forEach(g=>{i=Math.min(i,g.x),o=Math.min(o,g.y),r=Math.max(r,g.x+g.width),a=Math.max(a,g.y+g.height)});const l=20,c=r-i+l*2,d=a-o+l*2,h=document.createElement("canvas");h.width=c*n,h.height=d*n;const p=h.getContext("2d");if(!p)return;t&&(p.fillStyle="#ffffff",p.fillRect(0,0,h.width,h.height)),p.scale(n,n),p.translate(-i+l,-o+l);const y=qe.canvas(h);s.forEach(g=>{_e(y,p,g)});const m=document.createElement("a");m.download="yappy_drawing.png",m.href=h.toDataURL("image/png"),m.click()},mu=n=>{let t=f.elements;if(n){if(f.selection.length===0)return;t=t.filter(x=>f.selection.includes(x.id))}if(t.length===0)return;let e=1/0,s=1/0,i=-1/0,o=-1/0;t.forEach(x=>{e=Math.min(e,x.x),s=Math.min(s,x.y),i=Math.max(i,x.x+x.width),o=Math.max(o,x.y+x.height)});const r=20,a=i-e+r*2,l=o-s+r*2,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",`${a}`),c.setAttribute("height",`${l}`),c.setAttribute("viewBox",`0 0 ${a} ${l}`),c.style.backgroundColor="#ffffff";const d=qe.svg(c),h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("transform",`translate(${-e+r}, ${-s+r})`),c.appendChild(h),t.forEach(x=>{let b=null;const S={seed:x.seed,roughness:x.roughness,stroke:x.strokeColor,strokeWidth:x.strokeWidth,fill:x.backgroundColor==="transparent"?void 0:x.backgroundColor,fillStyle:x.fillStyle,strokeLineDash:x.strokeStyle==="dashed"?[10,10]:x.strokeStyle==="dotted"?[5,10]:void 0};if(x.type==="rectangle")b=d.rectangle(x.x,x.y,x.width,x.height,S);else if(x.type==="circle")b=d.ellipse(x.x+x.width/2,x.y+x.height/2,Math.abs(x.width),Math.abs(x.height),S);else if(x.type==="line"||x.type==="arrow"){const P=x.x+x.width,R=x.y+x.height;if(x.type==="arrow"){const B=document.createElementNS("http://www.w3.org/2000/svg","g");B.appendChild(d.line(x.x,x.y,P,R,S));const U=Math.atan2(x.height,x.width),D=15,Q={x:P-D*Math.cos(U-Math.PI/6),y:R-D*Math.sin(U-Math.PI/6)},ot={x:P-D*Math.cos(U+Math.PI/6),y:R-D*Math.sin(U+Math.PI/6)};B.appendChild(d.line(P,R,Q.x,Q.y,S)),B.appendChild(d.line(P,R,ot.x,ot.y,S)),b=B}else b=d.line(x.x,x.y,P,R,S)}else if(x.type==="text"&&x.text){const P=document.createElementNS("http://www.w3.org/2000/svg","text");P.textContent=x.text,P.setAttribute("x",`${x.x}`),P.setAttribute("y",`${x.y+(x.fontSize||20)}`),P.setAttribute("fill",x.strokeColor),P.setAttribute("font-family","sans-serif"),P.setAttribute("font-size",`${x.fontSize||20}px`),b=P}else if((x.type==="fineliner"||x.type==="inkbrush"||x.type==="marker")&&x.points){let P=[];if(x.pointsEncoding==="flat"){const R=x.points;for(let B=0;B<R.length;B+=2)P.push({x:R[B],y:R[B+1]})}else P=x.points;if(P.length>1){const R=P.map(B=>[x.x+B.x,x.y+B.y]);b=d.curve(R,S)}}else if(x.type==="image"&&x.dataURL){const P=document.createElementNS("http://www.w3.org/2000/svg","image");P.setAttribute("href",x.dataURL),P.setAttribute("x",`${x.x}`),P.setAttribute("y",`${x.y}`),P.setAttribute("width",`${x.width}`),P.setAttribute("height",`${x.height}`),b=P}if(b){if(b.setAttribute("opacity",`${(x.opacity??100)/100}`),x.angle){const P=x.x+x.width/2,R=x.y+x.height/2;b.setAttribute("transform",`rotate(${x.angle*(180/Math.PI)}, ${P}, ${R})`)}h.appendChild(b)}});const y=new XMLSerializer().serializeToString(c),m=new Blob([y],{type:"image/svg+xml"}),g=URL.createObjectURL(m),w=document.createElement("a");w.download="yappy_drawing.svg",w.href=g,w.click()},Oy=async(n,t,e)=>{const s=f.elements;if(s.length===0)return;if(f.docType==="slides"&&f.slides.length>0&&!e){const o=[...f.slides].sort((h,p)=>h.order-p.order),r=o[0],{width:a,height:l}=r.dimensions,c=a>=l?"landscape":"portrait",d=new Ts({orientation:c,unit:"px",format:[a,l],hotfixes:["px_scaling"]});for(let h=0;h<o.length;h++){const p=o[h],{width:y,height:m}=p.dimensions,{x:g,y:w}=p.spatialPosition,x=s.filter(B=>{const U=B.x+B.width/2,D=B.y+B.height/2;return U>=g&&U<=g+y&&D>=w&&D<=w+m}),b=document.createElement("canvas");b.width=y*n,b.height=m*n;const S=b.getContext("2d");if(!S)continue;t&&(S.fillStyle=p.backgroundColor||"#ffffff",S.fillRect(0,0,b.width,b.height)),S.scale(n,n),S.translate(-g,-w);const P=qe.canvas(b);if(x.forEach(B=>{_e(P,S,B)}),h>0){const B=y>=m?"landscape":"portrait";d.addPage([y,m],B)}const R=b.toDataURL("image/jpeg",.92);d.addImage(R,"JPEG",0,0,y,m)}d.save("yappy_drawing.pdf")}else{let o=s;if(e){if(f.selection.length===0)return;o=o.filter(S=>f.selection.includes(S.id))}if(o.length===0)return;let r=1/0,a=1/0,l=-1/0,c=-1/0;o.forEach(S=>{r=Math.min(r,S.x),a=Math.min(a,S.y),l=Math.max(l,S.x+S.width),c=Math.max(c,S.y+S.height)});const d=20,h=l-r+d*2,p=c-a+d*2,y=document.createElement("canvas");y.width=h*n,y.height=p*n;const m=y.getContext("2d");if(!m)return;t&&(m.fillStyle="#ffffff",m.fillRect(0,0,y.width,y.height)),m.scale(n,n),m.translate(-r+d,-a+d);const g=qe.canvas(y);o.forEach(S=>{_e(g,m,S)});const w=h>=p?"landscape":"portrait",x=new Ts({orientation:w,unit:"px",format:[h,p],hotfixes:["px_scaling"]}),b=y.toDataURL("image/jpeg",.92);x.addImage(b,"JPEG",0,0,h,p),x.save("yappy_drawing.pdf")}},_y=async(n,t,e)=>{const s=f.elements;if(s.length===0)return;const i=new Bc;if(f.docType==="slides"&&f.slides.length>0&&!e){const r=[...f.slides].sort((d,h)=>d.order-h.order),a=r[0],l=10,c=10*(a.dimensions.height/a.dimensions.width);i.defineLayout({name:"CUSTOM",width:l,height:c}),i.layout="CUSTOM";for(const d of r){const{width:h,height:p}=d.dimensions,{x:y,y:m}=d.spatialPosition,g=s.filter(B=>{const U=B.x+B.width/2,D=B.y+B.height/2;return U>=y&&U<=y+h&&D>=m&&D<=m+p}),w=document.createElement("canvas");w.width=h*n,w.height=p*n;const x=w.getContext("2d");if(!x)continue;t&&(x.fillStyle=d.backgroundColor||"#ffffff",x.fillRect(0,0,w.width,w.height)),x.scale(n,n),x.translate(-y,-m);const b=qe.canvas(w);g.forEach(B=>{_e(b,x,B)});const S=10,P=10*(p/h);i.addSlide().addImage({data:w.toDataURL("image/png"),x:0,y:0,w:S,h:P})}}else{let r=s;if(e){if(f.selection.length===0)return;r=r.filter(P=>f.selection.includes(P.id))}if(r.length===0)return;let a=1/0,l=1/0,c=-1/0,d=-1/0;r.forEach(P=>{a=Math.min(a,P.x),l=Math.min(l,P.y),c=Math.max(c,P.x+P.width),d=Math.max(d,P.y+P.height)});const h=20,p=c-a+h*2,y=d-l+h*2,m=document.createElement("canvas");m.width=p*n,m.height=y*n;const g=m.getContext("2d");if(!g)return;t&&(g.fillStyle="#ffffff",g.fillRect(0,0,m.width,m.height)),g.scale(n,n),g.translate(-a+h,-l+h);const w=qe.canvas(m);r.forEach(P=>{_e(w,g,P)});const x=10,b=10*(y/p);i.defineLayout({name:"CUSTOM",width:x,height:b}),i.layout="CUSTOM",i.addSlide().addImage({data:m.toDataURL("image/png"),x:0,y:0,w:x,h:b})}await i.writeFile({fileName:"yappy_drawing.pptx"})};class xu{mediaRecorder=null;chunks=[];stream=null;canvas;onStopCallback=null;constructor(t){this.canvas=t}start(t="webm"){try{this.stream=this.canvas.captureStream(60);let e="video/webm;codecs=vp9";return t==="mp4"&&(MediaRecorder.isTypeSupported("video/mp4")?e="video/mp4":MediaRecorder.isTypeSupported("video/webm;codecs=h264")&&(e="video/webm;codecs=h264")),MediaRecorder.isTypeSupported(e)||(console.warn(`Mime type ${e} not supported, falling back to default.`),e=""),this.mediaRecorder=new MediaRecorder(this.stream,e?{mimeType:e}:void 0),this.chunks=[],this.mediaRecorder.ondataavailable=s=>{s.data.size>0&&this.chunks.push(s.data)},this.mediaRecorder.onstop=()=>{this.saveFile(),this.onStopCallback&&this.onStopCallback(),this.cleanup()},this.mediaRecorder.start(),!0}catch(e){return console.error("Failed to start recording:",e),!1}}stop(t){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.onStopCallback=t||null,this.mediaRecorder.stop())}saveFile(){if(this.chunks.length===0)return;const t=new Blob(this.chunks,{type:this.mediaRecorder?.mimeType||"video/webm"}),e=URL.createObjectURL(t),s=document.createElement("a");s.style.display="none",s.href=e;const i=t.type.includes("mp4")?"mp4":"webm",o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);s.download=`yappy-recording-${o}.${i}`,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(e)},100)}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.chunks=[]}}var wu=it("<div class=recording-overlay><div class=recording-indicator><div class=pulse-dot></div><span class=recording-text>REC</span></div><div class=recording-timer></div><button class=stop-btn><span>Stop");const bu=n=>{const[t,e]=wt(0);rn(()=>{const i=setInterval(()=>{e(o=>o+1)},1e3);te(()=>clearInterval(i))});const s=i=>{const o=Math.floor(i/60),r=i%60;return`${o}:${r.toString().padStart(2,"0")}`};return(()=>{var i=wu(),o=i.firstChild,r=o.nextSibling,a=r.nextSibling,l=a.firstChild;return F(r,()=>s(t())),we(a,"click",n.onStop,!0),F(a,E(Fi,{size:16,fill:"white",strokeWidth:0}),l),i})()};Kt(["click"]);var vu=it("<canvas style=display:block;touch-action:none;user-select:none>"),Su=it("<div style=position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0>"),ku=it('<div style=position:fixed;bottom:30px;left:50%;transform:translateX(-50%);z-index:100><button style="background-color:white;border:1px solid #e5e7eb;padding:8px 16px;border-radius:9999px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);cursor:pointer;color:#3b82f6;font-weight:500;font-size:14px;transition:all 0.2s">Scroll back to content'),Mu=it('<textarea style="position:absolute;transform:translate(-50%, -50%);background:transparent;border:1px dashed #007acc;outline:none;margin:0;padding:4px;resize:none;overflow:hidden;min-width:50px;min-height:1em">');const[Pu,$u]=wt(null),Cu=()=>{Ut(()=>{const u=f.selection;if(u.length>0){let M=null,A=-1/0;u.forEach(C=>{const O=f.elements.find(L=>L.id===C);if(O){const L=f.layers.find(v=>v.id===O.layerId);L&&L.order>A&&(A=L.order,M=L.id)}}),M&&M!==oi(()=>f.activeLayerId)&&ys(M)}}),Ut(()=>{if(!n)return;const u=n.getContext("2d");u&&f.elements.forEach(M=>{const A=M.type==="line"||M.type==="arrow";if(M.isSelected&&M.autoResize&&M.containerText&&!A){M.fontSize,M.fontFamily,M.fontWeight,M.fontStyle,M.containerText;const C=Fs(u,M,M.containerText);(Math.abs(C.width-M.width)>2||Math.abs(C.height-M.height)>2)&&oi(()=>nt(M.id,{width:C.width,height:C.height}))}})}),Ut(()=>{if(f.appMode==="presentation")Bt.setForceTicker(!0);else{const u=f.elements.some(M=>M.flowAnimation);Bt.setForceTicker(u)}});let n,t=null;Ut(()=>{const u=Pu();u&&u.start&&(i(u.format||"webm"),$u(null))});const e=()=>{if(!n)return;const u=f.slides[f.activeSlideIndex];if(!u)return;const{width:M,height:A}=u.dimensions,{x:C,y:O}=u.spatialPosition;if(M===0||A===0)return;const L=document.createElement("canvas"),v=320,H=v*A/M;L.width=v,L.height=H;const I=L.getContext("2d");if(!I)return;const G=v/M;I.save(),I.scale(G,G),I.translate(-C,-O);const _=f.theme==="dark";I.fillStyle=u.backgroundColor||(_?"#121212":"#ffffff"),I.fillRect(C,O,M,A);const z=qe.canvas(L);[...f.layers].sort((q,ct)=>q.order-ct.order).forEach(q=>{if(!Le(q.id))return;f.elements.filter(tt=>tt.layerId===q.id).forEach(tt=>{const et=q?.opacity??1;_e(z,I,tt,_,et)})}),I.restore();const X=L.toDataURL("image/jpeg",.6);Sd(f.activeSlideIndex,X)};let s;Ut(()=>{f.activeSlideIndex,f.elements,window.clearTimeout(s),s=window.setTimeout(()=>{oi(()=>e())},1e3)});const i=u=>{if(!n){console.error("[DEBUG] Canvas: No canvasRef available");return}t||(console.log("[DEBUG] Canvas: Initializing VideoRecorder"),t=new xu(n)),console.log("[DEBUG] Canvas: Starting recorder...");const M=t.start(u);console.log("[DEBUG] Canvas: Recorder start returned:",M),M?($("isRecording",!0),Wt("Recording started...","info")):Wt("Failed to start recording","error")},o=()=>{t&&t.stop(()=>{$("isRecording",!1),Wt("Recording saved!","success")})};let r=!1,a=null,l=0,c=0;const[d,h]=wt(null),[p,y]=wt("containerText"),[m,g]=wt("");let w,x=!1,b=!1,S=null;const[P,R]=wt(null);let B=new Map;const[U,D]=wt(null),[Q,ot]=wt([]),[st,ht]=wt([]);let pt=null,mt=null,At=0,_t=0,rt=0,ft=0,Rt=20,Dt=0;const jt=16;let It=[],Qt=!1,ne=0;const Nt=8,ie=800,Te=100;let re=[],Gt=0;const ln=16;let Me=!1;const Xe=()=>{if(!a||re.length===0)return;const u=f.elements.find(M=>M.id===a);if(u&&u.points){const C={points:[...u.points,...re]};u.type==="ink"&&(C.ttl=Date.now()+3e3),nt(a,C,!1),re=[]}},Pe=()=>{n&&(n.width=window.innerWidth,n.height=window.innerHeight,ce())},[cn,oe]=wt("default"),[no,Gn]=wt(!1),[Qe,qn]=wt({x:0,y:0});function ce(){if(!n)return;const u=n.getContext("2d");if(!u)return;const M=Es();window.yappyGlobalTime=M;const A=performance.now(),C=f.appMode==="presentation"||f.isPreviewing,O=fo(f.elements,M,C);u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,n.width,n.height);const L=Date.now();if(It.length>0){let T=0;for(let W=0;W<It.length;W++)L-It[W].timestamp<ie&&(It[T++]=It[W]);It.length=T}const v=f.theme==="dark",H=v?"#1a1a1b":"#e2e8f0";u.fillStyle=H,u.fillRect(0,0,n.width,n.height);const{scale:I,panX:G,panY:_}=f.viewState;if(u.save(),u.translate(G,_),u.scale(I,I),f.docType==="slides"){const T=f.slides[f.activeSlideIndex];if(T){const{width:W,height:k}=T.dimensions,{x:V,y:lt}=T.spatialPosition;u.save(),u.shadowColor=v?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.15)",u.shadowBlur=40,u.shadowOffsetY=10,u.fillStyle="black",u.fillRect(V,lt,W,k),u.restore();const dt=T.backgroundColor||(v?"#121212":"#ffffff");u.fillStyle=dt,u.fillRect(V,lt,W,k)}}else f.docType==="infinite"&&f.slides.length>1&&f.slides.forEach((T,W)=>{const{width:k,height:V}=T.dimensions,{x:lt,y:dt}=T.spatialPosition;u.save(),u.strokeStyle=v?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",u.lineWidth=2,u.setLineDash([10,5]),u.strokeRect(lt,dt,k,V),u.setLineDash([]),u.restore(),u.fillStyle=v?"rgba(100,149,237,0.03)":"rgba(70,130,180,0.02)",u.fillRect(lt,dt,k,V),u.save();const Mt=`Slide ${W+1}`,yt=Math.max(14,16/I);u.font=`${yt}px Inter, sans-serif`,u.fillStyle=v?"rgba(100,149,237,0.6)":"rgba(70,130,180,0.5)";const J=8,$t=u.measureText(Mt),Ct=yt+J*2,zt=$t.width+J*2;u.fillStyle=v?"rgba(30,30,30,0.8)":"rgba(255,255,255,0.9)",u.fillRect(lt,dt,zt,Ct),u.strokeStyle=v?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",u.lineWidth=1,u.strokeRect(lt,dt,zt,Ct),u.fillStyle=v?"rgba(100,149,237,0.8)":"rgba(70,130,180,0.7)",u.fillText(Mt,lt+J,dt+yt+J/2),u.restore()});if(u.restore(),f.canvasTexture!=="none"){const T=f.canvasTexture;if(u.save(),u.setTransform(1,0,0,1,0,0),T==="dots"||T==="grid"||T==="graph"){const W=T==="graph"?40:20,k=W/4,V=v?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",lt=v?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.03)",dt=v?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.07)",Mt=G%(W*I),yt=_%(W*I);if(T==="dots"){u.fillStyle=V;for(let J=Mt;J<n.width;J+=W*I)for(let $t=yt;$t<n.height;$t+=W*I)u.beginPath(),u.arc(J,$t,1,0,Math.PI*2),u.fill()}else if(T==="grid"){u.strokeStyle=lt,u.lineWidth=1,u.beginPath();for(let J=Mt;J<n.width;J+=W*I)u.moveTo(J,0),u.lineTo(J,n.height);for(let J=yt;J<n.height;J+=W*I)u.moveTo(0,J),u.lineTo(n.width,J);u.stroke()}else if(T==="graph"){u.strokeStyle=lt,u.lineWidth=.5,u.beginPath();for(let J=G%(k*I);J<n.width;J+=k*I)u.moveTo(J,0),u.lineTo(J,n.height);for(let J=_%(k*I);J<n.height;J+=k*I)u.moveTo(0,J),u.lineTo(n.width,J);u.stroke(),u.strokeStyle=dt,u.lineWidth=1,u.beginPath();for(let J=Mt;J<n.width;J+=W*I)u.moveTo(J,0),u.lineTo(J,n.height);for(let J=yt;J<n.height;J+=W*I)u.moveTo(0,J),u.lineTo(n.width,J);u.stroke()}}u.restore()}if(u.save(),u.translate(G,_),u.scale(I,I),f.gridSettings.enabled){const T=f.gridSettings.gridSize;let W=f.gridSettings.gridColor;v&&W==="#e0e0e0"&&(W="#333333");const k=f.gridSettings.gridOpacity,V=f.gridSettings.style||"lines";u.save(),u.setTransform(1,0,0,1,0,0),u.strokeStyle=W,u.fillStyle=W,u.globalAlpha=k,u.lineWidth=1;const lt=Math.floor(-G/I/T)*T,dt=Math.ceil((n.width-G)/I/T)*T,Mt=Math.floor(-_/I/T)*T,yt=Math.ceil((n.height-_)/I/T)*T;if(V==="lines"){u.beginPath();for(let J=lt;J<=dt;J+=T){const $t=J*I+G;u.moveTo($t,0),u.lineTo($t,n.height)}for(let J=Mt;J<=yt;J+=T){const $t=J*I+_;u.moveTo(0,$t),u.lineTo(n.width,$t)}u.stroke()}else{!v&&V==="dots"&&(W==="#e0e0e0"||W==="#fafafa")&&(u.fillStyle="#b0b0b0");for(let $t=lt;$t<=dt;$t+=T)for(let Ct=Mt;Ct<=yt;Ct+=T){const zt=$t*I+G,ut=Ct*I+_;zt>=-3&&zt<=n.width+3&&ut>=-3&&ut<=n.height+3&&(u.beginPath(),u.arc(zt,ut,3/2,0,Math.PI*2),u.fill())}}u.restore()}const z={minX:-G/I,maxX:(n.width-G)/I,minY:-_/I,maxY:(n.height-_)/I},N=(z.maxX-z.minX)*.1,X=(z.maxY-z.minY)*.1,q=[...f.layers].sort((T,W)=>T.order-W.order);let ct=0;const tt=new Map;for(const T of f.elements)tt.set(T.id,T);const et=qe.canvas(n);if(q.forEach(T=>{if(!Le(T.id))return;if(T.backgroundColor&&T.backgroundColor!=="transparent"){u.save(),u.globalAlpha=T.opacity,u.fillStyle=T.backgroundColor;const k=1e6;u.fillRect(-k,-k,k*2,k*2),u.restore()}const W=f.elements.filter(k=>{if(k.layerId!==T.id)return!1;if(k.id===a)return!0;if(wn(k,f.elements,tt))return!1;if(k.type==="line"||k.type==="arrow"||k.type==="bezier"){if(k.startBinding){const Mt=tt.get(k.startBinding.elementId);if(Mt&&wn(Mt,f.elements,tt))return!1}if(k.endBinding){const Mt=tt.get(k.endBinding.elementId);if(Mt&&wn(Mt,f.elements,tt))return!1}}const V=Math.abs(k.width)*I,lt=Math.abs(k.height)*I;if(V<1&&lt<1)return!1;const dt=Math.max(Math.abs(k.width),Math.abs(k.height))*.5;return!(k.x+k.width+dt<z.minX-N||k.x-dt>z.maxX+N||k.y+k.height+dt<z.minY-X||k.y-dt>z.maxY+X)});ct+=W.length,W.forEach(k=>{const V=O.get(k.id),lt=V?{...k,x:V.x,y:V.y,angle:V.angle}:k;let dt=lt.x+lt.width/2,Mt=lt.y+lt.height/2;if(f.docType==="slides"){const yt=f.slides[f.activeSlideIndex];if(yt){const{x:J,y:$t}=yt.spatialPosition,{width:Ct,height:zt}=yt.dimensions;if(!(dt>=J&&dt<=J+Ct&&Mt>=$t&&Mt<=$t+zt))return}}if(lt.type!=="text"||d()!==lt.id){const yt=T?.opacity??1;_e(et,u,lt,v,yt)}if(f.selection.includes(k.id)){const yt=lt.x,J=lt.y,$t=lt.width,Ct=lt.height,zt=lt.angle,ut=yt+$t/2,Vt=J+Ct/2;u.save(),zt&&(u.translate(ut,Vt),u.rotate(zt),u.translate(-ut,-Vt)),u.strokeStyle="#3b82f6",u.lineWidth=1/I;const Xt=2/I;if(k.type!=="line"&&k.type!=="arrow"&&k.type!=="bezier"&&k.type!=="organicBranch")u.strokeRect(yt-Xt,J-Xt,$t+Xt*2,Ct+Xt*2);else if(k.type==="organicBranch"&&k.points&&k.points.length>=2&&k.controlPoints&&k.controlPoints.length>=2){const Lt=Yt(k.points);if(Lt.length>=2){const se={x:k.x+Lt[0].x,y:k.y+Lt[0].y},Jt={x:k.x+Lt[Lt.length-1].x,y:k.y+Lt[Lt.length-1].y},ae=Ys(se,Jt,k.controlPoints[0],k.controlPoints[1],k.strokeWidth);u.save(),u.strokeStyle="#3b82f6",u.lineWidth=2/I,u.beginPath(),u.moveTo(ae[0].x,ae[0].y);for(let ve=1;ve<ae.length;ve++)u.lineTo(ae[ve].x,ae[ve].y);u.closePath(),u.stroke(),u.restore()}}if(f.selection.length===1){const Lt=8/I;if(u.fillStyle="#ffffff",u.strokeStyle="#3b82f6",u.lineWidth=2/I,k.type==="line"||k.type==="arrow"||k.type==="bezier"||k.type==="organicBranch"){let se=yt,Jt=J,ae=yt+$t,ve=J+Ct;if(k.type==="organicBranch"&&k.points&&k.points.length>=2){const pe=Yt(k.points);pe.length>=2&&(se=k.x+pe[0].x,Jt=k.y+pe[0].y,ae=k.x+pe[pe.length-1].x,ve=k.y+pe[pe.length-1].y)}[{x:se,y:Jt},{x:ae,y:ve}].forEach(pe=>{u.beginPath(),u.arc(pe.x,pe.y,Lt/1.5,0,Math.PI*2),u.fill(),u.stroke()})}else{[{x:yt-Xt,y:J-Xt},{x:yt+$t+Xt,y:J-Xt},{x:yt+$t+Xt,y:J+Ct+Xt},{x:yt-Xt,y:J+Ct+Xt},{x:yt+$t/2,y:J-Xt},{x:yt+$t+Xt,y:J+Ct/2},{x:yt+$t/2,y:J+Ct+Xt},{x:yt-Xt,y:J+Ct/2}].forEach(ae=>{u.fillRect(ae.x-Lt/2,ae.y-Lt/2,Lt,Lt),u.strokeRect(ae.x-Lt/2,ae.y-Lt/2,Lt,Lt)});const Jt={x:k.x+k.width/2,y:k.y-Xt-20/I};u.beginPath(),u.moveTo(k.x+k.width/2,k.y-Xt),u.lineTo(Jt.x,Jt.y),u.stroke(),u.beginPath(),u.arc(Jt.x,Jt.y,Lt/2,0,Math.PI*2),u.fill(),u.stroke()}}if(f.elements.some(Lt=>Lt.parentId===k.id)&&k.type!=="line"&&k.type!=="arrow"){const Lt=14/I,se=k.x+k.width+15/I,Jt=k.y+k.height/2;u.beginPath(),u.arc(se,Jt,Lt/2,0,Math.PI*2),u.fillStyle=k.isCollapsed?"#10b981":v?"#333":"#fff",u.fill(),u.strokeStyle="#10b981",u.lineWidth=2/I,u.stroke(),u.beginPath(),u.strokeStyle=k.isCollapsed?"#fff":"#10b981",u.lineWidth=2/I,u.moveTo(se-Lt/4,Jt),u.lineTo(se+Lt/4,Jt),k.isCollapsed&&(u.moveTo(se,Jt-Lt/4),u.lineTo(se,Jt+Lt/4)),u.stroke()}u.restore()}if(k.isCollapsed&&!f.selection.includes(k.id)){u.save(),k.angle&&(u.translate(dt,Mt),u.rotate(k.angle),u.translate(-dt,-Mt)),u.shadowBlur=10/I,u.shadowColor="#10b981",u.strokeStyle="#10b981",u.lineWidth=1/I;const yt=1/I;u.strokeRect(k.x-yt,k.y-yt,k.width+yt*2,k.height+yt*2),u.restore()}if(f.selection.includes(k.id)&&(k.type==="isometricCube"||k.type==="star"||k.type==="burst"||k.type==="solidBlock"||k.type==="perspectiveBlock"||k.type==="cylinder")){const yt=10/I;let J=0,$t=0;if(k.type==="isometricCube"){const Ct=(k.shapeRatio!==void 0?k.shapeRatio:25)/100,zt=(k.sideRatio!==void 0?k.sideRatio:50)/100,ut=k.height*Ct;$t=k.y+ut,J=k.x+k.width*zt}else if(k.type==="solidBlock"||k.type==="cylinder"){const Ct=k.depth!==void 0?k.depth:50,zt=(k.viewAngle!==void 0?k.viewAngle:45)*Math.PI/180,ut=k.x+k.width/2,Vt=k.y+k.height/2;J=ut+Ct*Math.cos(zt),$t=Vt+Ct*Math.sin(zt)}else if(k.type==="perspectiveBlock"){const Ct=k.depth!==void 0?k.depth:50,zt=(k.viewAngle!==void 0?k.viewAngle:45)*Math.PI/180,ut=k.taper!==void 0?k.taper:0,Vt=(k.skewX!==void 0?k.skewX:0)*k.width,Xt=(k.skewY!==void 0?k.skewY:0)*k.height,Et=k.x+k.width/2,Lt=k.y+k.height/2,se=Ct*Math.cos(zt)+Vt,Jt=Ct*Math.sin(zt)+Xt,ae=1-ut,ve=k.width/2*ae,Cn=k.height/2*ae,pe=1-(k.frontTaper||0),Zn=k.width/2*pe,ti=k.height/2*pe,ei=(k.frontSkewX||0)*k.width,ni=(k.frontSkewY||0)*k.height,Ml=[{x:Et+se,y:Lt+Jt,type:"depth"},{x:Et+se-ve,y:Lt+Jt-Cn,type:"bTL"},{x:Et+se+ve,y:Lt+Jt-Cn,type:"bTR"},{x:Et+se+ve,y:Lt+Jt+Cn,type:"bBR"},{x:Et+se-ve,y:Lt+Jt+Cn,type:"bBL"},{x:Et+ei-Zn,y:Lt+ni-ti,type:"fTL"},{x:Et+ei+Zn,y:Lt+ni-ti,type:"fTR"},{x:Et+ei+Zn,y:Lt+ni+ti,type:"fBR"},{x:Et+ei-Zn,y:Lt+ni+ti,type:"fBL"}];u.strokeStyle="#ffffff",u.lineWidth=1.5/I;for(const ii of Ml)ii.type==="depth"?u.fillStyle="#f59e0b":ii.type.startsWith("b")?u.fillStyle="#3b82f6":u.fillStyle="#10b981",u.beginPath(),u.arc(ii.x,ii.y,yt/2,0,Math.PI*2),u.fill(),u.stroke();return}else if(k.type==="star"||k.type==="burst"){const Ct=(k.shapeRatio!==void 0?k.shapeRatio:25)/100;J=k.x+k.width/2,$t=k.y+k.height*Ct}u.fillStyle="#f59e0b",u.strokeStyle="#ffffff",u.lineWidth=1.5/I,u.beginPath(),u.arc(J,$t,yt/2,0,Math.PI*2),u.fill(),u.stroke()}if(f.selection.includes(k.id)){if((k.type==="line"||k.type==="arrow"||k.type==="bezier"||k.type==="organicBranch")&&k.controlPoints&&f.selectedTool==="selection"){const yt=10/I;if(k.controlPoints.length===1){const J=k.controlPoints[0];let $t={x:k.x,y:k.y},Ct={x:k.x+k.width,y:k.y+k.height};if(k.points&&k.points.length>=2){const Vt=Yt(k.points);Vt.length>0&&($t={x:k.x+Vt[0].x,y:k.y+Vt[0].y},Ct={x:k.x+Vt[Vt.length-1].x,y:k.y+Vt[Vt.length-1].y})}const zt=.25*$t.x+.5*J.x+.25*Ct.x,ut=.25*$t.y+.5*J.y+.25*Ct.y;u.fillStyle="#3b82f6",u.strokeStyle="#ffffff",u.lineWidth=1.5/I,u.beginPath(),u.arc(zt,ut,yt/2,0,Math.PI*2),u.fill(),u.stroke()}else k.controlPoints.forEach(J=>{u.fillStyle="#3b82f6",u.strokeStyle="#ffffff",u.lineWidth=1.5/I,u.beginPath(),u.arc(J.x,J.y,yt/2,0,Math.PI*2),u.fill(),u.stroke()})}if(k.type!=="line"&&k.type!=="arrow"&&f.selectedTool==="selection"){const yt=14/I,J=32/I,$t=k.x+k.width/2,Ct=k.y+k.height/2;[{pos:"top",x:$t,y:k.y-J},{pos:"right",x:k.x+k.width+J,y:Ct},{pos:"bottom",x:$t,y:k.y+k.height+J},{pos:"left",x:k.x-J,y:Ct}].forEach(ut=>{const Vt=mt&&mt.elementId===k.id&&mt.handle===`connector-${ut.pos}`,Xt=Vt?yt*1.3:yt;u.strokeStyle=Vt?"rgba(16, 185, 129, 0.8)":"rgba(16, 185, 129, 0.4)",u.lineWidth=(Vt?2:1)/I,u.setLineDash([3/I,3/I]),u.beginPath(),ut.pos==="top"?(u.moveTo(ut.x,k.y),u.lineTo(ut.x,ut.y)):ut.pos==="right"?(u.moveTo(k.x+k.width,ut.y),u.lineTo(ut.x,ut.y)):ut.pos==="bottom"?(u.moveTo(ut.x,k.y+k.height),u.lineTo(ut.x,ut.y)):ut.pos==="left"&&(u.moveTo(k.x,ut.y),u.lineTo(ut.x,ut.y)),u.stroke(),u.setLineDash([]),u.shadowColor="rgba(16, 185, 129, 0.5)",u.shadowBlur=(Vt?8:4)/I,u.fillStyle=Vt?"#059669":"#10b981",u.strokeStyle="#ffffff",u.lineWidth=2/I,u.beginPath(),u.arc(ut.x,ut.y,Xt/2,0,Math.PI*2),u.fill(),u.stroke(),u.shadowBlur=0,u.strokeStyle="#ffffff",u.lineWidth=1.8/I;const Et=Xt*.25;u.beginPath(),ut.pos==="top"?(u.moveTo(ut.x-Et,ut.y+Et/2),u.lineTo(ut.x,ut.y-Et/2),u.lineTo(ut.x+Et,ut.y+Et/2)):ut.pos==="right"?(u.moveTo(ut.x-Et/2,ut.y-Et),u.lineTo(ut.x+Et/2,ut.y),u.lineTo(ut.x-Et/2,ut.y+Et)):ut.pos==="bottom"?(u.moveTo(ut.x-Et,ut.y-Et/2),u.lineTo(ut.x,ut.y+Et/2),u.lineTo(ut.x+Et,ut.y-Et/2)):ut.pos==="left"&&(u.moveTo(ut.x+Et/2,ut.y-Et),u.lineTo(ut.x-Et/2,ut.y),u.lineTo(ut.x+Et/2,ut.y+Et)),u.stroke()})}}})}),f.selection.length>1){const T=un();if(T){const W=f.viewState.scale,k=2/W,V=8/W;u.save(),u.strokeStyle="#3b82f6",u.lineWidth=1/W,u.setLineDash([5/W,5/W]),u.strokeRect(T.x-k,T.y-k,T.width+k*2,T.height+k*2),u.setLineDash([]),u.fillStyle="#ffffff",u.lineWidth=2/W,[{x:T.x-k,y:T.y-k},{x:T.x+T.width+k,y:T.y-k},{x:T.x+T.width+k,y:T.y+T.height+k},{x:T.x-k,y:T.y+T.height+k},{x:T.x+T.width/2,y:T.y-k},{x:T.x+T.width+k,y:T.y+T.height/2},{x:T.x+T.width/2,y:T.y+T.height+k},{x:T.x-k,y:T.y+T.height/2}].forEach(dt=>{u.fillRect(dt.x-V/2,dt.y-V/2,V,V),u.strokeRect(dt.x-V/2,dt.y-V/2,V,V)}),u.restore()}}const Y=P();Y&&(u.save(),u.fillStyle="rgba(59, 130, 246, 0.2)",u.strokeStyle="#3b82f6",u.lineWidth=1/I,u.fillRect(Y.x,Y.y,Y.w,Y.h),u.strokeRect(Y.x,Y.y,Y.w,Y.h),u.restore());const at=U();if(at){const T=f.elements.find(W=>W.id===at.elementId);T&&(u.save(),u.strokeStyle="#f59e0b",u.lineWidth=2/I,u.strokeRect(T.x-4/I,T.y-4/I,T.width+8/I,T.height+8/I),u.fillStyle="#f59e0b",u.beginPath(),u.arc(at.px,at.py,5/I,0,Math.PI*2),u.fill(),u.restore())}const bt=Q();bt.length>0&&(u.save(),u.strokeStyle="#ff00ff",u.setLineDash([5/f.viewState.scale,5/f.viewState.scale]),u.lineWidth=1/f.viewState.scale,bt.forEach(T=>{u.beginPath(),T.type==="vertical"?(u.moveTo(T.coordinate,-1e5),u.lineTo(T.coordinate,1e5)):(u.moveTo(-1e5,T.coordinate),u.lineTo(1e5,T.coordinate)),u.stroke()}),u.restore());const kt=st();if(kt.length>0&&(u.save(),u.strokeStyle="#ff00ff",u.fillStyle="#ff00ff",u.lineWidth=1/f.viewState.scale,u.font=`${Math.floor(10/f.viewState.scale)}px sans-serif`,u.textAlign="center",u.textBaseline="middle",kt.forEach(T=>{T.segments.forEach(W=>{if(u.beginPath(),T.orientation==="horizontal"){u.moveTo(W.from,T.variableCoordinate),u.lineTo(W.to,T.variableCoordinate),u.stroke();const k=4/f.viewState.scale;u.beginPath(),u.moveTo(W.from,T.variableCoordinate-k),u.lineTo(W.from,T.variableCoordinate+k),u.moveTo(W.to,T.variableCoordinate-k),u.lineTo(W.to,T.variableCoordinate+k),u.stroke();const V=(W.from+W.to)/2,lt=Math.round(T.gap).toString(),dt=2/f.viewState.scale,Mt=u.measureText(lt).width+dt*4,yt=12/f.viewState.scale;u.fillStyle="#ff00ff",u.fillRect(V-Mt/2,T.variableCoordinate-yt/2,Mt,yt),u.fillStyle="white",u.fillText(lt,V,T.variableCoordinate),u.fillStyle="#ff00ff"}else{u.beginPath(),u.moveTo(T.variableCoordinate,W.from),u.lineTo(T.variableCoordinate,W.to),u.stroke();const k=4/f.viewState.scale;u.beginPath(),u.moveTo(T.variableCoordinate-k,W.from),u.lineTo(T.variableCoordinate+k,W.from),u.moveTo(T.variableCoordinate-k,W.to),u.lineTo(T.variableCoordinate+k,W.to),u.stroke();const V=(W.from+W.to)/2,lt=Math.round(T.gap).toString(),dt=2/f.viewState.scale,Mt=u.measureText(lt).width+dt*4,yt=12/f.viewState.scale;u.fillStyle="#ff00ff",u.fillRect(T.variableCoordinate-Mt/2,V-yt/2,Mt,yt),u.fillStyle="white",u.fillText(lt,T.variableCoordinate,V),u.fillStyle="#ff00ff"}})}),u.restore()),(f.selectedTool==="line"||f.selectedTool==="arrow")&&r&&a){const T=f.elements.find(W=>W.id===a);if(T&&(T.type==="line"||T.type==="arrow")){const W=T.x+T.width,k=T.y+T.height,V=50/f.viewState.scale,lt=15/f.viewState.scale;u.save();for(const dt of f.elements){if(dt.id===a||!be(dt)||dt.type==="line"||dt.type==="arrow"||dt.type==="bezier"||dt.layerId!==f.activeLayerId)continue;const Mt=dt.x+dt.width/2,yt=dt.y+dt.height/2;if(Math.sqrt((Mt-W)**2+(yt-k)**2)<V){const $t=$i(dt);for(const Ct of $t){const zt=Ct.x-W,ut=Ct.y-k,Xt=Math.sqrt(zt*zt+ut*ut)<lt,Et=Xt?6/f.viewState.scale:4/f.viewState.scale;u.beginPath(),u.arc(Ct.x,Ct.y,Et,0,Math.PI*2),Xt?(u.fillStyle="#3b82f6",u.fill()):(u.fillStyle="rgba(59, 130, 246, 0.4)",u.fill(),u.strokeStyle="#3b82f6",u.lineWidth=1/f.viewState.scale,u.stroke())}}}u.restore()}}if(It.length>1){u.save(),u.lineCap="round",u.lineJoin="round",u.shadowBlur=8,u.shadowColor="rgba(255, 50, 50, 0.6)";const T=4/f.viewState.scale;let W=-1;for(let k=0;k<It.length-1;k++){const V=It[k],lt=It[k+1],dt=L-V.timestamp,Mt=Math.max(0,1-dt/ie);if(Mt<=0)continue;const yt=Math.ceil(Mt*5);if(yt!==W){W!==-1&&u.stroke(),W=yt;const J=yt/5;u.beginPath(),u.strokeStyle=`rgba(255, 30, 30, ${J})`,u.lineWidth=T*J,u.moveTo(V.x,V.y)}u.lineTo(lt.x,lt.y)}W!==-1&&u.stroke(),u.restore()}u.restore();const j=performance.now()-A;au.measureFrame(j,f.elements.length,ct)}Ut(()=>{Es(),f.appMode,f.isPreviewing,f.theme,f.elements.length,f.elements.forEach(u=>{u.x,u.y,u.width,u.height,u.points&&u.points.length,u.angle,u.opacity,u.strokeColor,u.backgroundColor,u.fillStyle,u.strokeWidth,u.strokeStyle,u.roughness,u.roundness,u.text,u.fontSize,u.fontFamily,u.textAlign,u.fontWeight,u.fontStyle,u.textColor,u.textHighlightEnabled,u.textHighlightColor,u.textHighlightPadding,u.textHighlightRadius,u.startArrowhead,u.endArrowhead,u.containerText,u.labelPosition,u.isCollapsed,u.parentId,u.starPoints,u.polygonSides,u.borderRadius,u.burstPoints,u.tailPosition,u.shapeRatio,u.sideRatio,u.depth,u.viewAngle,u.taper,u.skewX,u.skewY,u.frontTaper,u.frontSkewX,u.frontSkewY,u.drawInnerBorder,u.innerBorderDistance,u.strokeLineJoin,u.renderStyle,u.fillDensity,u.gradientStart,u.gradientEnd,u.gradientDirection,u.gradientStops,u.gradientType,u.shadowEnabled,u.shadowColor,u.shadowBlur,u.shadowOffsetX,u.shadowOffsetY,u.blendMode,u.spinEnabled,u.spinSpeed,u.orbitEnabled,u.orbitCenterId,u.orbitRadius,u.orbitSpeed,u.orbitDirection}),f.viewState.scale,f.viewState.panX,f.viewState.panY,f.selection.length,P(),f.layers.length,f.layers.forEach(u=>{u.visible,u.order,u.opacity,u.backgroundColor}),f.gridSettings.enabled,f.gridSettings.gridSize,f.gridSettings.gridColor,f.gridSettings.gridOpacity,f.gridSettings.style,f.canvasBackgroundColor,f.canvasTexture,Q(),requestAnimationFrame(ce)}),Ut(()=>{f.elements.forEach(u=>{u.boundElements&&u.boundElements.length>0&&(u.x,u.y,u.width,u.height,oi(()=>{u.boundElements?.forEach(M=>Pn(M.id))}))})});const io=u=>({x:u.clientX,y:u.clientY}),$e=(u,M)=>{const{scale:A,panX:C,panY:O}=f.viewState;return{x:(u-C)/A,y:(M-O)/A}},jn=u=>{u.dataTransfer&&(u.preventDefault(),u.dataTransfer.dropEffect="copy")},Qn=async u=>{u.preventDefault();const M=u.dataTransfer?.getData("text/plain");if(!M||!M.startsWith("color(display-p3"))return;const{x:A,y:C}=$e(u.clientX,u.clientY),O=10/f.viewState.scale,L=new Map;for(const z of f.elements)L.set(z.id,z);const v=f.elements.map((z,N)=>{const X=f.layers.find(q=>q.id===z.layerId);return{el:z,index:N,layerOrder:X?.order??999,layerVisible:Le(z.layerId)}}).sort((z,N)=>z.layerOrder!==N.layerOrder?N.layerOrder-z.layerOrder:N.index-z.index),H=window.yappyGlobalTime||0,I=f.appMode==="presentation"||f.isPreviewing,G=fo(f.elements,H,I);let _=null;for(const{el:z,layerVisible:N}of v){if(!N||!be(z))continue;const X=G.get(z.id),q=X?{...z,x:X.x,y:X.y,angle:X.angle}:z;if(He(q,A,C,O,L)){_=z.id;break}}_&&(Pt(),nt(_,{backgroundColor:M,fillStyle:"solid"}))},oo=u=>{if(f.appMode==="presentation"&&f.docType==="slides")return;u.preventDefault();const M=u.deltaMode===1?33:u.deltaMode===2?400:1,A=u.deltaX*M,C=u.deltaY*M;if(u.ctrlKey||u.metaKey){const L=1-C*.001,v=Math.min(Math.max(f.viewState.scale*L,.1),10),{x:H,y:I}=io(u),{scale:G,panX:_,panY:z}=f.viewState,N=(H-_)/G,X=(I-z)/G,q=H-N*v,ct=I-X*v;Zt({scale:v,panX:q,panY:ct})}else u.shiftKey?Zt({panX:f.viewState.panX-(C||A),panY:f.viewState.panY}):Zt({panX:f.viewState.panX-A,panY:f.viewState.panY-C})},dn=(u,M,A,C,O)=>{const L=Math.cos(O),v=Math.sin(O);return{x:L*(u-A)-v*(M-C)+A,y:v*(u-A)+L*(M-C)+C}},hn=(u,M,A,C,O)=>dn(u,M,A,C,-O),un=()=>{if(f.selection.length===0)return null;let u=1/0,M=1/0,A=-1/0,C=-1/0,O=!1;return f.elements.forEach(L=>{f.selection.includes(L.id)&&(u=Math.min(u,L.x),M=Math.min(M,L.y),A=Math.max(A,L.x+L.width),C=Math.max(C,L.y+L.height),O=!0)}),O?{x:u,y:M,width:A-u,height:C-M}:null},Ye=(u,M)=>{const{scale:A}=f.viewState,C=12/A,O=2/A;if(f.selection.length>1){const L=un();if(L){const v=[{type:"tl",x:L.x-O,y:L.y-O},{type:"tr",x:L.x+L.width+O,y:L.y-O},{type:"br",x:L.x+L.width+O,y:L.y+L.height+O},{type:"bl",x:L.x-O,y:L.y+L.height+O},{type:"tm",x:L.x+L.width/2,y:L.y-O},{type:"rm",x:L.x+L.width+O,y:L.y+L.height/2},{type:"bm",x:L.x+L.width/2,y:L.y+L.height+O},{type:"lm",x:L.x-O,y:L.y+L.height/2}];for(const H of v)if(Math.abs(u-H.x)<=C/2&&Math.abs(M-H.y)<=C/2)return{id:"multi",handle:H.type}}}for(let L=f.elements.length-1;L>=0;L--){const v=f.elements[L];if(wn(v,f.elements))continue;if(f.elements.some(I=>I.parentId===v.id)&&v.type!=="line"&&v.type!=="arrow"){const I=v.x+v.width/2,G=v.y+v.height/2,_=hn(u,M,I,G,v.angle||0),z=14/A,N=v.x+v.width+15/A,X=v.y+v.height/2;if(Math.sqrt(Math.pow(_.x-N,2)+Math.pow(_.y-X,2))<=z/2+5/A)return{id:v.id,handle:"mindmap-toggle"}}}for(let L=f.elements.length-1;L>=0;L--){const v=f.elements[L];if(!f.selection.includes(v.id)||f.selection.length>1)continue;const H=v.x+v.width/2,I=v.y+v.height/2,G=v.angle||0,_=hn(u,M,H,I,G);let z=[{type:"tl",x:v.x-O,y:v.y-O},{type:"tr",x:v.x+v.width+O,y:v.y-O},{type:"br",x:v.x+v.width+O,y:v.y+v.height+O},{type:"bl",x:v.x-O,y:v.y+v.height+O},{type:"tm",x:v.x+v.width/2,y:v.y-O},{type:"rm",x:v.x+v.width+O,y:v.y+v.height/2},{type:"bm",x:v.x+v.width/2,y:v.y+v.height+O},{type:"lm",x:v.x-O,y:v.y+v.height/2}];if(v.type==="line"||v.type==="arrow"||v.type==="organicBranch"){let X=v.x,q=v.y,ct=v.x+v.width,tt=v.y+v.height;if(v.type==="organicBranch"&&v.points&&v.points.length>=2){const et=Yt(v.points);et.length>=2&&(X=v.x+et[0].x,q=v.y+et[0].y,ct=v.x+et[et.length-1].x,tt=v.y+et[et.length-1].y)}z=[{type:"tl",x:X,y:q},{type:"br",x:ct,y:tt}]}for(const X of z)if(Math.abs(_.x-X.x)<=C/2&&Math.abs(_.y-X.y)<=C/2)return{id:v.id,handle:X.type};const N={x:v.x+v.width/2,y:v.y-O-20/A};if(Math.abs(_.x-N.x)<=C&&Math.abs(_.y-N.y)<=C/2)return{id:v.id,handle:"rotate"};if(v.type==="isometricCube"){const X=(v.shapeRatio!==void 0?v.shapeRatio:25)/100,q=(v.sideRatio!==void 0?v.sideRatio:50)/100,ct=v.height*X,tt=v.y+ct,et=v.x+v.width*q;if(Math.abs(_.x-et)<=C&&Math.abs(_.y-tt)<=C)return{id:v.id,handle:"control-1"}}else if(v.type==="solidBlock"||v.type==="cylinder"){const X=v.depth!==void 0?v.depth:50,q=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,ct=v.x+v.width/2,tt=v.y+v.height/2,et=ct+X*Math.cos(q),Y=tt+X*Math.sin(q);if(Math.abs(_.x-et)<=C&&Math.abs(_.y-Y)<=C)return{id:v.id,handle:"control-1"}}else if(v.type==="perspectiveBlock"){const X=v.depth!==void 0?v.depth:50,q=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,ct=v.taper!==void 0?v.taper:0,tt=(v.skewX!==void 0?v.skewX:0)*v.width,et=(v.skewY!==void 0?v.skewY:0)*v.height,Y=v.x+v.width/2,at=v.y+v.height/2,bt=X*Math.cos(q)+tt,kt=X*Math.sin(q)+et,j=1-ct,T=v.width/2*j,W=v.height/2*j,k=1-(v.frontTaper||0),V=v.width/2*k,lt=v.height/2*k,dt=(v.frontSkewX||0)*v.width,Mt=(v.frontSkewY||0)*v.height,yt=[{x:Y+bt,y:at+kt,handle:"control-1"},{x:Y+bt-T,y:at+kt-W,handle:"control-2"},{x:Y+bt+T,y:at+kt-W,handle:"control-3"},{x:Y+bt+T,y:at+kt+W,handle:"control-4"},{x:Y+bt-T,y:at+kt+W,handle:"control-5"},{x:Y+dt-V,y:at+Mt-lt,handle:"control-6"},{x:Y+dt+V,y:at+Mt-lt,handle:"control-7"},{x:Y+dt+V,y:at+Mt+lt,handle:"control-8"},{x:Y+dt-V,y:at+Mt+lt,handle:"control-9"}];for(const J of yt)if(Math.abs(_.x-J.x)<=C&&Math.abs(_.y-J.y)<=C)return{id:v.id,handle:J.handle}}else if(v.type==="star"||v.type==="burst"){const X=(v.shapeRatio!==void 0?v.shapeRatio:25)/100,q=v.x+v.width/2,ct=v.y+v.height*X;if(Math.abs(_.x-q)<=C&&Math.abs(_.y-ct)<=C)return{id:v.id,handle:"control-1"}}if((v.type==="line"||v.type==="arrow"||v.type==="bezier"||v.type==="organicBranch")&&v.controlPoints)if(v.controlPoints.length===1){const X=v.controlPoints[0];let q={x:v.x,y:v.y},ct={x:v.x+v.width,y:v.y+v.height};if(v.points&&v.points.length>=2){const Y=Yt(v.points);Y.length>0&&(q={x:v.x+Y[0].x,y:v.y+Y[0].y},ct={x:v.x+Y[Y.length-1].x,y:v.y+Y[Y.length-1].y})}const tt=.25*q.x+.5*X.x+.25*ct.x,et=.25*q.y+.5*X.y+.25*ct.y;if(Math.abs(u-tt)<=C/2&&Math.abs(M-et)<=C/2)return{id:v.id,handle:"control-0"}}else for(let X=0;X<v.controlPoints.length;X++){const q=v.controlPoints[X];if(Math.abs(u-q.x)<=C/2&&Math.abs(M-q.y)<=C/2)return{id:v.id,handle:`control-${X}`}}if(v.type!=="line"&&v.type!=="arrow"){const X=14/A,q=32/A,ct=v.x+v.width/2,tt=v.y+v.height/2,et=[{type:"connector-top",x:ct,y:v.y-q},{type:"connector-right",x:v.x+v.width+q,y:tt},{type:"connector-bottom",x:ct,y:v.y+v.height+q},{type:"connector-left",x:v.x-q,y:tt}];for(const Y of et)if(Math.sqrt(Math.pow(_.x-Y.x,2)+Math.pow(_.y-Y.y,2))<=X/2+2/A)return{id:v.id,handle:Y.type}}}return null},Vn=u=>{if(!u.points||u.points.length===0)return null;const M=Yt(u.points);let A=1/0,C=1/0,O=-1/0,L=-1/0;M.forEach(G=>{A=Math.min(A,G.x),C=Math.min(C,G.y),O=Math.max(O,G.x),L=Math.max(L,G.y)});const v=O-A,H=L-C,I=M.map(G=>({x:G.x-A,y:G.y-C}));return{x:u.x+A,y:u.y+C,width:v,height:H,points:I}},He=(u,M,A,C,O)=>{if(wn(u,f.elements,O))return!1;const L=u.x+u.width/2,v=u.y+u.height/2,H=hn(M,A,L,v,u.angle||0);let I=Math.min(u.x,u.x+u.width),G=Math.max(u.x,u.x+u.width),_=Math.min(u.y,u.y+u.height),z=Math.max(u.y,u.y+u.height);if(u.type==="solidBlock"){const N=u.depth!==void 0?u.depth:50,X=(u.viewAngle!==void 0?u.viewAngle:45)*Math.PI/180,q=N*Math.cos(X),ct=N*Math.sin(X);I=Math.min(I,I+q,G+q),G=Math.max(G,I+q,G+q),_=Math.min(_,_+ct,z+ct),z=Math.max(z,_+ct,z+ct)}else if(u.type==="perspectiveBlock"){const N=u.depth!==void 0?u.depth:50,X=(u.viewAngle!==void 0?u.viewAngle:45)*Math.PI/180,q=(u.skewX||0)*u.width,ct=(u.skewY||0)*u.height,tt=N*Math.cos(X)+q,et=N*Math.sin(X)+ct,Y=u.taper||0,at=u.width/2*(1-Y),bt=u.height/2*(1-Y),kt=u.x+u.width/2,j=u.y+u.height/2,T=kt+tt-at,W=kt+tt+at,k=j+et-bt,V=j+et+bt;I=Math.min(I,T,W),G=Math.max(G,T,W),_=Math.min(_,k,V),z=Math.max(z,k,V)}if(H.x<I-C||H.x>G+C||H.y<_-C||H.y>z+C)return!1;if(u.type==="rectangle"||u.type==="solidBlock"||u.type==="isometricCube"||u.type==="perspectiveBlock")return!0;if(u.type==="diamond"){const N=u.x+u.width/2,X=u.y+u.height/2,q=Math.abs(H.x-N),ct=Math.abs(H.y-X);return 2*q/u.width+2*ct/u.height<=1}else{if(u.type==="circle")return Hh(H,u.x,u.y,u.width,u.height,C);if(u.type==="line"||u.type==="arrow"){const N=u.x+u.width,X=u.y+u.height;if(u.curveType==="bezier"){const q=u.width,ct=u.height;let tt={x:u.x,y:u.y},et={x:N,y:X};if(u.controlPoints&&u.controlPoints.length>0){const Y={x:u.x,y:u.y},at={x:N,y:X};if(u.controlPoints.length===2)return di(H,Y,u.controlPoints[0],u.controlPoints[1],at,C);{const bt=u.controlPoints[0],kt={x:Y.x+2/3*(bt.x-Y.x),y:Y.y+2/3*(bt.y-Y.y)},j={x:at.x+2/3*(bt.x-at.x),y:at.y+2/3*(bt.y-at.y)};return di(H,Y,kt,j,at,C)}}else return Math.abs(q)>Math.abs(ct)?(tt={x:u.x+q/2,y:u.y},et={x:N-q/2,y:X},di(H,{x:u.x,y:u.y},tt,et,{x:N,y:X},C)):(tt={x:u.x,y:u.y+ct/2},et={x:N,y:X-ct/2},di(H,{x:u.x,y:u.y},tt,et,{x:N,y:X},C))}else if(u.curveType==="elbow"){const q=Yt(u.points);if(q&&q.length>0){const ct={x:H.x-u.x,y:H.y-u.y};return Pi(ct,q,C)}else return zo(H,{x:u.x,y:u.y},{x:N,y:X})<=C}else{if(u.points&&u.points.length>0){const q=Yt(u.points);if(q.length>1){const ct={x:H.x-u.x,y:H.y-u.y};return Pi(ct,q,C)}}return zo(H,{x:u.x,y:u.y},{x:u.x+u.width,y:u.y+u.height})<=C}}else if(u.type==="organicBranch"){const N=Yt(u.points),X=u.controlPoints||[];if(N.length<2||X.length<2)return!1;const q={x:u.x+N[0].x,y:u.y+N[0].y},ct={x:u.x+N[N.length-1].x,y:u.y+N[N.length-1].y},tt=Ys(q,ct,X[0],X[1],u.strokeWidth);return Wh(H,tt)}else if((u.type==="fineliner"||u.type==="inkbrush"||u.type==="marker")&&u.points){const N={x:H.x-u.x,y:H.y-u.y},X=Yt(u.points);return Pi(N,X,C)}else{if(u.type==="text"||u.type==="image")return!0;if(u.type==="triangle"||u.type==="hexagon"||u.type==="octagon"||u.type==="parallelogram"||u.type==="star"||u.type==="cloud"||u.type==="heart"||u.type==="cross"||u.type==="checkmark"||u.type==="arrowLeft"||u.type==="arrowRight"||u.type==="arrowUp"||u.type==="arrowDown"||u.type==="capsule"||u.type==="stickyNote"||u.type==="callout"||u.type==="burst"||u.type==="speechBubble"||u.type==="ribbon"||u.type==="bracketLeft"||u.type==="bracketRight"||u.type==="database"||u.type==="document"||u.type==="predefinedProcess"||u.type==="internalStorage"||u.type==="server"||u.type==="loadBalancer"||u.type==="firewall"||u.type==="user"||u.type==="messageQueue"||u.type==="lambda"||u.type==="router"||u.type==="browser"||u.type==="trapezoid"||u.type==="rightTriangle"||u.type==="pentagon"||u.type==="septagon"||u.type==="starPerson"||u.type==="scroll"||u.type==="wavyDivider"||u.type==="doubleBanner"||u.type==="lightbulb"||u.type==="signpost"||u.type==="burstBlob"||u.type==="browserWindow"||u.type==="mobilePhone"||u.type==="ghostButton"||u.type==="inputField"||u.type==="polygon"||u.type==="dfdProcess"||u.type==="dfdDataStore"||u.type==="cylinder"||u.type==="stateStart"||u.type==="stateEnd"||u.type==="stateSync"||u.type==="activationBar"||u.type==="externalEntity"||u.type==="umlClass"||u.type==="umlInterface"||u.type==="umlActor"||u.type==="umlUseCase"||u.type==="umlNote"||u.type==="umlPackage"||u.type==="umlComponent"||u.type==="umlState"||u.type==="umlLifeline"||u.type==="umlFragment"||u.type==="umlSignalSend"||u.type==="umlSignalReceive"||u.type==="umlProvidedInterface"||u.type==="umlRequiredInterface")return!0}}return!1},be=u=>u.locked?!1:!gs(u.layerId),Ne=(u,M,A)=>{const C=40/f.viewState.scale,O=25/f.viewState.scale;let L=null;for(const v of f.elements){if(v.id===A||!be(v)||v.type==="line"||v.type==="arrow"||v.type==="bezier"||v.type==="organicBranch")continue;const H=f.layers.find(G=>G.id===f.activeLayerId);if(!H||v.layerId!==H.id)continue;let I=!1;if(v.type==="text"||v.type==="image"||v.type==="rectangle")u>=v.x-C&&u<=v.x+v.width+C&&M>=v.y-C&&M<=v.y+v.height+C&&(I=!0);else if(v.type==="circle"){const G=v.x+v.width/2,_=v.y+v.height/2,z=v.width/2+C,N=v.height/2+C;(u-G)**2/z**2+(M-_)**2/N**2<=1&&(I=!0)}else v.type,u>=v.x-C&&u<=v.x+v.width+C&&M>=v.y-C&&M<=v.y+v.height+C&&(I=!0);if(I){L=v;break}}if(L){const v=Nh(L,{x:u,y:M},O);if(v)return{element:L,snapPoint:{x:v.x,y:v.y},position:v.position};const H=mo(L,{x:u,y:M},5);if(H)return{element:L,snapPoint:H,position:"edge"}}return null},Mn=(u,M,A,C,O)=>{const L=M??u.x,v=A??u.y,H=C??u.x+u.width,I=O??u.y+u.height;if(u.curveType==="elbow"){const G=f.elements.find(N=>N.id===u.startBinding?.elementId),_=f.elements.find(N=>N.id===u.endBinding?.elementId);return Fh({x:L,y:v},{x:H,y:I},f.elements,G,_,u.startBinding?.position,u.endBinding?.position).map(N=>({x:N.x-L,y:N.y-v}))}if(u.points&&u.points.length>=2)return[0,0,H-L,I-v]},Pn=u=>{const M=f.elements.find(G=>G.id===u);if(!M||M.type!=="line"&&M.type!=="arrow"&&M.type!=="organicBranch"&&M.type!=="bezier")return;let A=M.x,C=M.y,O=M.x+M.width,L=M.y+M.height,v=!1;const H=M.startBinding?f.elements.find(G=>G.id===M.startBinding?.elementId):null,I=M.endBinding?f.elements.find(G=>G.id===M.endBinding?.elementId):null;if(H&&I){const G=H.x+H.width/2,_=H.y+H.height/2,z=I.x+I.width/2,N=I.y+I.height/2,X=z-G,q=N-_,ct=M.startBinding?.position,tt=M.endBinding?.position;let et,Y;if(Math.abs(X)>Math.abs(q)?(et=X>0?"right":"left",Y=X>0?"left":"right"):(et=q>0?"bottom":"top",Y=q>0?"top":"bottom"),ct!==et||tt!==Y)return nt(M.id,{startBinding:{...M.startBinding,position:et},endBinding:{...M.endBinding,position:Y}},!1),Pn(u)}if(M.startBinding){const G=H||f.elements.find(_=>_.id===M.startBinding.elementId);if(G){const _=M.startBinding.position;let z;if(_&&_!=="edge"){const X=$i(G).find(q=>q.position===_);X&&(z={x:X.x,y:X.y})}z||(z=mo(G,{x:O,y:L},M.startBinding.gap)),z&&(A=z.x,C=z.y,v=!0)}}if(M.endBinding){const G=I||f.elements.find(_=>_.id===M.endBinding.elementId);if(G){const _=M.endBinding.position;let z;if(_&&_!=="edge"){const X=$i(G).find(q=>q.position===_);X&&(z={x:X.x,y:X.y})}z||(z=mo(G,{x:A,y:C},M.endBinding.gap)),z&&(O=z.x,L=z.y,v=!0)}}if(v){const G=Mn(M,A,C,O,L);if(A!==M.x||C!==M.y||O-A!==M.width||L-C!==M.height||JSON.stringify(G)!==JSON.stringify(M.points)){const _={x:A,y:C,width:O-A,height:L-C,points:G};if(M.controlPoints&&M.controlPoints.length===2){const N=A-M.x,X=C-M.y,q=O-(M.x+M.width),ct=L-(M.y+M.height),tt={x:M.controlPoints[0].x+N,y:M.controlPoints[0].y+X},et={x:M.controlPoints[1].x+q,y:M.controlPoints[1].y+ct};_.controlPoints=[tt,et]}nt(M.id,_,!1)}}},Jn=u=>{if(f.appMode==="presentation"){if(f.docType==="slides"){u.button===0&&Ja();return}else if(u.button===0||u.button===1){x=!0,l=u.clientX,c=u.clientY,u.currentTarget.setPointerCapture(u.pointerId);return}}u.currentTarget.setPointerCapture(u.pointerId);const{x:M,y:A}=$e(u.clientX,u.clientY);if(d()){$n();return}if(f.selectedTool==="selection"){const X=Ye(M,A);if(X){if(X.handle==="mindmap-toggle"){Eo(X.id);return}if(X.handle.startsWith("connector-")){const j=f.elements.find(T=>T.id===X.id);if(j){const T=X.handle.replace("connector-",""),W=j.x+j.width/2,k=j.y+j.height/2;let V,lt;switch(T){case"top":V=W,lt=j.y;break;case"right":V=j.x+j.width,lt=k;break;case"bottom":V=W,lt=j.y+j.height;break;case"left":V=j.x,lt=k;break;default:V=W,lt=k}Pt(),r=!0,l=V,c=lt,l=V,c=lt,a=fe("arrow"),pt={elementId:j.id,anchorPosition:T,startX:V,startY:lt};const dt={...f.defaultElementStyles,id:a,type:"arrow",x:V,y:lt,width:0,height:0,seed:Math.floor(Math.random()*2**31),layerId:f.activeLayerId,curveType:f.defaultElementStyles.curveType||"straight",startBinding:{elementId:j.id,focus:0,gap:5,position:T}};en(dt);const Mt=j.boundElements||[];nt(j.id,{boundElements:[...Mt,{id:a,type:"arrow"}]});return}}if(Pt(),x=!0,S=X.handle,l=M,c=A,X.id==="multi"){const j=un();if(j){At=j.x,_t=j.y,rt=j.width,ft=j.height,B.clear();const T=new Set(f.selection);f.selection.forEach(W=>{go(W,f.elements).forEach(k=>T.add(k.id))}),f.elements.forEach(W=>{T.has(W.id)&&B.set(W.id,{x:W.x,y:W.y,width:W.width,height:W.height,fontSize:W.fontSize,points:W.points?[...W.points]:void 0})})}}else{const j=f.elements.find(T=>T.id===X.id);j&&(At=j.x,_t=j.y,rt=j.width,ft=j.height,Rt=j.fontSize||20,B.clear(),B.set(j.id,{x:j.x,y:j.y,width:j.width,height:j.height,fontSize:j.fontSize,points:j.points?[...j.points]:void 0}))}return}let q=null;const ct=10/f.viewState.scale,tt=yu(f.elements,f.layers);for(const{groupId:j}of tt){const T=f.elements.filter(k=>k.groupIds&&k.groupIds.includes(j));if(T.some(k=>be(k)&&Le(k.layerId))&&pu(M,A,j,f.elements)){const k=T.map(lt=>lt.id),V=k.every(lt=>f.selection.includes(lt));if(u.shiftKey||u.ctrlKey||u.metaKey?V?$("selection",lt=>lt.filter(dt=>!k.includes(dt))):$("selection",lt=>[...new Set([...lt,...k])]):V||$("selection",k),f.selection.length>0){Pt(),x=!0,S=null,l=M,c=A,B.clear();const lt=new Set(f.selection);f.selection.forEach(dt=>{go(dt,f.elements).forEach(Mt=>lt.add(Mt.id))}),f.elements.forEach(dt=>{lt.has(dt.id)&&B.set(dt.id,{x:dt.x,y:dt.y,width:dt.width,height:dt.height,fontSize:dt.fontSize,points:dt.points?[...dt.points]:void 0,controlPoints:dt.controlPoints?dt.controlPoints.map(Mt=>({...Mt})):void 0})})}return}}const et=new Map;for(const j of f.elements)et.set(j.id,j);const Y=f.elements.map((j,T)=>{const W=f.layers.find(k=>k.id===j.layerId);return{el:j,index:T,layerOrder:W?.order??999,layerVisible:Le(j.layerId)}}).sort((j,T)=>j.layerOrder!==T.layerOrder?T.layerOrder-j.layerOrder:T.index-j.index),at=window.yappyGlobalTime||0,bt=f.appMode==="presentation"||f.isPreviewing,kt=fo(f.elements,at,bt);for(const{el:j,layerVisible:T}of Y){if(!T||!be(j))continue;const W=kt.get(j.id),k=W?{...j,x:W.x,y:W.y,angle:W.angle}:j;if(He(k,M,A,ct,et)){q=j.id;break}}if(q){const j=f.elements.find(k=>k.id===q);let T=[q];if(j&&j.groupIds&&j.groupIds.length>0){const k=j.groupIds[j.groupIds.length-1];T=f.elements.filter(V=>V.groupIds&&V.groupIds.includes(k)).map(V=>V.id)}const W=T.every(k=>f.selection.includes(k));if(u.shiftKey||u.ctrlKey||u.metaKey?W?$("selection",k=>k.filter(V=>!T.includes(V))):$("selection",k=>[...new Set([...k,...T])]):W||$("selection",T),f.selection.length>0){Pt(),x=!0,S=null,l=M,c=A,B.clear();const k=new Set(f.selection);f.selection.forEach(V=>{go(V,f.elements).forEach(lt=>k.add(lt.id))}),f.elements.forEach(V=>{k.has(V.id)&&B.set(V.id,{x:V.x,y:V.y,width:V.width,height:V.height,fontSize:V.fontSize,points:V.points?[...V.points]:void 0,controlPoints:V.controlPoints?V.controlPoints.map(lt=>({...lt})):void 0})})}}else{if(f.selection.length>0){const j=un();if(j){const T=10/f.viewState.scale;if(M>=j.x-T&&M<=j.x+j.width+T&&A>=j.y-T&&A<=j.y+j.height+T){Pt(),x=!0,S=null,l=M,c=A,B.clear(),f.elements.forEach(W=>{f.selection.includes(W.id)&&B.set(W.id,{x:W.x,y:W.y,width:W.width,height:W.height,fontSize:W.fontSize,points:W.points?[...W.points]:void 0,controlPoints:W.controlPoints?W.controlPoints.map(k=>({...k})):void 0})});return}}}!u.shiftKey&&!u.ctrlKey&&!u.metaKey&&($("selection",[]),Rs(!1)),b=!0,l=M,c=A,R({x:M,y:A,w:0,h:0})}return}const C=f.layers.find(X=>X.id===f.activeLayerId);if(!C?.visible){Wt("Cannot draw on a hidden layer. Please show the layer first or select a visible layer.","error");return}if(C?.locked){Wt("Cannot draw on a locked layer. Please unlock the layer first or select an unlocked layer.","error");return}if(f.selectedTool==="text"){const X=fe("text"),q={...f.defaultElementStyles,id:X,type:"text",x:M,y:A,width:100,height:30,text:"",layerId:f.activeLayerId};en(q),h(X),g(""),setTimeout(()=>w?.focus(),0);return}if(f.selectedTool==="laser"){r=!0,It=[{x:M,y:A,timestamp:Date.now()}],ne=Date.now();return}if(f.selectedTool==="ink"){r=!0,l=M,c=A,a=fe("ink");const X={...f.defaultElementStyles,id:a,type:"ink",x:M,y:A,width:0,height:0,strokeColor:"#ef4444",strokeWidth:4,opacity:100,points:[0,0],pointsEncoding:"flat",ttl:Date.now()+3e3,layerId:f.activeLayerId,seed:Math.floor(Math.random()*2**31)};en(X);return}if(f.selectedTool==="eraser"){r=!0;const X=10/f.viewState.scale,q=new Map;for(const ct of f.elements)q.set(ct.id,ct);for(let ct=f.elements.length-1;ct>=0;ct--){const tt=f.elements[ct];be(tt)&&Le(tt.layerId)&&He(tt,M,A,X,q)&&Ue([tt.id])}return}if(f.selectedTool==="pan"){x=!0,oe("grabbing");return}r=!0,re=[],Gt=0;let O=M,L=A;if(f.gridSettings.snapToGrid){const X=wo(M,A,f.gridSettings.gridSize);O=X.x,L=X.y}l=O,c=L,a=fe(f.selectedTool);const v=f.selectedTool,H=v==="bezier"?"line":v,I=v==="bezier"||v==="organicBranch"?"bezier":f.defaultElementStyles.curveType||"straight";let G,_=O,z=L;if(v==="line"||v==="arrow"||v==="bezier"||v==="organicBranch"){const X=Ne(O,L,a);X&&(G={elementId:X.element.id,focus:0,gap:5,position:X.position},_=X.snapPoint.x,z=X.snapPoint.y,l=_,c=z)}const N={...f.defaultElementStyles,id:a,type:H,x:_,y:z,width:0,height:0,seed:Math.floor(Math.random()*2**31)+1,layerId:f.activeLayerId,curveType:I,points:v==="fineliner"||v==="inkbrush"||v==="marker"?[0,0]:void 0,pointsEncoding:v==="fineliner"||v==="inkbrush"||v==="marker"?"flat":void 0,startBinding:G,strokeStyle:["rectangle","circle","diamond","triangle","hexagon","octagon","pentagon","septagon","star","cloud","heart","capsule","stickyNote","callout","speechBubble","database","document","cylinder","isometricCube","solidBlock","perspectiveBlock","umlClass","umlInterface","umlActor","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive"].includes(H)?"solid":f.defaultElementStyles.strokeStyle};if(H==="stickyNote"&&(N.backgroundColor="#fef08a",N.fillStyle="solid",N.strokeColor="#000000"),en(N),G){const X=f.elements.find(q=>q.id===G.elementId);if(X){const q=X.boundElements||[];nt(X.id,{boundElements:[...q,{id:a,type:H}]})}}},so=u=>{if(f.appMode==="presentation"){if(f.docType==="slides")return;x?(Zt({panX:f.viewState.panX+u.movementX,panY:f.viewState.panY+u.movementY}),oe("grabbing")):oe("grab");return}let{x:M,y:A}=$e(u.clientX,u.clientY);if(f.selectedTool==="pan")oe(x?"grabbing":"grab");else if(f.selectedTool==="selection"&&!x){const C=Ye(M,A),O=mt;C?C.handle==="rotate"?oe("grab"):C.handle==="tl"||C.handle==="br"?oe("nwse-resize"):C.handle==="tr"||C.handle==="bl"?oe("nesw-resize"):C.handle==="tm"||C.handle==="bm"?oe("ns-resize"):C.handle==="lm"||C.handle==="rm"?oe("ew-resize"):C.handle.startsWith("connector-")?(oe("crosshair"),mt={elementId:C.id,handle:C.handle}):mt=null:(oe("default"),mt=null),(O&&!mt||!O&&mt||O&&mt&&(O.elementId!==mt.elementId||O.handle!==mt.handle))&&requestAnimationFrame(ce)}if(f.selectedTool==="pan"){x&&Zt({panX:f.viewState.panX+u.movementX,panY:f.viewState.panY+u.movementY});return}if(f.selectedTool==="selection"){if(b){const C=M-l,O=A-c;R({x:C>0?l:l+C,y:O>0?c:c+O,w:Math.abs(C),h:Math.abs(O)});return}if(x&&f.selection.length>0){const C=f.selection[0],O=f.elements.find(L=>L.id===C);if(!O||S&&!be(O))return;if(S){if((O.type==="line"||O.type==="arrow"||O.type==="organicBranch")&&(S==="tl"||S==="br")){const L=Ne(M,A,O.id);L?(D({elementId:L.element.id,px:L.snapPoint.x,py:L.snapPoint.y,position:L.position}),M=L.snapPoint.x,A=L.snapPoint.y):D(null)}else D(null);if(S==="rotate"){const L=O.x+O.width/2,v=O.y+O.height/2,H=Math.atan2(A-v,M-L);nt(C,{angle:H+Math.PI/2})}else{let L=M,v=A;if(f.gridSettings.snapToGrid){const tt=wo(M,A,f.gridSettings.gridSize);L=tt.x,v=tt.y}const H=L-l,I=v-c;let G=At,_=_t,z=rt,N=ft;S==="tl"?(G+=H,_+=I,z-=H,N-=I):S==="tr"?(_+=I,z+=H,N-=I):S==="bl"?(G+=H,z-=H,N+=I):S==="br"?(z+=H,N+=I):S==="tm"?(_+=I,N-=I):S==="bm"?N+=I:S==="lm"?(G+=H,z-=H):S==="rm"&&(z+=H);const X=f.selection.length>1,q=f.elements.find(tt=>tt.id===f.selection[0]);if((u.shiftKey||f.selection.length===1&&q?.constrained)&&rt!==0&&ft!==0){const tt=rt/ft;["tm","bm"].includes(S)?(z=N*tt,G=At+rt/2-z/2):["lm","rm"].includes(S)?(N=z/tt,_=_t+ft/2-N/2):(Math.abs(z)/tt>Math.abs(N)?N=z/tt:z=N*tt,S==="tl"?(G=At+rt-z,_=_t+ft-N):S==="tr"?_=_t+ft-N:S==="bl"&&(G=At+rt-z))}if(S&&S.startsWith("control-")){const tt=parseInt(S.replace("control-",""),10),et=f.elements.find(Y=>Y.id===C);if(et){let Y=et.controlPoints?[...et.controlPoints]:[];for(;Y.length<=tt;)Y.push({x:M,y:A});if(et.controlPoints&&et.controlPoints.length===1&&tt===0){let at={x:et.x,y:et.y},bt={x:et.x+et.width,y:et.y+et.height};if(et.points&&et.points.length>=2){const T=Yt(et.points);T.length>0&&(at={x:et.x+T[0].x,y:et.y+T[0].y},bt={x:et.x+T[T.length-1].x,y:et.y+T[T.length-1].y})}const kt=2*M-.5*at.x-.5*bt.x,j=2*A-.5*at.y-.5*bt.y;Y[0]={x:kt,y:j}}else Y[tt]={x:M,y:A};nt(et.id,{controlPoints:Y})}if(S&&S.startsWith("control-")){const Y=f.elements.find(at=>at.id===C);if(Y){if(Y.type==="isometricCube"&&S==="control-1"){let at=(A-Y.y)/Y.height;at=Math.max(.1,Math.min(.9,at));const bt=Math.round(at*100);let kt=(M-Y.x)/Y.width;kt=Math.max(0,Math.min(1,kt));const j=Math.round(kt*100);nt(Y.id,{shapeRatio:bt,sideRatio:j},!1)}else if((Y.type==="solidBlock"||Y.type==="cylinder")&&S==="control-1"){const at=Y.x+Y.width/2,bt=Y.y+Y.height/2,kt=M-at,j=A-bt;let T=Math.sqrt(kt*kt+j*j);T=Math.round(T);let W=Math.atan2(j,kt),k=Math.round(W*180/Math.PI);k<0&&(k+=360),nt(Y.id,{depth:T,viewAngle:k},!1)}else if(Y.type==="perspectiveBlock"){if(S==="control-1"){const at=Y.x+Y.width/2,bt=Y.y+Y.height/2,kt=M-at-(Y.skewX||0)*Y.width,j=A-bt-(Y.skewY||0)*Y.height;let T=Math.sqrt(kt*kt+j*j),W=Math.atan2(j,kt),k=Math.round(W*180/Math.PI);k<0&&(k+=360),nt(Y.id,{depth:Math.round(T),viewAngle:k},!1)}else if(S==="control-2"||S==="control-3"||S==="control-4"||S==="control-5"){const at=Y.width/2,bt=Y.height/2,kt=Y.x+at,j=Y.y+bt,T=(Y.viewAngle||45)*Math.PI/180,W=Y.depth||50,k=kt+W*Math.cos(T),V=j+W*Math.sin(T),lt=M-k,dt=A-V,Mt=S==="control-3"||S==="control-4"?1:-1,yt=S==="control-4"||S==="control-5"?1:-1,J=Math.sqrt(lt*lt+dt*dt),$t=Math.sqrt(at*at+bt*bt),Ct=Math.max(0,Math.min(1,1-J/$t)),zt=(lt-Mt*at*(1-Ct))/Y.width,ut=(dt-yt*bt*(1-Ct))/Y.height;nt(Y.id,{taper:Ct,skewX:zt,skewY:ut},!1)}else if(S==="control-6"||S==="control-7"||S==="control-8"||S==="control-9"){const at=Y.width/2,bt=Y.height/2,kt=Y.x+at,j=Y.y+bt,T=M-kt,W=A-j,k=S==="control-7"||S==="control-8"?1:-1,V=S==="control-8"||S==="control-9"?1:-1,lt=Math.sqrt(T*T+W*W),dt=Math.sqrt(at*at+bt*bt),Mt=Math.max(0,Math.min(1,1-lt/dt)),yt=(T-k*at*(1-Mt))/Y.width,J=(W-V*bt*(1-Mt))/Y.height;nt(Y.id,{frontTaper:Mt,frontSkewX:yt,frontSkewY:J},!1)}}else if((Y.type==="star"||Y.type==="burst")&&S==="control-1"){let at=(A-Y.y)/Y.height;at=Math.max(.1,Math.min(.9,at));const bt=Math.round(at*100);nt(Y.id,{shapeRatio:bt},!1)}else if(Y.type==="speechBubble"&&S==="control-1"){let at=(M-Y.x)/Y.width,bt=(A-Y.y)/Y.height;at=Math.max(-.5,Math.min(1.5,at)),bt=Math.max(-.5,Math.min(1.5,bt)),nt(Y.id,{tailX:at,tailY:bt},!1)}}}}else if(X){const tt=rt===0?1:z/rt,et=ft===0?1:N/ft;f.selection.forEach(Y=>{const at=B.get(Y);if(!at)return;const bt=at.x-At,kt=at.y-_t,j={x:G+bt*tt,y:_+kt*et,width:at.width*tt,height:at.height*et};if(at.points)if(typeof at.points[0]=="number"){const W=at.points,k=[];for(let V=0;V<W.length;V+=2)k.push(W[V]*tt,W[V+1]*et);j.points=k}else j.points=at.points.map(W=>({x:W.x*tt,y:W.y*et}));const T=f.elements.find(W=>W.id===Y);T&&T.type==="text"&&(j.fontSize=Math.max(8,(at.fontSize||20)*et)),nt(Y,j,!1)})}else{const tt=f.selection[0],et=f.elements.find(Y=>Y.id===tt);if(et){const Y={x:G,y:_,width:z,height:N},at=rt===0?1:z/rt,bt=ft===0?1:N/ft;if(et.type==="text"&&bt>0){let kt=Rt*bt;kt=Math.max(kt,8),Y.fontSize=kt}if((et.type==="fineliner"||et.type==="inkbrush"||et.type==="marker")&&et.points){const kt=B.get(tt);if(kt&&kt.points)if(et.pointsEncoding==="flat"||kt.points.length>0&&typeof kt.points[0]=="number"){const j=kt.points,T=[];for(let W=0;W<j.length;W+=2)T.push(j[W]*at,j[W+1]*bt);Y.points=T}else Y.points=kt.points.map(j=>({x:j.x*at,y:j.y*bt,...j.p!==void 0?{p:j.p}:{}}))}if((et.type==="line"||et.type==="arrow"||et.type==="bezier")&&(Y.points=Mn(et,G,_,G+z,_+N)),et.type==="organicBranch"){Y.points=[0,0,z,N];const kt=G,j=_,T=G+z,W=_+N,k={x:kt+z*.5,y:j},V={x:T-z*.5,y:W};Y.controlPoints=[k,V]}nt(tt,Y,!1)}}}}else{let L=M-l,v=A-c;if(f.gridSettings.objectSnapping&&!u.shiftKey){const I=performance.now();if(I-Dt>=jt){const G=eu(f.selection,f.elements,L,v,5/f.viewState.scale);L=G.dx,v=G.dy,ot(G.guides);const _=nu(f.selection,f.elements,L,v,5/f.viewState.scale);L=_.dx,v=_.dy,ht(_.guides),Dt=I}}else ot([]),ht([]);if(f.gridSettings.snapToGrid&&!u.shiftKey&&Q().length===0){const I=f.gridSettings.gridSize;L=Math.round(L/I)*I,v=Math.round(v/I)*I}const H=u.altKey;B.forEach((I,G)=>{if(H&&!f.selection.includes(G))return;const _=f.elements.find(z=>z.id===G);if(_&&be(_)){const z={x:I.x+L,y:I.y+v};I.controlPoints&&(z.controlPoints=I.controlPoints.map(N=>({x:N.x+L,y:N.y+v}))),nt(G,z,!1),_.boundElements&&_.boundElements.forEach(N=>Pn(N.id))}})}}}if(f.selectedTool==="laser"){const C=Date.now();if(C-ne>=Nt){ne=C;const{x:O,y:L}=$e(u.clientX,u.clientY);It.length>=Te&&It.shift(),It.push({x:O,y:L,timestamp:C}),Qt||(Qt=!0,requestAnimationFrame(()=>{Qt=!1,ce()}))}}if(!r||!a){if(r&&f.selectedTool==="eraser"){const C=10/f.viewState.scale,O=new Map;for(const L of f.elements)O.set(L.id,L);for(let L=f.elements.length-1;L>=0;L--){const v=f.elements[L];be(v)&&Le(v.layerId)&&He(v,M,A,C,O)&&Ue([v.id])}}return}if(f.selectedTool==="fineliner"||f.selectedTool==="marker"||f.selectedTool==="inkbrush"||f.selectedTool==="ink"){const{x:C,y:O}=$e(u.clientX,u.clientY),L=C-l,v=O-c;re.push(L,v);const H=Date.now();H-Gt>=ln?(Gt=H,Xe()):Me||(Me=!0,requestAnimationFrame(()=>{Me=!1,Xe()}))}else{let C=M,O=A;if(f.selectedTool==="line"||f.selectedTool==="arrow"||f.selectedTool==="bezier"||f.selectedTool==="organicBranch"||pt){if(a){const v=Ne(M,A,a);v?(D({elementId:v.element.id,px:v.snapPoint.x,py:v.snapPoint.y,position:v.position}),C=v.snapPoint.x,O=v.snapPoint.y):D(null)}}else D(null);if(!U()&&f.gridSettings.snapToGrid){const v=wo(M,A,f.gridSettings.gridSize);C=v.x,O=v.y}const L={width:C-l,height:O-c};if(f.selectedTool==="organicBranch"){const v=C-l,H=O-c;L.points=[0,0,v,H];const I={x:l+v*.5,y:c},G={x:C-v*.5,y:O};L.controlPoints=[I,G]}nt(a,L)}if(x||r){const L=u.clientX,v=u.clientY;let H=0,I=0;L<50&&(H=10),L>window.innerWidth-50&&(H=-10),v<50&&(I=10),v>window.innerHeight-50&&(I=-10),(H!==0||I!==0)&&Zt({panX:f.viewState.panX+H,panY:f.viewState.panY+I})}(r||x)&&requestAnimationFrame(ce)},Ve=u=>{if(u.currentTarget.releasePointerCapture(u.pointerId),f.appMode==="presentation"){if(f.docType==="slides")return;x=!1;return}if(f.selectedTool==="pan"){x=!1,oe("grab");return}if(f.selectedTool==="laser"){r=!1;const M=()=>{It.length>0&&(ce(),requestAnimationFrame(M))};requestAnimationFrame(M);return}if(pt&&r&&a){if(f.elements.find(A=>A.id===a)){if(U()){const A=U(),C={elementId:A.elementId,focus:0,gap:5};nt(a,{endBinding:C});const O=f.elements.find(L=>L.id===A.elementId);if(O){const L=O.boundElements||[];L.find(v=>v.id===a)||nt(O.id,{boundElements:[...L,{id:a,type:"arrow"}]})}}$("selection",[a])}r=!1,a=null,pt=null,D(null),requestAnimationFrame(ce);return}if(f.selectedTool==="selection"){if(b){const M=P();if(M){const A=[],C=M.x,O=M.y,L=M.w,v=M.h;if(f.elements.forEach(H=>{const I=H.x,G=H.y,_=H.width,z=H.height,N=Math.min(I,I+_),X=Math.max(I,I+_),q=Math.min(G,G+z),ct=Math.max(G,G+z);C<X&&C+L>N&&O<ct&&O+v>q&&A.push(H.id)}),u.shiftKey||u.ctrlKey||u.metaKey){const H=new Set(f.selection);A.forEach(I=>H.add(I)),$("selection",Array.from(H))}else $("selection",A)}b=!1,R(null)}if(x){const M=U();if(M&&f.selection.length===1&&S){const A=f.selection[0],C=f.elements.find(O=>O.id===A);if(C&&(C.type==="line"||C.type==="arrow"||C.type==="organicBranch")){const O=S==="tl",L={elementId:M.elementId,focus:0,gap:5,position:M.position};nt(A,O?{startBinding:L}:{endBinding:L});const v=f.elements.find(H=>H.id===M.elementId);if(v){const H=v.boundElements||[];H.find(I=>I.id===A)||nt(v.id,{boundElements:[...H,{id:A,type:C.type}]})}}}D(null)}x=!1,S=null,B.clear(),ot([]);return}if(r&&a){const M=f.elements.find(A=>A.id===a);if(M){if((M.type==="line"||M.type==="arrow"||M.type==="bezier"||M.type==="organicBranch")&&U()){const C=U(),O={elementId:C.elementId,focus:0,gap:5,position:C.position};nt(a,{endBinding:O});const L=f.elements.find(v=>v.id===C.elementId);if(L){const v=L.boundElements||[];nt(L.id,{boundElements:[...v,{id:a,type:M.type}]})}D(null)}if(["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","browserWindow","mobilePhone","ghostButton","inputField"].includes(M.type))M.width<0&&nt(a,{x:M.x+M.width,width:Math.abs(M.width)}),M.height<0&&nt(a,{y:M.y+M.height,height:Math.abs(M.height)});else if(M.type==="fineliner"||M.type==="inkbrush"||M.type==="marker"||M.type==="ink"){Xe();const C=f.elements.find(O=>O.id===a);if(C&&C.points&&C.points.length>2){const O=Vn({...C,points:C.points});O&&nt(a,O)}}else if(M.type==="organicBranch"){M.x,M.y,M.width,M.height;const C=Math.min(M.x,M.x+M.width),O=Math.min(M.y,M.y+M.height),L=Math.abs(M.width),v=Math.abs(M.height),H=M.x-C,I=M.y-O,G=M.x+M.width-C,_=M.y+M.height-O,z=G-H,N={x:C+H+z*.5,y:O+I},X={x:C+G-z*.5,y:O+_};nt(a,{x:C,y:O,width:L,height:v,points:[H,I,G,_],controlPoints:[N,X]})}["selection","pan","eraser","fineliner","inkbrush","marker","text","block-text"].includes(f.selectedTool)||Tt("selection"),pt&&($("selection",[a]),Tt("selection"))}}r=!1,a=null,pt=null},$n=()=>{const u=d();if(!u)return;const M=f.elements.find(C=>C.id===u);if(!M)return;const A=m().trim();if(M.type==="text")if(A){let C=0,O=0;if(n){const L=n.getContext("2d");if(L){const v=M.fontSize||20;L.font=`${v}px sans-serif`,C=L.measureText(A).width,O=v}}C=Math.max(C,10),O=Math.max(O,10),nt(u,{text:A,width:C,height:O},!0)}else Ue([u]);else{const C=M.type==="line"||M.type==="arrow"||M.type==="organicBranch",O=p();if(M.autoResize&&n&&!C&&O==="containerText"){const L=n.getContext("2d");if(L){const v=Fs(L,M,A);nt(u,{[O]:A,width:v.width,height:v.height},!0)}else nt(u,{[O]:A},!0)}else nt(u,{[O]:A},!0)}h(null),g(""),requestAnimationFrame(ce)},ro=u=>{if(u.preventDefault(),f.selectedTool!=="selection")return;const{x:M,y:A}=$e(u.clientX,u.clientY),C=10/f.viewState.scale,O=new Map;for(const L of f.elements)O.set(L.id,L);for(let L=f.elements.length-1;L>=0;L--){const v=f.elements[L];if(be(v)&&Le(v.layerId)&&He(v,M,A,C,O)){if(["star","burst","speechBubble","isometricCube","solidBlock","perspectiveBlock"].includes(v.type)){const I=Ye(M,A);if(I&&I.handle.startsWith("control-"))return}if(v.type==="line"||v.type==="arrow"||v.type==="bezier"){const I=v.controlPoints?[...v.controlPoints]:[];if(I.length>=2)return;I.push({x:M,y:A}),nt(v.id,{controlPoints:I,curveType:"bezier"},!0);return}if(["rectangle","circle","diamond","line","arrow","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","starPerson","scroll","wavyDivider","doubleBanner","lightbulb","signpost","burstBlob","browserWindow","mobilePhone","ghostButton","inputField","dfdProcess","dfdDataStore","isometricCube","solidBlock","perspectiveBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","umlClass","umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].includes(v.type)){if(h(v.id),v.type==="umlClass"){const I=A-v.y,G=n?.getContext("2d");let _=30;if(v.containerText&&G){const N=xe(G,v,v.containerText,v.width-10);_=Math.max(30,N.textHeight+20)}let z=20;if(v.attributesText&&G){const N=xe(G,{...v,fontSize:(v.fontSize||20)*.9},v.attributesText,v.width-10);z=Math.max(20,N.textHeight+10)}I<_?(y("containerText"),g(v.containerText||"")):I<_+z?(y("attributesText"),g(v.attributesText||"")):(y("methodsText"),g(v.methodsText||""))}else if(v.type==="umlState"){const I=A-v.y,G=n?.getContext("2d");let _=35;if(v.containerText&&G){const z=xe(G,v,v.containerText,v.width-20);_=Math.max(35,z.textHeight+15)}I<_?(y("containerText"),g(v.containerText||"")):(y("attributesText"),g(v.attributesText||""))}else if(v.type==="umlFragment"){const I=A-v.y,G=M-v.x,_=Math.min(v.width*.3,60),z=Math.min(v.height*.12,22)+5;G<_&&I<z?(y("containerText"),g(v.containerText||"")):(y("attributesText"),g(v.attributesText||""))}else y("containerText"),g(v.containerText||"");setTimeout(()=>w?.focus(),0);return}break}}},ao=()=>{d()&&$n()},Je=()=>{const u=d();return u?f.elements.find(M=>M.id===u):null};Ut(()=>{d()&&w&&(w.style.height="auto",w.style.height=w.scrollHeight+"px")});const[lo,Kn]=wt(!1);Ut(()=>{const{scale:u,panX:M,panY:A}=f.viewState;if(!n||f.elements.length===0){Kn(!1);return}const C=-M/u,O=-A/u,L=n.width/u,v=n.height/u;let H=1/0,I=1/0,G=-1/0,_=-1/0;f.elements.forEach(N=>{const X=N.x,q=N.x+N.width,ct=N.y,tt=N.y+N.height;H=Math.min(H,X,q),G=Math.max(G,X,q),I=Math.min(I,ct,tt),_=Math.max(_,ct,tt)});const z=!(H>C+L||G<C||I>O+v||_<O);Kn(!z)});const Ce=()=>{if(f.elements.length===0)return;let u=1/0,M=1/0,A=-1/0,C=-1/0;f.elements.forEach(X=>{const q=X.x,ct=X.x+X.width,tt=X.y,et=X.y+X.height;u=Math.min(u,q,ct),A=Math.max(A,q,ct),M=Math.min(M,tt,et),C=Math.max(C,tt,et)});const O=A-u,L=C-M,v=u+O/2,H=M+L/2,{scale:I}=f.viewState,G=window.innerWidth/2,_=window.innerHeight/2,z=-v*I+G,N=-H*I+_;Zt({panX:z,panY:N})};rn(()=>{Zh(()=>{ce()}),window.addEventListener("resize",Pe),Pe(),te(()=>window.removeEventListener("resize",Pe))});const Ke=()=>{const u=f.selection.length,M=u>0,A=[];if(M){A.push({label:"Copy",shortcut:"Ctrl+C",onClick:to},{label:"Paste",shortcut:"Ctrl+V",onClick:Ni},{label:"Cut",shortcut:"Ctrl+X",onClick:Ms},{label:"Duplicate",shortcut:"Ctrl+D",onClick:()=>f.selection.forEach(_=>nl(_))},{separator:!0});const C=f.selection[0],O=f.elements.find(_=>_.id===C);if(O){const _=[];if(u===1&&(_.push({label:"Add Child",onClick:()=>ss(C)}),O.parentId&&_.push({label:"Add Sibling",onClick:()=>rs(C)}),_.push({separator:!0})),O.parentId&&_.push({label:"Clear Parent",onClick:()=>rh(C)}),f.elements.some(X=>X.parentId===C)&&_.push({label:O.isCollapsed?"Expand Subtree":"Collapse Subtree",onClick:()=>Eo(C)}),u===2){const X=f.selection[0],q=f.selection[1];_.push({label:"Set as Child of Selected",onClick:()=>al(X,q)})}const N=[{label:"Horizontal (Right)",icon:"",onClick:()=>mn(C,"horizontal-right")},{label:"Horizontal (Left)",icon:"",onClick:()=>mn(C,"horizontal-left")},{label:"Vertical (Down)",icon:"",onClick:()=>mn(C,"vertical-down")},{label:"Vertical (Up)",icon:"",onClick:()=>mn(C,"vertical-up")},{label:"Radial (Neuron)",icon:"",onClick:()=>mn(C,"radial")}];_.push({separator:!0}),_.push({label:"Auto Layout",submenu:N,icon:""}),_.push({label:"Auto Style Branch",icon:"",onClick:()=>ll(C)}),_.length>0&&A.push({label:"Hierarchy",submenu:_})}const L=f.selection.map(_=>f.elements.find(z=>z.id===_)).filter(Boolean),v=L.filter(_=>{const z=_.type;return z!=="line"&&z!=="arrow"&&z!=="bezier"&&z!=="organicBranch"&&z!=="text"&&z!=="image"}),H=L.filter(_=>{const z=_.type;return z==="line"||z==="arrow"||z==="bezier"||z==="organicBranch"});if(v.length>0){let _=Gs(v[0].type);new Set(v.map(N=>N.type)).size>1&&_.push(v[0].type),_.length>0&&A.push({label:v.length>1?`Transform ${v.length} Shapes`:"Transform Shape",submenu:_.map(N=>({icon:qs(N),tooltip:js(N),onClick:()=>{Pt(),v.forEach(X=>Us(X.id,N,!1)),requestAnimationFrame(ce)}})),gridColumns:3})}if(H.length>0){let _=Gs(H[0].type);new Set(H.map(N=>N.type)).size>1&&_.push(H[0].type),_.length>0&&A.push({label:H.length>1?`Transform ${H.length} Connectors`:"Transform Connector",submenu:_.map(N=>({icon:qs(N),tooltip:js(N),onClick:()=>{Pt(),H.forEach(X=>Us(X.id,N,!1)),requestAnimationFrame(ce)}})),gridColumns:3})}if(H.length>0){const z=H[0].curveType||"straight",N=du(z);new Set(H.map(q=>q.curveType||"straight")).size>1&&N.push(z),N.length>0&&A.push({label:H.length>1?"Change All Curve Styles":"Change Curve Style",submenu:N.map(q=>({icon:hu(q),tooltip:uu(q),onClick:()=>{Pt(),H.forEach(ct=>nt(ct.id,{curveType:q},!1)),requestAnimationFrame(ce)}})),gridColumns:3})}A.push({separator:!0}),u>1&&A.push({label:"Group",shortcut:"Ctrl+G",onClick:us}),f.selection.some(_=>{const z=f.elements.find(N=>N.id===_);return z?.groupIds&&z.groupIds.length>0})&&A.push({label:"Ungroup",shortcut:"Ctrl+Shift+G",onClick:fs}),A.push({separator:!0}),A.push({label:"Export as PNG",onClick:()=>gu(2,!0,!0)},{label:"Export as SVG",onClick:()=>mu(!0)}),A.push({separator:!0}),A.push({label:"Bring to Front",shortcut:"Ctrl+]",onClick:()=>as(f.selection)},{label:"Send to Back",shortcut:"Ctrl+[",onClick:()=>ls(f.selection)},{label:"Bring Forward",onClick:()=>f.selection.forEach(_=>Io(_,"forward"))},{label:"Send Backward",onClick:()=>f.selection.forEach(_=>Io(_,"backward"))},{separator:!0}),u===1&&A.push({label:"Copy Styles",shortcut:"Ctrl+Alt+C",onClick:Ps},{label:"Paste Styles",shortcut:"Ctrl+Alt+V",onClick:$s},{separator:!0});const G=f.selection.some(_=>f.elements.find(z=>z.id===_)?.locked);A.push({label:G?"Unlock":"Lock",shortcut:"Ctrl+Shift+L",onClick:()=>su(!G)},{label:"Flip Horizontal",shortcut:"Shift+H",onClick:()=>Ns("horizontal")},{label:"Flip Vertical",shortcut:"Shift+V",onClick:()=>Ns("vertical")},{separator:!0},{label:"Delete",shortcut:"Delete",onClick:()=>Ue(f.selection)},{separator:!0},{label:"Show Properties",onClick:()=>Sn(!0)})}else A.push({label:"Paste",shortcut:"Ctrl+V",onClick:Ni},{separator:!0},{label:"Select all",shortcut:"Ctrl+A",onClick:()=>$("selection",f.elements.map(C=>C.id))},{label:"Zoom to Fit",shortcut:"Shift+1",onClick:ps},{separator:!0},{label:"Show Grid",checked:f.gridSettings.enabled,onClick:ms},{label:"Snap to Grid",checked:f.gridSettings.snapToGrid,onClick:xs},{label:"Smart Snapping",checked:f.gridSettings.objectSnapping,onClick:()=>$("gridSettings","objectSnapping",!f.gridSettings.objectSnapping)},{separator:!0},{label:"Zen Mode",shortcut:"Alt+Z",checked:f.zenMode,onClick:ws},{label:"Reset View",onClick:()=>Zt({scale:1,panX:0,panY:0})},{separator:!0},{label:"Canvas Settings",onClick:()=>Rs(!0)});return A};return[(()=>{var u=vu();u.$$contextmenu=A=>{A.preventDefault(),qn({x:A.clientX,y:A.clientY}),Gn(!0)},u.addEventListener("drop",Qn),u.addEventListener("dragover",jn),u.$$dblclick=ro,u.$$pointerup=Ve,u.$$pointermove=so,u.$$pointerdown=Jn,u.addEventListener("wheel",oo);var M=n;return typeof M=="function"?Ot(M,u):n=u,gt(A=>Ft(u,"cursor",cn())),u})(),E(vt,{get when(){return On(()=>f.canvasTexture!=="none"&&f.canvasTexture!=="grid")()&&f.canvasTexture!=="graph"},get children(){var u=Su();return gt(M=>{var A=f.theme==="dark"?.1:.4,C=f.canvasTexture==="paper"?`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opactiy='0.5'/%3E%3C/svg%3E")`:f.canvasTexture==="dots"?`radial-gradient(${f.theme==="dark"?"#ffffff":"#000000"} 1px, transparent 1px)`:"none",O=f.canvasTexture==="dots"?"20px 20px":"auto";return A!==M.e&&Ft(u,"opacity",M.e=A),C!==M.t&&Ft(u,"background-image",M.t=C),O!==M.a&&Ft(u,"background-size",M.a=O),M},{e:void 0,t:void 0,a:void 0}),u}}),E(vt,{get when(){return lo()},get children(){var u=ku(),M=u.firstChild;return M.$$click=Ce,u}}),E(vt,{get when(){return On(()=>!!d())()&&Je()},children:u=>{const M=Je(),A=ja(M.id),C=A?A.x:M.x,O=A?A.y:M.y,L=A?A.width:M.width,v=A?A.height:M.height,{scale:H,panX:I,panY:G}=f.viewState;let _=(C+L/2)*H+I,z=(O+v/2)*H+G,N="center",X=M.fontSize||20;if(M.type==="umlClass"){const q=p();if(q==="attributesText"||q==="methodsText"){N="left",X=X*.9;const ct=n?n.getContext("2d"):null;let tt=30;if(M.containerText&&ct){const at=xe(ct,M,M.containerText,M.width-10);tt=Math.max(30,at.textHeight+20)}let et=tt,Y=20;if(M.attributesText&&ct){const at=xe(ct,{...M,fontSize:X},M.attributesText,M.width-10);Y=Math.max(20,at.textHeight+10)}if(q==="attributesText")z=(O+et+Y/2)*H+G,_=(C+L/2)*H+I;else if(q==="methodsText"){const at=et+Y;z=(O+at+20)*H+G,_=(C+L/2)*H+I}}}return(()=>{var q=Mu();q.$$keydown=tt=>{tt.key==="Escape"&&(tt.preventDefault(),h(null),g(""))},q.addEventListener("blur",ao),q.$$input=tt=>g(tt.currentTarget.value);var ct=w;return typeof ct=="function"?Ot(ct,q):w=q,Ft(q,"top",`${z}px`),Ft(q,"left",`${_}px`),Ft(q,"text-align",N),gt(tt=>{var et=`${X*H}px ${M.fontFamily==="sans-serif"?"Inter, sans-serif":M.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive"}`,Y=M.strokeColor;return et!==tt.e&&Ft(q,"font",tt.e=et),Y!==tt.t&&Ft(q,"color",tt.t=Y),tt},{e:void 0,t:void 0}),gt(()=>q.value=m()),q})()}}),E(vt,{get when(){return no()},get children(){return E(ml,{get x(){return Qe().x},get y(){return Qe().y},get items(){return Ke()},onClose:()=>Gn(!1)})}}),E(vt,{get when(){return f.isRecording},get children(){return E(bu,{onStop:o})}}),E(vt,{get when(){return f.minimapVisible},get children(){return E(ou,{get canvasWidth(){return n?.width||window.innerWidth},get canvasHeight(){return n?.height||window.innerHeight}})}})]};Kt(["pointerdown","pointermove","pointerup","dblclick","contextmenu","click","input","keydown"]);const Tu={A:[{type:"line",x1:50,y1:0,x2:0,y2:100},{type:"line",x1:50,y1:0,x2:100,y2:100},{type:"line",x1:25,y1:50,x2:75,y2:50}],E:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50},{type:"line",x1:0,y1:100,x2:80,y2:100}],F:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50}],H:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:100,y1:0,x2:100,y2:100},{type:"line",x1:0,y1:50,x2:100,y2:50}],I:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:20,y1:0,x2:80,y2:0},{type:"line",x1:20,y1:100,x2:80,y2:100}],K:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:60,x2:80,y2:0},{type:"line",x1:20,y1:45,x2:80,y2:100}],L:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:80,y2:100}],M:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:50,y2:60},{type:"line",x1:50,y1:60,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:100,y2:100}],N:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:100,x2:100,y2:0}],T:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:0,y1:0,x2:100,y2:0}],V:[{type:"line",x1:0,y1:0,x2:50,y2:100},{type:"line",x1:50,y1:100,x2:100,y2:0}],W:[{type:"line",x1:0,y1:0,x2:25,y2:100},{type:"line",x1:25,y1:100,x2:50,y2:40},{type:"line",x1:50,y1:40,x2:75,y2:100},{type:"line",x1:75,y1:100,x2:100,y2:0}],X:[{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:0,x2:0,y2:100}],Y:[{type:"line",x1:0,y1:0,x2:50,y2:50},{type:"line",x1:100,y1:0,x2:50,y2:50},{type:"line",x1:50,y1:50,x2:50,y2:100}],Z:[{type:"line",x1:0,y1:0,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:100,y2:100}],B:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:70,c1y:0,c2x:70,c2y:50},{type:"bezier",x1:0,y1:50,x2:0,y2:100,c1x:80,c1y:50,c2x:80,c2y:100}],C:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100}],D:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:100,c1x:100,c1y:0,c2x:100,c2y:100}],G:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"line",x1:80,y1:80,x2:80,y2:50},{type:"line",x1:80,y1:50,x2:50,y2:50}],J:[{type:"bezier",x1:60,y1:0,x2:40,y2:80,c1x:60,c1y:100,c2x:0,c2y:100}],O:[{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:110,c1y:0,c2x:110,c2y:100}],P:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50}],Q:[{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:-10,c1y:0,c2x:-10,c2y:90},{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:110,c1y:0,c2x:110,c2y:90},{type:"line",x1:60,y1:70,x2:90,y2:100}],R:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50},{type:"line",x1:20,y1:50,x2:80,y2:100}],S:[{type:"bezier",x1:80,y1:20,x2:50,y2:50,c1x:10,c1y:10,c2x:20,c2y:50},{type:"bezier",x1:50,y1:50,x2:20,y2:80,c1x:80,c1y:50,c2x:90,c2y:90}],U:[{type:"bezier",x1:0,y1:0,x2:100,y2:0,c1x:0,c1y:120,c2x:100,c2y:120}]},Iu=(n,t,e,s=60,i="#000000")=>{const o=[],r=fe("group"),a=s*.4;let l=t;const c=d=>d/100*s;for(let d=0;d<n.length;d++){const h=n[d].toUpperCase();if(h===" "){l+=s*.5;continue}const p=Tu[h];if(!p){const y=s,g={id:fe("rectangle"),type:"rectangle",x:l,y:e,width:y,height:y,strokeColor:i,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[r],fontSize:16,textAlign:"center",verticalAlign:"middle",containerText:"?"};o.push(g),l+=y+a;continue}p.forEach(y=>{const g={id:fe("line"),strokeColor:i,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:3,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[r]};if(y.type==="line")g.type="line",g.x=l+c(y.x1),g.y=e+c(y.y1),g.width=c(y.x2-y.x1),g.height=c(y.y2-y.y1),g.startArrowhead=null,g.endArrowhead=null;else if(y.type==="bezier"){g.type="line",g.curveType="bezier",g.startArrowhead=null,g.endArrowhead=null,g.x=l+c(y.x1),g.y=e+c(y.y1),g.width=c(y.x2-y.x1),g.height=c(y.y2-y.y1);const w=l+c(y.c1x),x=e+c(y.c1y),b=l+c(y.c2x),S=e+c(y.c2y);g.controlPoints=[{x:w,y:x},{x:b,y:S}]}o.push(g)}),l+=s+a}return o};var Lu=it('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="lucide lucide-marker"><path d="M12 2l7 7-9 9-4-4L12 2z"></path><path d="M7 13l-1.5 1.5">'),Eu=it("<div class=pen-tool-dropdown>"),Au=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Ru=it("<button>");const Du=n=>(()=>{var t=Lu();return gt(e=>{var s=n.size||24,i=n.size||24;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),So=[{type:"fineliner",icon:Cl,label:"Fine Liner (P or 8)"},{type:"inkbrush",icon:Tl,label:"Ink Brush"},{type:"marker",icon:Du,label:"Marker"}],Ou=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const d=h=>{const p=h.target;e?.contains(p)||s?.contains(p)||t(!1)};document.addEventListener("pointerdown",d),te(()=>document.removeEventListener("pointerdown",d))}});const i=()=>So.find(d=>d.type===f.selectedPenType)||So[0],o=()=>["fineliner","inkbrush","marker"].includes(f.selectedTool),r=d=>{Nd(d),Tt(d),t(!1)},a=d=>{d.preventDefault(),f.showPropertyPanel||Tt(f.selectedTool),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},l=()=>{o()||Tt(f.selectedPenType),t(!n())},c=()=>{if(!e)return{};const d=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Au(),h=d.firstChild,p=h.firstChild;h.$$contextmenu=a,h.$$click=l;var y=e;return typeof y=="function"?Ot(y,h):e=h,F(p,()=>{const m=i().icon;return E(m,{size:20})},null),F(p,E(Be,{size:10,class:"submenu-indicator"}),null),F(d,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var m=Eu(),g=s;return typeof g=="function"?Ot(g,m):s=m,F(m,E(tn,{each:So,children:w=>(()=>{var x=Ru();return we(x,"click",()=>r(w.type)),F(x,E(w.icon,{size:18})),gt(b=>{var S=`dropdown-item ${f.selectedPenType===w.type?"active":""}`,P=w.label;return S!==b.e&&Ht(x,b.e=S),P!==b.t&&xt(x,"title",b.t=P),b},{e:void 0,t:void 0}),x})()})),gt(w=>We(m,c(),w)),m}})}}),null),gt(m=>{var g=`toolbar-btn ${o()?"active":""}`,w=`${i().label} (P or 8 - Click for more)`;return g!==m.e&&Ht(h,m.e=g),w!==m.t&&xt(h,"title",m.t=w),m},{e:void 0,t:void 0}),d})()};Kt(["click","contextmenu"]);var _u=it("<div class=pen-tool-dropdown>"),Bu=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),zu=it("<button>");const ui=[{type:"database",icon:jo,label:"Database"},{type:"document",icon:Vs,label:"Document"},{type:"predefinedProcess",icon:Il,label:"Predefined Process"},{type:"internalStorage",icon:Qo,label:"Internal Storage"},{type:"capsule",icon:Ll,label:"Capsule (Node)"},{type:"stickyNote",icon:El,label:"Sticky Note"},{type:"callout",icon:Al,label:"Callout (Thought)"},{type:"speechBubble",icon:Rl,label:"Speech Bubble"},{type:"burst",icon:Vo,label:"Burst (Impact)"},{type:"ribbon",icon:Dl,label:"Ribbon (Title)"},{type:"bracketLeft",icon:Js,label:"Left Bracket"},{type:"bracketRight",icon:Ks,label:"Right Bracket"},{type:"triangle",icon:Ol,label:"Triangle"},{type:"hexagon",icon:_l,label:"Hexagon"},{type:"octagon",icon:Bl,label:"Octagon"},{type:"parallelogram",icon:Fi,label:"Parallelogram"},{type:"star",icon:zl,label:"Star"},{type:"polygon",icon:Zs,label:"Polygon (Parametric)"},{type:"cloud",icon:Wl,label:"Cloud"},{type:"heart",icon:Xl,label:"Heart"},{type:"cross",icon:qo,label:"Cross (X)"},{type:"checkmark",icon:Ie,label:"Checkmark"},{type:"arrowLeft",icon:Yl,label:"Arrow Left"},{type:"arrowRight",icon:Hl,label:"Arrow Right"},{type:"arrowUp",icon:Nl,label:"Arrow Up"},{type:"arrowDown",icon:tr,label:"Arrow Down"}],Wu=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>ui.find(p=>p.type===f.selectedShapeType)||ui[0],o=h=>{Fd(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedShapeType),t(!n())},l=()=>i(),c=()=>ui.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Bu(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=_u(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>ui.map(x=>(()=>{var b=zu();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=`${l().label} (Click for more)`;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var Xu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=7 r=3></circle><path d="M 12,10 L 5,13 L 12,15 L 19,13 L 12,10"></path><path d="M 12,15 L 9,21"></path><path d="M 12,15 L 15,21">'),Yu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,4 L 18,4 L 18,20 L 6,20 Z"></path><path d="M 6,4 C 4,4 4,2 6,2 L 18,2 C 20,2 20,4 18,4"></path><path d="M 6,20 C 4,20 4,22 6,22 L 18,22 C 20,22 20,20 18,20">'),Hu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 2,12 C 5,8 8,16 11,12 C 14,8 17,16 20,12">'),Nu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 5,6 L 19,6 L 19,14 L 5,14 Z"></path><path d="M 5,8 L 2,10 L 5,12"></path><path d="M 19,8 L 22,10 L 19,12"></path><path d="M 5,14 L 5,16 L 3,16"></path><path d="M 19,14 L 19,16 L 21,16">'),Fu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=9 y1=18 x2=15 y2=18></line><line x1=10 y1=22 x2=14 y2=22></line><path d="M 15.09,14 C 15.09,14 17,12.5 17,10.6 C 17,7.5 14.5,5 11,5 C 7.5,5 5,7.5 5,10.6 C 5,12.5 6.91,14 6.91,14">'),Uu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=12 y1=3 x2=12 y2=22></line><path d="M 4,6 L 18,6 L 21,9 L 18,12 L 4,12 Z"></path><circle cx=12 cy=9 r=1 fill=currentColor stroke=none>'),Gu=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 14.5,8 L 21,9 L 16.5,14 L 18,21 L 12,17 L 6,21 L 7.5,14 L 3,9 L 9.5,8 Z">'),qu=it("<div class=pen-tool-dropdown>"),ju=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Qu=it("<button>");const Vu=n=>(()=>{var t=Xu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Ju=n=>(()=>{var t=Yu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Ku=n=>(()=>{var t=Hu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Zu=n=>(()=>{var t=Nu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),tf=n=>(()=>{var t=Fu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),ef=n=>(()=>{var t=Uu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),nf=n=>(()=>{var t=Gu();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),fi=[{type:"starPerson",icon:Vu,label:"Star Person (Character)"},{type:"lightbulb",icon:tf,label:"Lightbulb (Idea)"},{type:"signpost",icon:ef,label:"Signpost (Direction)"},{type:"burstBlob",icon:nf,label:"Jagged Burst (Impact)"},{type:"scroll",icon:Ju,label:"Scroll Container"},{type:"wavyDivider",icon:Ku,label:"Wavy Divider"},{type:"doubleBanner",icon:Zu,label:"Double Banner"}],of=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>fi.find(p=>p.type===f.selectedSketchnoteType)||fi[0],o=h=>{qd(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedSketchnoteType),t(!n())},l=()=>i(),c=()=>fi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=ju(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=qu(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>fi.map(x=>(()=>{var b=Qu();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=l().label;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var sf=it("<div class=pen-tool-dropdown>"),rf=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),af=it("<button>");const pi=[{type:"database",icon:jo,label:"Database"},{type:"server",icon:Fl,label:"Server"},{type:"loadBalancer",icon:Ul,label:"Load Balancer"},{type:"firewall",icon:Gl,label:"Firewall"},{type:"user",icon:er,label:"User / Client"},{type:"messageQueue",icon:ql,label:"Message Queue"},{type:"lambda",icon:Vo,label:"Lambda / Function"},{type:"router",icon:jl,label:"Router"},{type:"browser",icon:Ql,label:"Browser / Web"}],lf=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>pi.find(p=>p.type===f.selectedInfraType)||pi[0],o=h=>{Ud(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedInfraType),t(!n())},l=()=>i(),c=()=>pi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=rf(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=sf(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>pi.map(x=>(()=>{var b=af();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=l().label;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var cf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 4,18 L 8,6 L 16,6 L 20,18 Z">'),df=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,6 L 6,18 L 18,18 Z">'),hf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 19,5 L 22,12 L 19,19 L 12,22 L 5,19 L 2,12 L 5,5 Z">'),uf=it("<div class=pen-tool-dropdown>"),ff=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),pf=it("<button>");const yf=n=>(()=>{var t=cf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),gf=n=>(()=>{var t=df();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),mf=n=>(()=>{var t=hf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),yi=[{type:"trapezoid",icon:yf,label:"Trapezoid"},{type:"rightTriangle",icon:gf,label:"Right-Angle Triangle"},{type:"pentagon",icon:Zs,label:"Pentagon"},{type:"septagon",icon:mf,label:"Septagon (Heptagon)"}],xf=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>yi.find(p=>p.type===f.selectedMathType)||yi[0],o=h=>{Gd(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedMathType),t(!n())},l=()=>i(),c=()=>yi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=ff(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=uf(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>yi.map(x=>(()=>{var b=pf();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=l().label;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var wf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=2 y=3 width=20 height=18 rx=2 ry=2></rect><line x1=2 y1=8 x2=22 y2=8></line><circle cx=5 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=7 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=9 cy=5.5 r=0.5 fill=currentColor>'),bf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=5 y=2 width=14 height=20 rx=2 ry=2></rect><path d="M10 4h4"></path><path d="M11 19h2">'),vf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-dasharray="2 2"><rect x=3 y=6 width=18 height=12 rx=2 ry=2>'),Sf=it('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><rect x=3 y=7 width=18 height=10 rx=1></rect><line x1=7 y1=10 x2=7 y2=14>'),kf=it("<div class=pen-tool-dropdown>"),Mf=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Pf=it("<button>");const $f=n=>(()=>{var t=wf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Cf=n=>(()=>{var t=bf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Tf=n=>(()=>{var t=vf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),If=n=>(()=>{var t=Sf();return gt(e=>{var s=n.size||20,i=n.size||20;return s!==e.e&&xt(t,"width",e.e=s),i!==e.t&&xt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),gi=[{type:"browserWindow",icon:$f,label:"Browser Window"},{type:"mobilePhone",icon:Cf,label:"Mobile Phone"},{type:"ghostButton",icon:Tf,label:"Ghost Button"},{type:"inputField",icon:If,label:"Input Field"}],Lf=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>gi.find(p=>p.type===f.selectedWireframeType)||gi[0],o=h=>{jd(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedWireframeType),t(!n())},l=()=>i(),c=()=>gi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Mf(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=kf(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>gi.map(x=>(()=>{var b=Pf();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=l().label;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var Ef=it("<div class=pen-tool-dropdown>"),Af=it('<div class=pen-tool-group><button title="Mindmap Tools"><div class=tool-icon-wrapper>'),Rf=it("<button>");const En=[{type:"organicBranch",icon:Vl,label:"Organic Branch"},{type:"cloud",icon:Jl,label:"Central Topic (Cloud)"},{type:"circle",icon:Kl,label:"Topic (Circle)"}],Df=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>{const h=En.find(y=>y.type===f.selectedTool);return h||En.find(y=>y.type===f.selectedShapeType)||En[0]},o=h=>{Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(i().type),t(!n())},l=()=>i(),c=()=>En.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Af(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=Ef(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>En.map(x=>(()=>{var b=Rf();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(()=>Ht(p,`toolbar-btn ${c()?"active":""}`)),h})()};Kt(["click","contextmenu"]);var Of=it("<div class=pen-tool-dropdown>"),_f=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Bf=it("<button>");const mi=[{type:"dfdProcess",icon:Zl,label:"DFD Process"},{type:"dfdDataStore",icon:tc,label:"DFD Data Store"},{type:"isometricCube",icon:ec,label:"Isometric Cube"},{type:"solidBlock",icon:nc,label:"Solid Block"},{type:"perspectiveBlock",icon:ic,label:"Perspective Block"},{type:"cylinder",icon:jo,label:"Cylinder"},{type:"stateStart",icon:Jo,label:"Initial State"},{type:"stateEnd",icon:nr,label:"Final State"},{type:"stateSync",icon:Ko,label:"Sync Bar"},{type:"activationBar",icon:oc,label:"Activation Bar"},{type:"externalEntity",icon:Qo,label:"External Entity"}],zf=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>mi.find(p=>p.type===f.selectedTechnicalType)||mi[0],o=h=>{th(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedTechnicalType),t(!n())},l=()=>i(),c=()=>mi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=_f(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=Of(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>mi.map(x=>(()=>{var b=Bf();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=l().label;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var Wf=it("<div class=pen-tool-dropdown>"),Xf=it("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Yf=it("<button>");const xi=[{type:"umlClass",icon:gn,label:"Class"},{type:"umlInterface",icon:sc,label:"Interface"},{type:"umlActor",icon:er,label:"Actor"},{type:"umlUseCase",icon:Jo,label:"Use Case"},{type:"umlNote",icon:Vs,label:"Note"},{type:"umlPackage",icon:rc,label:"Package"},{type:"umlComponent",icon:ac,label:"Component"},{type:"umlState",icon:lc,label:"State"},{type:"umlLifeline",icon:tr,label:"Lifeline"},{type:"umlFragment",icon:cc,label:"Fragment"},{type:"umlSignalSend",icon:Ks,label:"Signal Send"},{type:"umlSignalReceive",icon:Js,label:"Signal Receive"},{type:"umlProvidedInterface",icon:nr,label:"Provided"},{type:"umlRequiredInterface",icon:dc,label:"Required"}],Hf=()=>{const[n,t]=wt(!1);let e,s;Ut(()=>{if(n()){const h=p=>{const y=p.target;e?.contains(y)||s?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),te(()=>document.removeEventListener("pointerdown",h))}});const i=()=>xi.find(p=>p.type===f.selectedUmlType)||xi[0],o=h=>{eh(h),Tt(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{c()||Tt(f.selectedUmlType),t(!n())},l=()=>i(),c=()=>xi.some(h=>h.type===f.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Xf(),p=h.firstChild,y=p.firstChild;p.$$contextmenu=r,p.$$click=a;var m=e;return typeof m=="function"?Ot(m,p):e=p,F(y,()=>{const g=l().icon;return E(g,{size:20})},null),F(y,E(Be,{size:10,class:"submenu-indicator"}),null),F(h,E(vt,{get when(){return n()},get children(){return E(ze,{get children(){var g=Wf(),w=s;return typeof w=="function"?Ot(w,g):s=g,F(g,()=>xi.map(x=>(()=>{var b=Yf();return we(b,"click",()=>o(x.type)),F(b,E(x.icon,{size:18})),gt(S=>{var P=`dropdown-item ${f.selectedTool===x.type?"active":""}`,R=x.label;return P!==S.e&&Ht(b,S.e=P),R!==S.t&&xt(b,"title",S.t=R),S},{e:void 0,t:void 0}),b})())),gt(x=>We(g,d(),x)),g}})}}),null),gt(g=>{var w=`toolbar-btn ${c()?"active":""}`,x=`UML: ${l().label}`;return w!==g.e&&Ht(p,g.e=w),x!==g.t&&xt(p,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};Kt(["click","contextmenu"]);var Nf=it('<div class=toolbar-container><div class=drag-handle title="Drag to move toolbar"><div class=drag-dots></div></div><input type=file accept=image/* style=display:none>'),wi=it("<button>");const yn=[{type:"pan",icon:hc,label:"Pan Tool (H)"},{type:"selection",icon:uc,label:"Selection (V or 1)"},{type:"rectangle",icon:Fi,label:"Rectangle (R or 2)"},{type:"circle",icon:Jo,label:"Circle (O or 3)"},{type:"diamond",icon:fc,label:"Diamond (D)"},{type:"arrow",icon:pc,label:"Arrow (A or 5)"},{type:"line",icon:Ko,label:"Line (L or 4)"},{type:"bezier",icon:yc,label:"Bezier Curve (B or 0)"},{type:"text",icon:gc,label:"Text (T or 6)"},{type:"block-text",icon:mc,label:"Block Text (Sketchnote)"},{type:"image",icon:xc,label:"Insert Image (I or 9)"},{type:"eraser",icon:wc,label:"Eraser (E or 7)"},{type:"laser",icon:Vo,label:"Laser Pointer (Shift+P)"},{type:"ink",icon:bc,label:"Ink Overlay (Alt+I)"}],Ff=()=>{let n=null;const[t,e]=wt({x:0,y:0}),[s,i]=wt(!1),[o,r]=wt({x:0,y:0}),a=g=>{const w=g.target;(w.classList.contains("toolbar-container")||w.closest(".drag-handle"))&&(i(!0),r({x:g.clientX-t().x,y:g.clientY-t().y}),g.preventDefault())},l=g=>{s()&&e({x:g.clientX-o().x,y:g.clientY-o().y})},c=()=>{i(!1)};rn(()=>{window.addEventListener("mousemove",l),window.addEventListener("mouseup",c),te(()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c)})});const d=g=>{if(g==="image")n?.click();else if(g==="block-text"){const w=prompt("Enter text to generate (A-Z):");if(w){const x=window.innerWidth/2-f.viewState.panX,b=window.innerHeight/2-f.viewState.panY,S=Iu(w,x-w.length*30,b,80,"#000000");$("elements",[...f.elements,...S]),$("selection",S.map(P=>P.id)),Tt("selection")}}else Tt(g)},h=g=>{g.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},p=g=>{const w=g.target.files?.[0];if(!w)return;const x=new FileReader;x.onload=b=>{const S=b.target?.result;if(S){const P=new Image;P.src=S,P.onload=()=>{let B=P.width,U=P.height;if(B>1500||U>1500){const ot=B/U;B>U?(B=1500,U=B/ot):(U=1500,B=U*ot)}const D=document.createElement("canvas");D.width=B,D.height=U;const Q=D.getContext("2d");if(Q){Q.drawImage(P,0,0,B,U);const ot=D.toDataURL("image/webp",.8),st=500;let ht=B,pt=U;if(ht>st||pt>st){const mt=ht/pt;ht>pt?(ht=st,pt=ht/mt):(pt=st,ht=pt*mt)}en({id:crypto.randomUUID(),type:"image",x:100,y:100,width:ht,height:pt,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:0,strokeStyle:"solid",roughness:0,opacity:100,angle:0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,dataURL:ot,mimeType:"image/webp",layerId:f.activeLayerId})}}}},x.readAsDataURL(w),g.target.value=""},y=yn.findIndex(g=>g.type==="diamond"),m=yn.findIndex(g=>g.type==="bezier");return(()=>{var g=Nf(),w=g.firstChild,x=w.nextSibling;return g.$$mousedown=a,g.$$contextmenu=b=>b.preventDefault(),x.addEventListener("change",p),Ot(b=>n=b,x),F(g,E(tn,{get each(){return yn.slice(0,2)},children:b=>(()=>{var S=wi();return S.$$contextmenu=h,S.$$click=()=>d(b.type),F(S,E(b.icon,{size:20})),gt(P=>{var R=`toolbar-btn ${f.selectedTool===b.type?"active":""}`,B=b.label;return R!==P.e&&Ht(S,P.e=R),B!==P.t&&xt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),F(g,E(Ou,{}),null),F(g,E(tn,{get each(){return yn.slice(2,y+1)},children:b=>(()=>{var S=wi();return S.$$contextmenu=h,S.$$click=()=>d(b.type),F(S,E(b.icon,{size:20})),gt(P=>{var R=`toolbar-btn ${f.selectedTool===b.type?"active":""}`,B=b.label;return R!==P.e&&Ht(S,P.e=R),B!==P.t&&xt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),F(g,E(Wu,{}),null),F(g,E(Df,{}),null),F(g,E(of,{}),null),F(g,E(lf,{}),null),F(g,E(Lf,{}),null),F(g,E(xf,{}),null),F(g,E(zf,{}),null),F(g,E(Hf,{}),null),F(g,E(tn,{get each(){return yn.slice(y+1,m+1)},children:b=>(()=>{var S=wi();return S.$$contextmenu=h,S.$$click=()=>d(b.type),F(S,E(b.icon,{size:20})),gt(P=>{var R=`toolbar-btn ${f.selectedTool===b.type?"active":""}`,B=b.label;return R!==P.e&&Ht(S,P.e=R),B!==P.t&&xt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),F(g,E(tn,{get each(){return yn.slice(m+1)},children:b=>(()=>{var S=wi();return S.$$contextmenu=h,S.$$click=()=>d(b.type),F(S,E(b.icon,{size:20})),gt(P=>{var R=`toolbar-btn ${f.selectedTool===b.type?"active":""}`,B=b.label;return R!==P.e&&Ht(S,P.e=R),B!==P.t&&xt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),gt(b=>{var S=!!s(),P=`translateX(-50%) translate(${t().x}px, ${t().y}px)`;return S!==b.e&&g.classList.toggle("dragging",b.e=S),P!==b.t&&Ft(g,"transform",b.t=P),b},{e:void 0,t:void 0}),g})()};Kt(["contextmenu","mousedown","click"]);var Uf=it("<div style=position:absolute;top:150px;left:120px;transform:rotate(-5deg);opacity:0.8>Export, preferences, languages..."),Gf=it("<div style=position:absolute;top:100px;right:150px;transform:rotate(-5deg);opacity:0.8;text-align:right;max-width:150px>New! P3 Color Picker"),qf=it("<div style=position:absolute;top:20%;left:60%;transform:rotate(5deg);opacity:0.8;max-width:200px>Pick a tool & start drawing!"),jf=it("<div style=position:absolute;bottom:120px;left:300px;text-align:left;opacity:0.8>Shortcuts & help"),Qf=it('<div style="position:absolute;inset:0;pointer-events:none;z-index:10;color:var(--text-secondary, #6b7280);font-family:Virgil, Segoe UI Emoji, sans-serif;overflow:hidden"><canvas style=position:absolute;top:0;left:0;width:100%;height:100%></canvas><div style="position:absolute;top:45%;left:50%;transform:translate(-50%, -50%);text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem"><h1 style="font-size:5rem;margin:0;background:linear-gradient(135deg, color(display-p3 0 0.5 1), color(display-p3 1 0.2 0.2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.2">Yappy</h1><p style=font-size:1.2rem;opacity:0.7>All your data is saved locally in your browser.</p><div style="margin-top:3rem;display:grid;grid-template-columns:auto auto;gap:1rem 3rem;text-align:left;font-family:Inter, sans-serif;font-size:0.9rem;opacity:0.8"><span>Open</span><strong>Ctrl+Alt+O</strong><span>Smart Palette</span><strong>Ctrl+K</strong><span>Help</span><strong>?');const Vf=()=>{let n;const t=()=>f.elements.length===0&&f.selectedTool==="selection"&&f.appMode!=="presentation"&&!f.zenMode,[e,s]=wt({width:window.innerWidth,height:window.innerHeight});return Ut(()=>{const i=()=>{s({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",i),te(()=>window.removeEventListener("resize",i))}),Ut(()=>{if(!n||!t())return;const i=n,o=i.getContext("2d");if(!o)return;const{width:r,height:a}=e(),l=r<768,c=window.devicePixelRatio||1;i.width=r*c,i.height=a*c,o.scale(c,c),i.style.width=`${r}px`,i.style.height=`${a}px`;const d=Mo.canvas(i),h=r/2,p=a/2,y={id:"mock",type:"arrow",strokeColor:"#9ca3af",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"dashed",roughness:1.5,opacity:100,angle:0,renderStyle:"sketch",seed:1,locked:!1,link:null,layerId:"layer1",roundness:null,curveType:"bezier",startArrowhead:null,endArrowhead:"arrow",strokeLineJoin:"round",width:0,height:0,x:0,y:0},m=(b,S)=>({...y,id:crypto.randomUUID(),x:0,y:0,width:r,height:a,points:b,controlPoints:S}),g=b=>{_e(d,o,b,f.globalSettings.theme==="dark",1)};if(!l){const b=m([{x:h-200,y:p-100},{x:100,y:60}],[{x:h-250,y:p-200},{x:200,y:150}]);g(b);const S=m([{x:h+50,y:p-150},{x:h,y:80}],[{x:h+20,y:150},{x:h+10,y:100}]);g(S);const P=m([{x:h+250,y:p-100},{x:r-100,y:60}],[{x:r-180,y:120},{x:r-140,y:90}]);g(P)}const w=l?60:310,x=a-65;if(r>400){const b=m([{x:h-150,y:p+(l?50:100)},{x:w,y:x}],[{x:h-(l?50:200),y:p+(l?100:150)},{x:w+20,y:x-30}]);g(b)}}),E(vt,{get when(){return t()},get children(){var i=Qf(),o=i.firstChild,r=o.nextSibling,a=r.firstChild,l=a.nextSibling;l.nextSibling;var c=n;return typeof c=="function"?Ot(c,o):n=o,F(i,E(vt,{get when(){return e().width>768},get children(){return[Uf(),Gf(),qf(),jf()]}}),r),i}})},Jf=n=>n&&(n.version===3||n.version===4)&&Array.isArray(n.slides),xl="default-layer",Kf=n=>({id:n.id,type:n.type,x:n.x??0,y:n.y??0,width:n.width??100,height:n.height??100,strokeColor:n.strokeColor??"#000000",backgroundColor:n.backgroundColor??"transparent",fillStyle:n.fillStyle??"hachure",strokeWidth:n.strokeWidth??1,strokeStyle:n.strokeStyle??"solid",roughness:n.roughness??1,opacity:n.opacity??100,angle:n.angle??0,renderStyle:n.renderStyle??"sketch",seed:n.seed??Math.floor(Math.random()*2147483647),roundness:n.roundness??null,locked:n.locked??!1,link:n.link??null,layerId:n.layerId||xl,...n.points&&{points:n.points},...n.pointsEncoding!==void 0&&{pointsEncoding:n.pointsEncoding},...n.startArrowhead!==void 0&&{startArrowhead:n.startArrowhead},...n.endArrowhead!==void 0&&{endArrowhead:n.endArrowhead},...n.text!==void 0&&{text:n.text},...n.rawText!==void 0&&{rawText:n.rawText},...n.fontSize!==void 0&&{fontSize:n.fontSize},...n.fontFamily!==void 0&&{fontFamily:n.fontFamily},...n.fontWeight!==void 0&&{fontWeight:n.fontWeight},...n.fontStyle!==void 0&&{fontStyle:n.fontStyle},...n.textAlign!==void 0&&{textAlign:n.textAlign},...n.verticalAlign!==void 0&&{verticalAlign:n.verticalAlign},...n.textColor!==void 0&&{textColor:n.textColor},...n.textHighlightEnabled!==void 0&&{textHighlightEnabled:n.textHighlightEnabled},...n.textHighlightColor!==void 0&&{textHighlightColor:n.textHighlightColor},...n.textHighlightPadding!==void 0&&{textHighlightPadding:n.textHighlightPadding},...n.textHighlightRadius!==void 0&&{textHighlightRadius:n.textHighlightRadius},...n.containerId!==void 0&&{containerId:n.containerId},...n.containerText!==void 0&&{containerText:n.containerText},...n.labelPosition!==void 0&&{labelPosition:n.labelPosition},...n.fileId!==void 0&&{fileId:n.fileId},...n.scale!==void 0&&{scale:n.scale},...n.crop!==void 0&&{crop:n.crop},...n.status!==void 0&&{status:n.status},...n.dataURL!==void 0&&{dataURL:n.dataURL},...n.mimeType!==void 0&&{mimeType:n.mimeType},...n.groupIds!==void 0&&{groupIds:n.groupIds},...n.boundElements!==void 0&&{boundElements:n.boundElements},...n.isSelected!==void 0&&{isSelected:n.isSelected},...n.startBinding!==void 0&&{startBinding:n.startBinding},...n.endBinding!==void 0&&{endBinding:n.endBinding},...n.curveType!==void 0&&{curveType:n.curveType},...n.parentId!==void 0&&{parentId:n.parentId},...n.isCollapsed!==void 0&&{isCollapsed:n.isCollapsed},...n.constrained!==void 0&&{constrained:n.constrained},...n.autoResize!==void 0&&{autoResize:n.autoResize},...n.starPoints!==void 0&&{starPoints:n.starPoints},...n.polygonSides!==void 0&&{polygonSides:n.polygonSides},...n.borderRadius!==void 0&&{borderRadius:n.borderRadius},...n.burstPoints!==void 0&&{burstPoints:n.burstPoints},...n.tailPosition!==void 0&&{tailPosition:n.tailPosition},...n.shapeRatio!==void 0&&{shapeRatio:n.shapeRatio},...n.drawInnerBorder!==void 0&&{drawInnerBorder:n.drawInnerBorder},...n.innerBorderColor!==void 0&&{innerBorderColor:n.innerBorderColor},...n.innerBorderDistance!==void 0&&{innerBorderDistance:n.innerBorderDistance},...n.strokeLineJoin!==void 0&&{strokeLineJoin:n.strokeLineJoin},...n.fillDensity!==void 0&&{fillDensity:n.fillDensity},...n.shadowEnabled!==void 0&&{shadowEnabled:n.shadowEnabled},...n.shadowColor!==void 0&&{shadowColor:n.shadowColor},...n.shadowBlur!==void 0&&{shadowBlur:n.shadowBlur},...n.shadowOffsetX!==void 0&&{shadowOffsetX:n.shadowOffsetX},...n.shadowOffsetY!==void 0&&{shadowOffsetY:n.shadowOffsetY},...n.gradientStart!==void 0&&{gradientStart:n.gradientStart},...n.gradientEnd!==void 0&&{gradientEnd:n.gradientEnd},...n.gradientDirection!==void 0&&{gradientDirection:n.gradientDirection},...n.gradientStops!==void 0&&{gradientStops:n.gradientStops},...n.gradientType!==void 0&&{gradientType:n.gradientType},...n.gradientHandlePositions!==void 0&&{gradientHandlePositions:n.gradientHandlePositions},...n.blendMode!==void 0&&{blendMode:n.blendMode},...n.filter!==void 0&&{filter:n.filter},...n.entranceAnimation!==void 0&&{entranceAnimation:n.entranceAnimation},...n.animations!==void 0&&{animations:n.animations},...n.controlPoints!==void 0&&{controlPoints:n.controlPoints},...n.flowAnimation!==void 0&&{flowAnimation:n.flowAnimation},...n.flowSpeed!==void 0&&{flowSpeed:n.flowSpeed},...n.flowStyle!==void 0&&{flowStyle:n.flowStyle},...n.flowColor!==void 0&&{flowColor:n.flowColor},...n.flowDensity!==void 0&&{flowDensity:n.flowDensity},...n.isMotionPath!==void 0&&{isMotionPath:n.isMotionPath}}),Zf=n=>n.map(t=>Kf(t)),tp=n=>{const e=(n.layers||[{id:xl,name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent",colorTag:void 0,parentId:void 0,isGroup:!1,expanded:!0}]).map(i=>({...i,parentId:i.parentId,isGroup:i.isGroup??!1,expanded:i.expanded??!0}));return{elements:Zf(n.elements||[]),layers:e,viewState:n.viewState||{scale:1,panX:0,panY:0},gridSettings:n.gridSettings,globalSettings:n.globalSettings,canvasBackgroundColor:n.canvasBackgroundColor,states:n.states||[],initialStateId:n.initialStateId}},Ho=n=>n&&(n.version===3||n.version===4)&&Array.isArray(n.slides),No=n=>{if(Ho(n))return n;const t=tp(n),e={id:crypto.randomUUID(),name:"Slide 1",spatialPosition:{x:0,y:0},dimensions:{width:1920,height:1080},backgroundColor:t.canvasBackgroundColor||"#ffffff",order:0};return{version:4,metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},elements:t.elements,layers:t.layers,slides:[e],globalSettings:n.globalSettings||{},gridSettings:t.gridSettings,states:t.states}};class ep{baseUrl="/api/drawings";async saveDrawing(t,e){let s;Jf(e)?s={...e,metadata:{...e.metadata,updatedAt:new Date().toISOString()}}:s=No(e),s.version===4&&s.elements&&(s.elements=s.elements.map(c=>{if((c.type==="fineliner"||c.type==="inkbrush"||c.type==="marker")&&c.points&&typeof c.points[0]!="number"){const d=[];return c.points.forEach(h=>{d.push(h.x,h.y)}),{...c,points:d,pointsEncoding:"flat"}}return c})),s.slides&&(s.slides=s.slides.map(c=>{const d={...c};return d.elements&&(d.elements=d.elements.map(h=>{if((h.type==="fineliner"||h.type==="inkbrush"||h.type==="marker")&&h.points&&typeof h.points[0]!="number"){const p=[];return h.points.forEach(y=>{p.push(y.x,y.y)}),{...h,points:p,pointsEncoding:"flat"}}return h})),d}));const i=JSON.stringify(s),o=new Blob([i]).stream().pipeThrough(new CompressionStream("gzip")),a=await new Response(o).blob(),l=await fetch(`${this.baseUrl}/${t}`,{method:"POST",headers:{"Content-Type":"application/gzip"},body:a});if(!l.ok){const c=await l.json().catch(()=>({error:"Unknown server error"}));throw new Error(c.error||`Failed to save: ${l.statusText}`)}}async loadDrawing(t){const e=await fetch(`${this.baseUrl}/${t}`);if(!e.ok)return null;const s=e.headers.get("content-type");let i;if(s&&(s.includes("application/gzip")||s.includes("application/x-gzip")||s.includes("application/octet-stream")))try{const o=new DecompressionStream("gzip"),r=e.body.pipeThrough(o);i=await new Response(r).text()}catch(o){console.warn("Decompression failed, falling back to text",o),i=await e.text()}else i=await e.text();return JSON.parse(i)}async listDrawings(){const t=await fetch(this.baseUrl);return t.ok?await t.json():[]}async deleteDrawing(t){const e=await fetch(`${this.baseUrl}/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.json().catch(()=>({error:"Unknown server error"}));throw new Error(s.error||`Failed to delete: ${e.statusText}`)}}}const Qs=new ep;function np(n){const{l:t,c:e,h:s}=n,i=s*Math.PI/180,o=e*Math.cos(i),r=e*Math.sin(i),a=t+.3963377774*o+.2158037573*r,l=t-.1055613458*o-.0638541728*r,c=t-.0894841775*o-1.291485548*r,d=a*a*a,h=l*l*l,p=c*c*c,y=1.2270138511*d-.5577999807*h+.2812561489*p,m=-.0405801784*d+1.1122568696*h-.0716766787*p,g=-.0763812845*d-.4214819787*h+1.5861632204*p,w=2.4039459*y-.9898517*m-.4141151*g,x=-.7797967*y+1.5445214*m+.0352745*g,b=.0384795*y-.1141381*m+1.0756786*g,S=P=>{const R=Math.abs(P),B=R>.0031308?1.055*Math.pow(R,1/2.4)-.055:12.92*R;return P<0?-B:B};return{r:S(w),g:S(x),b:S(b)}}function bi(n){return`oklch(${(n.l*100).toFixed(2)}% ${n.c.toFixed(4)} ${n.h.toFixed(2)})`}function ip(n){return n.r>=-.001&&n.r<=1+.001&&n.g>=-.001&&n.g<=1+.001&&n.b>=-.001&&n.b<=1+.001}var op=it('<div style=padding:8px;display:flex;flex-direction:column;gap:12px><div style=position:relative><canvas width=200 height=150 style="width:100%;height:150px;cursor:crosshair;border-radius:8px;border:1px solid rgba(0,0,0,0.1);display:block"></canvas></div><div style="height:12px;width:100%;border-radius:6px;cursor:pointer;position:relative;background:linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"><div style="position:absolute;top:50%;transform:translate(-50%, -50%);width:16px;height:16px;background:white;border:2px solid black;border-radius:50%;pointer-events:none"></div></div><div style=display:flex;align-items:center;gap:8px;font-size:11px;font-family:monospace;color:var(--text-secondary)><div style="width:32px;height:32px;border-radius:4px;border:1px solid rgba(0,0,0,0.1)"></div><div><div>');const sp=n=>{const[t,e]=wt({l:.8,c:.15,h:200});let s,i;Ut(()=>{const a=t().h;if(!s)return;const l=s.getContext("2d",{colorSpace:"display-p3"});if(!l)return;const c=s.width,d=s.height,h=l.createImageData(c,d),p=h.data;for(let g=0;g<d;g++){const w=1-g/d;for(let x=0;x<c;x++){const b=x/c*.4,S=np({l:w,c:b,h:a}),P=ip(S),R=(g*c+x)*4;if(P)p[R]=Math.round(S.r*255),p[R+1]=Math.round(S.g*255),p[R+2]=Math.round(S.b*255),p[R+3]=255;else{const U=(Math.floor(x/5)+Math.floor(g/5))%2===0?30:20;p[R]=U,p[R+1]=U,p[R+2]=U,p[R+3]=255}}}l.putImageData(h,0,0);const y=t().c/.4*c,m=(1-t().l)*d;l.strokeStyle="white",l.lineWidth=2,l.beginPath(),l.arc(y,m,5,0,Math.PI*2),l.stroke(),l.strokeStyle="black",l.lineWidth=1,l.beginPath(),l.arc(y,m,6,0,Math.PI*2),l.stroke()});const o=a=>{a.stopPropagation();const l=h=>{if(!s)return;const p=s.getBoundingClientRect(),y=Math.min(Math.max(h.clientX-p.left,0),p.width),g=1-Math.min(Math.max(h.clientY-p.top,0),p.height)/p.height,w=y/p.width*.4;e(x=>({...x,l:g,c:w})),n.onSelect(bi(t()))};l(a);const c=h=>l(h),d=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)},r=a=>{a.stopPropagation();const l=h=>{if(!i)return;const p=i.getBoundingClientRect(),m=Math.min(Math.max(h.clientX-p.left,0),p.width)/p.width*360;e(g=>({...g,h:m})),n.onSelect(bi(t()))};l(a);const c=h=>l(h),d=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)};return(()=>{var a=op(),l=a.firstChild,c=l.firstChild,d=l.nextSibling,h=d.firstChild,p=d.nextSibling,y=p.firstChild,m=y.nextSibling,g=m.firstChild;c.$$mousedown=o;var w=s;typeof w=="function"?Ot(w,c):s=c,d.$$mousedown=r;var x=i;return typeof x=="function"?Ot(x,d):i=d,F(g,()=>bi(t())),gt(b=>{var S=`${t().h/360*100}%`,P=bi(t());return S!==b.e&&Ft(h,"left",b.e=S),P!==b.t&&Ft(y,"background",b.t=P),b},{e:void 0,t:void 0}),a})()};Kt(["mousedown"]);var rp=it('<div style="display:grid;grid-template-columns:repeat(5, 1fr);gap:8px;padding:8px"><button title="Advanced Picker"style="width:24px;height:24px;background:var(--toolbar-bg);border-radius:6px;cursor:pointer;border:1px dashed var(--border-color);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-secondary)">+'),ap=it("<div>"),lp=it('<div><div style="padding:4px 8px;display:flex;justify-content:space-between;align-items:center"><span style=font-size:12px;font-weight:bold>OKLCH Picker</span><button style=background:none;border:none;cursor:pointer;font-size:12px;color:var(--text-secondary)>Back'),cp=it('<div style="width:24px;height:24px;border-radius:6px;cursor:grab;border:1px solid rgba(0,0,0,0.1);flex-shrink:0;transition:transform 0.2s">');const dp=[{name:"P3 Red",value:"color(display-p3 1 0 0)"},{name:"P3 Green",value:"color(display-p3 0 1 0)"},{name:"P3 Blue",value:"color(display-p3 0 0 1)"},{name:"P3 Yellow",value:"color(display-p3 1 1 0)"},{name:"P3 Magenta",value:"color(display-p3 1 0 1)"},{name:"P3 Cyan",value:"color(display-p3 0 1 1)"},{name:"P3 Orange",value:"color(display-p3 1 0.5 0)"},{name:"P3 Purple",value:"color(display-p3 0.5 0 1)"},{name:"P3 Pink",value:"color(display-p3 1 0 0.5)"}],hp=()=>{const[n,t]=wt(!1),e=i=>{f.selection.length>0&&(Pt(),f.selection.forEach(o=>{nt(o,{backgroundColor:i,fillStyle:"solid"})}))},s=(i,o)=>{if(i.dataTransfer){i.dataTransfer.setData("text/plain",o),i.dataTransfer.effectAllowed="copy";const r=document.createElement("div");r.style.width="24px",r.style.height="24px",r.style.background=o,r.style.borderRadius="50%",r.style.position="absolute",r.style.top="-1000px",document.body.appendChild(r),i.dataTransfer.setDragImage(r,12,12),setTimeout(()=>document.body.removeChild(r),0)}};return(()=>{var i=ap();return F(i,E(vt,{get when(){return!n()},get fallback(){return(()=>{var o=lp(),r=o.firstChild,a=r.firstChild,l=a.nextSibling;return l.$$click=()=>t(!1),F(o,E(sp,{onSelect:e}),null),o})()},get children(){var o=rp(),r=o.firstChild;return F(o,E(tn,{each:dp,children:a=>(()=>{var l=cp();return l.addEventListener("mouseleave",c=>c.currentTarget.style.transform="scale(1)"),l.addEventListener("mouseenter",c=>c.currentTarget.style.transform="scale(1.2)"),l.$$click=c=>{c.stopPropagation(),e(a.value)},l.$$mousedown=c=>c.stopPropagation(),l.addEventListener("dragstart",c=>{c.stopPropagation(),s(c,a.value)}),xt(l,"draggable",!0),gt(c=>{var d=`${a.name} (Drag to shape or Click to apply to selection)`,h=a.value;return d!==c.e&&xt(l,"title",c.e=d),h!==c.t&&Ft(l,"background",c.t=h),c},{e:void 0,t:void 0}),l})()}),r),r.$$click=()=>t(!0),o}})),i})()};Kt(["click","mousedown"]);function up(n,t){const e=s=>{n.contains(s.target)||t()?.()};document.body.addEventListener("click",e),te(()=>{document.body.removeEventListener("click",e)})}var fp=it("<div class=menu-backdrop>"),pp=it("<input type=file accept=.json,.yappy style=display:none>"),yp=it("<div class=app-title>"),gp=it("<div class=menu-item><span class=label>Slide Toolbar</span><div class=menu-item-right>"),mp=it("<div class=menu-item><span class=label>Slide Panel</span><div class=menu-item-right>"),xp=it('<div class=menu-dropdown><button class=menu-item><span class=label>New Infinite Drawing</span></button><button class=menu-item><span class=label>New Presentation</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Load Sketch...</span></button><button class=menu-item><span class=label>Export / Save...</span></button><button class=menu-item><span class=label>Export</span><div class=menu-item-right><span class=shortcut>Ctrl+Shift+E</span></div></button><div class=menu-separator></div><div class=menu-item><span class=label>Properties Panel</span><div class=menu-item-right><span class=shortcut>Alt+Enter</span></div></div><div class=menu-item><span class=label>Layers Panel</span><div class=menu-item-right><span class=shortcut>Alt+L</span></div></div><div class=menu-item><span class=label>Display States</span><div class=menu-item-right></div></div><div class=menu-item><span class=label>Minimap</span><div class=menu-item-right><span class=shortcut>Alt+M</span></div></div><div class=menu-item><span class=label>Action Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><div class=menu-header>View</div><div class=menu-item><span class=label>Drawing Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><button class=menu-item><span class=label>Templates</span></button><div class=menu-separator></div><div style="padding:4px 12px;font-size:12px;color:var(--text-secondary)">Found a bug? <a href=https://github.com/rajeshpillai/yappy/issues target=_blank rel="noopener noreferrer">Report'),wp=it('<div style=position:fixed;top:12px;left:12px;z-index:10001><div class=menu-container style=position:relative><div class="drag-handle sm"><div class=drag-dots></div></div><button title=Menu></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title=Delete></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Zoom to Fit">'),bp=it('<div class=menu-dropdown style="position:absolute;top:100%;right:0;margin:8px 0 0 0;padding:4px;width:auto;min-width:180px">'),vp=it('<div style=position:fixed;top:12px;right:12px;z-index:10000><div class=menu-container><div class="drag-handle sm"><div class=drag-dots></div></div><button class=menu-btn title="Play All Animations"></button><button class=menu-btn></button><button class=menu-btn title="Stop All Animations"></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><div style=position:relative><button title="P3 Color Palette"></button></div><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Toggle Theme">');const Sp=de(()=>le(()=>import("./help-dialog-B-vnWkTg.js"),__vite__mapDeps([4,1,2,5]),import.meta.url)),kp=de(()=>le(()=>import("./load-export-dialog-J1pFiQLr.js"),__vite__mapDeps([6,1,2,7]),import.meta.url)),Mp=de(()=>le(()=>import("./file-open-dialog-PHTS1dYJ.js"),__vite__mapDeps([8,1,2,3,9]),import.meta.url)),Pp=de(()=>le(()=>import("./export-dialog-M-8V96yN.js"),__vite__mapDeps([10,1,2,3,11]),import.meta.url)),$p=de(()=>le(()=>import("./save-dialog-CAbBXWVK.js"),__vite__mapDeps([12,1,2,13]),import.meta.url)),Cp=de(()=>le(()=>import("./template-browser-D9UEXFFK.js"),__vite__mapDeps([14,1,2,15]),import.meta.url)),[ko,Rn]=wt("default"),[wl,Ci]=wt(!1),[bl,vl]=wt(!1),[Sl,Ae]=wt(!1),[kl,Fo]=wt(!1);let Uo=()=>{};const Ti=n=>{typeof Uo=="function"&&(Uo(n),vl(!0))},Go=(n="slides")=>{confirm(`Start new ${n==="slides"?"presentation":"sketch"}? Unsaved changes will be lost.`)&&(el(n),Rn("default"))},Tp=()=>{const[n,t]=wt(!1),[e,s]=wt("load");let i;const[o,r]=wt("workspace");Uo=r;const[a,l]=wt(!1),[c,d]=wt(!1);let h;Ut(()=>{c()&&h&&up(h,()=>()=>d(!1))}),window.triggerImageUpload=()=>i?.click();const p=async rt=>{try{Rn(rt),cs();const ft={version:4,metadata:{name:rt,updatedAt:new Date().toISOString(),docType:f.docType},elements:JSON.parse(JSON.stringify(f.elements)),layers:JSON.parse(JSON.stringify(f.layers)),slides:JSON.parse(JSON.stringify(f.slides)),globalSettings:JSON.parse(JSON.stringify(f.globalSettings)),gridSettings:JSON.parse(JSON.stringify(f.gridSettings)),states:JSON.parse(JSON.stringify(f.states))};if(o()==="workspace")await Qs.saveDrawing(rt,ft),Wt(`Drawing saved as "${rt}"!`,"success");else{const Rt=JSON.stringify(ft,null,2);let Dt,jt,It;if(o()==="disk-json")Dt=new Blob([Rt],{type:"application/json"}),jt=`${rt}.json`,It="application/json";else{const ie=new Blob([Rt]).stream().pipeThrough(new CompressionStream("gzip"));Dt=await new Response(ie).blob(),jt=`${rt}.yappy`,It="application/gzip"}const Qt=new File([Dt],jt,{type:It});if(navigator.canShare&&navigator.canShare({files:[Qt]}))try{await navigator.share({files:[Qt],title:"Yappy Drawing",text:o()==="disk-json"?"Save your drawing JSON":"Save your compressed drawing"});return}catch(ie){ie.name!=="AbortError"&&console.error("Share failed:",ie)}const ne=URL.createObjectURL(Dt),Nt=document.createElement("a");Nt.href=ne,Nt.download=jt,document.body.appendChild(Nt),Nt.click(),document.body.removeChild(Nt),URL.revokeObjectURL(ne)}}catch(ft){console.error("Save failed:",ft),Wt(`Failed to save: ${ft instanceof Error?ft.message:String(ft)}`,"error")}},y=async rt=>{const ft=rt||ko();try{const Rt=await Qs.loadDrawing(ft);if(Rt){const Dt=Ho(Rt)?Rt:No(Rt);_i(Dt),Rn(ft),Wt("Drawing loaded successfully","success")}else Wt("Drawing not found","error")}catch(Rt){console.error(Rt),Wt("Failed to load drawing","error")}},m=()=>{ps()},g=rt=>{f.elements.length>0&&!confirm("Loading a template will clear the current canvas. Continue?")||(rl(rt.data),l(!1),Wt(`Template "${rt.metadata.name}" loaded`,"success"))},w=async rt=>{const ft=rt.target.files?.[0];if(ft){try{let Rt;if(ft.name.endsWith(".yappy")||ft.type==="application/gzip"||ft.type==="application/x-gzip")try{const Qt=new DecompressionStream("gzip"),ne=ft.stream().pipeThrough(Qt);Rt=await new Response(ne).text()}catch(Qt){console.warn("Decompression failed, trying as plain text...",Qt),Rt=await ft.text()}else Rt=await ft.text();const Dt=JSON.parse(Rt),jt=Ho(Dt)?Dt:No(Dt);_i(jt);const It=ft.name.replace(/\.(json|yappy)$/i,"");Rn(It),Wt("File loaded successfully","success")}catch(Rt){console.error(Rt),Wt("Failed to load file. It might be corrupted or invalid format.","error")}t(!1),rt.target.value=""}},[x,b]=wt({x:0,y:0}),[S,P]=wt(!1),[R,B]=wt({x:0,y:0}),[U,D]=wt({x:0,y:0}),[Q,ot]=wt(!1),[st,ht]=wt({x:0,y:0}),pt=rt=>{const ft=rt.target;if(ft.closest(".menu-container")||ft.classList.contains("app-title")||ft.classList.contains("drag-handle")){if(ft.tagName==="BUTTON"||ft.closest("button"))return;P(!0),B({x:rt.clientX-x().x,y:rt.clientY-x().y}),rt.preventDefault()}},mt=rt=>{const ft=rt.target;if(ft.closest(".menu-container")||ft.classList.contains("drag-handle")){if(ft.tagName==="BUTTON"||ft.closest("button"))return;ot(!0),ht({x:rt.clientX-U().x,y:rt.clientY-U().y}),rt.preventDefault()}},At=rt=>{S()&&b({x:rt.clientX-R().x,y:rt.clientY-R().y}),Q()&&D({x:rt.clientX-st().x,y:rt.clientY-st().y})},_t=()=>{P(!1),ot(!1)};return rn(()=>{window.addEventListener("mousemove",At),window.addEventListener("mouseup",_t),te(()=>{window.removeEventListener("mousemove",At),window.removeEventListener("mouseup",_t)});const ft=new URLSearchParams(window.location.search).get("id");ft&&(Rn(ft),y(ft))}),[E(vt,{get when(){return n()},get children(){var rt=fp();return rt.$$click=()=>t(!1),rt}}),(()=>{var rt=pp();rt.addEventListener("change",w);var ft=i;return typeof ft=="function"?Ot(ft,rt):i=rt,rt})(),E(ir,{fallback:null,get children(){return[E(Mp,{get isOpen(){return wl()},onClose:()=>Ci(!1),onSelect:rt=>{y(rt),Ci(!1)}}),E(Pp,{get isOpen(){return f.showExportDialog},onClose:()=>vi(!1)}),E($p,{get isOpen(){return bl()},onClose:()=>vl(!1),onSave:p,get initialFilename(){return ko()}}),E(Sp,{get isOpen(){return kl()},onClose:()=>Fo(!1)}),E(kp,{get isOpen(){return Sl()},get initialTab(){return e()},onClose:()=>Ae(!1),onLoadWorkspace:()=>{Ae(!1),Ci(!0)},onLoadDisk:()=>{Ae(!1),i?.click()},onSaveWorkspace:()=>{Ae(!1),Ti("workspace")},onSaveDisk:()=>{Ae(!1),Ti("disk")},onSaveDiskJson:()=>{Ae(!1),Ti("disk-json")},onExportImage:()=>{Ae(!1),vi(!0)}}),E(Cp,{get isOpen(){return a()},onClose:()=>l(!1),onSelectTemplate:g})]}}),E(vt,{get when(){return!f.zenMode},get children(){var rt=yp();return rt.$$mousedown=pt,F(rt,ko),gt(ft=>Ft(rt,"transform",`translate(calc(-50% + ${x().x}px), ${x().y}px)`)),rt}}),E(vt,{get when(){return!f.zenMode},get children(){return[(()=>{var rt=wp(),ft=rt.firstChild,Rt=ft.firstChild,Dt=Rt.nextSibling,jt=Dt.nextSibling,It=jt.nextSibling,Qt=It.nextSibling,ne=Qt.nextSibling;return ft.$$mousedown=pt,Dt.$$click=()=>t(!n()),F(Dt,E(vc,{size:20})),F(ft,E(vt,{get when(){return n()},get children(){var Nt=xp(),ie=Nt.firstChild,Te=ie.firstChild,re=ie.nextSibling,Gt=re.firstChild,ln=re.nextSibling,Me=ln.nextSibling,Xe=Me.firstChild,Pe=Me.nextSibling,cn=Pe.firstChild,oe=Pe.nextSibling,no=oe.firstChild,Gn=oe.nextSibling,Qe=Gn.nextSibling,qn=Qe.firstChild,ce=qn.nextSibling,io=ce.firstChild,$e=Qe.nextSibling,jn=$e.firstChild,Qn=jn.nextSibling,oo=Qn.firstChild,dn=$e.nextSibling,hn=dn.firstChild,un=hn.nextSibling,Ye=dn.nextSibling,Vn=Ye.firstChild,He=Vn.nextSibling,be=He.firstChild,Ne=Ye.nextSibling,Mn=Ne.firstChild,Pn=Mn.nextSibling,Jn=Ne.nextSibling,so=Jn.nextSibling,Ve=so.nextSibling,$n=Ve.firstChild,ro=$n.nextSibling,ao=Ve.nextSibling,Je=ao.nextSibling,lo=Je.firstChild,Kn=Je.nextSibling;return Kn.nextSibling,ie.$$click=()=>{Go("infinite"),t(!1)},F(ie,E(co,{size:16}),Te),re.$$click=()=>{Go("slides"),t(!1)},F(re,E(Sc,{size:16}),Gt),Me.$$click=()=>{s("load"),Ae(!0),t(!1)},F(Me,E(kc,{size:16}),Xe),Pe.$$click=()=>{s("save"),Ae(!0),t(!1)},F(Pe,E(Mc,{size:16}),cn),oe.$$click=()=>{vi(!0),t(!1)},F(oe,E(Pc,{size:16}),no),Qe.$$click=()=>{Sn(),t(!1)},F(Qe,E(gn,{size:16}),qn),F(ce,E(vt,{get when(){return f.showPropertyPanel},get children(){return E(Ie,{size:14,class:"check-icon"})}}),io),$e.$$click=()=>{Bi(),t(!1)},F($e,E(Qo,{size:16}),jn),F(Qn,E(vt,{get when(){return f.showLayerPanel},get children(){return E(Ie,{size:14,class:"check-icon"})}}),oo),dn.$$click=()=>{Za(),t(!1)},F(dn,E($c,{size:16}),hn),F(un,E(vt,{get when(){return f.showStatePanel},get children(){return E(Ie,{size:14,class:"check-icon"})}})),Ye.$$click=()=>{Ki(),t(!1)},F(Ye,E(co,{size:16}),Vn),F(He,E(vt,{get when(){return f.minimapVisible},get children(){return E(Ie,{size:14,class:"check-icon"})}}),be),Ne.$$click=()=>{Vd(),t(!1)},F(Ne,E(gn,{size:16}),Mn),F(Pn,E(vt,{get when(){return f.showUtilityToolbar},get children(){return E(Ie,{size:14,class:"check-icon"})}})),F(Nt,E(vt,{get when(){return f.docType==="slides"},get children(){var Ce=gp(),Ke=Ce.firstChild,u=Ke.nextSibling;return Ce.$$click=()=>{Qd(),t(!1)},F(Ce,E(Cs,{size:16}),Ke),F(u,E(vt,{get when(){return f.showSlideToolbar},get children(){return E(Ie,{size:14,class:"check-icon"})}})),Ce}}),Jn),F(Nt,E(vt,{get when(){return f.docType==="slides"},get children(){var Ce=mp(),Ke=Ce.firstChild,u=Ke.nextSibling;return Ce.$$click=()=>{bs(),t(!1)},F(Ce,E(gn,{size:16}),Ke),F(u,E(vt,{get when(){return f.showSlideNavigator},get children(){return E(Ie,{size:14,class:"check-icon"})}})),Ce}}),Ve),Ve.$$click=()=>{Zd(),t(!1)},F(Ve,E(gn,{size:16}),$n),F(ro,E(vt,{get when(){return f.showMainToolbar},get children(){return E(Ie,{size:14,class:"check-icon"})}})),Je.$$click=()=>{l(!0),t(!1)},F(Je,E(gn,{size:16}),lo),Nt}}),jt),It.$$click=()=>Ue(f.selection),F(It,E(Cc,{size:18})),ne.$$click=m,F(ne,E(co,{size:18})),gt(Nt=>{var ie=`translate(${x().x}px, ${x().y}px)`,Te=`menu-btn ${n()?"active":""}`,re=f.selection.length===0;return ie!==Nt.e&&Ft(rt,"transform",Nt.e=ie),Te!==Nt.t&&Ht(Dt,Nt.t=Te),re!==Nt.a&&(It.disabled=Nt.a=re),Nt},{e:void 0,t:void 0,a:void 0}),rt})(),E(vt,{get when(){return f.showUtilityToolbar},get children(){var rt=vp(),ft=rt.firstChild,Rt=ft.firstChild,Dt=Rt.nextSibling,jt=Dt.nextSibling,It=jt.nextSibling,Qt=It.nextSibling,ne=Qt.nextSibling,Nt=ne.firstChild,ie=ne.nextSibling,Te=ie.nextSibling;ft.$$mousedown=mt,Dt.$$click=()=>Di.playAll("programmatic"),F(Dt,E(Cs,{size:18,get color(){return pn()&&!Re()?"#9ca3af":"#10b981"},get fill(){return pn()&&!Re()?"#9ca3af":"#10b981"}})),jt.$$click=()=>Re()?Bt.resumeAll():Bt.pauseAll(),F(jt,E(Tc,{size:18,get color(){return!pn()&&!Re()?"#9ca3af":"#f59e0b"},get fill(){return!pn()&&!Re()?"#9ca3af":"#f59e0b"}})),It.$$click=()=>Di.stopAll(),F(It,E(Fi,{size:18,color:"#ef4444",fill:"#ef4444"}));var re=h;return typeof re=="function"?Ot(re,ne):h=ne,Nt.$$click=()=>d(!c()),F(Nt,E(Ic,{size:18,color:"#f43f5e"})),F(ne,E(vt,{get when(){return c()},get children(){var Gt=bp();return F(Gt,E(hp,{})),Gt}}),null),we(Te,"click",il,!0),F(Te,(()=>{var Gt=On(()=>f.theme==="dark");return()=>Gt()?E(Lc,{size:18}):E(Ec,{size:18})})()),gt(Gt=>{var ln=`translate(${U().x}px, ${U().y}px)`,Me=pn()&&!Re(),Xe=Re()?"Resume Animations":"Pause Animations",Pe=!pn()&&!Re(),cn=`menu-btn ${c()?"active":""}`;return ln!==Gt.e&&Ft(rt,"transform",Gt.e=ln),Me!==Gt.t&&(Dt.disabled=Gt.t=Me),Xe!==Gt.a&&xt(jt,"title",Gt.a=Xe),Pe!==Gt.o&&(jt.disabled=Gt.o=Pe),cn!==Gt.i&&Ht(Nt,Gt.i=cn),Gt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),rt}})]}})]};Kt(["click","mousedown"]);var Ip=it('<div class=zoom-container><div class=zoom-group><button class=zoom-btn title="Zoom Out"></button><button class="zoom-btn text-btn"title="Reset Zoom">%</button><button class=zoom-btn title="Zoom In"></button></div><div class=zoom-group style=margin-left:12px><button class=zoom-btn title="Undo (Ctrl+Z)"></button><button class=zoom-btn title="Redo (Ctrl+Y)">');const Lp=()=>{const n=()=>{const s=Math.min(f.viewState.scale*1.1,10);Zt({scale:s})},t=()=>{const s=Math.max(f.viewState.scale*.9,.1);Zt({scale:s})},e=()=>{Zt({scale:1})};return(()=>{var s=Ip(),i=s.firstChild,o=i.firstChild,r=o.nextSibling,a=r.firstChild,l=r.nextSibling,c=i.nextSibling,d=c.firstChild,h=d.nextSibling;return o.$$click=t,F(o,E(Ko,{size:16})),r.$$click=e,F(r,()=>Math.round(f.viewState.scale*100),a),l.$$click=n,F(l,E(Ac,{size:16})),we(d,"click",os,!0),F(d,E(Rc,{size:16})),we(h,"click",Oi,!0),F(h,E(Dc,{size:16})),gt(p=>{var y=f.undoStackLength===0,m=f.redoStackLength===0;return y!==p.e&&(d.disabled=p.e=y),m!==p.t&&(h.disabled=p.t=m),p},{e:void 0,t:void 0}),s})()};Kt(["click"]);class Ep{steps=[];currentStepIndex=0;isPlaying=!1;isPaused=!1;activeAnimationIds=[];resolvePromise=null;add(t,e){return e&&e>0&&this.steps.push({type:"delay",delay:e}),this.steps.push({type:"animation",factory:t}),this}parallel(...t){return this.steps.push({type:"parallel",factories:t}),this}delay(t){return this.steps.push({type:"delay",delay:t}),this}call(t){return this.steps.push({type:"callback",callback:t}),this}play(){return this.isPaused?(this.isPaused=!1,this.isPlaying=!0,Bt.resumeAll(),Promise.resolve()):this.isPlaying?Promise.resolve():(this.isPlaying=!0,this.currentStepIndex=0,new Promise(t=>{this.resolvePromise=t,this.runNextStep()}))}pause(){this.isPlaying&&(this.isPaused=!0,this.isPlaying=!1,Bt.pauseAll())}stop(){this.isPlaying=!1,this.isPaused=!1,this.currentStepIndex=0;for(const t of this.activeAnimationIds)Bt.stop(t);this.activeAnimationIds=[],this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null)}reset(){this.stop(),this.currentStepIndex=0}get progress(){return this.steps.length===0?0:this.currentStepIndex/this.steps.length}get playing(){return this.isPlaying}get paused(){return this.isPaused}runNextStep(){if(!this.isPlaying||this.currentStepIndex>=this.steps.length){this.isPlaying=!1,this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null);return}const t=this.steps[this.currentStepIndex];switch(this.currentStepIndex++,t.type){case"animation":this.runAnimation(t.factory);break;case"parallel":this.runParallel(t.factories);break;case"delay":this.runDelay(t.delay);break;case"callback":t.callback?.(),this.runNextStep();break}}runAnimation(t){const e=t();if(!e){this.runNextStep();return}this.activeAnimationIds.push(e);const s=()=>{const i=Bt.getState(e);i===null||i==="completed"?(this.activeAnimationIds=this.activeAnimationIds.filter(o=>o!==e),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(s)};requestAnimationFrame(s)}runParallel(t){const e=t.map(i=>i()).filter(i=>i!=="");if(e.length===0){this.runNextStep();return}this.activeAnimationIds.push(...e);const s=()=>{let i=!0;for(const o of e){const r=Bt.getState(o);r!==null&&r!=="completed"&&(i=!1)}i?(this.activeAnimationIds=this.activeAnimationIds.filter(o=>!e.includes(o)),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(s)};requestAnimationFrame(s)}runDelay(t){setTimeout(()=>{this.isPlaying&&!this.isPaused&&this.runNextStep()},t)}}function Ap(){return new Ep}const Rp={get state(){return f},createElement(n,t,e,s,i,o){const r=crypto.randomUUID(),a=f.defaultElementStyles,l={id:r,type:n,x:t,y:e,width:s,height:i,strokeColor:o?.strokeColor??a.strokeColor??"#000000",backgroundColor:o?.backgroundColor??a.backgroundColor??"transparent",fillStyle:o?.fillStyle??a.fillStyle??"solid",strokeWidth:o?.strokeWidth??a.strokeWidth??1,strokeStyle:o?.strokeStyle??a.strokeStyle??"solid",opacity:o?.opacity??a.opacity??100,roughness:o?.roughness??a.roughness??1,angle:o?.angle??0,renderStyle:a.renderStyle??"sketch",seed:o?.seed??Math.floor(Math.random()*2**31),roundness:o?.roundness??a.roundness??null,fontFamily:o?.fontFamily??a.fontFamily??"hand-drawn",fontSize:o?.fontSize??a.fontSize??20,textAlign:o?.textAlign??a.textAlign??"left",verticalAlign:o?.verticalAlign??"middle",startArrowhead:o?.startArrowhead??a.startArrowhead??null,endArrowhead:o?.endArrowhead??a.endArrowhead??"arrow",locked:o?.locked??!1,link:o?.link??null,layerId:o?.layerId??f.activeLayerId,curveType:o?.curveType??"straight",containerText:o?.containerText??"",parentId:o?.parentId??null,isCollapsed:o?.isCollapsed??!1,autoResize:o?.autoResize??!1,constrained:o?.constrained??!1,starPoints:o?.starPoints,polygonSides:o?.polygonSides,burstPoints:o?.burstPoints,borderRadius:o?.borderRadius,shadowEnabled:o?.shadowEnabled??!1,shadowColor:o?.shadowColor,shadowBlur:o?.shadowBlur,shadowOffsetX:o?.shadowOffsetX,shadowOffsetY:o?.shadowOffsetY,gradientStart:o?.gradientStart,gradientEnd:o?.gradientEnd,gradientDirection:o?.gradientDirection,gradientStops:o?.gradientStops,gradientType:o?.gradientType,gradientHandlePositions:o?.gradientHandlePositions,drawInnerBorder:o?.drawInnerBorder,innerBorderColor:o?.innerBorderColor,innerBorderDistance:o?.innerBorderDistance,strokeLineJoin:o?.strokeLineJoin,spinEnabled:o?.spinEnabled,spinSpeed:o?.spinSpeed,orbitEnabled:o?.orbitEnabled,orbitCenterId:o?.orbitCenterId,orbitRadius:o?.orbitRadius,orbitSpeed:o?.orbitSpeed,orbitDirection:o?.orbitDirection,flowAnimation:o?.flowAnimation,flowSpeed:o?.flowSpeed,flowStyle:o?.flowStyle,flowColor:o?.flowColor,flowDensity:o?.flowDensity,textColor:o?.textColor,textHighlightEnabled:o?.textHighlightEnabled??!1,textHighlightColor:o?.textHighlightColor,textHighlightPadding:o?.textHighlightPadding,textHighlightRadius:o?.textHighlightRadius,...o};return(l.type==="line"||l.type==="arrow"||l.type==="bezier")&&(l.curveType==="elbow"||l.curveType==="bezier"||l.type==="bezier")&&(!l.points||l.points.length===0)&&(l.points=[0,0,l.width,l.height]),en(l),r},createRectangle(n,t,e,s,i){return this.createElement("rectangle",n,t,e,s,i)},createCircle(n,t,e,s,i){return this.createElement("circle",n,t,e,s,i)},createDiamond(n,t,e,s,i){return this.createElement("diamond",n,t,e,s,i)},createTriangle(n,t,e,s,i){return this.createElement("triangle",n,t,e,s,i)},createPolygonalShape(n,t,e,s,i,o){return this.createElement(n,t,e,s,i,o)},createStar(n,t,e,s,i=5,o){return this.createElement("star",n,t,e,s,{...o,starPoints:i})},createBrowserWindow(n,t,e,s,i){return this.createElement("browserWindow",n,t,e,s,i)},createStickyNote(n,t,e,s,i,o){return this.createElement("stickyNote",n,t,e,s,{...o,containerText:i})},createLine(n,t,e,s,i){const o=e-n,r=s-t;return this.createElement("line",n,t,o,r,i)},createArrow(n,t,e,s,i){const o=e-n,r=s-t;return this.createElement("arrow",n,t,o,r,{...i})},createBezier(n,t,e,s,i){const o=e-n,r=s-t;return this.createElement("bezier",n,t,o,r,{...i,curveType:"bezier"})},createOrganicBranch(n,t,e,s,i){const o=e-n,r=s-t;return this.createElement("organicBranch",n,t,o,r,{...i,curveType:"bezier",strokeWidth:i?.strokeWidth??3})},createText(n,t,e,s){const i=crypto.randomUUID(),o=f.defaultElementStyles,r=s?.fontSize??o.fontSize??20,a=e.length*(r*.6),l={id:i,type:"text",x:n,y:t,width:a,height:r*1.5,text:e,strokeColor:s?.strokeColor??o.strokeColor??"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,strokeStyle:"solid",opacity:s?.opacity??100,roughness:0,angle:s?.angle??0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,fontFamily:s?.fontFamily??o.fontFamily??"hand-drawn",fontSize:r,textAlign:s?.textAlign??o.textAlign??"left",verticalAlign:s?.verticalAlign??"middle",locked:!1,link:null,layerId:s?.layerId??f.activeLayerId,...s};return en(l),i},createImage(n,t,e,s,i,o){return this.createElement("image",n,t,s,i,{...o,backgroundColor:"transparent",fillStyle:"solid",dataURL:e,status:"loaded"})},getElement(n){return f.elements.find(t=>t.id===n)},updateElement(n,t){nt(n,t,!0)},deleteElement(n){Ue([n])},clear(){f.elements.length>0&&(Pt(),$("elements",[]),$("selection",[]))},setSelected(n){$("selection",n)},clearSelection(){$("selection",[])},setView(n,t,e){Zt({scale:n,panX:t,panY:e})},updateGridSettings(n){$("gridSettings",t=>({...t,...n}))},updateDefaultStyles(n){$("defaultElementStyles",t=>({...t,...n}))},async zoomToFit(){ps()},connect(n,t,e){const s=this.getElement(n),i=this.getElement(t);if(!s||!i)return console.error("Source or Target element not found"),null;const o=s.x+s.width/2,r=s.y+s.height/2,a=i.x+i.width/2,l=i.y+i.height/2,c=e?.type??"arrow",d=e?.curveType??"bezier",h=(w,x,b,S,P)=>{const R=P.x+P.width/2,B=P.y+P.height/2,U=P.width/2,D=P.height/2,Q=b-w,ot=S-x;if(Q===0&&ot===0)return{x:w,y:x};const st=Math.atan2(ot,Q);if(P.type==="diamond"){const rt=Math.abs(Math.tan(st)),ft=1/(1/U+rt/D),Rt=(Q>0?1:-1)*ft,Dt=Rt*Math.tan(st);return{x:R+Rt,y:B+Dt}}if(["circle","star","octagon","hexagon"].includes(P.type)){const rt=Math.cos(st),ft=Math.sin(st);return{x:R+U*rt,y:B+D*ft}}const ht=Q>0?R+U:R-U,pt=B+Math.tan(st)*(ht-R),mt=ot>0?B+D:B-D,At=R+(mt-B)/Math.tan(st);return pt>=B-D-1&&pt<=B+D+1?{x:ht,y:pt}:{x:At,y:mt}},p=h(o,r,a,l,s),y=h(a,l,o,r,i),m=this.createElement(c,p.x,p.y,y.x-p.x,y.y-p.y,{...e,curveType:d,startBinding:{elementId:n,focus:0,gap:5},endBinding:{elementId:t,focus:0,gap:5},points:[0,0,y.x-p.x,y.y-p.y]}),g=(w,x)=>{const b=w.boundElements||[];b.find(S=>S.id===x)||this.updateElement(w.id,{boundElements:[...b,{id:x,type:c}]})};return g(s,m),g(i,m),m},undo(){os()},redo(){Oi()},groupSelection(){us()},ungroupSelection(){fs()},duplicate(n){nl(n)},toggleTheme(){il()},addLayer(n){return ol(n)},deleteLayer(n){Ad(n)},setActiveLayer(n){ys(n)},mergeLayerDown(n){_d(n)},flattenLayers(){Bd()},isolateLayer(n){zd(n)},showAllLayers(){Wd()},updateLayer(n,t){Rd(n,t)},duplicateLayer(n){Dd(n)},reorderLayers(n,t){Lo(n,t)},moveElementsToLayer(n,t){Xd(n,t)},createLayerGroup(n){Jd(n)},toggleLayerGroupExpansion(n){Kd(n)},isLayerVisible(n){return Le(n)},isLayerLocked(n){return gs(n)},toggleGrid(){ms()},toggleSnapToGrid(){xs()},addDisplayState(n){Id(n)},updateDisplayState(n){Ld(n)},deleteDisplayState(n){Ed(n)},applyDisplayState(n,t=!0){Ji(n,t)},toggleStatePanel(n){Za(n)},applyNextState(){ds()},applyPreviousState(){hs()},addChildNode(n){ss(n)},addSiblingNode(n){rs(n)},toggleCollapseSelection(){Qa()},toggleCollapse(n){Eo(n)},setParent(n,t){al(n,t)},reorderMindmap(n,t){mn(n,t)},applyMindmapStyling(n){ll(n)},toggleCommandPalette(n){sl(n)},togglePropertyPanel(n){Sn(n)},togglePresentationMode(n){Si(n)},toggleLayerPanel(n){Bi(n)},toggleMinimap(n){Ki(n)},toggleZenMode(n){ws(n)},toggleSlideNavigator(n){bs(n)},addSlide(){Ka()},deleteSlide(n){Md(n)},setActiveSlide(n){an(n)},reorderSlides(n,t){Pd(n,t)},updateSlideTransition(n,t){$d(n,t)},updateSlideBackground(n,t){Cd(n,t)},setDocType(n){Td(n)},loadDocument(n){_i(n)},resetToNewDocument(n="slides"){el(n)},bringToFront(n){as(n)},sendToBack(n){ls(n)},moveElementZIndex(n,t){Io(n,t)},alignSelectedElements(n){nh(n)},distributeSelectedElements(n){sh(n)},setCanvasBackgroundColor(n){Yd(n)},setCanvasTexture(n){Hd(n)},zoomToFitSlide(){vs()},setSelectedTool(n){Tt(n)},moveSelectedElements(n,t){Va(n,t,!0)},loadTemplate(n){rl(n)},animateElement:Z,animateElements:ur,createTimeline:Ap,fadeIn:gr,fadeOut:mr,scaleIn:ts,bounce:Gi,pulse:qi,shakeX:ji,stopElementAnimation:fr,pauseElementAnimation:pr,resumeElementAnimation:yr,easings:nn,animationEngine:Bt,createSpring:hr,copyToClipboard:to,cutToClipboard:Ms,pasteFromClipboard:Ni,copyStyle:Ps,pasteStyle:$s},Dp=()=>{window.Yappy=Rp,console.log("Yappy API initialized. Use window.Yappy to interact.")},Op=(n,t,e,s,i)=>`M ${n+i} ${t} L ${n+e-i} ${t} Q ${n+e} ${t} ${n+e} ${t+i} L ${n+e} ${t+s-i} Q ${n+e} ${t+s} ${n+e-i} ${t+s} L ${n+i} ${t+s} Q ${n} ${t+s} ${n} ${t+s-i} L ${n} ${t+i} Q ${n} ${t} ${n+i} ${t}`,Ii=n=>{const t=n.width,e=n.height,s=t/2,i=e/2,o=-s,r=-i;switch(n.type){case"rectangle":case"image":case"text":case"umlClass":case"umlNote":case"umlPackage":case"umlActor":case"umlComponent":case"umlLifeline":case"umlFragment":return{type:"rect",x:o,y:r,w:t,h:e,r:n.roundness?10:0};case"umlState":return{type:"rect",x:o,y:r,w:t,h:e,r:Math.min(Math.abs(t),Math.abs(e))*.15};case"umlInterface":case"umlUseCase":case"umlProvidedInterface":case"circle":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"umlRequiredInterface":{const a=Math.min(t,e)/2;return{type:"path",path:`M 0 ${-a} A ${a} ${a} 0 0 1 0 ${a}`}}case"umlSignalSend":{const a=t*.2;return{type:"points",points:[{x:-s,y:-i},{x:s-a,y:-i},{x:s,y:0},{x:s-a,y:i},{x:-s,y:i}]}}case"umlSignalReceive":{const a=t*.2;return{type:"points",points:[{x:-s+a,y:-i},{x:s,y:-i},{x:s,y:i},{x:-s+a,y:i},{x:-s,y:0}]}}case"triangle":return{type:"points",points:[{x:0,y:-i},{x:-s,y:i},{x:s,y:i}]};case"diamond":return{type:"points",points:[{x:0,y:-i},{x:s,y:0},{x:0,y:i},{x:-s,y:0}]};case"hexagon":{const a=[];for(let l=0;l<6;l++){const c=Math.PI/3*l-Math.PI/2;a.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:a}}case"octagon":{const a=[];for(let l=0;l<8;l++){const c=Math.PI/4*l-Math.PI/2;a.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:a}}case"pentagon":{const a=[];for(let l=0;l<5;l++){const c=Math.PI*2/5*l-Math.PI/2;a.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:a}}case"septagon":{const a=[];for(let l=0;l<7;l++){const c=Math.PI*2/7*l-Math.PI/2;a.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:a}}case"star":{const a=Math.min(t,e)/2,l=(n.shapeRatio!==void 0?n.shapeRatio:38)/100,c=a*l,d=n.starPoints||5,h=[];for(let p=0;p<d*2;p++){const y=Math.PI/d*p-Math.PI/2,m=p%2===0?a:c;h.push({x:m*Math.cos(y),y:m*Math.sin(y)})}return{type:"points",points:h}}case"burst":{const a=Math.min(Math.abs(t),Math.abs(e))/2,l=(n.shapeRatio!==void 0?n.shapeRatio:70)/100,c=a*l,d=n.burstPoints||16,h=[];for(let p=0;p<d*2;p++){const y=Math.PI/d*p-Math.PI/2,m=p%2===0?a:c;h.push({x:m*Math.cos(y),y:m*Math.sin(y)})}return{type:"points",points:h}}case"parallelogram":{const a=t*.2;return{type:"points",points:[{x:o+a,y:r},{x:o+t,y:r},{x:o+t-a,y:r+e},{x:o,y:r+e}]}}case"trapezoid":{const a=t*.2;return{type:"points",points:[{x:o+a,y:r},{x:o+t-a,y:r},{x:o+t,y:r+e},{x:o,y:r+e}]}}case"rightTriangle":return{type:"points",points:[{x:o,y:r},{x:o,y:r+e},{x:o+t,y:r+e}]};case"capsule":return{type:"path",path:Op(o,r,t,e,Math.min(t,e)/2)};case"stickyNote":{const a=Math.min(t,e)*.15;return{type:"points",points:[{x:o,y:r},{x:o+t,y:r},{x:o+t,y:r+e-a},{x:o+t-a,y:r+e},{x:o,y:r+e}]}}case"callout":{const a=e*.2,l=e-a;return{type:"path",path:`M ${o} ${r} L ${o+t} ${r} L ${o+t} ${r+l} L ${o+t*.7} ${r+l} L 0 ${i} L ${o+t*.3} ${r+l} L ${o} ${r+l} Z`}}case"speechBubble":{const a=Math.min(t,e)*((n.borderRadius!==void 0?n.borderRadius:20)/100),l=t*.15,c=e*.2,d=e-c,h=(n.tailPosition!==void 0?n.tailPosition:20)/100,p=o+t*h;let y,m;h<=.5?(y=p+t*.1,m=y+l):(m=p-t*.1,y=m-l);const g=Math.min(t/2,a),w=Math.min(d/2,a);return{type:"path",path:`M ${o+g} ${r} L ${o+t-g} ${r} Q ${o+t} ${r} ${o+t} ${r+w} L ${o+t} ${r+d-w} Q ${o+t} ${r+d} ${o+t-g} ${r+d} L ${m} ${r+d} L ${p} ${i} L ${y} ${r+d} L ${o+g} ${r+d} Q ${o} ${r+d} ${o} ${r+d-w} L ${o} ${r+w} Q ${o} ${r} ${o+g} ${r} Z`}}case"cloud":{const a=t*.2,l=t*.25,c=t*.2,d=t*.3;return{type:"path",path:`M ${o+a} 0 A ${a} ${a} 0 0 1 ${o+t*.3} ${r+l} A ${l} ${l} 0 0 1 ${o+t*.7} ${r+l} A ${c} ${c} 0 0 1 ${o+t-c} 0 A ${d} ${d} 0 0 1 ${o+t*.6} ${r+e-d*.5} A ${d} ${d} 0 0 1 ${o+t*.3} ${r+e-d*.5} A ${d} ${d} 0 0 1 ${o+a} 0 Z`}}case"heart":return{type:"path",path:`M 0 ${r+e*.3} C 0 ${r+e*.15} ${o+t*.3} ${r} ${o+t*.5} ${r+e*.15} C ${o+t*.7} ${r} ${o+t} ${r+e*.15} ${o+t} ${r+e*.35} C ${o+t} ${r+e*.6} 0 ${r+e*.8} 0 ${r+e} C 0 ${r+e*.8} ${o} ${r+e*.6} ${o} ${r+e*.35} C ${o} ${r+e*.15} ${o+t*.3} ${r} ${o+t*.5} ${r+e*.15} Z`};case"polygon":{const a=n.polygonSides||6,l=[];for(let c=0;c<a;c++){const d=2*Math.PI/a*c-Math.PI/2;l.push({x:t/2*Math.cos(d),y:e/2*Math.sin(d)})}return{type:"points",points:l}}case"starPerson":{const a=Math.min(t,e)*.15,l=r+a*2;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:r+a,rx:a,ry:a},{type:"points",points:[{x:0,y:l},{x:o,y:r+e*.4},{x:0,y:r+e*.5},{x:o+t,y:r+e*.4},{x:0,y:l},{x:o+t*.8,y:r+e},{x:0,y:r+e*.7},{x:o+t*.2,y:r+e},{x:0,y:l}]}]}}case"lightbulb":{const a=Math.min(t,e/1.5)/2,l=t*.4,c=e*.25,d=r+e-c;return{type:"multi",shapes:[{type:"path",path:`M ${-l/2} ${d} C ${-l/2} ${r+a} ${o} ${r+a*1.5} ${o} ${r+a} A ${a} ${a} 0 1 1 ${o+t} ${r+a} C ${o+t} ${r+a*1.5} ${l/2} ${r+a} ${l/2} ${d} Z`},{type:"rect",x:-l/2,y:d,w:l,h:c}]}}case"signpost":{const a=Math.max(4,t*.05),l=e*.3,c=t*.9,d=r+e*.1;return{type:"multi",shapes:[{type:"rect",x:-a/2,y:r,w:a,h:e},{type:"rect",x:-c/2,y:d,w:c,h:l}]}}case"burstBlob":{const a=t/2,l=e/2,c=12,d=Math.min(a,l),h=d*.6,p=n.seed||1,y=g=>{let w=g+=1831565813;return w=Math.imul(w^w>>>15,w|1),w^=w+Math.imul(w^w>>>7,w|61),((w^w>>>14)>>>0)/4294967296},m=[];for(let g=0;g<c*2;g++){const x=(g%2===0?d:h)+(y(p+g)-.5)*(d*.1),b=Math.PI*g/c;m.push({x:Math.cos(b)*(t/e)*x,y:Math.sin(b)*x})}return{type:"points",points:m}}case"scroll":{const a=e*.15;return{type:"path",path:`M ${o} ${r+a} L ${o+t} ${r+a} L ${o+t} ${r+e-a} L ${o} ${r+e-a} Z M ${o} ${r+a} C ${o-a} ${r+a} ${o-a} ${r} ${o} ${r} L ${o+t} ${r} C ${o+t+a} ${r} ${o+t+a} ${r+a} ${o+t} ${r+a} M ${o} ${r+e-a} C ${o-a} ${r+e-a} ${o-a} ${r+e} ${o} ${r+e} L ${o+t} ${r+e} C ${o+t+a} ${r+e} ${o+t+a} ${r+e-a} ${o+t} ${r+e-a}`}}case"doubleBanner":{const a=t*.15,l=e*.25;return{type:"multi",shapes:[{type:"points",points:[{x:o+a,y:r+l},{x:o,y:r+l},{x:o+a/2,y:0},{x:o,y:i},{x:o+a,y:i}]},{type:"points",points:[{x:o+t-a,y:r+l},{x:o+t,y:r+l},{x:o+t-a/2,y:0},{x:o+t,y:i},{x:o+t-a,y:i}]},{type:"points",points:[{x:o+a,y:r},{x:o+t-a,y:r},{x:o+t-a,y:r+e-l},{x:o+a,y:r+e-l}]}]}}case"document":{const a=e*.1;return{type:"path",path:`M ${o} ${r} L ${o+t} ${r} L ${o+t} ${r+e-a} Q ${o+t*.75} ${r+e-a*2} ${o+t*.5} ${r+e-a} T ${o} ${r+e-a} Z`}}case"cross":return{type:"multi",shapes:[{type:"points",points:[{x:o,y:r},{x:o+t,y:r+e}]},{type:"points",points:[{x:o+t,y:r},{x:o,y:r+e}]}]};case"checkmark":return{type:"points",points:[{x:o,y:r+e*.5},{x:o+t*.4,y:i},{x:o+t,y:r}]};case"wavyDivider":{let a=`M ${o} 0`;for(let l=1;l<=20;l++)a+=` L ${o+l/20*t} ${Math.sin(l/20*Math.PI*4)*(e/2)}`;return{type:"path",path:a}}case"ribbon":{const a=t*.15,l=e*.7;return{type:"path",path:`M ${o+a} ${r} L ${o+t-a} ${r} L ${o+t-a} ${r+l} L ${o+t} ${r+e/2} L ${o+t-a} ${r+e*.8} L ${o+a} ${r+e*.8} L ${o} ${r+e/2} L ${o+a} ${r+l} Z`}}case"bracketLeft":return{type:"points",isClosed:!1,points:[{x:o+t,y:r},{x:o,y:r+e/2},{x:o+t,y:r+e}]};case"bracketRight":return{type:"points",isClosed:!1,points:[{x:o,y:r},{x:o+t,y:r+e/2},{x:o,y:r+e}]};case"arrowLeft":{const a=e*.4,l=r+(e-a)/2,c=t*.4;return{type:"points",points:[{x:o+c,y:r},{x:o+c,y:l},{x:o+t,y:l},{x:o+t,y:l+a},{x:o+c,y:l+a},{x:o+c,y:r+e},{x:o,y:r+e/2}]}}case"arrowRight":{const a=e*.4,l=r+(e-a)/2,c=t*.4;return{type:"points",points:[{x:o+t-c,y:r},{x:o+t,y:r+e/2},{x:o+t-c,y:r+e},{x:o+t-c,y:l+a},{x:o,y:l+a},{x:o,y:l},{x:o+t-c,y:l}]}}case"arrowUp":{const a=t*.4,l=o+(t-a)/2,c=e*.4;return{type:"points",points:[{x:o+t/2,y:r},{x:o+t,y:r+c},{x:l+a,y:r+c},{x:l+a,y:r+e},{x:l,y:r+e},{x:l,y:r+c},{x:o,y:r+c}]}}case"arrowDown":{const a=t*.4,l=o+(t-a)/2,c=e*.4;return{type:"points",points:[{x:l,y:r},{x:l+a,y:r},{x:l+a,y:r+e-c},{x:o+t,y:r+e-c},{x:o+t/2,y:r+e},{x:o,y:r+e-c},{x:l,y:r+e-c}]}}case"dfdProcess":{const a=e*.25;return{type:"multi",shapes:[{type:"rect",x:o,y:r,w:t,h:e,r:10},{type:"points",points:[{x:o,y:r+a},{x:o+t,y:r+a}],isClosed:!1}]}}case"dfdDataStore":{const a=t*.2;return{type:"multi",shapes:[{type:"points",isClosed:!1,points:[{x:o+t,y:r},{x:o,y:r},{x:o,y:r+e},{x:o+t,y:r+e}]},{type:"points",isClosed:!1,points:[{x:o+a,y:r},{x:o+a,y:r+e}]}]}}case"isometricCube":{const a=(n.shapeRatio!==void 0?n.shapeRatio:25)/100,l=(n.sideRatio!==void 0?n.sideRatio:50)/100,c=o+t*l,d=o+t*(1-l),h=e*a,p=r+h,y=r+h/2;return{type:"multi",shapes:[{type:"points",points:[{x:d,y:r},{x:o+t,y},{x:c,y:p},{x:o,y}],shade:1.1},{type:"points",points:[{x:o,y},{x:c,y:p},{x:c,y:r+e},{x:o,y:r+e-h/2}],shade:.9},{type:"points",points:[{x:c,y:p},{x:o+t,y},{x:o+t,y:r+e-h/2},{x:c,y:r+e}],shade:.7}]}}case"solidBlock":{const a=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=a*Math.cos(c),h=a*Math.sin(c),p={x:o,y:r},y={x:o+t,y:r},m={x:o+t,y:r+e},g={x:o,y:r+e},w={x:o+d,y:r+h},x={x:o+t+d,y:r+h},b={x:o+t+d,y:r+e+h},S={x:o+d,y:r+e+h};return{type:"multi",shapes:[{type:"points",points:[w,x,b,S],shade:.6},{type:"points",points:[p,y,x,w],shade:1.1},{type:"points",points:[y,m,b,x],shade:.8},{type:"points",points:[m,g,S,b],shade:.7},{type:"points",points:[g,p,w,S],shade:.9},{type:"points",points:[p,y,m,g],shade:1}]}}case"perspectiveBlock":{const a=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=n.taper!==void 0?n.taper:0,h=(n.skewX!==void 0?n.skewX:0)*t,p=(n.skewY!==void 0?n.skewY:0)*e,y=n.frontTaper!==void 0?n.frontTaper:0,m=(n.frontSkewX!==void 0?n.frontSkewX:0)*t,g=(n.frontSkewY!==void 0?n.frontSkewY:0)*e,w=a*Math.cos(c)+h,x=a*Math.sin(c)+p,b=1-y,S=s*b,P=i*b,R={x:-S+m,y:-P+g},B={x:S+m,y:-P+g},U={x:S+m,y:P+g},D={x:-S+m,y:P+g},Q=1-d,ot=s*Q,st=i*Q,ht={x:w-ot,y:x-st},pt={x:w+ot,y:x-st},mt={x:w+ot,y:x+st},At={x:w-ot,y:x+st};return{type:"multi",shapes:[{type:"points",points:[ht,pt,mt,At],shade:.6},{type:"points",points:[R,B,pt,ht],shade:1.1},{type:"points",points:[B,U,mt,pt],shade:.8},{type:"points",points:[U,D,At,mt],shade:.7},{type:"points",points:[D,R,ht,At],shade:.9},{type:"points",points:[R,B,U,D],shade:1}]}}case"cylinder":{const a=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=t/2,h=e/2,p=a*Math.cos(c),y=a*Math.sin(c),m=0,g=0,w=p,x=y,b=Math.atan2(y*d*d,p*h*h)+Math.PI/2,S=d*Math.cos(b),P=h*Math.sin(b);return{type:"multi",shapes:[{type:"ellipse",cx:w,cy:x,rx:d,ry:h,shade:.6},{type:"points",points:[{x:m+S,y:g+P},{x:w+S,y:x+P},{x:w-S,y:x-P},{x:m-S,y:g-P}],shade:.8},{type:"ellipse",cx:m,cy:g,rx:d,ry:h,shade:1}]}}case"stateStart":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"stateEnd":return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2},{type:"ellipse",cx:0,cy:0,rx:t/3,ry:e/3}]};case"stateSync":return{type:"rect",x:o,y:r,w:t,h:e,r:2};case"activationBar":return{type:"rect",x:o,y:r,w:t,h:e,r:0};case"externalEntity":return{type:"multi",shapes:[{type:"rect",x:o+4,y:r+4,w:t,h:e,r:0},{type:"rect",x:o,y:r,w:t,h:e,r:0}]}}return null};class K{static adjustColor(t,e){return e&&(t==="#000000"||t==="black"||t==="#000")?"#ffffff":t}static shadeColor(t,e){if(t==="transparent"||t==="none"||!t)return t;let s,i,o;if(t.startsWith("#")){const c=t.slice(1);c.length===3||c.length===4?(s=parseInt(c[0]+c[0],16),i=parseInt(c[1]+c[1],16),o=parseInt(c[2]+c[2],16)):(s=parseInt(c.substring(0,2),16),i=parseInt(c.substring(2,4),16),o=parseInt(c.substring(4,6),16))}else if(t.startsWith("rgb")){const c=t.match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(c)s=parseInt(c[1]),i=parseInt(c[2]),o=parseInt(c[3]);else return t}else return t;if(isNaN(s)||isNaN(i)||isNaN(o))return t;s=Math.min(255,Math.floor(s*e)),i=Math.min(255,Math.floor(i*e)),o=Math.min(255,Math.floor(o*e));const r=s.toString(16).padStart(2,"0"),a=i.toString(16).padStart(2,"0"),l=o.toString(16).padStart(2,"0");return"#"+r+a+l}static applyTransformations(t,e,s){t.save(),t.globalAlpha=(e.opacity??100)/100*s,e.blendMode&&(t.globalCompositeOperation=e.blendMode==="normal"?"source-over":e.blendMode),e.shadowEnabled?(t.shadowColor=e.shadowColor||"rgba(0,0,0,0.3)",t.shadowBlur=e.shadowBlur||10,t.shadowOffsetX=e.shadowOffsetX||5,t.shadowOffsetY=e.shadowOffsetY||5):t.shadowColor="transparent";let o=e.angle||0,r=e.x,a=e.y;const l=r+e.width/2,c=a+e.height/2;return o&&(t.translate(l,c),t.rotate(o),t.translate(-l,-c)),{cx:l,cy:c}}static restoreTransformations(t){t.restore()}static buildRenderOptions(t,e){const s=this.adjustColor(t.strokeColor,e);let i=t.backgroundColor==="transparent"?void 0:this.adjustColor(t.backgroundColor,e);["linear","radial","conic","dots"].includes(t.fillStyle)&&(i=void 0);const o=t.fillDensity||1,a=Math.max(.5,5/o);return{stroke:s,fill:i,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,hachureAngle:60,hachureGap:a,roughness:t.roughness??1,seed:t.seed||1,disableMultiStroke:t.roughness===0,strokeLineDash:t.strokeStyle==="dashed"?[8,8]:t.strokeStyle==="dotted"?[2,4]:void 0}}static applyComplexFills(t,e,s){const{ctx:i,element:o}=t,r=o.fillStyle,a=["linear","radial","conic"].includes(r)||o.gradientType!=="none"&&o.gradientType!==void 0,l=r==="dots";if(!a&&!l)return;i.save(),i.translate(e,s),a?(i.beginPath(),this.applyGradient(i,o)):l&&(i.beginPath(),this.applyDotsFill(i,o,t.isDarkMode));const c=Ii(o);c&&(this.renderGeometry(i,c),i.fill()),i.restore()}static applyGradient(t,e){const s=e.width,i=e.height,o=s/2,r=i/2,a=e.gradientType||e.fillStyle||"linear";let l;if(a==="linear"){const c=(e.gradientDirection||45)*(Math.PI/180),d=Math.sqrt(o**2+r**2),h=-Math.cos(c)*d,p=-Math.sin(c)*d,y=Math.cos(c)*d,m=Math.sin(c)*d;l=t.createLinearGradient(h,p,y,m)}else if(a==="radial")l=t.createRadialGradient(0,0,0,0,0,Math.max(s,i)/2);else if(a==="conic"){const c=(e.gradientDirection||0)*(Math.PI/180);l=t.createConicGradient(c,0,0)}else l=t.createLinearGradient(-o,-r,o,r);e.gradientStops&&e.gradientStops.length>0?[...e.gradientStops].sort((c,d)=>c.offset-d.offset).forEach(c=>l.addColorStop(c.offset,c.color)):e.gradientStart&&e.gradientEnd&&(l.addColorStop(0,e.gradientStart),l.addColorStop(1,e.gradientEnd)),t.fillStyle=l}static applyDotsFill(t,e,s){const i=e.fillDensity||1,o=s?"#ffffff":"#000000",r=document.createElement("canvas"),a=Math.max(5,20/i);r.width=a,r.height=a;const l=r.getContext("2d");if(l){l.fillStyle=o,l.beginPath(),l.arc(a/2,a/2,e.strokeWidth/2||1,0,Math.PI*2),l.fill();const c=t.createPattern(r,"repeat");c&&(t.fillStyle=c)}}static renderGeometry(t,e){if(e.type==="rect")t.roundRect(e.x,e.y,e.w,e.h,e.r||0);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx,e.ry,0,0,Math.PI*2);else if(e.type==="points"){if(e.points.length>0){t.moveTo(e.points[0].x,e.points[0].y);for(let s=1;s<e.points.length;s++)t.lineTo(e.points[s].x,e.points[s].y);e.isClosed!==!1&&t.closePath()}}else e.type==="path"?t.fill(new Path2D(e.path)):e.type==="multi"&&e.shapes.forEach(s=>this.renderGeometry(t,s))}static renderText(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t;if(o.isEditing)return;const a=o.containerText||o.text;if(!a)return;i.save();let l=o.width-20,c=0;o.type==="doubleBanner"?(l=o.width*.65,c=-(o.height*.1)):o.type==="starPerson"?c=o.height*.15:o.type==="lightbulb"?(l=o.width*.7,c=-(o.height*.1)):o.type==="signpost"?(l=o.width*.8,c=-(o.height*.15)):o.type==="browserWindow"?c=Math.min(o.height*.15,30)/2:o.type==="mobilePhone"&&(c=-(o.height*.05));const d=xe(i,o,a,l);i.font=eo(o);const h=o.textColor||o.strokeColor,p=this.adjustColor(h,r),y=o.textAlign||"center";i.textAlign=y,i.textBaseline="middle";const m=s-d.textHeight/2+d.lineHeight/2+c,g=o.fontFamily==="hand-drawn"?2:0,w=m+g,x=()=>y==="left"?e-(o.width||l)/2+10:y==="right"?e+(o.width||l)/2-10:e;if(o.textHighlightEnabled){const b=o.textHighlightColor||"rgba(255, 255, 0, 0.4)",S=o.textHighlightPadding??4,P=o.textHighlightRadius??2;i.fillStyle=this.adjustColor(b,r),d.lines.forEach((R,B)=>{const U=w+B*d.lineHeight,D=i.measureText(R).width,Q=x(),ot=S/2;let st=Q-D/2-S;y==="left"?st=Q-S:y==="right"&&(st=Q-D-S),i.beginPath(),i.roundRect?i.roundRect(st,U-d.lineHeight/2-ot,D+S*2,d.lineHeight+ot*2,P):i.rect(st,U-d.lineHeight/2-ot,D+S*2,d.lineHeight+ot*2),i.fill()})}i.fillStyle=p,d.lines.forEach((b,S)=>{const P=w+S*d.lineHeight,R=x();i.fillText(b,R,P,o.width-10)}),i.restore()}}class ee{render(t){const{ctx:e,element:s,layerOpacity:i}=t,{cx:o,cy:r}=K.applyTransformations(e,s,i),a=s.drawProgress;a!==void 0&&a>=0&&a<100?this.renderDrawProgress(t,o,r):(K.applyComplexFills(t,o,r),s.renderStyle==="architectural"?this.renderArchitectural(t,o,r):this.renderSketch(t,o,r)),s.flowAnimation&&this.renderFlowAnimation(t),K.restoreTransformations(e)}renderDrawProgress(t,e,s){const{ctx:i,element:o,isDarkMode:r,layerOpacity:a}=t,l=(o.drawProgress??0)/100;i.globalAlpha=a;const c=Math.min(1,l/.7),d=Math.max(0,Math.min(1,(l-.65)/.25)),h=Math.max(0,Math.min(1,(l-.85)/.15)),p=this.estimatePathLength(o),y=K.adjustColor(o.strokeColor,r);if(c>0){i.save(),i.strokeStyle=y,i.lineWidth=o.strokeWidth,i.lineCap="round",i.lineJoin="round";const m=p*c;i.setLineDash([m,p]),i.lineDashOffset=0,i.beginPath(),this.definePath(i,o),i.stroke(),i.restore()}if(d>0){const m=o.backgroundColor;if(m&&m!=="transparent"&&m!=="none"){i.save(),i.globalAlpha*=d;const g=o.fillStyle;["linear","radial","conic","dots"].includes(g)?K.applyComplexFills(t,e,s):(i.fillStyle=K.adjustColor(m,r),i.beginPath(),this.definePath(i,o),i.fill()),i.restore()}}h>0&&(i.save(),i.globalAlpha*=h,K.renderText(t,e,s),i.restore())}estimatePathLength(t){return 2*(Math.abs(t.width)+Math.abs(t.height))}renderFlowAnimation(t){const{ctx:e,element:s,isDarkMode:i}=t,o=s.flowSpeed!==void 0?s.flowSpeed:1,r=qc(),a=r/20*o;e.save(),e.strokeStyle=K.adjustColor(s.flowColor||s.strokeColor,i),e.lineWidth=Math.max(1,s.strokeWidth*.8),e.lineCap="round",e.lineJoin="round";const l=s.flowStyle||"dashes";if(l==="dots")e.setLineDash([2,8]);else if(l==="pulse"){const c=Math.sin(r/200)*.5+.5;e.globalAlpha*=c,e.setLineDash([])}else e.setLineDash([8,8]);e.lineDashOffset=-a,e.beginPath(),this.definePath(e,s),e.stroke(),e.restore()}}class _p extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);if(this.drawRectArch(i,o.x,o.y,o.width,o.height,a,o.strokeWidth,l.stroke,l.fill),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const d=Math.max(0,a-c);this.drawRectArch(i,o.x+c,o.y+c,o.width-c*2,o.height-c*2,d,o.strokeWidth,o.innerBorderColor||l.stroke,"none")}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);if(this.drawRectSketch(i,o.x,o.y,o.width,o.height,a,l),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const d=Math.max(0,a-c),h={...l,stroke:o.innerBorderColor||l.stroke,fill:"none"};this.drawRectSketch(i,o.x+c,o.y+c,o.width-c*2,o.height-c*2,d,h)}}K.renderText(t,e,s)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.15:0}drawRectArch(t,e,s,i,o,r,a,l,c){c&&c!=="transparent"&&c!=="none"&&(t.beginPath(),r>0?t.roundRect(e,s,i,o,r):t.rect(e,s,i,o),t.fillStyle=c,t.fill()),t.beginPath(),r>0?t.roundRect(e,s,i,o,r):t.rect(e,s,i,o),t.strokeStyle=l,t.lineWidth=a,t.stroke()}drawRectSketch(t,e,s,i,o,r,a){if(r>0){const l=this.getRoundedRectPath(e,s,i,o,r);t.path(l,a)}else t.rectangle(e,s,i,o,a)}getRoundedRectPath(t,e,s,i,o){const r=Math.min(Math.abs(s)/2,o),a=Math.min(Math.abs(i)/2,o);return`M ${t+r} ${e} L ${t+s-r} ${e} Q ${t+s} ${e} ${t+s} ${e+a} L ${t+s} ${e+i-a} Q ${t+s} ${e+i} ${t+s-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){const s=this.getRadius(e);s>0?t.roundRect(e.x,e.y,e.width,e.height,s):t.rect(e.x,e.y,e.width,e.height)}}class Bp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r);if(this.drawCircleArch(i,o.x,o.y,o.width,o.height,o.strokeWidth,a.stroke,a.fill),o.drawInnerBorder){const l=o.innerBorderDistance||5;o.width>l*2&&o.height>l*2&&this.drawCircleArch(i,o.x+l,o.y+l,o.width-l*2,o.height-l*2,o.strokeWidth,o.innerBorderColor||a.stroke,"none")}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r);if(i.ellipse(o.x+o.width/2,o.y+o.height/2,Math.abs(o.width),Math.abs(o.height),a),o.drawInnerBorder){const l=o.innerBorderDistance||5;if(o.width>l*2&&o.height>l*2){const c={...a,stroke:o.innerBorderColor||a.stroke,fill:"none"};i.ellipse(o.x+o.width/2,o.y+o.height/2,Math.abs(o.width)-l*2,Math.abs(o.height)-l*2,c)}}K.renderText(t,e,s)}drawCircleArch(t,e,s,i,o,r,a,l){const c=e+i/2,d=s+o/2,h=Math.abs(i)/2,p=Math.abs(o)/2;l&&l!=="transparent"&&l!=="none"&&(t.beginPath(),t.ellipse(c,d,h,p,0,0,Math.PI*2),t.fillStyle=l,t.fill()),t.beginPath(),t.ellipse(c,d,h,p,0,0,Math.PI*2),t.strokeStyle=a,t.lineWidth=r,t.stroke()}definePath(t,e){const s=e.x+e.width/2,i=e.y+e.height/2,o=Math.abs(e.width)/2,r=Math.abs(e.height)/2;t.ellipse(s,i,o,r,0,0,Math.PI*2)}estimatePathLength(t){const e=Math.abs(t.width)/2,s=Math.abs(t.height)/2,i=(e-s)**2/((e+s)**2||1);return Math.PI*(e+s)*(1+3*i/(10+Math.sqrt(4-3*i)))}}class zp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);if(this.drawDiamondArch(i,o.x,o.y,o.width,o.height,a,o.strokeWidth,l.stroke,l.fill),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const d=Math.max(0,a-c);this.drawDiamondArch(i,o.x+c,o.y+c,o.width-c*2,o.height-c*2,d,o.strokeWidth,o.innerBorderColor||l.stroke,"none")}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);if(a>0){const c=this.getRoundedDiamondPath(o.x,o.y,o.width,o.height,a);i.path(c,l)}else{const c=o.width/2,d=o.height/2,h=[[o.x+c,o.y],[o.x+o.width,o.y+d],[o.x+c,o.y+o.height],[o.x,o.y+d]];i.polygon(h,l)}if(o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const d=Math.max(0,a-c),h={...l,stroke:o.innerBorderColor||l.stroke,fill:"none"};if(d>0){const p=this.getRoundedDiamondPath(o.x+c,o.y+c,o.width-c*2,o.height-c*2,d);i.path(p,h)}else{const p=(o.width-c*2)/2,y=(o.height-c*2)/2,m=o.x+c,g=o.y+c,w=o.width-c*2,x=o.height-c*2,b=[[m+p,g],[m+w,g+y],[m+p,g+x],[m,g+y]];i.polygon(b,h)}}}K.renderText(t,e,s)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.2:0}drawDiamondArch(t,e,s,i,o,r,a,l,c){const d=i/2,h=o/2,p=e+d,y=s+h;if(c&&c!=="transparent"&&c!=="none")if(t.beginPath(),r>0){const m=this.getRoundedDiamondPath(e,s,i,o,r);t.fill(new Path2D(m))}else t.moveTo(p,s),t.lineTo(e+i,y),t.lineTo(p,s+o),t.lineTo(e,y),t.closePath(),t.fillStyle=c,t.fill();if(t.beginPath(),r>0){const m=this.getRoundedDiamondPath(e,s,i,o,r);t.stroke(new Path2D(m))}else t.moveTo(p,s),t.lineTo(e+i,y),t.lineTo(p,s+o),t.lineTo(e,y),t.closePath(),t.strokeStyle=l,t.lineWidth=a,t.stroke()}getRoundedDiamondPath(t,e,s,i,o){const r=s/2,a=i/2,l=t+r,c=e+a,d=Math.hypot(r,a),p=Math.min(o,d/2)/d,y=r*p,m=a*p,g={x:l-y,y:e+m},w={x:l+y,y:e+m},x={x:t+s-y,y:c-m},b={x:t+s-y,y:c+m},S={x:l+y,y:e+i-m},P={x:l-y,y:e+i-m},R={x:t+y,y:c+m},B={x:t+y,y:c-m};return`M ${g.x} ${g.y} Q ${l} ${e} ${w.x} ${w.y} L ${x.x} ${x.y} Q ${t+s} ${c} ${b.x} ${b.y} L ${S.x} ${S.y} Q ${l} ${e+i} ${P.x} ${P.y} L ${R.x} ${R.y} Q ${t} ${c} ${B.x} ${B.y} Z`}definePath(t,e){const s=this.getRadius(e);if(s>0)this.executePath(t,e.x,e.y,e.width,e.height,s);else{const i=e.width/2,o=e.height/2;t.moveTo(e.x+i,e.y),t.lineTo(e.x+e.width,e.y+o),t.lineTo(e.x+i,e.y+e.height),t.lineTo(e.x,e.y+o),t.closePath()}}executePath(t,e,s,i,o,r){const a=i/2,l=o/2,c=e+a,d=s+l,h=Math.hypot(a,l),y=Math.min(r,h/2)/h,m=a*y,g=l*y,w={x:c-m,y:s+g},x={x:c+m,y:s+g},b={x:e+i-m,y:d-g},S={x:e+i-m,y:d+g},P={x:c+m,y:s+o-g},R={x:c-m,y:s+o-g},B={x:e+m,y:d+g},U={x:e+m,y:d-g};t.moveTo(w.x,w.y),t.quadraticCurveTo(c,s,x.x,x.y),t.lineTo(b.x,b.y),t.quadraticCurveTo(e+i,d,S.x,S.y),t.lineTo(P.x,P.y),t.quadraticCurveTo(c,s+o,R.x,R.y),t.lineTo(B.x,B.y),t.quadraticCurveTo(e,d,U.x,U.y),t.closePath()}}class Wp extends ee{renderArchitectural(t,e,s){this.renderCommon(t)}renderSketch(t,e,s){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:s,isDarkMode:i}=t;if(!s.text)return;const o=s.fontSize||20,r=s.fontFamily==="sans-serif"?"Inter, sans-serif":s.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",a=s.fontWeight===!0||s.fontWeight==="bold"?"bold ":"",l=s.fontStyle===!0||s.fontStyle==="italic"?"italic ":"";e.save(),e.font=`${l}${a}${o}px ${r}`;const d=e.measureText(s.text).width,h=s.width&&d&&!s.textHighlightEnabled?s.width/d:1,p=s.textColor||s.strokeColor,y=K.adjustColor(p,i),m=s.textAlign||"left";if(e.textAlign=m,e.textBaseline="hanging",s.textHighlightEnabled){const g=s.textHighlightColor||"rgba(255, 255, 0, 0.4)",w=s.textHighlightPadding??4,x=s.textHighlightRadius??2;e.fillStyle=K.adjustColor(g,i);const b=s.text.split(`
`),S=o*1.2,P=s.fontFamily==="hand-drawn"?-2:0,R=B=>m==="center"?s.x+(s.width||B)/2:m==="right"?s.x+(s.width||B):s.x;b.forEach((B,U)=>{const D=e.measureText(B).width,Q=R(D),ot=s.y+U*S+P,st=w/2;e.beginPath(),e.roundRect?e.roundRect(Q-(m==="center"?D/2:0)-w,ot-st,D+w*2,S+st*2,x):e.rect(Q-(m==="center"?D/2:0)-w,ot-st,D+w*2,S+st*2),e.fill()}),e.fillStyle=y,b.forEach((B,U)=>{const D=e.measureText(B).width,Q=R(D),ot=s.y+U*S;e.fillText(B,Q,ot)})}else{e.fillStyle=y;let g=s.x;m==="center"?g=s.x+(s.width||d)/2:m==="right"&&(g=s.x+(s.width||d)),h!==1?(e.translate(g,s.y),e.scale(h,1),e.fillText(s.text,0,0)):e.fillText(s.text,g,s.y)}e.restore()}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Xp extends ee{renderArchitectural(t,e,s){this.renderCommon(t)}renderSketch(t,e,s){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:s}=t;if(!s.dataURL)return;const i=tu(s.dataURL);i?e.drawImage(i,s.x,s.y,s.width,s.height):(e.save(),e.fillStyle="#e5e5e5",e.fillRect(s.x,s.y,s.width,s.height),e.fillStyle="#999",e.font="12px sans-serif",e.fillText("Loading image...",s.x+10,s.y+20),e.restore())}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Yp extends ee{renderArchitectural(t,e,s){const{rc:i,ctx:o,element:r,isDarkMode:a}=t,l=K.buildRenderOptions(r,a),{mainPoints:c,foldPoints:d}=this.getPoints(r);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(i.polygon(c,{...l,stroke:"none",fill:l.fill}),i.polygon(d,{...l,stroke:"none",fill:l.fill,fillStyle:"solid"})),o.beginPath(),o.moveTo(c[0][0],c[0][1]);for(let p=1;p<c.length;p++)o.lineTo(c[p][0],c[p][1]);o.closePath(),o.strokeStyle=K.adjustColor(r.strokeColor,a),o.lineWidth=r.strokeWidth,o.stroke(),o.beginPath(),o.moveTo(d[0][0],d[0][1]),o.lineTo(d[1][0],d[1][1]),o.lineTo(d[2][0],d[2][1]),o.stroke(),K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),{mainPoints:l,foldPoints:c}=this.getPoints(o);i.polygon(l,a),i.polygon(c,{...a,fillStyle:"solid"}),K.renderText(t,e,s)}getPoints(t){const e=Math.min(Math.abs(t.width),Math.abs(t.height))*.15,s=t.x,i=t.y,o=t.width,r=t.height,a=[[s,i],[s+o,i],[s+o,i+r-e],[s+o-e,i+r],[s,i+r]],l=[[s+o,i+r-e],[s+o-e,i+r-e],[s+o-e,i+r]];return{mainPoints:a,foldPoints:l}}definePath(t,e){const{mainPoints:s,foldPoints:i}=this.getPoints(e);t.moveTo(s[0][0],s[0][1]);for(let o=1;o<s.length;o++)t.lineTo(s[o][0],s[o][1]);t.closePath(),t.moveTo(i[0][0],i[0][1]),t.lineTo(i[1][0],i[1][1]),t.lineTo(i[2][0],i[2][1])}}class Hp extends ee{renderArchitectural(t,e,s){const{element:i}=t;if(this.drawPolygon(t,i.x,i.y,i.width,i.height),i.drawInnerBorder){const o=i.innerBorderDistance||5;i.width>o*2&&i.height>o*2&&this.drawPolygon(t,i.x+o,i.y+o,i.width-o*2,i.height-o*2,!0)}K.renderText(t,e,s)}renderSketch(t,e,s){const{element:i}=t;if(this.drawPolygon(t,i.x,i.y,i.width,i.height),i.drawInnerBorder){const o=i.innerBorderDistance||5;i.width>o*2&&i.height>o*2&&this.drawPolygon(t,i.x+o,i.y+o,i.width-o*2,i.height-o*2,!0)}K.renderText(t,e,s)}drawPolygon(t,e,s,i,o,r=!1){const{ctx:a,rc:l,element:c,isDarkMode:d}=t,h=this.getPoints(c,e,s,i,o),p=K.buildRenderOptions(c,d),y=K.adjustColor(c.strokeColor,d),m=r?{...p,stroke:c.innerBorderColor||y,fill:"none"}:p;if(c.renderStyle==="architectural"){const g=p.fill&&p.fill!=="transparent"&&p.fill!=="none";!r&&g&&c.fillStyle!=="dots"&&l.polygon(h,{...m,stroke:"none",fill:p.fill}),a.beginPath(),a.moveTo(h[0][0],h[0][1]);for(let w=1;w<h.length;w++)a.lineTo(h[w][0],h[w][1]);a.closePath(),a.strokeStyle=r&&c.innerBorderColor||y,a.lineWidth=c.strokeWidth,a.lineJoin=c.strokeLineJoin||"round",a.stroke()}else l.polygon(h,m)}getPoints(t,e,s,i,o){const r=e+i/2,a=s+o/2,l=i/2,c=o/2;switch(t.type){case"triangle":return[[r,s],[e+i,s+o],[e,s+o]];case"hexagon":return this.getRegularPolyPoints(r,a,l,c,6);case"octagon":return this.getRegularPolyPoints(r,a,l,c,8);case"parallelogram":{const d=i*.2;return[[e+d,s],[e+i,s],[e+i-d,s+o],[e,s+o]]}case"trapezoid":{const d=i*.2;return[[e+d,s],[e+i-d,s],[e+i,s+o],[e,s+o]]}case"rightTriangle":return[[e,s],[e,s+o],[e+i,s+o]];case"pentagon":return this.getRegularPolyPoints(r,a,l,c,5);case"septagon":return this.getRegularPolyPoints(r,a,l,c,7);case"polygon":return this.getRegularPolyPoints(r,a,l,c,t.polygonSides||6);default:return[[e,s],[e+i,s],[e+i,s+o],[e,s+o]]}}getRegularPolyPoints(t,e,s,i,o){const r=[];for(let a=0;a<o;a++){const l=2*Math.PI/o*a-Math.PI/2;r.push([t+s*Math.cos(l),e+i*Math.sin(l)])}return r}definePath(t,e){const s=this.getPoints(e,e.x,e.y,e.width,e.height);if(!(s.length<2)){t.moveTo(s[0][0],s[0][1]);for(let i=1;i<s.length;i++)t.lineTo(s[i][0],s[i][1]);t.closePath()}}estimatePathLength(t){const e=this.getPoints(t,t.x,t.y,t.width,t.height);if(e.length<2)return 0;let s=0;for(let i=0;i<e.length;i++){const o=e[(i+1)%e.length],r=o[0]-e[i][0],a=o[1]-e[i][1];s+=Math.sqrt(r*r+a*a)}return s}}class Np extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.adjustColor(o.strokeColor,r),l=o.backgroundColor==="transparent"?void 0:K.adjustColor(o.backgroundColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"database":{const y=p*.2,m=this.getDatabasePath(c,d,h,p,y),g=this.getDatabaseTopPath(c,d,h,p,y);l&&(i.fillStyle=l,i.fill(new Path2D(m))),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.stroke(new Path2D(m)),i.stroke(new Path2D(g));break}case"document":{const y=p*.1,m=this.getDocumentPath(c,d,h,p,y);l&&(i.fillStyle=l,i.fill(new Path2D(m))),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.lineJoin="round",i.stroke(new Path2D(m));break}case"predefinedProcess":{const y=h*.1;l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p),i.beginPath(),i.moveTo(c+y,d),i.lineTo(c+y,d+p),i.moveTo(c+h-y,d),i.lineTo(c+h-y,d+p),i.stroke();break}case"internalStorage":{const y=Math.min(h,p)*.15;l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p),i.beginPath(),i.moveTo(c+y,d),i.lineTo(c+y,d+p),i.moveTo(c,d+y),i.lineTo(c+h,d+y),i.stroke();break}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=o.x,c=o.y,d=o.width,h=o.height;switch(o.type){case"database":{const p=h*.2;i.path(this.getDatabasePath(l,c,d,h,p),a),i.path(this.getDatabaseTopPath(l,c,d,h,p),a);break}case"document":{const p=h*.1;i.path(this.getDocumentPath(l,c,d,h,p),a);break}case"predefinedProcess":{const p=d*.1;i.rectangle(l,c,d,h,a),i.line(l+p,c,l+p,c+h,a),i.line(l+d-p,c,l+d-p,c+h,a);break}case"internalStorage":{const p=Math.min(d,h)*.15;i.rectangle(l,c,d,h,a),i.line(l+p,c,l+p,c+h,a),i.line(l,c+p,l+d,c+p,a);break}}K.renderText(t,e,s)}getDatabasePath(t,e,s,i,o){return`
            M ${t} ${e+o/2}
            L ${t} ${e+i-o/2}
            A ${s/2} ${o/2} 0 0 0 ${t+s} ${e+i-o/2}
            L ${t+s} ${e+o/2}
            A ${s/2} ${o/2} 0 0 0 ${t} ${e+o/2}
            A ${s/2} ${o/2} 0 0 0 ${t+s} ${e+o/2}
        `}getDatabaseTopPath(t,e,s,i,o){return`
            M ${t} ${e+o/2}
            A ${s/2} ${o/2} 0 1 1 ${t+s} ${e+o/2}
            A ${s/2} ${o/2} 0 1 1 ${t} ${e+o/2}
        `}getDocumentPath(t,e,s,i,o){return`
            M ${t} ${e}
            L ${t+s} ${e}
            L ${t+s} ${e+i-o}
            Q ${t+s*.75} ${e+i-o*2} ${t+s*.5} ${e+i-o}
            T ${t} ${e+i-o}
            Z
        `}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Fp extends ee{renderArchitectural(t,e,s){const{ctx:i,rc:o,element:r,isDarkMode:a}=t,l=K.buildRenderOptions(r,a),c=K.adjustColor(r.strokeColor,a),d=r.x,h=r.y,p=r.width,y=r.height;switch(r.type){case"starPerson":{const m=Math.min(Math.abs(p),Math.abs(y))*.15,g=d+p/2,w=h+m,x=this.getStarPersonBodyPoints(d,h,p,y,m);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(o.ellipse(g,w,m*2,m*2,{...l,stroke:"none",fill:l.fill}),o.polygon(x,{...l,stroke:"none",fill:l.fill})),i.beginPath(),i.ellipse(g,w,m,m,0,0,Math.PI*2),i.moveTo(x[0][0],x[0][1]);for(let b=1;b<x.length;b++)i.lineTo(x[b][0],x[b][1]);i.strokeStyle=c,i.lineWidth=r.strokeWidth,i.stroke();break}case"lightbulb":{const m=Math.min(p,y/1.5)/2,g=p*.4,w=y*.25,x=h+y-w,b=this.getLightbulbPath(d,h,p,m,g,x);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(i.fillStyle=l.fill,i.fill(new Path2D(b)),i.fillRect(d+p/2-g/2,x,g,w)),i.strokeStyle=c,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(b)),i.strokeRect(d+p/2-g/2,x,g,w);break}case"signpost":{const m=Math.max(4,p*.05),g=y*.3,w=p*.9,x=h+y*.1,b=d+p/2-m/2,S=d+p/2-w/2;l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(i.fillStyle=l.fill,i.fillRect(b,h,m,y),i.fillRect(S,x,w,g)),i.strokeStyle=c,i.lineWidth=r.strokeWidth,i.strokeRect(b,h,m,y),i.strokeRect(S,x,w,g);break}case"burstBlob":{const m=this.getBurstBlobPath(r);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(i.fillStyle=l.fill,i.fill(new Path2D(m))),i.strokeStyle=c,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(m)),i.stroke(new Path2D(m));break}case"wavyDivider":{const m=this.getWavyDividerPath(d,h,p,y);i.strokeStyle=c,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(m));break}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=o.x,c=o.y,d=o.width,h=o.height;switch(o.type){case"starPerson":{const p=Math.min(Math.abs(d),Math.abs(h))*.15;i.ellipse(l+d/2,c+p,p*2,p*2,a),i.polygon(this.getStarPersonBodyPoints(l,c,d,h,p),a);break}case"lightbulb":{const p=Math.min(d,h/1.5)/2,y=d*.4,m=h*.25,g=c+h-m;i.path(this.getLightbulbPath(l,c,d,p,y,g),a),i.rectangle(l+d/2-y/2,g,y,m,a);break}case"signpost":{const p=Math.max(4,d*.05),y=h*.3,m=d*.9,g=c+h*.1;i.rectangle(l+d/2-p/2,c,p,h,{...a,fill:"none"}),i.rectangle(l+d/2-m/2,g,m,y,a);break}case"burstBlob":{i.path(this.getBurstBlobPath(o),a);break}case"wavyDivider":{i.path(this.getWavyDividerPath(l,c,d,h),a);break}}K.renderText(t,e,s)}getStarPersonBodyPoints(t,e,s,i,o){const r=t+s/2;return[[r,e+o*2],[t,e+i*.4],[r,e+i*.5],[t+s,e+i*.4],[r,e+o*2],[t+s*.8,e+i],[r,e+i*.7],[t+s*.2,e+i],[r,e+o*2]]}getLightbulbPath(t,e,s,i,o,r){const a=t+s/2;return`
            M ${a-o/2} ${r}
            C ${a-o/2} ${e+i} ${t} ${e+i*1.5} ${t} ${e+i}
            A ${i} ${i} 0 1 1 ${t+s} ${e+i}
            C ${t+s} ${e+i*1.5} ${a+o/2} ${e+i} ${a+o/2} ${r}
            Z
        `}getWavyDividerPath(t,e,s,i){const o=e+i/2,r=4,a=s/r;let l=`M ${t} ${o}`;for(let c=0;c<r;c++){const d=t+c*a;l+=` Q ${d+a/4} ${o-i/2}, ${d+a/2} ${o}`,l+=` Q ${d+a*.75} ${o+i/2}, ${d+a} ${o}`}return l}getBurstBlobPath(t){const e=t.x,s=t.y,i=t.width,o=t.height,r=e+i/2,a=s+o/2,l=i/2,c=o/2,d=12,h=Math.min(l,c),p=h*.6,y=t.seed||1,m=w=>{let x=w+=1831565813;return x=Math.imul(x^x>>>15,x|1),x^=x+Math.imul(x^x>>>7,x|61),((x^x>>>14)>>>0)/4294967296};let g="";for(let w=0;w<d*2;w++){const x=w%2===0?h:p,b=m(y+w),S=x+(b-.5)*(h*.1),P=Math.PI*w/d,R=r+Math.cos(P)*(i/o)*S,B=a+Math.sin(P)*S;g+=(w===0?"M ":" L ")+R+" "+B}return g+" Z"}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Up extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.adjustColor(o.strokeColor,r),l=o.backgroundColor==="transparent"?void 0:K.adjustColor(o.backgroundColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"server":{l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p);const y=p*.05,m=h*.7,g=c+(h-m)/2;i.fillStyle=a;for(let w=0;w<3;w++)i.fillRect(g,d+p-(w+1)*y*2-y,m,y);break}case"loadBalancer":{const y=c+h/2,m=d+p/2;l&&(i.fillStyle=l,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.stroke();const g=h*.3;i.beginPath(),i.moveTo(y-g,m),i.lineTo(y+g,m),i.stroke(),this.drawArchArrowhead(i,y+g,m,0),this.drawArchArrowhead(i,y-g,m,Math.PI);break}case"firewall":{l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p);const y=4,m=3,g=p/y,w=h/m;i.beginPath();for(let x=1;x<y;x++)i.moveTo(c,d+x*g),i.lineTo(c+h,d+x*g);for(let x=0;x<y;x++){const b=x%2===0?0:w/2;for(let S=1;S<m;S++){const P=c+S*w+b;P<c+h&&(i.moveTo(P,d+x*g),i.lineTo(P,d+(x+1)*g))}}i.stroke();break}case"user":{const y=Math.min(h,p)*.25,m=c+h/2;l&&(i.fillStyle=l,i.beginPath(),i.arc(m,d+y,y,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.beginPath(),i.arc(m,d+y,y,0,Math.PI*2),i.stroke();const g=h*.8;i.beginPath(),i.moveTo(m-g/2,d+p),i.quadraticCurveTo(m,d+y*1.5,m+g/2,d+p),i.stroke();break}case"messageQueue":{l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p);const y=4,m=h/y;i.beginPath();for(let g=1;g<y;g++)i.moveTo(c+g*m,d),i.lineTo(c+g*m,d+p);i.stroke();break}case"lambda":{const y=c+h/2,m=d+p/2,g=h*.4,w=p*.6,x=y-g/2,b=m-w/2,S=`M ${x+g} ${b} L ${x} ${b+w*.6} L ${x+g*.6} ${b+w*.5} L ${x} ${b+w} L ${x+g} ${b+w*.4} L ${x+g*.4} ${b+w*.5} Z`;l&&(i.fillStyle=l,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.stroke(),i.fillStyle=a,i.fill(new Path2D(S));break}case"router":{const y=c+h/2,m=d+p/2;l&&(i.fillStyle=l,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,p/2,0,0,Math.PI*2),i.stroke();const g=Math.min(h,p)*.3;i.beginPath();for(let w=0;w<4;w++){const x=Math.PI/2*w+Math.PI/4;i.moveTo(y,m),i.lineTo(y+g*Math.cos(x),m+g*Math.sin(x))}i.stroke();break}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=K.adjustColor(o.strokeColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"server":{i.rectangle(c,d,h,p,a);const y=h*.7,m=p*.05,g=c+(h-y)/2;for(let w=0;w<3;w++)i.rectangle(g,d+p-(w+1)*m*2-m,y,m,{...a,fillStyle:"solid",fill:l});break}case"loadBalancer":{const y=c+h/2,m=d+p/2;i.ellipse(y,m,h,p,a);const g=h*.3;i.line(y-g,m,y+g,m,a),this.drawSketchArrowhead(i,y+g,m,0,a),this.drawSketchArrowhead(i,y-g,m,Math.PI,a);break}case"firewall":{i.rectangle(c,d,h,p,a);const y=4,m=3,g=p/y,w=h/m;for(let x=1;x<y;x++)i.line(c,d+x*g,c+h,d+x*g,a);for(let x=0;x<y;x++){const b=x%2===0?0:w/2;for(let S=1;S<m;S++){const P=c+S*w+b;P<c+h&&i.line(P,d+x*g,P,d+(x+1)*g,a)}}break}case"user":{const y=Math.min(h,p)*.25,m=c+h/2;i.circle(m,d+y,y*2,a);const g=h*.8,w=`M ${m-g/2} ${d+p} Q ${m} ${d+y*1.5} ${m+g/2} ${d+p} Z`;i.path(w,a);break}case"messageQueue":{i.rectangle(c,d,h,p,a);const y=4,m=h/y;for(let g=1;g<y;g++)i.line(c+g*m,d,c+g*m,d+p,a);break}case"lambda":{const y=c+h/2,m=d+p/2,g=h*.4,w=p*.6,x=y-g/2,b=m-w/2,S=`M ${x+g} ${b} L ${x} ${b+w*.6} L ${x+g*.6} ${b+w*.5} L ${x} ${b+w} L ${x+g} ${b+w*.4} L ${x+g*.4} ${b+w*.5} Z`;i.ellipse(y,m,h,p,a),i.path(S,{...a,fillStyle:"solid",fill:l});break}case"router":{const y=c+h/2,m=d+p/2;i.ellipse(y,m,h,p,a);const g=Math.min(h,p)*.3;for(let w=0;w<4;w++){const x=Math.PI/2*w+Math.PI/4,b=y+g*Math.cos(x),S=m+g*Math.sin(x);i.line(y,m,b,S,a),this.drawSketchArrowhead(i,b,S,x,a)}break}}K.renderText(t,e,s)}drawArchArrowhead(t,e,s,i){t.beginPath(),t.moveTo(e-5*Math.cos(i-Math.PI/6),s-5*Math.sin(i-Math.PI/6)),t.lineTo(e,s),t.lineTo(e-5*Math.cos(i+Math.PI/6),s-5*Math.sin(i+Math.PI/6)),t.stroke()}drawSketchArrowhead(t,e,s,i,o){const a={x:e-10*Math.cos(i-Math.PI/6),y:s-10*Math.sin(i-Math.PI/6)},l={x:e-10*Math.cos(i+Math.PI/6),y:s-10*Math.sin(i+Math.PI/6)};t.line(e,s,a.x,a.y,o),t.line(e,s,l.x,l.y,o)}definePath(t,e){e.type==="loadBalancer"||e.type==="router"||e.type==="lambda"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):t.rect(e.x,e.y,e.width,e.height)}}class Gp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.adjustColor(o.strokeColor,r),l=o.backgroundColor==="transparent"?void 0:K.adjustColor(o.backgroundColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"browserWindow":{l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p);const y=Math.min(p*.15,30);i.strokeRect(c,d,h,y);const m=4;for(let g=0;g<3;g++)i.beginPath(),i.arc(c+10+g*15,d+y/2,m,0,Math.PI*2),i.stroke();break}case"mobilePhone":{l&&(i.fillStyle=l,i.roundRect(c,d,h,p,20),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.beginPath(),i.roundRect(c,d,h,p,20),i.stroke();const m=10;i.strokeRect(c+m,d+m+20,h-2*m,p-2*m-40),i.beginPath(),i.arc(c+h/2,d+p-20,10,0,Math.PI*2),i.stroke();break}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=o.x,c=o.y,d=o.width,h=o.height;switch(o.type){case"browserWindow":{i.rectangle(l,c,d,h,a);const p=Math.min(h*.15,30);i.rectangle(l,c,d,p,a);for(let y=0;y<3;y++)i.circle(l+10+y*15,c+p/2,8,a);break}case"mobilePhone":{const y=this.getRoundedRectPath(l,c,d,h,20);i.path(y,a);const m=10;i.rectangle(l+m,c+m+20,d-2*m,h-2*m-40,a),i.circle(l+d/2,c+h-20,20,a);break}}K.renderText(t,e,s)}getRoundedRectPath(t,e,s,i,o){const r=Math.min(Math.abs(s)/2,o),a=Math.min(Math.abs(i)/2,o);return`M ${t+r} ${e} L ${t+s-r} ${e} Q ${t+s} ${e} ${t+s} ${e+a} L ${t+s} ${e+i-a} Q ${t+s} ${e+i} ${t+s-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){const s=e.x,i=e.y,o=e.width,r=e.height;e.type==="mobilePhone"?t.roundRect(s,i,o,r,20):t.rect(s,i,o,r)}}class qp extends ee{renderArchitectural(t,e,s){this.renderCommon(t)}renderSketch(t,e,s){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:s,isDarkMode:i}=t,o=K.adjustColor(s.strokeColor,i);if(s.type==="organicBranch"){const r=Yt(s.points),a=s.controlPoints||[];if(r.length<2||a.length<2)return;const l={x:s.x+r[0].x,y:s.y+r[0].y},c={x:s.x+r[r.length-1].x,y:s.y+r[r.length-1].y},d=a[0],h=a[1];this.drawOrganicBranch(e,l,c,d,h,o,s.strokeWidth,s.text||"",o),this.renderFlow(t,l,c,d,h)}}renderFlow(t,e,s,i,o){const{ctx:r,element:a,isDarkMode:l}=t;if(!a.flowAnimation)return;const c=window.yappyGlobalTime||performance.now(),d=(a.flowSpeed??2)*50,h=c/1e3*d,p=K.adjustColor(a.flowColor||a.strokeColor,l),y=Math.max(2,a.strokeWidth*1.5),m=100/(a.flowDensity||3);r.save(),r.fillStyle=p,r.shadowBlur=a.flowStyle==="pulse"?y:0,r.shadowColor=p;const g=Math.sqrt((s.x-e.x)**2+(s.y-e.y)**2),w=Math.sqrt((i.x-e.x)**2+(i.y-e.y)**2)+Math.sqrt((o.x-i.x)**2+(o.y-i.y)**2)+Math.sqrt((s.x-o.x)**2+(s.y-o.y)**2),x=(g+w)/2,b=Math.ceil(x/5);for(let S=0;S<=b;S++){const P=S/b;if((P*x+h)%m<d/10){const B=this.cubicBezier(e.x,i.x,o.x,s.x,P),U=this.cubicBezier(e.y,i.y,o.y,s.y,P),D=Math.min(1,P+.01),Q=this.cubicBezier(e.x,i.x,o.x,s.x,D),ot=this.cubicBezier(e.y,i.y,o.y,s.y,D),st=Math.atan2(ot-U,Q-B);this.drawPulse(r,B,U,y,a.flowStyle,st)}}r.restore()}drawPulse(t,e,s,i,o,r=0){if(t.save(),t.translate(e,s),t.rotate(r),o==="dashes")t.fillRect(-i,-i/2,i*2,i);else if(o==="pulse"){t.beginPath(),t.arc(0,0,i*1.5,0,Math.PI*2);const a=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=a,t.fill()}else t.beginPath(),t.arc(0,0,i,0,Math.PI*2),t.fill();t.restore()}cubicBezier(t,e,s,i,o){const r=1-o;return r*r*r*t+3*r*r*o*e+3*r*o*o*s+o*o*o*i}cubicBezierAngle(t,e,s,i,o){const r=3*(1-o)*(1-o)*(e.x-t.x)+6*(1-o)*o*(s.x-e.x)+3*o*o*(i.x-s.x),a=3*(1-o)*(1-o)*(e.y-t.y)+6*(1-o)*o*(s.y-e.y)+3*o*o*(i.y-s.y);return Math.atan2(a,r)}drawOrganicBranch(t,e,s,i,o,r,a,l,c){const h=[],p=[],y=Math.max(a*8,4),m=Math.max(a*2,2);for(let g=0;g<=20;g++){const w=g/20,x=this.cubicBezier(e.x,i.x,o.x,s.x,w),b=this.cubicBezier(e.y,i.y,o.y,s.y,w),S=this.cubicBezierAngle(e,i,o,s,w),R=(y+(m-y)*w)/2,B=Math.cos(S+Math.PI/2)*R,U=Math.sin(S+Math.PI/2)*R;h.push({x:x+B,y:b+U}),p.push({x:x-B,y:b-U})}t.beginPath(),t.moveTo(h[0].x,h[0].y);for(let g=1;g<h.length;g++)t.lineTo(h[g].x,h[g].y);t.lineTo(p[p.length-1].x,p[p.length-1].y);for(let g=p.length-2;g>=0;g--)t.lineTo(p[g].x,p[g].y);if(t.closePath(),t.fillStyle=r,t.fill(),l){t.save(),t.font="16px sans-serif",t.fillStyle=c,t.textAlign="center",t.textBaseline="middle";const g=this.cubicBezier(e.x,i.x,o.x,s.x,.5),w=this.cubicBezier(e.y,i.y,o.y,s.y,.5),x=this.cubicBezierAngle(e,i,o,s,.5),b=-15;t.translate(g,w);let S=x;(S>Math.PI/2||S<-Math.PI/2)&&(S+=Math.PI),t.rotate(S),t.fillText(l,0,b),t.restore()}}definePath(t,e){if(e.type==="organicBranch"){const s=Yt(e.points),i=e.controlPoints||[];if(s.length<2||i.length<2)return;const o={x:e.x+s[0].x,y:e.y+s[0].y},r={x:e.x+s[s.length-1].x,y:e.y+s[s.length-1].y},a=i[0],l=i[1];t.moveTo(o.x,o.y),t.bezierCurveTo(a.x,a.y,l.x,l.y,r.x,r.y)}}}class jp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.adjustColor(o.strokeColor,r),l=o.backgroundColor==="transparent"?void 0:K.adjustColor(o.backgroundColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"browser":{l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p);const y=p*.15;i.beginPath(),i.moveTo(c,d+y),i.lineTo(c+h,d+y),i.stroke(),i.fillStyle=a;const m=y*.2;for(let g=0;g<3;g++)i.beginPath(),i.arc(c+y*(.5+g*.6),d+y/2,m,0,Math.PI*2),i.fill();break}case"ghostButton":{const y=Math.min(h,p)*.2;l&&(i.fillStyle=l,i.roundRect(c,d,h,p,y),i.fill()),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.setLineDash([4,4]),i.roundRect(c,d,h,p,y),i.stroke(),i.setLineDash([]);break}case"inputField":{if(l&&(i.fillStyle=l,i.fillRect(c,d,h,p)),i.strokeStyle=a,i.lineWidth=o.strokeWidth,i.strokeRect(c,d,h,p),i.beginPath(),i.moveTo(c+10,d+8),i.lineTo(c+10,d+p-8),i.stroke(),o.containerText){i.save(),i.textAlign="left";const y=c+25,m=xe(i,o,o.containerText,h-30),g=d+(p-m.textHeight)/2+m.lineHeight/2;i.fillStyle=a,m.lines.forEach((w,x)=>{i.fillText(w,y,g+x*m.lineHeight)}),i.restore();return}break}}K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=K.adjustColor(o.strokeColor,r),c=o.x,d=o.y,h=o.width,p=o.height;switch(o.type){case"browser":{i.rectangle(c,d,h,p,a);const y=p*.15;i.line(c,d+y,c+h,d+y,a);const m=y*.3;for(let g=0;g<3;g++)i.circle(c+y*(.5+g*.6),d+y/2,m,{...a,fillStyle:"solid",fill:l});break}case"ghostButton":{const y=Math.min(h,p)*.2,m=this.getRoundedRectPath(c,d,h,p,y);i.path(m,{...a,strokeLineDash:[4,4]});break}case"inputField":{i.rectangle(c,d,h,p,a),i.line(c+10,d+8,c+10,d+p-8,a);break}}K.renderText(t,e,s)}getRoundedRectPath(t,e,s,i,o){const r=Math.min(Math.abs(s)/2,o),a=Math.min(Math.abs(i)/2,o);return`M ${t+r} ${e} L ${t+s-r} ${e} Q ${t+s} ${e} ${t+s} ${e+a} L ${t+s} ${e+i-a} Q ${t+s} ${e+i} ${t+s-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){if(e.type==="ghostButton"){const s=Math.min(e.width,e.height)*.2;t.roundRect(e.x,e.y,e.width,e.height,s)}else t.rect(e.x,e.y,e.width,e.height)}}class Qp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.adjustColor(o.strokeColor,r),l=o.backgroundColor==="transparent"?"#ffffff":K.adjustColor(o.backgroundColor,r);i.save(),i.strokeStyle=a,i.fillStyle=l,i.lineWidth=o.strokeWidth,i.lineCap="round",i.lineJoin=o.strokeLineJoin||"round",o.strokeStyle==="dashed"?i.setLineDash([8,8]):o.strokeStyle==="dotted"&&i.setLineDash([2,4]),i.beginPath(),this.definePath(i,o),i.stroke(),this.renderFlow(t);const c=Yt(o.points);let d,h;c.length>=2?(d={x:o.x+c[0].x,y:o.y+c[0].y},h={x:o.x+c[c.length-1].x,y:o.y+c[c.length-1].y}):(d={x:o.x,y:o.y},h={x:o.x+o.width,y:o.y+o.height});let p;if(o.curveType==="bezier"){const y=o.controlPoints?.[0]||{x:d.x,y:d.y},m=o.controlPoints?.[1]||y;if(o.startArrowhead){const g=Math.atan2(d.y-y.y,d.x-y.x);this.drawArrowheadArchitectural(i,d.x,d.y,g,o.startArrowhead)}if(o.endArrowhead){const g=Math.atan2(h.y-m.y,h.x-m.x);this.drawArrowheadArchitectural(i,h.x,h.y,g,o.endArrowhead)}}else if(o.curveType==="elbow"&&c.length>=2){const y={x:o.x+c[0].x,y:o.y+c[0].y},m={x:o.x+c[1].x,y:o.y+c[1].y},g=Math.atan2(y.y-m.y,y.x-m.x);o.startArrowhead&&this.drawArrowheadArchitectural(i,y.x,y.y,g,o.startArrowhead);const w={x:o.x+c[c.length-1].x,y:o.y+c[c.length-1].y},x={x:o.x+c[c.length-2].x,y:o.y+c[c.length-2].y},b=Math.atan2(w.y-x.y,w.x-x.x);o.endArrowhead&&this.drawArrowheadArchitectural(i,w.x,w.y,b,o.endArrowhead)}else p=Math.atan2(h.y-d.y,h.x-d.x),o.startArrowhead&&this.drawArrowheadArchitectural(i,d.x,d.y,p+Math.PI,o.startArrowhead),o.endArrowhead&&this.drawArrowheadArchitectural(i,h.x,h.y,p,o.endArrowhead);i.restore()}renderSketch(t,e,s){this.renderCommon(t,e,s),this.renderFlow(t)}renderCommon(t,e,s){const{element:i,isDarkMode:o}=t,r=K.buildRenderOptions(i,o);i.curveType==="bezier"?this.renderBezier(t,r):i.curveType==="elbow"?this.renderElbow(t,r):this.renderStraight(t,r)}renderBezier(t,e){e={...e,fill:void 0};const{rc:s,element:i}=t,o=i.x+i.width,r=i.y+i.height,a=Yt(i.points);let l={x:i.x,y:i.y},c={x:o,y:r};if(a.length>=2&&(l={x:i.x+a[0].x,y:i.y+a[0].y},c={x:i.x+a[a.length-1].x,y:i.y+a[a.length-1].y}),i.controlPoints&&i.controlPoints.length>0){const d=i.controlPoints[0];if(i.controlPoints.length>1){const h=i.controlPoints[1],p=`M ${l.x} ${l.y} C ${d.x} ${d.y}, ${h.x} ${h.y}, ${c.x} ${c.y}`;s.path(p,e),i.startArrowhead&&this.drawArrowhead(s,l.x,l.y,Math.atan2(l.y-d.y,l.x-d.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(s,c.x,c.y,Math.atan2(c.y-h.y,c.x-h.x),i.endArrowhead,e)}else{const h=`M ${l.x} ${l.y} Q ${d.x} ${d.y}, ${c.x} ${c.y}`;s.path(h,e),i.startArrowhead&&this.drawArrowhead(s,l.x,l.y,Math.atan2(l.y-d.y,l.x-d.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(s,c.x,c.y,Math.atan2(c.y-d.y,c.x-d.x),i.endArrowhead,e)}}else{const d=i.width,h=i.height;let p,y;Math.abs(d)>Math.abs(h)?(p={x:l.x+d/2,y:l.y},y={x:c.x-d/2,y:c.y}):(p={x:l.x,y:l.y+h/2},y={x:c.x,y:c.y-h/2});const m=`M ${l.x} ${l.y} C ${p.x} ${p.y}, ${y.x} ${y.y}, ${c.x} ${c.y}`;s.path(m,e),i.startArrowhead&&this.drawArrowhead(s,l.x,l.y,Math.atan2(l.y-p.y,l.x-p.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(s,c.x,c.y,Math.atan2(c.y-y.y,c.x-y.x),i.endArrowhead,e)}}renderElbow(t,e){e={...e,fill:void 0};const{rc:s,element:i}=t,o=Yt(i.points),r=o&&o.length>0?o.map(l=>[i.x+l.x,i.y+l.y]):[[i.x,i.y],[i.x+i.width,i.y+i.height]];s.linearPath(r,e);const a=r.filter((l,c,d)=>c===0||Math.abs(l[0]-d[c-1][0])>.1||Math.abs(l[1]-d[c-1][1])>.1);if(i.startArrowhead&&a.length>=2){const l=Math.atan2(a[0][1]-a[1][1],a[0][0]-a[1][0]);this.drawArrowhead(s,a[0][0],a[0][1],l,i.startArrowhead,e)}if(i.endArrowhead&&a.length>=2){const l=a.length,c=Math.atan2(a[l-1][1]-a[l-2][1],a[l-1][0]-a[l-2][0]);this.drawArrowhead(s,a[l-1][0],a[l-1][1],c,i.endArrowhead,e)}}renderStraight(t,e){e={...e,fill:void 0};const{rc:s,element:i}=t,o=Yt(i.points);let r,a;o.length>=2?(r={x:i.x+o[0].x,y:i.y+o[0].y},a={x:i.x+o[o.length-1].x,y:i.y+o[o.length-1].y}):(r={x:i.x,y:i.y},a={x:i.x+i.width,y:i.y+i.height}),s.line(r.x,r.y,a.x,a.y,e);const l=Math.atan2(a.y-r.y,a.x-r.x);i.startArrowhead&&this.drawArrowhead(s,r.x,r.y,l+Math.PI,i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(s,a.x,a.y,l,i.endArrowhead,e)}drawArrowhead(t,e,s,i,o,r){const l={x:e-12*Math.cos(i-Math.PI/6),y:s-12*Math.sin(i-Math.PI/6)},c={x:e-12*Math.cos(i+Math.PI/6),y:s-12*Math.sin(i+Math.PI/6)};if(o==="triangle"||o==="arrow")o==="triangle"?t.polygon([[e,s],[l.x,l.y],[c.x,c.y]],{...r,fill:"#ffffff",fillStyle:"solid"}):(t.line(e,s,l.x,l.y,r),t.line(e,s,c.x,c.y,r));else if(o==="circle"||o==="dot")t.circle(e,s,12,{...r,fill:o==="dot"?r.stroke:"#ffffff",fillStyle:"solid"});else if(o==="diamond"||o==="diamondFilled"){const d={x:e-24*Math.cos(i),y:s-24*Math.sin(i)},h={x:e-12*Math.cos(i),y:s-12*Math.sin(i)},p={x:h.x-12/2*Math.cos(i-Math.PI/2),y:h.y-12/2*Math.sin(i-Math.PI/2)},y={x:h.x-12/2*Math.cos(i+Math.PI/2),y:h.y-12/2*Math.sin(i+Math.PI/2)};t.polygon([[e,s],[p.x,p.y],[d.x,d.y],[y.x,y.y]],{...r,fill:o==="diamondFilled"?r.stroke:"#ffffff",fillStyle:"solid"})}else if(o==="crowsfoot"){const d={x:e-12*Math.cos(i-Math.PI/4),y:s-12*Math.sin(i-Math.PI/4)},h={x:e-12*Math.cos(i+Math.PI/4),y:s-12*Math.sin(i+Math.PI/4)},p={x:e-12*Math.cos(i),y:s-12*Math.sin(i)};t.line(e,s,d.x,d.y,r),t.line(e,s,h.x,h.y,r),t.line(e,s,p.x,p.y,r)}else if(o==="bar"){const d=e+Math.cos(i+Math.PI/2)*12,h=s+Math.sin(i+Math.PI/2)*12,p=e+Math.cos(i-Math.PI/2)*12,y=s+Math.sin(i-Math.PI/2)*12;t.line(d,h,p,y,r)}}drawArrowheadArchitectural(t,e,s,i,o){t.save(),t.translate(e,s),t.rotate(i),t.setLineDash([]),o==="triangle"||o==="arrow"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/6),-12*Math.sin(Math.PI/6)),o==="triangle"?(t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6)),t.closePath(),t.fillStyle="#ffffff",t.fill()):(t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6))),t.stroke()):o==="circle"||o==="dot"?(t.beginPath(),t.arc(-12/2*Math.cos(0),0,12/2,0,Math.PI*2),o==="dot"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):o==="diamond"||o==="diamondFilled"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12,-12/2),t.lineTo(-24,0),t.lineTo(-12,12/2),t.closePath(),o==="diamondFilled"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):o==="crowsfoot"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/4),-12*Math.sin(Math.PI/4)),t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/4),-12*Math.sin(-Math.PI/4)),t.moveTo(0,0),t.lineTo(-12,0),t.stroke()):o==="bar"&&(t.beginPath(),t.moveTo(0,-12),t.lineTo(0,12),t.stroke()),t.restore()}renderFlow(t){const{ctx:e,element:s,isDarkMode:i}=t;if(!s.flowAnimation)return;const o=window.yappyGlobalTime||performance.now(),r=(s.flowSpeed??2)*50,a=o/1e3*r,l=K.adjustColor(s.flowColor||s.strokeColor,i),c=Math.max(2,s.strokeWidth*1.5),d=100/(s.flowDensity||3);e.save(),e.fillStyle=l,e.shadowBlur=s.flowStyle==="pulse"?c:0,e.shadowColor=l;const h=Yt(s.points);let p,y;if(h.length>=2?(p={x:s.x+h[0].x,y:s.y+h[0].y},y={x:s.x+h[h.length-1].x,y:s.y+h[h.length-1].y}):(p={x:s.x,y:s.y},y={x:s.x+s.width,y:s.y+s.height}),s.curveType==="bezier"){let m,g;if(s.controlPoints&&s.controlPoints.length>0)m=s.controlPoints[0],g=s.controlPoints.length>1?s.controlPoints[1]:m;else{const P=s.width,R=s.height;Math.abs(P)>Math.abs(R)?(m={x:p.x+P/2,y:p.y},g={x:y.x-P/2,y:y.y}):(m={x:p.x,y:p.y+R/2},g={x:y.x,y:y.y-R/2})}const w=Math.sqrt((y.x-p.x)**2+(y.y-p.y)**2),x=Math.sqrt((m.x-p.x)**2+(m.y-p.y)**2)+Math.sqrt((g.x-m.x)**2+(g.y-m.y)**2)+Math.sqrt((y.x-g.x)**2+(y.y-g.y)**2),b=(w+x)/2,S=Math.ceil(b/5);for(let P=0;P<=S;P++){const R=P/S;if((R*b+a)%d<r/10){const U=ci(p.x,m.x,g.x,y.x,R),D=ci(p.y,m.y,g.y,y.y,R),Q=Math.min(1,R+.01),ot=ci(p.x,m.x,g.x,y.x,Q),st=ci(p.y,m.y,g.y,y.y,Q),ht=Math.atan2(st-D,ot-U);this.drawPulse(e,U,D,c,s.flowStyle,ht)}}}else if(s.curveType==="elbow"&&h.length>=2){let m=0;for(let g=0;g<h.length-1;g++){const w={x:s.x+h[g].x,y:s.y+h[g].y},x={x:s.x+h[g+1].x,y:s.y+h[g+1].y},b=Math.sqrt((x.x-w.x)**2+(x.y-w.y)**2),S=Math.atan2(x.y-w.y,x.x-w.x),P=Math.ceil(b/5);for(let R=0;R<=P;R++){const B=R/P;if((m+B*b+a)%d<r/10){const D=w.x+(x.x-w.x)*B,Q=w.y+(x.y-w.y)*B;this.drawPulse(e,D,Q,c,s.flowStyle,S)}}m+=b}}else{const m=y.x-p.x,g=y.y-p.y,w=Math.sqrt(m*m+g*g),x=Math.atan2(g,m),b=Math.ceil(w/5);for(let S=0;S<=b;S++){const P=S/b;if((P*w+a)%d<r/10){const B=p.x+m*P,U=p.y+g*P;this.drawPulse(e,B,U,c,s.flowStyle,x)}}}e.restore()}drawPulse(t,e,s,i,o,r=0){if(t.save(),t.translate(e,s),t.rotate(r),o==="dashes")t.fillRect(-i,-i/2,i*2,i);else if(o==="pulse"){t.beginPath(),t.arc(0,0,i*1.5,0,Math.PI*2);const a=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=a,t.fill()}else t.beginPath(),t.arc(0,0,i,0,Math.PI*2),t.fill();t.restore()}definePath(t,e){const s=Yt(e.points);let i,o;if(s.length>=2?(i={x:e.x+s[0].x,y:e.y+s[0].y},o={x:e.x+s[s.length-1].x,y:e.y+s[s.length-1].y}):(i={x:e.x,y:e.y},o={x:e.x+e.width,y:e.y+e.height}),e.curveType==="bezier"){const r=e.width,a=e.height;let l,c;e.controlPoints&&e.controlPoints.length>0?(l=e.controlPoints[0],e.controlPoints.length>1?(c=e.controlPoints[1],t.moveTo(i.x,i.y),t.bezierCurveTo(l.x,l.y,c.x,c.y,o.x,o.y)):(t.moveTo(i.x,i.y),t.quadraticCurveTo(l.x,l.y,o.x,o.y))):(Math.abs(r)>Math.abs(a)?(l={x:i.x+r/2,y:i.y},c={x:o.x-r/2,y:o.y}):(l={x:i.x,y:i.y+a/2},c={x:o.x,y:o.y-a/2}),t.moveTo(i.x,i.y),t.bezierCurveTo(l.x,l.y,c.x,c.y,o.x,o.y))}else if(e.curveType==="elbow"){const r=s&&s.length>0?s.map(a=>({x:e.x+a.x,y:e.y+a.y})):[i,o];t.moveTo(r[0].x,r[0].y);for(let a=1;a<r.length;a++)t.lineTo(r[a].x,r[a].y)}else t.moveTo(i.x,i.y),t.lineTo(o.x,o.y)}estimatePathLength(t){const e=Yt(t.points);let s,i;if(e.length>=2?(s={x:t.x+e[0].x,y:t.y+e[0].y},i={x:t.x+e[e.length-1].x,y:t.y+e[e.length-1].y}):(s={x:t.x,y:t.y},i={x:t.x+t.width,y:t.y+t.height}),t.curveType==="bezier"){let o,r;if(t.controlPoints&&t.controlPoints.length>0)o=t.controlPoints[0],r=t.controlPoints.length>1?t.controlPoints[1]:o;else{const c=t.width,d=t.height;Math.abs(c)>Math.abs(d)?(o={x:s.x+c/2,y:s.y},r={x:i.x-c/2,y:i.y}):(o={x:s.x,y:s.y+d/2},r={x:i.x,y:i.y-d/2})}const a=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),l=Math.sqrt((o.x-s.x)**2+(o.y-s.y)**2)+Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2)+Math.sqrt((i.x-r.x)**2+(i.y-r.y)**2);return(a+l)/2}else if(t.curveType==="elbow"&&e.length>=2){let o=0;const r=e.map(a=>({x:t.x+a.x,y:t.y+a.y}));for(let a=0;a<r.length-1;a++)o+=Math.sqrt((r[a+1].x-r[a].x)**2+(r[a+1].y-r[a].y)**2);return o}else return Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2)}}class Vp extends ee{renderArchitectural(t,e,s){this.renderCommon(t)}renderSketch(t,e,s){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:s,isDarkMode:i,layerOpacity:o}=t;if(!s.points||s.points.length===0)return;let r=Yt(s.points).map(l=>({x:s.x+l.x,y:s.y+l.y}));s.smoothing&&s.smoothing>0&&(r=this.smoothPoints(r,s.smoothing));const a=K.adjustColor(s.strokeColor,i);e.save(),e.strokeStyle=a,e.fillStyle=a,s.type==="fineliner"?this.renderFineliner(e,r,s.strokeWidth):s.type==="inkbrush"?this.renderInkbrush(e,r,s.strokeWidth,s.taperAmount,s.velocitySensitivity):s.type==="marker"?this.renderMarker(e,r,s.strokeWidth,s.opacity,o):s.type==="ink"&&this.renderFineliner(e,r,s.strokeWidth),e.restore()}smoothPoints(t,e){if(t.length<3)return t;const s=[t[0]],i=Math.floor(e/2)||1;for(let o=1;o<t.length-1;o++){let r=0,a=0,l=0;for(let c=Math.max(0,o-i);c<=Math.min(t.length-1,o+i);c++)r+=t[c].x,a+=t[c].y,l++;s.push({x:r/l,y:a/l})}return s.push(t[t.length-1]),s}renderFineliner(t,e,s){if(e.length<6){t.beginPath(),t.arc(e[0].x,e[0].y,s/2,0,Math.PI*2),t.fill();return}t.lineWidth=s,t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length-2;o++){const r=(e[o].x+e[o+1].x)/2,a=(e[o].y+e[o+1].y)/2;t.quadraticCurveTo(e[o].x,e[o].y,r,a)}const i=e.length-1;t.quadraticCurveTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y),t.stroke()}renderInkbrush(t,e,s,i=.15,o=.5){if(e.length<2){t.beginPath(),t.arc(e[0].x,e[0].y,s/2,0,Math.PI*2),t.fill();return}const r=[0];for(let g=1;g<e.length;g++){const w=e[g].x-e[g-1].x,x=e[g].y-e[g-1].y;r.push(Math.sqrt(w*w+x*x))}const a=[],l=3;for(let g=0;g<r.length;g++){let w=0,x=0;for(let b=Math.max(0,g-l);b<=Math.min(r.length-1,g+l);b++)w+=r[b],x++;a.push(w/x)}const c=Math.max(...a,1),d=s*(1-o*.7),h=s*(1+o*.5),p=[];for(let g=0;g<e.length;g++){const w=a[g]/c;let x=h-(h-d)*w;const b=Math.min(e.length*i,20);if(b>0&&(g<b&&(x*=g/b*.9+.1),g>e.length-b-1)){const S=e.length-1-g;x*=S/b*.9+.1}p.push(Math.max(x,.5))}t.beginPath();const y=[],m=[];for(let g=0;g<e.length;g++){let w,x;if(g===0){const S=e[1].x-e[0].x,P=e[1].y-e[0].y,R=Math.sqrt(S*S+P*P)||1;w=-P/R,x=S/R}else if(g===e.length-1){const S=e[g].x-e[g-1].x,P=e[g].y-e[g-1].y,R=Math.sqrt(S*S+P*P)||1;w=-P/R,x=S/R}else{const S=e[g].x-e[g-1].x,P=e[g].y-e[g-1].y,R=e[g+1].x-e[g].x,B=e[g+1].y-e[g].y,U=Math.sqrt(S*S+P*P)||1,D=Math.sqrt(R*R+B*B)||1;w=-(P/U+B/D)/2,x=(S/U+R/D)/2;const Q=Math.sqrt(w*w+x*x)||1;w/=Q,x/=Q}const b=p[g]/2;y.push({x:e[g].x+w*b,y:e[g].y+x*b}),m.push({x:e[g].x-w*b,y:e[g].y-x*b})}if(y.length>=2){t.moveTo(y[0].x,y[0].y);for(let w=1;w<y.length-1;w++){const x=(y[w].x+y[w+1].x)/2,b=(y[w].y+y[w+1].y)/2;t.quadraticCurveTo(y[w].x,y[w].y,x,b)}t.lineTo(y[y.length-1].x,y[y.length-1].y);const g=e.length-1;t.arc(e[g].x,e[g].y,p[g]/2,Math.atan2(y[g].y-e[g].y,y[g].x-e[g].x),Math.atan2(m[g].y-e[g].y,m[g].x-e[g].x),!1);for(let w=m.length-2;w>0;w--){const x=(m[w].x+m[w-1].x)/2,b=(m[w].y+m[w-1].y)/2;t.quadraticCurveTo(m[w].x,m[w].y,x,b)}t.lineTo(m[0].x,m[0].y),t.arc(e[0].x,e[0].y,p[0]/2,Math.atan2(m[0].y-e[0].y,m[0].x-e[0].x),Math.atan2(y[0].y-e[0].y,y[0].x-e[0].x),!1)}t.closePath(),t.fill()}renderMarker(t,e,s,i,o){t.globalAlpha=(i??100)/100*o*.5,t.globalCompositeOperation="multiply",this.renderFineliner(t,e,s*4)}definePath(t,e){const s=Yt(e.points).map(o=>({x:e.x+o.x,y:e.y+o.y}));if(s.length<2)return;if(s.length<6){t.moveTo(s[0].x,s[0].y);for(let o=1;o<s.length;o++)t.lineTo(s[o].x,s[o].y);return}t.moveTo(s[0].x,s[0].y);for(let o=1;o<s.length-2;o++){const r=(s[o].x+s[o+1].x)/2,a=(s[o].y+s[o+1].y)/2;t.quadraticCurveTo(s[o].x,s[o].y,r,a)}const i=s.length-1;t.quadraticCurveTo(s[i-1].x,s[i-1].y,s[i].x,s[i].y)}estimatePathLength(t){const e=Yt(t.points);if(e.length<2)return 0;let s=0;for(let i=1;i<e.length;i++){const o=e[i].x-e[i-1].x,r=e[i].y-e[i-1].y;s+=Math.sqrt(o*o+r*r)}return s}}class Jp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=K.adjustColor(o.strokeColor,r),c=o.backgroundColor==="transparent"?void 0:K.adjustColor(o.backgroundColor,r),d=Ii(o);if(!d)return;if(i.save(),i.translate(e,s),["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(o.type)&&d.type==="multi"){const p=a.fill&&a.fill!=="transparent"&&a.fill!=="none";d.shapes.forEach(y=>{p&&c&&(i.fillStyle=y.shade?K.shadeColor(c,y.shade):c,i.beginPath(),K.renderGeometry(i,y),i.fill()),i.strokeStyle=l,i.lineWidth=o.strokeWidth,i.lineJoin=o.strokeLineJoin||"round",i.beginPath(),K.renderGeometry(i,y),i.stroke(),o.drawInnerBorder})}else if(a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&c&&(i.fillStyle=c,i.beginPath(),K.renderGeometry(i,d),i.fill()),i.strokeStyle=l,i.lineWidth=o.strokeWidth,i.lineJoin=o.strokeLineJoin||"round",i.beginPath(),K.renderGeometry(i,d),i.stroke(),o.drawInnerBorder){const y=o.innerBorderDistance||5,m=(o.width-y*2)/o.width,g=(o.height-y*2)/o.height;m>0&&g>0&&(i.save(),i.scale(m,g),i.strokeStyle=o.innerBorderColor||l,i.beginPath(),K.renderGeometry(i,d),i.stroke(),i.restore())}i.restore(),K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,ctx:o,element:r,isDarkMode:a}=t,l=K.buildRenderOptions(r,a),c=Ii(r);if(!c)return;o.save(),o.translate(e,s),this.renderSketchGeometry(i,c,l);const d=["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(r.type);if(r.drawInnerBorder&&!d){const h=r.innerBorderDistance||5,p=(r.width-h*2)/r.width,y=(r.height-h*2)/r.height;if(p>0&&y>0){const m={...l,stroke:r.innerBorderColor||l.stroke,fill:"none"};o.save(),o.scale(p,y),this.renderSketchGeometry(i,c,m),o.restore()}}o.restore(),K.renderText(t,e,s)}renderSketchGeometry(t,e,s){const i=e.shade&&s.fill&&s.fill!=="transparent"&&s.fill!=="none"?{...s,fill:K.shadeColor(s.fill,e.shade)}:s;if(e.type==="rect")t.rectangle(e.x,e.y,e.w,e.h,i);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx*2,e.ry*2,i);else if(e.type==="points"){const o=e.points.map(r=>[r.x,r.y]);e.isClosed===!1?t.linearPath(o,i):t.polygon(o,i)}else e.type==="path"?t.path(e.path,i):e.type==="multi"&&e.shapes.forEach(o=>this.renderSketchGeometry(t,o,i))}definePath(t,e){const s=Ii(e);s&&(t.translate(e.x+e.width/2,e.y+e.height/2),K.renderGeometry(t,s))}}class Kp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r);i.beginPath(),i.rect(o.x,o.y,o.width,o.height),i.fillStyle=a.fill||"transparent",a.fill&&a.fill!=="none"&&i.fill(),i.lineWidth=o.strokeWidth,i.strokeStyle=a.stroke||"#000000",i.stroke();const l=this.calculateLayout(i,o);this.drawDividers(i,o,l,a.stroke||"#000000"),this.renderTexts(t,o,l)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r);i.rectangle(o.x,o.y,o.width,o.height,a);const c=document.createElement("canvas").getContext("2d"),d=this.calculateLayout(c,o);this.drawSketchDividers(i,o,d,a),this.renderTexts(t,o,d)}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}calculateLayout(t,e){const s=e.containerText||"";let i=30;if(s){const a=xe(t,e,s,e.width-10);i=Math.max(30,a.textHeight+20)}const o=e.attributesText||"";let r=0;if(o){const a=xe(t,{...e,fontSize:(e.fontSize||20)*.9},o,e.width-10);r=Math.max(20,a.textHeight+10)}else e.type==="umlClass"&&(r=20);return{headerHeight:i,attrHeight:r,hasAttributes:!!o||e.type==="umlClass",hasMethods:!!e.methodsText||e.type==="umlClass"}}drawDividers(t,e,s,i){t.strokeStyle=i,t.lineWidth=1;const o=e.y+s.headerHeight;if(o<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,o),t.lineTo(e.x+e.width,o),t.stroke()),s.hasAttributes&&s.hasMethods){const r=o+s.attrHeight;r<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x+e.width,r),t.stroke())}}drawSketchDividers(t,e,s,i){const o=e.y+s.headerHeight;if(o<e.y+e.height&&t.line(e.x,o,e.x+e.width,o,i),s.hasAttributes&&s.hasMethods){const r=o+s.attrHeight;r<e.y+e.height&&t.line(e.x,r,e.x+e.width,r,i)}}renderTexts(t,e,s){const{ctx:i,isDarkMode:o}=t;if(e.containerText&&this.renderSectionText(i,e,e.containerText,e.x+e.width/2,e.y+s.headerHeight/2,e.width-10,"center",!0,o),e.attributesText){const r=e.y+s.headerHeight+10,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.attributesText,e.x+10,r,e.width-20,"left",!1,o)}if(e.methodsText){const r=e.y+s.headerHeight+s.attrHeight+10,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.methodsText,e.x+10,r,e.width-20,"left",!1,o)}}renderSectionText(t,e,s,i,o,r,a,l,c){if(!s)return;t.save(),t.font=eo({...e,fontWeight:l?"bold":e.fontWeight});const d=K.adjustColor(e.strokeColor||"#000",c);t.fillStyle=d,t.textAlign=a,t.textBaseline=a==="center"?"middle":"top";const h=xe(t,e,s,r);h.lines.forEach((p,y)=>{const m=o+y*h.lineHeight-(a==="center"?(h.lines.length-1)*h.lineHeight/2:0);t.fillText(p,i,m)}),t.restore()}}class Zp extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=o.width,c=o.height,d=o.x,h=o.y;if(i.beginPath(),o.type==="umlActor")this.drawActorPath(i,d,h,l,c);else if(o.type==="umlUseCase"||o.type==="umlInterface")i.ellipse(d+l/2,h+c/2,l/2,c/2,0,0,Math.PI*2);else if(o.type==="umlPackage")this.drawPackagePath(i,d,h,l,c);else if(o.type==="umlNote")this.drawNotePath(i,d,h,l,c);else if(o.type==="umlComponent")i.rect(d,h,l,c);else if(o.type==="umlLifeline"){const p=Math.max(30,c*.2);i.rect(d,h,l,p)}else o.type==="umlFragment"&&i.rect(d,h,l,c);if(i.fillStyle=a.fill||"transparent",a.fill&&a.fill!=="none"&&i.fill(),i.lineWidth=o.strokeWidth,i.strokeStyle=a.stroke||"#000000",i.stroke(),o.type==="umlNote"){const p=Math.min(l,c)*.15;i.beginPath(),i.moveTo(d+l-p,h),i.lineTo(d+l-p,h+p),i.lineTo(d+l,h+p),i.stroke()}if(o.type==="umlComponent"){const p=Math.min(16,l*.15),y=Math.min(10,c*.08),m=d-p/2;i.fillStyle=a.fill||"transparent",i.strokeStyle=a.stroke||"#000000",i.beginPath(),i.rect(m,h+c*.25-y/2,p,y),a.fill&&a.fill!=="none"&&i.fill(),i.stroke(),i.beginPath(),i.rect(m,h+c*.55-y/2,p,y),a.fill&&a.fill!=="none"&&i.fill(),i.stroke()}if(o.type==="umlLifeline"){const p=Math.max(30,c*.2);i.save(),i.setLineDash([8,6]),i.beginPath(),i.moveTo(d+l/2,h+p),i.lineTo(d+l/2,h+c),i.stroke(),i.restore()}if(o.type==="umlFragment"){const p=Math.min(l*.3,60),y=Math.min(c*.12,22);i.fillStyle=a.fill||"transparent",i.strokeStyle=a.stroke||"#000000",i.beginPath(),i.moveTo(d,h),i.lineTo(d+p,h),i.lineTo(d+p,h+y),i.lineTo(d+p-5,h+y+5),i.lineTo(d,h+y+5),i.closePath(),a.fill&&a.fill!=="none"&&i.fill(),i.stroke()}if(o.type==="umlLifeline"){const p=Math.max(30,c*.2),y=o.y+p/2;K.renderText(t,e,y)}else K.renderText(t,e,s)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=K.buildRenderOptions(o,r),l=o.width,c=o.height,d=o.x,h=o.y;if(o.type==="umlActor"){const p=l*.15;i.circle(d+l/2,h+p,p*2,a),i.line(d+l/2,h+p*2,d+l/2,h+c*.6,a),i.line(d,h+c*.3,d+l,h+c*.3,a),i.line(d+l/2,h+c*.6,d,h+c,a),i.line(d+l/2,h+c*.6,d+l,h+c,a)}else if(o.type==="umlUseCase"||o.type==="umlInterface")i.ellipse(d+l/2,h+c/2,l,c,a);else if(o.type==="umlPackage"){const p=c*.15,y=l*.4,m=`M ${d} ${h} L ${d+y} ${h} L ${d+y} ${h+p} L ${d+l} ${h+p} L ${d+l} ${h+c} L ${d} ${h+c} Z`;i.path(m,a),i.line(d,h+p,d+y,h+p,a)}else if(o.type==="umlNote"){const p=Math.min(l,c)*.15,y=`M ${d} ${h} L ${d+l-p} ${h} L ${d+l} ${h+p} L ${d+l} ${h+c} L ${d} ${h+c} L ${d} ${h} Z`;i.path(y,a),i.path(`M ${d+l-p} ${h} L ${d+l-p} ${h+p} L ${d+l} ${h+p}`,a)}else if(o.type==="umlComponent"){i.rectangle(d,h,l,c,a);const p=Math.min(16,l*.15),y=Math.min(10,c*.08),m=d-p/2;i.rectangle(m,h+c*.25-y/2,p,y,a),i.rectangle(m,h+c*.55-y/2,p,y,a)}else if(o.type==="umlLifeline"){const p=Math.max(30,c*.2);i.rectangle(d,h,l,p,a);const y={...a,strokeLineDash:[8,6],fill:"none"};i.line(d+l/2,h+p,d+l/2,h+c,y)}else if(o.type==="umlFragment"){i.rectangle(d,h,l,c,a);const p=Math.min(l*.3,60),y=Math.min(c*.12,22),m=`M ${d} ${h} L ${d+p} ${h} L ${d+p} ${h+y} L ${d+p-5} ${h+y+5} L ${d} ${h+y+5} Z`;i.path(m,a)}if(o.type==="umlLifeline"){const p=Math.max(30,c*.2),y=o.y+p/2;K.renderText(t,e,y)}else K.renderText(t,e,s)}definePath(t,e){e.type==="umlActor"?this.drawActorPath(t,e.x,e.y,e.width,e.height):e.type==="umlUseCase"||e.type==="umlInterface"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):e.type==="umlPackage"?this.drawPackagePath(t,e.x,e.y,e.width,e.height):e.type==="umlNote"?this.drawNotePath(t,e.x,e.y,e.width,e.height):(e.type==="umlComponent"||e.type==="umlLifeline"||e.type==="umlFragment")&&t.rect(e.x,e.y,e.width,e.height)}drawActorPath(t,e,s,i,o){const r=i*.15;t.moveTo(e+i/2+r,s+r),t.arc(e+i/2,s+r,r,0,Math.PI*2),t.moveTo(e+i/2,s+r*2),t.lineTo(e+i/2,s+o*.6),t.moveTo(e,s+o*.3),t.lineTo(e+i,s+o*.3),t.moveTo(e+i/2,s+o*.6),t.lineTo(e,s+o),t.moveTo(e+i/2,s+o*.6),t.lineTo(e+i,s+o)}drawPackagePath(t,e,s,i,o){const r=o*.15,a=i*.4;t.moveTo(e,s),t.lineTo(e+a,s),t.lineTo(e+a,s+r),t.lineTo(e+i,s+r),t.lineTo(e+i,s+o),t.lineTo(e,s+o),t.closePath()}drawNotePath(t,e,s,i,o){const r=Math.min(i,o)*.15;t.moveTo(e,s),t.lineTo(e+i-r,s),t.lineTo(e+i,s+r),t.lineTo(e+i,s+o),t.lineTo(e,s+o),t.closePath()}}class ty extends ee{renderArchitectural(t,e,s){const{ctx:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);i.beginPath(),a>0?i.roundRect(o.x,o.y,o.width,o.height,a):i.rect(o.x,o.y,o.width,o.height),i.fillStyle=l.fill||"transparent",l.fill&&l.fill!=="none"&&i.fill(),i.lineWidth=o.strokeWidth,i.strokeStyle=l.stroke||"#000000",i.stroke();const c=this.calculateLayout(i,o);this.drawDivider(i,o,c,l.stroke||"#000000",!1),this.renderTexts(t,o,c)}renderSketch(t,e,s){const{rc:i,element:o,isDarkMode:r}=t,a=this.getRadius(o),l=K.buildRenderOptions(o,r);if(a>0){const h=this.getRoundedRectPath(o.x,o.y,o.width,o.height,a);i.path(h,l)}else i.rectangle(o.x,o.y,o.width,o.height,l);const c=lu(),d=this.calculateLayout(c,o);this.drawDivider(null,o,d,l.stroke||"#000000",!0,i,l),this.renderTexts(t,o,d)}definePath(t,e){const s=this.getRadius(e);s>0?t.roundRect(e.x,e.y,e.width,e.height,s):t.rect(e.x,e.y,e.width,e.height)}getRadius(t){return Math.min(Math.abs(t.width),Math.abs(t.height))*.15}getRoundedRectPath(t,e,s,i,o){const r=Math.min(Math.abs(s)/2,o),a=Math.min(Math.abs(i)/2,o);return`M ${t+r} ${e} L ${t+s-r} ${e} Q ${t+s} ${e} ${t+s} ${e+a} L ${t+s} ${e+i-a} Q ${t+s} ${e+i} ${t+s-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}calculateLayout(t,e){const s=e.containerText||"";let i=Math.min(e.height,35);if(s){const o=xe(t,e,s,e.width-20);i=Math.max(i,o.textHeight+15)}return{headerHeight:i}}drawDivider(t,e,s,i,o,r,a){const l=e.y+s.headerHeight;l<e.y+e.height&&(o&&r?r.line(e.x,l,e.x+e.width,l,a):t&&(t.strokeStyle=i,t.lineWidth=1,t.beginPath(),t.moveTo(e.x,l),t.lineTo(e.x+e.width,l),t.stroke()))}renderTexts(t,e,s){const{ctx:i,isDarkMode:o}=t;if(e.containerText&&this.renderSectionText(i,e,e.containerText,e.x+e.width/2,e.y+s.headerHeight/2,e.width-20,"center",!0,o),e.attributesText){const r=e.y+s.headerHeight+5,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.attributesText,e.x+10,r,e.width-20,"left",!1,o)}}renderSectionText(t,e,s,i,o,r,a,l,c){if(!s)return;t.save(),t.font=eo({...e,fontWeight:l?"bold":e.fontWeight});const d=K.adjustColor(e.strokeColor||"#000",c);t.fillStyle=d,t.textAlign=a,t.textBaseline=a==="center"?"middle":"top";const h=xe(t,e,s,r);h.lines.forEach((p,y)=>{const m=o+y*h.lineHeight-(a==="center"?(h.lines.length-1)*h.lineHeight/2:0);t.fillText(p,i,m)}),t.restore()}}function ey(){console.log("Registering all shapes including specialty..."),qt.register("rectangle",new _p),qt.register("circle",new Bp),qt.register("diamond",new zp),qt.register("text",new Wp),qt.register("image",new Xp),qt.register("stickyNote",new Yp);const n=new Hp;["triangle","hexagon","octagon","parallelogram","trapezoid","rightTriangle","pentagon","septagon","polygon"].forEach(U=>qt.register(U,n));const e=new Np;["database","document","predefinedProcess","internalStorage"].forEach(U=>qt.register(U,e));const i=new Fp;["starPerson","lightbulb","signpost","burstBlob","scroll","wavyDivider","doubleBanner"].forEach(U=>qt.register(U,i));const r=new Up;["server","loadBalancer","firewall","user","messageQueue","lambda","router"].forEach(U=>qt.register(U,r));const l=new Gp;["browserWindow","mobilePhone"].forEach(U=>qt.register(U,l));const d=new qp;["organicBranch"].forEach(U=>qt.register(U,d));const p=new jp;["browser","ghostButton","inputField"].forEach(U=>qt.register(U,p));const m=new Qp;qt.register("line",m),qt.register("arrow",m),qt.register("bezier",m);const g=new Vp;["fineliner","inkbrush","marker","ink"].forEach(U=>qt.register(U,g));const x=new Jp;["cloud","heart","star","burst","callout","speechBubble","ribbon","bracketLeft","bracketRight","cross","checkmark","capsule","arrowLeft","arrowRight","arrowUp","arrowDown","dfdProcess","dfdDataStore","isometricCube","solidBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","perspectiveBlock","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].forEach(U=>qt.register(U,x));const S=new Kp;qt.register("umlClass",S);const P=new ty;qt.register("umlState",P);const R=new Zp;["umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlLifeline","umlFragment"].forEach(U=>qt.register(U,R))}const ny="1.3.0",iy={version:ny};var oy=it('<button class=floating-settings-btn title="Toggle Properties (Alt+Enter)"style="position:fixed;bottom:5px;left:230px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease">'),sy=it('<button class=floating-settings-btn title="Shortcuts &amp; Help (?)"style="position:fixed;bottom:5px;left:290px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease;font-weight:bold;font-size:20px">?'),ry=it('<div style="position:fixed;bottom:8px;left:50%;transform:translateX(-50%);font-size:11px;color:var(--text-secondary, #6b7280);pointer-events:none;user-select:none;z-index:999;opacity:0.9">v'),ay=it("<div>");const ly=de(()=>le(()=>import("./property-panel-DuLghQ5v.js"),__vite__mapDeps([16,1,2,3,17]),import.meta.url)),cy=de(()=>le(()=>import("./layer-panel-DVP54OLJ.js"),__vite__mapDeps([18,1,2,3,19]),import.meta.url)),dy=de(()=>le(()=>import("./command-palette-C89pcrZQ.js"),__vite__mapDeps([20,1,2,3,21]),import.meta.url)),hy=de(()=>le(()=>import("./state-panel-Bd_Kjd8P.js"),__vite__mapDeps([22,1,2,3,23]),import.meta.url).then(n=>({default:n.StatePanel}))),uy=de(()=>le(()=>Promise.resolve().then(()=>Uc),void 0,import.meta.url)),fy=de(()=>le(()=>import("./mindmap-action-toolbar-b_LcN_SE.js"),__vite__mapDeps([24,1,2,3,25]),import.meta.url).then(n=>({default:n.MindmapActionToolbar}))),py=de(()=>le(()=>import("./slide-navigator-CS4Qm1E2.js"),__vite__mapDeps([26,1,2,3,27]),import.meta.url).then(n=>({default:n.SlideNavigator}))),yy=de(()=>le(()=>import("./slide-control-toolbar-iF66UYSP.js"),__vite__mapDeps([28,1,2,3]),import.meta.url).then(n=>({default:n.SlideControlToolbar}))),gy=de(()=>le(()=>import("./presentation-controls-BTpdyBJg.js"),__vite__mapDeps([29,1,2,3]),import.meta.url).then(n=>({default:n.PresentationControls}))),my=()=>(rn(()=>{console.log("App: Registering shapes..."),ey(),Dp();const n=async s=>{if(wl()||bl()||Sl()||kl()||f.showExportDialog)return;if(s.key==="F5"){s.preventDefault(),Si(!0);return}if(s.key==="Escape"&&f.appMode==="presentation"){s.preventDefault(),Si(!1);return}const i=s.code,o=s.key.toLowerCase();if(s.ctrlKey||s.metaKey){if(o==="z"){s.preventDefault(),s.shiftKey?Oi():os();return}else if(o==="y"){s.preventDefault(),Oi();return}else if(o==="k"){s.preventDefault(),sl(!0);return}else if(o==="a"){s.preventDefault(),$("selection",f.elements.map(a=>a.id));return}else if(o==="o"&&s.altKey){s.preventDefault(),Ci(!0);return}else if(o==="s"&&s.altKey){s.preventDefault(),Ti("workspace");return}else if(o==="e"&&s.shiftKey){s.preventDefault(),vi(!0);return}}if(s.defaultPrevented)return;const r=s.target;if(!(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable)){if(s.altKey&&!s.ctrlKey&&!s.metaKey)if(i==="Enter"||o==="enter")s.preventDefault(),Sn();else if(i==="KeyL"||o==="l")s.preventDefault(),Bi();else if(i==="KeyM"||o==="m")s.preventDefault(),Ki();else if(i==="KeyZ"||o==="z"){s.preventDefault();const a=!f.zenMode;ws(a),bs(!a)}else if(i==="KeyI"||o==="i")s.preventDefault(),Tt("ink");else if(o==="\\"||i==="Backslash"){s.preventDefault();const a=f.showPropertyPanel||f.showLayerPanel;Sn(!a),Bi(!a)}else if(o==="["||i==="BracketLeft"){s.preventDefault();const l=f.layers.findIndex(c=>c.id===f.activeLayerId);l>0&&Lo(l,l-1)}else if(o==="]"||i==="BracketRight"){s.preventDefault();const a=f.layers,l=a.findIndex(c=>c.id===f.activeLayerId);l!==-1&&l<a.length-1&&Lo(l,l+1)}else if(o==="n"||i==="KeyN")s.preventDefault(),Go();else if(o>="1"&&o<="9"){s.preventDefault();const a=parseInt(o)-1;Od(a)}else i==="ArrowRight"?(s.preventDefault(),ds()):i==="ArrowLeft"&&(s.preventDefault(),hs());if(s.ctrlKey||s.metaKey){if(o==="g")s.preventDefault(),s.shiftKey?fs():us();else if(o==="m")s.preventDefault(),Ka();else if(o==="c"||i==="KeyC")s.preventDefault(),s.altKey?Ps():await to();else if(o==="v"||i==="KeyV")s.preventDefault(),s.altKey?$s():await Ni();else if(o==="x"||i==="KeyX")s.preventDefault(),await Ms();else if(o==="]")s.preventDefault(),f.selection.length>0&&as(f.selection);else if(o==="[")s.preventDefault(),f.selection.length>0&&ls(f.selection);else if(o==="d"){s.preventDefault();const a=f.elements.filter(l=>f.selection.includes(l.id));if(a.length>0){const l=new Map;a.forEach(h=>{h.groupIds?.forEach(p=>{l.has(p)||l.set(p,crypto.randomUUID())})});const c=20,d=a.map(h=>({...h,id:crypto.randomUUID(),x:h.x+c,y:h.y+c,groupIds:h.groupIds?.map(p=>l.get(p))}));$("elements",[...f.elements,...d]),$("selection",d.map(h=>h.id))}}return}if(!s.altKey&&!s.ctrlKey&&!s.metaKey){if(f.appMode==="presentation"){if(i==="PageDown"||i==="Enter"||i==="NumpadEnter"||i==="Space"||i==="ArrowRight"){s.preventDefault(),Ja();return}else if(i==="ArrowLeft"||i==="PageUp"||i==="Backspace"){s.preventDefault(),kd();return}}if(i==="Home"){s.preventDefault(),f.states.length>0?Ji(f.states[0].id):an(0);return}if(o==="s")s.preventDefault(),ih();else if(o==="f")s.preventDefault(),oh();else if(o==="?"&&s.shiftKey)s.preventDefault(),Fo(!0);else if(o==='"'||o==="'"&&s.shiftKey)s.preventDefault(),ms();else if(o===":"||o===";"&&s.shiftKey)s.preventDefault(),xs();else if(o==="delete"||o==="backspace")s.preventDefault(),f.selection.length>0&&Ue(f.selection);else if(["arrowup","arrowdown","arrowleft","arrowright"].includes(o)){if(f.selection.length>0){s.preventDefault();const a=s.shiftKey?10:1;let l=0,c=0;o==="arrowup"?c=-a:o==="arrowdown"?c=a:o==="arrowleft"?l=-a:o==="arrowright"&&(l=a),Va(l,c,!0)}}else o==="tab"?f.selection.length===1&&(s.preventDefault(),ss(f.selection[0])):o==="enter"?f.selection.length===1&&(s.preventDefault(),rs(f.selection[0])):o===" "?f.selection.length>0&&(s.preventDefault(),Qa()):s.shiftKey&&o==="n"?(s.preventDefault(),ol()):s.shiftKey&&o==="p"?(s.preventDefault(),Tt("laser")):o==="v"||o==="1"?Tt("selection"):o==="r"||o==="2"?Tt("rectangle"):o==="o"||o==="3"?Tt("circle"):o==="l"||o==="4"?Tt("line"):o==="a"||o==="5"?Tt("arrow"):o==="t"||o==="6"?Tt("text"):o==="e"||o==="7"?Tt("eraser"):o==="p"||o==="8"?Tt("fineliner"):o==="9"||o==="i"?window.triggerImageUpload?.():o==="b"||o==="0"?Tt("bezier"):o==="d"?Tt("diamond"):o==="h"&&Tt("pan")}}},t=()=>{!document.fullscreenElement&&f.appMode==="presentation"&&Si(!1)},e=s=>{};window.addEventListener("keydown",n,!0),window.addEventListener("beforeunload",e),document.addEventListener("fullscreenchange",t),te(()=>{window.removeEventListener("keydown",n,!0),window.removeEventListener("beforeunload",e),document.removeEventListener("fullscreenchange",t)})}),(()=>{var n=ay();return F(n,E(ir,{fallback:null,get children(){return[E(vt,{get when(){return f.appMode!=="presentation"},get children(){return[E(vt,{get when(){return f.showMainToolbar},get children(){return E(Ff,{})}}),E(vt,{get when(){return!f.zenMode},get children(){return[E(ly,{}),E(cy,{}),E(Lp,{})]}}),E(Tp,{})]}}),E(Cu,{}),E(vt,{get when(){return f.docType==="slides"},get children(){return E(vt,{get when(){return On(()=>f.appMode!=="presentation"&&!f.zenMode)()&&f.showSlideNavigator},get fallback(){return E(vt,{get when(){return f.appMode==="presentation"},get children(){return E(gy,{})}})},get children(){return E(py,{})}})}}),E(vt,{get when(){return f.appMode!=="presentation"},get children(){return[E(dy,{}),E(hy,{}),E(Vf,{})]}}),E(vt,{get when(){return f.appMode!=="presentation"},get children(){return[(()=>{var t=oy();return t.$$click=()=>Sn(),F(t,E(Oc,{size:24})),gt(()=>t.classList.toggle("active",!!f.showPropertyPanel)),t})(),(()=>{var t=sy();return t.$$click=()=>Fo(!0),t})(),E(yy,{}),E(fy,{})]}}),E(uy,{}),(()=>{var t=ry();return t.firstChild,F(t,()=>iy.version,null),t})()]}})),n})());Kt(["click"]);const xy=document.getElementById("root");_c(()=>E(my,{}),xy);export{fs as $,Hd as A,Py as B,Td as C,$d as D,Cd as E,Fe as F,uo as G,Dd as H,Rd as I,zd as J,Wd as K,_d as L,Bd as M,Ad as N,ml as O,Ay as P,Jd as Q,ol as R,Bi as S,Kd as T,Lo as U,ys as V,Ry as W,Tt as X,os as Y,Oi as Z,us as _,Z as a,as as a0,ls as a1,ms as a2,xs as a3,ws as a4,Ki as a5,ps as a6,il as a7,$ as a8,tl as a9,$u as aA,sl as aa,Za as ab,Ji as ac,Ld as ad,Ed as ae,Id as af,ed as ag,ja as ah,up as ai,an as aj,Md as ak,$y as al,Ka as am,Si as an,Qd as ao,Ly as ap,gd as aq,si as ar,kd as as,Ja as at,gr as au,Qs as av,gu as aw,mu as ax,Oy as ay,_y as az,Di as b,ky as c,nl as d,Dy as e,Wt as f,Xd as g,Io as h,Ue as i,nh as j,sh as k,ss as l,Ey as m,rs as n,ll as o,Eo as p,mn as q,My as r,f as s,Sn as t,nt as u,Pt as v,Yd as w,Cy as x,Ty as y,Iy as z};
