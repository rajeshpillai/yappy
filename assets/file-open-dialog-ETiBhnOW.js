import{t as v,h as C,i as o,x as N,m as z,r as A,ay as K,e as j,d as T}from"./vendor-rendering-CqcgmY0d.js";import{e as g,l as X,d as L,h as r,S as y,F as Y,a as q}from"./solid-framework-CtC0wtKI.js";import{az as F,g as O}from"./index-B6yUHYc0.js";import"./vendor-export-B6WwIQ1_.js";var H=v("<div class=loading>Loading..."),R=v("<div class=empty>No saved drawings found."),U=v("<div class=modal-overlay><div class=modal-content><div class=modal-header><h3>Open Drawing</h3><button class=close-btn></button></div><div class=modal-body><div class=file-list>"),V=v("<div><div style=display:flex;align-items:center;gap:8px;flex:1><span></span></div><button class=delete-file-btn title=Delete>");const W=a=>{const[h,S]=g([]),[$,_]=g(!1),[f,u]=g(null),[b,p]=g(!1);let x=0,D=0;const E=async()=>{_(!0);try{const n=(await F.listDrawings()).map(e=>{const t=e.replace(/\.(json|yappy)$/i,"");return{id:t,name:t}}).sort((e,t)=>e.name.localeCompare(t.name));S(n),n.length>0&&u(n[0].id)}catch(i){console.error(i)}finally{_(!1)}},M=async(i,n)=>{n.stopPropagation();const e=i.replace(/\.json$/i,"");if(confirm(`Are you sure you want to delete "${e}"?`))try{await F.deleteDrawing(i),E(),O(`Deleted "${e}"`,"success")}catch{O("Failed to delete file","error")}};return X(()=>{const i=e=>{if(!a.isOpen)return;const t=h();if(console.log("FileOpenDialog Key:",e.key,{files:t.length,activeId:f()}),t.length===0)return;const c=f(),d=t.findIndex(l=>l.id===c);if(e.key==="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation(),p(!0);const l=(d+1)%t.length;u(t[l].id)}else if(e.key==="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation(),p(!0);const l=(d-1+t.length)%t.length;u(t[l].id)}else e.key==="Enter"?(e.preventDefault(),e.stopImmediatePropagation(),c&&a.onSelect(c)):e.key==="Escape"&&(e.preventDefault(),e.stopImmediatePropagation(),a.onClose())},n=e=>{(Math.abs(e.clientX-x)>2||Math.abs(e.clientY-D)>2)&&p(!1),x=e.clientX,D=e.clientY};return window.addEventListener("keydown",i,!0),window.addEventListener("mousemove",n),()=>{window.removeEventListener("keydown",i,!0),window.removeEventListener("mousemove",n)}}),L(()=>{a.isOpen&&(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),window.focus(),console.log("FileOpenDialog opened. Fetching files..."),E())}),L(()=>{f()&&a.isOpen&&b()&&setTimeout(()=>{const n=document.querySelector(".file-item.active");n&&n.scrollIntoView({block:"nearest",behavior:"smooth"})},0)}),r(y,{get when(){return a.isOpen},get children(){var i=U(),n=i.firstChild,e=n.firstChild,t=e.firstChild,c=t.nextSibling,d=e.nextSibling,l=d.firstChild;return C(i,"click",a.onClose,!0),n.$$click=s=>s.stopPropagation(),C(c,"click",a.onClose,!0),o(c,r(N,{size:20})),o(d,r(y,{get when(){return $()},get children(){return H()}}),l),o(d,r(y,{get when(){return z(()=>!$())()&&h().length===0},get children(){return R()}}),l),o(l,r(Y,{get each(){return h()},children:s=>(()=>{var m=V(),w=m.firstChild,k=w.firstChild,I=w.nextSibling;return m.addEventListener("mouseenter",()=>{b()||u(s.id)}),m.$$click=()=>a.onSelect(s.id),o(w,r(A,{size:16}),k),o(k,()=>s.name),I.$$click=P=>M(s.id,P),o(I,r(K,{size:16})),q(()=>j(m,`file-item ${f()===s.id?"active":""}`)),m})()})),i}})};T(["click"]);export{W as default};
