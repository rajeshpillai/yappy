import{t as y,i as c,aH as ye,h as $e,v as be,e as M,aa as j,aC as he,a6 as me,aY as Le,x as _e,f as O,s as H,E as ke,m as z,aZ as xe,a_ as Ie,as as Ce,a$ as Ee,d as Me}from"./vendor-rendering-C7dKdzbb.js";import{h as i,e as T,S as h,a as m,F as q}from"./solid-framework-CtC0wtKI.js";import{s as a,I as ae,J as f,K as we,L as Ge,M as De,N as ze,O as te,P as Te,Q as F,R as Pe,S as Se,T as Re,U as Ae,V as Ne,W as Oe,X as Fe}from"./index-gII-9qCi.js";import"./vendor-export-B6WwIQ1_.js";const Ue=v=>{const g=()=>a.layers.find($=>$.id===v.layerId);if(!g())return null;const P=[{label:"Rename",onClick:()=>v.onRename(v.layerId),shortcut:"Enter"},{label:"Duplicate",onClick:()=>ae(v.layerId),disabled:a.layers.length>=a.maxLayers},{separator:!0},{label:g().visible?"Hide Layer":"Show Layer",onClick:()=>f(v.layerId,{visible:!g().visible}),checked:g().visible},{label:g().locked?"Unlock Layer":"Lock Layer",onClick:()=>f(v.layerId,{locked:!g().locked}),checked:g().locked},{label:"Isolate Layer",onClick:()=>we(v.layerId)},{label:"Show All Layers",onClick:()=>Ge()},{separator:!0},{label:g().isMaster?"Disable Slide Master":"Use as Slide Master",onClick:()=>f(v.layerId,{isMaster:!g().isMaster}),checked:g().isMaster},{label:"Merge Down",onClick:()=>De(v.layerId),disabled:a.layers.findIndex($=>$.id===v.layerId)===0},{label:"Flatten Layers",onClick:()=>ze(),disabled:a.layers.length<=1},{label:"Delete",onClick:()=>te(v.layerId),disabled:a.layers.length<=1,separator:!1},{separator:a.layerGroupingModeEnabled},...g()?.parentId&&a.layerGroupingModeEnabled?[{label:"Move to Top Level",onClick:()=>f(v.layerId,{parentId:void 0})}]:[],...a.layerGroupingModeEnabled?a.layers.filter($=>$.isGroup&&$.id!==v.layerId&&$.id!==g()?.parentId).map($=>({label:`Move to ${$.name}`,onClick:()=>f(v.layerId,{parentId:$.id})})):[],...g()?.isGroup&&a.layerGroupingModeEnabled?[{label:g()?.expanded?"Collapse Group":"Expand Group",onClick:()=>f(v.layerId,{expanded:!g()?.expanded})}]:[]];return i(Te,{get x(){return v.x},get y(){return v.y},items:P,get onClose(){return v.onClose}})};var Ye=y("<button class=minimize-btn title=Expand>"),Be=y('<div title="Toggle Grouping Mode"><span>Groups'),He=y('<button class=icon-button title="New Group">'),Ke=y('<button class=icon-button title="Add new layer">'),Ve=y("<button class=icon-button title=Minimize>"),Xe=y("<button class=icon-button title=Expand>"),Je=y("<input type=color style=width:24px;height:20px;padding:0;border:none;cursor:pointer>"),Qe=y('<div class=layer-properties><div class=opacity-control><span class=label>Opacity</span><input type=range min=0 max=1 step=0.1></div><div class=background-control><span class=label>Background</span><div style=display:flex;gap:8px;align-items:center><button title="Toggle transparent / color"></button></div></div><div class=color-tag-control><span class=label>Tag</span><div class=color-tag-options>'),We=y("<div>Move to Top Level"),Ze=y("<div class=layer-list>"),je=y("<div><div class=layer-panel-header><div style=display:flex;align-items:center;gap:8px><h3>Layers</h3></div><div class=header-actions><button class=icon-button title=Close>"),ee=y("<div>"),qe=y("<div class=layer-color-tag>"),ea=y('<div class=master-badge title="Slide Master (replays on every slide)">'),aa=y("<input type=text autofocus>"),ta=y('<div><span class=drag-handle title="Drag to reorder">⋮⋮</span><div class=layer-visibility></div><div class=layer-name-container><div class=layer-name></div></div><div class=layer-actions><button class=icon-button title=Duplicate>⎘</button><button class=icon-button title=Delete>×');const da=()=>{const[v,g]=T(null),[P,$]=T(""),[K,w]=T(null),[V,k]=T(null),[S,U]=T(null);let R=null;const ne=r=>{Oe(r)},re=(r,l)=>{l.stopPropagation();const o=a.layers.find(x=>x.id===r);o&&f(r,{visible:!o.visible})},le=(r,l)=>{l.stopPropagation(),a.layers.length>1&&te(r)},ie=(r,l)=>{l.stopPropagation(),ae(r)},Y=(r,l,o)=>{o.stopPropagation(),g(r),$(l)},X=r=>{const l=P().trim();l&&l!==a.layers.find(o=>o.id===r)?.name&&f(r,{name:l}),g(null),$("")},de=()=>{g(null),$("")},oe=(r,l)=>{r.key==="Enter"?(r.preventDefault(),X(l)):r.key==="Escape"&&(r.preventDefault(),de())},se=(r,l,o)=>{R=window.setTimeout(()=>{Y(r,l,o)},500)},J=()=>{R&&(clearTimeout(R),R=null)},ce=(r,l)=>{w(r),l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",r),setTimeout(()=>{l.target.style.opacity="0.5"},0)},ue=r=>{r.target.style.opacity="1",w(null),k(null)},ve=(r,l)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",k(r)},ge=()=>{k(null)},Q=(r,l)=>{l.preventDefault();const o=K();if(!o)return;if(r===null){f(o,{parentId:void 0}),w(null),k(null);return}const x=a.layers.find(u=>u.id===o),I=a.layers.find(u=>u.id===r);if(o&&o!==r&&x&&I){if(a.layerGroupingModeEnabled&&I.isGroup&&o!==r){f(o,{parentId:r}),w(null),k(null);return}const u=[...a.layers].reverse(),n=u.findIndex(s=>s.id===o),t=u.findIndex(s=>s.id===r);if(n!==-1&&t!==-1){const s=a.layers.length-1-n,p=a.layers.length-1-t;Ne(s,p),a.layerGroupingModeEnabled&&f(o,{parentId:I.parentId??void 0})}}w(null),k(null)},W=()=>{if(!a.layerGroupingModeEnabled)return{items:[...a.layers].reverse(),depths:new Map};const r=[],l=new Map,o=[...a.layers].sort((u,n)=>n.order-u.order),x=(u,n)=>{o.filter(s=>s.parentId===u).forEach(s=>{r.push(s),l.set(s.id,n),s.isGroup&&s.expanded&&x(s.id,n+1)})};return o.filter(u=>!u.parentId).forEach(u=>{r.push(u),l.set(u.id,0),u.isGroup&&u.expanded&&x(u.id,1)}),{items:r,depths:l}},pe=[{name:"None",value:void 0,color:"transparent"},{name:"Red",value:"#ff4d4d",color:"#ff4d4d"},{name:"Orange",value:"#ffab40",color:"#ffab40"},{name:"Yellow",value:"#ffd740",color:"#ffd740"},{name:"Green",value:"#69f0ae",color:"#69f0ae"},{name:"Blue",value:"#40c4ff",color:"#40c4ff"},{name:"Purple",value:"#e040fb",color:"#e040fb"}];return i(h,{get when(){return a.showLayerPanel},get children(){var r=je(),l=r.firstChild,o=l.firstChild,x=o.firstChild,I=o.nextSibling,u=I.firstChild;return l.$$dblclick=()=>F(!a.isLayerPanelMinimized),c(o,i(h,{get when(){return a.isLayerPanelMinimized},get children(){var n=Ye();return n.$$click=()=>F(!1),c(n,i(ye,{size:16})),n}}),x),c(I,i(h,{get when(){return!a.isLayerPanelMinimized},get children(){return[(()=>{var n=Be(),t=n.firstChild;return $e(n,"click",Fe,!0),c(n,i(be,{size:14}),t),m(()=>M(n,`group-mode-toggle ${a.layerGroupingModeEnabled?"active":""}`)),n})(),(()=>{var n=He();return n.$$click=()=>Pe(),c(n,i(j,{size:16})),m(()=>n.disabled=a.layers.length>=a.maxLayers),n})(),(()=>{var n=Ke();return n.$$click=()=>Se(),c(n,i(he,{size:16})),m(()=>n.disabled=a.layers.length>=a.maxLayers),n})(),(()=>{var n=Ve();return n.$$click=()=>F(!0),c(n,i(me,{size:16})),n})()]}}),u),c(I,i(h,{get when(){return a.isLayerPanelMinimized},get children(){var n=Xe();return n.$$click=()=>F(!1),c(n,i(Le,{size:16})),n}}),u),u.$$click=()=>Re(!1),c(u,i(_e,{size:16})),c(r,i(h,{get when(){return!a.isLayerPanelMinimized},get children(){return[(()=>{var n=Qe(),t=n.firstChild,s=t.firstChild,p=s.nextSibling,G=t.nextSibling,D=G.firstChild,C=D.nextSibling,L=C.firstChild,B=G.nextSibling,A=B.firstChild,N=A.nextSibling;return p.$$input=e=>{const d=parseFloat(e.currentTarget.value);f(a.activeLayerId,{opacity:d})},L.$$click=()=>{a.layers.find(d=>d.id===a.activeLayerId)?.backgroundColor==="transparent"?f(a.activeLayerId,{backgroundColor:"#ffffff"}):f(a.activeLayerId,{backgroundColor:"transparent"})},c(C,i(h,{get when(){return a.layers.find(e=>e.id===a.activeLayerId)?.backgroundColor!=="transparent"},get children(){var e=Je();return e.$$input=d=>{f(a.activeLayerId,{backgroundColor:d.currentTarget.value})},m(()=>e.value=a.layers.find(d=>d.id===a.activeLayerId)?.backgroundColor||"#ffffff"),e}}),null),c(N,i(q,{each:pe,children:e=>(()=>{var d=ee();return d.$$click=()=>f(a.activeLayerId,{colorTag:e.value}),m(b=>{var E=`color-tag-option ${e.value===void 0?"none":""} ${a.layers.find(fe=>fe.id===a.activeLayerId)?.colorTag===e.value?"active":""}`,_=e.color,Z=e.name;return E!==b.e&&M(d,b.e=E),_!==b.t&&O(d,"background-color",b.t=_),Z!==b.a&&H(d,"title",b.a=Z),b},{e:void 0,t:void 0,a:void 0}),d})()})),m(e=>{var d=`Opacity: ${Math.round((a.layers.find(_=>_.id===a.activeLayerId)?.opacity??1)*100)}%`,b=`color-swatch-mini ${a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor==="transparent"?"transparent":""}`,E=a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor==="transparent"?"white":a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor||"transparent";return d!==e.e&&H(p,"title",e.e=d),b!==e.t&&M(L,e.t=b),E!==e.a&&O(L,"background",e.a=E),e},{e:void 0,t:void 0,a:void 0}),m(()=>p.value=a.layers.find(e=>e.id===a.activeLayerId)?.opacity??1),n})(),(()=>{var n=Ze();return c(n,i(q,{get each(){return W().items},children:t=>{const s=()=>W().depths.get(t.id)||0;return(()=>{var p=ta(),G=p.firstChild,D=G.nextSibling,C=D.nextSibling,L=C.firstChild,B=C.nextSibling,A=B.firstChild,N=A.nextSibling;return p.addEventListener("drop",e=>Q(t.id,e)),p.addEventListener("dragleave",ge),p.addEventListener("dragover",e=>ve(t.id,e)),p.addEventListener("dragend",ue),p.addEventListener("dragstart",e=>ce(t.id,e)),p.$$contextmenu=e=>{e.preventDefault(),U({x:e.clientX,y:e.clientY,layerId:t.id})},p.$$click=()=>ne(t.id),H(p,"draggable",!0),c(p,i(h,{get when(){return z(()=>!!t.isGroup)()&&a.layerGroupingModeEnabled},get children(){var e=ee();return e.$$click=d=>{d.stopPropagation(),Ae(t.id)},c(e,i(ke,{size:14})),m(()=>M(e,`expander ${t.expanded?"expanded":""}`)),e}}),G),D.$$click=e=>re(t.id,e),c(D,(()=>{var e=z(()=>t.visible!==!1);return()=>e()?i(xe,{size:14}):i(Ie,{size:14})})()),c(C,i(h,{get when(){return z(()=>!!t.isGroup)()&&a.layerGroupingModeEnabled},get children(){return z(()=>!!t.expanded)()?i(Ce,{size:14}):i(j,{size:14})}}),L),c(C,i(h,{get when(){return t.colorTag},get children(){var e=qe();return m(d=>O(e,"background-color",t.colorTag)),e}}),L),c(C,i(h,{get when(){return t.isMaster},get children(){var e=ea();return c(e,i(Ee,{size:12,color:"#f59e0b",fill:"#f59e0b","fill-opacity":"0.2"})),e}}),L),L.addEventListener("pointercancel",J),L.$$pointerup=J,L.$$pointerdown=e=>se(t.id,t.name,e),L.$$dblclick=e=>Y(t.id,t.name,e),c(L,i(h,{get when(){return v()===t.id},get fallback(){return t.name},get children(){var e=aa();return e.$$click=d=>d.stopPropagation(),e.addEventListener("blur",()=>X(t.id)),e.$$keydown=d=>oe(d,t.id),e.$$input=d=>$(d.currentTarget.value),m(()=>e.value=P()),e}})),A.$$click=e=>ie(t.id,e),N.$$click=e=>le(t.id,e),m(e=>{var d=`layer-item ${t.id===a.activeLayerId?"active":""} ${V()===t.id?"drag-over":""} ${t.visible===!1?"hidden":""} ${t.locked?"locked":""} ${t.isGroup?"group":""} ${s()>0?"nested":""}`,b=a.layerGroupingModeEnabled?`${s()*24}px`:"0",E=a.layers.length<=1;return d!==e.e&&M(p,e.e=d),b!==e.t&&O(p,"padding-left",e.t=b),E!==e.a&&(N.disabled=e.a=E),e},{e:void 0,t:void 0,a:void 0}),p})()}}),null),c(n,i(h,{get when(){return z(()=>!!a.layerGroupingModeEnabled)()&&K()},get children(){var t=We();return t.addEventListener("drop",s=>Q(null,s)),t.addEventListener("dragleave",()=>k(null)),t.addEventListener("dragover",s=>{s.preventDefault(),k("root")}),m(()=>M(t,`root-drop-zone ${V()==="root"?"drag-over":""}`)),t}}),null),n})()]}}),null),c(r,i(h,{get when(){return S()},get children(){return i(Ue,{get x(){return S().x},get y(){return S().y},get layerId(){return S().layerId},onClose:()=>U(null),onRename:n=>{const t=a.layers.find(s=>s.id===n);t&&Y(n,t.name,new MouseEvent("click")),U(null)}})}}),null),m(()=>M(r,`layer-panel ${a.isLayerPanelMinimized?"minimized":""}`)),r}})};Me(["dblclick","click","input","contextmenu","pointerdown","pointerup","keydown"]);export{da as default};
