import{t as $,i as u,aF as fe,h as $e,v as be,e as w,aa as j,aA as he,a6 as me,aV as Le,x as _e,f as O,s as K,E as ke,m as z,aW as xe,aX as Ie,aq as Ce,d as Ee}from"./vendor-rendering-zBFezltB.js";import{h as d,e as T,S as m,a as h,F as Z}from"./solid-framework-CtC0wtKI.js";import{s as a,F as ae,G as f,H as we,I as Me,J as Ge,K as De,L as te,M as ze,N as F,O as Te,P as Pe,Q as Se,R as Ae,S as Re,T as Ne,U as Oe}from"./index-BgBzBPE6.js";import"./vendor-export-B6WwIQ1_.js";const Fe=v=>{const p=()=>a.layers.find(y=>y.id===v.layerId);if(!p())return null;const P=[{label:"Rename",onClick:()=>v.onRename(v.layerId),shortcut:"Enter"},{label:"Duplicate",onClick:()=>ae(v.layerId),disabled:a.layers.length>=a.maxLayers},{separator:!0},{label:p().visible?"Hide Layer":"Show Layer",onClick:()=>f(v.layerId,{visible:!p().visible}),checked:p().visible},{label:p().locked?"Unlock Layer":"Lock Layer",onClick:()=>f(v.layerId,{locked:!p().locked}),checked:p().locked},{label:"Isolate Layer",onClick:()=>we(v.layerId)},{label:"Show All Layers",onClick:()=>Me()},{separator:!0},{label:"Merge Down",onClick:()=>Ge(v.layerId),disabled:a.layers.findIndex(y=>y.id===v.layerId)===0},{label:"Flatten Layers",onClick:()=>De(),disabled:a.layers.length<=1},{label:"Delete",onClick:()=>te(v.layerId),disabled:a.layers.length<=1,separator:!1},{separator:a.layerGroupingModeEnabled},...p()?.parentId&&a.layerGroupingModeEnabled?[{label:"Move to Top Level",onClick:()=>f(v.layerId,{parentId:void 0})}]:[],...a.layerGroupingModeEnabled?a.layers.filter(y=>y.isGroup&&y.id!==v.layerId&&y.id!==p()?.parentId).map(y=>({label:`Move to ${y.name}`,onClick:()=>f(v.layerId,{parentId:y.id})})):[],...p()?.isGroup&&a.layerGroupingModeEnabled?[{label:p()?.expanded?"Collapse Group":"Expand Group",onClick:()=>f(v.layerId,{expanded:!p()?.expanded})}]:[]];return d(ze,{get x(){return v.x},get y(){return v.y},items:P,get onClose(){return v.onClose}})};var Ue=$("<button class=minimize-btn title=Expand>"),Be=$('<div title="Toggle Grouping Mode"><span>Groups'),He=$('<button class=icon-button title="New Group">'),Ke=$('<button class=icon-button title="Add new layer">'),Ve=$("<button class=icon-button title=Minimize>"),Xe=$("<button class=icon-button title=Expand>"),Ye=$("<input type=color style=width:24px;height:20px;padding:0;border:none;cursor:pointer>"),qe=$('<div class=layer-properties><div class=opacity-control><span class=label>Opacity</span><input type=range min=0 max=1 step=0.1></div><div class=background-control><span class=label>Background</span><div style=display:flex;gap:8px;align-items:center><button title="Toggle transparent / color"></button></div></div><div class=color-tag-control><span class=label>Tag</span><div class=color-tag-options>'),Je=$("<div>Move to Top Level"),Qe=$("<div class=layer-list>"),We=$("<div><div class=layer-panel-header><div style=display:flex;align-items:center;gap:8px><h3>Layers</h3></div><div class=header-actions><button class=icon-button title=Close>"),ee=$("<div>"),je=$("<div class=layer-color-tag>"),Ze=$("<input type=text autofocus>"),ea=$('<div><span class=drag-handle title="Drag to reorder">⋮⋮</span><div class=layer-visibility></div><div class=layer-name-container><div class=layer-name></div></div><div class=layer-actions><button class=icon-button title=Duplicate>⎘</button><button class=icon-button title=Delete>×');const la=()=>{const[v,p]=T(null),[P,y]=T(""),[V,M]=T(null),[X,k]=T(null),[S,U]=T(null);let A=null;const ne=r=>{Ne(r)},re=(r,l)=>{l.stopPropagation();const o=a.layers.find(x=>x.id===r);o&&f(r,{visible:!o.visible})},le=(r,l)=>{l.stopPropagation(),a.layers.length>1&&te(r)},ie=(r,l)=>{l.stopPropagation(),ae(r)},B=(r,l,o)=>{o.stopPropagation(),p(r),y(l)},Y=r=>{const l=P().trim();l&&l!==a.layers.find(o=>o.id===r)?.name&&f(r,{name:l}),p(null),y("")},de=()=>{p(null),y("")},oe=(r,l)=>{r.key==="Enter"?(r.preventDefault(),Y(l)):r.key==="Escape"&&(r.preventDefault(),de())},se=(r,l,o)=>{A=window.setTimeout(()=>{B(r,l,o)},500)},q=()=>{A&&(clearTimeout(A),A=null)},ce=(r,l)=>{M(r),l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",r),setTimeout(()=>{l.target.style.opacity="0.5"},0)},ue=r=>{r.target.style.opacity="1",M(null),k(null)},ve=(r,l)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",k(r)},ge=()=>{k(null)},J=(r,l)=>{l.preventDefault();const o=V();if(!o)return;if(r===null){f(o,{parentId:void 0}),M(null),k(null);return}const x=a.layers.find(c=>c.id===o),I=a.layers.find(c=>c.id===r);if(o&&o!==r&&x&&I){if(a.layerGroupingModeEnabled&&I.isGroup&&o!==r){f(o,{parentId:r}),M(null),k(null);return}const c=[...a.layers].reverse(),n=c.findIndex(s=>s.id===o),t=c.findIndex(s=>s.id===r);if(n!==-1&&t!==-1){const s=a.layers.length-1-n,g=a.layers.length-1-t;Re(s,g),a.layerGroupingModeEnabled&&f(o,{parentId:I.parentId??void 0})}}M(null),k(null)},Q=()=>{if(!a.layerGroupingModeEnabled)return{items:[...a.layers].reverse(),depths:new Map};const r=[],l=new Map,o=[...a.layers].sort((c,n)=>n.order-c.order),x=(c,n)=>{o.filter(s=>s.parentId===c).forEach(s=>{r.push(s),l.set(s.id,n),s.isGroup&&s.expanded&&x(s.id,n+1)})};return o.filter(c=>!c.parentId).forEach(c=>{r.push(c),l.set(c.id,0),c.isGroup&&c.expanded&&x(c.id,1)}),{items:r,depths:l}},pe=[{name:"None",value:void 0,color:"transparent"},{name:"Red",value:"#ff4d4d",color:"#ff4d4d"},{name:"Orange",value:"#ffab40",color:"#ffab40"},{name:"Yellow",value:"#ffd740",color:"#ffd740"},{name:"Green",value:"#69f0ae",color:"#69f0ae"},{name:"Blue",value:"#40c4ff",color:"#40c4ff"},{name:"Purple",value:"#e040fb",color:"#e040fb"}];return d(m,{get when(){return a.showLayerPanel},get children(){var r=We(),l=r.firstChild,o=l.firstChild,x=o.firstChild,I=o.nextSibling,c=I.firstChild;return l.$$dblclick=()=>F(!a.isLayerPanelMinimized),u(o,d(m,{get when(){return a.isLayerPanelMinimized},get children(){var n=Ue();return n.$$click=()=>F(!1),u(n,d(fe,{size:16})),n}}),x),u(I,d(m,{get when(){return!a.isLayerPanelMinimized},get children(){return[(()=>{var n=Be(),t=n.firstChild;return $e(n,"click",Oe,!0),u(n,d(be,{size:14}),t),h(()=>w(n,`group-mode-toggle ${a.layerGroupingModeEnabled?"active":""}`)),n})(),(()=>{var n=He();return n.$$click=()=>Te(),u(n,d(j,{size:16})),h(()=>n.disabled=a.layers.length>=a.maxLayers),n})(),(()=>{var n=Ke();return n.$$click=()=>Pe(),u(n,d(he,{size:16})),h(()=>n.disabled=a.layers.length>=a.maxLayers),n})(),(()=>{var n=Ve();return n.$$click=()=>F(!0),u(n,d(me,{size:16})),n})()]}}),c),u(I,d(m,{get when(){return a.isLayerPanelMinimized},get children(){var n=Xe();return n.$$click=()=>F(!1),u(n,d(Le,{size:16})),n}}),c),c.$$click=()=>Se(!1),u(c,d(_e,{size:16})),u(r,d(m,{get when(){return!a.isLayerPanelMinimized},get children(){return[(()=>{var n=qe(),t=n.firstChild,s=t.firstChild,g=s.nextSibling,G=t.nextSibling,D=G.firstChild,E=D.nextSibling,L=E.firstChild,H=G.nextSibling,R=H.firstChild,N=R.nextSibling;return g.$$input=e=>{const i=parseFloat(e.currentTarget.value);f(a.activeLayerId,{opacity:i})},L.$$click=()=>{a.layers.find(i=>i.id===a.activeLayerId)?.backgroundColor==="transparent"?f(a.activeLayerId,{backgroundColor:"#ffffff"}):f(a.activeLayerId,{backgroundColor:"transparent"})},u(E,d(m,{get when(){return a.layers.find(e=>e.id===a.activeLayerId)?.backgroundColor!=="transparent"},get children(){var e=Ye();return e.$$input=i=>{f(a.activeLayerId,{backgroundColor:i.currentTarget.value})},h(()=>e.value=a.layers.find(i=>i.id===a.activeLayerId)?.backgroundColor||"#ffffff"),e}}),null),u(N,d(Z,{each:pe,children:e=>(()=>{var i=ee();return i.$$click=()=>f(a.activeLayerId,{colorTag:e.value}),h(b=>{var C=`color-tag-option ${e.value===void 0?"none":""} ${a.layers.find(ye=>ye.id===a.activeLayerId)?.colorTag===e.value?"active":""}`,_=e.color,W=e.name;return C!==b.e&&w(i,b.e=C),_!==b.t&&O(i,"background-color",b.t=_),W!==b.a&&K(i,"title",b.a=W),b},{e:void 0,t:void 0,a:void 0}),i})()})),h(e=>{var i=`Opacity: ${Math.round((a.layers.find(_=>_.id===a.activeLayerId)?.opacity??1)*100)}%`,b=`color-swatch-mini ${a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor==="transparent"?"transparent":""}`,C=a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor==="transparent"?"white":a.layers.find(_=>_.id===a.activeLayerId)?.backgroundColor||"transparent";return i!==e.e&&K(g,"title",e.e=i),b!==e.t&&w(L,e.t=b),C!==e.a&&O(L,"background",e.a=C),e},{e:void 0,t:void 0,a:void 0}),h(()=>g.value=a.layers.find(e=>e.id===a.activeLayerId)?.opacity??1),n})(),(()=>{var n=Qe();return u(n,d(Z,{get each(){return Q().items},children:t=>{const s=()=>Q().depths.get(t.id)||0;return(()=>{var g=ea(),G=g.firstChild,D=G.nextSibling,E=D.nextSibling,L=E.firstChild,H=E.nextSibling,R=H.firstChild,N=R.nextSibling;return g.addEventListener("drop",e=>J(t.id,e)),g.addEventListener("dragleave",ge),g.addEventListener("dragover",e=>ve(t.id,e)),g.addEventListener("dragend",ue),g.addEventListener("dragstart",e=>ce(t.id,e)),g.$$contextmenu=e=>{e.preventDefault(),U({x:e.clientX,y:e.clientY,layerId:t.id})},g.$$click=()=>ne(t.id),K(g,"draggable",!0),u(g,d(m,{get when(){return z(()=>!!t.isGroup)()&&a.layerGroupingModeEnabled},get children(){var e=ee();return e.$$click=i=>{i.stopPropagation(),Ae(t.id)},u(e,d(ke,{size:14})),h(()=>w(e,`expander ${t.expanded?"expanded":""}`)),e}}),G),D.$$click=e=>re(t.id,e),u(D,(()=>{var e=z(()=>t.visible!==!1);return()=>e()?d(xe,{size:14}):d(Ie,{size:14})})()),u(E,d(m,{get when(){return z(()=>!!t.isGroup)()&&a.layerGroupingModeEnabled},get children(){return z(()=>!!t.expanded)()?d(Ce,{size:14}):d(j,{size:14})}}),L),u(E,d(m,{get when(){return t.colorTag},get children(){var e=je();return h(i=>O(e,"background-color",t.colorTag)),e}}),L),L.addEventListener("pointercancel",q),L.$$pointerup=q,L.$$pointerdown=e=>se(t.id,t.name,e),L.$$dblclick=e=>B(t.id,t.name,e),u(L,d(m,{get when(){return v()===t.id},get fallback(){return t.name},get children(){var e=Ze();return e.$$click=i=>i.stopPropagation(),e.addEventListener("blur",()=>Y(t.id)),e.$$keydown=i=>oe(i,t.id),e.$$input=i=>y(i.currentTarget.value),h(()=>e.value=P()),e}})),R.$$click=e=>ie(t.id,e),N.$$click=e=>le(t.id,e),h(e=>{var i=`layer-item ${t.id===a.activeLayerId?"active":""} ${X()===t.id?"drag-over":""} ${t.visible===!1?"hidden":""} ${t.locked?"locked":""} ${t.isGroup?"group":""} ${s()>0?"nested":""}`,b=a.layerGroupingModeEnabled?`${s()*24}px`:"0",C=a.layers.length<=1;return i!==e.e&&w(g,e.e=i),b!==e.t&&O(g,"padding-left",e.t=b),C!==e.a&&(N.disabled=e.a=C),e},{e:void 0,t:void 0,a:void 0}),g})()}}),null),u(n,d(m,{get when(){return z(()=>!!a.layerGroupingModeEnabled)()&&V()},get children(){var t=Je();return t.addEventListener("drop",s=>J(null,s)),t.addEventListener("dragleave",()=>k(null)),t.addEventListener("dragover",s=>{s.preventDefault(),k("root")}),h(()=>w(t,`root-drop-zone ${X()==="root"?"drag-over":""}`)),t}}),null),n})()]}}),null),u(r,d(m,{get when(){return S()},get children(){return d(Fe,{get x(){return S().x},get y(){return S().y},get layerId(){return S().layerId},onClose:()=>U(null),onRename:n=>{const t=a.layers.find(s=>s.id===n);t&&B(n,t.name,new MouseEvent("click")),U(null)}})}}),null),h(()=>w(r,`layer-panel ${a.isLayerPanelMinimized?"minimized":""}`)),r}})};Ee(["dblclick","click","input","contextmenu","pointerdown","pointerup","keydown"]);export{la as default};
