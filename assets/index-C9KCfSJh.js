const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./morph-animator-D09lTtCE.js","./vendor-rendering-C7dKdzbb.js","./solid-framework-CtC0wtKI.js","./vendor-export-B6WwIQ1_.js","./help-dialog-RKXQf_uS.js","./help-dialog-BuEFoCdI.css","./load-export-dialog-Dy3tZQ_g.js","./load-export-dialog-BI080PEg.css","./file-open-dialog-C6-i59Nf.js","./file-open-dialog-fDkqaZuJ.css","./export-dialog-DD17ug_C.js","./export-dialog-B7S2OIzO.css","./save-dialog-COQM97_z.js","./save-dialog-DKlfwlwa.css","./template-browser-Dp0RcBa7.js","./template-browser-wA56mJ0X.css","./property-panel-D_ZvAIX5.js","./property-panel-BMe2r3Df.css","./layer-panel-BM0fLs6i.js","./layer-panel-C0mSt2Wp.css","./command-palette-Bi4vILsj.js","./command-palette-CVDazVxS.css","./state-panel-B-m4OUb-.js","./state-panel-Clr9NUEJ.css","./mindmap-action-toolbar-CWW-KLaF.js","./mindmap-action-toolbar-CAFnKVn8.css","./slide-navigator-R4fnrQDB.js","./slide-navigator-DzoiUQ2M.css","./slide-control-toolbar-B6T-rlHI.js","./presentation-controls-lstETJ7z.js"])))=>i.map(i=>d[i]);
import{d as ne,t as nt,i as Y,c as Re,a as Nl,b as Fl,x as is,e as Nt,s as mt,m as Cn,f as Yt,u as Wt,g as Nn,h as Se,j as Ji,k as Ye,P as He,p as Ul,l as Gl,n as Ne,o as os,q as ar,r as ql,v as ss,w as jl,y as Ql,z as Vl,A as Jl,B as rs,C as Kl,D as lr,E as cr,F as Zl,G as tc,H as ec,I as nc,J as dr,K as ic,L as oc,M as sc,N as rc,O as ac,Q as hr,R as lc,S as cc,T as dc,U as ur,V as hc,W as uc,X as fc,Y as pc,Z as yc,_ as gc,$ as mc,a0 as xc,a1 as wc,a2 as bc,a3 as vc,a4 as as,a5 as fr,a6 as ls,a7 as Sc,a8 as bn,a9 as kc,aa as Mc,ab as Pc,ac as $c,ad as Cc,ae as Tc,af as Ic,ag as Lc,ah as Ec,ai as Rc,aj as Ac,ak as Dc,al as Oc,am as _c,an as zc,ao as Bc,ap as Wc,aq as go,ar as Xc,as as Yc,at as Hc,au as Nc,av as Fc,aw as zs,ax as Uc,ay as Gc,az as qc,aA as jc,aB as Qc,aC as Vc,aD as Jc,aE as Kc,aF as Zc,aG as td}from"./vendor-rendering-C7dKdzbb.js";import{_ as he,E as Bs,P as ed}from"./vendor-export-B6WwIQ1_.js";import{$ as dn,i as Je,j as Ws,k as Oo,e as kt,h as I,S as St,a as pt,l as hn,F as ze,o as oe,d as Vt,b as mo,u as pi,n as fe,p as pr}from"./solid-framework-CtC0wtKI.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const _o=Symbol("store-raw"),Pn=Symbol("store-node"),_e=Symbol("store-has"),yr=Symbol("store-self");function gr(n){let t=n[dn];if(!t&&(Object.defineProperty(n,dn,{value:t=new Proxy(n,od)}),!Array.isArray(n))){const e=Object.keys(n),o=Object.getOwnPropertyDescriptors(n);for(let i=0,s=e.length;i<s;i++){const r=e[i];o[r].get&&Object.defineProperty(n,r,{enumerable:o[r].enumerable,get:o[r].get.bind(t)})}}return t}function Bi(n){let t;return n!=null&&typeof n=="object"&&(n[dn]||!(t=Object.getPrototypeOf(n))||t===Object.prototype||Array.isArray(n))}function Fn(n,t=new Set){let e,o,i,s;if(e=n!=null&&n[_o])return e;if(!Bi(n)||t.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):t.add(n);for(let r=0,a=n.length;r<a;r++)i=n[r],(o=Fn(i,t))!==i&&(n[r]=o)}else{Object.isFrozen(n)?n=Object.assign({},n):t.add(n);const r=Object.keys(n),a=Object.getOwnPropertyDescriptors(n);for(let c=0,l=r.length;c<l;c++)s=r[c],!a[s].get&&(i=n[s],(o=Fn(i,t))!==i&&(n[s]=o))}return n}function Wi(n,t){let e=n[t];return e||Object.defineProperty(n,t,{value:e=Object.create(null)}),e}function Un(n,t,e){if(n[t])return n[t];const[o,i]=kt(e,{equals:!1,internal:!0});return o.$=i,n[t]=o}function nd(n,t){const e=Reflect.getOwnPropertyDescriptor(n,t);return!e||e.get||!e.configurable||t===dn||t===Pn||(delete e.value,delete e.writable,e.get=()=>n[dn][t]),e}function mr(n){Oo()&&Un(Wi(n,Pn),yr)()}function id(n){return mr(n),Reflect.ownKeys(n)}const od={get(n,t,e){if(t===_o)return n;if(t===dn)return e;if(t===Ws)return mr(n),e;const o=Wi(n,Pn),i=o[t];let s=i?i():n[t];if(t===Pn||t===_e||t==="__proto__")return s;if(!i){const r=Object.getOwnPropertyDescriptor(n,t);Oo()&&(typeof s!="function"||n.hasOwnProperty(t))&&!(r&&r.get)&&(s=Un(o,t,s)())}return Bi(s)?gr(s):s},has(n,t){return t===_o||t===dn||t===Ws||t===Pn||t===_e||t==="__proto__"?!0:(Oo()&&Un(Wi(n,_e),t)(),t in n)},set(){return!0},deleteProperty(){return!0},ownKeys:id,getOwnPropertyDescriptor:nd};function Xi(n,t,e,o=!1){if(!o&&n[t]===e)return;const i=n[t],s=n.length;e===void 0?(delete n[t],n[_e]&&n[_e][t]&&i!==void 0&&n[_e][t].$()):(n[t]=e,n[_e]&&n[_e][t]&&i===void 0&&n[_e][t].$());let r=Wi(n,Pn),a;if((a=Un(r,t,i))&&a.$(()=>e),Array.isArray(n)&&n.length!==s){for(let c=n.length;c<s;c++)(a=r[c])&&a.$();(a=Un(r,"length",s))&&a.$(n.length)}(a=r[yr])&&a.$()}function xr(n,t){const e=Object.keys(t);for(let o=0;o<e.length;o+=1){const i=e[o];Xi(n,i,t[i])}}function sd(n,t){if(typeof t=="function"&&(t=t(n)),t=Fn(t),Array.isArray(t)){if(n===t)return;let e=0,o=t.length;for(;e<o;e++){const i=t[e];n[e]!==i&&Xi(n,e,i)}Xi(n,"length",o)}else xr(n,t)}function Wn(n,t,e=[]){let o,i=n;if(t.length>1){o=t.shift();const r=typeof o,a=Array.isArray(n);if(Array.isArray(o)){for(let c=0;c<o.length;c++)Wn(n,[o[c]].concat(t),e);return}else if(a&&r==="function"){for(let c=0;c<n.length;c++)o(n[c],c)&&Wn(n,[c].concat(t),e);return}else if(a&&r==="object"){const{from:c=0,to:l=n.length-1,by:d=1}=o;for(let h=c;h<=l;h+=d)Wn(n,[h].concat(t),e);return}else if(t.length>1){Wn(n[o],t,[o].concat(e));return}i=n[o],e=[o].concat(e)}let s=t[0];typeof s=="function"&&(s=s(i,e),s===i)||o===void 0&&s==null||(s=Fn(s),o===void 0||Bi(i)&&Bi(s)&&!Array.isArray(s)?xr(i,s):Xi(n,o,s))}function rd(...[n,t]){const e=Fn(n||{}),o=Array.isArray(e),i=gr(e);function s(...r){Je(()=>{o&&r.length===1?sd(e,r[0]):Wn(e,r)})}return[i,s]}const Gn={type:"none",duration:500,easing:"easeInOutQuad"},cs=(n,t,e=0,o=0)=>({id:crypto.randomUUID(),name:t||"Slide 1",spatialPosition:{x:e,y:o},dimensions:{width:1920,height:1080},backgroundColor:"#ffffff",order:0,transition:{...Gn}}),wr=(n,t="slides")=>({version:4,metadata:{name:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),docType:t},elements:[],layers:[{id:"default-layer",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent"}],slides:[cs()],globalSettings:{},gridSettings:{enabled:!1,snapToGrid:!1,objectSnapping:!0,gridSize:20,gridColor:"#cccccc",gridOpacity:.5,style:"lines"}});var ad=nt("<div><div class=toast-icon></div><div class=toast-message></div><button class=toast-close>");const[mn,zo]=kt({message:"",type:"info",visible:!1});let Yn;const Bt=(n,t="info",e=3e3)=>{zo({message:n,type:t,visible:!0}),Yn&&clearTimeout(Yn),Yn=window.setTimeout(()=>{zo(o=>({...o,visible:!1}))},e)},br=()=>{zo(n=>({...n,visible:!1})),Yn&&clearTimeout(Yn)},ld=()=>I(St,{get when(){return mn().visible},get children(){var n=ad(),t=n.firstChild,e=t.nextSibling,o=e.nextSibling;return Y(t,I(St,{get when(){return mn().type==="success"},get children(){return I(Re,{size:18})}}),null),Y(t,I(St,{get when(){return mn().type==="error"},get children(){return I(Nl,{size:18})}}),null),Y(t,I(St,{get when(){return mn().type==="info"},get children(){return I(Fl,{size:18})}}),null),Y(e,()=>mn().message),o.$$click=br,Y(o,I(is,{size:14})),pt(()=>Nt(n,`toast toast-${mn().type}`)),n}});ne(["click"]);const cd=Object.freeze(Object.defineProperty({__proto__:null,default:ld,hideToast:br,showToast:Bt},Symbol.toStringTag,{value:"Module"})),Xs=["#e03131","#1971c2","#2f9e44","#f08c00","#9c36b5","#0b7285","#748ffc","#f76707","#099268"];class vr{hSpacing=100;vSpacing=40;buildTree(t,e){const o=e.find(r=>r.id===t);if(!o)return null;const i={id:o.id,element:o,children:[],width:o.width,height:o.height,x:o.x,y:o.y},s=e.filter(r=>r.parentId===t);for(const r of s){const a=this.buildTree(r.id,e);a&&i.children.push(a)}return i}layoutHorizontal(t,e="right"){this.calculateSubtreeHeights(t),this.assignHorizontalPositions(t,t.x,t.y,e)}layoutVertical(t,e="down"){this.calculateSubtreeWidths(t),this.assignVerticalPositions(t,t.x,t.y,e)}calculateSubtreeHeights(t){if(t.children.length===0)return t.totalHeight=t.height,t.totalHeight;const e=t.children.reduce((i,s)=>i+this.calculateSubtreeHeights(s),0),o=(t.children.length-1)*this.vSpacing;return t.totalHeight=Math.max(t.height,e+o),t.totalHeight}assignHorizontalPositions(t,e,o,i){if(t.x=e,t.y=o,t.children.length===0)return;const s=i==="right"?e+t.width+this.hSpacing:e-this.hSpacing;let r=o-t.totalHeight/2+t.children[0].totalHeight/2;const a=t.children.reduce((c,l)=>c+l.totalHeight,0)+(t.children.length-1)*this.vSpacing;r=o+t.height/2-a/2;for(const c of t.children){const l=i==="right"?s:s-c.width,d=r+c.totalHeight/2-c.height/2;this.assignHorizontalPositions(c,l,d,i),r+=c.totalHeight+this.vSpacing}}calculateSubtreeWidths(t){if(t.children.length===0)return t.totalWidth=t.width,t.totalWidth;const e=t.children.reduce((i,s)=>i+this.calculateSubtreeWidths(s),0),o=(t.children.length-1)*this.hSpacing;return t.totalWidth=Math.max(t.width,e+o),t.totalWidth}assignVerticalPositions(t,e,o,i){if(t.x=e,t.y=o,t.children.length===0)return;const s=i==="down"?o+t.height+this.vSpacing:o-this.vSpacing,r=t.children.reduce((c,l)=>c+l.totalWidth,0)+(t.children.length-1)*this.hSpacing;let a=e+t.width/2-r/2;for(const c of t.children){const l=i==="down"?s:s-c.height,d=a+c.totalWidth/2-c.width/2;this.assignVerticalPositions(c,d,l,i),a+=c.totalWidth+this.hSpacing}}layoutRadial(t){this.assignRadialPositions(t,t.x,t.y,0,Math.PI*2,250)}assignRadialPositions(t,e,o,i,s,r){if(t.x=e,t.y=o,t.children.length===0)return;const a=e+t.width/2,c=o+t.height/2,d=(s-i)/t.children.length;for(let h=0;h<t.children.length;h++){const u=t.children[h],y=i+(h+.5)*d,m=a+Math.cos(y)*(r+t.width/2),g=c+Math.sin(y)*(r+t.height/2),w=m-u.width/2,x=g-u.height/2,b=Math.min(Math.PI/2,d*.9);this.assignRadialPositions(u,w,x,y-b/2,y+b/2,r*.8)}}applySemanticStyling(t,e){t.styleUpdates={},t.children.forEach((o,i)=>{const s=Xs[i%Xs.length];this.styleSubtree(o,s,1,e)})}styleSubtree(t,e,o,i){const s=Math.max(1,4-o*.5),r=Math.max(40,100-o*10);t.styleUpdates={strokeColor:e,strokeWidth:s,opacity:r},i.find(a=>(a.type==="arrow"||a.type==="line"||a.type==="bezier")&&a.endBinding?.elementId===t.id);for(const a of t.children)this.styleSubtree(a,e,o+1,i)}getUpdates(t,e,o=new Map){const i={x:t.x,y:t.y,...t.styleUpdates};o.set(t.id,i);const s=e.find(r=>(r.type==="arrow"||r.type==="line"||r.type==="bezier")&&r.endBinding?.elementId===t.id);s&&t.styleUpdates&&o.set(s.id,{strokeColor:t.styleUpdates.strokeColor,strokeWidth:t.styleUpdates.strokeWidth,opacity:t.styleUpdates.opacity});for(const r of t.children)this.getUpdates(r,e,o);return o}}function Sr(n=170,t=26,e=1,o=0){return i=>{if(i===0||i===1)return i;const r=i*1,a=Math.max(e,.01),c=Math.max(n,.01),l=Math.sqrt(c/a),d=t/(2*Math.sqrt(c*a)),h=-1,u=o;let y;const m=.001;if(d<1-m){const g=l*Math.sqrt(1-d*d),w=Math.exp(-d*l*r),x=h,b=(u+d*l*h)/g;y=1+w*(x*Math.cos(g*r)+b*Math.sin(g*r))}else if(d>1+m){const g=-l*(d+Math.sqrt(d*d-1)),w=-l*(d-Math.sqrt(d*d-1)),x=(u-w*h)/(g-w),b=h-x;y=1+x*Math.exp(g*r)+b*Math.exp(w*r)}else y=1+Math.exp(-l*r)*(h+(u+l*h)*r);return y}}const an={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,10*(2*n-1))/2:(2-Math.pow(2,-10*(2*n-1)))/2,easeOutBounce:n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,easeInBounce:n=>1-an.easeOutBounce(1-n),easeInOutBounce:n=>n<.5?(1-an.easeOutBounce(1-2*n))/2:(1+an.easeOutBounce(2*n-1))/2,easeOutElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*t)+1},easeInElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*t)},easeOutBack:n=>1+2.70158*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),easeInBack:n=>2.70158*n*n*n-1.70158*n*n,easeSpring:Sr(170,26,1,0)};function Bo(n){return n?typeof n=="function"?n:an[n]??an.linear:an.linear}function be(n,t,e){return isNaN(n)?t:isNaN(t)?n:n+(t-n)*e}function dd(n,t,e){if(!n)return t||"#000000";if(!t)return n;const o=y=>{const m=y.replace("#","");return m.length<6?[0,0,0]:[parseInt(m.substring(0,2),16)||0,parseInt(m.substring(2,4),16)||0,parseInt(m.substring(4,6),16)||0]},[i,s,r]=o(n),[a,c,l]=o(t),d=Math.round(be(i,a,e)),h=Math.round(be(s,c,e)),u=Math.round(be(r,l,e));return`#${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`}const[hd,ud]=kt(0),[xo,fd]=kt(0),[Yy,Ys]=kt(!1),[nn,wo]=kt(!1),[Ee,bo]=kt(!1);class pd{animations=new Map;rafId=null;isRunning=!1;forceTicker=!1;lastTickTime=0;setForceTicker(t){this.forceTicker=t,t&&this.ensureLoopRunning()}create(t,e,o){const i={id:t,state:"idle",startTime:0,pauseTime:null,duration:o.duration??0,delay:o.delay??0,easing:Bo(o.easing),onUpdate:e,onComplete:o.onComplete,onStart:o.onStart,loop:o.loop??!1,loopCount:o.loopCount??1/0,currentLoop:0,alternate:o.alternate??!1,direction:1};return this.animations.set(t,i),t}start(t){const e=this.animations.get(t);if(e){if(e.state==="paused"&&e.pauseTime!==null){const o=e.pauseTime-e.startTime;e.startTime=performance.now()-o,e.pauseTime=null}else e.startTime=performance.now(),e.currentLoop=0,e.direction=1;e.state="running",e.onStart?.(),this.ensureLoopRunning()}}pause(t){const e=this.animations.get(t);!e||e.state!=="running"||(e.state="paused",e.pauseTime=performance.now())}stop(t){const e=this.animations.get(t);e&&(e.state="completed",this.animations.delete(t),this.animations.size===0&&!this.forceTicker&&this.stopLoop())}reset(t){const e=this.animations.get(t);e&&(e.state="idle",e.startTime=0,e.pauseTime=null,e.currentLoop=0,e.direction=1,e.onUpdate(0))}getState(t){return this.animations.get(t)?.state??null}has(t){return this.animations.has(t)}stopAll(){this.animations.clear(),wo(!1),bo(!1),this.stopLoop()}pauseAll(){for(const t of this.animations.values())t.state==="running"&&(t.state="paused",t.pauseTime=performance.now())}resumeAll(){const t=performance.now();for(const e of this.animations.values())if(e.state==="paused"&&e.pauseTime!==null){const o=e.pauseTime-e.startTime;e.startTime=t-o,e.pauseTime=null,e.state="running"}this.ensureLoopRunning()}tick=t=>{if(!this.isRunning){this.lastTickTime=0;return}this.lastTickTime===0&&(this.lastTickTime=t);const e=t-this.lastTickTime;this.lastTickTime=t;const o=p.globalSettings?.animationEnabled??!0;let i=!1;Je(()=>{ud(t),Ee()||fd(r=>r+e);for(const r of this.animations.values()){if(r.state!=="running")continue;if(i=!0,!o){r.onUpdate(1),r.state="completed",r.onComplete?.(),this.animations.delete(r.id);continue}const a=t-r.startTime-r.delay;if(a<0)continue;let c=Math.min(a/r.duration,1);r.direction===-1&&(c=1-c);const l=r.easing(c);r.onUpdate(l),a>=r.duration&&(r.loop&&r.currentLoop<r.loopCount-1?(r.currentLoop++,r.startTime=t,r.alternate&&(r.direction=r.direction===1?-1:1)):(r.state="completed",r.onComplete?.(),this.animations.delete(r.id)))}});let s=!1;if(!i){for(const r of this.animations.values())if(r.state==="paused"){s=!0;break}}wo(i),bo(s),i||this.animations.size>0||this.forceTicker?this.rafId=requestAnimationFrame(this.tick):this.stopLoop()};ensureLoopRunning(){this.isRunning||(this.isRunning=!0,Ys(!0),this.rafId=requestAnimationFrame(this.tick))}stopLoop(){this.isRunning=!1,Ys(!1),wo(!1),bo(!1),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}const At=new pd;let yd=0;function Tn(n="anim"){return`${n}-${Date.now()}-${++yd}`}function vo(n){const{width:t,height:e}=n.dimensions,{x:o,y:i}=n.spatialPosition,s=40,r=window.innerWidth-s*2,a=window.innerHeight-s*2,c=r/t,l=a/e,d=Math.min(c,l),h=(window.innerWidth-t*d)/2-o*d,u=(window.innerHeight-e*d)/2-i*d;return{scale:d,panX:h,panY:u}}class gd{activeAnimationId=null;isTransitioning=!1;fadeOverlay=null;get transitioning(){return this.isTransitioning}async transitionTo(t,e){if(t<0||t>=p.slides.length||t===p.activeSlideIndex&&!this.isTransitioning)return;this.cancelActiveTransition();const o=p.activeSlideIndex,i=p.slides[o],s=p.slides[t],r=s.transition||Gn,a=t>o?"forward":"backward",c={fromSlide:i,toSlide:s,fromIndex:o,toIndex:t,direction:a};if(e?.skipAnimation||r.type==="none"||p.globalSettings?.animationEnabled===!1||p.globalSettings?.reducedMotion===!0){this.applyImmediateSwitch(t);return}this.isTransitioning=!0;try{await this.executeTransition(c,r)}finally{this.isTransitioning=!1,this.activeAnimationId=null}}applyImmediateSwitch(t){$("activeSlideIndex",t);const e=p.slides[t];if(e){const o=vo(e);ie(o)}}cancelActiveTransition(){this.activeAnimationId&&(At.stop(this.activeAnimationId),this.activeAnimationId=null),this.removeFadeOverlay(),this.isTransitioning=!1}async executeTransition(t,e){switch(e.type){case"fade":return this.executeFade(t,e);case"slide-left":case"slide-right":case"slide-up":case"slide-down":return this.executeSlide(t,e);case"zoom-in":case"zoom-out":return this.executeZoom(t,e);default:this.applyImmediateSwitch(t.toIndex)}}executeFade(t,e){return new Promise(o=>{const i=e.duration/2,s=t.toSlide.backgroundColor||"#ffffff";this.fadeOverlay=document.createElement("div"),this.fadeOverlay.style.cssText=`
                position: fixed;
                inset: 0;
                z-index: 99999;
                background: ${s};
                opacity: 0;
                pointer-events: none;
                transition: opacity ${i}ms ease-in-out;
            `,document.body.appendChild(this.fadeOverlay),requestAnimationFrame(()=>{this.fadeOverlay&&(this.fadeOverlay.style.opacity="1")}),setTimeout(()=>{this.applyImmediateSwitch(t.toIndex),this.fadeOverlay&&(this.fadeOverlay.style.opacity="0"),setTimeout(()=>{this.removeFadeOverlay(),o()},i)},i)})}executeSlide(t,e){return new Promise(o=>{const i={...p.viewState},s=vo(t.toSlide);let r=0,a=0;const c=200;switch(e.type){case"slide-left":r=t.direction==="forward"?-c:c;break;case"slide-right":r=t.direction==="forward"?c:-c;break;case"slide-up":a=t.direction==="forward"?-c:c;break;case"slide-down":a=t.direction==="forward"?c:-c;break}$("activeSlideIndex",t.toIndex);const l=Tn("slide-transition");this.activeAnimationId=l;const d=Bo(e.easing);At.create(l,h=>{const u=d(h),y=be(i.panX+r,s.panX,u),m=be(i.panY+a,s.panY,u),g=be(i.scale,s.scale,u);ie({panX:y,panY:m,scale:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,ie(s),o()}}),At.start(l)})}executeZoom(t,e){return new Promise(o=>{const i={...p.viewState},s=vo(t.toSlide),r=e.type==="zoom-in";$("activeSlideIndex",t.toIndex);const a=Tn("zoom-transition");this.activeAnimationId=a;const c=Bo(e.easing),l=r?.3:1.5,d=s.scale*l;At.create(a,h=>{const u=c(h);let y,m,g;if(h<.5){const w=u*2;y=be(i.scale,d,w),m=be(i.panX,(i.panX+s.panX)/2,w),g=be(i.panY,(i.panY+s.panY)/2,w)}else{const w=(u-.5)*2;y=be(d,s.scale,w),m=be((i.panX+s.panX)/2,s.panX,w),g=be((i.panY+s.panY)/2,s.panY,w)}ie({scale:y,panX:m,panY:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,ie(s),o()}}),At.start(a)})}removeFadeOverlay(){this.fadeOverlay&&this.fadeOverlay.parentNode&&(this.fadeOverlay.parentNode.removeChild(this.fadeOverlay),this.fadeOverlay=null)}async previewTransition(t){if(!(t<0||t>=p.slides.length))if(t===0){const e=p.slides[0],o=e.transition||Gn;await this.executeTransition({fromSlide:e,toSlide:e,fromIndex:-1,toIndex:0,direction:"forward"},o)}else await this.transitionTo(t-1,{skipAnimation:!0}),await new Promise(e=>setTimeout(e,300)),await this.transitionTo(t)}}const So=new gd;class ln{static parsePath(t){const e=[],o=t.match(/[a-zA-Z]|[-+]?[0-9]*\.?[0-9]+/g);if(!o)return[];let i=0,s=0,r=0,a=0,c=0;for(;c<o.length;){const l=o[c];switch(c++,l){case"M":{const d=parseFloat(o[c++]),h=parseFloat(o[c++]);i=d,s=h,r=d,a=h;break}case"L":{const d=parseFloat(o[c++]),h=parseFloat(o[c++]),u=Math.hypot(d-i,h-s);e.push({type:"L",start:{x:i,y:s},points:[{x:d,y:h}],length:u}),i=d,s=h;break}case"Q":{const d=parseFloat(o[c++]),h=parseFloat(o[c++]),u=parseFloat(o[c++]),y=parseFloat(o[c++]),m=this.estimateBezierLength(i,s,d,h,u,y);e.push({type:"Q",start:{x:i,y:s},points:[{x:d,y:h},{x:u,y}],length:m}),i=u,s=y;break}case"C":{const d=parseFloat(o[c++]),h=parseFloat(o[c++]),u=parseFloat(o[c++]),y=parseFloat(o[c++]),m=parseFloat(o[c++]),g=parseFloat(o[c++]),w=this.estimateCubicBezierLength(i,s,d,h,u,y,m,g);e.push({type:"C",start:{x:i,y:s},points:[{x:d,y:h},{x:u,y},{x:m,y:g}],length:w}),i=m,s=g;break}case"Z":{const d=Math.hypot(r-i,a-s);d>0&&e.push({type:"L",start:{x:i,y:s},points:[{x:r,y:a}],length:d}),i=r,s=a;break}}}return e}static getPointOnPath(t,e){if(t.length===0)return{x:0,y:0,angle:0};const o=t.reduce((r,a)=>r+a.length,0),i=e*o;let s=0;for(const r of t){if(s+r.length>=i||r===t[t.length-1]){const a=Math.max(0,Math.min(1,(i-s)/r.length));return this.interpolateSegment(r,a)}s+=r.length}return this.interpolateSegment(t[t.length-1],1)}static interpolateSegment(t,e){const{start:o}=t;let i=0,s=0,r=0;if(t.type==="L"){const a=t.points[0];i=o.x+(a.x-o.x)*e,s=o.y+(a.y-o.y)*e,r=Math.atan2(a.y-o.y,a.x-o.x)}else if(t.type==="Q"){const a=t.points[0],c=t.points[1],l=1-e;i=l*l*o.x+2*l*e*a.x+e*e*c.x,s=l*l*o.y+2*l*e*a.y+e*e*c.y;const d=2*l*(a.x-o.x)+2*e*(c.x-a.x),h=2*l*(a.y-o.y)+2*e*(c.y-a.y);r=Math.atan2(h,d)}else if(t.type==="C"){const a=t.points[0],c=t.points[1],l=t.points[2],d=1-e,h=d*d,u=e*e;i=h*d*o.x+3*h*e*a.x+3*d*u*c.x+u*e*l.x,s=h*d*o.y+3*h*e*a.y+3*d*u*c.y+u*e*l.y;const y=3*h*(a.x-o.x)+6*d*e*(c.x-a.x)+3*u*(l.x-c.x),m=3*h*(a.y-o.y)+6*d*e*(c.y-a.y)+3*u*(l.y-c.y);r=Math.atan2(m,y)}return{x:i,y:s,angle:r}}static estimateBezierLength(t,e,o,i,s,r){const a=Math.hypot(s-t,r-e);return(Math.hypot(o-t,i-e)+Math.hypot(s-o,r-i)+a)/2}static estimateCubicBezierLength(t,e,o,i,s,r,a,c){const l=Math.hypot(a-t,c-e);return(Math.hypot(o-t,i-e)+Math.hypot(s-o,r-i)+Math.hypot(a-s,c-r)+l)/2}static svgToPoints(t){const e=this.parsePath(t),o=[];if(e.length===0)return[];o.push({x:e[0].start.x,y:e[0].start.y,type:"anchor"});for(const i of e)i.type==="L"?o.push({x:i.points[0].x,y:i.points[0].y,type:"anchor"}):i.type==="Q"?(o.push({x:i.points[0].x,y:i.points[0].y,type:"control"}),o.push({x:i.points[1].x,y:i.points[1].y,type:"anchor"})):i.type==="C"&&(o.push({x:i.points[0].x,y:i.points[0].y,type:"control"}),o.push({x:i.points[1].x,y:i.points[1].y,type:"control_end"}),o.push({x:i.points[2].x,y:i.points[2].y,type:"anchor"}));return o}static pointsToSvg(t){if(t.length===0)return"";let e=`M ${Math.round(t[0].x)} ${Math.round(t[0].y)}`,o=1;for(;o<t.length;){const i=t[o];if(i.type.includes("control")){const s=t[o+1];if(!s)break;if(s.type.includes("control")){const r=t[o+2];r&&r.type==="anchor"?(e+=` C ${Math.round(i.x)} ${Math.round(i.y)} ${Math.round(s.x)} ${Math.round(s.y)} ${Math.round(r.x)} ${Math.round(r.y)}`,o+=3):o++}else s.type==="anchor"?(e+=` Q ${Math.round(i.x)} ${Math.round(i.y)} ${Math.round(s.x)} ${Math.round(s.y)}`,o+=2):o++}else e+=` L ${Math.round(i.x)} ${Math.round(i.y)}`,o++}return e}}const md=(n,t,e,o,i)=>`M ${n+i} ${t} L ${n+e-i} ${t} Q ${n+e} ${t} ${n+e} ${t+i} L ${n+e} ${t+o-i} Q ${n+e} ${t+o} ${n+e-i} ${t+o} L ${n+i} ${t+o} Q ${n} ${t+o} ${n} ${t+o-i} L ${n} ${t+i} Q ${n} ${t} ${n+i} ${t}`,Hn=n=>{if(n.points&&n.points.length>0)return console.log("[getShapeGeometry] Using custom points:",n.id,n.points.length),{type:"points",points:n.points};const t=n.width,e=n.height,o=t/2,i=e/2,s=-o,r=-i;switch(n.type){case"rectangle":case"image":case"text":case"umlClass":case"umlNote":case"umlPackage":case"umlActor":case"umlComponent":case"umlLifeline":case"umlFragment":return{type:"rect",x:s,y:r,w:t,h:e,r:n.roundness?10:0};case"umlState":return{type:"rect",x:s,y:r,w:t,h:e,r:Math.min(Math.abs(t),Math.abs(e))*.15};case"umlInterface":case"umlUseCase":case"umlProvidedInterface":case"circle":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"umlRequiredInterface":{const a=Math.min(t,e)/2;return{type:"path",path:`M 0 ${-a} A ${a} ${a} 0 0 1 0 ${a}`}}case"umlSignalSend":{const a=t*.2;return{type:"points",points:[{x:-o,y:-i},{x:o-a,y:-i},{x:o,y:0},{x:o-a,y:i},{x:-o,y:i}]}}case"umlSignalReceive":{const a=t*.2;return{type:"points",points:[{x:-o+a,y:-i},{x:o,y:-i},{x:o,y:i},{x:-o+a,y:i},{x:-o,y:0}]}}case"triangle":return{type:"points",points:[{x:0,y:-i},{x:-o,y:i},{x:o,y:i}]};case"diamond":return{type:"points",points:[{x:0,y:-i},{x:o,y:0},{x:0,y:i},{x:-o,y:0}]};case"hexagon":{const a=[];for(let c=0;c<6;c++){const l=Math.PI/3*c-Math.PI/2;a.push({x:t/2*Math.cos(l),y:e/2*Math.sin(l)})}return{type:"points",points:a}}case"octagon":{const a=[];for(let c=0;c<8;c++){const l=Math.PI/4*c-Math.PI/2;a.push({x:t/2*Math.cos(l),y:e/2*Math.sin(l)})}return{type:"points",points:a}}case"pentagon":{const a=[];for(let c=0;c<5;c++){const l=Math.PI*2/5*c-Math.PI/2;a.push({x:t/2*Math.cos(l),y:e/2*Math.sin(l)})}return{type:"points",points:a}}case"septagon":{const a=[];for(let c=0;c<7;c++){const l=Math.PI*2/7*c-Math.PI/2;a.push({x:t/2*Math.cos(l),y:e/2*Math.sin(l)})}return{type:"points",points:a}}case"star":{const a=Math.min(t,e)/2,c=(n.shapeRatio!==void 0?n.shapeRatio:38)/100,l=a*c,d=n.starPoints||5,h=[];for(let u=0;u<d*2;u++){const y=Math.PI/d*u-Math.PI/2,m=u%2===0?a:l;h.push({x:m*Math.cos(y),y:m*Math.sin(y)})}return{type:"points",points:h}}case"burst":{const a=Math.min(Math.abs(t),Math.abs(e))/2,c=(n.shapeRatio!==void 0?n.shapeRatio:70)/100,l=a*c,d=n.burstPoints||16,h=[];for(let u=0;u<d*2;u++){const y=Math.PI/d*u-Math.PI/2,m=u%2===0?a:l;h.push({x:m*Math.cos(y),y:m*Math.sin(y)})}return{type:"points",points:h}}case"parallelogram":{const a=t*.2;return{type:"points",points:[{x:s+a,y:r},{x:s+t,y:r},{x:s+t-a,y:r+e},{x:s,y:r+e}]}}case"trapezoid":{const a=t*.2;return{type:"points",points:[{x:s+a,y:r},{x:s+t-a,y:r},{x:s+t,y:r+e},{x:s,y:r+e}]}}case"rightTriangle":return{type:"points",points:[{x:s,y:r},{x:s,y:r+e},{x:s+t,y:r+e}]};case"capsule":return{type:"path",path:md(s,r,t,e,Math.min(t,e)/2)};case"stickyNote":{const a=Math.min(t,e)*.15;return{type:"points",points:[{x:s,y:r},{x:s+t,y:r},{x:s+t,y:r+e-a},{x:s+t-a,y:r+e},{x:s,y:r+e}]}}case"callout":{const a=e*.2,c=e-a;return{type:"path",path:`M ${s} ${r} L ${s+t} ${r} L ${s+t} ${r+c} L ${s+t*.7} ${r+c} L 0 ${i} L ${s+t*.3} ${r+c} L ${s} ${r+c} Z`}}case"speechBubble":{const a=Math.min(t,e)*((n.borderRadius!==void 0?n.borderRadius:20)/100),c=t*.15,l=e*.2,d=e-l,h=(n.tailPosition!==void 0?n.tailPosition:20)/100,u=s+t*h;let y,m;h<=.5?(y=u+t*.1,m=y+c):(m=u-t*.1,y=m-c);const g=Math.min(t/2,a),w=Math.min(d/2,a);return{type:"path",path:`M ${s+g} ${r} L ${s+t-g} ${r} Q ${s+t} ${r} ${s+t} ${r+w} L ${s+t} ${r+d-w} Q ${s+t} ${r+d} ${s+t-g} ${r+d} L ${m} ${r+d} L ${u} ${i} L ${y} ${r+d} L ${s+g} ${r+d} Q ${s} ${r+d} ${s} ${r+d-w} L ${s} ${r+w} Q ${s} ${r} ${s+g} ${r} Z`}}case"cloud":{const a=t*.2,c=t*.25,l=t*.2,d=t*.3;return{type:"path",path:`M ${s+a} 0 A ${a} ${a} 0 0 1 ${s+t*.3} ${r+c} A ${c} ${c} 0 0 1 ${s+t*.7} ${r+c} A ${l} ${l} 0 0 1 ${s+t-l} 0 A ${d} ${d} 0 0 1 ${s+t*.6} ${r+e-d*.5} A ${d} ${d} 0 0 1 ${s+t*.3} ${r+e-d*.5} A ${d} ${d} 0 0 1 ${s+a} 0 Z`}}case"heart":return{type:"path",path:`M 0 ${r+e*.3} C 0 ${r+e*.15} ${s+t*.3} ${r} ${s+t*.5} ${r+e*.15} C ${s+t*.7} ${r} ${s+t} ${r+e*.15} ${s+t} ${r+e*.35} C ${s+t} ${r+e*.6} 0 ${r+e*.8} 0 ${r+e} C 0 ${r+e*.8} ${s} ${r+e*.6} ${s} ${r+e*.35} C ${s} ${r+e*.15} ${s+t*.3} ${r} ${s+t*.5} ${r+e*.15} Z`};case"polygon":{const a=n.polygonSides||6,c=[];for(let l=0;l<a;l++){const d=2*Math.PI/a*l-Math.PI/2;c.push({x:t/2*Math.cos(d),y:e/2*Math.sin(d)})}return{type:"points",points:c}}case"starPerson":{const a=Math.min(t,e)*.15,c=r+a*2;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:r+a,rx:a,ry:a},{type:"points",points:[{x:0,y:c},{x:s,y:r+e*.4},{x:0,y:r+e*.5},{x:s+t,y:r+e*.4},{x:0,y:c},{x:s+t*.8,y:r+e},{x:0,y:r+e*.7},{x:s+t*.2,y:r+e},{x:0,y:c}]}]}}case"lightbulb":{const a=Math.min(t,e/1.5)/2,c=t*.4,l=e*.25,d=r+e-l;return{type:"multi",shapes:[{type:"path",path:`M ${-c/2} ${d} C ${-c/2} ${r+a} ${s} ${r+a*1.5} ${s} ${r+a} A ${a} ${a} 0 1 1 ${s+t} ${r+a} C ${s+t} ${r+a*1.5} ${c/2} ${r+a} ${c/2} ${d} Z`},{type:"rect",x:-c/2,y:d,w:c,h:l}]}}case"signpost":{const a=Math.max(4,t*.05),c=e*.3,l=t*.9,d=r+e*.1;return{type:"multi",shapes:[{type:"rect",x:-a/2,y:r,w:a,h:e},{type:"rect",x:-l/2,y:d,w:l,h:c}]}}case"burstBlob":{const a=t/2,c=e/2,l=12,d=Math.min(a,c),h=d*.6,u=n.seed||1,y=g=>{let w=g+=1831565813;return w=Math.imul(w^w>>>15,w|1),w^=w+Math.imul(w^w>>>7,w|61),((w^w>>>14)>>>0)/4294967296},m=[];for(let g=0;g<l*2;g++){const x=(g%2===0?d:h)+(y(u+g)-.5)*(d*.1),b=Math.PI*g/l;m.push({x:Math.cos(b)*(t/e)*x,y:Math.sin(b)*x})}return{type:"points",points:m}}case"scroll":{const a=e*.15;return{type:"path",path:`M ${s} ${r+a} L ${s+t} ${r+a} L ${s+t} ${r+e-a} L ${s} ${r+e-a} Z M ${s} ${r+a} C ${s-a} ${r+a} ${s-a} ${r} ${s} ${r} L ${s+t} ${r} C ${s+t+a} ${r} ${s+t+a} ${r+a} ${s+t} ${r+a} M ${s} ${r+e-a} C ${s-a} ${r+e-a} ${s-a} ${r+e} ${s} ${r+e} L ${s+t} ${r+e} C ${s+t+a} ${r+e} ${s+t+a} ${r+e-a} ${s+t} ${r+e-a}`}}case"doubleBanner":{const a=t*.15,c=e*.25;return{type:"multi",shapes:[{type:"points",points:[{x:s+a,y:r+c},{x:s,y:r+c},{x:s+a/2,y:0},{x:s,y:i},{x:s+a,y:i}]},{type:"points",points:[{x:s+t-a,y:r+c},{x:s+t,y:r+c},{x:s+t-a/2,y:0},{x:s+t,y:i},{x:s+t-a,y:i}]},{type:"points",points:[{x:s+a,y:r},{x:s+t-a,y:r},{x:s+t-a,y:r+e-c},{x:s+a,y:r+e-c}]}]}}case"document":{const a=e*.1;return{type:"path",path:`M ${s} ${r} L ${s+t} ${r} L ${s+t} ${r+e-a} Q ${s+t*.75} ${r+e-a*2} ${s+t*.5} ${r+e-a} T ${s} ${r+e-a} Z`}}case"cross":return{type:"multi",shapes:[{type:"points",points:[{x:s,y:r},{x:s+t,y:r+e}]},{type:"points",points:[{x:s+t,y:r},{x:s,y:r+e}]}]};case"checkmark":return{type:"points",points:[{x:s,y:r+e*.5},{x:s+t*.4,y:i},{x:s+t,y:r}]};case"wavyDivider":{let a=`M ${s} 0`;for(let c=1;c<=20;c++)a+=` L ${s+c/20*t} ${Math.sin(c/20*Math.PI*4)*(e/2)}`;return{type:"path",path:a}}case"ribbon":{const a=t*.15,c=e*.7;return{type:"path",path:`M ${s+a} ${r} L ${s+t-a} ${r} L ${s+t-a} ${r+c} L ${s+t} ${r+e/2} L ${s+t-a} ${r+e*.8} L ${s+a} ${r+e*.8} L ${s} ${r+e/2} L ${s+a} ${r+c} Z`}}case"bracketLeft":return{type:"points",isClosed:!1,points:[{x:s+t,y:r},{x:s,y:r+e/2},{x:s+t,y:r+e}]};case"bracketRight":return{type:"points",isClosed:!1,points:[{x:s,y:r},{x:s+t,y:r+e/2},{x:s,y:r+e}]};case"arrowLeft":{const a=e*.4,c=r+(e-a)/2,l=t*.4;return{type:"points",points:[{x:s+l,y:r},{x:s+l,y:c},{x:s+t,y:c},{x:s+t,y:c+a},{x:s+l,y:c+a},{x:s+l,y:r+e},{x:s,y:r+e/2}]}}case"arrowRight":{const a=e*.4,c=r+(e-a)/2,l=t*.4;return{type:"points",points:[{x:s+t-l,y:r},{x:s+t,y:r+e/2},{x:s+t-l,y:r+e},{x:s+t-l,y:c+a},{x:s,y:c+a},{x:s,y:c},{x:s+t-l,y:c}]}}case"arrowUp":{const a=t*.4,c=s+(t-a)/2,l=e*.4;return{type:"points",points:[{x:s+t/2,y:r},{x:s+t,y:r+l},{x:c+a,y:r+l},{x:c+a,y:r+e},{x:c,y:r+e},{x:c,y:r+l},{x:s,y:r+l}]}}case"arrowDown":{const a=t*.4,c=s+(t-a)/2,l=e*.4;return{type:"points",points:[{x:c,y:r},{x:c+a,y:r},{x:c+a,y:r+e-l},{x:s+t,y:r+e-l},{x:s+t/2,y:r+e},{x:s,y:r+e-l},{x:c,y:r+e-l}]}}case"dfdProcess":{const a=e*.25;return{type:"multi",shapes:[{type:"rect",x:s,y:r,w:t,h:e,r:10},{type:"points",points:[{x:s,y:r+a},{x:s+t,y:r+a}],isClosed:!1}]}}case"dfdDataStore":{const a=t*.2;return{type:"multi",shapes:[{type:"points",isClosed:!1,points:[{x:s+t,y:r},{x:s,y:r},{x:s,y:r+e},{x:s+t,y:r+e}]},{type:"points",isClosed:!1,points:[{x:s+a,y:r},{x:s+a,y:r+e}]}]}}case"isometricCube":{const a=(n.shapeRatio!==void 0?n.shapeRatio:25)/100,c=(n.sideRatio!==void 0?n.sideRatio:50)/100,l=s+t*c,d=s+t*(1-c),h=e*a,u=r+h,y=r+h/2;return{type:"multi",shapes:[{type:"points",points:[{x:d,y:r},{x:s+t,y},{x:l,y:u},{x:s,y}],shade:1.1},{type:"points",points:[{x:s,y},{x:l,y:u},{x:l,y:r+e},{x:s,y:r+e-h/2}],shade:.9},{type:"points",points:[{x:l,y:u},{x:s+t,y},{x:s+t,y:r+e-h/2},{x:l,y:r+e}],shade:.7}]}}case"solidBlock":{const a=n.depth!==void 0?n.depth:50,l=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=a*Math.cos(l),h=a*Math.sin(l),u={x:s,y:r},y={x:s+t,y:r},m={x:s+t,y:r+e},g={x:s,y:r+e},w={x:s+d,y:r+h},x={x:s+t+d,y:r+h},b={x:s+t+d,y:r+e+h},S={x:s+d,y:r+e+h};return{type:"multi",shapes:[{type:"points",points:[w,x,b,S],shade:.6},{type:"points",points:[u,y,x,w],shade:1.1},{type:"points",points:[y,m,b,x],shade:.8},{type:"points",points:[m,g,S,b],shade:.7},{type:"points",points:[g,u,w,S],shade:.9},{type:"points",points:[u,y,m,g],shade:1}]}}case"perspectiveBlock":{const a=n.depth!==void 0?n.depth:50,l=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=n.taper!==void 0?n.taper:0,h=(n.skewX!==void 0?n.skewX:0)*t,u=(n.skewY!==void 0?n.skewY:0)*e,y=n.frontTaper!==void 0?n.frontTaper:0,m=(n.frontSkewX!==void 0?n.frontSkewX:0)*t,g=(n.frontSkewY!==void 0?n.frontSkewY:0)*e,w=a*Math.cos(l)+h,x=a*Math.sin(l)+u,b=1-y,S=o*b,P=i*b,A={x:-S+m,y:-P+g},B={x:S+m,y:-P+g},X={x:S+m,y:P+g},D={x:-S+m,y:P+g},Q=1-d,ot=o*Q,st=i*Q,dt={x:w-ot,y:x-st},ut={x:w+ot,y:x-st},xt={x:w+ot,y:x+st},Dt={x:w-ot,y:x+st};return{type:"multi",shapes:[{type:"points",points:[dt,ut,xt,Dt],shade:.6},{type:"points",points:[A,B,ut,dt],shade:1.1},{type:"points",points:[B,X,xt,ut],shade:.8},{type:"points",points:[X,D,Dt,xt],shade:.7},{type:"points",points:[D,A,dt,Dt],shade:.9},{type:"points",points:[A,B,X,D],shade:1}]}}case"cylinder":{const a=n.depth!==void 0?n.depth:50,l=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,d=t/2,h=e/2,u=a*Math.cos(l),y=a*Math.sin(l),m=0,g=0,w=u,x=y,b=Math.atan2(y*d*d,u*h*h)+Math.PI/2,S=d*Math.cos(b),P=h*Math.sin(b);return{type:"multi",shapes:[{type:"ellipse",cx:w,cy:x,rx:d,ry:h,shade:.6},{type:"points",points:[{x:m+S,y:g+P},{x:w+S,y:x+P},{x:w-S,y:x-P},{x:m-S,y:g-P}],shade:.8},{type:"ellipse",cx:m,cy:g,rx:d,ry:h,shade:1}]}}case"stateStart":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"stateEnd":return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2},{type:"ellipse",cx:0,cy:0,rx:t/3,ry:e/3}]};case"stateSync":return{type:"rect",x:s,y:r,w:t,h:e,r:2};case"activationBar":return{type:"rect",x:s,y:r,w:t,h:e,r:0};case"externalEntity":return{type:"multi",shapes:[{type:"rect",x:s+4,y:r+4,w:t,h:e,r:0},{type:"rect",x:s,y:r,w:t,h:e,r:0}]}}return null};class xn{static resamplePolygon(t,e){if(t.length<2)return Array(e).fill(t[0]||{x:0,y:0});let o=0;const i=[];for(let l=0;l<t.length;l++){const d=t[l],h=t[(l+1)%t.length],u=Math.hypot(h.x-d.x,h.y-d.y);o+=u,i.push({length:u,start:d,end:h})}if(o===0)return Array(e).fill(t[0]);const s=[],r=o/e;let a=0,c=0;for(let l=0;l<e;l++){const d=l*r;for(;c<i.length;){const h=i[c];if(a+h.length>=d){const y=(d-a)/h.length;s.push({x:h.start.x+(h.end.x-h.start.x)*y,y:h.start.y+(h.end.y-h.start.y)*y});break}else a+=h.length,c++}s.length<=l&&s.push(t[t.length-1])}return s}static interpolatePoints(t,e,o){return t.length!==e.length?(console.warn("Interpolation mismatch",t.length,e.length),t):t.map((i,s)=>{const r=e[s];return{x:i.x+(r.x-i.x)*o,y:i.y+(r.y-i.y)*o}})}static alignPolygons(t,e){if(t.length!==e.length)return e;let o=0,i=1/0;for(let r=0;r<e.length;r++){let a=0;for(let c=0;c<t.length;c++){const l=t[c],d=e[(c+r)%e.length];a+=(l.x-d.x)**2+(l.y-d.y)**2}a<i&&(i=a,o=r)}const s=Array(e.length);for(let r=0;r<e.length;r++)s[r]=e[(r+o)%e.length];return s}static getPointsFromElement(t,e){const o=e?{...t,type:e}:t;if(o.type==="line"||o.type==="arrow")return o.points||[{x:0,y:0},{x:o.width,y:o.height}];const i=Hn(o);return i?this.geometryToPoints(i,o.width,o.height):this.generateCirclePoints(o.width/2,o.height/2)}static geometryToPoints(t,e,o){switch(t.type){case"points":return t.points.length===0?[]:t.points;case"rect":return[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}];case"ellipse":const i=[],s=60;for(let l=0;l<s;l++){const d=l/s*Math.PI*2;i.push({x:t.cx+t.rx*Math.cos(d),y:t.cy+t.ry*Math.sin(d)})}return i;case"path":const r=ln.parsePath(t.path),a=[],c=60;for(let l=0;l<c;l++){const d=ln.getPointOnPath(r,l/c);a.push({x:d.x,y:d.y})}return a;case"multi":return t.shapes.length>0?this.geometryToPoints(t.shapes[0],e,o):[]}return[]}static generateCirclePoints(t,e){const o=[];for(let s=0;s<60;s++){const r=s/60*Math.PI*2;o.push({x:t*Math.cos(r),y:e*Math.sin(r)})}return o}}const qt=new Map;function jn(n,t){const e=qt.get(n);if(!e)return;const o=[];for(const[i,s]of e.entries())for(const r of s)if(t.has(r)){o.push(i);break}o.forEach(i=>{At.stop(i),e.delete(i)}),e.size===0&&qt.delete(n)}function kr(n){const t=qt.get(n);t&&(t.forEach((e,o)=>At.stop(o)),qt.delete(n))}function xd(n){const t=qt.get(n);return t?t.size>0:!1}function wd(n,t){return n[t]}function K(n,t,e){const o=p.elements.find(d=>d.id===n);if(!o)return console.warn(`animateElement: Element ${n} not found`),"";const i=Tn("el"),s={},r=[],a=[],c={},l=new Set;for(const d of Object.keys(t)){l.add(d);const h=wd(o,d);h!==void 0?(s[d]=h,typeof h=="number"?r.push(d):typeof h=="string"&&a.push(d)):c[d]=t[d]}return jn(n,l),qt.has(n)||qt.set(n,new Map),qt.get(n).set(i,l),Object.keys(c).length>0&&Z(n,c,!1),At.create(i,d=>{const h={},u={};for(const y of r){const m=s[y],g=t[y],w=be(m,g,d);h[y]=w,u[y]=w}for(const y of a){const m=s[y],g=t[y];if(m&&g&&m.startsWith("#")&&g.startsWith("#")){const w=dd(m,g,d);h[y]=w,u[y]=w}}Z(n,h,!1),e.onUpdate?.(u)},{duration:e.duration,easing:e.easing,delay:e.delay,onStart:e.onStart,onComplete:()=>{const d=qt.get(n);d&&(d.delete(i),d.size===0&&qt.delete(n)),e.onComplete?.()},loop:e.loop,loopCount:e.loopCount,alternate:e.alternate}),At.start(i),i}function Mr(n,t,e,o=0){return n.map((i,s)=>K(i,t,{...e,delay:(e.delay??0)+o*s}))}function Pr(n){At.stop(n)}function $r(n){At.pause(n)}function Cr(n,t,e){const o=p.elements.find(d=>d.id===n);if(!o)return"";const i=ln.parsePath(t);if(i.length===0)return"";const s=Tn("path"),r=new Set(["x","y"]);e.orientToPath&&r.add("angle"),jn(n,r),qt.has(n)||qt.set(n,new Map),qt.get(n).set(s,r);const a=o.x+o.width/2,c=o.y+o.height/2,l=e.isRelative??!0;return At.create(s,d=>{const h=ln.getPointOnPath(i,d);let u,y;l?(u=a+h.x-o.width/2,y=c+h.y-o.height/2):(u=h.x-o.width/2,y=h.y-o.height/2);const m={x:u,y};e.orientToPath&&(m.angle=h.angle),Z(n,m,!1),e.onUpdate?.({x:m.x,y:m.y,angle:m.angle})},{duration:e.duration,easing:e.easing,delay:e.delay,onStart:e.onStart,onComplete:()=>{const d=qt.get(n);d&&(d.delete(s),d.size===0&&qt.delete(n)),e.onComplete?.()},loop:e.loop,loopCount:e.loopCount,alternate:e.alternate}),At.start(s),s}function Tr(n){At.start(n)}function Ir(n,t=300,e={}){return Z(n,{opacity:0},!1),K(n,{opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Lr(n,t=300,e={}){return K(n,{opacity:0},{duration:t,easing:"easeOutQuad",...e})}function ds(n,t=300,e={}){const o=p.elements.find(h=>h.id===n);if(!o)return"";const i=o.x,s=o.y,r=o.width,a=o.height,c=100,l=i+r/2,d=s+a/2;return Z(n,{width:0,height:0,x:l,y:d,opacity:0},!1),K(n,{width:r,height:a,x:i,y:s,opacity:c},{duration:t,easing:"easeOutBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function Ki(n,t=450,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=e.intensity??20,s=o.y;return K(n,{y:s-i},{duration:t*.33,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{y:s},{duration:t*.67,easing:"easeOutBounce",onComplete:e.onComplete})}})}function Zi(n,t=300,e={}){const o=p.elements.find(y=>y.id===n);if(!o)return"";const i=e.scale??1.1,s=o.width,r=o.height,a=o.x,c=o.y,l=s*i,d=r*i,h=(l-s)/2,u=(d-r)/2;return K(n,{width:l,height:d,x:a-h,y:c-u},{duration:t/2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{width:s,height:r,x:a,y:c},{duration:t/2,easing:"easeOutQuad",onComplete:e.onComplete})}})}function hs(n,t=1e3,e={}){return K(n,{opacity:0},{duration:t/4,easing:"linear",loop:!0,loopCount:2,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:e.onComplete})}function us(n,t=1e3,e={}){const o=p.elements.find(c=>c.id===n);if(!o)return"";const i=o.width,s=o.height,r=o.x,a=o.y;return K(n,{width:i*1.25,height:s*.75,x:r-i*.25/2,y:a+s*.25/2},{duration:t*.3,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{width:i*.75,height:s*1.25,x:r+i*.25/2,y:a-s*.25/2},{duration:t*.3,easing:"easeInOutQuad",onComplete:()=>{K(n,{width:i,height:s,x:r,y:a},{duration:t*.4,easing:"easeOutElastic",onComplete:e.onComplete})}})}})}function to(n,t=400,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=e.intensity??10,s=o.x;return K(n,{x:s+i},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{x:s},!1),e.onComplete?.()}})}function fs(n,t=400,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=e.intensity??10,s=o.y;return K(n,{y:s+i},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{Z(n,{y:s},!1),e.onComplete?.()}})}function Er(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.x;return K(n,{x:i-6},{duration:t/5,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{x:i+5},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{K(n,{x:i-3},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{K(n,{x:i+2},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{K(n,{x:i},{duration:t/5,easing:"easeInOutQuad",onComplete:e.onComplete})}})}})}})}})}function Rr(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.angle;return K(n,{angle:i+.25},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{angle:i-.17},{duration:t*.2,easing:"linear",onComplete:()=>{K(n,{angle:i+.08},{duration:t*.2,easing:"linear",onComplete:()=>{K(n,{angle:i-.05},{duration:t*.2,easing:"linear",onComplete:()=>{K(n,{angle:i},{duration:t*.2,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function Ar(n,t=1e3,e={}){const o=p.elements.find(l=>l.id===n);if(!o)return"";const i=o.width,s=o.height,r=o.x,a=o.y,c=o.angle;return K(n,{width:i*.9,height:s*.9,x:r+i*.1/2,y:a+s*.1/2,angle:c-.05},{duration:t*.1,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{width:i*1.1,height:s*1.1,x:r-i*.1/2,y:a-s*.1/2,angle:c+.05},{duration:t*.3,easing:"linear",loop:!0,loopCount:3,alternate:!0,onComplete:()=>{K(n,{width:i,height:s,x:r,y:a,angle:c},{duration:t*.1,easing:"linear",onComplete:e.onComplete})}})}})}function Dr(n,t=1e3,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.x,s=o.angle;return K(n,{x:i-o.width*.25,angle:s-.08},{duration:t*.15,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{x:i+o.width*.2,angle:s+.05},{duration:t*.15,easing:"linear",onComplete:()=>{K(n,{x:i-o.width*.15,angle:s-.05},{duration:t*.15,easing:"linear",onComplete:()=>{K(n,{x:i+o.width*.1,angle:s+.03},{duration:t*.15,easing:"linear",onComplete:()=>{K(n,{x:i,angle:s},{duration:t*.15,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function Or(n,t=1e3,e={}){const o=p.elements.find(c=>c.id===n);if(!o)return"";const i=o.width,s=o.height,r=o.x,a=o.y;return K(n,{width:i*1.1,height:s*.9,x:r-i*.1/2,y:a+s*.1/2},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{width:i*.9,height:s*1.1,x:r+i*.1/2,y:a-s*.1/2},{duration:t*.2,easing:"linear",onComplete:()=>{K(n,{width:i*1.05,height:s*.95,x:r-i*.05/2,y:a+s*.05/2},{duration:t*.2,easing:"linear",onComplete:()=>{K(n,{width:i,height:s,x:r,y:a},{duration:t*.4,easing:"easeOutQuad",onComplete:e.onComplete})}})}})}})}function _r(n,t=1300,e={}){const o=p.elements.find(c=>c.id===n);if(!o)return"";const i=o.width,s=o.height,r=o.x,a=o.y;return K(n,{width:i*1.3,height:s*1.3,x:r-i*.3/2,y:a-s*.3/2},{duration:t*.2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{width:i,height:s,x:r,y:a},{duration:t*.2,easing:"easeInQuad",onComplete:()=>{K(n,{width:i*1.3,height:s*1.3,x:r-i*.3/2,y:a-s*.3/2},{duration:t*.2,easing:"easeOutQuad",onComplete:()=>{K(n,{width:i,height:s,x:r,y:a},{duration:t*.4,easing:"easeInQuad",onComplete:e.onComplete})}})}})}})}function zr(n,t=300,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.x+o.width/2,s=o.y+o.height/2;return K(n,{width:0,height:0,x:i,y:s,opacity:0},{duration:t,easing:"easeInBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function bd(n,t=300,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.x,s=-o.width-50;return Z(n,{x:s,opacity:0},!1),K(n,{x:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function vd(n,t=300,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.x,s=window.innerWidth+50;return Z(n,{x:s,opacity:0},!1),K(n,{x:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Sd(n,t=300,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.y,s=-o.height-50;return Z(n,{y:s,opacity:0},!1),K(n,{y:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function kd(n,t=300,e={}){const o=p.elements.find(r=>r.id===n);if(!o)return"";const i=o.y,s=window.innerHeight+50;return Z(n,{y:s,opacity:0},!1),K(n,{y:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Md(n,t=300,e={}){const o=p.elements.find(i=>i.id===n);return o?K(n,{x:-o.width,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function Pd(n,t=300,e={}){return K(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function $d(n,t=300,e={}){const o=p.elements.find(i=>i.id===n);return o?K(n,{y:-o.height,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function Cd(n,t=300,e={}){return K(n,{y:window.innerHeight+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function eo(n,t,e,o={}){const i=p.elements.find(a=>a.id===n);if(!i)return"";const s=i.x,r=i.y;return Z(n,{x:t.x??s,y:t.y??r,opacity:70,width:i.width*.7,height:i.height*.7},!1),K(n,{x:s,y:r,opacity:100,width:i.width,height:i.height},{duration:e,easing:"easeOutBack",...o})}function Br(n,t=1e3,e={}){return eo(n,{y:-window.innerHeight},t,e)}function Wr(n,t=1e3,e={}){return eo(n,{x:-window.innerWidth},t,e)}function Xr(n,t=1e3,e={}){return eo(n,{x:window.innerWidth+100},t,e)}function Yr(n,t=1e3,e={}){return eo(n,{y:window.innerHeight+100},t,e)}function no(n,t,e,o={}){const i=p.elements.find(s=>s.id===n);return i?K(n,{x:t.x??i.x,y:t.y??i.y,opacity:0,width:i.width*.7,height:i.height*.7},{duration:e,easing:"easeInBack",...o}):""}function Hr(n,t=1e3,e={}){return no(n,{y:window.innerHeight+100},t,e)}function Nr(n,t=1e3,e={}){return no(n,{x:-window.innerWidth},t,e)}function Fr(n,t=1e3,e={}){return no(n,{x:window.innerWidth+100},t,e)}function Ur(n,t=1e3,e={}){return no(n,{y:-window.innerHeight},t,e)}function Qn(n,t,e,o={}){const i=p.elements.find(a=>a.id===n);if(!i)return"";const s=i.x,r=i.y;return Z(n,{x:t.x??s,y:t.y??r,opacity:0,width:i.width*.3,height:i.height*.3},!1),K(n,{x:s,y:r,opacity:100,width:i.width,height:i.height},{duration:e,easing:"easeOutBounce",...o})}function Gr(n,t=750,e={}){return Qn(n,{},t,e)}function qr(n,t=1e3,e={}){return Qn(n,{y:-window.innerHeight},t,e)}function jr(n,t=1e3,e={}){return Qn(n,{x:-window.innerWidth},t,e)}function Qr(n,t=1e3,e={}){return Qn(n,{x:window.innerWidth+100},t,e)}function Vr(n,t=1e3,e={}){return Qn(n,{y:window.innerHeight+100},t,e)}function Vn(n,t,e,o={}){const i=p.elements.find(s=>s.id===n);return i?K(n,{x:t.x??i.x,y:t.y??i.y,opacity:0,width:i.width*.3,height:i.height*.3},{duration:e,easing:"easeInBounce",...o}):""}function Jr(n,t=750,e={}){return Vn(n,{},t,e)}function Kr(n,t=1e3,e={}){return Vn(n,{y:window.innerHeight+100},t,e)}function Zr(n,t=1e3,e={}){return Vn(n,{x:-window.innerWidth},t,e)}function ta(n,t=1e3,e={}){return Vn(n,{x:window.innerWidth+100},t,e)}function ea(n,t=1e3,e={}){return Vn(n,{y:-window.innerHeight},t,e)}function Pe(n,t,e,o={}){const i=p.elements.find(a=>a.id===n);if(!i)return"";const s=i.x,r=i.y;return Z(n,{x:t.x??s,y:t.y??r,opacity:0},!1),K(n,{x:s,y:r,opacity:100},{duration:e,easing:"easeOutQuad",...o})}function na(n,t=1e3,e={}){return Pe(n,{y:(p.selection.length>0,-100)},t,e)}function ia(n,t=1e3,e={}){return Pe(n,{y:-window.innerHeight},t,e)}function oa(n,t=1e3,e={}){return Pe(n,{x:-100},t,e)}function sa(n,t=1e3,e={}){return Pe(n,{x:-window.innerWidth},t,e)}function ra(n,t=1e3,e={}){return Pe(n,{x:window.innerWidth+100},t,e)}function aa(n,t=1e3,e={}){return Pe(n,{x:window.innerWidth+2e3},t,e)}function la(n,t=1e3,e={}){return Pe(n,{y:100},t,e)}function ca(n,t=1e3,e={}){return Pe(n,{y:window.innerHeight+100},t,e)}function da(n,t=1e3,e={}){return Pe(n,{x:-100,y:-100},t,e)}function ha(n,t=1e3,e={}){return Pe(n,{x:100,y:-100},t,e)}function ua(n,t=1e3,e={}){return Pe(n,{x:-100,y:100},t,e)}function fa(n,t=1e3,e={}){return Pe(n,{x:100,y:100},t,e)}function $e(n,t,e,o={}){const i=p.elements.find(s=>s.id===n);return i?K(n,{x:t.x??i.x,y:t.y??i.y,opacity:0},{duration:e,easing:"easeInQuad",...o}):""}function pa(n,t=1e3,e={}){return $e(n,{y:100},t,e)}function ya(n,t=1e3,e={}){return $e(n,{y:window.innerHeight+100},t,e)}function ga(n,t=1e3,e={}){return $e(n,{x:-100},t,e)}function ma(n,t=1e3,e={}){return $e(n,{x:-window.innerWidth},t,e)}function xa(n,t=1e3,e={}){return $e(n,{x:100},t,e)}function wa(n,t=1e3,e={}){return $e(n,{x:window.innerWidth+100},t,e)}function ba(n,t=1e3,e={}){return $e(n,{y:-100},t,e)}function va(n,t=1e3,e={}){return $e(n,{y:-window.innerHeight},t,e)}function Sa(n,t=1e3,e={}){return $e(n,{x:-100,y:-100},t,e)}function ka(n,t=1e3,e={}){return $e(n,{x:100,y:-100},t,e)}function Ma(n,t=1e3,e={}){return $e(n,{x:-100,y:100},t,e)}function Pa(n,t=1e3,e={}){return $e(n,{x:100,y:100},t,e)}function $a(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.angle;return K(n,{angle:i+Math.PI},{duration:t/2,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{angle:i+Math.PI*2},{duration:t/2,easing:"easeInOutQuad",onComplete:()=>{Z(n,{angle:i},!1),e.onComplete?.()}})}})}function Ca(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.height;return Z(n,{height:0,opacity:0},!1),K(n,{height:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Ta(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.width;return Z(n,{width:0,opacity:0},!1),K(n,{width:i,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function Ia(n,t=1e3,e={}){return K(n,{height:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function La(n,t=1e3,e={}){return K(n,{width:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function Ea(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.x;return Z(n,{x:window.innerWidth+100,opacity:0},!1),K(n,{x:i,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function Ra(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.x;return Z(n,{x:-window.innerWidth,opacity:0},!1),K(n,{x:i,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function Aa(n,t=1e3,e={}){return K(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInExpo",...e})}function Da(n,t=1e3,e={}){return K(n,{x:-window.innerWidth,opacity:0},{duration:t,easing:"easeInExpo",...e})}function Jn(n,t,e,o={}){const i=p.elements.find(c=>c.id===n);if(!i)return"";const s=i.x,r=i.y,a=i.angle;return Z(n,{x:t.x??s,y:t.y??r,angle:t.angle??a-Math.PI*2,opacity:0},!1),K(n,{x:s,y:r,angle:a,opacity:100},{duration:e,easing:"easeOutQuad",...o})}function Oa(n,t=1e3,e={}){return Jn(n,{},t,e)}function _a(n,t=1e3,e={}){return Jn(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function za(n,t=1e3,e={}){return Jn(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function Ba(n,t=1e3,e={}){return Jn(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function Wa(n,t=1e3,e={}){return Jn(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function Kn(n,t,e,o={}){const i=p.elements.find(s=>s.id===n);return i?K(n,{x:t.x??i.x,y:t.y??i.y,angle:t.angle??i.angle+Math.PI*2,opacity:0},{duration:e,easing:"easeInQuad",...o}):""}function Xa(n,t=1e3,e={}){return Kn(n,{},t,e)}function Ya(n,t=1e3,e={}){return Kn(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function Ha(n,t=1e3,e={}){return Kn(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function Na(n,t=1e3,e={}){return Kn(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function Fa(n,t=1e3,e={}){return Kn(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function Td(n,t=2e3,e={}){const o=p.elements.find(u=>u.id===n);if(!o)return"";const s=(e.params||{}).radius??50,r=o.x,a=o.y,c=r+s,l=a,d=new Set(["x","y"]),h=Tn("revolve");return jn(n,d),qt.has(n)||qt.set(n,new Map),qt.get(n).set(h,d),At.create(h,u=>{const y=u*Math.PI*2,m=c-s*Math.cos(y),g=l-s*Math.sin(y);Z(n,{x:m,y:g},!1)},{duration:t,easing:e.easing||"linear",delay:e.delay,loop:e.loop,loopCount:e.loopCount,alternate:e.alternate,onComplete:()=>{const u=qt.get(n);u&&(u.delete(h),u.size===0&&qt.delete(n)),e.onComplete?.()}}),At.start(h),h}function Ua(n,t=2e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.angle;return K(n,{angle:i+1.2},{duration:t*.4,easing:"easeInOutQuad",alternate:!0,loop:!0,loopCount:2,delay:e.delay,onStart:e.onStart,onComplete:()=>{K(n,{y:window.innerHeight+500,opacity:0},{duration:t*.6,easing:"easeInQuad",onComplete:e.onComplete})}})}function Ga(n,t=1e3,e={}){const o=p.elements.find(c=>c.id===n);if(!o)return"";const i=o.width,s=o.height,r=o.x,a=o.y;return Z(n,{width:0,height:0,x:r+i/2,y:a+s/2,angle:-.5,opacity:0},!1),K(n,{width:i,height:s,x:r,y:a,angle:0,opacity:100},{duration:t,easing:"easeOutBack",...e})}function qa(n,t=1e3,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.x;return Z(n,{x:i-400,angle:-Math.PI*2,opacity:0},!1),K(n,{x:i,angle:0,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function ja(n,t=1e3,e={}){const o=p.elements.find(i=>i.id===n);return o?K(n,{x:o.x+400,angle:Math.PI*2,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function Zn(n,t,e,o={}){const i=p.elements.find(m=>m.id===n);if(!i)return"";const s=i.x,r=i.y,a=i.width,c=i.height,l=t.scale??.1,d=a*l,h=c*l,u=(t.x??s)+(a-d)/2,y=(t.y??r)+(c-h)/2;return Z(n,{x:u,y,width:d,height:h,opacity:0},!1),K(n,{x:s,y:r,width:a,height:c,opacity:100},{duration:e,easing:"easeOutQuad",...o})}function Qa(n,t=1e3,e={}){return Zn(n,{},t,e)}function Va(n,t=1e3,e={}){return Zn(n,{y:-window.innerHeight},t,e)}function Ja(n,t=1e3,e={}){return Zn(n,{x:-window.innerWidth},t,e)}function Ka(n,t=1e3,e={}){return Zn(n,{x:window.innerWidth+100},t,e)}function Za(n,t=1e3,e={}){return Zn(n,{y:window.innerHeight+100},t,e)}function ti(n,t,e,o={}){const i=p.elements.find(r=>r.id===n);if(!i)return"";const s=t.scale??.1;return K(n,{x:(t.x??i.x)+i.width*(1-s)/2,y:(t.y??i.y)+i.height*(1-s)/2,width:i.width*s,height:i.height*s,opacity:0},{duration:e,easing:"easeInQuad",...o})}function tl(n,t=1e3,e={}){return ti(n,{},t,e)}function el(n,t=1e3,e={}){return ti(n,{y:window.innerHeight+100},t,e)}function nl(n,t=1e3,e={}){return ti(n,{x:-window.innerWidth},t,e)}function il(n,t=1e3,e={}){return ti(n,{x:window.innerWidth+100},t,e)}function ol(n,t=1e3,e={}){return ti(n,{y:-window.innerHeight},t,e)}function sl(n,t=1500,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.opacity??100;return Z(n,{drawProgress:0,opacity:0},!1),K(n,{drawProgress:100},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{Z(n,{drawProgress:void 0,opacity:i},!1),e.onComplete?.()}})}function rl(n,t=1500,e={}){const o=p.elements.find(s=>s.id===n);if(!o)return"";const i=o.opacity??100;return Z(n,{drawProgress:100,opacity:0},!1),K(n,{drawProgress:0},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{Z(n,{drawProgress:void 0,opacity:i},!1),e.onComplete?.()}})}const Be=new Map;function al(n){return Be.get(n)}function Id(n,t={}){const e=p.elements.find(d=>d.id===n);if(!e)return"";const o=e.entranceAnimation??"none",i=e.animationDuration??300,{isPreview:s=!0,onComplete:r}=t;s&&!Be.has(n)&&Be.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const a=s?Be.get(n):null,c=()=>{s&&a&&(Z(n,a,!1),Be.delete(n)),r?.()},l={onComplete:c};switch(o){case"fadeIn":return Z(n,{opacity:0},!1),K(n,{opacity:100},{duration:i,easing:"easeOutQuad",onComplete:c});case"fadeInDown":return na(n,i,l);case"fadeInDownBig":return ia(n,i,l);case"fadeInLeft":return oa(n,i,l);case"fadeInLeftBig":return sa(n,i,l);case"fadeInRight":return ra(n,i,l);case"fadeInRightBig":return aa(n,i,l);case"fadeInUp":return la(n,i,l);case"fadeInUpBig":return ca(n,i,l);case"fadeInTopLeft":return da(n,i,l);case"fadeInTopRight":return ha(n,i,l);case"fadeInBottomLeft":return ua(n,i,l);case"fadeInBottomRight":return fa(n,i,l);case"bounce":return Ki(n,i,l);case"flash":return hs(n,i,l);case"pulse":return Zi(n,i,{scale:1.1,...l});case"rubberBand":return us(n,i,l);case"shakeX":return to(n,i,{intensity:10,...l});case"shakeY":return fs(n,i,{intensity:10,...l});case"headShake":return Er(n,i);case"swing":return Rr(n,i);case"tada":return Ar(n,i);case"wobble":return Dr(n,i);case"jello":return Or(n,i);case"heartBeat":return _r(n,i);case"backInDown":return Br(n,i,l);case"backInLeft":return Wr(n,i,l);case"backInRight":return Xr(n,i,l);case"backInUp":return Yr(n,i,l);case"bounceIn":return Gr(n,i,l);case"bounceInDown":return qr(n,i,l);case"bounceInLeft":return jr(n,i,l);case"bounceInRight":return Qr(n,i,l);case"bounceInUp":return Vr(n,i,l);case"zoomIn":return Qa(n,i,l);case"zoomInDown":return Va(n,i,l);case"zoomInLeft":return Ja(n,i,l);case"zoomInRight":return Ka(n,i,l);case"zoomInUp":return Za(n,i,l);case"slideInDown":{const d=e.y;return Z(n,{y:-e.height,opacity:0},!1),K(n,{y:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:c})}case"slideInLeft":{const d=e.x;return Z(n,{x:-e.width,opacity:0},!1),K(n,{x:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:c})}case"slideInRight":{const d=e.x;return Z(n,{x:window.innerWidth+100,opacity:0},!1),K(n,{x:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:c})}case"slideInUp":{const d=e.y;return Z(n,{y:window.innerHeight+100,opacity:0},!1),K(n,{y:d,opacity:100},{duration:i,easing:"easeOutQuad",onComplete:c})}case"rotateIn":return Oa(n,i,l);case"rotateInDownLeft":return _a(n,i,l);case"rotateInDownRight":return za(n,i,l);case"rotateInUpLeft":return Ba(n,i,l);case"rotateInUpRight":return Wa(n,i,l);case"flip":return $a(n,i,l);case"flipInX":return Ca(n,i,l);case"flipInY":return Ta(n,i,l);case"lightSpeedInRight":return Ea(n,i,l);case"lightSpeedInLeft":return Ra(n,i,l);case"rollIn":return qa(n,i,l);case"jackInTheBox":return Ga(n,i,l);case"scaleIn":return ds(n,i,l);case"drawIn":return sl(n,i,l);default:return""}}function Ld(n,t={}){const e=p.elements.find(d=>d.id===n);if(!e)return"";const o=e.exitAnimation??"none",i=e.animationDuration??300,{isPreview:s=!0,onComplete:r}=t;s&&!Be.has(n)&&Be.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const a=s?Be.get(n):null,c=()=>{s&&a&&(Z(n,a,!1),Be.delete(n)),r?.()},l={onComplete:c};switch(o){case"fadeOut":return K(n,{opacity:0},{duration:i,easing:"easeOutQuad",onComplete:c});case"fadeOutDown":return pa(n,i,l);case"fadeOutDownBig":return ya(n,i,l);case"fadeOutLeft":return ga(n,i,l);case"fadeOutLeftBig":return ma(n,i,l);case"fadeOutRight":return xa(n,i,l);case"fadeOutRightBig":return wa(n,i,l);case"fadeOutUp":return ba(n,i,l);case"fadeOutUpBig":return va(n,i,l);case"fadeOutTopLeft":return Sa(n,i,l);case"fadeOutTopRight":return ka(n,i,l);case"fadeOutBottomLeft":return Ma(n,i,l);case"fadeOutBottomRight":return Pa(n,i,l);case"backOutDown":return Hr(n,i,l);case"backOutLeft":return Nr(n,i,l);case"backOutRight":return Fr(n,i,l);case"backOutUp":return Ur(n,i,l);case"bounceOut":return Jr(n,i,l);case"bounceOutDown":return Kr(n,i,l);case"bounceOutLeft":return Zr(n,i,l);case"bounceOutRight":return ta(n,i,l);case"bounceOutUp":return ea(n,i,l);case"zoomOut":return tl(n,i,l);case"zoomOutDown":return el(n,i,l);case"zoomOutLeft":return nl(n,i,l);case"zoomOutRight":return il(n,i,l);case"zoomOutUp":return ol(n,i,l);case"slideOutDown":return K(n,{y:window.innerHeight+100,opacity:0},{duration:i,easing:"easeInQuad",onComplete:c});case"slideOutLeft":return K(n,{x:-e.width,opacity:0},{duration:i,easing:"easeInQuad",onComplete:c});case"slideOutRight":return K(n,{x:window.innerWidth+100,opacity:0},{duration:i,easing:"easeInQuad",onComplete:c});case"slideOutUp":return K(n,{y:-e.height,opacity:0},{duration:i,easing:"easeInQuad",onComplete:c});case"bounce":return Ki(n,i,l);case"flash":return hs(n,i,l);case"pulse":return Zi(n,i,{scale:1.1,...l});case"rubberBand":return us(n,i,l);case"shakeX":return to(n,i,{intensity:10,...l});case"shakeY":return fs(n,i,{intensity:10,...l});case"rotateOut":return Xa(n,i,l);case"rotateOutDownLeft":return Ya(n,i,l);case"rotateOutDownRight":return Ha(n,i,l);case"rotateOutUpLeft":return Na(n,i,l);case"rotateOutUpRight":return Fa(n,i,l);case"flipOutX":return Ia(n,i,l);case"flipOutY":return La(n,i,l);case"lightSpeedOutRight":return Aa(n,i,l);case"lightSpeedOutLeft":return Da(n,i,l);case"rollOut":return ja(n,i,l);case"hinge":return Ua(n,i,l);case"scaleOut":return zr(n,i,l);case"drawOut":return rl(n,i,l);default:return""}}function ll(n,t,e){const o=p.elements.find(h=>h.id===n);if(!o)return"";const i=Tn("morph"),s=new Set(["points","type"]);jn(n,s),qt.has(n)||qt.set(n,new Map),qt.get(n).set(i,s);const r=120,a=xn.getPointsFromElement(o),c=xn.getPointsFromElement(o,t),l=xn.resamplePolygon(a,r);let d=xn.resamplePolygon(c,r);return d=xn.alignPolygons(l,d),console.log("[Morph] Starting morph:",{elementId:n,startPoints:l.length,endPoints:d.length}),At.create(i,h=>{const u=xn.interpolatePoints(l,d,h);console.log("[Morph] Progress:",h.toFixed(3));const y=p.elements.findIndex(m=>m.id===n);if(y!==-1){const m=[...p.elements];m[y]={...m[y],points:[...u]},$("elements",m)}},{duration:e.duration,easing:e.easing,delay:e.delay,loop:e.loop,loopCount:e.loopCount,alternate:e.alternate,onComplete:()=>{const h=qt.get(n);h&&(h.delete(i),h.size===0&&qt.delete(n)),Z(n,{type:t,points:void 0},!1),e.onComplete?.()}}),At.start(i),i}const Ed=Object.freeze(Object.defineProperty({__proto__:null,animateAlongPath:Cr,animateElement:K,animateElements:Mr,animateMorph:ll,backInDown:Br,backInLeft:Wr,backInRight:Xr,backInUp:Yr,backOutDown:Hr,backOutLeft:Nr,backOutRight:Fr,backOutUp:Ur,bounce:Ki,bounceIn:Gr,bounceInDown:qr,bounceInLeft:jr,bounceInRight:Qr,bounceInUp:Vr,bounceOut:Jr,bounceOutDown:Kr,bounceOutLeft:Zr,bounceOutRight:ta,bounceOutUp:ea,drawIn:sl,drawOut:rl,fadeIn:Ir,fadeInBottomLeft:ua,fadeInBottomRight:fa,fadeInDown:na,fadeInDownBig:ia,fadeInLeft:oa,fadeInLeftBig:sa,fadeInRight:ra,fadeInRightBig:aa,fadeInTopLeft:da,fadeInTopRight:ha,fadeInUp:la,fadeInUpBig:ca,fadeOut:Lr,fadeOutBottomLeft:Ma,fadeOutBottomRight:Pa,fadeOutDown:pa,fadeOutDownBig:ya,fadeOutLeft:ga,fadeOutLeftBig:ma,fadeOutRight:xa,fadeOutRightBig:wa,fadeOutTopLeft:Sa,fadeOutTopRight:ka,fadeOutUp:ba,fadeOutUpBig:va,flash:hs,flip:$a,flipInX:Ca,flipInY:Ta,flipOutX:Ia,flipOutY:La,getElementPreviewBaseState:al,headShake:Er,heartBeat:_r,hinge:Ua,isElementAnimating:xd,jackInTheBox:Ga,jello:Or,lightSpeedInLeft:Ra,lightSpeedInRight:Ea,lightSpeedOutLeft:Da,lightSpeedOutRight:Aa,pauseElementAnimation:$r,playEntranceAnimation:Id,playExitAnimation:Ld,pulse:Zi,resumeElementAnimation:Tr,revolve:Td,rollIn:qa,rollOut:ja,rotateIn:Oa,rotateInDownLeft:_a,rotateInDownRight:za,rotateInUpLeft:Ba,rotateInUpRight:Wa,rotateOut:Xa,rotateOutDownLeft:Ya,rotateOutDownRight:Ha,rotateOutUpLeft:Na,rotateOutUpRight:Fa,rubberBand:us,scaleIn:ds,scaleOut:zr,shakeX:to,shakeY:fs,slideInDown:kd,slideInLeft:bd,slideInRight:vd,slideInUp:Sd,slideOutDown:Cd,slideOutLeft:Md,slideOutRight:Pd,slideOutUp:$d,stopAllElementAnimations:kr,stopConflictingAnimations:jn,stopElementAnimation:Pr,swing:Rr,tada:Ar,wobble:Dr,zoomIn:Qa,zoomInDown:Va,zoomInLeft:Ja,zoomInRight:Ka,zoomInUp:Za,zoomOut:tl,zoomOutDown:el,zoomOutLeft:nl,zoomOutRight:il,zoomOutUp:ol},Symbol.toStringTag,{value:"Module"}));class Rd{activeSequences=new Set;playSequence(t,e="programmatic"){const o=p.elements.find(l=>l.id===t),i=o?.animations&&o.animations.length>0,s=o?.spinEnabled||o?.orbitEnabled;if(!o||!i&&!(e==="programmatic"&&s))return;let r=null;e==="programmatic"&&(this.activeSequences.add(t),yi(!0),At.setForceTicker(!0),r={x:o.x,y:o.y,width:o.width,height:o.height,opacity:o.opacity,angle:o.angle,strokeColor:o.strokeColor,backgroundColor:o.backgroundColor});const a=o.animations?o.animations.filter((l,d)=>e==="programmatic"?!0:d===0?l.trigger===e||l.trigger==="after-prev":!0):[];if(a.length===0)return void 0;const c=()=>{e==="programmatic"&&(this.activeSequences.delete(t),this.activeSequences.size===0&&(yi(!1),At.setForceTicker(!1))),r&&(a[a.length-1]?.restoreAfter??!0)&&setTimeout(()=>{Z(t,r,!1)},500)};this.runStep(t,a,0,c)}stopSequence(t){kr(t),this.activeSequences.has(t)&&this.activeSequences.delete(t),this.activeSequences.size===0&&(yi(!1),At.setForceTicker(!1))}playAll(t="programmatic",e){(e?p.elements.filter(i=>e.includes(i.id)):p.elements).forEach(i=>{this.playSequence(i.id,t)})}stopAll(){this.activeSequences.clear(),yi(!1),At.setForceTicker(!1),p.elements.forEach(t=>{this.stopSequence(t.id)})}runStep(t,e,o,i){if(o>=e.length){i?.();return}const s=e[o],r=o+1,a=()=>{s.restoreAfter&&p.elements.find(u=>u.id===t)&&c&&Z(t,c,!1);let d=r;for(;d<e.length&&e[d].trigger==="with-prev";)d++;d<e.length?this.runStep(t,e,d,i):i?.()};let c=null;if(s.restoreAfter){const d=p.elements.find(h=>h.id===t);d&&(c={...d})}let l=r;for(;l<e.length;){const d=e[l];if(d.trigger==="with-prev")this.executeAnimation(t,d,()=>{d.restoreAfter}),l++;else break}this.executeAnimation(t,s,a)}playAnimation(t,e,o){this.executeAnimation(t,e,o)}executeAnimation(t,e,o){const i={duration:e.duration,delay:e.delay,easing:e.easing,onComplete:o,params:e.params,loop:e.repeat===-1,loopCount:e.repeat!==-1&&(e.repeat||0)>0?e.repeat:void 0,alternate:e.yoyo};if(e.type==="preset"){const s=Ed[e.name];typeof s=="function"?s(t,e.duration,i):(console.warn(`Unknown preset: ${e.name}`),o())}else e.type==="property"?this.animateProperty(t,e,i):e.type==="rotate"?this.animateRotate(t,e,i):e.type==="autoSpin"?this.animateAutoSpin(t,e,i):e.type==="path"?Cr(t,e.pathData,{...i,orientToPath:e.orientToPath,isRelative:e.isRelative}):e.type==="morph"&&ll(t,e.targetShape,i)}animateRotate(t,e,o){const i=p.elements.find(r=>r.id===t);if(!i){o.onComplete?.();return}const s=e.relative?(i.angle||0)+e.toAngle*Math.PI/180:e.toAngle*Math.PI/180;K(t,{angle:s},o)}animateAutoSpin(t,e,o){const i=p.elements.find(d=>d.id===t);if(!i){o.onComplete?.();return}const s=i.angle||0,r=e.direction==="counterclockwise"?-1:1,a=e.iterations==="infinite"?1/0:e.iterations||1,c=r*Math.PI*2,l={...o};if(a===1/0){l.loop=!0,l.loopCount=1/0,l.duration=o.duration||1e3;const d=o.onComplete;setTimeout(()=>{d?.()},0);const h=s+c;K(t,{angle:h},{...l,onComplete:void 0})}else{const d=c*a,h=s+d;if(a>1&&o.duration){l.loop=!0,l.loopCount=a,l.duration=o.duration/a;const u=s+c;K(t,{angle:u},l)}else K(t,{angle:h},l)}}animateProperty(t,e,o){const i={},s=e.to;e.property==="opacity"||e.property==="x"||e.property==="y"||e.property==="width"||e.property==="height"||e.property==="angle"||e.property==="strokeWidth"||e.property==="roughness"?i[e.property]=Number(s):(e.property==="strokeColor"||e.property==="backgroundColor")&&(i[e.property]=String(s)),K(t,i,o)}}const Yi=new Rd,Ad=(n,t,e)=>{const o=e[n];if(!o)return[];const{x:i,y:s}=o.spatialPosition,{width:r,height:a}=o.dimensions;return t.filter(c=>{const l=c.x+(c.width||0)/2,d=c.y+(c.height||0)/2;return l>=i&&l<=i+r&&d>=s&&d<=s+a})};class Dd{buildSequence=[];isPlaying=!1;init(t){this.reset();const e=Ad(t,p.elements,p.slides),o=[];e.forEach(i=>{i.animations&&i.animations.length>0&&i.animations.forEach(s=>{o.push({elementId:i.id,animation:s,played:!1})})}),console.log(`[BuildManager] Initialized for slide ${t}. Found ${o.length} total animations.`),o.forEach(i=>console.log(`  - Element ${i.elementId}: ${i.animation.type} (trigger: ${i.animation.trigger})`)),this.buildSequence=o.sort((i,s)=>{const r=e.find(c=>c.id===i.elementId),a=e.find(c=>c.id===s.elementId);if(r.layerId!==a.layerId){const c=p.layers.find(d=>d.id===r.layerId),l=p.layers.find(d=>d.id===a.layerId);return(c?.order??0)-(l?.order??0)}return i.elementId===s.elementId?(r.animations?.indexOf(i.animation)??0)-(a.animations?.indexOf(s.animation)??0):i.elementId.localeCompare(s.elementId)}),console.log(`[BuildManager] Initialized with ${this.buildSequence.length} steps for slide ${t}`)}reset(){this.buildSequence=[],this.isPlaying=!1,Yi.stopAll()}playInitial(){p.appMode==="presentation"&&this.buildSequence.forEach((t,e)=>{t.animation.trigger==="on-load"&&!t.played&&this.executeStep(e)})}hasMoreSteps(){return this.buildSequence.some(t=>!t.played&&t.animation.trigger==="on-click")}async playNext(){if(this.isPlaying)return console.log("[BuildManager] Already playing, ignoring click"),!0;const t=this.buildSequence.findIndex(e=>!e.played&&e.animation.trigger==="on-click");return t===-1?(console.log("[BuildManager] No more on-click steps found"),!1):(console.log(`[BuildManager] Executing on-click step ${t}`),this.isPlaying=!0,await this.executeStep(t),this.isPlaying=!1,!0)}executeStep(t){const e=this.buildSequence[t];return!e||e.played?Promise.resolve():(e.played=!0,new Promise(o=>{const i=()=>{this.triggerAfterPrev(t).then(o)};Yi.playAnimation(e.elementId,e.animation,i),this.triggerWithPrev(t)}))}triggerWithPrev(t){let e=t+1;for(;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="with-prev";)this.executeStep(e),e++}async triggerAfterPrev(t){let e=t+1;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="after-prev"&&await this.executeStep(e)}}const In=new Dd,Od={rectangle:"rect",circle:"circ",triangle:"tria",diamond:"diam",hexagon:"hexa",octagon:"octa",parallelogram:"para",arrow:"arrw",line:"line",text:"text",image:"imag",ink:"ink_",laser:"lasr",group:"grup",slide:"slid",layer:"layr",star:"star",cloud:"clou",heart:"hear",cross:"cros",checkmark:"chck",capsule:"caps",stickyNote:"note",callout:"call",burst:"brst",speechBubble:"bubl",ribbon:"ribb",database:"data",document:"docu",server:"serv",user:"user",firewall:"fire",browser:"brow"},ge=n=>{let t=Od[n];t||(t=n.substring(0,4).toLowerCase()),t.length<4&&(t=t.padEnd(4,"_"));const e=`${t}-`;let o=0;return p.elements.forEach(i=>{if(i.id.startsWith(e)){const s=i.id.substring(e.length),r=parseInt(s,10);!isNaN(r)&&String(r)===s&&r>o&&(o=r)}}),`${e}${o+1}`},_d=(n,t,e)=>{const o=t.filter(h=>n.includes(h.id));if(o.length<2)return[];let i=1/0,s=1/0,r=-1/0,a=-1/0;o.forEach(h=>{i=Math.min(i,h.x),s=Math.min(s,h.y),r=Math.max(r,h.x+h.width),a=Math.max(a,h.y+h.height)});const c=i+(r-i)/2,l=s+(a-s)/2,d=[];return o.forEach(h=>{const u={};switch(e){case"left":u.x=i;break;case"center":u.x=c-h.width/2;break;case"right":u.x=r-h.width;break;case"top":u.y=s;break;case"middle":u.y=l-h.height/2;break;case"bottom":u.y=a-h.height;break}(u.x!==void 0||u.y!==void 0)&&d.push({id:h.id,updates:u})}),d},zd=(n,t,e)=>{const o=t.filter(a=>n.includes(a.id));if(o.length<3)return[];const i=[...o].sort((a,c)=>e==="horizontal"?a.x+a.width/2-(c.x+c.width/2):a.y+a.height/2-(c.y+c.height/2)),s=i[0],r=i[i.length-1];if(e==="horizontal"){const a=s.x+s.width/2,d=(r.x+r.width/2-a)/(i.length-1),h=[];return i.forEach((u,y)=>{if(y===0||y===i.length-1)return;const g=a+d*y-u.width/2;h.push({id:u.id,updates:{x:g}})}),h}else{const a=s.y+s.height/2,d=(r.y+r.height/2-a)/(i.length-1),h=[];return i.forEach((u,y)=>{if(y===0||y===i.length-1)return;const g=a+d*y-u.height/2;h.push({id:u.id,updates:{y:g}})}),h}},On=wr(),Mn={elements:On.elements,viewState:{scale:.5,panX:0,panY:0},layers:On.layers,activeLayerId:On.layers[0].id,gridSettings:On.gridSettings,canvasBackgroundColor:"#ffffff",dimensions:{width:1920,height:1080},slides:On.slides,activeSlideIndex:0,docType:"infinite",canvasTexture:"none",isPreviewing:!1,selectedTool:"selection",selectedUmlType:"umlClass",selection:[],flowTick:0,isRecording:!1,defaultElementStyles:{strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,renderStyle:"sketch",opacity:100,angle:0,roundness:null,locked:!1,fontSize:20,fontFamily:"hand-drawn",fontWeight:!1,fontStyle:!1,textAlign:"left",startArrowhead:null,endArrowhead:null,autoResize:!1,flowColor:void 0,seed:0,shadowEnabled:!1,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:10,shadowOffsetX:5,shadowOffsetY:5,gradientStart:"#ffffff",gradientEnd:"#000000",gradientDirection:45,smoothing:3,taperAmount:.15,velocitySensitivity:.5},toolStyles:{},theme:localStorage.getItem("theme")||"light",globalSettings:{animationEnabled:!0,reducedMotion:!1,renderStyle:"sketch",showMindmapToolbar:!0},showCanvasProperties:!1,undoStackLength:0,redoStackLength:0,showPropertyPanel:!1,showLayerPanel:!1,isPropertyPanelMinimized:!1,isLayerPanelMinimized:!1,minimapVisible:!1,zenMode:!1,appMode:"design",showCommandPalette:!1,selectedPenType:"fineliner",selectedShapeType:"triangle",selectedInfraType:"server",selectedMathType:"trapezoid",selectedSketchnoteType:"starPerson",selectedWireframeType:"browserWindow",layerGroupingModeEnabled:!1,maxLayers:20,selectedTechnicalType:"dfdProcess",states:[],showStatePanel:!1,showSlideNavigator:!0,showSlideToolbar:!0,showMainToolbar:!0,slideToolbarPosition:{x:window.innerWidth/2-150,y:window.innerHeight-80},showExportDialog:!1,showUtilityToolbar:!0,pathEditState:{isActive:!1,elementId:null,animationId:null}},[p,$]=rd(Mn),De=[],cn=[],Mt=()=>{const n={elements:JSON.parse(JSON.stringify(p.elements)),layers:JSON.parse(JSON.stringify(p.layers))};De.push(n),De.length>50&&De.shift(),cn.length=0,$("undoStackLength",De.length),$("redoStackLength",0)},ps=()=>{if(De.length===0)return;const n={elements:JSON.parse(JSON.stringify(p.elements)),layers:JSON.parse(JSON.stringify(p.layers))};cn.push(n);const t=De.pop();t&&($("elements",t.elements),$("layers",t.layers),$("selection",[])),$("undoStackLength",De.length),$("redoStackLength",cn.length)},Hi=()=>{if(cn.length===0)return;const n={elements:JSON.parse(JSON.stringify(p.elements)),layers:JSON.parse(JSON.stringify(p.layers))};De.push(n);const t=cn.pop();t&&($("elements",t.elements),$("layers",t.layers),$("selection",[])),$("undoStackLength",De.length),$("redoStackLength",cn.length)},sn=n=>{Mt(),$("elements",t=>[...t,n])},ys=n=>{const t=p.elements.find(c=>c.id===n);if(!t)return;Mt();const e=ge(t.type),o=150,s={...p.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:t.backgroundColor,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:e,type:t.type==="image"||t.type==="line"||t.type==="arrow"?"rectangle":t.type,x:t.x+t.width+o,y:t.y+0,width:t.width>0?t.width:100,height:t.height>0?t.height:60,layerId:p.activeLayerId,parentId:t.id,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},r={...p.defaultElementStyles,id:ge("arrow"),type:"arrow",x:t.x+t.width,y:t.y+t.height/2,width:o,height:0,layerId:p.activeLayerId,startBinding:{elementId:t.id,gap:5,position:"right",focus:0},endBinding:{elementId:e,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,o,0]},a=r.id;return $("elements",c=>[...c,s,r]),$("elements",c=>c.id===n,"boundElements",c=>[...c||[],{id:a,type:"arrow"}]),$("elements",c=>c.id===e,"boundElements",c=>[...c||[],{id:a,type:"arrow"}]),$("selection",[e]),e},gs=n=>{const t=p.elements.find(c=>c.id===n);if(!t)return;const e=t.parentId;if(!e)return;Mt();const o=ge(t.type),i=t.height+40,s={...p.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:o,type:t.type,x:t.x,y:t.y+i,width:t.width,height:t.height,layerId:p.activeLayerId,parentId:e,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},r={...p.defaultElementStyles,id:ge("arrow"),type:"arrow",x:t.x-150,y:t.y+i+t.height/2,width:150,height:0,layerId:p.activeLayerId,startBinding:{elementId:e,gap:5,position:"right",focus:0},endBinding:{elementId:o,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,150,0]},a=r.id;return $("elements",c=>[...c,s,r]),$("elements",c=>c.id===e,"boundElements",c=>[...c||[],{id:a,type:"arrow"}]),$("elements",c=>c.id===o,"boundElements",c=>[...c||[],{id:a,type:"arrow"}]),$("selection",[o]),o},cl=()=>{p.selection.length!==0&&(Mt(),$("elements",n=>p.selection.includes(n.id),n=>({isCollapsed:!n.isCollapsed})))},Hs=n=>{$("showCanvasProperties",n),n&&($("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1))},Qe=n=>{n.length!==0&&(Mt(),$("elements",t=>t.filter(e=>!n.includes(e.id))),$("selection",[]))},ms=n=>{n.length!==0&&(Mt(),$("elements",t=>{const e=t.filter(i=>n.includes(i.id));return[...t.filter(i=>!n.includes(i.id)),...e]}))},xs=n=>{n.length!==0&&(Mt(),$("elements",t=>{const e=t.filter(i=>n.includes(i.id)),o=t.filter(i=>!n.includes(i.id));return[...e,...o]}))},Bd=()=>{const n=p.elements.some(t=>t.flowAnimation);At.setForceTicker(n)},Z=(n,t,e=!1)=>{e&&Mt(),$("elements",o=>o.id===n,t),"flowAnimation"in t&&Bd()},Ns=(n,t,e,o=!1)=>{o&&Mt(),$("elements",i=>i.id===n,"animations",i=>i.id===t,e)},Hy=(n,t,e,o=!0)=>{const i=p.elements.find(l=>l.id===n);if(!i||!i.animations)return;const s=[...i.animations],r=s.findIndex(l=>l.id===t);if(r===-1)return;const a=e==="up"?r-1:r+1;if(a<0||a>=s.length)return;o&&Mt();const[c]=s.splice(r,1);s.splice(a,0,c),$("elements",l=>l.id===n,"animations",s)},dl=(n,t,e=!1)=>{p.selection.length!==0&&(e&&Mt(),$("elements",o=>p.selection.includes(o.id),o=>({x:o.x+n,y:o.y+t})))},ie=n=>{$("viewState",t=>({...t,...n}))},Et=n=>{const t=p.selectedTool;if(t!=="selection"){const e=JSON.parse(JSON.stringify(p.defaultElementStyles));$("toolStyles",t,e)}if($("selectedTool",n),n!=="selection"&&n!=="pan"&&n!=="eraser"&&$("selection",[]),n!=="selection"){const e=p.toolStyles[n];e&&je(e)}n==="arrow"?je({endArrowhead:"arrow"}):n==="line"&&je({endArrowhead:null}),je(n==="starPerson"||n==="scroll"||n==="wavyDivider"||n==="doubleBanner"||n==="lightbulb"||n==="signpost"||n==="burstBlob"||n==="browserWindow"||n==="mobilePhone"||n==="ghostButton"||n==="inputField"?{autoResize:!1}:{autoResize:!1})},je=n=>{$("defaultElementStyles",t=>({...t,...n}))},Ny=n=>{$("globalSettings",t=>({...t,...n})),n.renderStyle&&je({renderStyle:n.renderStyle})},Wd=(n,t=null,e=null)=>{$("pathEditState",{isActive:n,elementId:t,animationId:e}),n&&Bt("Path Edit Mode Active","info")},Xd=(n,t)=>{$("slides",n,"thumbnail",t)},ws=()=>{const n=p.activeSlideIndex;if(n<0||n>=p.slides.length)return;const t={backgroundColor:p.canvasBackgroundColor,dimensions:JSON.parse(JSON.stringify(p.dimensions)),thumbnail:p.slides[p.activeSlideIndex].thumbnail};$("slides",n,t)},We=async(n,t)=>{if(n<0||n>=p.slides.length||n===p.activeSlideIndex&&!So.transitioning)return;$("selection",[]),p.appMode==="presentation"&&!0?await So.transitionTo(n):await So.transitionTo(n,{skipAnimation:!0});const o=p.slides[n];o&&(o.backgroundColor&&$("canvasBackgroundColor",o.backgroundColor),$("dimensions",JSON.parse(JSON.stringify(o.dimensions))),p.appMode==="presentation"&&(In.init(n),In.playInitial())),Bt(`Slide ${n+1}`,"info")},bs=async()=>{if(p.states.findIndex(t=>t.id===p.activeStateId)<p.states.length-1){vs();return}if(In.hasMoreSteps()){await In.playNext();return}p.activeSlideIndex<p.slides.length-1&&await We(p.activeSlideIndex+1)},hl=async()=>{if(p.states.findIndex(t=>t.id===p.activeStateId)>0){Ss();return}p.activeSlideIndex>0&&await We(p.activeSlideIndex-1)},ul=()=>{ws();const n=p.slides.length,t=p.slides[p.slides.length-1],e=t?t.spatialPosition.x+2e3:0,o=cs(void 0,`Slide ${n+1}`,e,0);o.order=n,$("slides",i=>[...i,o]),We(n),Bt("Slide added","success")},Yd=n=>{if(n<0||n>=p.slides.length)return;Mt(),ws();const t=p.slides[n],{x:e,y:o}=t.spatialPosition,{width:i,height:s}=t.dimensions,r=p.elements.filter(m=>{const g=m.x+(m.width||0)/2,w=m.y+(m.height||0)/2;return g>=e&&g<=e+i&&w>=o&&w<=o+s}),c=p.slides.reduce((m,g)=>m.spatialPosition.x>g.spatialPosition.x?m:g).spatialPosition.x+2e3,l={x:c-e,y:0},d=new Map;r.forEach(m=>d.set(m.id,crypto.randomUUID()));const h=r.map(m=>{const g=d.get(m.id),w=JSON.parse(JSON.stringify(m));return w.id=g,w.x+=l.x,w.y+=l.y,w.seed=Math.floor(Math.random()*2147483647),w.startBinding&&d.has(w.startBinding.elementId)?w.startBinding.elementId=d.get(w.startBinding.elementId):w.startBinding&&(w.startBinding=void 0),w.endBinding&&d.has(w.endBinding.elementId)?w.endBinding.elementId=d.get(w.endBinding.elementId):w.endBinding&&(w.endBinding=void 0),w.boundElements&&(w.boundElements=w.boundElements.filter(x=>d.has(x.id)).map(x=>({...x,id:d.get(x.id)}))),w.parentId&&d.has(w.parentId)?w.parentId=d.get(w.parentId):w.parentId&&(w.parentId=void 0),w}),u={...JSON.parse(JSON.stringify(t)),id:crypto.randomUUID(),name:`${t.name} (Copy)`,spatialPosition:{x:c,y:0},order:n+1,thumbnail:void 0},y=[...p.slides];y.splice(n+1,0,u),y.forEach((m,g)=>m.order=g),Je(()=>{$("slides",y),$("elements",m=>[...m,...h]),We(n+1)}),Bt("Slide duplicated","success")},Hd=n=>{if(p.slides.length<=1){Bt("Cannot delete the last slide","error");return}const t=p.slides.filter((o,i)=>i!==n);t.forEach((o,i)=>o.order=i);let e=p.activeSlideIndex;e>=t.length&&(e=t.length-1),Je(()=>{$("slides",t),We(e)}),Bt("Slide deleted","info")},Nd=(n,t)=>{if(n===t)return;const e=[...p.slides],[o]=e.splice(n,1);e.splice(t,0,o),e.forEach((s,r)=>s.order=r);let i=p.activeSlideIndex;p.activeSlideIndex===n?i=t:n<p.activeSlideIndex&&t>=p.activeSlideIndex?i--:n>p.activeSlideIndex&&t<=p.activeSlideIndex&&i++,$("slides",e),$("activeSlideIndex",i)},Fd=(n,t)=>{if(n<0||n>=p.slides.length)return;const e=p.slides[n]?.transition||{...Gn};$("slides",n,"transition",{...e,...t})},rn=(n,t)=>{n<0||n>=p.slides.length||(typeof t=="string"?(t.startsWith("#")||t.startsWith("rgb")||t.startsWith("hsl")||t.startsWith("color(")||t.includes("display-p3"))&&($("slides",n,{backgroundColor:t,fillStyle:"solid"}),n===p.activeSlideIndex&&$("canvasBackgroundColor",t)):($("slides",n,t),n===p.activeSlideIndex&&t.backgroundColor&&$("canvasBackgroundColor",t.backgroundColor)))},Ni=n=>{Je(()=>{let t=[],e=[],o=[],i=n.gridSettings||Mn.gridSettings,s=n.states||[];if(n.version===4)t=n.elements,e=n.slides,o=n.layers,s=n.states||[],i=n.gridSettings||i;else if(n.version===3){o=n.slides[0]?.layers||Mn.layers;const a=2e3;n.slides.forEach((c,l)=>{const d=l*a,h=0,u=c.elements.map(y=>({...y,x:y.x+d,y:y.y+h}));t.push(...u),e.push({id:c.id,name:c.name,spatialPosition:{x:d,y:h},dimensions:c.dimensions||{width:1920,height:1080},order:l,backgroundColor:c.backgroundColor,thumbnail:c.thumbnail}),c.states&&s.push(...c.states)})}else t=n.elements||[],o=n.layers||Mn.layers,e=[cs()];e.forEach(a=>{a.transition||(a.transition={...Gn})}),$("elements",JSON.parse(JSON.stringify(t))),$("slides",JSON.parse(JSON.stringify(e))),$("layers",JSON.parse(JSON.stringify(o))),$("states",JSON.parse(JSON.stringify(s))),$("gridSettings",JSON.parse(JSON.stringify(i))),$("globalSettings",n.globalSettings||Mn.globalSettings);const r=n.metadata?.docType||(n.version>=3?"slides":"infinite");$("docType",r),$("showSlideNavigator",r==="slides"),$("showSlideToolbar",!0),$("showUtilityToolbar",!0),$("activeSlideIndex",0),$("selection",[]),o.some(a=>a.id===p.activeLayerId)||$("activeLayerId",o[0]?.id||"default-layer"),setTimeout(()=>qn(),100)}),pl()},Ud=n=>{Je(()=>{$("docType",n),$("showSlideNavigator",n==="slides")})},fl=n=>{$("showStatePanel",n??!p.showStatePanel)},Gd=n=>{const t=crypto.randomUUID(),e={};p.elements.forEach(i=>{e[i.id]={x:i.x,y:i.y,width:i.width,height:i.height,opacity:i.opacity,angle:i.angle,backgroundColor:i.backgroundColor,strokeColor:i.strokeColor,text:i.text}});const o={id:t,name:n,overrides:e};$("states",i=>[...i,o]),$("activeStateId",t),Bt(`State "${n}" captured`,"success")},qd=n=>{const t=p.states.findIndex(o=>o.id===n);if(t===-1)return;const e={};p.elements.forEach(o=>{e[o.id]={x:o.x,y:o.y,width:o.width,height:o.height,opacity:o.opacity,angle:o.angle,backgroundColor:o.backgroundColor,strokeColor:o.strokeColor,text:o.text}}),$("states",t,"overrides",e),Bt("State updated","success")},jd=n=>{$("states",t=>t.filter(e=>e.id!==n)),p.activeStateId===n&&$("activeStateId",void 0),Bt("State deleted","info")},io=async(n,t=!0)=>{const e=p.states.find(o=>o.id===n);if(e)if($("activeStateId",n),t){const{MorphAnimator:o}=await he(async()=>{const{MorphAnimator:i}=await import("./morph-animator-D09lTtCE.js");return{MorphAnimator:i}},__vite__mapDeps([0,1,2,3]),import.meta.url);o.morphTo(e)}else Je(()=>{Object.entries(e.overrides).forEach(([o,i])=>{Z(o,i,!1)})})},vs=async()=>{if(p.states.length===0)return;const t=(p.states.findIndex(e=>e.id===p.activeStateId)+1)%p.states.length;await io(p.states[t].id)},Ss=async()=>{if(p.states.length===0)return;let t=p.states.findIndex(e=>e.id===p.activeStateId)-1;t<0&&(t=p.states.length-1),await io(p.states[t].id)},pl=()=>{De.length=0,cn.length=0,$("undoStackLength",0),$("redoStackLength",0)},yl=(n="slides")=>{const t=wr("Untitled",n);Ni(t),$("showSlideToolbar",!0),$("showUtilityToolbar",!0),Bt(`New ${n==="slides"?"presentation":"sketch"} created`,"info")},gl=n=>{const t=p.elements.find(s=>s.id===n);if(!t)return;Mt();const e=ge(t.type),o=10/p.viewState.scale,i={...t,id:e,x:t.x+o,y:t.y+o,points:t.points?t.pointsEncoding==="flat"?[...t.points]:t.points.map(s=>({...s})):void 0,roundness:t.roundness?{...t.roundness}:null,crop:t.crop?{...t.crop}:null,boundElements:null,groupIds:t.groupIds?[...t.groupIds]:void 0,seed:Math.floor(Math.random()*2147483647)};$("elements",s=>[...s,i]),$("selection",[e])},ks=()=>{if(p.selection.length<2)return;Mt();const n=ge("group");$("elements",t=>p.selection.includes(t.id),"groupIds",t=>[...t||[],n])},Ms=()=>{if(p.selection.length===0)return;const n=new Set;p.elements.forEach(t=>{p.selection.includes(t.id)&&t.groupIds&&t.groupIds.length>0&&n.add(t.groupIds[t.groupIds.length-1])}),n.size!==0&&(Mt(),$("elements",t=>{if(!t.groupIds||t.groupIds.length===0)return!1;const e=t.groupIds[t.groupIds.length-1];return n.has(e)},"groupIds",t=>t&&t.slice(0,-1)))},Wo=(n,t)=>{const e=p.elements.findIndex(o=>o.id===n);e!==-1&&(Mt(),$("elements",o=>{const i=[...o],s=i.splice(e,1)[0];if(t==="front")i.push(s);else if(t==="back")i.unshift(s);else if(t==="forward"){const r=Math.min(i.length,e+1);i.splice(r,0,s)}else if(t==="backward"){const r=Math.max(0,e-1);i.splice(r,0,s)}return i}))},ml=()=>{const n=p.theme==="light"?"dark":"light";$("theme",n),localStorage.setItem("theme",n),document.documentElement.setAttribute("data-theme",n)},Ps=()=>{if(p.elements.length===0){$("viewState",{scale:1,panX:0,panY:0});return}let n=1/0,t=1/0,e=-1/0,o=-1/0;p.elements.forEach(w=>{n=Math.min(n,w.x),e=Math.max(e,w.x+w.width),t=Math.min(t,w.y),o=Math.max(o,w.y+w.height)});const i=e-n,s=o-t;if(i===0&&s===0){const w=n,x=t,b=window.innerWidth/2,S=window.innerHeight/2;$("viewState",{scale:1,panX:-w+b,panY:-x+S});return}const r=50,a=window.innerWidth,c=window.innerHeight,l=(a-r*2)/i,d=(c-r*2)/s;let h=Math.min(l,d);h=Math.min(Math.max(h,.1),2);const u=n+i/2,y=t+s/2,m=a/2,g=c/2;$("viewState",{scale:h,panX:-u*h+m,panY:-y*h+g})},xl=(n,t)=>{if(p.layers.length>=p.maxLayers){console.warn(`Layer limit reached (${p.maxLayers} layers max)`);return}Mt();const e=crypto.randomUUID(),o=Math.max(...p.layers.map(s=>s.order),-1),i={id:e,name:n||`Layer ${p.layers.length+1}`,visible:!0,locked:!1,opacity:1,order:o+1,backgroundColor:"transparent",colorTag:void 0,parentId:t,isGroup:!1,expanded:!0};return $("layers",[...p.layers,i]),$("activeLayerId",e),e},Qd=n=>{if(p.layers.length<=1){Bt("Cannot delete the last layer.","error");return}const t=p.layers.find(o=>o.id===n);if(!t)return;const e=p.elements.filter(o=>o.layerId===n);if(e.length>0){const o=confirm(`Layer "${t.name}" contains ${e.length} element(s).

Click "OK" to delete the layer AND all its elements.
Click "Cancel" to delete the layer but move elements to another layer.`);if(Mt(),o)$("elements",p.elements.filter(i=>i.layerId!==n));else{const i=p.layers.find(s=>s.id!==n);i&&p.elements.forEach((s,r)=>{s.layerId===n&&$("elements",r,"layerId",i.id)})}}else Mt();$("layers",p.layers.filter(o=>o.id!==n)),p.activeLayerId===n&&$("activeLayerId",p.layers[0]?.id||"default-layer")},Vd=(n,t)=>{const e=p.layers.findIndex(o=>o.id===n);e!==-1&&$("layers",e,t)},Jd=n=>{if(p.layers.length>=p.maxLayers){console.warn(`Layer limit reached (${p.maxLayers} layers max)`);return}const t=p.layers.find(a=>a.id===n);if(!t)return;Mt();const e=crypto.randomUUID(),o={...t,id:e,name:`${t.name} Copy`,opacity:t.opacity??1,order:t.order+.5,backgroundColor:t.backgroundColor||"transparent",parentId:t.parentId,isGroup:t.isGroup,expanded:t.expanded},s=p.elements.filter(a=>a.layerId===n).map(a=>({...a,id:crypto.randomUUID(),layerId:e,x:a.x+10,y:a.y+10}));$("layers",[...p.layers,o]),$("elements",[...p.elements,...s]),[...p.layers].sort((a,c)=>a.order-c.order).forEach((a,c)=>{const l=p.layers.findIndex(d=>d.id===a.id);$("layers",l,"order",c)}),$("activeLayerId",e)},Xo=(n,t)=>{if(n===t)return;Mt();const e=[...p.layers],[o]=e.splice(n,1);e.splice(t,0,o),e.forEach((i,s)=>{i.order=s}),$("layers",e)},$s=n=>{p.layers.find(e=>e.id===n)&&$("activeLayerId",n)},Kd=n=>{const e=[...p.layers].sort((o,i)=>o.order-i.order).reverse()[n];e&&$s(e.id)},Zd=n=>{const t=p.layers.findIndex(i=>i.id===n);if(t<=0)return;const e=p.layers[t],o=p.layers[t-1];Mt(),$("elements",i=>i.layerId===e.id,"layerId",o.id),$("layers",i=>i.filter(s=>s.id!==e.id)),p.activeLayerId===e.id&&$("activeLayerId",o.id)},th=()=>{if(p.layers.length<=1)return;Mt();const n=p.layers[0];$("elements",t=>t.layerId!==n.id,"layerId",n.id),$("layers",[n]),$("activeLayerId",n.id)},Ae=n=>{const t=p.layers.find(e=>e.id===n);return!t||t.visible===!1?!1:p.layerGroupingModeEnabled&&t.parentId?Ae(t.parentId):!0},Cs=n=>{const t=p.layers.find(e=>e.id===n);return t?t.locked?!0:p.layerGroupingModeEnabled&&t.parentId?Cs(t.parentId):t.locked||!1:!1},eh=n=>{p.layers.forEach((t,e)=>{t.id!==n?$("layers",e,"visible",!1):$("layers",e,"visible",!0)})},nh=()=>{p.layers.forEach((n,t)=>{$("layers",t,"visible",!0)})},ih=(n,t)=>{p.layers.find(o=>o.id===t)&&(Mt(),n.forEach(o=>{const i=p.elements.findIndex(s=>s.id===o);i!==-1&&$("elements",i,"layerId",t)}))},Ts=()=>{$("gridSettings","enabled",!p.gridSettings.enabled)},Is=()=>{$("gridSettings","snapToGrid",!p.gridSettings.snapToGrid)},Fy=n=>{$("gridSettings",n)},oh=n=>{$("canvasBackgroundColor",n)},sh=n=>{$("canvasTexture",n)},rh=n=>{$("selectedPenType",n)},ah=n=>{$("selectedShapeType",n)},lh=n=>{$("selectedInfraType",n)},ch=n=>{$("selectedMathType",n)},dh=n=>{$("selectedSketchnoteType",n)},hh=n=>{$("selectedWireframeType",n)},Uy=n=>{$("gridSettings","style",n)},Gy=n=>$("maxLayers",n),yi=n=>$("isPreviewing",n),$n=n=>{p.isPropertyPanelMinimized&&(n===void 0||n===!0)?($("isPropertyPanelMinimized",!1),$("showPropertyPanel",!0)):$("showPropertyPanel",n??!p.showPropertyPanel)},Fi=n=>{$("showLayerPanel",t=>n??!t)},wl=n=>{$("showSlideToolbar",t=>n??!t)},uh=(n,t)=>{$("slideToolbarPosition",{x:n,y:t})},Ei=n=>{$("showExportDialog",n)},bl=n=>{$("showUtilityToolbar",t=>n??!t)},qy=n=>{$("isPropertyPanelMinimized",t=>!t)},jy=n=>{$("isLayerPanelMinimized",t=>n??!t)},Qy=()=>{$("layerGroupingModeEnabled",n=>!n)},fh=n=>{Mt();const t=crypto.randomUUID(),e=Math.max(...p.layers.map(i=>i.order),-1),o={id:t,name:n||`Group ${p.layers.filter(i=>i.isGroup).length+1}`,visible:!0,locked:!1,opacity:1,order:e+1,backgroundColor:"transparent",isGroup:!0,expanded:!0};return $("layers",[...p.layers,o]),$("activeLayerId",t),t},ph=n=>{$("layers",t=>t.id===n,"expanded",t=>!t)},oo=n=>{$("minimapVisible",t=>n??!t)},Ls=n=>{$("zenMode",t=>n??!t)},Es=n=>{$("showSlideNavigator",t=>n??!t)},vl=n=>{$("showMainToolbar",t=>n??!t)},qn=()=>{const n=p.slides[p.activeSlideIndex];if(!n)return;const{width:t,height:e}=n.dimensions,{x:o,y:i}=n.spatialPosition,s=40,r=window.innerWidth-s*2,a=window.innerHeight-s*2,c=r/t,l=a/e,d=Math.min(c,l),h=(window.innerWidth-t*d)/2-o*d,u=(window.innerHeight-e*d)/2-i*d;$("viewState",{scale:d,panX:h,panY:u})},Ri=n=>{const t=p.appMode==="presentation",e=n??!t;Je(()=>{$("appMode",e?"presentation":"design"),e&&($("selection",[]),setTimeout(()=>{qn()},100),In.init(p.activeSlideIndex),In.playInitial())}),e?document.documentElement.requestFullscreen?.().catch(o=>{console.warn("Fullscreen failed:",o)}):document.fullscreenElement&&document.exitFullscreen?.()},yh=n=>{$("selectedTechnicalType",n)},gh=n=>{$("selectedUmlType",n)},Sl=n=>{$("showCommandPalette",t=>n??!t)};document.documentElement.setAttribute("data-theme",Mn.theme);const mh=n=>{if(p.selection.length<2)return;const t=_d(p.selection,p.elements,n);t.length>0&&(Mt(),$("elements",e=>t.some(o=>o.id===e.id),e=>{const o=t.find(i=>i.id===e.id)?.updates;return o?{...e,...o}:e}))},xh=()=>{if(p.selection.length===0){const n=["solid","dashed","dotted"],t=p.defaultElementStyles.strokeStyle||"solid",e=n[(n.indexOf(t)+1)%n.length];je({strokeStyle:e});return}Mt(),$("elements",n=>p.selection.includes(n.id),n=>{const t=["solid","dashed","dotted"],e=n.strokeStyle||"solid";return{strokeStyle:t[(t.indexOf(e)+1)%t.length]}})},wh=()=>{if(p.selection.length===0){const n=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],t=p.defaultElementStyles.fillStyle||"hachure",e=n[(n.indexOf(t)+1)%n.length];je({fillStyle:e});return}Mt(),$("elements",n=>p.selection.includes(n.id),n=>{const t=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],e=n.fillStyle||"hachure";return{fillStyle:t[(t.indexOf(e)+1)%t.length]}})},bh=n=>{if(p.selection.length<3)return;const t=zd(p.selection,p.elements,n);t.length>0&&(Mt(),$("elements",e=>t.some(o=>o.id===e.id),e=>{const o=t.find(i=>i.id===e.id)?.updates;return o?{...e,...o}:e}))},kl=n=>{pl(),$({elements:n.elements,layers:n.layers,activeLayerId:n.layers[0]?.id||"default-layer",viewState:n.viewState||{scale:1,panX:0,panY:0},gridSettings:n.gridSettings||p.gridSettings,globalSettings:n.globalSettings||p.globalSettings,canvasBackgroundColor:n.canvasBackgroundColor||p.canvasBackgroundColor,selection:[]})},Yo=n=>{const t=p.elements.find(e=>e.id===n);t&&Z(n,{isCollapsed:!t.isCollapsed},!0)},Ml=(n,t)=>{Z(n,{parentId:t},!0)},vh=n=>{Z(n,{parentId:null},!0)},vn=(n,t)=>{const e=new vr,o=e.buildTree(n,p.elements);if(!o)return;Mt(),t.startsWith("horizontal")?e.layoutHorizontal(o,t==="horizontal-right"?"right":"left"):t.startsWith("vertical")?e.layoutVertical(o,t==="vertical-down"?"down":"up"):t==="radial"&&e.layoutRadial(o);const i=e.getUpdates(o,p.elements),s=p.elements.map(r=>{const a=i.get(r.id);return a?{...r,...a}:r});$("elements",s),Bt(`Mindmap layout updated (${t})`,"success")},Pl=n=>{const t=new vr,e=t.buildTree(n,p.elements);if(!e)return;Mt(),t.applySemanticStyling(e,p.elements);const o=t.getUpdates(e,p.elements),i=p.elements.map(s=>{const r=o.get(s.id);return r?{...s,...r}:s});$("elements",i),Bt("Semantic styling applied to branch","success")};typeof window<"u"&&setInterval(()=>{const n=Date.now(),t=p.elements.filter(e=>e.ttl&&n>e.ttl).map(e=>e.id);t.length>0&&$("elements",e=>e.filter(o=>!t.includes(o.id)))},500);const Vy=(n,t)=>{if(!(!t||n===t)){if(p.elements.some(e=>e.id===t)){Bt("ID already exists","error");return}Mt(),$("elements",e=>e.map(o=>{if(o.id===n)return{...o,id:t};let i={};return o.parentId===n&&(i.parentId=t),o.orbitCenterId===n&&(i.orbitCenterId=t),o.startBinding?.elementId===n&&(i.startBinding={...o.startBinding,elementId:t}),o.endBinding?.elementId===n&&(i.endBinding={...o.endBinding,elementId:t}),Object.keys(i).length>0?{...o,...i}:o})),p.selection.includes(n)&&$("selection",e=>e.map(o=>o===n?t:o))}},$l=(n,t,e,o,i=new Set,s=!1)=>{if(o.has(n.id))return o.get(n.id);if(i.has(n.id))return{x:n.x,y:n.y,angle:n.angle||0,opacity:n.opacity||100};i.add(n.id);let r=n.x,a=n.y,c=n.angle||0;const l=n.orbitSpeed!==void 0?Number(n.orbitSpeed):1,d=n.orbitRadius!==void 0?Number(n.orbitRadius):150;if(n.orbitEnabled&&n.orbitCenterId&&!isNaN(d)&&!isNaN(l)){const y=e.get(n.orbitCenterId);if(y){const m=$l(y,t,e,o,i,s),g=Number(m.x)||0,w=Number(m.y)||0,x=Number(y.width)||0,b=Number(y.height)||0,S=g+x/2,P=w+b/2;if(s){const A=t*.001*l,B=S+d*Math.cos(A),X=P+d*Math.sin(A);r=B-(Number(n.width)||0)/2,a=X-(Number(n.height)||0)/2}}}const h=n.spinSpeed!==void 0?Number(n.spinSpeed):5;if(n.spinEnabled&&!isNaN(h)&&s){const y=t*.001;c+=y*(h*Math.PI/3)}isNaN(r)&&(r=n.x),isNaN(a)&&(a=n.y),isNaN(c)&&(c=n.angle||0);const u={x:r,y:a,angle:c,opacity:n.opacity||100};return o.set(n.id,u),i.delete(n.id),u},ko=(n,t,e=!1)=>{const o=new Map;n.forEach(r=>o.set(r.id,r));const i=new Map,s=new Set;return n.forEach(r=>{$l(r,t,o,i,s,e)}),i},Sn=(n,t,e)=>{if((n.type==="line"||n.type==="arrow")&&n.endBinding){const s=n.endBinding.elementId,r=e?e.get(s):t.find(a=>a.id===s);if(r&&Sn(r,t,e))return!0}if(!n.parentId)return!1;let o=n.parentId;const i=new Set;for(;o&&!i.has(o);){i.add(o);const s=o,r=e?e.get(s):t.find(a=>a.id===s);if(!r)break;if(r.isCollapsed)return!0;o=r.parentId||null}return!1},Mo=(n,t)=>{const e=[],o=[n],i=new Set;for(;o.length>0;){const s=o.shift();if(i.has(s))continue;i.add(s);const r=t.filter(a=>a.parentId===s);e.push(...r),o.push(...r.map(a=>a.id))}return e};class Sh{renderers=new Map;register(t,e){this.renderers.set(t,e)}getRenderer(t){return this.renderers.get(t)}}const Jt=new Sh,Ht=n=>{if(!n||n.length===0)return[];if(typeof n[0]=="number"){const t=[];for(let e=0;e<n.length-1;e+=2)t.push({x:n[e],y:n[e+1]});return t}return n},gi=(n,t,e,o,i)=>{const s=1-i;return s*s*s*n+3*s*s*i*t+3*s*i*i*e+i*i*i*o},Xe=(n,t,e,o=!1,i=1)=>{const s=Jt.getRenderer(e.type);if(s){s.render({rc:n,ctx:t,element:e,isDarkMode:o,layerOpacity:i});return}console.warn(`No renderer registered for element type: ${e.type}`)},kh=(n,t)=>{let e=!1;for(let o=0,i=t.length-1;o<t.length;i=o++){const s=t[o].x,r=t[o].y,a=t[i].x,c=t[i].y;r>n.y!=c>n.y&&n.x<(a-s)*(n.y-r)/(c-r)+s&&(e=!e)}return e},Ho=(n,t,e)=>{const o=n.x,i=n.y,s=t.x,r=t.y,a=e.x,c=e.y,l=o-s,d=i-r,h=a-s,u=c-r,y=l*h+d*u,m=h*h+u*u;let g=-1;m!==0&&(g=y/m);let w,x;g<0?(w=s,x=r):g>1?(w=a,x=c):(w=s+g*h,x=r+g*u);const b=o-w,S=i-x;return Math.sqrt(b*b+S*S)},Ui=(n,t,e,o,i)=>{const s=1-i;return s*s*s*n+3*s*s*i*t+3*s*i*i*e+i*i*i*o},Mh=(n,t,e,o,i)=>{const s=3*(1-i)*(1-i)*(t.x-n.x)+6*(1-i)*i*(e.x-t.x)+3*i*i*(o.x-e.x),r=3*(1-i)*(1-i)*(t.y-n.y)+6*(1-i)*i*(e.y-t.y)+3*i*i*(o.y-e.y);return Math.atan2(r,s)},Fs=(n,t,e,o,i)=>{const r=Math.max(i*8,4),a=Math.max(i*2,2),c=[],l=[];for(let d=0;d<=20;d++){const h=d/20,u=Ui(n.x,e.x,o.x,t.x,h),y=Ui(n.y,e.y,o.y,t.y,h),m=Mh(n,e,o,t,h),w=(r+(a-r)*h)/2,x=Math.cos(m+Math.PI/2)*w,b=Math.sin(m+Math.PI/2)*w;c.push({x:u+x,y:y+b}),l.push({x:u-x,y:y-b})}return[...c,...l.reverse()]},Ph=(n,t,e,o,i=20)=>{const s=[];for(let r=0;r<=i;r++){const a=r/i;s.push({x:Ui(n.x,t.x,e.x,o.x,a),y:Ui(n.y,t.y,e.y,o.y,a)})}return s},mi=(n,t,e,o,i,s)=>{const r=Ph(t,e,o,i,20);return Ai(n,r,s)},Ai=(n,t,e)=>{if(t.length<2)return!1;for(let o=0;o<t.length-1;o++)if(Ho(n,t[o],t[o+1])<=e)return!0;return!1},$h=(n,t,e,o,i,s=0)=>{const r=Math.abs(o/2)+s,a=Math.abs(i/2)+s,c=t+o/2,l=e+i/2;return r<=0||a<=0?!1:Math.pow(n.x-c,2)/Math.pow(r,2)+Math.pow(n.y-l,2)/Math.pow(a,2)<=1},ye=(n,t,e,o,i)=>{const s=Math.cos(i),r=Math.sin(i);return{x:s*(n-e)-r*(t-o)+e,y:r*(n-e)+s*(t-o)+o}},Po=(n,t,e=0)=>{const o=n.x+n.width/2,i=n.y+n.height/2;if(n.type==="rectangle"||n.type==="image"||n.type==="text"){let s={x:t.x,y:t.y};n.angle&&(s=ye(t.x,t.y,o,i,-n.angle));const r=n.width,a=n.height,c=o-r/2-e,l=o+r/2+e,d=i-a/2-e,h=i+a/2+e,u=s.x-o,y=s.y-i;if(u===0&&y===0)return{x:o,y:i};let m=1/0;if(u!==0){const x=(c-o)/u;x>0&&(m=Math.min(m,x));const b=(l-o)/u;b>0&&(m=Math.min(m,b))}if(y!==0){const x=(d-i)/y;x>0&&(m=Math.min(m,x));const b=(h-i)/y;b>0&&(m=Math.min(m,b))}if(m===1/0)return null;const g=o+u*m,w=i+y*m;return n.angle?ye(g,w,o,i,n.angle):{x:g,y:w}}else if(n.type==="circle"){const s=n.width/2+e,r=n.height/2+e;let a={x:t.x,y:t.y};n.angle&&(a=ye(t.x,t.y,o,i,-n.angle));const c=a.x-o,l=a.y-i;if(c===0&&l===0)return null;const d=c*c/(s*s)+l*l/(r*r),h=1/Math.sqrt(d),u=o+c*h,y=i+l*h;return n.angle?ye(u,y,o,i,n.angle):{x:u,y}}else if(n.type==="diamond"){let s={x:t.x,y:t.y};n.angle&&(s=ye(t.x,t.y,o,i,-n.angle));const r=n.width/2+e,a=n.height/2+e,c=s.x-o,l=s.y-i;if(c===0&&l===0)return{x:o,y:i};const d=Math.atan2(l,c),h=Math.abs(Math.tan(d)),u=1/(1/r+h/a),y=o+(c>0?1:-1)*u,m=i+(c>0?1:-1)*u*Math.tan(d);return n.angle?ye(y,m,o,i,n.angle):{x:y,y:m}}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"||n.type==="cloud"||n.type==="heart"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="fineliner"||n.type==="inkbrush"||n.type==="marker"){let s={x:t.x,y:t.y};n.angle&&(s=ye(t.x,t.y,o,i,-n.angle));const r=n.width,a=n.height,c=o-r/2-e,l=o+r/2+e,d=i-a/2-e,h=i+a/2+e,u=s.x-o,y=s.y-i;if(u===0&&y===0)return{x:o,y:i};let m=1/0;if(u!==0){const x=(c-o)/u;x>0&&(m=Math.min(m,x));const b=(l-o)/u;b>0&&(m=Math.min(m,b))}if(y!==0){const x=(d-i)/y;x>0&&(m=Math.min(m,x));const b=(h-i)/y;b>0&&(m=Math.min(m,b))}if(m===1/0)return null;const g=o+u*m,w=i+y*m;return n.angle?ye(g,w,o,i,n.angle):{x:g,y:w}}return null};function Di(n){const t=n.x+n.width/2,e=n.y+n.height/2,o=n.width,i=n.height;let s=[];if(n.type==="rectangle"||n.type==="image"||n.type==="text"){const r=[{x:t-o/2,y:e-i/2,position:"top-left"},{x:t+o/2,y:e-i/2,position:"top-right"},{x:t-o/2,y:e+i/2,position:"bottom-left"},{x:t+o/2,y:e+i/2,position:"bottom-right"},{x:t,y:e-i/2,position:"top"},{x:t+o/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-o/2,y:e,position:"left"}];n.angle?s=r.map(a=>({...ye(a.x,a.y,t,e,n.angle),position:a.position})):s=r}else if(n.type==="circle"){const r=o/2,a=i/2,c=[{x:t,y:e-a,position:"top"},{x:t+r,y:e,position:"right"},{x:t,y:e+a,position:"bottom"},{x:t-r,y:e,position:"left"}];n.angle?s=c.map(l=>({...ye(l.x,l.y,t,e,n.angle),position:l.position})):s=c}else if(n.type==="diamond"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+o/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-o/2,y:e,position:"left"}];n.angle?s=r.map(a=>({...ye(a.x,a.y,t,e,n.angle),position:a.position})):s=r}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+o/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-o/2,y:e,position:"left"}];n.angle?s=r.map(a=>({...ye(a.x,a.y,t,e,n.angle),position:a.position})):s=r}else if(n.type==="cloud"||n.type==="heart"||n.type==="checkmark"||n.type==="cross"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"){const r=[{x:t,y:e-i/2,position:"top"},{x:t+o/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-o/2,y:e,position:"left"}];n.angle?s=r.map(a=>({...ye(a.x,a.y,t,e,n.angle),position:a.position})):s=r}else{const r=[{x:t,y:e-i/2,position:"top"},{x:t+o/2,y:e,position:"right"},{x:t,y:e+i/2,position:"bottom"},{x:t-o/2,y:e,position:"left"}];n.angle?s=r.map(a=>({...ye(a.x,a.y,t,e,n.angle),position:a.position})):s=r}return s}function Ch(n,t,e=15){const o=Di(n);let i=null,s=e;for(const r of o){const a=r.x-t.x,c=r.y-t.y,l=Math.sqrt(a*a+c*c);l<s&&(s=l,i=r)}return i}const $o=(n,t,e,o)=>{const i=[{x:n.x,y:n.y}],s=20;if(!e&&!o){const h=(n.x+t.x)/2;return i.push({x:h,y:n.y}),i.push({x:h,y:t.y}),i.push({x:t.x,y:t.y}),No(i)}const r=(h,u)=>u==="top"?{x:h.x,y:h.y-s}:u==="bottom"?{x:h.x,y:h.y+s}:u==="left"?{x:h.x-s,y:h.y}:u==="right"?{x:h.x+s,y:h.y}:h;let a=n;e&&(a=r(n,e),i.push(a));let c=t;o&&(c=r(t,o));const l=h=>h==="top"||h==="bottom",d=h=>h==="left"||h==="right";return l(o)?i.push({x:c.x,y:a.y}):d(o)?i.push({x:a.x,y:c.y}):l(e)?i.push({x:t.x,y:a.y}):d(e)?i.push({x:a.x,y:t.y}):Math.abs(t.y-n.y)>Math.abs(t.x-n.x)?i.push({x:a.x,y:t.y}):i.push({x:t.x,y:a.y}),o&&i.push(c),i.push({x:t.x,y:t.y}),No(i)},No=n=>{if(n.length<2)return n;const t=[n[0]];for(let e=1;e<n.length;e++){const o=t[t.length-1],i=n[e];if(!(Math.abs(o.x-i.x)<.1&&Math.abs(o.y-i.y)<.1)){if(t.length>=2){const s=t[t.length-2];if(Math.abs(s.x-o.x)<.1&&Math.abs(o.x-i.x)<.1||Math.abs(s.y-o.y)<.1&&Math.abs(o.y-i.y)<.1){t[t.length-1]=i;continue}}t.push(i)}}return t},Th=(n,t,e,o,i,s,r)=>{const l=e.filter(D=>{if(D.type==="line"||D.type==="arrow"||D.type==="text")return!1;const Q=Math.min(n.x,t.x)-100,ot=Math.max(n.x,t.x)+100,st=Math.min(n.y,t.y)-100,dt=Math.max(n.y,t.y)+100;return!(D.x>ot||D.x+D.width<Q||D.y>dt||D.y+D.height<st)});if(l.length===0)return $o(n,t,s,r);const d=new Set([n.x,t.x]),h=new Set([n.y,t.y]);l.forEach(D=>{const Q=D.x-15,ot=D.x+D.width+15,st=D.y-15,dt=D.y+D.height+15;d.add(Q),d.add(ot),h.add(st),h.add(dt),d.add(D.x+D.width/2),h.add(D.y+D.height/2)});const u=(D,Q)=>{Q&&(Q==="top"&&(d.add(D.x),h.add(D.y-20)),Q==="bottom"&&(d.add(D.x),h.add(D.y+20)),Q==="left"&&(d.add(D.x-20),h.add(D.y)),Q==="right"&&(d.add(D.x+20),h.add(D.y)))};u(n,s),u(t,r);const y=Array.from(d).sort((D,Q)=>D-Q),m=Array.from(h).sort((D,Q)=>D-Q),g=y.findIndex(D=>Math.abs(D-n.x)<.1),w=m.findIndex(D=>Math.abs(D-n.y)<.1),x=y.findIndex(D=>Math.abs(D-t.x)<.1),b=m.findIndex(D=>Math.abs(D-t.y)<.1);if(g===-1||w===-1||x===-1||b===-1)return $o(n,t,s,r);const S=[{gx:g,gy:w,g:0,h:Math.abs(n.x-t.x)+Math.abs(n.y-t.y),parent:null,dir:null}],P=new Set,A=(D,Q,ot)=>l.some(st=>st.id===ot?!1:D>st.x+1&&D<st.x+st.width-1&&Q>st.y+1&&Q<st.y+st.height-1),B=(D,Q,ot,st)=>{const dt=(D+ot)/2,ut=(Q+st)/2;return l.some(xt=>{const Xt=xt.id===o?.id||xt.id===i?.id?3:1;return dt>xt.x+Xt&&dt<xt.x+xt.width-Xt&&ut>xt.y+Xt&&ut<xt.y+xt.height-Xt})};let X=0;for(;S.length>0&&X<800;){X++,S.sort((ot,st)=>ot.g+ot.h-(st.g+st.h));const D=S.shift();if(D.gx===x&&D.gy===b){const ot=[];let st=D;for(;st;)ot.push({x:y[st.gx],y:m[st.gy]}),st=st.parent;return No(ot.reverse())}P.add(`${D.gx},${D.gy}`);const Q=[{dx:-1,dy:0,dir:"h",name:"left"},{dx:1,dy:0,dir:"h",name:"right"},{dx:0,dy:-1,dir:"v",name:"top"},{dx:0,dy:1,dir:"v",name:"bottom"}];for(const ot of Q){const st=D.gx+ot.dx,dt=D.gy+ot.dy;if(st<0||st>=y.length||dt<0||dt>=m.length||P.has(`${st},${dt}`))continue;const ut=Zt=>["top","bottom","left","right"].includes(Zt||"");if(D.gx===g&&D.gy===w&&ut(s)&&ot.name!==s)continue;if(st===x&&dt===b&&ut(r)){const Zt={top:"bottom",bottom:"top",left:"right",right:"left"}[r];if(ot.name!==Zt)continue}const xt=y[D.gx],Dt=m[D.gy],Xt=y[st],lt=m[dt];if(B(xt,Dt,Xt,lt))continue;const ft=Math.abs(Xt-xt)+Math.abs(lt-Dt),_t=D.dir&&D.dir!==ot.dir?100:0,zt=A(Xt,lt)?500:0,Kt=D.g+ft+_t+zt,Lt=S.find(Zt=>Zt.gx===st&&Zt.gy===dt);Lt?Kt<Lt.g&&(Lt.g=Kt,Lt.parent=D,Lt.dir=ot.dir):S.push({gx:st,gy:dt,g:Kt,h:Math.abs(Xt-t.x)+Math.abs(lt-t.y),parent:D,dir:ot.dir})}}return $o(n,t,s,r)};var Ih=nt("<div class=context-menu>"),Lh=nt("<span class=menu-item-icon style=font-size:20px;line-height:1>"),Eh=nt("<span class=menu-item-shortcut>"),Rh=nt("<span class=menu-item-arrow>"),Ah=nt("<button><span class=menu-item-check>"),Dh=nt("<div class=menu-item-wrapper style=position:relative>"),Oh=nt("<div class=context-menu-separator>"),_h=nt("<span class=menu-item-label>");const Cl=n=>{let t;const[e,o]=kt({x:n.x,y:n.y}),[i,s]=kt(null);hn(()=>{if(!n.parent){if(t){const d=t.getBoundingClientRect(),h=window.innerWidth,u=window.innerHeight;let y=n.x,m=n.y;n.x+d.width>h&&(y=h-d.width-10),n.y+d.height>u&&(m=u-d.height-10),o({x:y,y:m})}const c=d=>{d.target.closest(".context-menu")||n.onClose()},l=d=>{d.key==="Escape"&&n.onClose()};document.addEventListener("mousedown",c),document.addEventListener("keydown",l),oe(()=>{document.removeEventListener("mousedown",c),document.removeEventListener("keydown",l)})}});const r=(c,l)=>{c.disabled||c.separator||(c.submenu?s(i()===l?null:l):(c.onClick?.(),n.onClose()))},a=c=>{n.items[c].submenu?s(c):s(null)};return(()=>{var c=Ih(),l=t;return typeof l=="function"?Wt(l,c):t=c,Y(c,I(ze,{get each(){return n.items},children:(d,h)=>(()=>{var u=Dh();return u.addEventListener("mouseenter",()=>a(h())),Y(u,I(St,{get when(){return!d.separator},get fallback(){return Oh()},get children(){return[(()=>{var y=Ah(),m=y.firstChild;return y.$$click=()=>r(d,h()),Y(m,()=>d.checked?"":""),Y(y,I(St,{get when(){return d.icon},get fallback(){return(()=>{var g=_h();return Y(g,()=>d.label),g})()},get children(){var g=Lh();return Y(g,()=>d.icon),g}}),null),Y(y,I(St,{get when(){return d.shortcut},get children(){var g=Eh();return Y(g,()=>d.shortcut),g}}),null),Y(y,I(St,{get when(){return d.submenu},get children(){return Rh()}}),null),pt(g=>{var w=`context-menu-item ${d.disabled?"disabled":""} ${i()===h()?"active":""}`,x=d.disabled,b=d.tooltip||d.label;return w!==g.e&&Nt(y,g.e=w),x!==g.t&&(y.disabled=g.t=x),b!==g.a&&mt(y,"title",g.a=b),g},{e:void 0,t:void 0,a:void 0}),y})(),I(St,{get when(){return Cn(()=>!!d.submenu)()&&i()===h()},get children(){return I(Cl,{get x(){const y=t?.querySelector(`.menu-item-wrapper:nth-child(${h()+1}) button`)?.getBoundingClientRect();return y?y.right:0},get y(){const y=t?.querySelector(`.menu-item-wrapper:nth-child(${h()+1}) button`)?.getBoundingClientRect();return y?y.top:0},get items(){return d.submenu},get onClose(){return n.onClose},parent:!1,get gridColumns(){return d.gridColumns}})}})]}})),u})()})),pt(d=>{var h=n.parent?"100%":`${e().x}px`,u=n.parent?"0":`${e().y}px`,y=n.parent?"absolute":"fixed",m=n.parent?"-4px":"0",g=n.gridColumns?"grid":"block",w=n.gridColumns?`repeat(${n.gridColumns}, 1fr)`:void 0,x=n.gridColumns?"4px":void 0,b=n.gridColumns?"8px":void 0;return h!==d.e&&Yt(c,"left",d.e=h),u!==d.t&&Yt(c,"top",d.t=u),y!==d.a&&Yt(c,"position",d.a=y),m!==d.o&&Yt(c,"margin-left",d.o=m),g!==d.i&&Yt(c,"display",d.i=g),w!==d.n&&Yt(c,"grid-template-columns",d.n=w),x!==d.s&&Yt(c,"gap",d.s=x),b!==d.h&&Yt(c,"padding",d.h=b),d},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),c})()};ne(["click"]);const Us=(n,t)=>Math.round(n/t)*t,Co=(n,t,e)=>({x:Us(n,e),y:Us(t,e)}),To=new Map,xi=new Set;let Fo=null;const zh=n=>{Fo=n},Tl=n=>{if(To.has(n))return To.get(n);if(!xi.has(n)){xi.add(n);const t=new Image;t.src=n,t.onload=()=>{To.set(n,t),xi.delete(n),Fo&&Fo()},t.onerror=()=>{xi.delete(n)}}return null},Bh=(n,t,e,o,i)=>{const s=t.filter(P=>n.includes(P.id));if(s.length===0)return{dx:e,dy:o,guides:[]};const r=Math.min(...s.map(P=>P.x))+e,a=Math.max(...s.map(P=>P.x+P.width))+e,c=Math.min(...s.map(P=>P.y))+o,l=Math.max(...s.map(P=>P.y+P.height))+o,d=(r+a)/2,h=(c+l)/2,u=[r,d,a],y=[c,h,l],m=[];let g=0,w=0,x=i+1,b=i+1;const S=t.filter(P=>!n.includes(P.id)&&P.layerId===s[0].layerId);for(const P of S){const A=P.x,B=P.x+P.width,X=(A+B)/2,D=[A,X,B],Q=P.y,ot=P.y+P.height,st=(Q+ot)/2,dt=[Q,st,ot];for(const ut of u)for(const xt of D){const Dt=Math.abs(ut-xt);Dt<x&&(x=Dt,g=xt-ut)}for(const ut of y)for(const xt of dt){const Dt=Math.abs(ut-xt);Dt<b&&(b=Dt,w=xt-ut)}}if(x<=i)for(const P of S){const A=P.x,B=P.x+P.width,X=(A+B)/2,D=[A,X,B];for(const Q of u)for(const ot of D)Math.abs(Q+g-ot)<.1&&m.push({type:"vertical",coordinate:ot,elementIds:[P.id]})}if(b<=i)for(const P of S){const A=P.y,B=P.y+P.height,X=(A+B)/2,D=[A,X,B];for(const Q of y)for(const ot of D)Math.abs(Q+w-ot)<.1&&m.push({type:"horizontal",coordinate:ot,elementIds:[P.id]})}return{dx:e+(x<=i?g:0),dy:o+(b<=i?w:0),guides:m}},Wh=(n,t,e,o,i)=>{const s=t.filter(b=>n.includes(b.id));if(s.length===0)return{dx:e,dy:o,guides:[]};let r={minX:Math.min(...s.map(b=>b.x))+e,maxX:Math.max(...s.map(b=>b.x+b.width))+e,minY:Math.min(...s.map(b=>b.y))+o,maxY:Math.max(...s.map(b=>b.y+b.height))+o,centerX:0,centerY:0};r.centerX=(r.minX+r.maxX)/2,r.centerY=(r.minY+r.maxY)/2;const a=t.filter(b=>!n.includes(b.id)&&b.layerId===s[0].layerId).map(b=>({...b,minX:b.x,maxX:b.x+b.width,minY:b.y,maxY:b.y+b.height,centerX:b.x+b.width/2,centerY:b.y+b.height/2}));if(a.length<2)return{dx:e,dy:o,guides:[]};let c=0,l=0,d=i+1,h=i+1;const u=[],y=(b,S)=>Math.max(0,Math.min(b.maxY,S.maxY)-Math.max(b.minY,S.minY))>0;for(let b=0;b<a.length;b++){const S=a[b];if(y(r,S))for(let P=b+1;P<a.length;P++){const A=a[P];if(!y(r,A)||!y(S,A))continue;const B=[{id:"active",...r},S,A];B.sort((ut,xt)=>ut.minX-xt.minX);const[X,D,Q]=B,ot=D.minX-X.maxX,st=Q.minX-D.maxX;let dt=0;X.id==="active"?dt=D.minX-st-X.maxX:D.id==="active"?dt=(X.maxX+Q.minX)/2-D.centerX:Q.id==="active"&&(dt=D.maxX+ot-Q.minX),Math.abs(dt)<d&&(d=Math.abs(dt),c=dt),u.push({type:"gap",orientation:"horizontal",gap:(ot+st)/2,start:X.maxX,variableCoordinate:(X.centerY+D.centerY+Q.centerY)/3,elements:[X.id,D.id,Q.id],segments:[{from:X.maxX,to:D.minX},{from:D.maxX,to:Q.minX}],_correction:dt})}}const m=(b,S)=>Math.max(0,Math.min(b.maxX,S.maxX)-Math.max(b.minX,S.minX))>0;for(let b=0;b<a.length;b++){const S=a[b];if(m(r,S))for(let P=b+1;P<a.length;P++){const A=a[P];if(!m(r,A)||!m(S,A))continue;const B=[{id:"active",...r},S,A];B.sort((ut,xt)=>ut.minY-xt.minY);const[X,D,Q]=B,ot=D.minY-X.maxY,st=Q.minY-D.maxY;let dt=0;X.id==="active"?dt=D.minY-st-X.maxY:D.id==="active"?dt=(X.maxY+Q.minY)/2-D.centerY:Q.id==="active"&&(dt=D.maxY+ot-Q.minY),Math.abs(dt)<h&&(h=Math.abs(dt),l=dt),u.push({type:"gap",orientation:"vertical",gap:(ot+st)/2,start:X.maxY,variableCoordinate:(X.centerX+D.centerX+Q.centerX)/3,elements:[X.id,D.id,Q.id],segments:[{from:X.maxY,to:D.minY},{from:D.maxY,to:Q.minY}],_correction:dt})}}const g=d<=i?c:0,w=h<=i?l:0,x=u.filter(b=>b.orientation==="horizontal"?g!==0&&Math.abs(b._correction-g)<.1:w!==0&&Math.abs(b._correction-w)<.1);return x.forEach(b=>delete b._correction),{dx:e+g,dy:o+w,guides:x}};var Xh=nt('<div class=minimap-container><div class=minimap-header><span class=minimap-title>Navigator</span><button class=minimap-close title="Close minimap (Alt+M)"></button></div><canvas width=200 height=150 class=minimap-canvas>');const Yh=n=>{let t,e,o=!1;const i=200,s=150,r=10,a=()=>{if(p.elements.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800,width:1e3,height:800};let m=1/0,g=1/0,w=-1/0,x=-1/0;p.elements.forEach(S=>{m=Math.min(m,S.x),w=Math.max(w,S.x+S.width),g=Math.min(g,S.y),x=Math.max(x,S.y+S.height)});const b=50;return m-=b,g-=b,w+=b,x+=b,{minX:m,minY:g,maxX:w,maxY:x,width:w-m,height:x-g}},c=m=>{const g=(i-r*2)/m.width,w=(s-r*2)/m.height;return Math.min(g,w)},l=m=>{if(!t)return;const g=t.getContext("2d");if(!g)return;const w=a(),x=c(w);g.clearRect(0,0,i,s);const b=p.theme==="dark";let S=p.canvasBackgroundColor;S||(S=b?"#121212":"#fafafa"),g.fillStyle=S,g.fillRect(0,0,i,s),g.save(),g.translate(r,r),g.scale(x,x),g.translate(-w.minX,-w.minY),p.elements.forEach(dt=>{const ut=p.layers.find(xt=>xt.id===dt.layerId);ut?.visible&&Xe(m,g,dt,p.theme==="dark",ut?.opacity??1)}),g.restore();const P=-p.viewState.panX/p.viewState.scale,A=-p.viewState.panY/p.viewState.scale,B=n.canvasWidth/p.viewState.scale,X=n.canvasHeight/p.viewState.scale,D=(P-w.minX)*x+r,Q=(A-w.minY)*x+r,ot=B*x,st=X*x;g.save(),g.strokeStyle=p.theme==="dark"?"#60a5fa":"#3b82f6",g.lineWidth=2,g.fillStyle=p.theme==="dark"?"rgba(96, 165, 250, 0.1)":"rgba(59, 130, 246, 0.1)",g.fillRect(D,Q,ot,st),g.strokeRect(D,Q,ot,st),g.restore()},d=m=>{if(o)return;const g=t?.getBoundingClientRect();if(!g)return;const w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=c(b),P=(w-r)/S+b.minX,A=(x-r)/S+b.minY;ie({panX:-P*p.viewState.scale+n.canvasWidth/2,panY:-A*p.viewState.scale+n.canvasHeight/2})},h=m=>{if(!t)return;const g=t.getBoundingClientRect(),w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=c(b),P=-p.viewState.panX/p.viewState.scale,A=-p.viewState.panY/p.viewState.scale,B=n.canvasWidth/p.viewState.scale,X=n.canvasHeight/p.viewState.scale,D=(P-b.minX)*S+r,Q=(A-b.minY)*S+r,ot=B*S,st=X*S;w>=D&&w<=D+ot&&x>=Q&&x<=Q+st&&(o=!0,t.setPointerCapture(m.pointerId))},u=m=>{if(!o||!t)return;const g=t.getBoundingClientRect(),w=m.clientX-g.left,x=m.clientY-g.top,b=a(),S=c(b),P=(w-r)/S+b.minX,A=(x-r)/S+b.minY;ie({panX:-P*p.viewState.scale+n.canvasWidth/2,panY:-A*p.viewState.scale+n.canvasHeight/2})},y=m=>{o&&t&&(t.releasePointerCapture(m.pointerId),o=!1)};return Vt(()=>{if(!t)return;const m=Nn.canvas(t);p.elements.forEach(x=>{if(x.points?.length,x.x,x.y,x.width,x.height,x.opacity,x.layerId,x.strokeColor,x.backgroundColor,x.renderStyle,x.points){const b=Ht(x.points);if(b.length>0){const S=b[b.length-1];S.x,S.y}}}),p.viewState.panX,p.viewState.panY,p.viewState.scale,p.theme,p.layers.forEach(x=>{x.visible,x.opacity});const w=requestAnimationFrame(()=>l(m));oe(()=>cancelAnimationFrame(w))}),hn(()=>{if(t&&(t.addEventListener("click",d),t.addEventListener("pointerdown",h),t.addEventListener("pointermove",u),t.addEventListener("pointerup",y),t.addEventListener("pointercancel",y)),oe(()=>{t&&(t.removeEventListener("click",d),t.removeEventListener("pointerdown",h),t.removeEventListener("pointermove",u),t.removeEventListener("pointerup",y),t.removeEventListener("pointercancel",y))}),t){const m=Nn.canvas(t);l(m)}}),(()=>{var m=Xh(),g=m.firstChild,w=g.firstChild,x=w.nextSibling,b=g.nextSibling,S=e;typeof S=="function"?Wt(S,m):e=m,x.$$click=()=>oo(!1),Y(x,I(is,{size:14}));var P=t;return typeof P=="function"?Wt(P,b):t=b,m})()};ne(["click"]);const so=async()=>{if(p.selection.length===0)return;const t={type:"yappy-elements",elements:p.elements.filter(e=>p.selection.includes(e.id))};try{await navigator.clipboard.writeText(JSON.stringify(t))}catch(e){console.error("Failed to copy: ",e)}},Rs=async()=>{await so(),Qe(p.selection)},Gi=async()=>{try{const n=await navigator.clipboard.readText();if(!n)return;const t=JSON.parse(n);if(t.type==="yappy-elements"&&Array.isArray(t.elements)){Mt();const e=[],o=-p.viewState.panX/p.viewState.scale+window.innerWidth/2/p.viewState.scale,i=-p.viewState.panY/p.viewState.scale+window.innerHeight/2/p.viewState.scale;let s=1/0,r=1/0,a=-1/0,c=-1/0;t.elements.forEach(y=>{s=Math.min(s,y.x),r=Math.min(r,y.y),a=Math.max(a,y.x+y.width),c=Math.max(c,y.y+y.height)});const l=s+(a-s)/2,d=r+(c-r)/2,h=o-l,u=i-d;t.elements.forEach(y=>{const m=ge(y.type),g={...y,id:m,x:y.x+h,y:y.y+u,layerId:p.activeLayerId,groupIds:[]};$("elements",w=>[...w,g]),e.push(m)}),$("selection",e)}}catch(n){console.error("Failed to paste: ",n)}},Gs=n=>{if(p.selection.length===0)return;Mt();let t=1/0,e=-1/0;p.elements.forEach(i=>{p.selection.includes(i.id)&&(n==="horizontal"?(t=Math.min(t,i.x),e=Math.max(e,i.x+i.width)):(t=Math.min(t,i.y),e=Math.max(e,i.y+i.height)))});const o=t+(e-t)/2;p.selection.forEach(i=>{const s=p.elements.find(r=>r.id===i);if(s)if(n==="horizontal"){const a=s.x+s.width/2-o,c=o-a-s.width/2;if(s.points){const l=Ht(s.points);if(l.length>0){const d=l.map(h=>({x:s.width-h.x,y:h.y}));Z(i,{x:c,points:d,pointsEncoding:void 0,seed:s.seed+1},!1)}else(!s.points||s.points.length===0)&&Z(i,{x:c,seed:s.seed+1},!1)}else Z(i,{x:c,seed:s.seed+1},!1)}else{const a=s.y+s.height/2-o,c=o-a-s.height/2;if(s.points){const l=Ht(s.points);if(l.length>0){const d=l.map(h=>({x:h.x,y:s.height-h.y}));Z(i,{y:c,points:d,pointsEncoding:void 0,seed:s.seed+1},!1)}else Z(i,{y:c,seed:s.seed+1},!1)}else Z(i,{y:c,seed:s.seed+1},!1)}})},Hh=n=>{p.selection.forEach(t=>{Z(t,{locked:n})})};let Uo=null;const As=()=>{if(p.selection.length!==1)return;const n=p.elements.find(t=>t.id===p.selection[0]);n&&(Uo={strokeColor:n.strokeColor,backgroundColor:n.backgroundColor,fillStyle:n.fillStyle,strokeWidth:n.strokeWidth,strokeStyle:n.strokeStyle,roughness:n.roughness,opacity:n.opacity,fontFamily:n.fontFamily,fontSize:n.fontSize,textAlign:n.textAlign,roundness:n.roundness,gradientStart:n.gradientStart,gradientEnd:n.gradientEnd,gradientDirection:n.gradientDirection,gradientStops:n.gradientStops?JSON.parse(JSON.stringify(n.gradientStops)):void 0,gradientType:n.gradientType,gradientHandlePositions:n.gradientHandlePositions?JSON.parse(JSON.stringify(n.gradientHandlePositions)):void 0,shadowEnabled:n.shadowEnabled,shadowColor:n.shadowColor,shadowBlur:n.shadowBlur,shadowOffsetX:n.shadowOffsetX,shadowOffsetY:n.shadowOffsetY,drawInnerBorder:n.drawInnerBorder,innerBorderColor:n.innerBorderColor,innerBorderDistance:n.innerBorderDistance,strokeLineJoin:n.strokeLineJoin,fillDensity:n.fillDensity,renderStyle:n.renderStyle,flowAnimation:n.flowAnimation,flowSpeed:n.flowSpeed,flowStyle:n.flowStyle})},Ds=()=>{!Uo||p.selection.length===0||(Mt(),p.selection.forEach(n=>{Z(n,Uo)}))};class Nh{frameCount=0;lastReportTime=0;slowFrames=0;totalDrawTime=0;enabled;constructor(t=!0){this.enabled=t,this.lastReportTime=performance.now()}measureFrame(t,e,o){if(!this.enabled)return;this.frameCount++,this.totalDrawTime+=t,t>16.67&&this.slowFrames++;const i=performance.now();if(i-this.lastReportTime>=1e3){const s=i-this.lastReportTime,r=this.frameCount/s*1e3,a=this.totalDrawTime/this.frameCount,c=o!==void 0?` | ${o} visible`:"";console.log(`[Perf] ${r.toFixed(1)} FPS | ${a.toFixed(2)}ms avg | ${e} elements${c} | ${this.slowFrames} slow frames`),this.frameCount=0,this.slowFrames=0,this.totalDrawTime=0,this.lastReportTime=i}}setEnabled(t){this.enabled=t}}const Fh=new Nh(!1),ro=n=>{const t=n.fontSize||20,e=n.fontFamily==="sans-serif"?"Inter, sans-serif":n.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",o=n.fontWeight?typeof n.fontWeight=="string"?n.fontWeight+" ":"bold ":"";return`${n.fontStyle?typeof n.fontStyle=="string"?n.fontStyle+" ":"italic ":""}${o}${t}px ${e}`};let Io=null;const Uh=()=>(Io||(Io=document.createElement("canvas").getContext("2d")),Io),Gh=(n,t,e)=>{const o=t.split(/\s+/),i=[];let s="";for(const r of o){if(!r)continue;const a=s?`${s} ${r}`:r;n.measureText(a).width>e&&s?(i.push(s),s=r):s=a}return s&&i.push(s),i},ve=(n,t,e,o)=>{const i=t.fontSize||20;n.save(),n.font=ro(t);let s=o;t.type==="circle"||t.type==="diamond"?s=o*.707:t.type==="doubleBanner"?s=o*.65:t.type==="lightbulb"?s=o*.7:t.type==="signpost"?s=o*.8:t.type==="burstBlob"&&(s=o*.6);const r=e.split(`
`),a=[];r.forEach(d=>{if(d==="")a.push("");else{const h=Gh(n,d,s);a.push(...h)}});const c=i*1.2;let l=0;return a.forEach(d=>{l=Math.max(l,n.measureText(d).width)}),n.restore(),{textWidth:l,textHeight:a.length*c,lines:a,lineHeight:c}},qs=(n,t,e)=>{if(!e||e.trim()==="")return{width:t.width||100,height:t.height||60};const o=32,i=t.fontSize||20,s=e.length,r=Math.sqrt(s*i*i*1.5);let a=Math.max(60,Math.min(500,r)),c=ve(n,t,e,a);const l=t.type==="circle"||t.type==="diamond"?.707:t.type==="doubleBanner"?.65:t.type==="lightbulb"?.7:t.type==="signpost"?.8:t.type==="burstBlob"?.6:1;let d=c.textWidth/l+o,h=c.textHeight/l+o;if(t.type==="circle"||t.type==="diamond"){const u=Math.max(d,h);return{width:u,height:u}}return(t.type==="parallelogram"||t.type==="trapezoid")&&(d+=40),{width:d,height:h}},js=(n,t,e=!0)=>{const o=p.elements.find(c=>c.id===n);if(!o||o.type===t)return;const i=c=>["line","arrow","bezier","organicBranch"].includes(c),s=i(o.type),r=i(t);if(s!==r){console.warn(`Cannot transform ${o.type} to ${t}: Incompatible families.`);return}const a={type:t};if(r)if(t==="bezier"||t==="organicBranch"){if(a.curveType="bezier",!o.controlPoints||o.controlPoints.length!==2){const c=o.x,l=o.y,d=o.x+o.width,h=o.y+o.height,u=d-c,y=h-l,m={x:c+u*.25,y:l+y*.1},g={x:d-u*.25,y:h-y*.1};a.controlPoints=[m,g]}}else(o.type==="bezier"||o.type==="organicBranch")&&(a.curveType="straight",a.controlPoints=void 0);Z(n,a,e)},Qs=n=>{const t=["line","arrow","bezier","organicBranch"],e=["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","cross","checkmark","capsule","stickyNote","callout","speechBubble","burst","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","mobilePhone","browserWindow"];return t.includes(n)?t.filter(o=>o!==n):e.includes(n)?e.filter(o=>o!==n):[]},Vs=n=>({line:"",arrow:"",bezier:"",organicBranch:"",straight:"",elbow:"",rectangle:"",circle:"",diamond:"",triangle:"",hexagon:"",octagon:"",parallelogram:"",star:"",cloud:"",heart:"",cross:"",checkmark:"",database:"",document:"",predefinedProcess:"",internalStorage:"",server:"",loadBalancer:"",firewall:"",user:"",messageQueue:"",lambda:"",router:"",browser:"",capsule:"",stickyNote:"",callout:"",speechBubble:"",burst:"",trapezoid:"",rightTriangle:"",pentagon:"",septagon:"",browserWindow:"",mobilePhone:""})[n]||"",Js=n=>n.charAt(0).toUpperCase()+n.slice(1).replace(/([A-Z])/g," $1"),qh=n=>["straight","bezier","elbow"].filter(t=>t!==n),jh=n=>({straight:"",bezier:"",elbow:""})[n]||"",Qh=n=>n.charAt(0).toUpperCase()+n.slice(1);function Vh(n,t){const e=t.filter(a=>a.groupIds&&a.groupIds.includes(n));if(e.length===0)return null;let o=1/0,i=1/0,s=-1/0,r=-1/0;return e.forEach(a=>{const c=a.x,l=a.y,d=a.x+a.width,h=a.y+a.height;o=Math.min(o,c),i=Math.min(i,l),s=Math.max(s,d),r=Math.max(r,h)}),{x:o,y:i,width:s-o,height:r-i}}function Jh(n,t,e,o){const i=Vh(e,o);return i?n>=i.x&&n<=i.x+i.width&&t>=i.y&&t<=i.y+i.height:!1}function Kh(n,t){const e=new Map;return n.forEach((o,i)=>{if(o.groupIds&&o.groupIds.length>0){const s=o.groupIds[o.groupIds.length-1];if(!e.has(s)){const r=t.find(a=>a.id===o.layerId);e.set(s,{layerOrder:r?.order??999,elementIndex:i})}}}),Array.from(e.entries()).map(([o,{layerOrder:i,elementIndex:s}])=>({groupId:o,layerOrder:i,elementIndex:s})).sort((o,i)=>o.layerOrder!==i.layerOrder?i.layerOrder-o.layerOrder:i.elementIndex-o.elementIndex)}function Go(n,t,e){if(n&&n.length){const[o,i]=t,s=Math.PI/180*e,r=Math.cos(s),a=Math.sin(s);for(const c of n){const[l,d]=c;c[0]=(l-o)*r-(d-i)*a+o,c[1]=(l-o)*a+(d-i)*r+i}}}function Zh(n,t,e){const o=[];n.forEach(i=>o.push(...i)),Go(o,t,e)}function tu(n,t){return n[0]===t[0]&&n[1]===t[1]}function eu(n,t,e,o=1){const i=e,s=Math.max(t,.1),r=n[0]&&n[0][0]&&typeof n[0][0]=="number"?[n]:n,a=[0,0];if(i)for(const l of r)Go(l,a,i);const c=nu(r,s,o);if(i){for(const l of r)Go(l,a,-i);Zh(c,a,-i)}return c}function nu(n,t,e){const o=[];for(const l of n){const d=[...l];tu(d[0],d[d.length-1])||d.push([d[0][0],d[0][1]]),d.length>2&&o.push(d)}const i=[];t=Math.max(t,.1);const s=[];for(const l of o)for(let d=0;d<l.length-1;d++){const h=l[d],u=l[d+1];if(h[1]!==u[1]){const y=Math.min(h[1],u[1]);s.push({ymin:y,ymax:Math.max(h[1],u[1]),x:y===h[1]?h[0]:u[0],islope:(u[0]-h[0])/(u[1]-h[1])})}}if(s.sort((l,d)=>l.ymin<d.ymin?-1:l.ymin>d.ymin?1:l.x<d.x?-1:l.x>d.x?1:l.ymax===d.ymax?0:(l.ymax-d.ymax)/Math.abs(l.ymax-d.ymax)),!s.length)return i;let r=[],a=s[0].ymin,c=0;for(;r.length||s.length;){if(s.length){let l=-1;for(let h=0;h<s.length&&!(s[h].ymin>a);h++)l=h;s.splice(0,l+1).forEach(h=>{r.push({s:a,edge:h})})}if(r=r.filter(l=>!(l.edge.ymax<=a)),r.sort((l,d)=>l.edge.x===d.edge.x?0:(l.edge.x-d.edge.x)/Math.abs(l.edge.x-d.edge.x)),(e!==1||c%t===0)&&r.length>1)for(let l=0;l<r.length;l=l+2){const d=l+1;if(d>=r.length)break;const h=r[l].edge,u=r[d].edge;i.push([[Math.round(h.x),a],[Math.round(u.x),a]])}a+=e,r.forEach(l=>{l.edge.x=l.edge.x+e*l.edge.islope}),c++}return i}function ei(n,t){var e;const o=t.hachureAngle+90;let i=t.hachureGap;i<0&&(i=t.strokeWidth*4),i=Math.round(Math.max(i,.1));let s=1;return t.roughness>=1&&(((e=t.randomizer)===null||e===void 0?void 0:e.next())||Math.random())>.7&&(s=i),eu(n,i,o,s||1)}class Os{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const o=ei(t,e);return{type:"fillSketch",ops:this.renderLines(o,e)}}renderLines(t,e){const o=[];for(const i of t)o.push(...this.helper.doubleLineOps(i[0][0],i[0][1],i[1][0],i[1][1],e));return o}}function ao(n){const t=n[0],e=n[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}class iu extends Os{fillPolygons(t,e){let o=e.hachureGap;o<0&&(o=e.strokeWidth*4),o=Math.max(o,.1);const i=Object.assign({},e,{hachureGap:o}),s=ei(t,i),r=Math.PI/180*e.hachureAngle,a=[],c=o*.5*Math.cos(r),l=o*.5*Math.sin(r);for(const[h,u]of s)ao([h,u])&&a.push([[h[0]-c,h[1]+l],[...u]],[[h[0]+c,h[1]-l],[...u]]);return{type:"fillSketch",ops:this.renderLines(a,e)}}}class ou extends Os{fillPolygons(t,e){const o=this._fillPolygons(t,e),i=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),s=this._fillPolygons(t,i);return o.ops=o.ops.concat(s.ops),o}}class su{constructor(t){this.helper=t}fillPolygons(t,e){e=Object.assign({},e,{hachureAngle:0});const o=ei(t,e);return this.dotsOnLines(o,e)}dotsOnLines(t,e){const o=[];let i=e.hachureGap;i<0&&(i=e.strokeWidth*4),i=Math.max(i,.1);let s=e.fillWeight;s<0&&(s=e.strokeWidth/2);const r=i/4;for(const a of t){const c=ao(a),l=c/i,d=Math.ceil(l)-1,h=c-d*i,u=(a[0][0]+a[1][0])/2-i/4,y=Math.min(a[0][1],a[1][1]);for(let m=0;m<d;m++){const g=y+h+m*i,w=u-r+Math.random()*2*r,x=g-r+Math.random()*2*r,b=this.helper.ellipse(w,x,s,s,e);o.push(...b.ops)}}return{type:"fillSketch",ops:o}}}class ru{constructor(t){this.helper=t}fillPolygons(t,e){const o=ei(t,e);return{type:"fillSketch",ops:this.dashedLine(o,e)}}dashedLine(t,e){const o=e.dashOffset<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashOffset,i=e.dashGap<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashGap,s=[];return t.forEach(r=>{const a=ao(r),c=Math.floor(a/(o+i)),l=(a+i-c*(o+i))/2;let d=r[0],h=r[1];d[0]>h[0]&&(d=r[1],h=r[0]);const u=Math.atan((h[1]-d[1])/(h[0]-d[0]));for(let y=0;y<c;y++){const m=y*(o+i),g=m+o,w=[d[0]+m*Math.cos(u)+l*Math.cos(u),d[1]+m*Math.sin(u)+l*Math.sin(u)],x=[d[0]+g*Math.cos(u)+l*Math.cos(u),d[1]+g*Math.sin(u)+l*Math.sin(u)];s.push(...this.helper.doubleLineOps(w[0],w[1],x[0],x[1],e))}}),s}}class au{constructor(t){this.helper=t}fillPolygons(t,e){const o=e.hachureGap<0?e.strokeWidth*4:e.hachureGap,i=e.zigzagOffset<0?o:e.zigzagOffset;e=Object.assign({},e,{hachureGap:o+i});const s=ei(t,e);return{type:"fillSketch",ops:this.zigzagLines(s,i,e)}}zigzagLines(t,e,o){const i=[];return t.forEach(s=>{const r=ao(s),a=Math.round(r/(2*e));let c=s[0],l=s[1];c[0]>l[0]&&(c=s[1],l=s[0]);const d=Math.atan((l[1]-c[1])/(l[0]-c[0]));for(let h=0;h<a;h++){const u=h*2*e,y=(h+1)*2*e,m=Math.sqrt(2*Math.pow(e,2)),g=[c[0]+u*Math.cos(d),c[1]+u*Math.sin(d)],w=[c[0]+y*Math.cos(d),c[1]+y*Math.sin(d)],x=[g[0]+m*Math.cos(d+Math.PI/4),g[1]+m*Math.sin(d+Math.PI/4)];i.push(...this.helper.doubleLineOps(g[0],g[1],x[0],x[1],o),...this.helper.doubleLineOps(x[0],x[1],w[0],w[1],o))}}),i}}const pe={};function lu(n,t){let e=n.fillStyle||"hachure";if(!pe[e])switch(e){case"zigzag":pe[e]||(pe[e]=new iu(t));break;case"cross-hatch":pe[e]||(pe[e]=new ou(t));break;case"dots":pe[e]||(pe[e]=new su(t));break;case"dashed":pe[e]||(pe[e]=new ru(t));break;case"zigzag-line":pe[e]||(pe[e]=new au(t));break;default:e="hachure",pe[e]||(pe[e]=new Os(t));break}return pe[e]}function cu(){return Math.floor(Math.random()*2**31)}class du{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const hu=0,qo=1,Il=2,wi={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function uu(n){const t=new Array;for(;n!=="";)if(n.match(/^([ \t\r\n,]+)/))n=n.substr(RegExp.$1.length);else if(n.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:hu,text:RegExp.$1},n=n.substr(RegExp.$1.length);else if(n.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:qo,text:`${parseFloat(RegExp.$1)}`},n=n.substr(RegExp.$1.length);else return[];return t[t.length]={type:Il,text:""},t}function Lo(n,t){return n.type===t}function _s(n){const t=[],e=uu(n);let o="BOD",i=0,s=e[i];for(;!Lo(s,Il);){let r=0;const a=[];if(o==="BOD")if(s.text==="M"||s.text==="m")i++,r=wi[s.text],o=s.text;else return _s("M0,0"+n);else Lo(s,qo)?r=wi[o]:(i++,r=wi[s.text],o=s.text);if(i+r<e.length){for(let c=i;c<i+r;c++){const l=e[c];if(Lo(l,qo))a[a.length]=+l.text;else throw new Error("Param not a number: "+o+","+l.text)}if(typeof wi[o]=="number"){const c={key:o,data:a};t.push(c),i+=r,s=e[i],o==="M"&&(o="L"),o==="m"&&(o="l")}else throw new Error("Bad segment: "+o)}else throw new Error("Path data ended short")}return t}function Ll(n){let t=0,e=0,o=0,i=0;const s=[];for(const{key:r,data:a}of n)switch(r){case"M":s.push({key:"M",data:[...a]}),[t,e]=a,[o,i]=a;break;case"m":t+=a[0],e+=a[1],s.push({key:"M",data:[t,e]}),o=t,i=e;break;case"L":s.push({key:"L",data:[...a]}),[t,e]=a;break;case"l":t+=a[0],e+=a[1],s.push({key:"L",data:[t,e]});break;case"C":s.push({key:"C",data:[...a]}),t=a[4],e=a[5];break;case"c":{const c=a.map((l,d)=>d%2?l+e:l+t);s.push({key:"C",data:c}),t=c[4],e=c[5];break}case"Q":s.push({key:"Q",data:[...a]}),t=a[2],e=a[3];break;case"q":{const c=a.map((l,d)=>d%2?l+e:l+t);s.push({key:"Q",data:c}),t=c[2],e=c[3];break}case"A":s.push({key:"A",data:[...a]}),t=a[5],e=a[6];break;case"a":t+=a[5],e+=a[6],s.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],t,e]});break;case"H":s.push({key:"H",data:[...a]}),t=a[0];break;case"h":t+=a[0],s.push({key:"H",data:[t]});break;case"V":s.push({key:"V",data:[...a]}),e=a[0];break;case"v":e+=a[0],s.push({key:"V",data:[e]});break;case"S":s.push({key:"S",data:[...a]}),t=a[2],e=a[3];break;case"s":{const c=a.map((l,d)=>d%2?l+e:l+t);s.push({key:"S",data:c}),t=c[2],e=c[3];break}case"T":s.push({key:"T",data:[...a]}),t=a[0],e=a[1];break;case"t":t+=a[0],e+=a[1],s.push({key:"T",data:[t,e]});break;case"Z":case"z":s.push({key:"Z",data:[]}),t=o,e=i;break}return s}function El(n){const t=[];let e="",o=0,i=0,s=0,r=0,a=0,c=0;for(const{key:l,data:d}of n){switch(l){case"M":t.push({key:"M",data:[...d]}),[o,i]=d,[s,r]=d;break;case"C":t.push({key:"C",data:[...d]}),o=d[4],i=d[5],a=d[2],c=d[3];break;case"L":t.push({key:"L",data:[...d]}),[o,i]=d;break;case"H":o=d[0],t.push({key:"L",data:[o,i]});break;case"V":i=d[0],t.push({key:"L",data:[o,i]});break;case"S":{let h=0,u=0;e==="C"||e==="S"?(h=o+(o-a),u=i+(i-c)):(h=o,u=i),t.push({key:"C",data:[h,u,...d]}),a=d[0],c=d[1],o=d[2],i=d[3];break}case"T":{const[h,u]=d;let y=0,m=0;e==="Q"||e==="T"?(y=o+(o-a),m=i+(i-c)):(y=o,m=i);const g=o+2*(y-o)/3,w=i+2*(m-i)/3,x=h+2*(y-h)/3,b=u+2*(m-u)/3;t.push({key:"C",data:[g,w,x,b,h,u]}),a=y,c=m,o=h,i=u;break}case"Q":{const[h,u,y,m]=d,g=o+2*(h-o)/3,w=i+2*(u-i)/3,x=y+2*(h-y)/3,b=m+2*(u-m)/3;t.push({key:"C",data:[g,w,x,b,y,m]}),a=h,c=u,o=y,i=m;break}case"A":{const h=Math.abs(d[0]),u=Math.abs(d[1]),y=d[2],m=d[3],g=d[4],w=d[5],x=d[6];h===0||u===0?(t.push({key:"C",data:[o,i,w,x,w,x]}),o=w,i=x):(o!==w||i!==x)&&(Rl(o,i,w,x,h,u,y,m,g).forEach(function(S){t.push({key:"C",data:S})}),o=w,i=x);break}case"Z":t.push({key:"Z",data:[]}),o=s,i=r;break}e=l}return t}function fu(n){return Math.PI*n/180}function _n(n,t,e){const o=n*Math.cos(e)-t*Math.sin(e),i=n*Math.sin(e)+t*Math.cos(e);return[o,i]}function Rl(n,t,e,o,i,s,r,a,c,l){const d=fu(r);let h=[],u=0,y=0,m=0,g=0;if(l)[u,y,m,g]=l;else{[n,t]=_n(n,t,-d),[e,o]=_n(e,o,-d);const dt=(n-e)/2,ut=(t-o)/2;let xt=dt*dt/(i*i)+ut*ut/(s*s);xt>1&&(xt=Math.sqrt(xt),i=xt*i,s=xt*s);const Dt=a===c?-1:1,Xt=i*i,lt=s*s,ft=Xt*lt-Xt*ut*ut-lt*dt*dt,_t=Xt*ut*ut+lt*dt*dt,zt=Dt*Math.sqrt(Math.abs(ft/_t));m=zt*i*ut/s+(n+e)/2,g=zt*-s*dt/i+(t+o)/2,u=Math.asin(parseFloat(((t-g)/s).toFixed(9))),y=Math.asin(parseFloat(((o-g)/s).toFixed(9))),n<m&&(u=Math.PI-u),e<m&&(y=Math.PI-y),u<0&&(u=Math.PI*2+u),y<0&&(y=Math.PI*2+y),c&&u>y&&(u=u-Math.PI*2),!c&&y>u&&(y=y-Math.PI*2)}let w=y-u;if(Math.abs(w)>Math.PI*120/180){const dt=y,ut=e,xt=o;c&&y>u?y=u+Math.PI*120/180*1:y=u+Math.PI*120/180*-1,e=m+i*Math.cos(y),o=g+s*Math.sin(y),h=Rl(e,o,ut,xt,i,s,r,0,c,[y,dt,m,g])}w=y-u;const x=Math.cos(u),b=Math.sin(u),S=Math.cos(y),P=Math.sin(y),A=Math.tan(w/4),B=4/3*i*A,X=4/3*s*A,D=[n,t],Q=[n+B*b,t-X*x],ot=[e+B*P,o-X*S],st=[e,o];if(Q[0]=2*D[0]-Q[0],Q[1]=2*D[1]-Q[1],l)return[Q,ot,st].concat(h);{h=[Q,ot,st].concat(h);const dt=[];for(let ut=0;ut<h.length;ut+=3){const xt=_n(h[ut][0],h[ut][1],d),Dt=_n(h[ut+1][0],h[ut+1][1],d),Xt=_n(h[ut+2][0],h[ut+2][1],d);dt.push([xt[0],xt[1],Dt[0],Dt[1],Xt[0],Xt[1]])}return dt}}const pu={randOffset:wu,randOffsetWithRange:bu,ellipse:mu,doubleLineOps:vu};function Al(n,t,e,o,i){return{type:"path",ops:Ve(n,t,e,o,i)}}function Oi(n,t,e){const o=(n||[]).length;if(o>2){const i=[];for(let s=0;s<o-1;s++)i.push(...Ve(n[s][0],n[s][1],n[s+1][0],n[s+1][1],e));return t&&i.push(...Ve(n[o-1][0],n[o-1][1],n[0][0],n[0][1],e)),{type:"path",ops:i}}else if(o===2)return Al(n[0][0],n[0][1],n[1][0],n[1][1],e);return{type:"path",ops:[]}}function yu(n,t){return Oi(n,!0,t)}function gu(n,t,e,o,i){const s=[[n,t],[n+e,t],[n+e,t+o],[n,t+o]];return yu(s,i)}function Ks(n,t){if(n.length){const o=typeof n[0][0]=="number"?[n]:n,i=bi(o[0],1*(1+t.roughness*.2),t),s=t.disableMultiStroke?[]:bi(o[0],1.5*(1+t.roughness*.22),er(t));for(let r=1;r<o.length;r++){const a=o[r];if(a.length){const c=bi(a,1*(1+t.roughness*.2),t),l=t.disableMultiStroke?[]:bi(a,1.5*(1+t.roughness*.22),er(t));for(const d of c)d.op!=="move"&&i.push(d);for(const d of l)d.op!=="move"&&s.push(d)}}return{type:"path",ops:i.concat(s)}}return{type:"path",ops:[]}}function mu(n,t,e,o,i){const s=Dl(e,o,i);return jo(n,t,i,s).opset}function Dl(n,t,e){const o=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(n/2,2)+Math.pow(t/2,2))/2)),i=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*o)),s=Math.PI*2/i;let r=Math.abs(n/2),a=Math.abs(t/2);const c=1-e.curveFitting;return r+=Pt(r*c,e),a+=Pt(a*c,e),{increment:s,rx:r,ry:a}}function jo(n,t,e,o){const[i,s]=nr(o.increment,n,t,o.rx,o.ry,1,o.increment*qi(.1,qi(.4,1,e),e),e);let r=ji(i,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[a]=nr(o.increment,n,t,o.rx,o.ry,1.5,0,e),c=ji(a,null,e);r=r.concat(c)}return{estimatedPoints:s,opset:{type:"path",ops:r}}}function Zs(n,t,e,o,i,s,r,a,c){const l=n,d=t;let h=Math.abs(e/2),u=Math.abs(o/2);h+=Pt(h*.01,c),u+=Pt(u*.01,c);let y=i,m=s;for(;y<0;)y+=Math.PI*2,m+=Math.PI*2;m-y>Math.PI*2&&(y=0,m=Math.PI*2);const g=Math.PI*2/c.curveStepCount,w=Math.min(g/2,(m-y)/2),x=ir(w,l,d,h,u,y,m,1,c);if(!c.disableMultiStroke){const b=ir(w,l,d,h,u,y,m,1.5,c);x.push(...b)}return r&&(a?x.push(...Ve(l,d,l+h*Math.cos(y),d+u*Math.sin(y),c),...Ve(l,d,l+h*Math.cos(m),d+u*Math.sin(m),c)):x.push({op:"lineTo",data:[l,d]},{op:"lineTo",data:[l+h*Math.cos(y),d+u*Math.sin(y)]})),{type:"path",ops:x}}function tr(n,t){const e=El(Ll(_s(n))),o=[];let i=[0,0],s=[0,0];for(const{key:r,data:a}of e)switch(r){case"M":{s=[a[0],a[1]],i=[a[0],a[1]];break}case"L":o.push(...Ve(s[0],s[1],a[0],a[1],t)),s=[a[0],a[1]];break;case"C":{const[c,l,d,h,u,y]=a;o.push(...Su(c,l,d,h,u,y,s,t)),s=[u,y];break}case"Z":o.push(...Ve(s[0],s[1],i[0],i[1],t)),s=[i[0],i[1]];break}return{type:"path",ops:o}}function Eo(n,t){const e=[];for(const o of n)if(o.length){const i=t.maxRandomnessOffset||0,s=o.length;if(s>2){e.push({op:"move",data:[o[0][0]+Pt(i,t),o[0][1]+Pt(i,t)]});for(let r=1;r<s;r++)e.push({op:"lineTo",data:[o[r][0]+Pt(i,t),o[r][1]+Pt(i,t)]})}}return{type:"fillPath",ops:e}}function kn(n,t){return lu(t,pu).fillPolygons(n,t)}function xu(n,t,e,o,i,s,r){const a=n,c=t;let l=Math.abs(e/2),d=Math.abs(o/2);l+=Pt(l*.01,r),d+=Pt(d*.01,r);let h=i,u=s;for(;h<0;)h+=Math.PI*2,u+=Math.PI*2;u-h>Math.PI*2&&(h=0,u=Math.PI*2);const y=(u-h)/r.curveStepCount,m=[];for(let g=h;g<=u;g=g+y)m.push([a+l*Math.cos(g),c+d*Math.sin(g)]);return m.push([a+l*Math.cos(u),c+d*Math.sin(u)]),m.push([a,c]),kn([m],r)}function wu(n,t){return Pt(n,t)}function bu(n,t,e){return qi(n,t,e)}function vu(n,t,e,o,i){return Ve(n,t,e,o,i,!0)}function er(n){const t=Object.assign({},n);return t.randomizer=void 0,n.seed&&(t.seed=n.seed+1),t}function Ol(n){return n.randomizer||(n.randomizer=new du(n.seed||0)),n.randomizer.next()}function qi(n,t,e,o=1){return e.roughness*o*(Ol(e)*(t-n)+n)}function Pt(n,t,e=1){return qi(-n,n,t,e)}function Ve(n,t,e,o,i,s=!1){const r=s?i.disableMultiStrokeFill:i.disableMultiStroke,a=Qo(n,t,e,o,i,!0,!1);if(r)return a;const c=Qo(n,t,e,o,i,!0,!0);return a.concat(c)}function Qo(n,t,e,o,i,s,r){const a=Math.pow(n-e,2)+Math.pow(t-o,2),c=Math.sqrt(a);let l=1;c<200?l=1:c>500?l=.4:l=-.0016668*c+1.233334;let d=i.maxRandomnessOffset||0;d*d*100>a&&(d=c/10);const h=d/2,u=.2+Ol(i)*.2;let y=i.bowing*i.maxRandomnessOffset*(o-t)/200,m=i.bowing*i.maxRandomnessOffset*(n-e)/200;y=Pt(y,i,l),m=Pt(m,i,l);const g=[],w=()=>Pt(h,i,l),x=()=>Pt(d,i,l),b=i.preserveVertices;return r?g.push({op:"move",data:[n+(b?0:w()),t+(b?0:w())]}):g.push({op:"move",data:[n+(b?0:Pt(d,i,l)),t+(b?0:Pt(d,i,l))]}),r?g.push({op:"bcurveTo",data:[y+n+(e-n)*u+w(),m+t+(o-t)*u+w(),y+n+2*(e-n)*u+w(),m+t+2*(o-t)*u+w(),e+(b?0:w()),o+(b?0:w())]}):g.push({op:"bcurveTo",data:[y+n+(e-n)*u+x(),m+t+(o-t)*u+x(),y+n+2*(e-n)*u+x(),m+t+2*(o-t)*u+x(),e+(b?0:x()),o+(b?0:x())]}),g}function bi(n,t,e){if(!n.length)return[];const o=[];o.push([n[0][0]+Pt(t,e),n[0][1]+Pt(t,e)]),o.push([n[0][0]+Pt(t,e),n[0][1]+Pt(t,e)]);for(let i=1;i<n.length;i++)o.push([n[i][0]+Pt(t,e),n[i][1]+Pt(t,e)]),i===n.length-1&&o.push([n[i][0]+Pt(t,e),n[i][1]+Pt(t,e)]);return ji(o,null,e)}function ji(n,t,e){const o=n.length,i=[];if(o>3){const s=[],r=1-e.curveTightness;i.push({op:"move",data:[n[1][0],n[1][1]]});for(let a=1;a+2<o;a++){const c=n[a];s[0]=[c[0],c[1]],s[1]=[c[0]+(r*n[a+1][0]-r*n[a-1][0])/6,c[1]+(r*n[a+1][1]-r*n[a-1][1])/6],s[2]=[n[a+1][0]+(r*n[a][0]-r*n[a+2][0])/6,n[a+1][1]+(r*n[a][1]-r*n[a+2][1])/6],s[3]=[n[a+1][0],n[a+1][1]],i.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[3][0],s[3][1]]})}}else o===3?(i.push({op:"move",data:[n[1][0],n[1][1]]}),i.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):o===2&&i.push(...Qo(n[0][0],n[0][1],n[1][0],n[1][1],e,!0,!0));return i}function nr(n,t,e,o,i,s,r,a){const c=a.roughness===0,l=[],d=[];if(c){n=n/4,d.push([t+o*Math.cos(-n),e+i*Math.sin(-n)]);for(let h=0;h<=Math.PI*2;h=h+n){const u=[t+o*Math.cos(h),e+i*Math.sin(h)];l.push(u),d.push(u)}d.push([t+o*Math.cos(0),e+i*Math.sin(0)]),d.push([t+o*Math.cos(n),e+i*Math.sin(n)])}else{const h=Pt(.5,a)-Math.PI/2;d.push([Pt(s,a)+t+.9*o*Math.cos(h-n),Pt(s,a)+e+.9*i*Math.sin(h-n)]);const u=Math.PI*2+h-.01;for(let y=h;y<u;y=y+n){const m=[Pt(s,a)+t+o*Math.cos(y),Pt(s,a)+e+i*Math.sin(y)];l.push(m),d.push(m)}d.push([Pt(s,a)+t+o*Math.cos(h+Math.PI*2+r*.5),Pt(s,a)+e+i*Math.sin(h+Math.PI*2+r*.5)]),d.push([Pt(s,a)+t+.98*o*Math.cos(h+r),Pt(s,a)+e+.98*i*Math.sin(h+r)]),d.push([Pt(s,a)+t+.9*o*Math.cos(h+r*.5),Pt(s,a)+e+.9*i*Math.sin(h+r*.5)])}return[d,l]}function ir(n,t,e,o,i,s,r,a,c){const l=s+Pt(.1,c),d=[];d.push([Pt(a,c)+t+.9*o*Math.cos(l-n),Pt(a,c)+e+.9*i*Math.sin(l-n)]);for(let h=l;h<=r;h=h+n)d.push([Pt(a,c)+t+o*Math.cos(h),Pt(a,c)+e+i*Math.sin(h)]);return d.push([t+o*Math.cos(r),e+i*Math.sin(r)]),d.push([t+o*Math.cos(r),e+i*Math.sin(r)]),ji(d,null,c)}function Su(n,t,e,o,i,s,r,a){const c=[],l=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.3];let d=[0,0];const h=a.disableMultiStroke?1:2,u=a.preserveVertices;for(let y=0;y<h;y++)y===0?c.push({op:"move",data:[r[0],r[1]]}):c.push({op:"move",data:[r[0]+(u?0:Pt(l[0],a)),r[1]+(u?0:Pt(l[0],a))]}),d=u?[i,s]:[i+Pt(l[y],a),s+Pt(l[y],a)],c.push({op:"bcurveTo",data:[n+Pt(l[y],a),t+Pt(l[y],a),e+Pt(l[y],a),o+Pt(l[y],a),d[0],d[1]]});return c}function zn(n){return[...n]}function or(n,t=0){const e=n.length;if(e<3)throw new Error("A curve must have at least three points.");const o=[];if(e===3)o.push(zn(n[0]),zn(n[1]),zn(n[2]),zn(n[2]));else{const i=[];i.push(n[0],n[0]);for(let a=1;a<n.length;a++)i.push(n[a]),a===n.length-1&&i.push(n[a]);const s=[],r=1-t;o.push(zn(i[0]));for(let a=1;a+2<i.length;a++){const c=i[a];s[0]=[c[0],c[1]],s[1]=[c[0]+(r*i[a+1][0]-r*i[a-1][0])/6,c[1]+(r*i[a+1][1]-r*i[a-1][1])/6],s[2]=[i[a+1][0]+(r*i[a][0]-r*i[a+2][0])/6,i[a+1][1]+(r*i[a][1]-r*i[a+2][1])/6],s[3]=[i[a+1][0],i[a+1][1]],o.push(s[1],s[2],s[3])}}return o}function ku(n,t){return Math.sqrt(_i(n,t))}function _i(n,t){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function Mu(n,t,e){const o=_i(t,e);if(o===0)return _i(n,t);let i=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/o;return i=Math.max(0,Math.min(1,i)),_i(n,on(t,e,i))}function on(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e]}function Pu(n,t){const e=n[t+0],o=n[t+1],i=n[t+2],s=n[t+3];let r=3*o[0]-2*e[0]-s[0];r*=r;let a=3*o[1]-2*e[1]-s[1];a*=a;let c=3*i[0]-2*s[0]-e[0];c*=c;let l=3*i[1]-2*s[1]-e[1];return l*=l,r<c&&(r=c),a<l&&(a=l),r+a}function Vo(n,t,e,o){const i=o||[];if(Pu(n,t)<e){const s=n[t+0];i.length?ku(i[i.length-1],s)>1&&i.push(s):i.push(s),i.push(n[t+3])}else{const r=n[t+0],a=n[t+1],c=n[t+2],l=n[t+3],d=on(r,a,.5),h=on(a,c,.5),u=on(c,l,.5),y=on(d,h,.5),m=on(h,u,.5),g=on(y,m,.5);Vo([r,d,y,g],0,e,i),Vo([g,m,u,l],0,e,i)}return i}function $u(n,t){return Qi(n,0,n.length,t)}function Qi(n,t,e,o,i){const s=i||[],r=n[t],a=n[e-1];let c=0,l=1;for(let d=t+1;d<e-1;++d){const h=Mu(n[d],r,a);h>c&&(c=h,l=d)}return Math.sqrt(c)>o?(Qi(n,t,l+1,o,s),Qi(n,l,e,o,s)):(s.length||s.push(r),s.push(a)),s}function Jo(n,t=.15,e){const o=[],i=(n.length-1)/3;for(let s=0;s<i;s++){const r=s*3;Vo(n,r,t,o)}return e&&e>0?Qi(o,0,o.length,e):o}function Cu(n,t,e){const o=_s(n),i=El(Ll(o)),s=[];let r=[],a=[0,0],c=[];const l=()=>{c.length>=4&&r.push(...Jo(c,t)),c=[]},d=()=>{l(),r.length&&(s.push(r),r=[])};for(const{key:u,data:y}of i)switch(u){case"M":d(),a=[y[0],y[1]],r.push(a);break;case"L":l(),r.push([y[0],y[1]]);break;case"C":if(!c.length){const m=r.length?r[r.length-1]:a;c.push([m[0],m[1]])}c.push([y[0],y[1]]),c.push([y[2],y[3]]),c.push([y[4],y[5]]);break;case"Z":l(),r.push([a[0],a[1]]);break}if(d(),!e)return s;const h=[];for(const u of s){const y=$u(u,e);y.length&&h.push(y)}return h}const we="none";class Vi{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return cu()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,o){return{shape:t,sets:e||[],options:o||this.defaultOptions}}line(t,e,o,i,s){const r=this._o(s);return this._d("line",[Al(t,e,o,i,r)],r)}rectangle(t,e,o,i,s){const r=this._o(s),a=[],c=gu(t,e,o,i,r);if(r.fill){const l=[[t,e],[t+o,e],[t+o,e+i],[t,e+i]];r.fillStyle==="solid"?a.push(Eo([l],r)):a.push(kn([l],r))}return r.stroke!==we&&a.push(c),this._d("rectangle",a,r)}ellipse(t,e,o,i,s){const r=this._o(s),a=[],c=Dl(o,i,r),l=jo(t,e,r,c);if(r.fill)if(r.fillStyle==="solid"){const d=jo(t,e,r,c).opset;d.type="fillPath",a.push(d)}else a.push(kn([l.estimatedPoints],r));return r.stroke!==we&&a.push(l.opset),this._d("ellipse",a,r)}circle(t,e,o,i){const s=this.ellipse(t,e,o,o,i);return s.shape="circle",s}linearPath(t,e){const o=this._o(e);return this._d("linearPath",[Oi(t,!1,o)],o)}arc(t,e,o,i,s,r,a=!1,c){const l=this._o(c),d=[],h=Zs(t,e,o,i,s,r,a,!0,l);if(a&&l.fill)if(l.fillStyle==="solid"){const u=Object.assign({},l);u.disableMultiStroke=!0;const y=Zs(t,e,o,i,s,r,!0,!1,u);y.type="fillPath",d.push(y)}else d.push(xu(t,e,o,i,s,r,l));return l.stroke!==we&&d.push(h),this._d("arc",d,l)}curve(t,e){const o=this._o(e),i=[],s=Ks(t,o);if(o.fill&&o.fill!==we)if(o.fillStyle==="solid"){const r=Ks(t,Object.assign(Object.assign({},o),{disableMultiStroke:!0,roughness:o.roughness?o.roughness+o.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(r.ops)})}else{const r=[],a=t;if(a.length){const l=typeof a[0][0]=="number"?[a]:a;for(const d of l)d.length<3?r.push(...d):d.length===3?r.push(...Jo(or([d[0],d[0],d[1],d[2]]),10,(1+o.roughness)/2)):r.push(...Jo(or(d),10,(1+o.roughness)/2))}r.length&&i.push(kn([r],o))}return o.stroke!==we&&i.push(s),this._d("curve",i,o)}polygon(t,e){const o=this._o(e),i=[],s=Oi(t,!0,o);return o.fill&&(o.fillStyle==="solid"?i.push(Eo([t],o)):i.push(kn([t],o))),o.stroke!==we&&i.push(s),this._d("polygon",i,o)}path(t,e){const o=this._o(e),i=[];if(!t)return this._d("path",i,o);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const s=o.fill&&o.fill!=="transparent"&&o.fill!==we,r=o.stroke!==we,a=!!(o.simplification&&o.simplification<1),c=a?4-4*(o.simplification||1):(1+o.roughness)/2,l=Cu(t,1,c),d=tr(t,o);if(s)if(o.fillStyle==="solid")if(l.length===1){const h=tr(t,Object.assign(Object.assign({},o),{disableMultiStroke:!0,roughness:o.roughness?o.roughness+o.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(h.ops)})}else i.push(Eo(l,o));else i.push(kn(l,o));return r&&(a?l.forEach(h=>{i.push(Oi(h,!1,o))}):i.push(d)),this._d("path",i,o)}opsToPath(t,e){let o="";for(const i of t.ops){const s=typeof e=="number"&&e>=0?i.data.map(r=>+r.toFixed(e)):i.data;switch(i.op){case"move":o+=`M${s[0]} ${s[1]} `;break;case"bcurveTo":o+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":o+=`L${s[0]} ${s[1]} `;break}}return o.trim()}toPaths(t){const e=t.sets||[],o=t.options||this.defaultOptions,i=[];for(const s of e){let r=null;switch(s.type){case"path":r={d:this.opsToPath(s),stroke:o.stroke,strokeWidth:o.strokeWidth,fill:we};break;case"fillPath":r={d:this.opsToPath(s),stroke:we,strokeWidth:0,fill:o.fill||we};break;case"fillSketch":r=this.fillSketch(s,o);break}r&&i.push(r)}return i}fillSketch(t,e){let o=e.fillWeight;return o<0&&(o=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||we,strokeWidth:o,fill:we}}_mergedShape(t){return t.filter((e,o)=>o===0?!0:e.op!=="move")}}class Tu{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new Vi(e)}draw(t){const e=t.sets||[],o=t.options||this.getDefaultOptions(),i=this.ctx,s=t.options.fixedDecimalPlaceDigits;for(const r of e)switch(r.type){case"path":i.save(),i.strokeStyle=o.stroke==="none"?"transparent":o.stroke,i.lineWidth=o.strokeWidth,o.strokeLineDash&&i.setLineDash(o.strokeLineDash),o.strokeLineDashOffset&&(i.lineDashOffset=o.strokeLineDashOffset),this._drawToContext(i,r,s),i.restore();break;case"fillPath":{i.save(),i.fillStyle=o.fill||"";const a=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(i,r,s,a),i.restore();break}case"fillSketch":this.fillSketch(i,r,o);break}}fillSketch(t,e,o){let i=o.fillWeight;i<0&&(i=o.strokeWidth/2),t.save(),o.fillLineDash&&t.setLineDash(o.fillLineDash),o.fillLineDashOffset&&(t.lineDashOffset=o.fillLineDashOffset),t.strokeStyle=o.fill||"",t.lineWidth=i,this._drawToContext(t,e,o.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,o,i="nonzero"){t.beginPath();for(const s of e.ops){const r=typeof o=="number"&&o>=0?s.data.map(a=>+a.toFixed(o)):s.data;switch(s.op){case"move":t.moveTo(r[0],r[1]);break;case"bcurveTo":t.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"lineTo":t.lineTo(r[0],r[1]);break}}e.type==="fillPath"?t.fill(i):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,o,i,s){const r=this.gen.line(t,e,o,i,s);return this.draw(r),r}rectangle(t,e,o,i,s){const r=this.gen.rectangle(t,e,o,i,s);return this.draw(r),r}ellipse(t,e,o,i,s){const r=this.gen.ellipse(t,e,o,i,s);return this.draw(r),r}circle(t,e,o,i){const s=this.gen.circle(t,e,o,i);return this.draw(s),s}linearPath(t,e){const o=this.gen.linearPath(t,e);return this.draw(o),o}polygon(t,e){const o=this.gen.polygon(t,e);return this.draw(o),o}arc(t,e,o,i,s,r,a=!1,c){const l=this.gen.arc(t,e,o,i,s,r,a,c);return this.draw(l),l}curve(t,e){const o=this.gen.curve(t,e);return this.draw(o),o}path(t,e){const o=this.gen.path(t,e);return this.draw(o),o}}const vi="http://www.w3.org/2000/svg";class Iu{constructor(t,e){this.svg=t,this.gen=new Vi(e)}draw(t){const e=t.sets||[],o=t.options||this.getDefaultOptions(),i=this.svg.ownerDocument||window.document,s=i.createElementNS(vi,"g"),r=t.options.fixedDecimalPlaceDigits;for(const a of e){let c=null;switch(a.type){case"path":{c=i.createElementNS(vi,"path"),c.setAttribute("d",this.opsToPath(a,r)),c.setAttribute("stroke",o.stroke),c.setAttribute("stroke-width",o.strokeWidth+""),c.setAttribute("fill","none"),o.strokeLineDash&&c.setAttribute("stroke-dasharray",o.strokeLineDash.join(" ").trim()),o.strokeLineDashOffset&&c.setAttribute("stroke-dashoffset",`${o.strokeLineDashOffset}`);break}case"fillPath":{c=i.createElementNS(vi,"path"),c.setAttribute("d",this.opsToPath(a,r)),c.setAttribute("stroke","none"),c.setAttribute("stroke-width","0"),c.setAttribute("fill",o.fill||""),(t.shape==="curve"||t.shape==="polygon")&&c.setAttribute("fill-rule","evenodd");break}case"fillSketch":{c=this.fillSketch(i,a,o);break}}c&&s.appendChild(c)}return s}fillSketch(t,e,o){let i=o.fillWeight;i<0&&(i=o.strokeWidth/2);const s=t.createElementNS(vi,"path");return s.setAttribute("d",this.opsToPath(e,o.fixedDecimalPlaceDigits)),s.setAttribute("stroke",o.fill||""),s.setAttribute("stroke-width",i+""),s.setAttribute("fill","none"),o.fillLineDash&&s.setAttribute("stroke-dasharray",o.fillLineDash.join(" ").trim()),o.fillLineDashOffset&&s.setAttribute("stroke-dashoffset",`${o.fillLineDashOffset}`),s}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,o,i,s){const r=this.gen.line(t,e,o,i,s);return this.draw(r)}rectangle(t,e,o,i,s){const r=this.gen.rectangle(t,e,o,i,s);return this.draw(r)}ellipse(t,e,o,i,s){const r=this.gen.ellipse(t,e,o,i,s);return this.draw(r)}circle(t,e,o,i){const s=this.gen.circle(t,e,o,i);return this.draw(s)}linearPath(t,e){const o=this.gen.linearPath(t,e);return this.draw(o)}polygon(t,e){const o=this.gen.polygon(t,e);return this.draw(o)}arc(t,e,o,i,s,r,a=!1,c){const l=this.gen.arc(t,e,o,i,s,r,a,c);return this.draw(l)}curve(t,e){const o=this.gen.curve(t,e);return this.draw(o)}path(t,e){const o=this.gen.path(t,e);return this.draw(o)}}const Ln={canvas(n,t){return new Tu(n,t)},svg(n,t){return new Iu(n,t)},generator(n){return new Vi(n)},newSeed(){return Vi.newSeed()}},Lu=async(n,t,e)=>{let o=p.elements;if(e){if(p.selection.length===0)return;o=o.filter(g=>p.selection.includes(g.id))}if(o.length===0)return;let i=1/0,s=1/0,r=-1/0,a=-1/0;o.forEach(g=>{i=Math.min(i,g.x),s=Math.min(s,g.y),r=Math.max(r,g.x+g.width),a=Math.max(a,g.y+g.height)});const c=20,l=r-i+c*2,d=a-s+c*2,h=document.createElement("canvas");h.width=l*n,h.height=d*n;const u=h.getContext("2d");if(!u)return;t&&(u.fillStyle="#ffffff",u.fillRect(0,0,h.width,h.height)),u.scale(n,n),u.translate(-i+c,-s+c);const y=Ln.canvas(h);o.forEach(g=>{Xe(y,u,g)});const m=document.createElement("a");m.download="yappy_drawing.png",m.href=h.toDataURL("image/png"),m.click()},Eu=n=>{let t=p.elements;if(n){if(p.selection.length===0)return;t=t.filter(x=>p.selection.includes(x.id))}if(t.length===0)return;let e=1/0,o=1/0,i=-1/0,s=-1/0;t.forEach(x=>{e=Math.min(e,x.x),o=Math.min(o,x.y),i=Math.max(i,x.x+x.width),s=Math.max(s,x.y+x.height)});const r=20,a=i-e+r*2,c=s-o+r*2,l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("width",`${a}`),l.setAttribute("height",`${c}`),l.setAttribute("viewBox",`0 0 ${a} ${c}`),l.style.backgroundColor="#ffffff";const d=Ln.svg(l),h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("transform",`translate(${-e+r}, ${-o+r})`),l.appendChild(h),t.forEach(x=>{let b=null;const S={seed:x.seed,roughness:x.roughness,stroke:x.strokeColor,strokeWidth:x.strokeWidth,fill:x.backgroundColor==="transparent"?void 0:x.backgroundColor,fillStyle:x.fillStyle,strokeLineDash:x.strokeStyle==="dashed"?[10,10]:x.strokeStyle==="dotted"?[5,10]:void 0};if(x.type==="rectangle")b=d.rectangle(x.x,x.y,x.width,x.height,S);else if(x.type==="circle")b=d.ellipse(x.x+x.width/2,x.y+x.height/2,Math.abs(x.width),Math.abs(x.height),S);else if(x.type==="line"||x.type==="arrow"){const P=x.x+x.width,A=x.y+x.height;if(x.type==="arrow"){const B=document.createElementNS("http://www.w3.org/2000/svg","g");B.appendChild(d.line(x.x,x.y,P,A,S));const X=Math.atan2(x.height,x.width),D=15,Q={x:P-D*Math.cos(X-Math.PI/6),y:A-D*Math.sin(X-Math.PI/6)},ot={x:P-D*Math.cos(X+Math.PI/6),y:A-D*Math.sin(X+Math.PI/6)};B.appendChild(d.line(P,A,Q.x,Q.y,S)),B.appendChild(d.line(P,A,ot.x,ot.y,S)),b=B}else b=d.line(x.x,x.y,P,A,S)}else if(x.type==="text"&&x.text){const P=document.createElementNS("http://www.w3.org/2000/svg","text");P.textContent=x.text,P.setAttribute("x",`${x.x}`),P.setAttribute("y",`${x.y+(x.fontSize||20)}`),P.setAttribute("fill",x.strokeColor),P.setAttribute("font-family","sans-serif"),P.setAttribute("font-size",`${x.fontSize||20}px`),b=P}else if((x.type==="fineliner"||x.type==="inkbrush"||x.type==="marker")&&x.points){let P=[];if(x.pointsEncoding==="flat"){const A=x.points;for(let B=0;B<A.length;B+=2)P.push({x:A[B],y:A[B+1]})}else P=x.points;if(P.length>1){const A=P.map(B=>[x.x+B.x,x.y+B.y]);b=d.curve(A,S)}}else if(x.type==="image"&&x.dataURL){const P=document.createElementNS("http://www.w3.org/2000/svg","image");P.setAttribute("href",x.dataURL),P.setAttribute("x",`${x.x}`),P.setAttribute("y",`${x.y}`),P.setAttribute("width",`${x.width}`),P.setAttribute("height",`${x.height}`),b=P}if(b){if(b.setAttribute("opacity",`${(x.opacity??100)/100}`),x.angle){const P=x.x+x.width/2,A=x.y+x.height/2;b.setAttribute("transform",`rotate(${x.angle*(180/Math.PI)}, ${P}, ${A})`)}h.appendChild(b)}});const y=new XMLSerializer().serializeToString(l),m=new Blob([y],{type:"image/svg+xml"}),g=URL.createObjectURL(m),w=document.createElement("a");w.download="yappy_drawing.svg",w.href=g,w.click()},Jy=async(n,t,e)=>{const o=p.elements;if(o.length===0)return;if(p.docType==="slides"&&p.slides.length>0&&!e){const s=[...p.slides].sort((h,u)=>h.order-u.order),r=s[0],{width:a,height:c}=r.dimensions,l=a>=c?"landscape":"portrait",d=new Bs({orientation:l,unit:"px",format:[a,c],hotfixes:["px_scaling"]});for(let h=0;h<s.length;h++){const u=s[h],{width:y,height:m}=u.dimensions,{x:g,y:w}=u.spatialPosition,x=o.filter(B=>{const X=B.x+B.width/2,D=B.y+B.height/2;return X>=g&&X<=g+y&&D>=w&&D<=w+m}),b=document.createElement("canvas");b.width=y*n,b.height=m*n;const S=b.getContext("2d");if(!S)continue;t&&(S.fillStyle=u.backgroundColor||"#ffffff",S.fillRect(0,0,b.width,b.height)),S.scale(n,n),S.translate(-g,-w);const P=Ln.canvas(b);if(x.forEach(B=>{Xe(P,S,B)}),h>0){const B=y>=m?"landscape":"portrait";d.addPage([y,m],B)}const A=b.toDataURL("image/jpeg",.92);d.addImage(A,"JPEG",0,0,y,m)}d.save("yappy_drawing.pdf")}else{let s=o;if(e){if(p.selection.length===0)return;s=s.filter(S=>p.selection.includes(S.id))}if(s.length===0)return;let r=1/0,a=1/0,c=-1/0,l=-1/0;s.forEach(S=>{r=Math.min(r,S.x),a=Math.min(a,S.y),c=Math.max(c,S.x+S.width),l=Math.max(l,S.y+S.height)});const d=20,h=c-r+d*2,u=l-a+d*2,y=document.createElement("canvas");y.width=h*n,y.height=u*n;const m=y.getContext("2d");if(!m)return;t&&(m.fillStyle="#ffffff",m.fillRect(0,0,y.width,y.height)),m.scale(n,n),m.translate(-r+d,-a+d);const g=Ln.canvas(y);s.forEach(S=>{Xe(g,m,S)});const w=h>=u?"landscape":"portrait",x=new Bs({orientation:w,unit:"px",format:[h,u],hotfixes:["px_scaling"]}),b=y.toDataURL("image/jpeg",.92);x.addImage(b,"JPEG",0,0,h,u),x.save("yappy_drawing.pdf")}},Ky=async(n,t,e)=>{const o=p.elements;if(o.length===0)return;const i=new ed;if(p.docType==="slides"&&p.slides.length>0&&!e){const r=[...p.slides].sort((d,h)=>d.order-h.order),a=r[0],c=10,l=10*(a.dimensions.height/a.dimensions.width);i.defineLayout({name:"CUSTOM",width:c,height:l}),i.layout="CUSTOM";for(const d of r){const{width:h,height:u}=d.dimensions,{x:y,y:m}=d.spatialPosition,g=o.filter(B=>{const X=B.x+B.width/2,D=B.y+B.height/2;return X>=y&&X<=y+h&&D>=m&&D<=m+u}),w=document.createElement("canvas");w.width=h*n,w.height=u*n;const x=w.getContext("2d");if(!x)continue;t&&(x.fillStyle=d.backgroundColor||"#ffffff",x.fillRect(0,0,w.width,w.height)),x.scale(n,n),x.translate(-y,-m);const b=Ln.canvas(w);g.forEach(B=>{Xe(b,x,B)});const S=10,P=10*(u/h);i.addSlide().addImage({data:w.toDataURL("image/png"),x:0,y:0,w:S,h:P})}}else{let r=o;if(e){if(p.selection.length===0)return;r=r.filter(P=>p.selection.includes(P.id))}if(r.length===0)return;let a=1/0,c=1/0,l=-1/0,d=-1/0;r.forEach(P=>{a=Math.min(a,P.x),c=Math.min(c,P.y),l=Math.max(l,P.x+P.width),d=Math.max(d,P.y+P.height)});const h=20,u=l-a+h*2,y=d-c+h*2,m=document.createElement("canvas");m.width=u*n,m.height=y*n;const g=m.getContext("2d");if(!g)return;t&&(g.fillStyle="#ffffff",g.fillRect(0,0,m.width,m.height)),g.scale(n,n),g.translate(-a+h,-c+h);const w=Ln.canvas(m);r.forEach(P=>{Xe(w,g,P)});const x=10,b=10*(y/u);i.defineLayout({name:"CUSTOM",width:x,height:b}),i.layout="CUSTOM",i.addSlide().addImage({data:m.toDataURL("image/png"),x:0,y:0,w:x,h:b})}await i.writeFile({fileName:"yappy_drawing.pptx"})};class Ru{mediaRecorder=null;chunks=[];stream=null;canvas;onStopCallback=null;constructor(t){this.canvas=t}start(t="webm"){try{this.stream=this.canvas.captureStream(60);let e="video/webm;codecs=vp9";return t==="mp4"&&(MediaRecorder.isTypeSupported("video/mp4")?e="video/mp4":MediaRecorder.isTypeSupported("video/webm;codecs=h264")&&(e="video/webm;codecs=h264")),MediaRecorder.isTypeSupported(e)||(console.warn(`Mime type ${e} not supported, falling back to default.`),e=""),this.mediaRecorder=new MediaRecorder(this.stream,e?{mimeType:e}:void 0),this.chunks=[],this.mediaRecorder.ondataavailable=o=>{o.data.size>0&&this.chunks.push(o.data)},this.mediaRecorder.onstop=()=>{this.saveFile(),this.onStopCallback&&this.onStopCallback(),this.cleanup()},this.mediaRecorder.start(),!0}catch(e){return console.error("Failed to start recording:",e),!1}}stop(t){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.onStopCallback=t||null,this.mediaRecorder.stop())}saveFile(){if(this.chunks.length===0)return;const t=new Blob(this.chunks,{type:this.mediaRecorder?.mimeType||"video/webm"}),e=URL.createObjectURL(t),o=document.createElement("a");o.style.display="none",o.href=e;const i=t.type.includes("mp4")?"mp4":"webm",s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);o.download=`yappy-recording-${s}.${i}`,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(e)},100)}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.chunks=[]}}var Au=nt("<div class=recording-overlay><div class=recording-indicator><div class=pulse-dot></div><span class=recording-text>REC</span></div><div class=recording-timer></div><button class=stop-btn><span>Stop");const Du=n=>{const[t,e]=kt(0);hn(()=>{const i=setInterval(()=>{e(s=>s+1)},1e3);oe(()=>clearInterval(i))});const o=i=>{const s=Math.floor(i/60),r=i%60;return`${s}:${r.toString().padStart(2,"0")}`};return(()=>{var i=Au(),s=i.firstChild,r=s.nextSibling,a=r.nextSibling,c=a.firstChild;return Y(r,()=>o(t())),Se(a,"click",n.onStop,!0),Y(a,I(Ji,{size:16,fill:"white",strokeWidth:0}),c),i})()};ne(["click"]);var Ou=nt("<canvas style=display:block;touch-action:none;user-select:none>"),_u=nt("<div style=position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0>"),zu=nt('<div style=position:fixed;bottom:30px;left:50%;transform:translateX(-50%);z-index:100><button style="background-color:white;border:1px solid #e5e7eb;padding:8px 16px;border-radius:9999px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);cursor:pointer;color:#3b82f6;font-weight:500;font-size:14px;transition:all 0.2s">Scroll back to content'),Bu=nt('<textarea style="position:absolute;transform:translate(-50%, -50%);background:transparent;border:1px dashed #007acc;outline:none;margin:0;padding:4px;resize:none;overflow:hidden;min-width:50px;min-height:1em">'),Wu=nt('<div class=path-editor-overlay style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none><svg style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999><path fill=none stroke=#3b82f6 stroke-width=2 stroke-dasharray="5 5"></path></svg><div style=position:absolute;top:0;left:0;width:100%;height:100%;z-index:998;pointer-events:all;cursor:crosshair></div><button style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:2000;background:#3b82f6;color:white;padding:8px 16px;border-radius:20px;border:none;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;pointer-events:all">Done Editing Path'),Xu=nt('<div class=path-control-point style="position:absolute;transform:translate(-50%, -50%);width:10px;height:10px;border:2px solid #3b82f6;border-radius:50%;pointer-events:all;cursor:move;z-index:1000">');const[Yu,Hu]=kt(null),sr=(n,t,e,o,i,s,r,a)=>{const c=e.fillStyle||"solid";if(c==="solid"){const l=a?"#121212":"#ffffff";let d=e.backgroundColor||l;d==="transparent"&&(d=l),n.fillStyle=d,n.fillRect(o,i,s,r)}else if(["linear","radial","conic"].includes(c)){const l=e.gradientStops||[],d=e.gradientDirection||0;if(l.length===0){const m=a?"#121212":"#ffffff";let g=e.backgroundColor||m;g==="transparent"&&(g=m),n.fillStyle=g,n.fillRect(o,i,s,r);return}const h=o+s/2,u=i+r/2;let y;if(c==="linear"){const m=d*Math.PI/180,g=Math.sqrt(s*s+r*r)/2,w=Math.cos(m)*g,x=Math.sin(m)*g;y=n.createLinearGradient(h-w,u-x,h+w,u+x)}else{const m=d*Math.PI/180,g=Math.max(s,r)/2,w=g*.4,x=h+Math.cos(m)*w,b=u+Math.sin(m)*w;y=n.createRadialGradient(x,b,0,h,u,g)}l.forEach(m=>y.addColorStop(m.offset,m.color)),n.fillStyle=y,n.fillRect(o,i,s,r)}else if(["hachure","cross-hatch","zigzag","dots","dashed","zigzag-line"].includes(c)){const l=e.backgroundColor||(a?"#121212":"#ffffff");n.fillStyle=l,n.fillRect(o,i,s,r),t.rectangle(o,i,s,r,{fill:e.strokeColor||(a?"#ffffff":"#000000"),fillStyle:c,fillWeight:.5,hachureGap:8,stroke:"transparent",roughness:0})}else if(c==="image"&&e.backgroundImage){const l=Tl(e.backgroundImage);if(l){n.save(),n.globalAlpha=e.backgroundOpacity??1;const d=l.width/l.height,h=s/r;let u,y,m,g;d>h?(y=r,u=r*d,m=o-(u-s)/2,g=i):(u=s,y=s/d,m=o,g=i-(y-r)/2),n.drawImage(l,m,g,u,y),n.restore()}else n.fillStyle=a?"#1a1a1a":"#f0f0f0",n.fillRect(o,i,s,r)}},Nu=()=>{Vt(()=>{const f=p.selection;if(f.length>0){let k=null,R=-1/0;f.forEach(C=>{const _=p.elements.find(L=>L.id===C);if(_){const L=p.layers.find(v=>v.id===_.layerId);L&&L.order>R&&(R=L.order,k=L.id)}}),k&&k!==pi(()=>p.activeLayerId)&&$s(k)}}),Vt(()=>{if(!n)return;const f=n.getContext("2d");f&&p.elements.forEach(k=>{const R=k.type==="line"||k.type==="arrow";if(k.isSelected&&k.autoResize&&k.containerText&&!R){k.fontSize,k.fontFamily,k.fontWeight,k.fontStyle,k.containerText;const C=qs(f,k,k.containerText);(Math.abs(C.width-k.width)>2||Math.abs(C.height-k.height)>2)&&pi(()=>Z(k.id,{width:C.width,height:C.height}))}})}),Vt(()=>{if(p.appMode==="presentation")At.setForceTicker(!0);else{const f=p.elements.some(k=>k.flowAnimation);At.setForceTicker(f)}});let n,t=null;Vt(()=>{const f=Yu();f&&f.start&&(i(f.format||"webm"),Hu(null))});const e=()=>{if(!n)return;const f=p.slides[p.activeSlideIndex];if(!f)return;const{width:k,height:R}=f.dimensions,{x:C,y:_}=f.spatialPosition;if(k===0||R===0)return;const L=document.createElement("canvas"),v=320,W=v*R/k;L.width=v,L.height=W;const q=L.getContext("2d");if(!q)return;const E=v/k;q.save(),q.scale(E,E),q.translate(-C,-_);const z=p.theme==="dark",H=Nn.canvas(L);sr(q,H,f,C,_,k,R,z),[...p.layers].sort((G,it)=>G.order-it.order).forEach(G=>{if(!Ae(G.id))return;p.elements.filter(tt=>tt.layerId===G.id).forEach(tt=>{const et=G?.opacity??1;Xe(H,q,tt,z,et)})}),q.restore();const O=L.toDataURL("image/jpeg",.6);Xd(p.activeSlideIndex,O)};let o;Vt(()=>{p.activeSlideIndex,p.elements,window.clearTimeout(o),o=window.setTimeout(()=>{pi(()=>e())},1e3)});const i=f=>{if(!n){console.error("[DEBUG] Canvas: No canvasRef available");return}t||(console.log("[DEBUG] Canvas: Initializing VideoRecorder"),t=new Ru(n)),console.log("[DEBUG] Canvas: Starting recorder...");const k=t.start(f);console.log("[DEBUG] Canvas: Recorder start returned:",k),k?($("isRecording",!0),Bt("Recording started...","info")):Bt("Failed to start recording","error")},s=()=>{t&&t.stop(()=>{$("isRecording",!1),Bt("Recording saved!","success")})};let r=!1,a=null,c=0,l=0;const[d,h]=kt(null),[u,y]=kt("containerText"),[m,g]=kt("");let w,x=!1,b=!1,S=null;const[P,A]=kt(null);let B=new Map;const[X,D]=kt(null),[Q,ot]=kt([]),[st,dt]=kt([]);let ut=null,xt=null,Dt=0,Xt=0,lt=0,ft=0,_t=20,zt=0;const Kt=16;let Lt=[],Zt=!1,re=0;const Ft=8,ae=800,Le=100;let ce=[],jt=0;const un=16;let Ce=!1;const Fe=()=>{if(!a||ce.length===0)return;const f=p.elements.find(k=>k.id===a);if(f&&f.points){const C={points:[...f.points,...ce]};f.type==="ink"&&(C.ttl=Date.now()+3e3),Z(a,C,!1),ce=[]}},me=()=>{n&&(n.width=window.innerWidth,n.height=window.innerHeight,p.appMode==="presentation"&&(qn(),setTimeout(qn,50)),ue())},[fn,ee]=kt("default"),[lo,ni]=kt(!1),[Ke,ii]=kt({x:0,y:0});function ue(){if(console.log("[Canvas] draw() called, effectiveTime:",xo()),!n)return;const f=n.getContext("2d");if(!f)return;const k=xo();window.yappyGlobalTime=k;const R=performance.now(),C=p.appMode==="presentation"||p.isPreviewing;let _=p.elements;if(p.docType==="slides"&&p.slides.length>0){const T=p.slides[p.activeSlideIndex];if(T){const{x:N,y:M}=T.spatialPosition,{width:ct,height:at}=T.dimensions,yt=200,Tt=new Set(p.layers.filter(vt=>vt.isMaster).map(vt=>vt.id)),It=p.elements.filter(vt=>{if(Tt.has(vt.layerId))return!0;const Ct=vt.x+vt.width/2,Ut=vt.y+vt.height/2;return Ct>=N-yt&&Ct<=N+ct+yt&&Ut>=M-yt&&Ut<=M+at+yt}),J=new Set(It.map(vt=>vt.orbitCenterId).filter(Boolean)),wt=p.elements.filter(vt=>J.has(vt.id));_=It.length===p.elements.length?p.elements:[...new Set([...It,...wt])]}}const L=ko(_,k,C);f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,n.width,n.height);const v=Date.now();if(Lt.length>0){let T=0;for(let N=0;N<Lt.length;N++)v-Lt[N].timestamp<ae&&(Lt[T++]=Lt[N]);Lt.length=T}const W=p.theme==="dark",q=W?"#1a1a1b":"#e2e8f0";f.fillStyle=q,f.fillRect(0,0,n.width,n.height);const{scale:E,panX:z,panY:H}=p.viewState;f.save(),f.translate(z,H),f.scale(E,E);const U=Nn.canvas(n);if(p.docType==="slides"){const T=p.slides[p.activeSlideIndex];if(T){const{width:N,height:M}=T.dimensions,{x:ct,y:at}=T.spatialPosition;f.save(),f.shadowColor=W?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.15)",f.shadowBlur=40,f.shadowOffsetY=10,f.fillStyle="black",f.fillRect(ct,at,N,M),f.restore(),sr(f,U,T,ct,at,N,M,W)}}else p.docType==="infinite"&&p.slides.length>1&&p.slides.forEach((T,N)=>{const{width:M,height:ct}=T.dimensions,{x:at,y:yt}=T.spatialPosition;f.save(),f.strokeStyle=W?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",f.lineWidth=2,f.setLineDash([10,5]),f.strokeRect(at,yt,M,ct),f.setLineDash([]),f.restore(),f.fillStyle=W?"rgba(100,149,237,0.03)":"rgba(70,130,180,0.02)",f.fillRect(at,yt,M,ct),f.save();const Tt=`Slide ${N+1}`,It=Math.max(14,16/E);f.font=`${It}px Inter, sans-serif`,f.fillStyle=W?"rgba(100,149,237,0.6)":"rgba(70,130,180,0.5)";const J=8,wt=f.measureText(Tt),vt=It+J*2,Ct=wt.width+J*2;f.fillStyle=W?"rgba(30,30,30,0.8)":"rgba(255,255,255,0.9)",f.fillRect(at,yt,Ct,vt),f.strokeStyle=W?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",f.lineWidth=1,f.strokeRect(at,yt,Ct,vt),f.fillStyle=W?"rgba(100,149,237,0.8)":"rgba(70,130,180,0.7)",f.fillText(Tt,at+J,yt+It+J/2),f.restore()});if(f.restore(),p.canvasTexture!=="none"){const T=p.canvasTexture;if(f.save(),f.setTransform(1,0,0,1,0,0),T==="dots"||T==="grid"||T==="graph"){const N=T==="graph"?40:20,M=N/4,ct=W?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",at=W?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.03)",yt=W?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.07)",Tt=z%(N*E),It=H%(N*E);if(T==="dots"){f.fillStyle=ct;for(let J=Tt;J<n.width;J+=N*E)for(let wt=It;wt<n.height;wt+=N*E)f.beginPath(),f.arc(J,wt,1,0,Math.PI*2),f.fill()}else if(T==="grid"){f.strokeStyle=at,f.lineWidth=1,f.beginPath();for(let J=Tt;J<n.width;J+=N*E)f.moveTo(J,0),f.lineTo(J,n.height);for(let J=It;J<n.height;J+=N*E)f.moveTo(0,J),f.lineTo(n.width,J);f.stroke()}else if(T==="graph"){f.strokeStyle=at,f.lineWidth=.5,f.beginPath();for(let J=z%(M*E);J<n.width;J+=M*E)f.moveTo(J,0),f.lineTo(J,n.height);for(let J=H%(M*E);J<n.height;J+=M*E)f.moveTo(0,J),f.lineTo(n.width,J);f.stroke(),f.strokeStyle=yt,f.lineWidth=1,f.beginPath();for(let J=Tt;J<n.width;J+=N*E)f.moveTo(J,0),f.lineTo(J,n.height);for(let J=It;J<n.height;J+=N*E)f.moveTo(0,J),f.lineTo(n.width,J);f.stroke()}}f.restore()}if(f.save(),f.translate(z,H),f.scale(E,E),p.gridSettings.enabled){const T=p.gridSettings.gridSize;let N=p.gridSettings.gridColor;W&&N==="#e0e0e0"&&(N="#333333");const M=p.gridSettings.gridOpacity,ct=p.gridSettings.style||"lines";f.save(),f.setTransform(1,0,0,1,0,0),f.strokeStyle=N,f.fillStyle=N,f.globalAlpha=M,f.lineWidth=1;const at=Math.floor(-z/E/T)*T,yt=Math.ceil((n.width-z)/E/T)*T,Tt=Math.floor(-H/E/T)*T,It=Math.ceil((n.height-H)/E/T)*T;if(ct==="lines"){f.beginPath();for(let J=at;J<=yt;J+=T){const wt=J*E+z;f.moveTo(wt,0),f.lineTo(wt,n.height)}for(let J=Tt;J<=It;J+=T){const wt=J*E+H;f.moveTo(0,wt),f.lineTo(n.width,wt)}f.stroke()}else{!W&&ct==="dots"&&(N==="#e0e0e0"||N==="#fafafa")&&(f.fillStyle="#b0b0b0");for(let wt=at;wt<=yt;wt+=T)for(let vt=Tt;vt<=It;vt+=T){const Ct=wt*E+z,Ut=vt*E+H;Ct>=-3&&Ct<=n.width+3&&Ut>=-3&&Ut<=n.height+3&&(f.beginPath(),f.arc(Ct,Ut,3/2,0,Math.PI*2),f.fill())}}f.restore()}const O={minX:-z/E,maxX:(n.width-z)/E,minY:-H/E,maxY:(n.height-H)/E},G=(O.maxX-O.minX)*.1,it=(O.maxY-O.minY)*.1,tt=[...p.layers].sort((T,N)=>T.order-N.order);let et=0;const F=new Map;for(const T of p.elements)F.set(T.id,T);if(tt.forEach(T=>{if(!Ae(T.id))return;if(T.backgroundColor&&T.backgroundColor!=="transparent"){f.save(),f.globalAlpha=T.opacity,f.fillStyle=T.backgroundColor;const M=1e6;f.fillRect(-M,-M,M*2,M*2),f.restore()}const N=p.elements.filter(M=>{if(M.layerId!==T.id)return!1;if(M.id===a||T.isMaster)return!0;if(Sn(M,p.elements,F))return!1;if(M.type==="line"||M.type==="arrow"||M.type==="bezier"){if(M.startBinding){const Tt=F.get(M.startBinding.elementId);if(Tt&&Sn(Tt,p.elements,F))return!1}if(M.endBinding){const Tt=F.get(M.endBinding.elementId);if(Tt&&Sn(Tt,p.elements,F))return!1}}const ct=Math.abs(M.width)*E,at=Math.abs(M.height)*E;if(ct<1&&at<1)return!1;const yt=Math.max(Math.abs(M.width),Math.abs(M.height))*.5;return!(M.x+M.width+yt<O.minX-G||M.x-yt>O.maxX+G||M.y+M.height+yt<O.minY-it||M.y-yt>O.maxY+it)});et+=N.length,N.forEach(M=>{const ct=L.get(M.id),at=ct?{...M,x:ct.x,y:ct.y,angle:ct.angle}:JSON.parse(JSON.stringify(M)),yt=T.isMaster;if(yt&&p.docType==="slides"){const J=p.slides[p.activeSlideIndex];if(J){const{x:wt,y:vt}=J.spatialPosition;at.x+=wt,at.y+=vt}}let Tt=at.x+at.width/2,It=at.y+at.height/2;if(p.docType==="slides"&&!yt){const J=p.slides[p.activeSlideIndex];if(J){const{x:wt,y:vt}=J.spatialPosition,{width:Ct,height:Ut}=J.dimensions;if(!(Tt>=wt&&Tt<=wt+Ct&&It>=vt&&It<=vt+Ut))return}}if(at.type==="text"&&at.text){if(at.text.startsWith("=="))at.text=at.text.substring(1);else if(at.text.startsWith("=")){const J=(p.activeSlideIndex+1).toString(),wt=p.slides.length.toString();at.text=at.text.substring(1).replace(/\$\{slideNumber\}/g,J).replace(/\$\{totalSlides\}/g,wt)}}if(at.type!=="text"||d()!==at.id){const J=T?.opacity??1;Xe(U,f,at,W,J)}if(p.selection.includes(M.id)){const J=at.x,wt=at.y,vt=at.width,Ct=at.height,Ut=at.angle,gt=J+vt/2,Qt=wt+Ct/2;f.save(),Ut&&(f.translate(gt,Qt),f.rotate(Ut),f.translate(-gt,-Qt)),f.strokeStyle="#3b82f6",f.lineWidth=1/E;const Gt=2/E;if(M.type!=="line"&&M.type!=="arrow"&&M.type!=="bezier"&&M.type!=="organicBranch")f.strokeRect(J-Gt,wt-Gt,vt+Gt*2,Ct+Gt*2);else if(M.type==="organicBranch"&&M.points&&M.points.length>=2&&M.controlPoints&&M.controlPoints.length>=2){const Rt=Ht(M.points);if(Rt.length>=2){const le={x:M.x+Rt[0].x,y:M.y+Rt[0].y},te={x:M.x+Rt[Rt.length-1].x,y:M.y+Rt[Rt.length-1].y},de=Fs(le,te,M.controlPoints[0],M.controlPoints[1],M.strokeWidth);f.save(),f.strokeStyle="#3b82f6",f.lineWidth=2/E,f.beginPath(),f.moveTo(de[0].x,de[0].y);for(let Me=1;Me<de.length;Me++)f.lineTo(de[Me].x,de[Me].y);f.closePath(),f.stroke(),f.restore()}}if(p.selection.length===1){const Rt=8/E;if(f.fillStyle="#ffffff",f.strokeStyle="#3b82f6",f.lineWidth=2/E,M.type==="line"||M.type==="arrow"||M.type==="bezier"||M.type==="organicBranch"){let le=J,te=wt,de=J+vt,Me=wt+Ct;if(M.type==="organicBranch"&&M.points&&M.points.length>=2){const xe=Ht(M.points);xe.length>=2&&(le=M.x+xe[0].x,te=M.y+xe[0].y,de=M.x+xe[xe.length-1].x,Me=M.y+xe[xe.length-1].y)}[{x:le,y:te},{x:de,y:Me}].forEach(xe=>{f.beginPath(),f.arc(xe.x,xe.y,Rt/1.5,0,Math.PI*2),f.fill(),f.stroke()})}else{[{x:J-Gt,y:wt-Gt},{x:J+vt+Gt,y:wt-Gt},{x:J+vt+Gt,y:wt+Ct+Gt},{x:J-Gt,y:wt+Ct+Gt},{x:J+vt/2,y:wt-Gt},{x:J+vt+Gt,y:wt+Ct/2},{x:J+vt/2,y:wt+Ct+Gt},{x:J-Gt,y:wt+Ct/2}].forEach(de=>{f.fillRect(de.x-Rt/2,de.y-Rt/2,Rt,Rt),f.strokeRect(de.x-Rt/2,de.y-Rt/2,Rt,Rt)});const te={x:M.x+M.width/2,y:M.y-Gt-20/E};f.beginPath(),f.moveTo(M.x+M.width/2,M.y-Gt),f.lineTo(te.x,te.y),f.stroke(),f.beginPath(),f.arc(te.x,te.y,Rt/2,0,Math.PI*2),f.fill(),f.stroke()}}if(p.elements.some(Rt=>Rt.parentId===M.id)&&M.type!=="line"&&M.type!=="arrow"){const Rt=14/E,le=M.x+M.width+15/E,te=M.y+M.height/2;f.beginPath(),f.arc(le,te,Rt/2,0,Math.PI*2),f.fillStyle=M.isCollapsed?"#10b981":W?"#333":"#fff",f.fill(),f.strokeStyle="#10b981",f.lineWidth=2/E,f.stroke(),f.beginPath(),f.strokeStyle=M.isCollapsed?"#fff":"#10b981",f.lineWidth=2/E,f.moveTo(le-Rt/4,te),f.lineTo(le+Rt/4,te),M.isCollapsed&&(f.moveTo(le,te-Rt/4),f.lineTo(le,te+Rt/4)),f.stroke()}f.restore()}if(M.isCollapsed&&!p.selection.includes(M.id)){f.save(),M.angle&&(f.translate(Tt,It),f.rotate(M.angle),f.translate(-Tt,-It)),f.shadowBlur=10/E,f.shadowColor="#10b981",f.strokeStyle="#10b981",f.lineWidth=1/E;const J=1/E;f.strokeRect(M.x-J,M.y-J,M.width+J*2,M.height+J*2),f.restore()}if(p.selection.includes(M.id)&&(M.type==="isometricCube"||M.type==="star"||M.type==="burst"||M.type==="solidBlock"||M.type==="perspectiveBlock"||M.type==="cylinder")){const J=10/E;let wt=0,vt=0;if(M.type==="isometricCube"){const Ct=(M.shapeRatio!==void 0?M.shapeRatio:25)/100,Ut=(M.sideRatio!==void 0?M.sideRatio:50)/100,gt=M.height*Ct;vt=M.y+gt,wt=M.x+M.width*Ut}else if(M.type==="solidBlock"||M.type==="cylinder"){const Ct=M.depth!==void 0?M.depth:50,Ut=(M.viewAngle!==void 0?M.viewAngle:45)*Math.PI/180,gt=M.x+M.width/2,Qt=M.y+M.height/2;wt=gt+Ct*Math.cos(Ut),vt=Qt+Ct*Math.sin(Ut)}else if(M.type==="perspectiveBlock"){const Ct=M.depth!==void 0?M.depth:50,Ut=(M.viewAngle!==void 0?M.viewAngle:45)*Math.PI/180,gt=M.taper!==void 0?M.taper:0,Qt=(M.skewX!==void 0?M.skewX:0)*M.width,Gt=(M.skewY!==void 0?M.skewY:0)*M.height,Ot=M.x+M.width/2,Rt=M.y+M.height/2,le=Ct*Math.cos(Ut)+Qt,te=Ct*Math.sin(Ut)+Gt,de=1-gt,Me=M.width/2*de,Dn=M.height/2*de,xe=1-(M.frontTaper||0),ci=M.width/2*xe,di=M.height/2*xe,hi=(M.frontSkewX||0)*M.width,ui=(M.frontSkewY||0)*M.height,Hl=[{x:Ot+le,y:Rt+te,type:"depth"},{x:Ot+le-Me,y:Rt+te-Dn,type:"bTL"},{x:Ot+le+Me,y:Rt+te-Dn,type:"bTR"},{x:Ot+le+Me,y:Rt+te+Dn,type:"bBR"},{x:Ot+le-Me,y:Rt+te+Dn,type:"bBL"},{x:Ot+hi-ci,y:Rt+ui-di,type:"fTL"},{x:Ot+hi+ci,y:Rt+ui-di,type:"fTR"},{x:Ot+hi+ci,y:Rt+ui+di,type:"fBR"},{x:Ot+hi-ci,y:Rt+ui+di,type:"fBL"}];f.strokeStyle="#ffffff",f.lineWidth=1.5/E;for(const fi of Hl)fi.type==="depth"?f.fillStyle="#f59e0b":fi.type.startsWith("b")?f.fillStyle="#3b82f6":f.fillStyle="#10b981",f.beginPath(),f.arc(fi.x,fi.y,J/2,0,Math.PI*2),f.fill(),f.stroke();return}else if(M.type==="star"||M.type==="burst"){const Ct=(M.shapeRatio!==void 0?M.shapeRatio:25)/100;wt=M.x+M.width/2,vt=M.y+M.height*Ct}f.fillStyle="#f59e0b",f.strokeStyle="#ffffff",f.lineWidth=1.5/E,f.beginPath(),f.arc(wt,vt,J/2,0,Math.PI*2),f.fill(),f.stroke()}if(p.selection.includes(M.id)){if((M.type==="line"||M.type==="arrow"||M.type==="bezier"||M.type==="organicBranch")&&M.controlPoints&&p.selectedTool==="selection"){const J=10/E;if(M.controlPoints.length===1){const wt=M.controlPoints[0];let vt={x:M.x,y:M.y},Ct={x:M.x+M.width,y:M.y+M.height};if(M.points&&M.points.length>=2){const Qt=Ht(M.points);Qt.length>0&&(vt={x:M.x+Qt[0].x,y:M.y+Qt[0].y},Ct={x:M.x+Qt[Qt.length-1].x,y:M.y+Qt[Qt.length-1].y})}const Ut=.25*vt.x+.5*wt.x+.25*Ct.x,gt=.25*vt.y+.5*wt.y+.25*Ct.y;f.fillStyle="#3b82f6",f.strokeStyle="#ffffff",f.lineWidth=1.5/E,f.beginPath(),f.arc(Ut,gt,J/2,0,Math.PI*2),f.fill(),f.stroke()}else M.controlPoints.forEach(wt=>{f.fillStyle="#3b82f6",f.strokeStyle="#ffffff",f.lineWidth=1.5/E,f.beginPath(),f.arc(wt.x,wt.y,J/2,0,Math.PI*2),f.fill(),f.stroke()})}if(M.type!=="line"&&M.type!=="arrow"&&p.selectedTool==="selection"){const J=14/E,wt=32/E,vt=M.x+M.width/2,Ct=M.y+M.height/2;[{pos:"top",x:vt,y:M.y-wt},{pos:"right",x:M.x+M.width+wt,y:Ct},{pos:"bottom",x:vt,y:M.y+M.height+wt},{pos:"left",x:M.x-wt,y:Ct}].forEach(gt=>{const Qt=xt&&xt.elementId===M.id&&xt.handle===`connector-${gt.pos}`,Gt=Qt?J*1.3:J;f.strokeStyle=Qt?"rgba(16, 185, 129, 0.8)":"rgba(16, 185, 129, 0.4)",f.lineWidth=(Qt?2:1)/E,f.setLineDash([3/E,3/E]),f.beginPath(),gt.pos==="top"?(f.moveTo(gt.x,M.y),f.lineTo(gt.x,gt.y)):gt.pos==="right"?(f.moveTo(M.x+M.width,gt.y),f.lineTo(gt.x,gt.y)):gt.pos==="bottom"?(f.moveTo(gt.x,M.y+M.height),f.lineTo(gt.x,gt.y)):gt.pos==="left"&&(f.moveTo(M.x,gt.y),f.lineTo(gt.x,gt.y)),f.stroke(),f.setLineDash([]),f.shadowColor="rgba(16, 185, 129, 0.5)",f.shadowBlur=(Qt?8:4)/E,f.fillStyle=Qt?"#059669":"#10b981",f.strokeStyle="#ffffff",f.lineWidth=2/E,f.beginPath(),f.arc(gt.x,gt.y,Gt/2,0,Math.PI*2),f.fill(),f.stroke(),f.shadowBlur=0,f.strokeStyle="#ffffff",f.lineWidth=1.8/E;const Ot=Gt*.25;f.beginPath(),gt.pos==="top"?(f.moveTo(gt.x-Ot,gt.y+Ot/2),f.lineTo(gt.x,gt.y-Ot/2),f.lineTo(gt.x+Ot,gt.y+Ot/2)):gt.pos==="right"?(f.moveTo(gt.x-Ot/2,gt.y-Ot),f.lineTo(gt.x+Ot/2,gt.y),f.lineTo(gt.x-Ot/2,gt.y+Ot)):gt.pos==="bottom"?(f.moveTo(gt.x-Ot,gt.y-Ot/2),f.lineTo(gt.x,gt.y+Ot/2),f.lineTo(gt.x+Ot,gt.y-Ot/2)):gt.pos==="left"&&(f.moveTo(gt.x+Ot/2,gt.y-Ot),f.lineTo(gt.x-Ot/2,gt.y),f.lineTo(gt.x+Ot/2,gt.y+Ot)),f.stroke()})}}})}),p.selection.length>1){const T=gn();if(T){const N=p.viewState.scale,M=2/N,ct=8/N;f.save(),f.strokeStyle="#3b82f6",f.lineWidth=1/N,f.setLineDash([5/N,5/N]),f.strokeRect(T.x-M,T.y-M,T.width+M*2,T.height+M*2),f.setLineDash([]),f.fillStyle="#ffffff",f.lineWidth=2/N,[{x:T.x-M,y:T.y-M},{x:T.x+T.width+M,y:T.y-M},{x:T.x+T.width+M,y:T.y+T.height+M},{x:T.x-M,y:T.y+T.height+M},{x:T.x+T.width/2,y:T.y-M},{x:T.x+T.width+M,y:T.y+T.height/2},{x:T.x+T.width/2,y:T.y+T.height+M},{x:T.x-M,y:T.y+T.height/2}].forEach(yt=>{f.fillRect(yt.x-ct/2,yt.y-ct/2,ct,ct),f.strokeRect(yt.x-ct/2,yt.y-ct/2,ct,ct)}),f.restore()}}const rt=P();rt&&(f.save(),f.fillStyle="rgba(59, 130, 246, 0.2)",f.strokeStyle="#3b82f6",f.lineWidth=1/E,f.fillRect(rt.x,rt.y,rt.w,rt.h),f.strokeRect(rt.x,rt.y,rt.w,rt.h),f.restore());const bt=X();if(bt){const T=p.elements.find(N=>N.id===bt.elementId);T&&(f.save(),f.strokeStyle="#f59e0b",f.lineWidth=2/E,f.strokeRect(T.x-4/E,T.y-4/E,T.width+8/E,T.height+8/E),f.fillStyle="#f59e0b",f.beginPath(),f.arc(bt.px,bt.py,5/E,0,Math.PI*2),f.fill(),f.restore())}const $t=Q();$t.length>0&&(f.save(),f.strokeStyle="#ff00ff",f.setLineDash([5/p.viewState.scale,5/p.viewState.scale]),f.lineWidth=1/p.viewState.scale,$t.forEach(T=>{f.beginPath(),T.type==="vertical"?(f.moveTo(T.coordinate,-1e5),f.lineTo(T.coordinate,1e5)):(f.moveTo(-1e5,T.coordinate),f.lineTo(1e5,T.coordinate)),f.stroke()}),f.restore());const j=st();if(j.length>0&&(f.save(),f.strokeStyle="#ff00ff",f.fillStyle="#ff00ff",f.lineWidth=1/p.viewState.scale,f.font=`${Math.floor(10/p.viewState.scale)}px sans-serif`,f.textAlign="center",f.textBaseline="middle",j.forEach(T=>{T.segments.forEach(N=>{if(f.beginPath(),T.orientation==="horizontal"){f.moveTo(N.from,T.variableCoordinate),f.lineTo(N.to,T.variableCoordinate),f.stroke();const M=4/p.viewState.scale;f.beginPath(),f.moveTo(N.from,T.variableCoordinate-M),f.lineTo(N.from,T.variableCoordinate+M),f.moveTo(N.to,T.variableCoordinate-M),f.lineTo(N.to,T.variableCoordinate+M),f.stroke();const ct=(N.from+N.to)/2,at=Math.round(T.gap).toString(),yt=2/p.viewState.scale,Tt=f.measureText(at).width+yt*4,It=12/p.viewState.scale;f.fillStyle="#ff00ff",f.fillRect(ct-Tt/2,T.variableCoordinate-It/2,Tt,It),f.fillStyle="white",f.fillText(at,ct,T.variableCoordinate),f.fillStyle="#ff00ff"}else{f.beginPath(),f.moveTo(T.variableCoordinate,N.from),f.lineTo(T.variableCoordinate,N.to),f.stroke();const M=4/p.viewState.scale;f.beginPath(),f.moveTo(T.variableCoordinate-M,N.from),f.lineTo(T.variableCoordinate+M,N.from),f.moveTo(T.variableCoordinate-M,N.to),f.lineTo(T.variableCoordinate+M,N.to),f.stroke();const ct=(N.from+N.to)/2,at=Math.round(T.gap).toString(),yt=2/p.viewState.scale,Tt=f.measureText(at).width+yt*4,It=12/p.viewState.scale;f.fillStyle="#ff00ff",f.fillRect(T.variableCoordinate-Tt/2,ct-It/2,Tt,It),f.fillStyle="white",f.fillText(at,T.variableCoordinate,ct),f.fillStyle="#ff00ff"}})}),f.restore()),(p.selectedTool==="line"||p.selectedTool==="arrow")&&r&&a){const T=p.elements.find(N=>N.id===a);if(T&&(T.type==="line"||T.type==="arrow")){const N=T.x+T.width,M=T.y+T.height,ct=50/p.viewState.scale,at=15/p.viewState.scale;f.save();for(const yt of p.elements){if(yt.id===a||!ke(yt)||yt.type==="line"||yt.type==="arrow"||yt.type==="bezier"||yt.layerId!==p.activeLayerId)continue;const Tt=yt.x+yt.width/2,It=yt.y+yt.height/2;if(Math.sqrt((Tt-N)**2+(It-M)**2)<ct){const wt=Di(yt);for(const vt of wt){const Ct=vt.x-N,Ut=vt.y-M,Qt=Math.sqrt(Ct*Ct+Ut*Ut)<at,Gt=Qt?6/p.viewState.scale:4/p.viewState.scale;f.beginPath(),f.arc(vt.x,vt.y,Gt,0,Math.PI*2),Qt?(f.fillStyle="#3b82f6",f.fill()):(f.fillStyle="rgba(59, 130, 246, 0.4)",f.fill(),f.strokeStyle="#3b82f6",f.lineWidth=1/p.viewState.scale,f.stroke())}}}f.restore()}}if(Lt.length>1){f.save(),f.lineCap="round",f.lineJoin="round",f.shadowBlur=8,f.shadowColor="rgba(255, 50, 50, 0.6)";const T=4/p.viewState.scale;let N=-1;for(let M=0;M<Lt.length-1;M++){const ct=Lt[M],at=Lt[M+1],yt=v-ct.timestamp,Tt=Math.max(0,1-yt/ae);if(Tt<=0)continue;const It=Math.ceil(Tt*5);if(It!==N){N!==-1&&f.stroke(),N=It;const J=It/5;f.beginPath(),f.strokeStyle=`rgba(255, 30, 30, ${J})`,f.lineWidth=T*J,f.moveTo(ct.x,ct.y)}f.lineTo(at.x,at.y)}N!==-1&&f.stroke(),f.restore()}f.restore();const ht=performance.now()-R;Fh.measureFrame(ht,p.elements.length,et)}Vt(()=>{xo(),p.appMode,p.isPreviewing,p.theme,p.elements.length,p.elements.forEach(f=>{f.x,f.y,f.width,f.height,f.points&&f.points.length,f.angle,f.opacity,f.strokeColor,f.backgroundColor,f.fillStyle,f.strokeWidth,f.strokeStyle,f.roughness,f.roundness,f.text,f.fontSize,f.fontFamily,f.textAlign,f.fontWeight,f.fontStyle,f.textColor,f.textHighlightEnabled,f.textHighlightColor,f.textHighlightPadding,f.textHighlightRadius,f.startArrowhead,f.endArrowhead,f.containerText,f.labelPosition,f.isCollapsed,f.parentId,f.starPoints,f.polygonSides,f.borderRadius,f.burstPoints,f.tailPosition,f.shapeRatio,f.sideRatio,f.depth,f.viewAngle,f.taper,f.skewX,f.skewY,f.frontTaper,f.frontSkewX,f.frontSkewY,f.drawInnerBorder,f.innerBorderDistance,f.strokeLineJoin,f.renderStyle,f.fillDensity,f.gradientStart,f.gradientEnd,f.gradientDirection,f.gradientStops,f.gradientType,f.shadowEnabled,f.shadowColor,f.shadowBlur,f.shadowOffsetX,f.shadowOffsetY,f.blendMode,f.spinEnabled,f.spinSpeed,f.orbitEnabled,f.orbitCenterId,f.orbitRadius,f.orbitSpeed,f.orbitDirection}),p.slides.forEach(f=>{f.backgroundColor,f.fillStyle,f.gradientStops,f.gradientDirection,f.backgroundImage,f.backgroundOpacity}),p.viewState.scale,p.viewState.panX,p.viewState.panY,p.selection.length,P(),p.layers.length,p.layers.forEach(f=>{f.visible,f.order,f.opacity,f.backgroundColor}),p.gridSettings.enabled,p.gridSettings.gridSize,p.gridSettings.gridColor,p.gridSettings.gridOpacity,p.gridSettings.style,p.canvasBackgroundColor,p.canvasTexture,Q(),Q(),requestAnimationFrame(ue)}),Vt(()=>{p.elements.forEach(f=>{f.boundElements&&f.boundElements.length>0&&(f.x,f.y,f.width,f.height,pi(()=>{f.boundElements?.forEach(k=>Rn(k.id))}))})});const co=f=>({x:f.clientX,y:f.clientY}),Te=(f,k)=>{if(!n)return{x:0,y:0};const{scale:R,panX:C,panY:_}=p.viewState,L=n.getBoundingClientRect();return{x:(f-L.left-C)/R,y:(k-L.top-_)/R}},oi=f=>{f.dataTransfer&&(f.preventDefault(),f.dataTransfer.dropEffect="copy")},si=async f=>{f.preventDefault(),f.stopPropagation();const k=f.dataTransfer?.getData("text/plain");if(!k)return;const R=k.startsWith("color(")||k.startsWith("#")||k.startsWith("rgba(")||k.startsWith("rgb(")||k.startsWith("oklch(")||k.startsWith("hsl(")||k.includes("display-p3")||k.includes("oklch"),C=k.startsWith("http")||k.startsWith("data:image");if(!R&&!C)return;const{x:_,y:L}=Te(f.clientX,f.clientY),v=10/p.viewState.scale,W=new Map;for(const O of p.elements)W.set(O.id,O);const q=p.elements.map((O,G)=>{const it=p.layers.find(tt=>tt.id===O.layerId);return{el:O,index:G,layerOrder:it?.order??999,layerVisible:Ae(O.layerId)}}).sort((O,G)=>O.layerOrder!==G.layerOrder?G.layerOrder-O.layerOrder:G.index-O.index),E=window.yappyGlobalTime||0,z=p.appMode==="presentation"||p.isPreviewing,H=ko(p.elements,E,z);let U=null;for(const{el:O,layerVisible:G}of q){if(!G||!ke(O))continue;const it=H.get(O.id),tt=it?{...O,x:it.x,y:it.y,angle:it.angle}:O;if(Ge(tt,_,L,v,W)){U=O.id;break}}if(U)Mt(),R?Z(U,{backgroundColor:k,fillStyle:"solid"}):C&&Z(U,{type:"image",dataURL:k});else if(p.docType==="slides"){const O=p.activeSlideIndex;O!==-1?(Mt(),R?rn(O,{backgroundColor:k,fillStyle:"solid"}):C&&rn(O,{backgroundImage:k,fillStyle:"image"})):p.slides.length>0&&(Mt(),R?rn(0,{backgroundColor:k,fillStyle:"solid"}):C&&rn(0,{backgroundImage:k,fillStyle:"image"}))}},ho=f=>{if(p.appMode==="presentation"&&p.docType==="slides")return;f.preventDefault();const k=f.deltaMode===1?33:f.deltaMode===2?400:1,R=f.deltaX*k,C=f.deltaY*k;if(f.ctrlKey||f.metaKey){const L=1-C*.001,v=Math.min(Math.max(p.viewState.scale*L,.1),10),{x:W,y:q}=co(f),{scale:E,panX:z,panY:H}=p.viewState,U=(W-z)/E,O=(q-H)/E,G=W-U*v,it=q-O*v;ie({scale:v,panX:G,panY:it})}else f.shiftKey?ie({panX:p.viewState.panX-(C||R),panY:p.viewState.panY}):ie({panX:p.viewState.panX-R,panY:p.viewState.panY-C})},pn=(f,k,R,C,_)=>{const L=Math.cos(_),v=Math.sin(_);return{x:L*(f-R)-v*(k-C)+R,y:v*(f-R)+L*(k-C)+C}},yn=(f,k,R,C,_)=>pn(f,k,R,C,-_),gn=()=>{if(p.selection.length===0)return null;let f=1/0,k=1/0,R=-1/0,C=-1/0,_=!1;return p.elements.forEach(L=>{p.selection.includes(L.id)&&(f=Math.min(f,L.x),k=Math.min(k,L.y),R=Math.max(R,L.x+L.width),C=Math.max(C,L.y+L.height),_=!0)}),_?{x:f,y:k,width:R-f,height:C-k}:null},Ue=(f,k)=>{const{scale:R}=p.viewState,C=12/R,_=2/R;if(p.selection.length>1){const L=gn();if(L){const v=[{type:"tl",x:L.x-_,y:L.y-_},{type:"tr",x:L.x+L.width+_,y:L.y-_},{type:"br",x:L.x+L.width+_,y:L.y+L.height+_},{type:"bl",x:L.x-_,y:L.y+L.height+_},{type:"tm",x:L.x+L.width/2,y:L.y-_},{type:"rm",x:L.x+L.width+_,y:L.y+L.height/2},{type:"bm",x:L.x+L.width/2,y:L.y+L.height+_},{type:"lm",x:L.x-_,y:L.y+L.height/2}];for(const W of v)if(Math.abs(f-W.x)<=C/2&&Math.abs(k-W.y)<=C/2)return{id:"multi",handle:W.type}}}for(let L=p.elements.length-1;L>=0;L--){const v=p.elements[L];if(Sn(v,p.elements))continue;if(p.elements.some(q=>q.parentId===v.id)&&v.type!=="line"&&v.type!=="arrow"){const q=v.x+v.width/2,E=v.y+v.height/2,z=yn(f,k,q,E,v.angle||0),H=14/R,U=v.x+v.width+15/R,O=v.y+v.height/2;if(Math.sqrt(Math.pow(z.x-U,2)+Math.pow(z.y-O,2))<=H/2+5/R)return{id:v.id,handle:"mindmap-toggle"}}}for(let L=p.elements.length-1;L>=0;L--){const v=p.elements[L];if(!p.selection.includes(v.id)||p.selection.length>1)continue;const W=v.x+v.width/2,q=v.y+v.height/2,E=v.angle||0,z=yn(f,k,W,q,E);let H=[{type:"tl",x:v.x-_,y:v.y-_},{type:"tr",x:v.x+v.width+_,y:v.y-_},{type:"br",x:v.x+v.width+_,y:v.y+v.height+_},{type:"bl",x:v.x-_,y:v.y+v.height+_},{type:"tm",x:v.x+v.width/2,y:v.y-_},{type:"rm",x:v.x+v.width+_,y:v.y+v.height/2},{type:"bm",x:v.x+v.width/2,y:v.y+v.height+_},{type:"lm",x:v.x-_,y:v.y+v.height/2}];if(v.type==="line"||v.type==="arrow"||v.type==="organicBranch"){let O=v.x,G=v.y,it=v.x+v.width,tt=v.y+v.height;if(v.type==="organicBranch"&&v.points&&v.points.length>=2){const et=Ht(v.points);et.length>=2&&(O=v.x+et[0].x,G=v.y+et[0].y,it=v.x+et[et.length-1].x,tt=v.y+et[et.length-1].y)}H=[{type:"tl",x:O,y:G},{type:"br",x:it,y:tt}]}for(const O of H)if(Math.abs(z.x-O.x)<=C/2&&Math.abs(z.y-O.y)<=C/2)return{id:v.id,handle:O.type};const U={x:v.x+v.width/2,y:v.y-_-20/R};if(Math.abs(z.x-U.x)<=C&&Math.abs(z.y-U.y)<=C/2)return{id:v.id,handle:"rotate"};if(v.type==="isometricCube"){const O=(v.shapeRatio!==void 0?v.shapeRatio:25)/100,G=(v.sideRatio!==void 0?v.sideRatio:50)/100,it=v.height*O,tt=v.y+it,et=v.x+v.width*G;if(Math.abs(z.x-et)<=C&&Math.abs(z.y-tt)<=C)return{id:v.id,handle:"control-1"}}else if(v.type==="solidBlock"||v.type==="cylinder"){const O=v.depth!==void 0?v.depth:50,G=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,it=v.x+v.width/2,tt=v.y+v.height/2,et=it+O*Math.cos(G),F=tt+O*Math.sin(G);if(Math.abs(z.x-et)<=C&&Math.abs(z.y-F)<=C)return{id:v.id,handle:"control-1"}}else if(v.type==="perspectiveBlock"){const O=v.depth!==void 0?v.depth:50,G=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,it=v.taper!==void 0?v.taper:0,tt=(v.skewX!==void 0?v.skewX:0)*v.width,et=(v.skewY!==void 0?v.skewY:0)*v.height,F=v.x+v.width/2,rt=v.y+v.height/2,bt=O*Math.cos(G)+tt,$t=O*Math.sin(G)+et,j=1-it,ht=v.width/2*j,T=v.height/2*j,N=1-(v.frontTaper||0),M=v.width/2*N,ct=v.height/2*N,at=(v.frontSkewX||0)*v.width,yt=(v.frontSkewY||0)*v.height,Tt=[{x:F+bt,y:rt+$t,handle:"control-1"},{x:F+bt-ht,y:rt+$t-T,handle:"control-2"},{x:F+bt+ht,y:rt+$t-T,handle:"control-3"},{x:F+bt+ht,y:rt+$t+T,handle:"control-4"},{x:F+bt-ht,y:rt+$t+T,handle:"control-5"},{x:F+at-M,y:rt+yt-ct,handle:"control-6"},{x:F+at+M,y:rt+yt-ct,handle:"control-7"},{x:F+at+M,y:rt+yt+ct,handle:"control-8"},{x:F+at-M,y:rt+yt+ct,handle:"control-9"}];for(const It of Tt)if(Math.abs(z.x-It.x)<=C&&Math.abs(z.y-It.y)<=C)return{id:v.id,handle:It.handle}}else if(v.type==="star"||v.type==="burst"){const O=(v.shapeRatio!==void 0?v.shapeRatio:25)/100,G=v.x+v.width/2,it=v.y+v.height*O;if(Math.abs(z.x-G)<=C&&Math.abs(z.y-it)<=C)return{id:v.id,handle:"control-1"}}if((v.type==="line"||v.type==="arrow"||v.type==="bezier"||v.type==="organicBranch")&&v.controlPoints)if(v.controlPoints.length===1){const O=v.controlPoints[0];let G={x:v.x,y:v.y},it={x:v.x+v.width,y:v.y+v.height};if(v.points&&v.points.length>=2){const F=Ht(v.points);F.length>0&&(G={x:v.x+F[0].x,y:v.y+F[0].y},it={x:v.x+F[F.length-1].x,y:v.y+F[F.length-1].y})}const tt=.25*G.x+.5*O.x+.25*it.x,et=.25*G.y+.5*O.y+.25*it.y;if(Math.abs(f-tt)<=C/2&&Math.abs(k-et)<=C/2)return{id:v.id,handle:"control-0"}}else for(let O=0;O<v.controlPoints.length;O++){const G=v.controlPoints[O];if(Math.abs(f-G.x)<=C/2&&Math.abs(k-G.y)<=C/2)return{id:v.id,handle:`control-${O}`}}if(v.type!=="line"&&v.type!=="arrow"){const O=14/R,G=32/R,it=v.x+v.width/2,tt=v.y+v.height/2,et=[{type:"connector-top",x:it,y:v.y-G},{type:"connector-right",x:v.x+v.width+G,y:tt},{type:"connector-bottom",x:it,y:v.y+v.height+G},{type:"connector-left",x:v.x-G,y:tt}];for(const F of et)if(Math.sqrt(Math.pow(z.x-F.x,2)+Math.pow(z.y-F.y,2))<=O/2+2/R)return{id:v.id,handle:F.type}}}return null},ri=f=>{if(!f.points||f.points.length===0)return null;const k=Ht(f.points);let R=1/0,C=1/0,_=-1/0,L=-1/0;k.forEach(E=>{R=Math.min(R,E.x),C=Math.min(C,E.y),_=Math.max(_,E.x),L=Math.max(L,E.y)});const v=_-R,W=L-C,q=k.map(E=>({x:E.x-R,y:E.y-C}));return{x:f.x+R,y:f.y+C,width:v,height:W,points:q}},Ge=(f,k,R,C,_)=>{if(Sn(f,p.elements,_))return!1;const L=f.x+f.width/2,v=f.y+f.height/2,W=yn(k,R,L,v,f.angle||0);let q=Math.min(f.x,f.x+f.width),E=Math.max(f.x,f.x+f.width),z=Math.min(f.y,f.y+f.height),H=Math.max(f.y,f.y+f.height);if(f.type==="solidBlock"){const U=f.depth!==void 0?f.depth:50,O=(f.viewAngle!==void 0?f.viewAngle:45)*Math.PI/180,G=U*Math.cos(O),it=U*Math.sin(O);q=Math.min(q,q+G,E+G),E=Math.max(E,q+G,E+G),z=Math.min(z,z+it,H+it),H=Math.max(H,z+it,H+it)}else if(f.type==="perspectiveBlock"){const U=f.depth!==void 0?f.depth:50,O=(f.viewAngle!==void 0?f.viewAngle:45)*Math.PI/180,G=(f.skewX||0)*f.width,it=(f.skewY||0)*f.height,tt=U*Math.cos(O)+G,et=U*Math.sin(O)+it,F=f.taper||0,rt=f.width/2*(1-F),bt=f.height/2*(1-F),$t=f.x+f.width/2,j=f.y+f.height/2,ht=$t+tt-rt,T=$t+tt+rt,N=j+et-bt,M=j+et+bt;q=Math.min(q,ht,T),E=Math.max(E,ht,T),z=Math.min(z,N,M),H=Math.max(H,N,M)}if(W.x<q-C||W.x>E+C||W.y<z-C||W.y>H+C)return!1;if(f.type==="rectangle"||f.type==="solidBlock"||f.type==="isometricCube"||f.type==="perspectiveBlock")return!0;if(f.type==="diamond"){const U=f.x+f.width/2,O=f.y+f.height/2,G=Math.abs(W.x-U),it=Math.abs(W.y-O);return 2*G/f.width+2*it/f.height<=1}else{if(f.type==="circle")return $h(W,f.x,f.y,f.width,f.height,C);if(f.type==="line"||f.type==="arrow"){const U=f.x+f.width,O=f.y+f.height;if(f.curveType==="bezier"){const G=f.width,it=f.height;let tt={x:f.x,y:f.y},et={x:U,y:O};if(f.controlPoints&&f.controlPoints.length>0){const F={x:f.x,y:f.y},rt={x:U,y:O};if(f.controlPoints.length===2)return mi(W,F,f.controlPoints[0],f.controlPoints[1],rt,C);{const bt=f.controlPoints[0],$t={x:F.x+2/3*(bt.x-F.x),y:F.y+2/3*(bt.y-F.y)},j={x:rt.x+2/3*(bt.x-rt.x),y:rt.y+2/3*(bt.y-rt.y)};return mi(W,F,$t,j,rt,C)}}else return Math.abs(G)>Math.abs(it)?(tt={x:f.x+G/2,y:f.y},et={x:U-G/2,y:O},mi(W,{x:f.x,y:f.y},tt,et,{x:U,y:O},C)):(tt={x:f.x,y:f.y+it/2},et={x:U,y:O-it/2},mi(W,{x:f.x,y:f.y},tt,et,{x:U,y:O},C))}else if(f.curveType==="elbow"){const G=Ht(f.points);if(G&&G.length>0){const it={x:W.x-f.x,y:W.y-f.y};return Ai(it,G,C)}else return Ho(W,{x:f.x,y:f.y},{x:U,y:O})<=C}else{if(f.points&&f.points.length>0){const G=Ht(f.points);if(G.length>1){const it={x:W.x-f.x,y:W.y-f.y};return Ai(it,G,C)}}return Ho(W,{x:f.x,y:f.y},{x:f.x+f.width,y:f.y+f.height})<=C}}else if(f.type==="organicBranch"){const U=Ht(f.points),O=f.controlPoints||[];if(U.length<2||O.length<2)return!1;const G={x:f.x+U[0].x,y:f.y+U[0].y},it={x:f.x+U[U.length-1].x,y:f.y+U[U.length-1].y},tt=Fs(G,it,O[0],O[1],f.strokeWidth);return kh(W,tt)}else if((f.type==="fineliner"||f.type==="inkbrush"||f.type==="marker")&&f.points){const U={x:W.x-f.x,y:W.y-f.y},O=Ht(f.points);return Ai(U,O,C)}else{if(f.type==="text"||f.type==="image")return!0;if(f.type==="triangle"||f.type==="hexagon"||f.type==="octagon"||f.type==="parallelogram"||f.type==="star"||f.type==="cloud"||f.type==="heart"||f.type==="cross"||f.type==="checkmark"||f.type==="arrowLeft"||f.type==="arrowRight"||f.type==="arrowUp"||f.type==="arrowDown"||f.type==="capsule"||f.type==="stickyNote"||f.type==="callout"||f.type==="burst"||f.type==="speechBubble"||f.type==="ribbon"||f.type==="bracketLeft"||f.type==="bracketRight"||f.type==="database"||f.type==="document"||f.type==="predefinedProcess"||f.type==="internalStorage"||f.type==="server"||f.type==="loadBalancer"||f.type==="firewall"||f.type==="user"||f.type==="messageQueue"||f.type==="lambda"||f.type==="router"||f.type==="browser"||f.type==="trapezoid"||f.type==="rightTriangle"||f.type==="pentagon"||f.type==="septagon"||f.type==="starPerson"||f.type==="scroll"||f.type==="wavyDivider"||f.type==="doubleBanner"||f.type==="lightbulb"||f.type==="signpost"||f.type==="burstBlob"||f.type==="browserWindow"||f.type==="mobilePhone"||f.type==="ghostButton"||f.type==="inputField"||f.type==="polygon"||f.type==="dfdProcess"||f.type==="dfdDataStore"||f.type==="cylinder"||f.type==="stateStart"||f.type==="stateEnd"||f.type==="stateSync"||f.type==="activationBar"||f.type==="externalEntity"||f.type==="umlClass"||f.type==="umlInterface"||f.type==="umlActor"||f.type==="umlUseCase"||f.type==="umlNote"||f.type==="umlPackage"||f.type==="umlComponent"||f.type==="umlState"||f.type==="umlLifeline"||f.type==="umlFragment"||f.type==="umlSignalSend"||f.type==="umlSignalReceive"||f.type==="umlProvidedInterface"||f.type==="umlRequiredInterface")return!0}}return!1},ke=f=>f.locked?!1:!Cs(f.layerId),qe=(f,k,R)=>{const C=40/p.viewState.scale,_=25/p.viewState.scale;let L=null;for(const v of p.elements){if(v.id===R||!ke(v)||v.type==="line"||v.type==="arrow"||v.type==="bezier"||v.type==="organicBranch")continue;const W=p.layers.find(E=>E.id===p.activeLayerId);if(!W||v.layerId!==W.id)continue;let q=!1;if(v.type==="text"||v.type==="image"||v.type==="rectangle")f>=v.x-C&&f<=v.x+v.width+C&&k>=v.y-C&&k<=v.y+v.height+C&&(q=!0);else if(v.type==="circle"){const E=v.x+v.width/2,z=v.y+v.height/2,H=v.width/2+C,U=v.height/2+C;(f-E)**2/H**2+(k-z)**2/U**2<=1&&(q=!0)}else v.type,f>=v.x-C&&f<=v.x+v.width+C&&k>=v.y-C&&k<=v.y+v.height+C&&(q=!0);if(q){L=v;break}}if(L){const v=Ch(L,{x:f,y:k},_);if(v)return{element:L,snapPoint:{x:v.x,y:v.y},position:v.position};const W=Po(L,{x:f,y:k},5);if(W)return{element:L,snapPoint:W,position:"edge"}}return null},En=(f,k,R,C,_)=>{const L=k??f.x,v=R??f.y,W=C??f.x+f.width,q=_??f.y+f.height;if(f.curveType==="elbow"){const E=p.elements.find(U=>U.id===f.startBinding?.elementId),z=p.elements.find(U=>U.id===f.endBinding?.elementId);return Th({x:L,y:v},{x:W,y:q},p.elements,E,z,f.startBinding?.position,f.endBinding?.position).map(U=>({x:U.x-L,y:U.y-v}))}if(f.points&&f.points.length>=2)return[0,0,W-L,q-v]},Rn=f=>{const k=p.elements.find(E=>E.id===f);if(!k||k.type!=="line"&&k.type!=="arrow"&&k.type!=="organicBranch"&&k.type!=="bezier")return;let R=k.x,C=k.y,_=k.x+k.width,L=k.y+k.height,v=!1;const W=k.startBinding?p.elements.find(E=>E.id===k.startBinding?.elementId):null,q=k.endBinding?p.elements.find(E=>E.id===k.endBinding?.elementId):null;if(W&&q){const E=W.x+W.width/2,z=W.y+W.height/2,H=q.x+q.width/2,U=q.y+q.height/2,O=H-E,G=U-z,it=k.startBinding?.position,tt=k.endBinding?.position;let et,F;if(Math.abs(O)>Math.abs(G)?(et=O>0?"right":"left",F=O>0?"left":"right"):(et=G>0?"bottom":"top",F=G>0?"top":"bottom"),it!==et||tt!==F)return Z(k.id,{startBinding:{...k.startBinding,position:et},endBinding:{...k.endBinding,position:F}},!1),Rn(f)}if(k.startBinding){const E=W||p.elements.find(z=>z.id===k.startBinding.elementId);if(E){const z=k.startBinding.position;let H;if(z&&z!=="edge"){const O=Di(E).find(G=>G.position===z);O&&(H={x:O.x,y:O.y})}H||(H=Po(E,{x:_,y:L},k.startBinding.gap)),H&&(R=H.x,C=H.y,v=!0)}}if(k.endBinding){const E=q||p.elements.find(z=>z.id===k.endBinding.elementId);if(E){const z=k.endBinding.position;let H;if(z&&z!=="edge"){const O=Di(E).find(G=>G.position===z);O&&(H={x:O.x,y:O.y})}H||(H=Po(E,{x:R,y:C},k.endBinding.gap)),H&&(_=H.x,L=H.y,v=!0)}}if(v){const E=En(k,R,C,_,L);if(R!==k.x||C!==k.y||_-R!==k.width||L-C!==k.height||JSON.stringify(E)!==JSON.stringify(k.points)){const z={x:R,y:C,width:_-R,height:L-C,points:E};if(k.controlPoints&&k.controlPoints.length===2){const U=R-k.x,O=C-k.y,G=_-(k.x+k.width),it=L-(k.y+k.height),tt={x:k.controlPoints[0].x+U,y:k.controlPoints[0].y+O},et={x:k.controlPoints[1].x+G,y:k.controlPoints[1].y+it};z.controlPoints=[tt,et]}Z(k.id,z,!1)}}},ai=f=>{if(p.appMode==="presentation"){if(p.docType==="slides"){f.button===0&&bs();return}else if(f.button===0||f.button===1){x=!0,c=f.clientX,l=f.clientY,f.currentTarget.setPointerCapture(f.pointerId);return}}f.currentTarget.setPointerCapture(f.pointerId);const{x:k,y:R}=Te(f.clientX,f.clientY);if(d()){An();return}if(p.selectedTool==="selection"){const O=Ue(k,R);if(O){if(O.handle==="mindmap-toggle"){Yo(O.id);return}if(O.handle.startsWith("connector-")){const j=p.elements.find(ht=>ht.id===O.id);if(j){const ht=O.handle.replace("connector-",""),T=j.x+j.width/2,N=j.y+j.height/2;let M,ct;switch(ht){case"top":M=T,ct=j.y;break;case"right":M=j.x+j.width,ct=N;break;case"bottom":M=T,ct=j.y+j.height;break;case"left":M=j.x,ct=N;break;default:M=T,ct=N}Mt(),r=!0,c=M,l=ct,c=M,l=ct,a=ge("arrow"),ut={elementId:j.id,anchorPosition:ht,startX:M,startY:ct};const at={...p.defaultElementStyles,id:a,type:"arrow",x:M,y:ct,width:0,height:0,seed:Math.floor(Math.random()*2**31),layerId:p.activeLayerId,curveType:p.defaultElementStyles.curveType||"straight",startBinding:{elementId:j.id,focus:0,gap:5,position:ht}};sn(at);const yt=j.boundElements||[];Z(j.id,{boundElements:[...yt,{id:a,type:"arrow"}]});return}}if(Mt(),x=!0,S=O.handle,c=k,l=R,O.id==="multi"){const j=gn();if(j){Dt=j.x,Xt=j.y,lt=j.width,ft=j.height,B.clear();const ht=new Set(p.selection);p.selection.forEach(T=>{Mo(T,p.elements).forEach(N=>ht.add(N.id))}),p.elements.forEach(T=>{ht.has(T.id)&&B.set(T.id,{x:T.x,y:T.y,width:T.width,height:T.height,fontSize:T.fontSize,points:T.points?[...T.points]:void 0})})}}else{const j=p.elements.find(ht=>ht.id===O.id);j&&(Dt=j.x,Xt=j.y,lt=j.width,ft=j.height,_t=j.fontSize||20,B.clear(),B.set(j.id,{x:j.x,y:j.y,width:j.width,height:j.height,fontSize:j.fontSize,points:j.points?[...j.points]:void 0}))}return}let G=null;const it=10/p.viewState.scale,tt=Kh(p.elements,p.layers);for(const{groupId:j}of tt){const ht=p.elements.filter(N=>N.groupIds&&N.groupIds.includes(j));if(ht.some(N=>ke(N)&&Ae(N.layerId))&&Jh(k,R,j,p.elements)){const N=ht.map(ct=>ct.id),M=N.every(ct=>p.selection.includes(ct));if(f.shiftKey||f.ctrlKey||f.metaKey?M?$("selection",ct=>ct.filter(at=>!N.includes(at))):$("selection",ct=>[...new Set([...ct,...N])]):M||$("selection",N),p.selection.length>0){Mt(),x=!0,S=null,c=k,l=R,B.clear();const ct=new Set(p.selection);p.selection.forEach(at=>{Mo(at,p.elements).forEach(yt=>ct.add(yt.id))}),p.elements.forEach(at=>{ct.has(at.id)&&B.set(at.id,{x:at.x,y:at.y,width:at.width,height:at.height,fontSize:at.fontSize,points:at.points?[...at.points]:void 0,controlPoints:at.controlPoints?at.controlPoints.map(yt=>({...yt})):void 0})})}return}}const et=new Map;for(const j of p.elements)et.set(j.id,j);const F=p.elements.map((j,ht)=>{const T=p.layers.find(N=>N.id===j.layerId);return{el:j,index:ht,layerOrder:T?.order??999,layerVisible:Ae(j.layerId)}}).sort((j,ht)=>j.layerOrder!==ht.layerOrder?ht.layerOrder-j.layerOrder:ht.index-j.index),rt=window.yappyGlobalTime||0,bt=p.appMode==="presentation"||p.isPreviewing,$t=ko(p.elements,rt,bt);for(const{el:j,layerVisible:ht}of F){if(!ht||!ke(j))continue;const T=$t.get(j.id),N=T?{...j,x:T.x,y:T.y,angle:T.angle}:j;if(Ge(N,k,R,it,et)){G=j.id;break}}if(G){const j=p.elements.find(N=>N.id===G);let ht=[G];if(j&&j.groupIds&&j.groupIds.length>0){const N=j.groupIds[j.groupIds.length-1];ht=p.elements.filter(M=>M.groupIds&&M.groupIds.includes(N)).map(M=>M.id)}const T=ht.every(N=>p.selection.includes(N));if(f.shiftKey||f.ctrlKey||f.metaKey?T?$("selection",N=>N.filter(M=>!ht.includes(M))):$("selection",N=>[...new Set([...N,...ht])]):T||$("selection",ht),p.selection.length>0){Mt(),x=!0,S=null,c=k,l=R,B.clear();const N=new Set(p.selection);p.selection.forEach(M=>{Mo(M,p.elements).forEach(ct=>N.add(ct.id))}),p.elements.forEach(M=>{N.has(M.id)&&B.set(M.id,{x:M.x,y:M.y,width:M.width,height:M.height,fontSize:M.fontSize,points:M.points?[...M.points]:void 0,controlPoints:M.controlPoints?M.controlPoints.map(ct=>({...ct})):void 0})})}}else{if(p.selection.length>0){const j=gn();if(j){const ht=10/p.viewState.scale;if(k>=j.x-ht&&k<=j.x+j.width+ht&&R>=j.y-ht&&R<=j.y+j.height+ht){Mt(),x=!0,S=null,c=k,l=R,B.clear(),p.elements.forEach(T=>{p.selection.includes(T.id)&&B.set(T.id,{x:T.x,y:T.y,width:T.width,height:T.height,fontSize:T.fontSize,points:T.points?[...T.points]:void 0,controlPoints:T.controlPoints?T.controlPoints.map(N=>({...N})):void 0})});return}}}!f.shiftKey&&!f.ctrlKey&&!f.metaKey&&($("selection",[]),Hs(!1)),b=!0,c=k,l=R,A({x:k,y:R,w:0,h:0})}return}const C=p.layers.find(O=>O.id===p.activeLayerId);if(!C?.visible){Bt("Cannot draw on a hidden layer. Please show the layer first or select a visible layer.","error");return}if(C?.locked){Bt("Cannot draw on a locked layer. Please unlock the layer first or select an unlocked layer.","error");return}if(p.selectedTool==="text"){const O=ge("text"),G={...p.defaultElementStyles,id:O,type:"text",x:k,y:R,width:100,height:30,text:"",layerId:p.activeLayerId};sn(G),h(O),g(""),setTimeout(()=>w?.focus(),0);return}if(p.selectedTool==="laser"){r=!0,Lt=[{x:k,y:R,timestamp:Date.now()}],re=Date.now();return}if(p.selectedTool==="ink"){r=!0,c=k,l=R,a=ge("ink");const O={...p.defaultElementStyles,id:a,type:"ink",x:k,y:R,width:0,height:0,strokeColor:"#ef4444",strokeWidth:4,opacity:100,points:[0,0],pointsEncoding:"flat",ttl:Date.now()+3e3,layerId:p.activeLayerId,seed:Math.floor(Math.random()*2**31)};sn(O);return}if(p.selectedTool==="eraser"){r=!0;const O=10/p.viewState.scale,G=new Map;for(const it of p.elements)G.set(it.id,it);for(let it=p.elements.length-1;it>=0;it--){const tt=p.elements[it];ke(tt)&&Ae(tt.layerId)&&Ge(tt,k,R,O,G)&&Qe([tt.id])}return}if(p.selectedTool==="pan"){x=!0,ee("grabbing");return}r=!0,ce=[],jt=0;let _=k,L=R;if(p.gridSettings.snapToGrid){const O=Co(k,R,p.gridSettings.gridSize);_=O.x,L=O.y}c=_,l=L,a=ge(p.selectedTool);const v=p.selectedTool,W=v==="bezier"?"line":v,q=v==="bezier"||v==="organicBranch"?"bezier":p.defaultElementStyles.curveType||"straight";let E,z=_,H=L;if(v==="line"||v==="arrow"||v==="bezier"||v==="organicBranch"){const O=qe(_,L,a);O&&(E={elementId:O.element.id,focus:0,gap:5,position:O.position},z=O.snapPoint.x,H=O.snapPoint.y,c=z,l=H)}const U={...p.defaultElementStyles,id:a,type:W,x:z,y:H,width:0,height:0,seed:Math.floor(Math.random()*2**31)+1,layerId:p.activeLayerId,curveType:q,points:v==="fineliner"||v==="inkbrush"||v==="marker"?[0,0]:void 0,pointsEncoding:v==="fineliner"||v==="inkbrush"||v==="marker"?"flat":void 0,startBinding:E,strokeStyle:["rectangle","circle","diamond","triangle","hexagon","octagon","pentagon","septagon","star","cloud","heart","capsule","stickyNote","callout","speechBubble","database","document","cylinder","isometricCube","solidBlock","perspectiveBlock","umlClass","umlInterface","umlActor","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive"].includes(W)?"solid":p.defaultElementStyles.strokeStyle};if(W==="stickyNote"&&(U.backgroundColor="#fef08a",U.fillStyle="solid",U.strokeColor="#000000"),sn(U),E){const O=p.elements.find(G=>G.id===E.elementId);if(O){const G=O.boundElements||[];Z(O.id,{boundElements:[...G,{id:a,type:W}]})}}},uo=f=>{if(p.appMode==="presentation"){if(p.docType==="slides")return;x?(ie({panX:p.viewState.panX+f.movementX,panY:p.viewState.panY+f.movementY}),ee("grabbing")):ee("grab");return}let{x:k,y:R}=Te(f.clientX,f.clientY);if(p.selectedTool==="pan")ee(x?"grabbing":"grab");else if(p.selectedTool==="selection"&&!x){const C=Ue(k,R),_=xt;C?C.handle==="rotate"?ee("grab"):C.handle==="tl"||C.handle==="br"?ee("nwse-resize"):C.handle==="tr"||C.handle==="bl"?ee("nesw-resize"):C.handle==="tm"||C.handle==="bm"?ee("ns-resize"):C.handle==="lm"||C.handle==="rm"?ee("ew-resize"):C.handle.startsWith("connector-")?(ee("crosshair"),xt={elementId:C.id,handle:C.handle}):xt=null:(ee("default"),xt=null),(_&&!xt||!_&&xt||_&&xt&&(_.elementId!==xt.elementId||_.handle!==xt.handle))&&requestAnimationFrame(ue)}if(p.selectedTool==="pan"){x&&ie({panX:p.viewState.panX+f.movementX,panY:p.viewState.panY+f.movementY});return}if(p.selectedTool==="selection"){if(b){const C=k-c,_=R-l;A({x:C>0?c:c+C,y:_>0?l:l+_,w:Math.abs(C),h:Math.abs(_)});return}if(x&&p.selection.length>0){const C=p.selection[0],_=p.elements.find(L=>L.id===C);if(!_||S&&!ke(_))return;if(S){if((_.type==="line"||_.type==="arrow"||_.type==="organicBranch")&&(S==="tl"||S==="br")){const L=qe(k,R,_.id);L?(D({elementId:L.element.id,px:L.snapPoint.x,py:L.snapPoint.y,position:L.position}),k=L.snapPoint.x,R=L.snapPoint.y):D(null)}else D(null);if(S==="rotate"){const L=_.x+_.width/2,v=_.y+_.height/2,W=Math.atan2(R-v,k-L);Z(C,{angle:W+Math.PI/2})}else{let L=k,v=R;if(p.gridSettings.snapToGrid){const tt=Co(k,R,p.gridSettings.gridSize);L=tt.x,v=tt.y}const W=L-c,q=v-l;let E=Dt,z=Xt,H=lt,U=ft;S==="tl"?(E+=W,z+=q,H-=W,U-=q):S==="tr"?(z+=q,H+=W,U-=q):S==="bl"?(E+=W,H-=W,U+=q):S==="br"?(H+=W,U+=q):S==="tm"?(z+=q,U-=q):S==="bm"?U+=q:S==="lm"?(E+=W,H-=W):S==="rm"&&(H+=W);const O=p.selection.length>1,G=p.elements.find(tt=>tt.id===p.selection[0]);let it=f.shiftKey||p.selection.length===1&&G?.constrained;if(p.selection.length===1&&G?.type==="text"&&(it=!f.shiftKey),it&&lt!==0&&ft!==0){const tt=lt/ft;["tm","bm"].includes(S)?(H=U*tt,E=Dt+lt/2-H/2):["lm","rm"].includes(S)?(U=H/tt,z=Xt+ft/2-U/2):(Math.abs(H)/tt>Math.abs(U)?U=H/tt:H=U*tt,S==="tl"?(E=Dt+lt-H,z=Xt+ft-U):S==="tr"?z=Xt+ft-U:S==="bl"&&(E=Dt+lt-H))}if(S&&S.startsWith("control-")){const tt=parseInt(S.replace("control-",""),10),et=p.elements.find(F=>F.id===C);if(et){let F=et.controlPoints?[...et.controlPoints]:[];for(;F.length<=tt;)F.push({x:k,y:R});if(et.controlPoints&&et.controlPoints.length===1&&tt===0){let rt={x:et.x,y:et.y},bt={x:et.x+et.width,y:et.y+et.height};if(et.points&&et.points.length>=2){const ht=Ht(et.points);ht.length>0&&(rt={x:et.x+ht[0].x,y:et.y+ht[0].y},bt={x:et.x+ht[ht.length-1].x,y:et.y+ht[ht.length-1].y})}const $t=2*k-.5*rt.x-.5*bt.x,j=2*R-.5*rt.y-.5*bt.y;F[0]={x:$t,y:j}}else F[tt]={x:k,y:R};Z(et.id,{controlPoints:F})}if(S&&S.startsWith("control-")){const F=p.elements.find(rt=>rt.id===C);if(F){if(F.type==="isometricCube"&&S==="control-1"){let rt=(R-F.y)/F.height;rt=Math.max(.1,Math.min(.9,rt));const bt=Math.round(rt*100);let $t=(k-F.x)/F.width;$t=Math.max(0,Math.min(1,$t));const j=Math.round($t*100);Z(F.id,{shapeRatio:bt,sideRatio:j},!1)}else if((F.type==="solidBlock"||F.type==="cylinder")&&S==="control-1"){const rt=F.x+F.width/2,bt=F.y+F.height/2,$t=k-rt,j=R-bt;let ht=Math.sqrt($t*$t+j*j);ht=Math.round(ht);let T=Math.atan2(j,$t),N=Math.round(T*180/Math.PI);N<0&&(N+=360),Z(F.id,{depth:ht,viewAngle:N},!1)}else if(F.type==="perspectiveBlock"){if(S==="control-1"){const rt=F.x+F.width/2,bt=F.y+F.height/2,$t=k-rt-(F.skewX||0)*F.width,j=R-bt-(F.skewY||0)*F.height;let ht=Math.sqrt($t*$t+j*j),T=Math.atan2(j,$t),N=Math.round(T*180/Math.PI);N<0&&(N+=360),Z(F.id,{depth:Math.round(ht),viewAngle:N},!1)}else if(S==="control-2"||S==="control-3"||S==="control-4"||S==="control-5"){const rt=F.width/2,bt=F.height/2,$t=F.x+rt,j=F.y+bt,ht=(F.viewAngle||45)*Math.PI/180,T=F.depth||50,N=$t+T*Math.cos(ht),M=j+T*Math.sin(ht),ct=k-N,at=R-M,yt=S==="control-3"||S==="control-4"?1:-1,Tt=S==="control-4"||S==="control-5"?1:-1,It=Math.sqrt(ct*ct+at*at),J=Math.sqrt(rt*rt+bt*bt),wt=Math.max(0,Math.min(1,1-It/J)),vt=(ct-yt*rt*(1-wt))/F.width,Ct=(at-Tt*bt*(1-wt))/F.height;Z(F.id,{taper:wt,skewX:vt,skewY:Ct},!1)}else if(S==="control-6"||S==="control-7"||S==="control-8"||S==="control-9"){const rt=F.width/2,bt=F.height/2,$t=F.x+rt,j=F.y+bt,ht=k-$t,T=R-j,N=S==="control-7"||S==="control-8"?1:-1,M=S==="control-8"||S==="control-9"?1:-1,ct=Math.sqrt(ht*ht+T*T),at=Math.sqrt(rt*rt+bt*bt),yt=Math.max(0,Math.min(1,1-ct/at)),Tt=(ht-N*rt*(1-yt))/F.width,It=(T-M*bt*(1-yt))/F.height;Z(F.id,{frontTaper:yt,frontSkewX:Tt,frontSkewY:It},!1)}}else if((F.type==="star"||F.type==="burst")&&S==="control-1"){let rt=(R-F.y)/F.height;rt=Math.max(.1,Math.min(.9,rt));const bt=Math.round(rt*100);Z(F.id,{shapeRatio:bt},!1)}else if(F.type==="speechBubble"&&S==="control-1"){let rt=(k-F.x)/F.width,bt=(R-F.y)/F.height;rt=Math.max(-.5,Math.min(1.5,rt)),bt=Math.max(-.5,Math.min(1.5,bt)),Z(F.id,{tailX:rt,tailY:bt},!1)}}}}else if(O){const tt=lt===0?1:H/lt,et=ft===0?1:U/ft;p.selection.forEach(F=>{const rt=B.get(F);if(!rt)return;const bt=rt.x-Dt,$t=rt.y-Xt,j={x:E+bt*tt,y:z+$t*et,width:rt.width*tt,height:rt.height*et};if(rt.points)if(typeof rt.points[0]=="number"){const T=rt.points,N=[];for(let M=0;M<T.length;M+=2)N.push(T[M]*tt,T[M+1]*et);j.points=N}else j.points=rt.points.map(T=>({x:T.x*tt,y:T.y*et}));const ht=p.elements.find(T=>T.id===F);ht&&ht.type==="text"&&(j.fontSize=Math.max(8,(rt.fontSize||20)*et)),Z(F,j,!1)})}else{const tt=p.selection[0],et=p.elements.find(F=>F.id===tt);if(et){const F={x:E,y:z,width:H,height:U},rt=lt===0?1:H/lt,bt=ft===0?1:U/ft;if(et.type==="text"&&bt>0){let $t=_t*bt;$t=Math.max($t,8),F.fontSize=$t}if((et.type==="fineliner"||et.type==="inkbrush"||et.type==="marker")&&et.points){const $t=B.get(tt);if($t&&$t.points)if(et.pointsEncoding==="flat"||$t.points.length>0&&typeof $t.points[0]=="number"){const j=$t.points,ht=[];for(let T=0;T<j.length;T+=2)ht.push(j[T]*rt,j[T+1]*bt);F.points=ht}else F.points=$t.points.map(j=>({x:j.x*rt,y:j.y*bt,...j.p!==void 0?{p:j.p}:{}}))}if((et.type==="line"||et.type==="arrow"||et.type==="bezier")&&(F.points=En(et,E,z,E+H,z+U)),et.type==="organicBranch"){F.points=[0,0,H,U];const $t=E,j=z,ht=E+H,T=z+U,N={x:$t+H*.5,y:j},M={x:ht-H*.5,y:T};F.controlPoints=[N,M]}Z(tt,F,!1)}}}}else{let L=k-c,v=R-l;if(p.gridSettings.objectSnapping&&!f.shiftKey){const q=performance.now();if(q-zt>=Kt){const E=Bh(p.selection,p.elements,L,v,5/p.viewState.scale);L=E.dx,v=E.dy,ot(E.guides);const z=Wh(p.selection,p.elements,L,v,5/p.viewState.scale);L=z.dx,v=z.dy,dt(z.guides),zt=q}}else ot([]),dt([]);if(p.gridSettings.snapToGrid&&!f.shiftKey&&Q().length===0){const q=p.gridSettings.gridSize;L=Math.round(L/q)*q,v=Math.round(v/q)*q}const W=f.altKey;B.forEach((q,E)=>{if(W&&!p.selection.includes(E))return;const z=p.elements.find(H=>H.id===E);if(z&&ke(z)){const H={x:q.x+L,y:q.y+v};q.controlPoints&&(H.controlPoints=q.controlPoints.map(U=>({x:U.x+L,y:U.y+v}))),Z(E,H,!1),z.boundElements&&z.boundElements.forEach(U=>Rn(U.id))}})}}}if(p.selectedTool==="laser"){const C=Date.now();if(C-re>=Ft){re=C;const{x:_,y:L}=Te(f.clientX,f.clientY);Lt.length>=Le&&Lt.shift(),Lt.push({x:_,y:L,timestamp:C}),Zt||(Zt=!0,requestAnimationFrame(()=>{Zt=!1,ue()}))}}if(!r||!a){if(r&&p.selectedTool==="eraser"){const C=10/p.viewState.scale,_=new Map;for(const L of p.elements)_.set(L.id,L);for(let L=p.elements.length-1;L>=0;L--){const v=p.elements[L];ke(v)&&Ae(v.layerId)&&Ge(v,k,R,C,_)&&Qe([v.id])}}return}if(p.selectedTool==="fineliner"||p.selectedTool==="marker"||p.selectedTool==="inkbrush"||p.selectedTool==="ink"){const{x:C,y:_}=Te(f.clientX,f.clientY),L=C-c,v=_-l;ce.push(L,v);const W=Date.now();W-jt>=un?(jt=W,Fe()):Ce||(Ce=!0,requestAnimationFrame(()=>{Ce=!1,Fe()}))}else{let C=k,_=R;if(p.selectedTool==="line"||p.selectedTool==="arrow"||p.selectedTool==="bezier"||p.selectedTool==="organicBranch"||ut){if(a){const v=qe(k,R,a);v?(D({elementId:v.element.id,px:v.snapPoint.x,py:v.snapPoint.y,position:v.position}),C=v.snapPoint.x,_=v.snapPoint.y):D(null)}}else D(null);if(!X()&&p.gridSettings.snapToGrid){const v=Co(k,R,p.gridSettings.gridSize);C=v.x,_=v.y}const L={width:C-c,height:_-l};if(p.selectedTool==="organicBranch"){const v=C-c,W=_-l;L.points=[0,0,v,W];const q={x:c+v*.5,y:l},E={x:C-v*.5,y:_};L.controlPoints=[q,E]}Z(a,L)}if(x||r){const L=f.clientX,v=f.clientY;let W=0,q=0;L<50&&(W=10),L>window.innerWidth-50&&(W=-10),v<50&&(q=10),v>window.innerHeight-50&&(q=-10),(W!==0||q!==0)&&ie({panX:p.viewState.panX+W,panY:p.viewState.panY+q})}(r||x)&&requestAnimationFrame(ue)},Ze=f=>{if(f.currentTarget.releasePointerCapture(f.pointerId),p.appMode==="presentation"){if(p.docType==="slides")return;x=!1;return}if(p.selectedTool==="pan"){x=!1,ee("grab");return}if(p.selectedTool==="laser"){r=!1;const k=()=>{Lt.length>0&&(ue(),requestAnimationFrame(k))};requestAnimationFrame(k);return}if(ut&&r&&a){if(p.elements.find(R=>R.id===a)){if(X()){const R=X(),C={elementId:R.elementId,focus:0,gap:5};Z(a,{endBinding:C});const _=p.elements.find(L=>L.id===R.elementId);if(_){const L=_.boundElements||[];L.find(v=>v.id===a)||Z(_.id,{boundElements:[...L,{id:a,type:"arrow"}]})}}$("selection",[a])}r=!1,a=null,ut=null,D(null),requestAnimationFrame(ue);return}if(p.selectedTool==="selection"){if(b){const k=P();if(k){const R=[],C=k.x,_=k.y,L=k.w,v=k.h;if(p.elements.forEach(W=>{const q=W.x,E=W.y,z=W.width,H=W.height,U=Math.min(q,q+z),O=Math.max(q,q+z),G=Math.min(E,E+H),it=Math.max(E,E+H);C<O&&C+L>U&&_<it&&_+v>G&&R.push(W.id)}),f.shiftKey||f.ctrlKey||f.metaKey){const W=new Set(p.selection);R.forEach(q=>W.add(q)),$("selection",Array.from(W))}else $("selection",R)}b=!1,A(null)}if(x){const k=X();if(k&&p.selection.length===1&&S){const R=p.selection[0],C=p.elements.find(_=>_.id===R);if(C&&(C.type==="line"||C.type==="arrow"||C.type==="organicBranch")){const _=S==="tl",L={elementId:k.elementId,focus:0,gap:5,position:k.position};Z(R,_?{startBinding:L}:{endBinding:L});const v=p.elements.find(W=>W.id===k.elementId);if(v){const W=v.boundElements||[];W.find(q=>q.id===R)||Z(v.id,{boundElements:[...W,{id:R,type:C.type}]})}}}D(null)}x=!1,S=null,B.clear(),ot([]);return}if(r&&a){const k=p.elements.find(R=>R.id===a);if(k){if((k.type==="line"||k.type==="arrow"||k.type==="bezier"||k.type==="organicBranch")&&X()){const C=X(),_={elementId:C.elementId,focus:0,gap:5,position:C.position};Z(a,{endBinding:_});const L=p.elements.find(v=>v.id===C.elementId);if(L){const v=L.boundElements||[];Z(L.id,{boundElements:[...v,{id:a,type:k.type}]})}D(null)}if(["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","browserWindow","mobilePhone","ghostButton","inputField"].includes(k.type))k.width<0&&Z(a,{x:k.x+k.width,width:Math.abs(k.width)}),k.height<0&&Z(a,{y:k.y+k.height,height:Math.abs(k.height)});else if(k.type==="fineliner"||k.type==="inkbrush"||k.type==="marker"||k.type==="ink"){Fe();const C=p.elements.find(_=>_.id===a);if(C&&C.points&&C.points.length>2){const _=ri({...C,points:C.points});_&&Z(a,_)}}else if(k.type==="organicBranch"){k.x,k.y,k.width,k.height;const C=Math.min(k.x,k.x+k.width),_=Math.min(k.y,k.y+k.height),L=Math.abs(k.width),v=Math.abs(k.height),W=k.x-C,q=k.y-_,E=k.x+k.width-C,z=k.y+k.height-_,H=E-W,U={x:C+W+H*.5,y:_+q},O={x:C+E-H*.5,y:_+z};Z(a,{x:C,y:_,width:L,height:v,points:[W,q,E,z],controlPoints:[U,O]})}["selection","pan","eraser","fineliner","inkbrush","marker","text","block-text"].includes(p.selectedTool)||Et("selection"),ut&&($("selection",[a]),Et("selection"))}}r=!1,a=null,ut=null},An=()=>{const f=d();if(!f)return;const k=p.elements.find(C=>C.id===f);if(!k)return;const R=m().trim();if(k.type==="text")if(R){let C=0,_=0;if(n){const L=n.getContext("2d");if(L){const v=k.fontSize||20;L.font=`${v}px sans-serif`,C=L.measureText(R).width,_=v}}C=Math.max(C,10),_=Math.max(_,10),Z(f,{text:R,width:C,height:_},!0)}else Qe([f]);else{const C=k.type==="line"||k.type==="arrow"||k.type==="organicBranch",_=u();if(k.autoResize&&n&&!C&&_==="containerText"){const L=n.getContext("2d");if(L){const v=qs(L,k,R);Z(f,{[_]:R,width:v.width,height:v.height},!0)}else Z(f,{[_]:R},!0)}else Z(f,{[_]:R},!0)}h(null),g(""),requestAnimationFrame(ue)},fo=f=>{if(f.preventDefault(),p.selectedTool!=="selection")return;const{x:k,y:R}=Te(f.clientX,f.clientY),C=10/p.viewState.scale,_=new Map;for(const L of p.elements)_.set(L.id,L);for(let L=p.elements.length-1;L>=0;L--){const v=p.elements[L];if(ke(v)&&Ae(v.layerId)&&Ge(v,k,R,C,_)){if(["star","burst","speechBubble","isometricCube","solidBlock","perspectiveBlock"].includes(v.type)){const q=Ue(k,R);if(q&&q.handle.startsWith("control-"))return}if(v.type==="line"||v.type==="arrow"||v.type==="bezier"){const q=v.controlPoints?[...v.controlPoints]:[];if(q.length>=2)return;q.push({x:k,y:R}),Z(v.id,{controlPoints:q,curveType:"bezier"},!0);return}if(["rectangle","circle","diamond","line","arrow","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","starPerson","scroll","wavyDivider","doubleBanner","lightbulb","signpost","burstBlob","browserWindow","mobilePhone","ghostButton","inputField","dfdProcess","dfdDataStore","isometricCube","solidBlock","perspectiveBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","umlClass","umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].includes(v.type)){if(h(v.id),v.type==="umlClass"){const q=R-v.y,E=n?.getContext("2d");let z=30;if(v.containerText&&E){const U=ve(E,v,v.containerText,v.width-10);z=Math.max(30,U.textHeight+20)}let H=20;if(v.attributesText&&E){const U=ve(E,{...v,fontSize:(v.fontSize||20)*.9},v.attributesText,v.width-10);H=Math.max(20,U.textHeight+10)}q<z?(y("containerText"),g(v.containerText||"")):q<z+H?(y("attributesText"),g(v.attributesText||"")):(y("methodsText"),g(v.methodsText||""))}else if(v.type==="umlState"){const q=R-v.y,E=n?.getContext("2d");let z=35;if(v.containerText&&E){const H=ve(E,v,v.containerText,v.width-20);z=Math.max(35,H.textHeight+15)}q<z?(y("containerText"),g(v.containerText||"")):(y("attributesText"),g(v.attributesText||""))}else if(v.type==="umlFragment"){const q=R-v.y,E=k-v.x,z=Math.min(v.width*.3,60),H=Math.min(v.height*.12,22)+5;E<z&&q<H?(y("containerText"),g(v.containerText||"")):(y("attributesText"),g(v.attributesText||""))}else y("containerText"),g(v.containerText||"");setTimeout(()=>w?.focus(),0);return}break}}},po=()=>{d()&&An()},tn=()=>{const f=d();return f?p.elements.find(k=>k.id===f):null};Vt(()=>{d()&&w&&(w.style.height="auto",w.style.height=w.scrollHeight+"px")});const[yo,li]=kt(!1);Vt(()=>{const{scale:f,panX:k,panY:R}=p.viewState;if(!n||p.elements.length===0){li(!1);return}const C=-k/f,_=-R/f,L=n.width/f,v=n.height/f;let W=1/0,q=1/0,E=-1/0,z=-1/0;p.elements.forEach(U=>{const O=U.x,G=U.x+U.width,it=U.y,tt=U.y+U.height;W=Math.min(W,O,G),E=Math.max(E,O,G),q=Math.min(q,it,tt),z=Math.max(z,it,tt)});const H=!(W>C+L||E<C||q>_+v||z<_);li(!H)});const Ie=()=>{if(p.elements.length===0)return;let f=1/0,k=1/0,R=-1/0,C=-1/0;p.elements.forEach(O=>{const G=O.x,it=O.x+O.width,tt=O.y,et=O.y+O.height;f=Math.min(f,G,it),R=Math.max(R,G,it),k=Math.min(k,tt,et),C=Math.max(C,tt,et)});const _=R-f,L=C-k,v=f+_/2,W=k+L/2,{scale:q}=p.viewState,E=window.innerWidth/2,z=window.innerHeight/2,H=-v*q+E,U=-W*q+z;ie({panX:H,panY:U})};hn(()=>{zh(()=>{ue()}),window.addEventListener("resize",me),document.addEventListener("fullscreenchange",me),me(),oe(()=>{window.removeEventListener("resize",me),document.removeEventListener("fullscreenchange",me)})});const en=()=>{const f=p.selection.length,k=f>0,R=[];if(k){R.push({label:"Copy",shortcut:"Ctrl+C",onClick:so},{label:"Paste",shortcut:"Ctrl+V",onClick:Gi},{label:"Cut",shortcut:"Ctrl+X",onClick:Rs},{label:"Duplicate",shortcut:"Ctrl+D",onClick:()=>p.selection.forEach(z=>gl(z))},{separator:!0});const C=p.selection[0],_=p.elements.find(z=>z.id===C);if(_){const z=[];if(f===1&&(z.push({label:"Add Child",onClick:()=>ys(C)}),_.parentId&&z.push({label:"Add Sibling",onClick:()=>gs(C)}),z.push({separator:!0})),_.parentId&&z.push({label:"Clear Parent",onClick:()=>vh(C)}),p.elements.some(O=>O.parentId===C)&&z.push({label:_.isCollapsed?"Expand Subtree":"Collapse Subtree",onClick:()=>Yo(C)}),f===2){const O=p.selection[0],G=p.selection[1];z.push({label:"Set as Child of Selected",onClick:()=>Ml(O,G)})}const U=[{label:"Horizontal (Right)",icon:"",onClick:()=>vn(C,"horizontal-right")},{label:"Horizontal (Left)",icon:"",onClick:()=>vn(C,"horizontal-left")},{label:"Vertical (Down)",icon:"",onClick:()=>vn(C,"vertical-down")},{label:"Vertical (Up)",icon:"",onClick:()=>vn(C,"vertical-up")},{label:"Radial (Neuron)",icon:"",onClick:()=>vn(C,"radial")}];z.push({separator:!0}),z.push({label:"Auto Layout",submenu:U,icon:""}),z.push({label:"Auto Style Branch",icon:"",onClick:()=>Pl(C)}),z.length>0&&R.push({label:"Hierarchy",submenu:z})}const L=p.selection.map(z=>p.elements.find(H=>H.id===z)).filter(Boolean),v=L.filter(z=>{const H=z.type;return H!=="line"&&H!=="arrow"&&H!=="bezier"&&H!=="organicBranch"&&H!=="text"&&H!=="image"}),W=L.filter(z=>{const H=z.type;return H==="line"||H==="arrow"||H==="bezier"||H==="organicBranch"});if(v.length>0){let z=Qs(v[0].type);new Set(v.map(U=>U.type)).size>1&&z.push(v[0].type),z.length>0&&R.push({label:v.length>1?`Transform ${v.length} Shapes`:"Transform Shape",submenu:z.map(U=>({icon:Vs(U),tooltip:Js(U),onClick:()=>{Mt(),v.forEach(O=>js(O.id,U,!1)),requestAnimationFrame(ue)}})),gridColumns:3})}if(W.length>0){let z=Qs(W[0].type);new Set(W.map(U=>U.type)).size>1&&z.push(W[0].type),z.length>0&&R.push({label:W.length>1?`Transform ${W.length} Connectors`:"Transform Connector",submenu:z.map(U=>({icon:Vs(U),tooltip:Js(U),onClick:()=>{Mt(),W.forEach(O=>js(O.id,U,!1)),requestAnimationFrame(ue)}})),gridColumns:3})}if(W.length>0){const H=W[0].curveType||"straight",U=qh(H);new Set(W.map(G=>G.curveType||"straight")).size>1&&U.push(H),U.length>0&&R.push({label:W.length>1?"Change All Curve Styles":"Change Curve Style",submenu:U.map(G=>({icon:jh(G),tooltip:Qh(G),onClick:()=>{Mt(),W.forEach(it=>Z(it.id,{curveType:G},!1)),requestAnimationFrame(ue)}})),gridColumns:3})}R.push({separator:!0}),f>1&&R.push({label:"Group",shortcut:"Ctrl+G",onClick:ks}),p.selection.some(z=>{const H=p.elements.find(U=>U.id===z);return H?.groupIds&&H.groupIds.length>0})&&R.push({label:"Ungroup",shortcut:"Ctrl+Shift+G",onClick:Ms}),R.push({separator:!0}),R.push({label:"Export as PNG",onClick:()=>Lu(2,!0,!0)},{label:"Export as SVG",onClick:()=>Eu(!0)}),R.push({separator:!0}),R.push({label:"Bring to Front",shortcut:"Ctrl+]",onClick:()=>ms(p.selection)},{label:"Send to Back",shortcut:"Ctrl+[",onClick:()=>xs(p.selection)},{label:"Bring Forward",onClick:()=>p.selection.forEach(z=>Wo(z,"forward"))},{label:"Send Backward",onClick:()=>p.selection.forEach(z=>Wo(z,"backward"))},{separator:!0}),f===1&&R.push({label:"Copy Styles",shortcut:"Ctrl+Alt+C",onClick:As},{label:"Paste Styles",shortcut:"Ctrl+Alt+V",onClick:Ds},{separator:!0});const E=p.selection.some(z=>p.elements.find(H=>H.id===z)?.locked);R.push({label:E?"Unlock":"Lock",shortcut:"Ctrl+Shift+L",onClick:()=>Hh(!E)},{label:"Flip Horizontal",shortcut:"Shift+H",onClick:()=>Gs("horizontal")},{label:"Flip Vertical",shortcut:"Shift+V",onClick:()=>Gs("vertical")},{separator:!0},{label:"Delete",shortcut:"Delete",onClick:()=>Qe(p.selection)},{separator:!0},{label:"Show Properties",onClick:()=>$n(!0)})}else R.push({label:"Paste",shortcut:"Ctrl+V",onClick:Gi},{separator:!0},{label:"Select all",shortcut:"Ctrl+A",onClick:()=>$("selection",p.elements.map(C=>C.id))},{label:"Zoom to Fit",shortcut:"Shift+1",onClick:Ps},{separator:!0},{label:"Show Grid",checked:p.gridSettings.enabled,onClick:Ts},{label:"Snap to Grid",checked:p.gridSettings.snapToGrid,onClick:Is},{label:"Smart Snapping",checked:p.gridSettings.objectSnapping,onClick:()=>$("gridSettings","objectSnapping",!p.gridSettings.objectSnapping)},{separator:!0},{label:"Zen Mode",shortcut:"Alt+Z",checked:p.zenMode,onClick:Ls},{label:"Reset View",onClick:()=>ie({scale:1,panX:0,panY:0})},{separator:!0},{label:"Canvas Settings",onClick:()=>Hs(!0)});return R};return[(()=>{var f=Ou();f.$$contextmenu=R=>{R.preventDefault(),ii({x:R.clientX,y:R.clientY}),ni(!0)},f.addEventListener("drop",si),f.addEventListener("dragover",oi),f.$$dblclick=fo,f.$$pointerup=Ze,f.$$pointermove=uo,f.$$pointerdown=ai,f.addEventListener("wheel",ho);var k=n;return typeof k=="function"?Wt(k,f):n=f,pt(R=>Yt(f,"cursor",fn())),f})(),I(St,{get when(){return Cn(()=>p.canvasTexture!=="none"&&p.canvasTexture!=="grid")()&&p.canvasTexture!=="graph"},get children(){var f=_u();return pt(k=>{var R=p.theme==="dark"?.1:.4,C=p.canvasTexture==="paper"?`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opactiy='0.5'/%3E%3C/svg%3E")`:p.canvasTexture==="dots"?`radial-gradient(${p.theme==="dark"?"#ffffff":"#000000"} 1px, transparent 1px)`:"none",_=p.canvasTexture==="dots"?"20px 20px":"auto";return R!==k.e&&Yt(f,"opacity",k.e=R),C!==k.t&&Yt(f,"background-image",k.t=C),_!==k.a&&Yt(f,"background-size",k.a=_),k},{e:void 0,t:void 0,a:void 0}),f}}),I(St,{get when(){return yo()},get children(){var f=zu(),k=f.firstChild;return k.$$click=Ie,f}}),I(St,{get when(){return Cn(()=>!!d())()&&tn()},children:f=>{const k=tn(),R=al(k.id),C=R?R.x:k.x,_=R?R.y:k.y,L=R?R.width:k.width,v=R?R.height:k.height,{scale:W,panX:q,panY:E}=p.viewState;let z=(C+L/2)*W+q,H=(_+v/2)*W+E,U="center",O=k.fontSize||20;if(k.type==="umlClass"){const G=u();if(G==="attributesText"||G==="methodsText"){U="left",O=O*.9;const it=n?n.getContext("2d"):null;let tt=30;if(k.containerText&&it){const rt=ve(it,k,k.containerText,k.width-10);tt=Math.max(30,rt.textHeight+20)}let et=tt,F=20;if(k.attributesText&&it){const rt=ve(it,{...k,fontSize:O},k.attributesText,k.width-10);F=Math.max(20,rt.textHeight+10)}if(G==="attributesText")H=(_+et+F/2)*W+E,z=(C+L/2)*W+q;else if(G==="methodsText"){const rt=et+F;H=(_+rt+20)*W+E,z=(C+L/2)*W+q}}}return(()=>{var G=Bu();G.$$keydown=tt=>{tt.key==="Escape"&&(tt.preventDefault(),h(null),g(""))},G.addEventListener("blur",po),G.$$input=tt=>g(tt.currentTarget.value);var it=w;return typeof it=="function"?Wt(it,G):w=G,Yt(G,"top",`${H}px`),Yt(G,"left",`${z}px`),Yt(G,"text-align",U),pt(tt=>{var et=`${O*W}px ${k.fontFamily==="sans-serif"?"Inter, sans-serif":k.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive"}`,F=k.strokeColor;return et!==tt.e&&Yt(G,"font",tt.e=et),F!==tt.t&&Yt(G,"color",tt.t=F),tt},{e:void 0,t:void 0}),pt(()=>G.value=m()),G})()}}),I(St,{get when(){return lo()},get children(){return I(Cl,{get x(){return Ke().x},get y(){return Ke().y},get items(){return en()},onClose:()=>ni(!1)})}}),I(St,{get when(){return p.isRecording},get children(){return I(Du,{onStop:s})}}),I(St,{get when(){return p.pathEditState.isActive},get children(){return I(Fu,{get elementId(){return p.pathEditState.elementId},get animationId(){return p.pathEditState.animationId},get scale(){return p.viewState.scale},get panX(){return p.viewState.panX},get panY(){return p.viewState.panY}})}}),I(St,{get when(){return p.minimapVisible},get children(){return I(Yh,{get canvasWidth(){return n?.width||window.innerWidth},get canvasHeight(){return n?.height||window.innerHeight}})}})]},Fu=n=>{const t=mo(()=>p.elements.find(i=>i.id===n.elementId)),e=mo(()=>{const i=t();if(!i||!n.animationId)return[];const s=i.animations?.find(r=>r.id===n.animationId);return!s||s.type!=="path"?[]:ln.svgToPoints(s.pathData)}),o=mo(()=>{const i=t();if(!i)return`translate(${n.panX}, ${n.panY}) scale(${n.scale})`;const r=i.animations?.find(l=>l.id===n.animationId)?.isRelative??!0,a=r?i.x+i.width/2:0,c=r?i.y+i.height/2:0;return`translate(${n.panX}, ${n.panY}) scale(${n.scale}) translate(${a}, ${c})`});return I(St,{get when(){return Cn(()=>!!t())()&&e().length>0},get children(){var i=Wu(),s=i.firstChild,r=s.firstChild,a=s.nextSibling,c=a.nextSibling;return Y(i,I(ze,{get each(){return e()},children:(l,d)=>{const h=t(),y=(h.animations?.find(b=>b.id===n.animationId)).isRelative??!0;let m=l.x,g=l.y;if(y){const b=h.x+h.width/2,S=h.y+h.height/2;m=b+l.x,g=S+l.y}const w=m*n.scale+n.panX,x=g*n.scale+n.panY;return(()=>{var b=Xu();return b.$$pointerdown=S=>{S.stopPropagation(),S.currentTarget.setPointerCapture(S.pointerId);const P=S.clientX,A=S.clientY,B={...l},X=Q=>{const ot=(Q.clientX-P)/n.scale,st=(Q.clientY-A)/n.scale,dt=[...e()];dt[d()]={...dt[d()],x:B.x+ot,y:B.y+st};const ut=ln.pointsToSvg(dt);Ns(n.elementId,n.animationId,{pathData:ut})},D=Q=>{S.currentTarget.releasePointerCapture(Q.pointerId),window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",D),Mt()};window.addEventListener("pointermove",X),window.addEventListener("pointerup",D)},Yt(b,"left",`${w}px`),Yt(b,"top",`${x}px`),pt(S=>{var P=l.type==="anchor"?"#3b82f6":"#ffffff",A=`Point ${d()}: ${l.type}`;return P!==S.e&&Yt(b,"background",S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})()}}),s),a.$$pointerdown=l=>{l.stopPropagation();const d=t(),u=(d.animations?.find(S=>S.id===n.animationId)).isRelative??!0,y=(l.clientX-n.panX)/n.scale,m=(l.clientY-n.panY)/n.scale;let g=y,w=m;if(u){const S=d.x+d.width/2,P=d.y+d.height/2;g=y-S,w=m-P}const x=[...e()];x.push({x:g,y:w,type:"anchor"});const b=ln.pointsToSvg(x);Ns(n.elementId,n.animationId,{pathData:b})},c.$$click=()=>Wd(!1),pt(l=>{var d=t()?.animations?.find(u=>u.id===n.animationId)?.pathData||"",h=o();return d!==l.e&&mt(r,"d",l.e=d),h!==l.t&&mt(r,"transform",l.t=h),l},{e:void 0,t:void 0}),i}})};ne(["pointerdown","pointermove","pointerup","dblclick","contextmenu","click","input","keydown"]);const Uu={A:[{type:"line",x1:50,y1:0,x2:0,y2:100},{type:"line",x1:50,y1:0,x2:100,y2:100},{type:"line",x1:25,y1:50,x2:75,y2:50}],E:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50},{type:"line",x1:0,y1:100,x2:80,y2:100}],F:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50}],H:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:100,y1:0,x2:100,y2:100},{type:"line",x1:0,y1:50,x2:100,y2:50}],I:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:20,y1:0,x2:80,y2:0},{type:"line",x1:20,y1:100,x2:80,y2:100}],K:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:60,x2:80,y2:0},{type:"line",x1:20,y1:45,x2:80,y2:100}],L:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:80,y2:100}],M:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:50,y2:60},{type:"line",x1:50,y1:60,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:100,y2:100}],N:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:100,x2:100,y2:0}],T:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:0,y1:0,x2:100,y2:0}],V:[{type:"line",x1:0,y1:0,x2:50,y2:100},{type:"line",x1:50,y1:100,x2:100,y2:0}],W:[{type:"line",x1:0,y1:0,x2:25,y2:100},{type:"line",x1:25,y1:100,x2:50,y2:40},{type:"line",x1:50,y1:40,x2:75,y2:100},{type:"line",x1:75,y1:100,x2:100,y2:0}],X:[{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:0,x2:0,y2:100}],Y:[{type:"line",x1:0,y1:0,x2:50,y2:50},{type:"line",x1:100,y1:0,x2:50,y2:50},{type:"line",x1:50,y1:50,x2:50,y2:100}],Z:[{type:"line",x1:0,y1:0,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:100,y2:100}],B:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:70,c1y:0,c2x:70,c2y:50},{type:"bezier",x1:0,y1:50,x2:0,y2:100,c1x:80,c1y:50,c2x:80,c2y:100}],C:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100}],D:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:100,c1x:100,c1y:0,c2x:100,c2y:100}],G:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"line",x1:80,y1:80,x2:80,y2:50},{type:"line",x1:80,y1:50,x2:50,y2:50}],J:[{type:"bezier",x1:60,y1:0,x2:40,y2:80,c1x:60,c1y:100,c2x:0,c2y:100}],O:[{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:110,c1y:0,c2x:110,c2y:100}],P:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50}],Q:[{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:-10,c1y:0,c2x:-10,c2y:90},{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:110,c1y:0,c2x:110,c2y:90},{type:"line",x1:60,y1:70,x2:90,y2:100}],R:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50},{type:"line",x1:20,y1:50,x2:80,y2:100}],S:[{type:"bezier",x1:80,y1:20,x2:50,y2:50,c1x:10,c1y:10,c2x:20,c2y:50},{type:"bezier",x1:50,y1:50,x2:20,y2:80,c1x:80,c1y:50,c2x:90,c2y:90}],U:[{type:"bezier",x1:0,y1:0,x2:100,y2:0,c1x:0,c1y:120,c2x:100,c2y:120}]},Gu=(n,t,e,o=60,i="#000000")=>{const s=[],r=ge("group"),a=o*.4;let c=t;const l=d=>d/100*o;for(let d=0;d<n.length;d++){const h=n[d].toUpperCase();if(h===" "){c+=o*.5;continue}const u=Uu[h];if(!u){const y=o,g={id:ge("rectangle"),type:"rectangle",x:c,y:e,width:y,height:y,strokeColor:i,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[r],fontSize:16,textAlign:"center",verticalAlign:"middle",containerText:"?"};s.push(g),c+=y+a;continue}u.forEach(y=>{const g={id:ge("line"),strokeColor:i,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:3,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[r]};if(y.type==="line")g.type="line",g.x=c+l(y.x1),g.y=e+l(y.y1),g.width=l(y.x2-y.x1),g.height=l(y.y2-y.y1),g.startArrowhead=null,g.endArrowhead=null;else if(y.type==="bezier"){g.type="line",g.curveType="bezier",g.startArrowhead=null,g.endArrowhead=null,g.x=c+l(y.x1),g.y=e+l(y.y1),g.width=l(y.x2-y.x1),g.height=l(y.y2-y.y1);const w=c+l(y.c1x),x=e+l(y.c1y),b=c+l(y.c2x),S=e+l(y.c2y);g.controlPoints=[{x:w,y:x},{x:b,y:S}]}s.push(g)}),c+=o+a}return s};var qu=nt('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="lucide lucide-marker"><path d="M12 2l7 7-9 9-4-4L12 2z"></path><path d="M7 13l-1.5 1.5">'),ju=nt("<div class=pen-tool-dropdown>"),Qu=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Vu=nt("<button>");const Ju=n=>(()=>{var t=qu();return pt(e=>{var o=n.size||24,i=n.size||24;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Ro=[{type:"fineliner",icon:Ul,label:"Fine Liner (P or 8)"},{type:"inkbrush",icon:Gl,label:"Ink Brush"},{type:"marker",icon:Ju,label:"Marker"}],Ku=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const d=h=>{const u=h.target;e?.contains(u)||o?.contains(u)||t(!1)};document.addEventListener("pointerdown",d),oe(()=>document.removeEventListener("pointerdown",d))}});const i=()=>Ro.find(d=>d.type===p.selectedPenType)||Ro[0],s=()=>["fineliner","inkbrush","marker"].includes(p.selectedTool),r=d=>{rh(d),Et(d),t(!1)},a=d=>{d.preventDefault(),p.showPropertyPanel||Et(p.selectedTool),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},c=()=>{s()||Et(p.selectedPenType),t(!n())},l=()=>{if(!e)return{};const d=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Qu(),h=d.firstChild,u=h.firstChild;h.$$contextmenu=a,h.$$click=c;var y=e;return typeof y=="function"?Wt(y,h):e=h,Y(u,()=>{const m=i().icon;return I(m,{size:20})},null),Y(u,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(d,I(St,{get when(){return n()},get children(){return I(He,{get children(){var m=ju(),g=o;return typeof g=="function"?Wt(g,m):o=m,Y(m,I(ze,{each:Ro,children:w=>(()=>{var x=Vu();return Se(x,"click",()=>r(w.type)),Y(x,I(w.icon,{size:18})),pt(b=>{var S=`dropdown-item ${p.selectedPenType===w.type?"active":""}`,P=w.label;return S!==b.e&&Nt(x,b.e=S),P!==b.t&&mt(x,"title",b.t=P),b},{e:void 0,t:void 0}),x})()})),pt(w=>Ne(m,l(),w)),m}})}}),null),pt(m=>{var g=`toolbar-btn ${s()?"active":""}`,w=`${i().label} (P or 8 - Click for more)`;return g!==m.e&&Nt(h,m.e=g),w!==m.t&&mt(h,"title",m.t=w),m},{e:void 0,t:void 0}),d})()};ne(["click","contextmenu"]);var Zu=nt("<div class=pen-tool-dropdown>"),tf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),ef=nt("<button>");const Si=[{type:"database",icon:os,label:"Database"},{type:"document",icon:ar,label:"Document"},{type:"predefinedProcess",icon:ql,label:"Predefined Process"},{type:"internalStorage",icon:ss,label:"Internal Storage"},{type:"capsule",icon:jl,label:"Capsule (Node)"},{type:"stickyNote",icon:Ql,label:"Sticky Note"},{type:"callout",icon:Vl,label:"Callout (Thought)"},{type:"speechBubble",icon:Jl,label:"Speech Bubble"},{type:"burst",icon:rs,label:"Burst (Impact)"},{type:"ribbon",icon:Kl,label:"Ribbon (Title)"},{type:"bracketLeft",icon:lr,label:"Left Bracket"},{type:"bracketRight",icon:cr,label:"Right Bracket"},{type:"triangle",icon:Zl,label:"Triangle"},{type:"hexagon",icon:tc,label:"Hexagon"},{type:"octagon",icon:ec,label:"Octagon"},{type:"parallelogram",icon:Ji,label:"Parallelogram"},{type:"star",icon:nc,label:"Star"},{type:"polygon",icon:dr,label:"Polygon (Parametric)"},{type:"cloud",icon:ic,label:"Cloud"},{type:"heart",icon:oc,label:"Heart"},{type:"cross",icon:is,label:"Cross (X)"},{type:"checkmark",icon:Re,label:"Checkmark"},{type:"arrowLeft",icon:sc,label:"Arrow Left"},{type:"arrowRight",icon:rc,label:"Arrow Right"},{type:"arrowUp",icon:ac,label:"Arrow Up"},{type:"arrowDown",icon:hr,label:"Arrow Down"}],nf=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>Si.find(u=>u.type===p.selectedShapeType)||Si[0],s=h=>{ah(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedShapeType),t(!n())},c=()=>i(),l=()=>Si.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=tf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=Zu(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Si.map(x=>(()=>{var b=ef();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=`${c().label} (Click for more)`;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var of=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=7 r=3></circle><path d="M 12,10 L 5,13 L 12,15 L 19,13 L 12,10"></path><path d="M 12,15 L 9,21"></path><path d="M 12,15 L 15,21">'),sf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,4 L 18,4 L 18,20 L 6,20 Z"></path><path d="M 6,4 C 4,4 4,2 6,2 L 18,2 C 20,2 20,4 18,4"></path><path d="M 6,20 C 4,20 4,22 6,22 L 18,22 C 20,22 20,20 18,20">'),rf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 2,12 C 5,8 8,16 11,12 C 14,8 17,16 20,12">'),af=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 5,6 L 19,6 L 19,14 L 5,14 Z"></path><path d="M 5,8 L 2,10 L 5,12"></path><path d="M 19,8 L 22,10 L 19,12"></path><path d="M 5,14 L 5,16 L 3,16"></path><path d="M 19,14 L 19,16 L 21,16">'),lf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=9 y1=18 x2=15 y2=18></line><line x1=10 y1=22 x2=14 y2=22></line><path d="M 15.09,14 C 15.09,14 17,12.5 17,10.6 C 17,7.5 14.5,5 11,5 C 7.5,5 5,7.5 5,10.6 C 5,12.5 6.91,14 6.91,14">'),cf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=12 y1=3 x2=12 y2=22></line><path d="M 4,6 L 18,6 L 21,9 L 18,12 L 4,12 Z"></path><circle cx=12 cy=9 r=1 fill=currentColor stroke=none>'),df=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 14.5,8 L 21,9 L 16.5,14 L 18,21 L 12,17 L 6,21 L 7.5,14 L 3,9 L 9.5,8 Z">'),hf=nt("<div class=pen-tool-dropdown>"),uf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),ff=nt("<button>");const pf=n=>(()=>{var t=of();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),yf=n=>(()=>{var t=sf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),gf=n=>(()=>{var t=rf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),mf=n=>(()=>{var t=af();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),xf=n=>(()=>{var t=lf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),wf=n=>(()=>{var t=cf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),bf=n=>(()=>{var t=df();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),ki=[{type:"starPerson",icon:pf,label:"Star Person (Character)"},{type:"lightbulb",icon:xf,label:"Lightbulb (Idea)"},{type:"signpost",icon:wf,label:"Signpost (Direction)"},{type:"burstBlob",icon:bf,label:"Jagged Burst (Impact)"},{type:"scroll",icon:yf,label:"Scroll Container"},{type:"wavyDivider",icon:gf,label:"Wavy Divider"},{type:"doubleBanner",icon:mf,label:"Double Banner"}],vf=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>ki.find(u=>u.type===p.selectedSketchnoteType)||ki[0],s=h=>{dh(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedSketchnoteType),t(!n())},c=()=>i(),l=()=>ki.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=uf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=hf(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>ki.map(x=>(()=>{var b=ff();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=c().label;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var Sf=nt("<div class=pen-tool-dropdown>"),kf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Mf=nt("<button>");const Mi=[{type:"database",icon:os,label:"Database"},{type:"server",icon:lc,label:"Server"},{type:"loadBalancer",icon:cc,label:"Load Balancer"},{type:"firewall",icon:dc,label:"Firewall"},{type:"user",icon:ur,label:"User / Client"},{type:"messageQueue",icon:hc,label:"Message Queue"},{type:"lambda",icon:rs,label:"Lambda / Function"},{type:"router",icon:uc,label:"Router"},{type:"browser",icon:fc,label:"Browser / Web"}],Pf=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>Mi.find(u=>u.type===p.selectedInfraType)||Mi[0],s=h=>{lh(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedInfraType),t(!n())},c=()=>i(),l=()=>Mi.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=kf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=Sf(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Mi.map(x=>(()=>{var b=Mf();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=c().label;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var $f=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 4,18 L 8,6 L 16,6 L 20,18 Z">'),Cf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,6 L 6,18 L 18,18 Z">'),Tf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 19,5 L 22,12 L 19,19 L 12,22 L 5,19 L 2,12 L 5,5 Z">'),If=nt("<div class=pen-tool-dropdown>"),Lf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Ef=nt("<button>");const Rf=n=>(()=>{var t=$f();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Af=n=>(()=>{var t=Cf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Df=n=>(()=>{var t=Tf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Pi=[{type:"trapezoid",icon:Rf,label:"Trapezoid"},{type:"rightTriangle",icon:Af,label:"Right-Angle Triangle"},{type:"pentagon",icon:dr,label:"Pentagon"},{type:"septagon",icon:Df,label:"Septagon (Heptagon)"}],Of=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>Pi.find(u=>u.type===p.selectedMathType)||Pi[0],s=h=>{ch(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedMathType),t(!n())},c=()=>i(),l=()=>Pi.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Lf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=If(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Pi.map(x=>(()=>{var b=Ef();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=c().label;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var _f=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=2 y=3 width=20 height=18 rx=2 ry=2></rect><line x1=2 y1=8 x2=22 y2=8></line><circle cx=5 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=7 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=9 cy=5.5 r=0.5 fill=currentColor>'),zf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=5 y=2 width=14 height=20 rx=2 ry=2></rect><path d="M10 4h4"></path><path d="M11 19h2">'),Bf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-dasharray="2 2"><rect x=3 y=6 width=18 height=12 rx=2 ry=2>'),Wf=nt('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><rect x=3 y=7 width=18 height=10 rx=1></rect><line x1=7 y1=10 x2=7 y2=14>'),Xf=nt("<div class=pen-tool-dropdown>"),Yf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Hf=nt("<button>");const Nf=n=>(()=>{var t=_f();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Ff=n=>(()=>{var t=zf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Uf=n=>(()=>{var t=Bf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),Gf=n=>(()=>{var t=Wf();return pt(e=>{var o=n.size||20,i=n.size||20;return o!==e.e&&mt(t,"width",e.e=o),i!==e.t&&mt(t,"height",e.t=i),e},{e:void 0,t:void 0}),t})(),$i=[{type:"browserWindow",icon:Nf,label:"Browser Window"},{type:"mobilePhone",icon:Ff,label:"Mobile Phone"},{type:"ghostButton",icon:Uf,label:"Ghost Button"},{type:"inputField",icon:Gf,label:"Input Field"}],qf=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>$i.find(u=>u.type===p.selectedWireframeType)||$i[0],s=h=>{hh(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedWireframeType),t(!n())},c=()=>i(),l=()=>$i.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Yf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=Xf(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>$i.map(x=>(()=>{var b=Hf();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=c().label;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var jf=nt("<div class=pen-tool-dropdown>"),Qf=nt('<div class=pen-tool-group><button title="Mindmap Tools"><div class=tool-icon-wrapper>'),Vf=nt("<button>");const Bn=[{type:"organicBranch",icon:pc,label:"Organic Branch"},{type:"cloud",icon:yc,label:"Central Topic (Cloud)"},{type:"circle",icon:gc,label:"Topic (Circle)"}],Jf=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>{const h=Bn.find(y=>y.type===p.selectedTool);return h||Bn.find(y=>y.type===p.selectedShapeType)||Bn[0]},s=h=>{Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(i().type),t(!n())},c=()=>i(),l=()=>Bn.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Qf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=jf(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Bn.map(x=>(()=>{var b=Vf();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(()=>Nt(u,`toolbar-btn ${l()?"active":""}`)),h})()};ne(["click","contextmenu"]);var Kf=nt("<div class=pen-tool-dropdown>"),Zf=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),tp=nt("<button>");const Ci=[{type:"dfdProcess",icon:mc,label:"DFD Process"},{type:"dfdDataStore",icon:xc,label:"DFD Data Store"},{type:"isometricCube",icon:wc,label:"Isometric Cube"},{type:"solidBlock",icon:bc,label:"Solid Block"},{type:"perspectiveBlock",icon:vc,label:"Perspective Block"},{type:"cylinder",icon:os,label:"Cylinder"},{type:"stateStart",icon:as,label:"Initial State"},{type:"stateEnd",icon:fr,label:"Final State"},{type:"stateSync",icon:ls,label:"Sync Bar"},{type:"activationBar",icon:Sc,label:"Activation Bar"},{type:"externalEntity",icon:ss,label:"External Entity"}],ep=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>Ci.find(u=>u.type===p.selectedTechnicalType)||Ci[0],s=h=>{yh(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedTechnicalType),t(!n())},c=()=>i(),l=()=>Ci.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=Zf(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=Kf(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Ci.map(x=>(()=>{var b=tp();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=c().label;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var np=nt("<div class=pen-tool-dropdown>"),ip=nt("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),op=nt("<button>");const Ti=[{type:"umlClass",icon:bn,label:"Class"},{type:"umlInterface",icon:kc,label:"Interface"},{type:"umlActor",icon:ur,label:"Actor"},{type:"umlUseCase",icon:as,label:"Use Case"},{type:"umlNote",icon:ar,label:"Note"},{type:"umlPackage",icon:Mc,label:"Package"},{type:"umlComponent",icon:Pc,label:"Component"},{type:"umlState",icon:$c,label:"State"},{type:"umlLifeline",icon:hr,label:"Lifeline"},{type:"umlFragment",icon:Cc,label:"Fragment"},{type:"umlSignalSend",icon:cr,label:"Signal Send"},{type:"umlSignalReceive",icon:lr,label:"Signal Receive"},{type:"umlProvidedInterface",icon:fr,label:"Provided"},{type:"umlRequiredInterface",icon:Tc,label:"Required"}],sp=()=>{const[n,t]=kt(!1);let e,o;Vt(()=>{if(n()){const h=u=>{const y=u.target;e?.contains(y)||o?.contains(y)||t(!1)};document.addEventListener("pointerdown",h),oe(()=>document.removeEventListener("pointerdown",h))}});const i=()=>Ti.find(u=>u.type===p.selectedUmlType)||Ti[0],s=h=>{gh(h),Et(h),t(!1)},r=h=>{h.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},a=()=>{l()||Et(p.selectedUmlType),t(!n())},c=()=>i(),l=()=>Ti.some(h=>h.type===p.selectedTool),d=()=>{if(!e)return{};const h=e.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=ip(),u=h.firstChild,y=u.firstChild;u.$$contextmenu=r,u.$$click=a;var m=e;return typeof m=="function"?Wt(m,u):e=u,Y(y,()=>{const g=c().icon;return I(g,{size:20})},null),Y(y,I(Ye,{size:10,class:"submenu-indicator"}),null),Y(h,I(St,{get when(){return n()},get children(){return I(He,{get children(){var g=np(),w=o;return typeof w=="function"?Wt(w,g):o=g,Y(g,()=>Ti.map(x=>(()=>{var b=op();return Se(b,"click",()=>s(x.type)),Y(b,I(x.icon,{size:18})),pt(S=>{var P=`dropdown-item ${p.selectedTool===x.type?"active":""}`,A=x.label;return P!==S.e&&Nt(b,S.e=P),A!==S.t&&mt(b,"title",S.t=A),S},{e:void 0,t:void 0}),b})())),pt(x=>Ne(g,d(),x)),g}})}}),null),pt(g=>{var w=`toolbar-btn ${l()?"active":""}`,x=`UML: ${c().label}`;return w!==g.e&&Nt(u,g.e=w),x!==g.t&&mt(u,"title",g.t=x),g},{e:void 0,t:void 0}),h})()};ne(["click","contextmenu"]);var rp=nt('<div class=toolbar-container><div class=drag-handle title="Drag to move toolbar"><div class=drag-dots></div></div><input type=file accept=image/* style=display:none>'),Ii=nt("<button>");const wn=[{type:"pan",icon:Ic,label:"Pan Tool (H)"},{type:"selection",icon:Lc,label:"Selection (V or 1)"},{type:"rectangle",icon:Ji,label:"Rectangle (R or 2)"},{type:"circle",icon:as,label:"Circle (O or 3)"},{type:"diamond",icon:Ec,label:"Diamond (D)"},{type:"arrow",icon:Rc,label:"Arrow (A or 5)"},{type:"line",icon:ls,label:"Line (L or 4)"},{type:"bezier",icon:Ac,label:"Bezier Curve (B or 0)"},{type:"text",icon:Dc,label:"Text (T or 6)"},{type:"block-text",icon:Oc,label:"Block Text (Sketchnote)"},{type:"image",icon:_c,label:"Insert Image (I or 9)"},{type:"eraser",icon:zc,label:"Eraser (E or 7)"},{type:"laser",icon:rs,label:"Laser Pointer (Shift+P)"},{type:"ink",icon:Bc,label:"Ink Overlay (Alt+I)"}],ap=()=>{let n=null;const[t,e]=kt({x:0,y:0}),[o,i]=kt(!1),[s,r]=kt({x:0,y:0}),a=g=>{const w=g.target;(w.classList.contains("toolbar-container")||w.closest(".drag-handle"))&&(i(!0),r({x:g.clientX-t().x,y:g.clientY-t().y}),g.preventDefault())},c=g=>{o()&&e({x:g.clientX-s().x,y:g.clientY-s().y})},l=()=>{i(!1)};hn(()=>{window.addEventListener("mousemove",c),window.addEventListener("mouseup",l),oe(()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",l)})});const d=g=>{if(g==="image")n?.click();else if(g==="block-text"){const w=prompt("Enter text to generate (A-Z):");if(w){const x=window.innerWidth/2-p.viewState.panX,b=window.innerHeight/2-p.viewState.panY,S=Gu(w,x-w.length*30,b,80,"#000000");$("elements",[...p.elements,...S]),$("selection",S.map(P=>P.id)),Et("selection")}}else Et(g)},h=g=>{g.preventDefault(),$("showPropertyPanel",!0),$("isPropertyPanelMinimized",!1)},u=g=>{const w=g.target.files?.[0];if(!w)return;const x=new FileReader;x.onload=b=>{const S=b.target?.result;if(S){const P=new Image;P.src=S,P.onload=()=>{let B=P.width,X=P.height;if(B>1500||X>1500){const ot=B/X;B>X?(B=1500,X=B/ot):(X=1500,B=X*ot)}const D=document.createElement("canvas");D.width=B,D.height=X;const Q=D.getContext("2d");if(Q){Q.drawImage(P,0,0,B,X);const ot=D.toDataURL("image/webp",.8),st=500;let dt=B,ut=X;if(dt>st||ut>st){const xt=dt/ut;dt>ut?(dt=st,ut=dt/xt):(ut=st,dt=ut*xt)}sn({id:crypto.randomUUID(),type:"image",x:100,y:100,width:dt,height:ut,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:0,strokeStyle:"solid",roughness:0,opacity:100,angle:0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,dataURL:ot,mimeType:"image/webp",layerId:p.activeLayerId})}}}},x.readAsDataURL(w),g.target.value=""},y=wn.findIndex(g=>g.type==="diamond"),m=wn.findIndex(g=>g.type==="bezier");return(()=>{var g=rp(),w=g.firstChild,x=w.nextSibling;return g.$$mousedown=a,g.$$contextmenu=b=>b.preventDefault(),x.addEventListener("change",u),Wt(b=>n=b,x),Y(g,I(ze,{get each(){return wn.slice(0,2)},children:b=>(()=>{var S=Ii();return S.$$contextmenu=h,S.$$click=()=>d(b.type),Y(S,I(b.icon,{size:20})),pt(P=>{var A=`toolbar-btn ${p.selectedTool===b.type?"active":""}`,B=b.label;return A!==P.e&&Nt(S,P.e=A),B!==P.t&&mt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),Y(g,I(Ku,{}),null),Y(g,I(ze,{get each(){return wn.slice(2,y+1)},children:b=>(()=>{var S=Ii();return S.$$contextmenu=h,S.$$click=()=>d(b.type),Y(S,I(b.icon,{size:20})),pt(P=>{var A=`toolbar-btn ${p.selectedTool===b.type?"active":""}`,B=b.label;return A!==P.e&&Nt(S,P.e=A),B!==P.t&&mt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),Y(g,I(nf,{}),null),Y(g,I(Jf,{}),null),Y(g,I(vf,{}),null),Y(g,I(Pf,{}),null),Y(g,I(qf,{}),null),Y(g,I(Of,{}),null),Y(g,I(ep,{}),null),Y(g,I(sp,{}),null),Y(g,I(ze,{get each(){return wn.slice(y+1,m+1)},children:b=>(()=>{var S=Ii();return S.$$contextmenu=h,S.$$click=()=>d(b.type),Y(S,I(b.icon,{size:20})),pt(P=>{var A=`toolbar-btn ${p.selectedTool===b.type?"active":""}`,B=b.label;return A!==P.e&&Nt(S,P.e=A),B!==P.t&&mt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),Y(g,I(ze,{get each(){return wn.slice(m+1)},children:b=>(()=>{var S=Ii();return S.$$contextmenu=h,S.$$click=()=>d(b.type),Y(S,I(b.icon,{size:20})),pt(P=>{var A=`toolbar-btn ${p.selectedTool===b.type?"active":""}`,B=b.label;return A!==P.e&&Nt(S,P.e=A),B!==P.t&&mt(S,"title",P.t=B),P},{e:void 0,t:void 0}),S})()}),null),pt(b=>{var S=!!o(),P=`translateX(-50%) translate(${t().x}px, ${t().y}px)`;return S!==b.e&&g.classList.toggle("dragging",b.e=S),P!==b.t&&Yt(g,"transform",b.t=P),b},{e:void 0,t:void 0}),g})()};ne(["contextmenu","mousedown","click"]);var lp=nt("<div style=position:absolute;top:150px;left:120px;transform:rotate(-5deg);opacity:0.8>Export, preferences, languages..."),cp=nt("<div style=position:absolute;top:100px;right:150px;transform:rotate(-5deg);opacity:0.8;text-align:right;max-width:150px>New! P3 Color Picker"),dp=nt("<div style=position:absolute;top:20%;left:60%;transform:rotate(5deg);opacity:0.8;max-width:200px>Pick a tool & start drawing!"),hp=nt("<div style=position:absolute;bottom:120px;left:300px;text-align:left;opacity:0.8>Shortcuts & help"),up=nt('<div style="position:absolute;inset:0;pointer-events:none;z-index:10;color:var(--text-secondary, #6b7280);font-family:Virgil, Segoe UI Emoji, sans-serif;overflow:hidden"><canvas style=position:absolute;top:0;left:0;width:100%;height:100%></canvas><div style="position:absolute;top:45%;left:50%;transform:translate(-50%, -50%);text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem"><h1 style=font-size:5rem;margin:0;line-height:1.2;display:flex;align-items:baseline;gap:0.2rem><span style="background:linear-gradient(135deg, color(display-p3 0 0.5 1), color(display-p3 0.2 0.6 1));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Yappy</span><span style="background:linear-gradient(135deg, color(display-p3 1 0.8 0), color(display-p3 1 0.9 0.2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Draw</span></h1><p style=font-size:1.2rem;opacity:0.7>All your data is saved locally in your browser.</p><div style="margin-top:3rem;display:grid;grid-template-columns:auto auto;gap:1rem 3rem;text-align:left;font-family:Inter, sans-serif;font-size:0.9rem;opacity:0.8"><span>Open</span><strong>Ctrl+Alt+O</strong><span>Smart Palette</span><strong>Ctrl+K</strong><span>Help</span><strong>?');const fp=()=>{let n;const t=()=>p.elements.length===0&&p.selectedTool==="selection"&&p.appMode!=="presentation"&&!p.zenMode,[e,o]=kt({width:window.innerWidth,height:window.innerHeight});return Vt(()=>{const i=()=>{o({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",i),oe(()=>window.removeEventListener("resize",i))}),Vt(()=>{if(!n||!t())return;const i=n,s=i.getContext("2d");if(!s)return;const{width:r,height:a}=e(),c=r<768,l=window.devicePixelRatio||1;i.width=r*l,i.height=a*l,s.scale(l,l),i.style.width=`${r}px`,i.style.height=`${a}px`;const d=Nn.canvas(i),h=r/2,u=a/2,y={id:"mock",type:"arrow",strokeColor:"#9ca3af",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"dashed",roughness:1.5,opacity:100,angle:0,renderStyle:"sketch",seed:1,locked:!1,link:null,layerId:"layer1",roundness:null,curveType:"bezier",startArrowhead:null,endArrowhead:"arrow",strokeLineJoin:"round",width:0,height:0,x:0,y:0},m=(b,S)=>({...y,id:crypto.randomUUID(),x:0,y:0,width:r,height:a,points:b,controlPoints:S}),g=b=>{Xe(d,s,b,p.globalSettings.theme==="dark",1)};if(!c){const b=m([{x:h-200,y:u-100},{x:100,y:60}],[{x:h-250,y:u-200},{x:200,y:150}]);g(b);const S=m([{x:h+50,y:u-150},{x:h,y:80}],[{x:h+20,y:150},{x:h+10,y:100}]);g(S);const P=m([{x:h+250,y:u-100},{x:r-100,y:60}],[{x:r-180,y:120},{x:r-140,y:90}]);g(P)}const w=c?60:310,x=a-65;if(r>400){const b=m([{x:h-150,y:u+(c?50:100)},{x:w,y:x}],[{x:h-(c?50:200),y:u+(c?100:150)},{x:w+20,y:x-30}]);g(b)}}),I(St,{get when(){return t()},get children(){var i=up(),s=i.firstChild,r=s.nextSibling,a=r.firstChild,c=a.firstChild;c.nextSibling;var l=a.nextSibling;l.nextSibling;var d=n;return typeof d=="function"?Wt(d,s):n=s,Y(i,I(St,{get when(){return e().width>768},get children(){return[lp(),cp(),dp(),hp()]}}),r),i}})},pp={enableWorkspacePersistence:!1},yp=n=>n&&(n.version===3||n.version===4)&&Array.isArray(n.slides),_l="default-layer",gp=n=>({id:n.id,type:n.type,x:n.x??0,y:n.y??0,width:n.width??100,height:n.height??100,strokeColor:n.strokeColor??"#000000",backgroundColor:n.backgroundColor??"transparent",fillStyle:n.fillStyle??"hachure",strokeWidth:n.strokeWidth??1,strokeStyle:n.strokeStyle??"solid",roughness:n.roughness??1,opacity:n.opacity??100,angle:n.angle??0,renderStyle:n.renderStyle??"sketch",seed:n.seed??Math.floor(Math.random()*2147483647),roundness:n.roundness??null,locked:n.locked??!1,link:n.link??null,layerId:n.layerId||_l,...n.points&&{points:n.points},...n.pointsEncoding!==void 0&&{pointsEncoding:n.pointsEncoding},...n.startArrowhead!==void 0&&{startArrowhead:n.startArrowhead},...n.endArrowhead!==void 0&&{endArrowhead:n.endArrowhead},...n.text!==void 0&&{text:n.text},...n.rawText!==void 0&&{rawText:n.rawText},...n.fontSize!==void 0&&{fontSize:n.fontSize},...n.fontFamily!==void 0&&{fontFamily:n.fontFamily},...n.fontWeight!==void 0&&{fontWeight:n.fontWeight},...n.fontStyle!==void 0&&{fontStyle:n.fontStyle},...n.textAlign!==void 0&&{textAlign:n.textAlign},...n.verticalAlign!==void 0&&{verticalAlign:n.verticalAlign},...n.textColor!==void 0&&{textColor:n.textColor},...n.textHighlightEnabled!==void 0&&{textHighlightEnabled:n.textHighlightEnabled},...n.textHighlightColor!==void 0&&{textHighlightColor:n.textHighlightColor},...n.textHighlightPadding!==void 0&&{textHighlightPadding:n.textHighlightPadding},...n.textHighlightRadius!==void 0&&{textHighlightRadius:n.textHighlightRadius},...n.containerId!==void 0&&{containerId:n.containerId},...n.containerText!==void 0&&{containerText:n.containerText},...n.labelPosition!==void 0&&{labelPosition:n.labelPosition},...n.fileId!==void 0&&{fileId:n.fileId},...n.scale!==void 0&&{scale:n.scale},...n.crop!==void 0&&{crop:n.crop},...n.status!==void 0&&{status:n.status},...n.dataURL!==void 0&&{dataURL:n.dataURL},...n.mimeType!==void 0&&{mimeType:n.mimeType},...n.groupIds!==void 0&&{groupIds:n.groupIds},...n.boundElements!==void 0&&{boundElements:n.boundElements},...n.isSelected!==void 0&&{isSelected:n.isSelected},...n.startBinding!==void 0&&{startBinding:n.startBinding},...n.endBinding!==void 0&&{endBinding:n.endBinding},...n.curveType!==void 0&&{curveType:n.curveType},...n.parentId!==void 0&&{parentId:n.parentId},...n.isCollapsed!==void 0&&{isCollapsed:n.isCollapsed},...n.constrained!==void 0&&{constrained:n.constrained},...n.autoResize!==void 0&&{autoResize:n.autoResize},...n.starPoints!==void 0&&{starPoints:n.starPoints},...n.polygonSides!==void 0&&{polygonSides:n.polygonSides},...n.borderRadius!==void 0&&{borderRadius:n.borderRadius},...n.burstPoints!==void 0&&{burstPoints:n.burstPoints},...n.tailPosition!==void 0&&{tailPosition:n.tailPosition},...n.shapeRatio!==void 0&&{shapeRatio:n.shapeRatio},...n.drawInnerBorder!==void 0&&{drawInnerBorder:n.drawInnerBorder},...n.innerBorderColor!==void 0&&{innerBorderColor:n.innerBorderColor},...n.innerBorderDistance!==void 0&&{innerBorderDistance:n.innerBorderDistance},...n.strokeLineJoin!==void 0&&{strokeLineJoin:n.strokeLineJoin},...n.fillDensity!==void 0&&{fillDensity:n.fillDensity},...n.shadowEnabled!==void 0&&{shadowEnabled:n.shadowEnabled},...n.shadowColor!==void 0&&{shadowColor:n.shadowColor},...n.shadowBlur!==void 0&&{shadowBlur:n.shadowBlur},...n.shadowOffsetX!==void 0&&{shadowOffsetX:n.shadowOffsetX},...n.shadowOffsetY!==void 0&&{shadowOffsetY:n.shadowOffsetY},...n.gradientStart!==void 0&&{gradientStart:n.gradientStart},...n.gradientEnd!==void 0&&{gradientEnd:n.gradientEnd},...n.gradientDirection!==void 0&&{gradientDirection:n.gradientDirection},...n.gradientStops!==void 0&&{gradientStops:n.gradientStops},...n.gradientType!==void 0&&{gradientType:n.gradientType},...n.gradientHandlePositions!==void 0&&{gradientHandlePositions:n.gradientHandlePositions},...n.blendMode!==void 0&&{blendMode:n.blendMode},...n.filter!==void 0&&{filter:n.filter},...n.entranceAnimation!==void 0&&{entranceAnimation:n.entranceAnimation},...n.animations!==void 0&&{animations:n.animations},...n.controlPoints!==void 0&&{controlPoints:n.controlPoints},...n.flowAnimation!==void 0&&{flowAnimation:n.flowAnimation},...n.flowSpeed!==void 0&&{flowSpeed:n.flowSpeed},...n.flowStyle!==void 0&&{flowStyle:n.flowStyle},...n.flowColor!==void 0&&{flowColor:n.flowColor},...n.flowDensity!==void 0&&{flowDensity:n.flowDensity},...n.isMotionPath!==void 0&&{isMotionPath:n.isMotionPath}}),mp=n=>n.map(t=>gp(t)),xp=n=>{const e=(n.layers||[{id:_l,name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent",colorTag:void 0,parentId:void 0,isGroup:!1,expanded:!0}]).map(i=>({...i,parentId:i.parentId,isGroup:i.isGroup??!1,expanded:i.expanded??!0}));return{elements:mp(n.elements||[]),layers:e,viewState:n.viewState||{scale:1,panX:0,panY:0},gridSettings:n.gridSettings,globalSettings:n.globalSettings,canvasBackgroundColor:n.canvasBackgroundColor,states:n.states||[],initialStateId:n.initialStateId}},Ko=n=>n&&(n.version===3||n.version===4)&&Array.isArray(n.slides),Zo=n=>{if(Ko(n))return n;const t=xp(n),e={id:crypto.randomUUID(),name:"Slide 1",spatialPosition:{x:0,y:0},dimensions:{width:1920,height:1080},backgroundColor:t.canvasBackgroundColor||"#ffffff",order:0};return{version:4,metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},elements:t.elements,layers:t.layers,slides:[e],globalSettings:n.globalSettings||{},gridSettings:t.gridSettings,states:t.states}};class wp{baseUrl="/api/drawings";async saveDrawing(t,e){let o;yp(e)?o={...e,metadata:{...e.metadata,updatedAt:new Date().toISOString()}}:o=Zo(e),o.version===4&&o.elements&&(o.elements=o.elements.map(l=>{if((l.type==="fineliner"||l.type==="inkbrush"||l.type==="marker")&&l.points&&typeof l.points[0]!="number"){const d=[];return l.points.forEach(h=>{d.push(h.x,h.y)}),{...l,points:d,pointsEncoding:"flat"}}return l})),o.slides&&(o.slides=o.slides.map(l=>{const d={...l};return d.elements&&(d.elements=d.elements.map(h=>{if((h.type==="fineliner"||h.type==="inkbrush"||h.type==="marker")&&h.points&&typeof h.points[0]!="number"){const u=[];return h.points.forEach(y=>{u.push(y.x,y.y)}),{...h,points:u,pointsEncoding:"flat"}}return h})),d}));const i=JSON.stringify(o),s=new Blob([i]).stream().pipeThrough(new CompressionStream("gzip")),a=await new Response(s).blob(),c=await fetch(`${this.baseUrl}/${t}`,{method:"POST",headers:{"Content-Type":"application/gzip"},body:a});if(!c.ok){const l=await c.json().catch(()=>({error:"Unknown server error"}));throw new Error(l.error||`Failed to save: ${c.statusText}`)}}async loadDrawing(t){const e=await fetch(`${this.baseUrl}/${t}`);if(!e.ok)return null;const o=e.headers.get("content-type");let i;if(o&&(o.includes("application/gzip")||o.includes("application/x-gzip")||o.includes("application/octet-stream")))try{const s=new DecompressionStream("gzip"),r=e.body.pipeThrough(s);i=await new Response(r).text()}catch(s){console.warn("Decompression failed, falling back to text",s),i=await e.text()}else i=await e.text();return JSON.parse(i)}async listDrawings(){const t=await fetch(this.baseUrl);return t.ok?await t.json():[]}async deleteDrawing(t){const e=await fetch(`${this.baseUrl}/${t}`,{method:"DELETE"});if(!e.ok){const o=await e.json().catch(()=>({error:"Unknown server error"}));throw new Error(o.error||`Failed to delete: ${e.statusText}`)}}}const rr=new wp;function bp(n){const{l:t,c:e,h:o}=n,i=o*Math.PI/180,s=e*Math.cos(i),r=e*Math.sin(i),a=t+.3963377774*s+.2158037573*r,c=t-.1055613458*s-.0638541728*r,l=t-.0894841775*s-1.291485548*r,d=a*a*a,h=c*c*c,u=l*l*l,y=1.2270138511*d-.5577999807*h+.2812561489*u,m=-.0405801784*d+1.1122568696*h-.0716766787*u,g=-.0763812845*d-.4214819787*h+1.5861632204*u,w=2.4039459*y-.9898517*m-.4141151*g,x=-.7797967*y+1.5445214*m+.0352745*g,b=.0384795*y-.1141381*m+1.0756786*g,S=P=>{const A=Math.abs(P),B=A>.0031308?1.055*Math.pow(A,1/2.4)-.055:12.92*A;return P<0?-B:B};return{r:S(w),g:S(x),b:S(b)}}function Li(n){return`oklch(${(n.l*100).toFixed(2)}% ${n.c.toFixed(4)} ${n.h.toFixed(2)})`}function vp(n){return n.r>=-.001&&n.r<=1+.001&&n.g>=-.001&&n.g<=1+.001&&n.b>=-.001&&n.b<=1+.001}var Sp=nt('<div style=padding:8px;display:flex;flex-direction:column;gap:12px><div style=position:relative><canvas width=200 height=150 style="width:100%;height:150px;cursor:crosshair;border-radius:8px;border:1px solid rgba(0,0,0,0.1);display:block"></canvas></div><div style="height:12px;width:100%;border-radius:6px;cursor:pointer;position:relative;background:linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"><div style="position:absolute;top:50%;transform:translate(-50%, -50%);width:16px;height:16px;background:white;border:2px solid black;border-radius:50%;pointer-events:none"></div></div><div style=display:flex;align-items:center;gap:8px;font-size:11px;font-family:monospace;color:var(--text-secondary)><div style="width:32px;height:32px;border-radius:4px;border:1px solid rgba(0,0,0,0.1)"></div><div><div>');const kp=n=>{const[t,e]=kt({l:.8,c:.15,h:200});let o,i;Vt(()=>{const a=t().h;if(!o)return;const c=o.getContext("2d",{colorSpace:"display-p3"});if(!c)return;const l=o.width,d=o.height,h=c.createImageData(l,d),u=h.data;for(let g=0;g<d;g++){const w=1-g/d;for(let x=0;x<l;x++){const b=x/l*.4,S=bp({l:w,c:b,h:a}),P=vp(S),A=(g*l+x)*4;if(P)u[A]=Math.round(S.r*255),u[A+1]=Math.round(S.g*255),u[A+2]=Math.round(S.b*255),u[A+3]=255;else{const X=(Math.floor(x/5)+Math.floor(g/5))%2===0?30:20;u[A]=X,u[A+1]=X,u[A+2]=X,u[A+3]=255}}}c.putImageData(h,0,0);const y=t().c/.4*l,m=(1-t().l)*d;c.strokeStyle="white",c.lineWidth=2,c.beginPath(),c.arc(y,m,5,0,Math.PI*2),c.stroke(),c.strokeStyle="black",c.lineWidth=1,c.beginPath(),c.arc(y,m,6,0,Math.PI*2),c.stroke()});const s=a=>{a.stopPropagation();const c=h=>{if(!o)return;const u=o.getBoundingClientRect(),y=Math.min(Math.max(h.clientX-u.left,0),u.width),g=1-Math.min(Math.max(h.clientY-u.top,0),u.height)/u.height,w=y/u.width*.4;e(x=>({...x,l:g,c:w})),n.onSelect(Li(t()))};c(a);const l=h=>c(h),d=()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",l),window.addEventListener("mouseup",d)},r=a=>{a.stopPropagation();const c=h=>{if(!i)return;const u=i.getBoundingClientRect(),m=Math.min(Math.max(h.clientX-u.left,0),u.width)/u.width*360;e(g=>({...g,h:m})),n.onSelect(Li(t()))};c(a);const l=h=>c(h),d=()=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",l),window.addEventListener("mouseup",d)};return(()=>{var a=Sp(),c=a.firstChild,l=c.firstChild,d=c.nextSibling,h=d.firstChild,u=d.nextSibling,y=u.firstChild,m=y.nextSibling,g=m.firstChild;l.$$mousedown=s;var w=o;typeof w=="function"?Wt(w,l):o=l,d.$$mousedown=r;var x=i;return typeof x=="function"?Wt(x,d):i=d,Y(g,()=>Li(t())),pt(b=>{var S=`${t().h/360*100}%`,P=Li(t());return S!==b.e&&Yt(h,"left",b.e=S),P!==b.t&&Yt(y,"background",b.t=P),b},{e:void 0,t:void 0}),a})()};ne(["mousedown"]);var Mp=nt('<div style=padding:8px><div style=font-size:10px;font-weight:bold;color:var(--text-secondary);margin-bottom:4px>P3 COLORS</div><div style="display:grid;grid-template-columns:repeat(5, 1fr);gap:8px;margin-bottom:12px"><button title="Advanced Picker"style="width:24px;height:24px;background:var(--toolbar-bg);border-radius:6px;cursor:pointer;border:1px dashed var(--border-color);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-secondary)">+</button></div><div style=font-size:10px;font-weight:bold;color:var(--text-secondary);margin-bottom:4px>BACKGROUNDS</div><div style="display:grid;grid-template-columns:repeat(5, 1fr);gap:8px">'),Pp=nt("<div>"),$p=nt('<div><div style="padding:4px 8px;display:flex;justify-content:space-between;align-items:center"><span style=font-size:12px;font-weight:bold>OKLCH Picker</span><button style=background:none;border:none;cursor:pointer;font-size:12px;color:var(--text-secondary)>Back'),Cp=nt('<div style="width:24px;height:24px;border-radius:6px;cursor:grab;border:1px solid rgba(0,0,0,0.1);transition:transform 0.2s">'),Tp=nt('<div style="width:24px;height:24px;background-size:cover;background-position:center;border-radius:6px;cursor:grab;border:1px solid rgba(0,0,0,0.1);transition:transform 0.2s">');const Ip=[{name:"P3 Red",value:"color(display-p3 1 0 0)"},{name:"P3 Green",value:"color(display-p3 0 1 0)"},{name:"P3 Blue",value:"color(display-p3 0 0 1)"},{name:"P3 Yellow",value:"color(display-p3 1 1 0)"},{name:"P3 Magenta",value:"color(display-p3 1 0 1)"},{name:"P3 Cyan",value:"color(display-p3 0 1 1)"},{name:"P3 Orange",value:"color(display-p3 1 0.5 0)"},{name:"P3 Purple",value:"color(display-p3 0.5 0 1)"},{name:"P3 Pink",value:"color(display-p3 1 0 0.5)"}],Lp=[{name:"Noise Texture",value:"https://www.transparenttextures.com/patterns/asfalt-dark.png"},{name:"Paper Texture",value:"https://www.transparenttextures.com/patterns/paper.png"},{name:"Carbon Fiber",value:"https://www.transparenttextures.com/patterns/carbon-fibre.png"},{name:"Gradient Blue",value:"https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=320"},{name:"Gradient Sunset",value:"https://images.unsplash.com/photo-1557683311-eac922347aa1?q=80&w=320"}],Ep=()=>{const[n,t]=kt(!1),e=i=>{const s=i.startsWith("http")||i.startsWith("data:image");p.selection.length>0?(Mt(),p.selection.forEach(r=>{s?Z(r,{type:"image",dataURL:i}):Z(r,{backgroundColor:i,fillStyle:"solid"})})):p.docType==="slides"&&(Mt(),s?rn(p.activeSlideIndex,{backgroundImage:i,fillStyle:"image"}):rn(p.activeSlideIndex,{backgroundColor:i,fillStyle:"solid"}))},o=(i,s)=>{if(i.dataTransfer){i.dataTransfer.setData("text/plain",s),i.dataTransfer.effectAllowed="copy";const r=s.startsWith("http")||s.startsWith("data:image"),a=document.createElement("div");a.style.width="32px",a.style.height="32px",r?(a.style.backgroundImage=`url(${s})`,a.style.backgroundSize="cover"):a.style.background=s,a.style.borderRadius="4px",a.style.position="absolute",a.style.top="-1000px",a.style.border="1px solid white",document.body.appendChild(a),i.dataTransfer.setDragImage(a,16,16),setTimeout(()=>document.body.removeChild(a),0)}};return(()=>{var i=Pp();return Y(i,I(St,{get when(){return!n()},get fallback(){return(()=>{var s=$p(),r=s.firstChild,a=r.firstChild,c=a.nextSibling;return c.$$click=()=>t(!1),Y(s,I(kp,{onSelect:e}),null),s})()},get children(){var s=Mp(),r=s.firstChild,a=r.nextSibling,c=a.firstChild,l=a.nextSibling,d=l.nextSibling;return Y(a,I(ze,{each:Ip,children:h=>(()=>{var u=Cp();return u.addEventListener("mouseleave",y=>y.currentTarget.style.transform="scale(1)"),u.addEventListener("mouseenter",y=>y.currentTarget.style.transform="scale(1.2)"),u.$$click=y=>{y.stopPropagation(),e(h.value)},u.$$mousedown=y=>y.stopPropagation(),u.addEventListener("dragstart",y=>{y.stopPropagation(),o(y,h.value)}),mt(u,"draggable",!0),pt(y=>{var m=`${h.name} (Drag to shape/slide)`,g=h.value;return m!==y.e&&mt(u,"title",y.e=m),g!==y.t&&Yt(u,"background",y.t=g),y},{e:void 0,t:void 0}),u})()}),c),c.$$click=()=>t(!0),Y(d,I(ze,{each:Lp,children:h=>(()=>{var u=Tp();return u.addEventListener("mouseleave",y=>y.currentTarget.style.transform="scale(1)"),u.addEventListener("mouseenter",y=>y.currentTarget.style.transform="scale(1.2)"),u.$$click=y=>{y.stopPropagation(),e(h.value)},u.$$mousedown=y=>y.stopPropagation(),u.addEventListener("dragstart",y=>{y.stopPropagation(),o(y,h.value)}),mt(u,"draggable",!0),pt(y=>{var m=`${h.name} (Drag to shape/slide)`,g=`url(${h.value})`;return m!==y.e&&mt(u,"title",y.e=m),g!==y.t&&Yt(u,"background-image",y.t=g),y},{e:void 0,t:void 0}),u})()})),s}})),i})()};ne(["click","mousedown"]);function Rp(n,t){const e=o=>{n.contains(o.target)||t()?.()};document.body.addEventListener("click",e),oe(()=>{document.body.removeEventListener("click",e)})}var Ap=nt("<div class=menu-backdrop>"),Dp=nt("<input type=file accept=.json,.yappy style=display:none>"),Op=nt("<div class=app-title>"),_p=nt("<div class=menu-item><span class=label>Slide Toolbar</span><div class=menu-item-right>"),zp=nt("<div class=menu-item><span class=label>Slide Panel</span><div class=menu-item-right>"),Bp=nt('<div class=menu-dropdown><button class=menu-item><span class=label>New Infinite Drawing</span></button><button class=menu-item><span class=label>New Presentation</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Load Sketch...</span></button><button class=menu-item><span class=label>Export / Save...</span></button><button class=menu-item><span class=label>Export</span><div class=menu-item-right><span class=shortcut>Ctrl+Shift+E</span></div></button><div class=menu-separator></div><div class=menu-item><span class=label>Properties Panel</span><div class=menu-item-right><span class=shortcut>Alt+Enter</span></div></div><div class=menu-item><span class=label>Layers Panel</span><div class=menu-item-right><span class=shortcut>Alt+L</span></div></div><div class=menu-item><span class=label>Display States</span><div class=menu-item-right></div></div><div class=menu-item><span class=label>Minimap</span><div class=menu-item-right><span class=shortcut>Alt+M</span></div></div><div class=menu-item><span class=label>Action Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><div class=menu-header>View</div><div class=menu-item><span class=label>Drawing Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><button class=menu-item><span class=label>Templates</span></button><div class=menu-separator></div><div style="padding:4px 12px;font-size:12px;color:var(--text-secondary)">Found a bug? <a href=https://github.com/rajeshpillai/yappy/issues target=_blank rel="noopener noreferrer">Report'),Wp=nt('<div style=position:fixed;top:12px;left:12px;z-index:10001><div class=menu-container style=position:relative><div class="drag-handle sm"><div class=drag-dots></div></div><button title=Menu></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title=Delete></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Zoom to Fit">'),Xp=nt('<div class=menu-dropdown style="position:absolute;top:100%;right:0;margin:8px 0 0 0;padding:4px;width:auto;min-width:180px">'),Yp=nt('<div style=position:fixed;top:12px;right:12px;z-index:10000><div class=menu-container><div class="drag-handle sm"><div class=drag-dots></div></div><button class=menu-btn title="Play All Animations"></button><button class=menu-btn></button><button class=menu-btn title="Stop All Animations"></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><div style=position:relative><button title="P3 Color Palette"></button></div><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Toggle Theme">');const Hp=fe(()=>he(()=>import("./help-dialog-RKXQf_uS.js"),__vite__mapDeps([4,1,2,5]),import.meta.url)),Np=fe(()=>he(()=>import("./load-export-dialog-Dy3tZQ_g.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url)),Fp=fe(()=>he(()=>import("./file-open-dialog-C6-i59Nf.js"),__vite__mapDeps([8,1,2,3,9]),import.meta.url)),Up=fe(()=>he(()=>import("./export-dialog-DD17ug_C.js"),__vite__mapDeps([10,1,2,3,11]),import.meta.url)),Gp=fe(()=>he(()=>import("./save-dialog-COQM97_z.js"),__vite__mapDeps([12,1,2,13]),import.meta.url)),qp=fe(()=>he(()=>import("./template-browser-Dp0RcBa7.js"),__vite__mapDeps([14,1,2,15]),import.meta.url)),[Ao,Xn]=kt("default"),[zl,zi]=kt(!1),[Bl,Wl]=kt(!1),[Xl,Oe]=kt(!1),[Yl,ts]=kt(!1);let es=()=>{};const Do=n=>{typeof es=="function"&&(es(n),Wl(!0))},ns=(n="slides")=>{confirm(`Start new ${n==="slides"?"presentation":"sketch"}? Unsaved changes will be lost.`)&&(yl(n),Xn("default"))},jp=()=>{const[n,t]=kt(!1),[e,o]=kt("load");let i;const[s,r]=kt("workspace");es=r;const[a,c]=kt(!1),[l,d]=kt(!1);let h;Vt(()=>{l()&&h&&Rp(h,()=>()=>d(!1))}),window.triggerImageUpload=()=>i?.click();const u=async lt=>{try{Xn(lt),ws();const ft={version:4,metadata:{name:lt,updatedAt:new Date().toISOString(),docType:p.docType},elements:JSON.parse(JSON.stringify(p.elements)),layers:JSON.parse(JSON.stringify(p.layers)),slides:JSON.parse(JSON.stringify(p.slides)),globalSettings:JSON.parse(JSON.stringify(p.globalSettings)),gridSettings:JSON.parse(JSON.stringify(p.gridSettings)),states:JSON.parse(JSON.stringify(p.states))};if(s()==="workspace"){if(!pp.enableWorkspacePersistence){Bt("Workspace saving is disabled","error");return}await rr.saveDrawing(lt,ft),Bt(`Drawing saved as "${lt}"!`,"success")}else{const _t=JSON.stringify(ft,null,2);let zt,Kt,Lt;if(s()==="disk-json")zt=new Blob([_t],{type:"application/json"}),Kt=`${lt}.json`,Lt="application/json";else{const ae=new Blob([_t]).stream().pipeThrough(new CompressionStream("gzip"));zt=await new Response(ae).blob(),Kt=`${lt}.yappy`,Lt="application/gzip"}const Zt=new File([zt],Kt,{type:Lt});if(navigator.canShare&&navigator.canShare({files:[Zt]}))try{await navigator.share({files:[Zt],title:"Yappy Drawing",text:s()==="disk-json"?"Save your drawing JSON":"Save your compressed drawing"});return}catch(ae){ae.name!=="AbortError"&&console.error("Share failed:",ae)}const re=URL.createObjectURL(zt),Ft=document.createElement("a");Ft.href=re,Ft.download=Kt,document.body.appendChild(Ft),Ft.click(),document.body.removeChild(Ft),URL.revokeObjectURL(re)}}catch(ft){console.error("Save failed:",ft),Bt(`Failed to save: ${ft instanceof Error?ft.message:String(ft)}`,"error")}},y=async lt=>{const ft=lt||Ao();try{const _t=await rr.loadDrawing(ft);if(_t){const zt=Ko(_t)?_t:Zo(_t);Ni(zt),Xn(ft),Bt("Drawing loaded successfully","success")}else Bt("Drawing not found","error")}catch(_t){console.error(_t),Bt("Failed to load drawing","error")}},m=()=>{Ps()},g=lt=>{p.elements.length>0&&!confirm("Loading a template will clear the current canvas. Continue?")||(kl(lt.data),c(!1),Bt(`Template "${lt.metadata.name}" loaded`,"success"))},w=async lt=>{const ft=lt.target.files?.[0];if(ft){try{let _t;if(ft.name.endsWith(".yappy")||ft.type==="application/gzip"||ft.type==="application/x-gzip")try{const Zt=new DecompressionStream("gzip"),re=ft.stream().pipeThrough(Zt);_t=await new Response(re).text()}catch(Zt){console.warn("Decompression failed, trying as plain text...",Zt),_t=await ft.text()}else _t=await ft.text();const zt=JSON.parse(_t),Kt=Ko(zt)?zt:Zo(zt);Ni(Kt);const Lt=ft.name.replace(/\.(json|yappy)$/i,"");Xn(Lt),Bt("File loaded successfully","success")}catch(_t){console.error(_t),Bt("Failed to load file. It might be corrupted or invalid format.","error")}t(!1),lt.target.value=""}},[x,b]=kt({x:0,y:0}),[S,P]=kt(!1),[A,B]=kt({x:0,y:0}),[X,D]=kt({x:0,y:0}),[Q,ot]=kt(!1),[st,dt]=kt({x:0,y:0}),ut=lt=>{const ft=lt.target;if(ft.closest(".menu-container")||ft.classList.contains("app-title")||ft.classList.contains("drag-handle")){if(ft.tagName==="BUTTON"||ft.closest("button"))return;P(!0),B({x:lt.clientX-x().x,y:lt.clientY-x().y}),lt.preventDefault()}},xt=lt=>{const ft=lt.target;if(ft.closest(".menu-container")||ft.classList.contains("drag-handle")){if(ft.tagName==="BUTTON"||ft.closest("button"))return;ot(!0),dt({x:lt.clientX-X().x,y:lt.clientY-X().y}),lt.preventDefault()}},Dt=lt=>{S()&&b({x:lt.clientX-A().x,y:lt.clientY-A().y}),Q()&&D({x:lt.clientX-st().x,y:lt.clientY-st().y})},Xt=()=>{P(!1),ot(!1)};return hn(()=>{window.addEventListener("mousemove",Dt),window.addEventListener("mouseup",Xt),oe(()=>{window.removeEventListener("mousemove",Dt),window.removeEventListener("mouseup",Xt)});const ft=new URLSearchParams(window.location.search).get("id");ft&&(Xn(ft),y(ft))}),[I(St,{get when(){return n()},get children(){var lt=Ap();return lt.$$click=()=>t(!1),lt}}),(()=>{var lt=Dp();lt.addEventListener("change",w);var ft=i;return typeof ft=="function"?Wt(ft,lt):i=lt,lt})(),I(pr,{fallback:null,get children(){return[I(Fp,{get isOpen(){return zl()},onClose:()=>zi(!1),onSelect:lt=>{y(lt),zi(!1)}}),I(Up,{get isOpen(){return p.showExportDialog},onClose:()=>Ei(!1)}),I(Gp,{get isOpen(){return Bl()},onClose:()=>Wl(!1),onSave:u,get initialFilename(){return Ao()}}),I(Hp,{get isOpen(){return Yl()},onClose:()=>ts(!1)}),I(Np,{get isOpen(){return Xl()},get initialTab(){return e()},onClose:()=>Oe(!1),onLoadWorkspace:()=>{Oe(!1),zi(!0)},onLoadDisk:()=>{Oe(!1),i?.click()},onSaveWorkspace:()=>{Oe(!1),Do("workspace")},onSaveDisk:()=>{Oe(!1),Do("disk")},onSaveDiskJson:()=>{Oe(!1),Do("disk-json")},onExportImage:()=>{Oe(!1),Ei(!0)}}),I(qp,{get isOpen(){return a()},onClose:()=>c(!1),onSelectTemplate:g})]}}),I(St,{get when(){return!p.zenMode},get children(){var lt=Op();return lt.$$mousedown=ut,Y(lt,Ao),pt(ft=>Yt(lt,"transform",`translate(calc(-50% + ${x().x}px), ${x().y}px)`)),lt}}),I(St,{get when(){return!p.zenMode},get children(){return[(()=>{var lt=Wp(),ft=lt.firstChild,_t=ft.firstChild,zt=_t.nextSibling,Kt=zt.nextSibling,Lt=Kt.nextSibling,Zt=Lt.nextSibling,re=Zt.nextSibling;return ft.$$mousedown=ut,zt.$$click=()=>t(!n()),Y(zt,I(Wc,{size:20})),Y(ft,I(St,{get when(){return n()},get children(){var Ft=Bp(),ae=Ft.firstChild,Le=ae.firstChild,ce=ae.nextSibling,jt=ce.firstChild,un=ce.nextSibling,Ce=un.nextSibling,Fe=Ce.firstChild,me=Ce.nextSibling,fn=me.firstChild,ee=me.nextSibling,lo=ee.firstChild,ni=ee.nextSibling,Ke=ni.nextSibling,ii=Ke.firstChild,ue=ii.nextSibling,co=ue.firstChild,Te=Ke.nextSibling,oi=Te.firstChild,si=oi.nextSibling,ho=si.firstChild,pn=Te.nextSibling,yn=pn.firstChild,gn=yn.nextSibling,Ue=pn.nextSibling,ri=Ue.firstChild,Ge=ri.nextSibling,ke=Ge.firstChild,qe=Ue.nextSibling,En=qe.firstChild,Rn=En.nextSibling,ai=qe.nextSibling,uo=ai.nextSibling,Ze=uo.nextSibling,An=Ze.firstChild,fo=An.nextSibling,po=Ze.nextSibling,tn=po.nextSibling,yo=tn.firstChild,li=tn.nextSibling;return li.nextSibling,ae.$$click=()=>{ns("infinite"),t(!1)},Y(ae,I(go,{size:16}),Le),ce.$$click=()=>{ns("slides"),t(!1)},Y(ce,I(Xc,{size:16}),jt),Ce.$$click=()=>{o("load"),Oe(!0),t(!1)},Y(Ce,I(Yc,{size:16}),Fe),me.$$click=()=>{o("save"),Oe(!0),t(!1)},Y(me,I(Hc,{size:16}),fn),ee.$$click=()=>{Ei(!0),t(!1)},Y(ee,I(Nc,{size:16}),lo),Ke.$$click=()=>{$n(),t(!1)},Y(Ke,I(bn,{size:16}),ii),Y(ue,I(St,{get when(){return p.showPropertyPanel},get children(){return I(Re,{size:14,class:"check-icon"})}}),co),Te.$$click=()=>{Fi(),t(!1)},Y(Te,I(ss,{size:16}),oi),Y(si,I(St,{get when(){return p.showLayerPanel},get children(){return I(Re,{size:14,class:"check-icon"})}}),ho),pn.$$click=()=>{fl(),t(!1)},Y(pn,I(Fc,{size:16}),yn),Y(gn,I(St,{get when(){return p.showStatePanel},get children(){return I(Re,{size:14,class:"check-icon"})}})),Ue.$$click=()=>{oo(),t(!1)},Y(Ue,I(go,{size:16}),ri),Y(Ge,I(St,{get when(){return p.minimapVisible},get children(){return I(Re,{size:14,class:"check-icon"})}}),ke),qe.$$click=()=>{bl(),t(!1)},Y(qe,I(bn,{size:16}),En),Y(Rn,I(St,{get when(){return p.showUtilityToolbar},get children(){return I(Re,{size:14,class:"check-icon"})}})),Y(Ft,I(St,{get when(){return p.docType==="slides"},get children(){var Ie=_p(),en=Ie.firstChild,f=en.nextSibling;return Ie.$$click=()=>{wl(),t(!1)},Y(Ie,I(zs,{size:16}),en),Y(f,I(St,{get when(){return p.showSlideToolbar},get children(){return I(Re,{size:14,class:"check-icon"})}})),Ie}}),ai),Y(Ft,I(St,{get when(){return p.docType==="slides"},get children(){var Ie=zp(),en=Ie.firstChild,f=en.nextSibling;return Ie.$$click=()=>{Es(),t(!1)},Y(Ie,I(bn,{size:16}),en),Y(f,I(St,{get when(){return p.showSlideNavigator},get children(){return I(Re,{size:14,class:"check-icon"})}})),Ie}}),Ze),Ze.$$click=()=>{vl(),t(!1)},Y(Ze,I(bn,{size:16}),An),Y(fo,I(St,{get when(){return p.showMainToolbar},get children(){return I(Re,{size:14,class:"check-icon"})}})),tn.$$click=()=>{c(!0),t(!1)},Y(tn,I(bn,{size:16}),yo),Ft}}),Kt),Lt.$$click=()=>Qe(p.selection),Y(Lt,I(Uc,{size:18})),re.$$click=m,Y(re,I(go,{size:18})),pt(Ft=>{var ae=`translate(${x().x}px, ${x().y}px)`,Le=`menu-btn ${n()?"active":""}`,ce=p.selection.length===0;return ae!==Ft.e&&Yt(lt,"transform",Ft.e=ae),Le!==Ft.t&&Nt(zt,Ft.t=Le),ce!==Ft.a&&(Lt.disabled=Ft.a=ce),Ft},{e:void 0,t:void 0,a:void 0}),lt})(),I(St,{get when(){return p.showUtilityToolbar},get children(){var lt=Yp(),ft=lt.firstChild,_t=ft.firstChild,zt=_t.nextSibling,Kt=zt.nextSibling,Lt=Kt.nextSibling,Zt=Lt.nextSibling,re=Zt.nextSibling,Ft=re.firstChild,ae=re.nextSibling,Le=ae.nextSibling;ft.$$mousedown=xt,zt.$$click=()=>Yi.playAll("programmatic"),Y(zt,I(zs,{size:18,get color(){return nn()&&!Ee()?"#9ca3af":"#10b981"},get fill(){return nn()&&!Ee()?"#9ca3af":"#10b981"}})),Kt.$$click=()=>Ee()?At.resumeAll():At.pauseAll(),Y(Kt,I(Gc,{size:18,get color(){return!nn()&&!Ee()?"#9ca3af":"#f59e0b"},get fill(){return!nn()&&!Ee()?"#9ca3af":"#f59e0b"}})),Lt.$$click=()=>Yi.stopAll(),Y(Lt,I(Ji,{size:18,color:"#ef4444",fill:"#ef4444"}));var ce=h;return typeof ce=="function"?Wt(ce,re):h=re,Ft.$$click=()=>d(!l()),Y(Ft,I(qc,{size:18,color:"#f43f5e"})),Y(re,I(St,{get when(){return l()},get children(){var jt=Xp();return Y(jt,I(Ep,{})),jt}}),null),Se(Le,"click",ml,!0),Y(Le,(()=>{var jt=Cn(()=>p.theme==="dark");return()=>jt()?I(jc,{size:18}):I(Qc,{size:18})})()),pt(jt=>{var un=`translate(${X().x}px, ${X().y}px)`,Ce=nn()&&!Ee(),Fe=Ee()?"Resume Animations":"Pause Animations",me=!nn()&&!Ee(),fn=!nn()&&!Ee(),ee=`menu-btn ${l()?"active":""}`;return un!==jt.e&&Yt(lt,"transform",jt.e=un),Ce!==jt.t&&(zt.disabled=jt.t=Ce),Fe!==jt.a&&mt(Kt,"title",jt.a=Fe),me!==jt.o&&(Kt.disabled=jt.o=me),fn!==jt.i&&(Lt.disabled=jt.i=fn),ee!==jt.n&&Nt(Ft,jt.n=ee),jt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),lt}})]}})]};ne(["click","mousedown"]);var Qp=nt('<div class=zoom-container><div class=zoom-group><button class=zoom-btn title="Zoom Out"></button><button class="zoom-btn text-btn"title="Reset Zoom">%</button><button class=zoom-btn title="Zoom In"></button></div><div class=zoom-group style=margin-left:12px><button class=zoom-btn title="Undo (Ctrl+Z)"></button><button class=zoom-btn title="Redo (Ctrl+Y)">');const Vp=()=>{const n=()=>{const o=Math.min(p.viewState.scale*1.1,10);ie({scale:o})},t=()=>{const o=Math.max(p.viewState.scale*.9,.1);ie({scale:o})},e=()=>{ie({scale:1})};return(()=>{var o=Qp(),i=o.firstChild,s=i.firstChild,r=s.nextSibling,a=r.firstChild,c=r.nextSibling,l=i.nextSibling,d=l.firstChild,h=d.nextSibling;return s.$$click=t,Y(s,I(ls,{size:16})),r.$$click=e,Y(r,()=>Math.round(p.viewState.scale*100),a),c.$$click=n,Y(c,I(Vc,{size:16})),Se(d,"click",ps,!0),Y(d,I(Jc,{size:16})),Se(h,"click",Hi,!0),Y(h,I(Kc,{size:16})),pt(u=>{var y=p.undoStackLength===0,m=p.redoStackLength===0;return y!==u.e&&(d.disabled=u.e=y),m!==u.t&&(h.disabled=u.t=m),u},{e:void 0,t:void 0}),o})()};ne(["click"]);class Jp{steps=[];currentStepIndex=0;isPlaying=!1;isPaused=!1;activeAnimationIds=[];resolvePromise=null;add(t,e){return e&&e>0&&this.steps.push({type:"delay",delay:e}),this.steps.push({type:"animation",factory:t}),this}parallel(...t){return this.steps.push({type:"parallel",factories:t}),this}delay(t){return this.steps.push({type:"delay",delay:t}),this}call(t){return this.steps.push({type:"callback",callback:t}),this}play(){return this.isPaused?(this.isPaused=!1,this.isPlaying=!0,At.resumeAll(),Promise.resolve()):this.isPlaying?Promise.resolve():(this.isPlaying=!0,this.currentStepIndex=0,new Promise(t=>{this.resolvePromise=t,this.runNextStep()}))}pause(){this.isPlaying&&(this.isPaused=!0,this.isPlaying=!1,At.pauseAll())}stop(){this.isPlaying=!1,this.isPaused=!1,this.currentStepIndex=0;for(const t of this.activeAnimationIds)At.stop(t);this.activeAnimationIds=[],this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null)}reset(){this.stop(),this.currentStepIndex=0}get progress(){return this.steps.length===0?0:this.currentStepIndex/this.steps.length}get playing(){return this.isPlaying}get paused(){return this.isPaused}runNextStep(){if(!this.isPlaying||this.currentStepIndex>=this.steps.length){this.isPlaying=!1,this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null);return}const t=this.steps[this.currentStepIndex];switch(this.currentStepIndex++,t.type){case"animation":this.runAnimation(t.factory);break;case"parallel":this.runParallel(t.factories);break;case"delay":this.runDelay(t.delay);break;case"callback":t.callback?.(),this.runNextStep();break}}runAnimation(t){const e=t();if(!e){this.runNextStep();return}this.activeAnimationIds.push(e);const o=()=>{const i=At.getState(e);i===null||i==="completed"?(this.activeAnimationIds=this.activeAnimationIds.filter(s=>s!==e),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(o)};requestAnimationFrame(o)}runParallel(t){const e=t.map(i=>i()).filter(i=>i!=="");if(e.length===0){this.runNextStep();return}this.activeAnimationIds.push(...e);const o=()=>{let i=!0;for(const s of e){const r=At.getState(s);r!==null&&r!=="completed"&&(i=!1)}i?(this.activeAnimationIds=this.activeAnimationIds.filter(s=>!e.includes(s)),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(o)};requestAnimationFrame(o)}runDelay(t){setTimeout(()=>{this.isPlaying&&!this.isPaused&&this.runNextStep()},t)}}function Kp(){return new Jp}const Zp={get state(){return p},createElement(n,t,e,o,i,s){const r=crypto.randomUUID(),a=p.defaultElementStyles,c={id:r,type:n,x:t,y:e,width:o,height:i,strokeColor:s?.strokeColor??a.strokeColor??"#000000",backgroundColor:s?.backgroundColor??a.backgroundColor??"transparent",fillStyle:s?.fillStyle??a.fillStyle??"solid",strokeWidth:s?.strokeWidth??a.strokeWidth??1,strokeStyle:s?.strokeStyle??a.strokeStyle??"solid",opacity:s?.opacity??a.opacity??100,roughness:s?.roughness??a.roughness??1,angle:s?.angle??0,renderStyle:a.renderStyle??"sketch",seed:s?.seed??Math.floor(Math.random()*2**31),roundness:s?.roundness??a.roundness??null,fontFamily:s?.fontFamily??a.fontFamily??"hand-drawn",fontSize:s?.fontSize??a.fontSize??20,textAlign:s?.textAlign??a.textAlign??"left",verticalAlign:s?.verticalAlign??"middle",startArrowhead:s?.startArrowhead??a.startArrowhead??null,endArrowhead:s?.endArrowhead??a.endArrowhead??"arrow",locked:s?.locked??!1,link:s?.link??null,layerId:s?.layerId??p.activeLayerId,curveType:s?.curveType??"straight",containerText:s?.containerText??"",parentId:s?.parentId??null,isCollapsed:s?.isCollapsed??!1,autoResize:s?.autoResize??!1,constrained:s?.constrained??!1,starPoints:s?.starPoints,polygonSides:s?.polygonSides,burstPoints:s?.burstPoints,borderRadius:s?.borderRadius,shadowEnabled:s?.shadowEnabled??!1,shadowColor:s?.shadowColor,shadowBlur:s?.shadowBlur,shadowOffsetX:s?.shadowOffsetX,shadowOffsetY:s?.shadowOffsetY,gradientStart:s?.gradientStart,gradientEnd:s?.gradientEnd,gradientDirection:s?.gradientDirection,gradientStops:s?.gradientStops,gradientType:s?.gradientType,gradientHandlePositions:s?.gradientHandlePositions,drawInnerBorder:s?.drawInnerBorder,innerBorderColor:s?.innerBorderColor,innerBorderDistance:s?.innerBorderDistance,strokeLineJoin:s?.strokeLineJoin,spinEnabled:s?.spinEnabled,spinSpeed:s?.spinSpeed,orbitEnabled:s?.orbitEnabled,orbitCenterId:s?.orbitCenterId,orbitRadius:s?.orbitRadius,orbitSpeed:s?.orbitSpeed,orbitDirection:s?.orbitDirection,flowAnimation:s?.flowAnimation,flowSpeed:s?.flowSpeed,flowStyle:s?.flowStyle,flowColor:s?.flowColor,flowDensity:s?.flowDensity,textColor:s?.textColor,textHighlightEnabled:s?.textHighlightEnabled??!1,textHighlightColor:s?.textHighlightColor,textHighlightPadding:s?.textHighlightPadding,textHighlightRadius:s?.textHighlightRadius,...s};return(c.type==="line"||c.type==="arrow"||c.type==="bezier")&&(c.curveType==="elbow"||c.curveType==="bezier"||c.type==="bezier")&&(!c.points||c.points.length===0)&&(c.points=[0,0,c.width,c.height]),sn(c),r},createRectangle(n,t,e,o,i){return this.createElement("rectangle",n,t,e,o,i)},createCircle(n,t,e,o,i){return this.createElement("circle",n,t,e,o,i)},createDiamond(n,t,e,o,i){return this.createElement("diamond",n,t,e,o,i)},createTriangle(n,t,e,o,i){return this.createElement("triangle",n,t,e,o,i)},createPolygonalShape(n,t,e,o,i,s){return this.createElement(n,t,e,o,i,s)},createStar(n,t,e,o,i=5,s){return this.createElement("star",n,t,e,o,{...s,starPoints:i})},createBrowserWindow(n,t,e,o,i){return this.createElement("browserWindow",n,t,e,o,i)},createStickyNote(n,t,e,o,i,s){return this.createElement("stickyNote",n,t,e,o,{...s,containerText:i})},createLine(n,t,e,o,i){const s=e-n,r=o-t;return this.createElement("line",n,t,s,r,i)},createArrow(n,t,e,o,i){const s=e-n,r=o-t;return this.createElement("arrow",n,t,s,r,{...i})},createBezier(n,t,e,o,i){const s=e-n,r=o-t;return this.createElement("bezier",n,t,s,r,{...i,curveType:"bezier"})},createOrganicBranch(n,t,e,o,i){const s=e-n,r=o-t;return this.createElement("organicBranch",n,t,s,r,{...i,curveType:"bezier",strokeWidth:i?.strokeWidth??3})},createText(n,t,e,o){const i=crypto.randomUUID(),s=p.defaultElementStyles,r=o?.fontSize??s.fontSize??20,a=e.length*(r*.6),c={id:i,type:"text",x:n,y:t,width:a,height:r*1.5,text:e,strokeColor:o?.strokeColor??s.strokeColor??"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,strokeStyle:"solid",opacity:o?.opacity??100,roughness:0,angle:o?.angle??0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,fontFamily:o?.fontFamily??s.fontFamily??"hand-drawn",fontSize:r,textAlign:o?.textAlign??s.textAlign??"left",verticalAlign:o?.verticalAlign??"middle",locked:!1,link:null,layerId:o?.layerId??p.activeLayerId,...o};return sn(c),i},createImage(n,t,e,o,i,s){return this.createElement("image",n,t,o,i,{...s,backgroundColor:"transparent",fillStyle:"solid",dataURL:e,status:"loaded"})},getElement(n){return p.elements.find(t=>t.id===n)},updateElement(n,t){Z(n,t,!0)},deleteElement(n){Qe([n])},clear(){p.elements.length>0&&(Mt(),$("elements",[]),$("selection",[]))},setSelected(n){$("selection",n)},clearSelection(){$("selection",[])},setView(n,t,e){ie({scale:n,panX:t,panY:e})},updateGridSettings(n){$("gridSettings",t=>({...t,...n}))},updateDefaultStyles(n){$("defaultElementStyles",t=>({...t,...n}))},async zoomToFit(){Ps()},connect(n,t,e){const o=this.getElement(n),i=this.getElement(t);if(!o||!i)return console.error("Source or Target element not found"),null;const s=o.x+o.width/2,r=o.y+o.height/2,a=i.x+i.width/2,c=i.y+i.height/2,l=e?.type??"arrow",d=e?.curveType??"bezier",h=(w,x,b,S,P)=>{const A=P.x+P.width/2,B=P.y+P.height/2,X=P.width/2,D=P.height/2,Q=b-w,ot=S-x;if(Q===0&&ot===0)return{x:w,y:x};const st=Math.atan2(ot,Q);if(P.type==="diamond"){const lt=Math.abs(Math.tan(st)),ft=1/(1/X+lt/D),_t=(Q>0?1:-1)*ft,zt=_t*Math.tan(st);return{x:A+_t,y:B+zt}}if(["circle","star","octagon","hexagon"].includes(P.type)){const lt=Math.cos(st),ft=Math.sin(st);return{x:A+X*lt,y:B+D*ft}}const dt=Q>0?A+X:A-X,ut=B+Math.tan(st)*(dt-A),xt=ot>0?B+D:B-D,Dt=A+(xt-B)/Math.tan(st);return ut>=B-D-1&&ut<=B+D+1?{x:dt,y:ut}:{x:Dt,y:xt}},u=h(s,r,a,c,o),y=h(a,c,s,r,i),m=this.createElement(l,u.x,u.y,y.x-u.x,y.y-u.y,{...e,curveType:d,startBinding:{elementId:n,focus:0,gap:5},endBinding:{elementId:t,focus:0,gap:5},points:[0,0,y.x-u.x,y.y-u.y]}),g=(w,x)=>{const b=w.boundElements||[];b.find(S=>S.id===x)||this.updateElement(w.id,{boundElements:[...b,{id:x,type:l}]})};return g(o,m),g(i,m),m},undo(){ps()},redo(){Hi()},groupSelection(){ks()},ungroupSelection(){Ms()},duplicate(n){gl(n)},toggleTheme(){ml()},addLayer(n){return xl(n)},deleteLayer(n){Qd(n)},setActiveLayer(n){$s(n)},mergeLayerDown(n){Zd(n)},flattenLayers(){th()},isolateLayer(n){eh(n)},showAllLayers(){nh()},updateLayer(n,t){Vd(n,t)},duplicateLayer(n){Jd(n)},reorderLayers(n,t){Xo(n,t)},moveElementsToLayer(n,t){ih(n,t)},createLayerGroup(n){fh(n)},toggleLayerGroupExpansion(n){ph(n)},isLayerVisible(n){return Ae(n)},isLayerLocked(n){return Cs(n)},toggleGrid(){Ts()},toggleSnapToGrid(){Is()},addDisplayState(n){Gd(n)},updateDisplayState(n){qd(n)},deleteDisplayState(n){jd(n)},applyDisplayState(n,t=!0){io(n,t)},toggleStatePanel(n){fl(n)},applyNextState(){vs()},applyPreviousState(){Ss()},addChildNode(n){ys(n)},addSiblingNode(n){gs(n)},toggleCollapseSelection(){cl()},toggleCollapse(n){Yo(n)},setParent(n,t){Ml(n,t)},reorderMindmap(n,t){vn(n,t)},applyMindmapStyling(n){Pl(n)},toggleCommandPalette(n){Sl(n)},togglePropertyPanel(n){$n(n)},togglePresentationMode(n){Ri(n)},toggleLayerPanel(n){Fi(n)},toggleMinimap(n){oo(n)},toggleZenMode(n){Ls(n)},toggleSlideNavigator(n){Es(n)},toggleMainToolbar(n){vl(n)},toggleUtilityToolbar(n){bl(n)},toggleSlideToolbar(n){wl(n)},setSlideToolbarPosition(n,t){uh(n,t)},addSlide(){ul()},deleteSlide(n){Hd(n)},duplicateSlide(n){Yd(n)},setActiveSlide(n){We(n)},reorderSlides(n,t){Nd(n,t)},updateSlideTransition(n,t){Fd(n,t)},updateSlideBackground(n,t){rn(n,t)},advancePresentation(){return bs()},retreatPresentation(){return hl()},goToFirstSlide(){return We(0)},goToLastSlide(){return We(p.slides.length-1)},setDocType(n){Ud(n)},loadDocument(n){Ni(n)},resetToNewDocument(n="slides"){yl(n)},bringToFront(n){ms(n)},sendToBack(n){xs(n)},moveElementZIndex(n,t){Wo(n,t)},alignSelectedElements(n){mh(n)},distributeSelectedElements(n){bh(n)},setCanvasBackgroundColor(n){oh(n)},setCanvasTexture(n){sh(n)},zoomToFitSlide(){qn()},setSelectedTool(n){Et(n)},moveSelectedElements(n,t){dl(n,t,!0)},loadTemplate(n){kl(n)},animateElement:K,animateElements:Mr,createTimeline:Kp,fadeIn:Ir,fadeOut:Lr,scaleIn:ds,bounce:Ki,pulse:Zi,shakeX:to,stopElementAnimation:Pr,pauseElementAnimation:$r,resumeElementAnimation:Tr,easings:an,animationEngine:At,createSpring:Sr,copyToClipboard:so,cutToClipboard:Rs,pasteFromClipboard:Gi,copyStyle:As,pasteStyle:Ds},ty=()=>{window.Yappy=Zp,console.log("Yappy API initialized. Use window.Yappy to interact.")};class V{static adjustColor(t,e){return e&&(t==="#000000"||t==="black"||t==="#000")?"#ffffff":t}static shadeColor(t,e){if(t==="transparent"||t==="none"||!t)return t;let o,i,s;if(t.startsWith("#")){const l=t.slice(1);l.length===3||l.length===4?(o=parseInt(l[0]+l[0],16),i=parseInt(l[1]+l[1],16),s=parseInt(l[2]+l[2],16)):(o=parseInt(l.substring(0,2),16),i=parseInt(l.substring(2,4),16),s=parseInt(l.substring(4,6),16))}else if(t.startsWith("rgb")){const l=t.match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(l)o=parseInt(l[1]),i=parseInt(l[2]),s=parseInt(l[3]);else return t}else return t;if(isNaN(o)||isNaN(i)||isNaN(s))return t;o=Math.min(255,Math.floor(o*e)),i=Math.min(255,Math.floor(i*e)),s=Math.min(255,Math.floor(s*e));const r=o.toString(16).padStart(2,"0"),a=i.toString(16).padStart(2,"0"),c=s.toString(16).padStart(2,"0");return"#"+r+a+c}static applyTransformations(t,e,o){t.save(),t.globalAlpha=(e.opacity??100)/100*o,e.blendMode&&(t.globalCompositeOperation=e.blendMode==="normal"?"source-over":e.blendMode),e.shadowEnabled?(t.shadowColor=e.shadowColor||"rgba(0,0,0,0.3)",t.shadowBlur=e.shadowBlur||10,t.shadowOffsetX=e.shadowOffsetX||5,t.shadowOffsetY=e.shadowOffsetY||5):t.shadowColor="transparent";let s=e.angle||0,r=e.x,a=e.y;const c=r+e.width/2,l=a+e.height/2;return s&&(t.translate(c,l),t.rotate(s),t.translate(-c,-l)),{cx:c,cy:l}}static restoreTransformations(t){t.restore()}static buildRenderOptions(t,e){const o=this.adjustColor(t.strokeColor,e);let i=t.backgroundColor==="transparent"?void 0:this.adjustColor(t.backgroundColor,e);["linear","radial","conic","dots"].includes(t.fillStyle)&&(i=void 0);const s=t.fillDensity||1,a=Math.max(.5,5/s);return{stroke:o,fill:i,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,hachureAngle:60,hachureGap:a,roughness:t.roughness??1,seed:t.seed||1,disableMultiStroke:t.roughness===0,strokeLineDash:t.strokeStyle==="dashed"?[8,8]:t.strokeStyle==="dotted"?[2,4]:void 0}}static applyComplexFills(t,e,o){const{ctx:i,element:s}=t,r=s.fillStyle,a=["linear","radial","conic"].includes(r)||s.gradientType!=="none"&&s.gradientType!==void 0,c=r==="dots";if(!a&&!c)return;i.save(),i.translate(e,o),a?(i.beginPath(),this.applyGradient(i,s)):c&&(i.beginPath(),this.applyDotsFill(i,s,t.isDarkMode));const l=Hn(s);l&&(this.renderGeometry(i,l),i.fill()),i.restore()}static applyGradient(t,e){const o=e.width,i=e.height,s=o/2,r=i/2,a=e.gradientType||e.fillStyle||"linear";let c;if(a==="linear"){const l=(e.gradientDirection||45)*(Math.PI/180),d=Math.sqrt(s**2+r**2),h=-Math.cos(l)*d,u=-Math.sin(l)*d,y=Math.cos(l)*d,m=Math.sin(l)*d;c=t.createLinearGradient(h,u,y,m)}else if(a==="radial"){const l=(e.gradientDirection||0)*(Math.PI/180),d=Math.max(o,i)/2,h=d*.4,u=Math.cos(l)*h,y=Math.sin(l)*h;c=t.createRadialGradient(u,y,0,0,0,d)}else if(a==="conic"){const l=(e.gradientDirection||0)*(Math.PI/180);c=t.createConicGradient(l,0,0)}else c=t.createLinearGradient(-s,-r,s,r);e.gradientStops&&e.gradientStops.length>0?[...e.gradientStops].sort((l,d)=>l.offset-d.offset).forEach(l=>c.addColorStop(l.offset,l.color)):e.gradientStart&&e.gradientEnd&&(c.addColorStop(0,e.gradientStart),c.addColorStop(1,e.gradientEnd)),t.fillStyle=c}static applyDotsFill(t,e,o){const i=e.fillDensity||1,s=o?"#ffffff":"#000000",r=document.createElement("canvas"),a=Math.max(5,20/i);r.width=a,r.height=a;const c=r.getContext("2d");if(c){c.fillStyle=s,c.beginPath(),c.arc(a/2,a/2,e.strokeWidth/2||1,0,Math.PI*2),c.fill();const l=t.createPattern(r,"repeat");l&&(t.fillStyle=l)}}static renderGeometry(t,e){if(e.type==="rect")t.roundRect(e.x,e.y,e.w,e.h,e.r||0);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx,e.ry,0,0,Math.PI*2);else if(e.type==="points"){if(e.points.length>0){t.moveTo(e.points[0].x,e.points[0].y);for(let o=1;o<e.points.length;o++)t.lineTo(e.points[o].x,e.points[o].y);e.isClosed!==!1&&t.closePath()}}else e.type==="path"?t.fill(new Path2D(e.path)):e.type==="multi"&&e.shapes.forEach(o=>this.renderGeometry(t,o))}static renderText(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t;if(s.isEditing)return;const a=s.containerText||s.text;if(!a)return;i.save();let c=s.width-20,l=0;s.type==="doubleBanner"?(c=s.width*.65,l=-(s.height*.1)):s.type==="starPerson"?l=s.height*.15:s.type==="lightbulb"?(c=s.width*.7,l=-(s.height*.1)):s.type==="signpost"?(c=s.width*.8,l=-(s.height*.15)):s.type==="browserWindow"?l=Math.min(s.height*.15,30)/2:s.type==="mobilePhone"&&(l=-(s.height*.05));const d=ve(i,s,a,c);i.font=ro(s);const h=s.textColor||s.strokeColor,u=this.adjustColor(h,r),y=s.textAlign||"center";i.textAlign=y,i.textBaseline="middle";const m=o-d.textHeight/2+d.lineHeight/2+l,g=s.fontFamily==="hand-drawn"?2:0,w=m+g,x=()=>y==="left"?e-(s.width||c)/2+10:y==="right"?e+(s.width||c)/2-10:e;if(s.textHighlightEnabled){const b=s.textHighlightColor||"rgba(255, 255, 0, 0.4)",S=s.textHighlightPadding??4,P=s.textHighlightRadius??2;i.fillStyle=this.adjustColor(b,r),d.lines.forEach((A,B)=>{const X=w+B*d.lineHeight,D=i.measureText(A).width,Q=x(),ot=S/2;let st=Q-D/2-S;y==="left"?st=Q-S:y==="right"&&(st=Q-D-S),i.beginPath(),i.roundRect?i.roundRect(st,X-d.lineHeight/2-ot,D+S*2,d.lineHeight+ot*2,P):i.rect(st,X-d.lineHeight/2-ot,D+S*2,d.lineHeight+ot*2),i.fill()})}i.fillStyle=u,d.lines.forEach((b,S)=>{const P=w+S*d.lineHeight,A=x();i.fillText(b,A,P,s.width-10)}),i.restore()}}class se{render(t){const{ctx:e,element:o,layerOpacity:i}=t;if(o.points&&o.points.length>0){this.renderCustomPoints(t);return}const{cx:s,cy:r}=V.applyTransformations(e,o,i),a=o.drawProgress;a!==void 0&&a>=0&&a<100?this.renderDrawProgress(t,s,r):(V.applyComplexFills(t,s,r),o.renderStyle==="architectural"?this.renderArchitectural(t,s,r):this.renderSketch(t,s,r)),o.flowAnimation&&this.renderFlowAnimation(t),V.restoreTransformations(e)}renderDrawProgress(t,e,o){const{ctx:i,element:s,isDarkMode:r,layerOpacity:a}=t,c=(s.drawProgress??0)/100;i.globalAlpha=a;const l=Math.min(1,c/.7),d=Math.max(0,Math.min(1,(c-.65)/.25)),h=Math.max(0,Math.min(1,(c-.85)/.15)),u=this.estimatePathLength(s),y=V.adjustColor(s.strokeColor,r);if(l>0){i.save(),i.strokeStyle=y,i.lineWidth=s.strokeWidth,i.lineCap="round",i.lineJoin="round";const m=u*l;i.setLineDash([m,u]),i.lineDashOffset=0,i.beginPath(),this.definePath(i,s),i.stroke(),i.restore()}if(d>0){const m=s.backgroundColor;if(m&&m!=="transparent"&&m!=="none"){i.save(),i.globalAlpha*=d;const g=s.fillStyle;["linear","radial","conic","dots"].includes(g)?V.applyComplexFills(t,e,o):(i.fillStyle=V.adjustColor(m,r),i.beginPath(),this.definePath(i,s),i.fill()),i.restore()}}h>0&&(i.save(),i.globalAlpha*=h,V.renderText(t,e,o),i.restore())}estimatePathLength(t){return 2*(Math.abs(t.width)+Math.abs(t.height))}renderCustomPoints(t){const{ctx:e,element:o,isDarkMode:i,layerOpacity:s}=t;console.log("[renderCustomPoints] Rendering custom points:",o.id,o.points?.length),e.save(),e.globalAlpha=s*(o.opacity??1);const r=this.normalizePoints(o.points);if(r.length===0)return;const a=o.x+o.width/2,c=o.y+o.height/2,l=r.map(d=>({x:d.x+a,y:d.y+c}));if(l.length>=3&&console.log("[renderCustomPoints] First 3 absolute points:",[{x:l[0].x,y:l[0].y},{x:l[1].x,y:l[1].y},{x:l[2].x,y:l[2].y}]),console.log("[renderCustomPoints] Element center:",{cx:a,cy:c}),e.save(),e.globalAlpha=s*(o.opacity??1),o.backgroundColor&&o.backgroundColor!=="transparent"&&o.backgroundColor!=="none"){e.fillStyle=V.adjustColor(o.backgroundColor,i),e.beginPath(),e.moveTo(l[0].x,l[0].y);for(let d=1;d<l.length;d++)e.lineTo(l[d].x,l[d].y);e.closePath(),e.fill()}e.strokeStyle=V.adjustColor(o.strokeColor,i),e.lineWidth=o.strokeWidth,e.beginPath(),e.moveTo(l[0].x,l[0].y);for(let d=1;d<l.length;d++)e.lineTo(l[d].x,l[d].y);e.closePath(),e.stroke(),e.restore()}normalizePoints(t){if(!t||t.length===0)return[];if(typeof t[0]=="object"&&"x"in t[0])return t;const e=[];for(let o=0;o<t.length-1;o+=2)e.push({x:t[o],y:t[o+1]});return e}renderFlowAnimation(t){const{ctx:e,element:o,isDarkMode:i}=t,s=o.flowSpeed!==void 0?o.flowSpeed:1,r=hd(),a=r/20*s;e.save(),e.strokeStyle=V.adjustColor(o.flowColor||o.strokeColor,i),e.lineWidth=Math.max(1,o.strokeWidth*.8),e.lineCap="round",e.lineJoin="round";const c=o.flowStyle||"dashes";if(c==="dots")e.setLineDash([2,8]);else if(c==="pulse"){const l=Math.sin(r/200)*.5+.5;e.globalAlpha*=l,e.setLineDash([])}else e.setLineDash([8,8]);e.lineDashOffset=-a,e.beginPath(),this.definePath(e,o),e.stroke(),e.restore()}}class ey extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);if(this.drawRectArch(i,s.x,s.y,s.width,s.height,a,s.strokeWidth,c.stroke,c.fill),s.drawInnerBorder){const l=s.innerBorderDistance||5;if(s.width>l*2&&s.height>l*2){const d=Math.max(0,a-l);this.drawRectArch(i,s.x+l,s.y+l,s.width-l*2,s.height-l*2,d,s.strokeWidth,s.innerBorderColor||c.stroke,"none")}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);if(this.drawRectSketch(i,s.x,s.y,s.width,s.height,a,c),s.drawInnerBorder){const l=s.innerBorderDistance||5;if(s.width>l*2&&s.height>l*2){const d=Math.max(0,a-l),h={...c,stroke:s.innerBorderColor||c.stroke,fill:"none"};this.drawRectSketch(i,s.x+l,s.y+l,s.width-l*2,s.height-l*2,d,h)}}V.renderText(t,e,o)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.15:0}drawRectArch(t,e,o,i,s,r,a,c,l){l&&l!=="transparent"&&l!=="none"&&(t.beginPath(),r>0?t.roundRect(e,o,i,s,r):t.rect(e,o,i,s),t.fillStyle=l,t.fill()),t.beginPath(),r>0?t.roundRect(e,o,i,s,r):t.rect(e,o,i,s),t.strokeStyle=c,t.lineWidth=a,t.stroke()}drawRectSketch(t,e,o,i,s,r,a){if(r>0){const c=this.getRoundedRectPath(e,o,i,s,r);t.path(c,a)}else t.rectangle(e,o,i,s,a)}getRoundedRectPath(t,e,o,i,s){const r=Math.min(Math.abs(o)/2,s),a=Math.min(Math.abs(i)/2,s);return`M ${t+r} ${e} L ${t+o-r} ${e} Q ${t+o} ${e} ${t+o} ${e+a} L ${t+o} ${e+i-a} Q ${t+o} ${e+i} ${t+o-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){const o=this.getRadius(e);o>0?t.roundRect(e.x,e.y,e.width,e.height,o):t.rect(e.x,e.y,e.width,e.height)}}class ny extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r);if(this.drawCircleArch(i,s.x,s.y,s.width,s.height,s.strokeWidth,a.stroke,a.fill),s.drawInnerBorder){const c=s.innerBorderDistance||5;s.width>c*2&&s.height>c*2&&this.drawCircleArch(i,s.x+c,s.y+c,s.width-c*2,s.height-c*2,s.strokeWidth,s.innerBorderColor||a.stroke,"none")}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r);if(i.ellipse(s.x+s.width/2,s.y+s.height/2,Math.abs(s.width),Math.abs(s.height),a),s.drawInnerBorder){const c=s.innerBorderDistance||5;if(s.width>c*2&&s.height>c*2){const l={...a,stroke:s.innerBorderColor||a.stroke,fill:"none"};i.ellipse(s.x+s.width/2,s.y+s.height/2,Math.abs(s.width)-c*2,Math.abs(s.height)-c*2,l)}}V.renderText(t,e,o)}drawCircleArch(t,e,o,i,s,r,a,c){const l=e+i/2,d=o+s/2,h=Math.abs(i)/2,u=Math.abs(s)/2;c&&c!=="transparent"&&c!=="none"&&(t.beginPath(),t.ellipse(l,d,h,u,0,0,Math.PI*2),t.fillStyle=c,t.fill()),t.beginPath(),t.ellipse(l,d,h,u,0,0,Math.PI*2),t.strokeStyle=a,t.lineWidth=r,t.stroke()}definePath(t,e){const o=e.x+e.width/2,i=e.y+e.height/2,s=Math.abs(e.width)/2,r=Math.abs(e.height)/2;t.ellipse(o,i,s,r,0,0,Math.PI*2)}estimatePathLength(t){const e=Math.abs(t.width)/2,o=Math.abs(t.height)/2,i=(e-o)**2/((e+o)**2||1);return Math.PI*(e+o)*(1+3*i/(10+Math.sqrt(4-3*i)))}}class iy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);if(this.drawDiamondArch(i,s.x,s.y,s.width,s.height,a,s.strokeWidth,c.stroke,c.fill),s.drawInnerBorder){const l=s.innerBorderDistance||5;if(s.width>l*2&&s.height>l*2){const d=Math.max(0,a-l);this.drawDiamondArch(i,s.x+l,s.y+l,s.width-l*2,s.height-l*2,d,s.strokeWidth,s.innerBorderColor||c.stroke,"none")}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);if(a>0){const l=this.getRoundedDiamondPath(s.x,s.y,s.width,s.height,a);i.path(l,c)}else{const l=s.width/2,d=s.height/2,h=[[s.x+l,s.y],[s.x+s.width,s.y+d],[s.x+l,s.y+s.height],[s.x,s.y+d]];i.polygon(h,c)}if(s.drawInnerBorder){const l=s.innerBorderDistance||5;if(s.width>l*2&&s.height>l*2){const d=Math.max(0,a-l),h={...c,stroke:s.innerBorderColor||c.stroke,fill:"none"};if(d>0){const u=this.getRoundedDiamondPath(s.x+l,s.y+l,s.width-l*2,s.height-l*2,d);i.path(u,h)}else{const u=(s.width-l*2)/2,y=(s.height-l*2)/2,m=s.x+l,g=s.y+l,w=s.width-l*2,x=s.height-l*2,b=[[m+u,g],[m+w,g+y],[m+u,g+x],[m,g+y]];i.polygon(b,h)}}}V.renderText(t,e,o)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.2:0}drawDiamondArch(t,e,o,i,s,r,a,c,l){const d=i/2,h=s/2,u=e+d,y=o+h;if(l&&l!=="transparent"&&l!=="none")if(t.beginPath(),r>0){const m=this.getRoundedDiamondPath(e,o,i,s,r);t.fill(new Path2D(m))}else t.moveTo(u,o),t.lineTo(e+i,y),t.lineTo(u,o+s),t.lineTo(e,y),t.closePath(),t.fillStyle=l,t.fill();if(t.beginPath(),r>0){const m=this.getRoundedDiamondPath(e,o,i,s,r);t.stroke(new Path2D(m))}else t.moveTo(u,o),t.lineTo(e+i,y),t.lineTo(u,o+s),t.lineTo(e,y),t.closePath(),t.strokeStyle=c,t.lineWidth=a,t.stroke()}getRoundedDiamondPath(t,e,o,i,s){const r=o/2,a=i/2,c=t+r,l=e+a,d=Math.hypot(r,a),u=Math.min(s,d/2)/d,y=r*u,m=a*u,g={x:c-y,y:e+m},w={x:c+y,y:e+m},x={x:t+o-y,y:l-m},b={x:t+o-y,y:l+m},S={x:c+y,y:e+i-m},P={x:c-y,y:e+i-m},A={x:t+y,y:l+m},B={x:t+y,y:l-m};return`M ${g.x} ${g.y} Q ${c} ${e} ${w.x} ${w.y} L ${x.x} ${x.y} Q ${t+o} ${l} ${b.x} ${b.y} L ${S.x} ${S.y} Q ${c} ${e+i} ${P.x} ${P.y} L ${A.x} ${A.y} Q ${t} ${l} ${B.x} ${B.y} Z`}definePath(t,e){const o=this.getRadius(e);if(o>0)this.executePath(t,e.x,e.y,e.width,e.height,o);else{const i=e.width/2,s=e.height/2;t.moveTo(e.x+i,e.y),t.lineTo(e.x+e.width,e.y+s),t.lineTo(e.x+i,e.y+e.height),t.lineTo(e.x,e.y+s),t.closePath()}}executePath(t,e,o,i,s,r){const a=i/2,c=s/2,l=e+a,d=o+c,h=Math.hypot(a,c),y=Math.min(r,h/2)/h,m=a*y,g=c*y,w={x:l-m,y:o+g},x={x:l+m,y:o+g},b={x:e+i-m,y:d-g},S={x:e+i-m,y:d+g},P={x:l+m,y:o+s-g},A={x:l-m,y:o+s-g},B={x:e+m,y:d+g},X={x:e+m,y:d-g};t.moveTo(w.x,w.y),t.quadraticCurveTo(l,o,x.x,x.y),t.lineTo(b.x,b.y),t.quadraticCurveTo(e+i,d,S.x,S.y),t.lineTo(P.x,P.y),t.quadraticCurveTo(l,o+s,A.x,A.y),t.lineTo(B.x,B.y),t.quadraticCurveTo(e,d,X.x,X.y),t.closePath()}}class oy extends se{renderArchitectural(t,e,o){this.renderCommon(t)}renderSketch(t,e,o){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:o,isDarkMode:i}=t;if(!o.text)return;const s=o.fontSize||20,r=o.fontFamily==="sans-serif"?"Inter, sans-serif":o.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",a=o.fontWeight===!0||o.fontWeight==="bold"?"bold ":"",c=o.fontStyle===!0||o.fontStyle==="italic"?"italic ":"";e.save(),e.font=`${c}${a}${s}px ${r}`;const d=e.measureText(o.text).width,h=o.width&&d&&!o.textHighlightEnabled?o.width/d:1,u=o.textColor||o.strokeColor,y=V.adjustColor(u,i),m=o.textAlign||"left";if(e.textAlign=m,e.textBaseline="hanging",o.textHighlightEnabled){const g=o.textHighlightColor||"rgba(255, 255, 0, 0.4)",w=o.textHighlightPadding??4,x=o.textHighlightRadius??2;e.fillStyle=V.adjustColor(g,i);const b=o.text.split(`
`),S=s*1.2,P=o.fontFamily==="hand-drawn"?-2:0,A=B=>m==="center"?o.x+(o.width||B)/2:m==="right"?o.x+(o.width||B):o.x;b.forEach((B,X)=>{const D=e.measureText(B).width,Q=A(D),ot=o.y+X*S+P,st=w/2;e.beginPath(),e.roundRect?e.roundRect(Q-(m==="center"?D/2:0)-w,ot-st,D+w*2,S+st*2,x):e.rect(Q-(m==="center"?D/2:0)-w,ot-st,D+w*2,S+st*2),e.fill()}),e.fillStyle=y,b.forEach((B,X)=>{const D=e.measureText(B).width,Q=A(D),ot=o.y+X*S;e.fillText(B,Q,ot)})}else{e.fillStyle=y;let g=o.x;m==="center"?g=o.x+(o.width||d)/2:m==="right"&&(g=o.x+(o.width||d)),h!==1?(e.translate(g,o.y),e.scale(h,1),e.fillText(o.text,0,0)):e.fillText(o.text,g,o.y)}e.restore()}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class sy extends se{renderArchitectural(t,e,o){this.renderCommon(t)}renderSketch(t,e,o){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:o}=t;if(!o.dataURL)return;const i=Tl(o.dataURL);i?e.drawImage(i,o.x,o.y,o.width,o.height):(e.save(),e.fillStyle="#e5e5e5",e.fillRect(o.x,o.y,o.width,o.height),e.fillStyle="#999",e.font="12px sans-serif",e.fillText("Loading image...",o.x+10,o.y+20),e.restore())}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class ry extends se{renderArchitectural(t,e,o){const{rc:i,ctx:s,element:r,isDarkMode:a}=t,c=V.buildRenderOptions(r,a),{mainPoints:l,foldPoints:d}=this.getPoints(r);c.fill&&c.fill!=="transparent"&&c.fill!=="none"&&(i.polygon(l,{...c,stroke:"none",fill:c.fill}),i.polygon(d,{...c,stroke:"none",fill:c.fill,fillStyle:"solid"})),s.beginPath(),s.moveTo(l[0][0],l[0][1]);for(let u=1;u<l.length;u++)s.lineTo(l[u][0],l[u][1]);s.closePath(),s.strokeStyle=V.adjustColor(r.strokeColor,a),s.lineWidth=r.strokeWidth,s.stroke(),s.beginPath(),s.moveTo(d[0][0],d[0][1]),s.lineTo(d[1][0],d[1][1]),s.lineTo(d[2][0],d[2][1]),s.stroke(),V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),{mainPoints:c,foldPoints:l}=this.getPoints(s);i.polygon(c,a),i.polygon(l,{...a,fillStyle:"solid"}),V.renderText(t,e,o)}getPoints(t){const e=Math.min(Math.abs(t.width),Math.abs(t.height))*.15,o=t.x,i=t.y,s=t.width,r=t.height,a=[[o,i],[o+s,i],[o+s,i+r-e],[o+s-e,i+r],[o,i+r]],c=[[o+s,i+r-e],[o+s-e,i+r-e],[o+s-e,i+r]];return{mainPoints:a,foldPoints:c}}definePath(t,e){const{mainPoints:o,foldPoints:i}=this.getPoints(e);t.moveTo(o[0][0],o[0][1]);for(let s=1;s<o.length;s++)t.lineTo(o[s][0],o[s][1]);t.closePath(),t.moveTo(i[0][0],i[0][1]),t.lineTo(i[1][0],i[1][1]),t.lineTo(i[2][0],i[2][1])}}class ay extends se{renderArchitectural(t,e,o){const{element:i}=t;if(this.drawPolygon(t,i.x,i.y,i.width,i.height),i.drawInnerBorder){const s=i.innerBorderDistance||5;i.width>s*2&&i.height>s*2&&this.drawPolygon(t,i.x+s,i.y+s,i.width-s*2,i.height-s*2,!0)}V.renderText(t,e,o)}renderSketch(t,e,o){const{element:i}=t;if(this.drawPolygon(t,i.x,i.y,i.width,i.height),i.drawInnerBorder){const s=i.innerBorderDistance||5;i.width>s*2&&i.height>s*2&&this.drawPolygon(t,i.x+s,i.y+s,i.width-s*2,i.height-s*2,!0)}V.renderText(t,e,o)}drawPolygon(t,e,o,i,s,r=!1){const{ctx:a,rc:c,element:l,isDarkMode:d}=t,h=this.getPoints(l,e,o,i,s),u=V.buildRenderOptions(l,d),y=V.adjustColor(l.strokeColor,d),m=r?{...u,stroke:l.innerBorderColor||y,fill:"none"}:u;if(l.renderStyle==="architectural"){const g=u.fill&&u.fill!=="transparent"&&u.fill!=="none";!r&&g&&l.fillStyle!=="dots"&&c.polygon(h,{...m,stroke:"none",fill:u.fill}),a.beginPath(),a.moveTo(h[0][0],h[0][1]);for(let w=1;w<h.length;w++)a.lineTo(h[w][0],h[w][1]);a.closePath(),a.strokeStyle=r&&l.innerBorderColor||y,a.lineWidth=l.strokeWidth,a.lineJoin=l.strokeLineJoin||"round",a.stroke()}else c.polygon(h,m)}getPoints(t,e,o,i,s){const r=e+i/2,a=o+s/2,c=i/2,l=s/2;switch(t.type){case"triangle":return[[r,o],[e+i,o+s],[e,o+s]];case"hexagon":return this.getRegularPolyPoints(r,a,c,l,6);case"octagon":return this.getRegularPolyPoints(r,a,c,l,8);case"parallelogram":{const d=i*.2;return[[e+d,o],[e+i,o],[e+i-d,o+s],[e,o+s]]}case"trapezoid":{const d=i*.2;return[[e+d,o],[e+i-d,o],[e+i,o+s],[e,o+s]]}case"rightTriangle":return[[e,o],[e,o+s],[e+i,o+s]];case"pentagon":return this.getRegularPolyPoints(r,a,c,l,5);case"septagon":return this.getRegularPolyPoints(r,a,c,l,7);case"polygon":return this.getRegularPolyPoints(r,a,c,l,t.polygonSides||6);default:return[[e,o],[e+i,o],[e+i,o+s],[e,o+s]]}}getRegularPolyPoints(t,e,o,i,s){const r=[];for(let a=0;a<s;a++){const c=2*Math.PI/s*a-Math.PI/2;r.push([t+o*Math.cos(c),e+i*Math.sin(c)])}return r}definePath(t,e){const o=this.getPoints(e,e.x,e.y,e.width,e.height);if(!(o.length<2)){t.moveTo(o[0][0],o[0][1]);for(let i=1;i<o.length;i++)t.lineTo(o[i][0],o[i][1]);t.closePath()}}estimatePathLength(t){const e=this.getPoints(t,t.x,t.y,t.width,t.height);if(e.length<2)return 0;let o=0;for(let i=0;i<e.length;i++){const s=e[(i+1)%e.length],r=s[0]-e[i][0],a=s[1]-e[i][1];o+=Math.sqrt(r*r+a*a)}return o}}class ly extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.adjustColor(s.strokeColor,r),c=s.backgroundColor==="transparent"?void 0:V.adjustColor(s.backgroundColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"database":{const y=u*.2,m=this.getDatabasePath(l,d,h,u,y),g=this.getDatabaseTopPath(l,d,h,u,y);c&&(i.fillStyle=c,i.fill(new Path2D(m))),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.stroke(new Path2D(m)),i.stroke(new Path2D(g));break}case"document":{const y=u*.1,m=this.getDocumentPath(l,d,h,u,y);c&&(i.fillStyle=c,i.fill(new Path2D(m))),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.lineJoin="round",i.stroke(new Path2D(m));break}case"predefinedProcess":{const y=h*.1;c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u),i.beginPath(),i.moveTo(l+y,d),i.lineTo(l+y,d+u),i.moveTo(l+h-y,d),i.lineTo(l+h-y,d+u),i.stroke();break}case"internalStorage":{const y=Math.min(h,u)*.15;c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u),i.beginPath(),i.moveTo(l+y,d),i.lineTo(l+y,d+u),i.moveTo(l,d+y),i.lineTo(l+h,d+y),i.stroke();break}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=s.x,l=s.y,d=s.width,h=s.height;switch(s.type){case"database":{const u=h*.2;i.path(this.getDatabasePath(c,l,d,h,u),a),i.path(this.getDatabaseTopPath(c,l,d,h,u),a);break}case"document":{const u=h*.1;i.path(this.getDocumentPath(c,l,d,h,u),a);break}case"predefinedProcess":{const u=d*.1;i.rectangle(c,l,d,h,a),i.line(c+u,l,c+u,l+h,a),i.line(c+d-u,l,c+d-u,l+h,a);break}case"internalStorage":{const u=Math.min(d,h)*.15;i.rectangle(c,l,d,h,a),i.line(c+u,l,c+u,l+h,a),i.line(c,l+u,c+d,l+u,a);break}}V.renderText(t,e,o)}getDatabasePath(t,e,o,i,s){return`
            M ${t} ${e+s/2}
            L ${t} ${e+i-s/2}
            A ${o/2} ${s/2} 0 0 0 ${t+o} ${e+i-s/2}
            L ${t+o} ${e+s/2}
            A ${o/2} ${s/2} 0 0 0 ${t} ${e+s/2}
            A ${o/2} ${s/2} 0 0 0 ${t+o} ${e+s/2}
        `}getDatabaseTopPath(t,e,o,i,s){return`
            M ${t} ${e+s/2}
            A ${o/2} ${s/2} 0 1 1 ${t+o} ${e+s/2}
            A ${o/2} ${s/2} 0 1 1 ${t} ${e+s/2}
        `}getDocumentPath(t,e,o,i,s){return`
            M ${t} ${e}
            L ${t+o} ${e}
            L ${t+o} ${e+i-s}
            Q ${t+o*.75} ${e+i-s*2} ${t+o*.5} ${e+i-s}
            T ${t} ${e+i-s}
            Z
        `}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class cy extends se{renderArchitectural(t,e,o){const{ctx:i,rc:s,element:r,isDarkMode:a}=t,c=V.buildRenderOptions(r,a),l=V.adjustColor(r.strokeColor,a),d=r.x,h=r.y,u=r.width,y=r.height;switch(r.type){case"starPerson":{const m=Math.min(Math.abs(u),Math.abs(y))*.15,g=d+u/2,w=h+m,x=this.getStarPersonBodyPoints(d,h,u,y,m);c.fill&&c.fill!=="transparent"&&c.fill!=="none"&&(s.ellipse(g,w,m*2,m*2,{...c,stroke:"none",fill:c.fill}),s.polygon(x,{...c,stroke:"none",fill:c.fill})),i.beginPath(),i.ellipse(g,w,m,m,0,0,Math.PI*2),i.moveTo(x[0][0],x[0][1]);for(let b=1;b<x.length;b++)i.lineTo(x[b][0],x[b][1]);i.strokeStyle=l,i.lineWidth=r.strokeWidth,i.stroke();break}case"lightbulb":{const m=Math.min(u,y/1.5)/2,g=u*.4,w=y*.25,x=h+y-w,b=this.getLightbulbPath(d,h,u,m,g,x);c.fill&&c.fill!=="transparent"&&c.fill!=="none"&&(i.fillStyle=c.fill,i.fill(new Path2D(b)),i.fillRect(d+u/2-g/2,x,g,w)),i.strokeStyle=l,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(b)),i.strokeRect(d+u/2-g/2,x,g,w);break}case"signpost":{const m=Math.max(4,u*.05),g=y*.3,w=u*.9,x=h+y*.1,b=d+u/2-m/2,S=d+u/2-w/2;c.fill&&c.fill!=="transparent"&&c.fill!=="none"&&(i.fillStyle=c.fill,i.fillRect(b,h,m,y),i.fillRect(S,x,w,g)),i.strokeStyle=l,i.lineWidth=r.strokeWidth,i.strokeRect(b,h,m,y),i.strokeRect(S,x,w,g);break}case"burstBlob":{const m=this.getBurstBlobPath(r);c.fill&&c.fill!=="transparent"&&c.fill!=="none"&&(i.fillStyle=c.fill,i.fill(new Path2D(m))),i.strokeStyle=l,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(m)),i.stroke(new Path2D(m));break}case"wavyDivider":{const m=this.getWavyDividerPath(d,h,u,y);i.strokeStyle=l,i.lineWidth=r.strokeWidth,i.stroke(new Path2D(m));break}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=s.x,l=s.y,d=s.width,h=s.height;switch(s.type){case"starPerson":{const u=Math.min(Math.abs(d),Math.abs(h))*.15;i.ellipse(c+d/2,l+u,u*2,u*2,a),i.polygon(this.getStarPersonBodyPoints(c,l,d,h,u),a);break}case"lightbulb":{const u=Math.min(d,h/1.5)/2,y=d*.4,m=h*.25,g=l+h-m;i.path(this.getLightbulbPath(c,l,d,u,y,g),a),i.rectangle(c+d/2-y/2,g,y,m,a);break}case"signpost":{const u=Math.max(4,d*.05),y=h*.3,m=d*.9,g=l+h*.1;i.rectangle(c+d/2-u/2,l,u,h,{...a,fill:"none"}),i.rectangle(c+d/2-m/2,g,m,y,a);break}case"burstBlob":{i.path(this.getBurstBlobPath(s),a);break}case"wavyDivider":{i.path(this.getWavyDividerPath(c,l,d,h),a);break}}V.renderText(t,e,o)}getStarPersonBodyPoints(t,e,o,i,s){const r=t+o/2;return[[r,e+s*2],[t,e+i*.4],[r,e+i*.5],[t+o,e+i*.4],[r,e+s*2],[t+o*.8,e+i],[r,e+i*.7],[t+o*.2,e+i],[r,e+s*2]]}getLightbulbPath(t,e,o,i,s,r){const a=t+o/2;return`
            M ${a-s/2} ${r}
            C ${a-s/2} ${e+i} ${t} ${e+i*1.5} ${t} ${e+i}
            A ${i} ${i} 0 1 1 ${t+o} ${e+i}
            C ${t+o} ${e+i*1.5} ${a+s/2} ${e+i} ${a+s/2} ${r}
            Z
        `}getWavyDividerPath(t,e,o,i){const s=e+i/2,r=4,a=o/r;let c=`M ${t} ${s}`;for(let l=0;l<r;l++){const d=t+l*a;c+=` Q ${d+a/4} ${s-i/2}, ${d+a/2} ${s}`,c+=` Q ${d+a*.75} ${s+i/2}, ${d+a} ${s}`}return c}getBurstBlobPath(t){const e=t.x,o=t.y,i=t.width,s=t.height,r=e+i/2,a=o+s/2,c=i/2,l=s/2,d=12,h=Math.min(c,l),u=h*.6,y=t.seed||1,m=w=>{let x=w+=1831565813;return x=Math.imul(x^x>>>15,x|1),x^=x+Math.imul(x^x>>>7,x|61),((x^x>>>14)>>>0)/4294967296};let g="";for(let w=0;w<d*2;w++){const x=w%2===0?h:u,b=m(y+w),S=x+(b-.5)*(h*.1),P=Math.PI*w/d,A=r+Math.cos(P)*(i/s)*S,B=a+Math.sin(P)*S;g+=(w===0?"M ":" L ")+A+" "+B}return g+" Z"}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class dy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.adjustColor(s.strokeColor,r),c=s.backgroundColor==="transparent"?void 0:V.adjustColor(s.backgroundColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"server":{c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u);const y=u*.05,m=h*.7,g=l+(h-m)/2;i.fillStyle=a;for(let w=0;w<3;w++)i.fillRect(g,d+u-(w+1)*y*2-y,m,y);break}case"loadBalancer":{const y=l+h/2,m=d+u/2;c&&(i.fillStyle=c,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.stroke();const g=h*.3;i.beginPath(),i.moveTo(y-g,m),i.lineTo(y+g,m),i.stroke(),this.drawArchArrowhead(i,y+g,m,0),this.drawArchArrowhead(i,y-g,m,Math.PI);break}case"firewall":{c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u);const y=4,m=3,g=u/y,w=h/m;i.beginPath();for(let x=1;x<y;x++)i.moveTo(l,d+x*g),i.lineTo(l+h,d+x*g);for(let x=0;x<y;x++){const b=x%2===0?0:w/2;for(let S=1;S<m;S++){const P=l+S*w+b;P<l+h&&(i.moveTo(P,d+x*g),i.lineTo(P,d+(x+1)*g))}}i.stroke();break}case"user":{const y=Math.min(h,u)*.25,m=l+h/2;c&&(i.fillStyle=c,i.beginPath(),i.arc(m,d+y,y,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.beginPath(),i.arc(m,d+y,y,0,Math.PI*2),i.stroke();const g=h*.8;i.beginPath(),i.moveTo(m-g/2,d+u),i.quadraticCurveTo(m,d+y*1.5,m+g/2,d+u),i.stroke();break}case"messageQueue":{c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u);const y=4,m=h/y;i.beginPath();for(let g=1;g<y;g++)i.moveTo(l+g*m,d),i.lineTo(l+g*m,d+u);i.stroke();break}case"lambda":{const y=l+h/2,m=d+u/2,g=h*.4,w=u*.6,x=y-g/2,b=m-w/2,S=`M ${x+g} ${b} L ${x} ${b+w*.6} L ${x+g*.6} ${b+w*.5} L ${x} ${b+w} L ${x+g} ${b+w*.4} L ${x+g*.4} ${b+w*.5} Z`;c&&(i.fillStyle=c,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.stroke(),i.fillStyle=a,i.fill(new Path2D(S));break}case"router":{const y=l+h/2,m=d+u/2;c&&(i.fillStyle=c,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.beginPath(),i.ellipse(y,m,h/2,u/2,0,0,Math.PI*2),i.stroke();const g=Math.min(h,u)*.3;i.beginPath();for(let w=0;w<4;w++){const x=Math.PI/2*w+Math.PI/4;i.moveTo(y,m),i.lineTo(y+g*Math.cos(x),m+g*Math.sin(x))}i.stroke();break}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=V.adjustColor(s.strokeColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"server":{i.rectangle(l,d,h,u,a);const y=h*.7,m=u*.05,g=l+(h-y)/2;for(let w=0;w<3;w++)i.rectangle(g,d+u-(w+1)*m*2-m,y,m,{...a,fillStyle:"solid",fill:c});break}case"loadBalancer":{const y=l+h/2,m=d+u/2;i.ellipse(y,m,h,u,a);const g=h*.3;i.line(y-g,m,y+g,m,a),this.drawSketchArrowhead(i,y+g,m,0,a),this.drawSketchArrowhead(i,y-g,m,Math.PI,a);break}case"firewall":{i.rectangle(l,d,h,u,a);const y=4,m=3,g=u/y,w=h/m;for(let x=1;x<y;x++)i.line(l,d+x*g,l+h,d+x*g,a);for(let x=0;x<y;x++){const b=x%2===0?0:w/2;for(let S=1;S<m;S++){const P=l+S*w+b;P<l+h&&i.line(P,d+x*g,P,d+(x+1)*g,a)}}break}case"user":{const y=Math.min(h,u)*.25,m=l+h/2;i.circle(m,d+y,y*2,a);const g=h*.8,w=`M ${m-g/2} ${d+u} Q ${m} ${d+y*1.5} ${m+g/2} ${d+u} Z`;i.path(w,a);break}case"messageQueue":{i.rectangle(l,d,h,u,a);const y=4,m=h/y;for(let g=1;g<y;g++)i.line(l+g*m,d,l+g*m,d+u,a);break}case"lambda":{const y=l+h/2,m=d+u/2,g=h*.4,w=u*.6,x=y-g/2,b=m-w/2,S=`M ${x+g} ${b} L ${x} ${b+w*.6} L ${x+g*.6} ${b+w*.5} L ${x} ${b+w} L ${x+g} ${b+w*.4} L ${x+g*.4} ${b+w*.5} Z`;i.ellipse(y,m,h,u,a),i.path(S,{...a,fillStyle:"solid",fill:c});break}case"router":{const y=l+h/2,m=d+u/2;i.ellipse(y,m,h,u,a);const g=Math.min(h,u)*.3;for(let w=0;w<4;w++){const x=Math.PI/2*w+Math.PI/4,b=y+g*Math.cos(x),S=m+g*Math.sin(x);i.line(y,m,b,S,a),this.drawSketchArrowhead(i,b,S,x,a)}break}}V.renderText(t,e,o)}drawArchArrowhead(t,e,o,i){t.beginPath(),t.moveTo(e-5*Math.cos(i-Math.PI/6),o-5*Math.sin(i-Math.PI/6)),t.lineTo(e,o),t.lineTo(e-5*Math.cos(i+Math.PI/6),o-5*Math.sin(i+Math.PI/6)),t.stroke()}drawSketchArrowhead(t,e,o,i,s){const a={x:e-10*Math.cos(i-Math.PI/6),y:o-10*Math.sin(i-Math.PI/6)},c={x:e-10*Math.cos(i+Math.PI/6),y:o-10*Math.sin(i+Math.PI/6)};t.line(e,o,a.x,a.y,s),t.line(e,o,c.x,c.y,s)}definePath(t,e){e.type==="loadBalancer"||e.type==="router"||e.type==="lambda"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):t.rect(e.x,e.y,e.width,e.height)}}class hy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.adjustColor(s.strokeColor,r),c=s.backgroundColor==="transparent"?void 0:V.adjustColor(s.backgroundColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"browserWindow":{c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u);const y=Math.min(u*.15,30);i.strokeRect(l,d,h,y);const m=4;for(let g=0;g<3;g++)i.beginPath(),i.arc(l+10+g*15,d+y/2,m,0,Math.PI*2),i.stroke();break}case"mobilePhone":{c&&(i.fillStyle=c,i.roundRect(l,d,h,u,20),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.beginPath(),i.roundRect(l,d,h,u,20),i.stroke();const m=10;i.strokeRect(l+m,d+m+20,h-2*m,u-2*m-40),i.beginPath(),i.arc(l+h/2,d+u-20,10,0,Math.PI*2),i.stroke();break}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=s.x,l=s.y,d=s.width,h=s.height;switch(s.type){case"browserWindow":{i.rectangle(c,l,d,h,a);const u=Math.min(h*.15,30);i.rectangle(c,l,d,u,a);for(let y=0;y<3;y++)i.circle(c+10+y*15,l+u/2,8,a);break}case"mobilePhone":{const y=this.getRoundedRectPath(c,l,d,h,20);i.path(y,a);const m=10;i.rectangle(c+m,l+m+20,d-2*m,h-2*m-40,a),i.circle(c+d/2,l+h-20,20,a);break}}V.renderText(t,e,o)}getRoundedRectPath(t,e,o,i,s){const r=Math.min(Math.abs(o)/2,s),a=Math.min(Math.abs(i)/2,s);return`M ${t+r} ${e} L ${t+o-r} ${e} Q ${t+o} ${e} ${t+o} ${e+a} L ${t+o} ${e+i-a} Q ${t+o} ${e+i} ${t+o-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){const o=e.x,i=e.y,s=e.width,r=e.height;e.type==="mobilePhone"?t.roundRect(o,i,s,r,20):t.rect(o,i,s,r)}}class uy extends se{render(t){const{ctx:e,element:o,layerOpacity:i}=t,{cx:s,cy:r}=V.applyTransformations(e,o,i),a=o.drawProgress;a!==void 0&&a>=0&&a<100?this.renderDrawProgress(t,s,r):o.renderStyle==="architectural"?this.renderArchitectural(t,s,r):this.renderSketch(t,s,r),V.restoreTransformations(e)}renderArchitectural(t,e,o){this.renderCommon(t)}renderSketch(t,e,o){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:o,isDarkMode:i}=t,s=V.adjustColor(o.strokeColor,i);if(o.type==="organicBranch"){const r=Ht(o.points),a=o.controlPoints||[];if(r.length<2||a.length<2)return;const c={x:o.x+r[0].x,y:o.y+r[0].y},l={x:o.x+r[r.length-1].x,y:o.y+r[r.length-1].y},d=a[0],h=a[1];this.drawOrganicBranch(e,c,l,d,h,s,o.strokeWidth,o.text||"",s),this.renderFlow(t,c,l,d,h)}}renderFlow(t,e,o,i,s){const{ctx:r,element:a,isDarkMode:c}=t;if(!a.flowAnimation)return;const l=window.yappyGlobalTime||performance.now(),d=(a.flowSpeed??2)*50,h=l/1e3*d,u=V.adjustColor(a.flowColor||a.strokeColor,c),y=Math.max(2,a.strokeWidth*1.5),m=100/(a.flowDensity||3);r.save(),r.fillStyle=u,r.shadowBlur=a.flowStyle==="pulse"?y:0,r.shadowColor=u;const g=Math.sqrt((o.x-e.x)**2+(o.y-e.y)**2),w=Math.sqrt((i.x-e.x)**2+(i.y-e.y)**2)+Math.sqrt((s.x-i.x)**2+(s.y-i.y)**2)+Math.sqrt((o.x-s.x)**2+(o.y-s.y)**2),x=(g+w)/2,b=Math.ceil(x/5);for(let S=0;S<=b;S++){const P=S/b;if((P*x+h)%m<d/10){const B=this.cubicBezier(e.x,i.x,s.x,o.x,P),X=this.cubicBezier(e.y,i.y,s.y,o.y,P),D=Math.min(1,P+.01),Q=this.cubicBezier(e.x,i.x,s.x,o.x,D),ot=this.cubicBezier(e.y,i.y,s.y,o.y,D),st=Math.atan2(ot-X,Q-B);this.drawPulse(r,B,X,y,a.flowStyle,st)}}r.restore()}drawPulse(t,e,o,i,s,r=0){if(t.save(),t.translate(e,o),t.rotate(r),s==="dashes")t.fillRect(-i,-i/2,i*2,i);else if(s==="pulse"){t.beginPath(),t.arc(0,0,i*1.5,0,Math.PI*2);const a=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=a,t.fill()}else t.beginPath(),t.arc(0,0,i,0,Math.PI*2),t.fill();t.restore()}cubicBezier(t,e,o,i,s){const r=1-s;return r*r*r*t+3*r*r*s*e+3*r*s*s*o+s*s*s*i}cubicBezierAngle(t,e,o,i,s){const r=3*(1-s)*(1-s)*(e.x-t.x)+6*(1-s)*s*(o.x-e.x)+3*s*s*(i.x-o.x),a=3*(1-s)*(1-s)*(e.y-t.y)+6*(1-s)*s*(o.y-e.y)+3*s*s*(i.y-o.y);return Math.atan2(a,r)}drawOrganicBranch(t,e,o,i,s,r,a,c,l){const h=[],u=[],y=Math.max(a*8,4),m=Math.max(a*2,2);for(let g=0;g<=20;g++){const w=g/20,x=this.cubicBezier(e.x,i.x,s.x,o.x,w),b=this.cubicBezier(e.y,i.y,s.y,o.y,w),S=this.cubicBezierAngle(e,i,s,o,w),A=(y+(m-y)*w)/2,B=Math.cos(S+Math.PI/2)*A,X=Math.sin(S+Math.PI/2)*A;h.push({x:x+B,y:b+X}),u.push({x:x-B,y:b-X})}t.beginPath(),t.moveTo(h[0].x,h[0].y);for(let g=1;g<h.length;g++)t.lineTo(h[g].x,h[g].y);t.lineTo(u[u.length-1].x,u[u.length-1].y);for(let g=u.length-2;g>=0;g--)t.lineTo(u[g].x,u[g].y);if(t.closePath(),t.fillStyle=r,t.fill(),c){t.save(),t.font="16px sans-serif",t.fillStyle=l,t.textAlign="center",t.textBaseline="middle";const g=this.cubicBezier(e.x,i.x,s.x,o.x,.5),w=this.cubicBezier(e.y,i.y,s.y,o.y,.5),x=this.cubicBezierAngle(e,i,s,o,.5),b=-15;t.translate(g,w);let S=x;(S>Math.PI/2||S<-Math.PI/2)&&(S+=Math.PI),t.rotate(S),t.fillText(c,0,b),t.restore()}}definePath(t,e){if(e.type==="organicBranch"){const o=Ht(e.points),i=e.controlPoints||[];if(o.length<2||i.length<2)return;const s={x:e.x+o[0].x,y:e.y+o[0].y},r={x:e.x+o[o.length-1].x,y:e.y+o[o.length-1].y},a=i[0],c=i[1];t.moveTo(s.x,s.y),t.bezierCurveTo(a.x,a.y,c.x,c.y,r.x,r.y)}}}class fy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.adjustColor(s.strokeColor,r),c=s.backgroundColor==="transparent"?void 0:V.adjustColor(s.backgroundColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"browser":{c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u);const y=u*.15;i.beginPath(),i.moveTo(l,d+y),i.lineTo(l+h,d+y),i.stroke(),i.fillStyle=a;const m=y*.2;for(let g=0;g<3;g++)i.beginPath(),i.arc(l+y*(.5+g*.6),d+y/2,m,0,Math.PI*2),i.fill();break}case"ghostButton":{const y=Math.min(h,u)*.2;c&&(i.fillStyle=c,i.roundRect(l,d,h,u,y),i.fill()),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.setLineDash([4,4]),i.roundRect(l,d,h,u,y),i.stroke(),i.setLineDash([]);break}case"inputField":{if(c&&(i.fillStyle=c,i.fillRect(l,d,h,u)),i.strokeStyle=a,i.lineWidth=s.strokeWidth,i.strokeRect(l,d,h,u),i.beginPath(),i.moveTo(l+10,d+8),i.lineTo(l+10,d+u-8),i.stroke(),s.containerText){i.save(),i.textAlign="left";const y=l+25,m=ve(i,s,s.containerText,h-30),g=d+(u-m.textHeight)/2+m.lineHeight/2;i.fillStyle=a,m.lines.forEach((w,x)=>{i.fillText(w,y,g+x*m.lineHeight)}),i.restore();return}break}}V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=V.adjustColor(s.strokeColor,r),l=s.x,d=s.y,h=s.width,u=s.height;switch(s.type){case"browser":{i.rectangle(l,d,h,u,a);const y=u*.15;i.line(l,d+y,l+h,d+y,a);const m=y*.3;for(let g=0;g<3;g++)i.circle(l+y*(.5+g*.6),d+y/2,m,{...a,fillStyle:"solid",fill:c});break}case"ghostButton":{const y=Math.min(h,u)*.2,m=this.getRoundedRectPath(l,d,h,u,y);i.path(m,{...a,strokeLineDash:[4,4]});break}case"inputField":{i.rectangle(l,d,h,u,a),i.line(l+10,d+8,l+10,d+u-8,a);break}}V.renderText(t,e,o)}getRoundedRectPath(t,e,o,i,s){const r=Math.min(Math.abs(o)/2,s),a=Math.min(Math.abs(i)/2,s);return`M ${t+r} ${e} L ${t+o-r} ${e} Q ${t+o} ${e} ${t+o} ${e+a} L ${t+o} ${e+i-a} Q ${t+o} ${e+i} ${t+o-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}definePath(t,e){if(e.type==="ghostButton"){const o=Math.min(e.width,e.height)*.2;t.roundRect(e.x,e.y,e.width,e.height,o)}else t.rect(e.x,e.y,e.width,e.height)}}class py extends se{render(t){const{ctx:e,element:o,layerOpacity:i}=t,{cx:s,cy:r}=V.applyTransformations(e,o,i),a=o.drawProgress;a!==void 0&&a>=0&&a<100?this.renderDrawProgress(t,s,r):o.renderStyle==="architectural"?this.renderArchitectural(t,s,r):this.renderSketch(t,s,r),V.restoreTransformations(e)}renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.adjustColor(s.strokeColor,r),c=s.backgroundColor==="transparent"?"#ffffff":V.adjustColor(s.backgroundColor,r);i.save(),i.strokeStyle=a,i.fillStyle=c,i.lineWidth=s.strokeWidth,i.lineCap="round",i.lineJoin=s.strokeLineJoin||"round",s.strokeStyle==="dashed"?i.setLineDash([8,8]):s.strokeStyle==="dotted"&&i.setLineDash([2,4]),i.beginPath(),this.definePath(i,s),i.stroke(),this.renderFlow(t);const l=Ht(s.points);let d,h;l.length>=2?(d={x:s.x+l[0].x,y:s.y+l[0].y},h={x:s.x+l[l.length-1].x,y:s.y+l[l.length-1].y}):(d={x:s.x,y:s.y},h={x:s.x+s.width,y:s.y+s.height});let u;if(s.curveType==="bezier"){const y=s.controlPoints?.[0]||{x:d.x,y:d.y},m=s.controlPoints?.[1]||y;if(s.startArrowhead){const g=Math.atan2(d.y-y.y,d.x-y.x);this.drawArrowheadArchitectural(i,d.x,d.y,g,s.startArrowhead)}if(s.endArrowhead){const g=Math.atan2(h.y-m.y,h.x-m.x);this.drawArrowheadArchitectural(i,h.x,h.y,g,s.endArrowhead)}}else if(s.curveType==="elbow"&&l.length>=2){const y={x:s.x+l[0].x,y:s.y+l[0].y},m={x:s.x+l[1].x,y:s.y+l[1].y},g=Math.atan2(y.y-m.y,y.x-m.x);s.startArrowhead&&this.drawArrowheadArchitectural(i,y.x,y.y,g,s.startArrowhead);const w={x:s.x+l[l.length-1].x,y:s.y+l[l.length-1].y},x={x:s.x+l[l.length-2].x,y:s.y+l[l.length-2].y},b=Math.atan2(w.y-x.y,w.x-x.x);s.endArrowhead&&this.drawArrowheadArchitectural(i,w.x,w.y,b,s.endArrowhead)}else u=Math.atan2(h.y-d.y,h.x-d.x),s.startArrowhead&&this.drawArrowheadArchitectural(i,d.x,d.y,u+Math.PI,s.startArrowhead),s.endArrowhead&&this.drawArrowheadArchitectural(i,h.x,h.y,u,s.endArrowhead);i.restore()}renderSketch(t,e,o){this.renderCommon(t,e,o),this.renderFlow(t)}renderCommon(t,e,o){const{element:i,isDarkMode:s}=t,r=V.buildRenderOptions(i,s);i.curveType==="bezier"?this.renderBezier(t,r):i.curveType==="elbow"?this.renderElbow(t,r):this.renderStraight(t,r)}renderBezier(t,e){e={...e,fill:void 0};const{rc:o,element:i}=t,s=i.x+i.width,r=i.y+i.height,a=Ht(i.points);let c={x:i.x,y:i.y},l={x:s,y:r};if(a.length>=2&&(c={x:i.x+a[0].x,y:i.y+a[0].y},l={x:i.x+a[a.length-1].x,y:i.y+a[a.length-1].y}),i.controlPoints&&i.controlPoints.length>0){const d=i.controlPoints[0];if(i.controlPoints.length>1){const h=i.controlPoints[1],u=`M ${c.x} ${c.y} C ${d.x} ${d.y}, ${h.x} ${h.y}, ${l.x} ${l.y}`;o.path(u,e),i.startArrowhead&&this.drawArrowhead(o,c.x,c.y,Math.atan2(c.y-d.y,c.x-d.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(o,l.x,l.y,Math.atan2(l.y-h.y,l.x-h.x),i.endArrowhead,e)}else{const h=`M ${c.x} ${c.y} Q ${d.x} ${d.y}, ${l.x} ${l.y}`;o.path(h,e),i.startArrowhead&&this.drawArrowhead(o,c.x,c.y,Math.atan2(c.y-d.y,c.x-d.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(o,l.x,l.y,Math.atan2(l.y-d.y,l.x-d.x),i.endArrowhead,e)}}else{const d=i.width,h=i.height;let u,y;Math.abs(d)>Math.abs(h)?(u={x:c.x+d/2,y:c.y},y={x:l.x-d/2,y:l.y}):(u={x:c.x,y:c.y+h/2},y={x:l.x,y:l.y-h/2});const m=`M ${c.x} ${c.y} C ${u.x} ${u.y}, ${y.x} ${y.y}, ${l.x} ${l.y}`;o.path(m,e),i.startArrowhead&&this.drawArrowhead(o,c.x,c.y,Math.atan2(c.y-u.y,c.x-u.x),i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(o,l.x,l.y,Math.atan2(l.y-y.y,l.x-y.x),i.endArrowhead,e)}}renderElbow(t,e){e={...e,fill:void 0};const{rc:o,element:i}=t,s=Ht(i.points),r=s&&s.length>0?s.map(c=>[i.x+c.x,i.y+c.y]):[[i.x,i.y],[i.x+i.width,i.y+i.height]];o.linearPath(r,e);const a=r.filter((c,l,d)=>l===0||Math.abs(c[0]-d[l-1][0])>.1||Math.abs(c[1]-d[l-1][1])>.1);if(i.startArrowhead&&a.length>=2){const c=Math.atan2(a[0][1]-a[1][1],a[0][0]-a[1][0]);this.drawArrowhead(o,a[0][0],a[0][1],c,i.startArrowhead,e)}if(i.endArrowhead&&a.length>=2){const c=a.length,l=Math.atan2(a[c-1][1]-a[c-2][1],a[c-1][0]-a[c-2][0]);this.drawArrowhead(o,a[c-1][0],a[c-1][1],l,i.endArrowhead,e)}}renderStraight(t,e){e={...e,fill:void 0};const{rc:o,element:i}=t,s=Ht(i.points);let r,a;s.length>=2?(r={x:i.x+s[0].x,y:i.y+s[0].y},a={x:i.x+s[s.length-1].x,y:i.y+s[s.length-1].y}):(r={x:i.x,y:i.y},a={x:i.x+i.width,y:i.y+i.height}),o.line(r.x,r.y,a.x,a.y,e);const c=Math.atan2(a.y-r.y,a.x-r.x);i.startArrowhead&&this.drawArrowhead(o,r.x,r.y,c+Math.PI,i.startArrowhead,e),i.endArrowhead&&this.drawArrowhead(o,a.x,a.y,c,i.endArrowhead,e)}drawArrowhead(t,e,o,i,s,r){const c={x:e-12*Math.cos(i-Math.PI/6),y:o-12*Math.sin(i-Math.PI/6)},l={x:e-12*Math.cos(i+Math.PI/6),y:o-12*Math.sin(i+Math.PI/6)};if(s==="triangle"||s==="arrow")s==="triangle"?t.polygon([[e,o],[c.x,c.y],[l.x,l.y]],{...r,fill:"#ffffff",fillStyle:"solid"}):(t.line(e,o,c.x,c.y,r),t.line(e,o,l.x,l.y,r));else if(s==="circle"||s==="dot")t.circle(e,o,12,{...r,fill:s==="dot"?r.stroke:"#ffffff",fillStyle:"solid"});else if(s==="diamond"||s==="diamondFilled"){const d={x:e-24*Math.cos(i),y:o-24*Math.sin(i)},h={x:e-12*Math.cos(i),y:o-12*Math.sin(i)},u={x:h.x-12/2*Math.cos(i-Math.PI/2),y:h.y-12/2*Math.sin(i-Math.PI/2)},y={x:h.x-12/2*Math.cos(i+Math.PI/2),y:h.y-12/2*Math.sin(i+Math.PI/2)};t.polygon([[e,o],[u.x,u.y],[d.x,d.y],[y.x,y.y]],{...r,fill:s==="diamondFilled"?r.stroke:"#ffffff",fillStyle:"solid"})}else if(s==="crowsfoot"){const d={x:e-12*Math.cos(i-Math.PI/4),y:o-12*Math.sin(i-Math.PI/4)},h={x:e-12*Math.cos(i+Math.PI/4),y:o-12*Math.sin(i+Math.PI/4)},u={x:e-12*Math.cos(i),y:o-12*Math.sin(i)};t.line(e,o,d.x,d.y,r),t.line(e,o,h.x,h.y,r),t.line(e,o,u.x,u.y,r)}else if(s==="bar"){const d=e+Math.cos(i+Math.PI/2)*12,h=o+Math.sin(i+Math.PI/2)*12,u=e+Math.cos(i-Math.PI/2)*12,y=o+Math.sin(i-Math.PI/2)*12;t.line(d,h,u,y,r)}}drawArrowheadArchitectural(t,e,o,i,s){t.save(),t.translate(e,o),t.rotate(i),t.setLineDash([]),s==="triangle"||s==="arrow"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/6),-12*Math.sin(Math.PI/6)),s==="triangle"?(t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6)),t.closePath(),t.fillStyle="#ffffff",t.fill()):(t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6))),t.stroke()):s==="circle"||s==="dot"?(t.beginPath(),t.arc(-12/2*Math.cos(0),0,12/2,0,Math.PI*2),s==="dot"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):s==="diamond"||s==="diamondFilled"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12,-12/2),t.lineTo(-24,0),t.lineTo(-12,12/2),t.closePath(),s==="diamondFilled"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):s==="crowsfoot"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/4),-12*Math.sin(Math.PI/4)),t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/4),-12*Math.sin(-Math.PI/4)),t.moveTo(0,0),t.lineTo(-12,0),t.stroke()):s==="bar"&&(t.beginPath(),t.moveTo(0,-12),t.lineTo(0,12),t.stroke()),t.restore()}renderFlow(t){const{ctx:e,element:o,isDarkMode:i}=t;if(!o.flowAnimation)return;const s=window.yappyGlobalTime||performance.now(),r=(o.flowSpeed??2)*50,a=s/1e3*r,c=V.adjustColor(o.flowColor||o.strokeColor,i),l=Math.max(2,o.strokeWidth*1.5),d=100/(o.flowDensity||3);e.save(),e.fillStyle=c,e.shadowBlur=o.flowStyle==="pulse"?l:0,e.shadowColor=c;const h=Ht(o.points);let u,y;if(h.length>=2?(u={x:o.x+h[0].x,y:o.y+h[0].y},y={x:o.x+h[h.length-1].x,y:o.y+h[h.length-1].y}):(u={x:o.x,y:o.y},y={x:o.x+o.width,y:o.y+o.height}),o.curveType==="bezier"){let m,g;if(o.controlPoints&&o.controlPoints.length>0)m=o.controlPoints[0],g=o.controlPoints.length>1?o.controlPoints[1]:m;else{const P=o.width,A=o.height;Math.abs(P)>Math.abs(A)?(m={x:u.x+P/2,y:u.y},g={x:y.x-P/2,y:y.y}):(m={x:u.x,y:u.y+A/2},g={x:y.x,y:y.y-A/2})}const w=Math.sqrt((y.x-u.x)**2+(y.y-u.y)**2),x=Math.sqrt((m.x-u.x)**2+(m.y-u.y)**2)+Math.sqrt((g.x-m.x)**2+(g.y-m.y)**2)+Math.sqrt((y.x-g.x)**2+(y.y-g.y)**2),b=(w+x)/2,S=Math.ceil(b/5);for(let P=0;P<=S;P++){const A=P/S;if((A*b+a)%d<r/10){const X=gi(u.x,m.x,g.x,y.x,A),D=gi(u.y,m.y,g.y,y.y,A),Q=Math.min(1,A+.01),ot=gi(u.x,m.x,g.x,y.x,Q),st=gi(u.y,m.y,g.y,y.y,Q),dt=Math.atan2(st-D,ot-X);this.drawPulse(e,X,D,l,o.flowStyle,dt)}}}else if(o.curveType==="elbow"&&h.length>=2){let m=0;for(let g=0;g<h.length-1;g++){const w={x:o.x+h[g].x,y:o.y+h[g].y},x={x:o.x+h[g+1].x,y:o.y+h[g+1].y},b=Math.sqrt((x.x-w.x)**2+(x.y-w.y)**2),S=Math.atan2(x.y-w.y,x.x-w.x),P=Math.ceil(b/5);for(let A=0;A<=P;A++){const B=A/P;if((m+B*b+a)%d<r/10){const D=w.x+(x.x-w.x)*B,Q=w.y+(x.y-w.y)*B;this.drawPulse(e,D,Q,l,o.flowStyle,S)}}m+=b}}else{const m=y.x-u.x,g=y.y-u.y,w=Math.sqrt(m*m+g*g),x=Math.atan2(g,m),b=Math.ceil(w/5);for(let S=0;S<=b;S++){const P=S/b;if((P*w+a)%d<r/10){const B=u.x+m*P,X=u.y+g*P;this.drawPulse(e,B,X,l,o.flowStyle,x)}}}e.restore()}drawPulse(t,e,o,i,s,r=0){if(t.save(),t.translate(e,o),t.rotate(r),s==="dashes")t.fillRect(-i,-i/2,i*2,i);else if(s==="pulse"){t.beginPath(),t.arc(0,0,i*1.5,0,Math.PI*2);const a=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=a,t.fill()}else t.beginPath(),t.arc(0,0,i,0,Math.PI*2),t.fill();t.restore()}definePath(t,e){const o=Ht(e.points);let i,s;if(o.length>=2?(i={x:e.x+o[0].x,y:e.y+o[0].y},s={x:e.x+o[o.length-1].x,y:e.y+o[o.length-1].y}):(i={x:e.x,y:e.y},s={x:e.x+e.width,y:e.y+e.height}),e.curveType==="bezier"){const r=e.width,a=e.height;let c,l;e.controlPoints&&e.controlPoints.length>0?(c=e.controlPoints[0],e.controlPoints.length>1?(l=e.controlPoints[1],t.moveTo(i.x,i.y),t.bezierCurveTo(c.x,c.y,l.x,l.y,s.x,s.y)):(t.moveTo(i.x,i.y),t.quadraticCurveTo(c.x,c.y,s.x,s.y))):(Math.abs(r)>Math.abs(a)?(c={x:i.x+r/2,y:i.y},l={x:s.x-r/2,y:s.y}):(c={x:i.x,y:i.y+a/2},l={x:s.x,y:s.y-a/2}),t.moveTo(i.x,i.y),t.bezierCurveTo(c.x,c.y,l.x,l.y,s.x,s.y))}else if(e.curveType==="elbow"){const r=o&&o.length>0?o.map(a=>({x:e.x+a.x,y:e.y+a.y})):[i,s];t.moveTo(r[0].x,r[0].y);for(let a=1;a<r.length;a++)t.lineTo(r[a].x,r[a].y)}else t.moveTo(i.x,i.y),t.lineTo(s.x,s.y)}estimatePathLength(t){const e=Ht(t.points);let o,i;if(e.length>=2?(o={x:t.x+e[0].x,y:t.y+e[0].y},i={x:t.x+e[e.length-1].x,y:t.y+e[e.length-1].y}):(o={x:t.x,y:t.y},i={x:t.x+t.width,y:t.y+t.height}),t.curveType==="bezier"){let s,r;if(t.controlPoints&&t.controlPoints.length>0)s=t.controlPoints[0],r=t.controlPoints.length>1?t.controlPoints[1]:s;else{const l=t.width,d=t.height;Math.abs(l)>Math.abs(d)?(s={x:o.x+l/2,y:o.y},r={x:i.x-l/2,y:i.y}):(s={x:o.x,y:o.y+d/2},r={x:i.x,y:i.y-d/2})}const a=Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2),c=Math.sqrt((s.x-o.x)**2+(s.y-o.y)**2)+Math.sqrt((r.x-s.x)**2+(r.y-s.y)**2)+Math.sqrt((i.x-r.x)**2+(i.y-r.y)**2);return(a+c)/2}else if(t.curveType==="elbow"&&e.length>=2){let s=0;const r=e.map(a=>({x:t.x+a.x,y:t.y+a.y}));for(let a=0;a<r.length-1;a++)s+=Math.sqrt((r[a+1].x-r[a].x)**2+(r[a+1].y-r[a].y)**2);return s}else return Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2)}}class yy extends se{renderArchitectural(t,e,o){this.renderCommon(t)}renderSketch(t,e,o){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:o,isDarkMode:i,layerOpacity:s}=t;if(!o.points||o.points.length===0)return;let r=Ht(o.points).map(c=>({x:o.x+c.x,y:o.y+c.y}));o.smoothing&&o.smoothing>0&&(r=this.smoothPoints(r,o.smoothing));const a=V.adjustColor(o.strokeColor,i);e.save(),e.strokeStyle=a,e.fillStyle=a,o.type==="fineliner"?this.renderFineliner(e,r,o.strokeWidth):o.type==="inkbrush"?this.renderInkbrush(e,r,o.strokeWidth,o.taperAmount,o.velocitySensitivity):o.type==="marker"?this.renderMarker(e,r,o.strokeWidth,o.opacity,s):o.type==="ink"&&this.renderFineliner(e,r,o.strokeWidth),e.restore()}smoothPoints(t,e){if(t.length<3)return t;const o=[t[0]],i=Math.floor(e/2)||1;for(let s=1;s<t.length-1;s++){let r=0,a=0,c=0;for(let l=Math.max(0,s-i);l<=Math.min(t.length-1,s+i);l++)r+=t[l].x,a+=t[l].y,c++;o.push({x:r/c,y:a/c})}return o.push(t[t.length-1]),o}renderFineliner(t,e,o){if(e.length<6){t.beginPath(),t.arc(e[0].x,e[0].y,o/2,0,Math.PI*2),t.fill();return}t.lineWidth=o,t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length-2;s++){const r=(e[s].x+e[s+1].x)/2,a=(e[s].y+e[s+1].y)/2;t.quadraticCurveTo(e[s].x,e[s].y,r,a)}const i=e.length-1;t.quadraticCurveTo(e[i-1].x,e[i-1].y,e[i].x,e[i].y),t.stroke()}renderInkbrush(t,e,o,i=.15,s=.5){if(e.length<2){t.beginPath(),t.arc(e[0].x,e[0].y,o/2,0,Math.PI*2),t.fill();return}const r=[0];for(let g=1;g<e.length;g++){const w=e[g].x-e[g-1].x,x=e[g].y-e[g-1].y;r.push(Math.sqrt(w*w+x*x))}const a=[],c=3;for(let g=0;g<r.length;g++){let w=0,x=0;for(let b=Math.max(0,g-c);b<=Math.min(r.length-1,g+c);b++)w+=r[b],x++;a.push(w/x)}const l=Math.max(...a,1),d=o*(1-s*.7),h=o*(1+s*.5),u=[];for(let g=0;g<e.length;g++){const w=a[g]/l;let x=h-(h-d)*w;const b=Math.min(e.length*i,20);if(b>0&&(g<b&&(x*=g/b*.9+.1),g>e.length-b-1)){const S=e.length-1-g;x*=S/b*.9+.1}u.push(Math.max(x,.5))}t.beginPath();const y=[],m=[];for(let g=0;g<e.length;g++){let w,x;if(g===0){const S=e[1].x-e[0].x,P=e[1].y-e[0].y,A=Math.sqrt(S*S+P*P)||1;w=-P/A,x=S/A}else if(g===e.length-1){const S=e[g].x-e[g-1].x,P=e[g].y-e[g-1].y,A=Math.sqrt(S*S+P*P)||1;w=-P/A,x=S/A}else{const S=e[g].x-e[g-1].x,P=e[g].y-e[g-1].y,A=e[g+1].x-e[g].x,B=e[g+1].y-e[g].y,X=Math.sqrt(S*S+P*P)||1,D=Math.sqrt(A*A+B*B)||1;w=-(P/X+B/D)/2,x=(S/X+A/D)/2;const Q=Math.sqrt(w*w+x*x)||1;w/=Q,x/=Q}const b=u[g]/2;y.push({x:e[g].x+w*b,y:e[g].y+x*b}),m.push({x:e[g].x-w*b,y:e[g].y-x*b})}if(y.length>=2){t.moveTo(y[0].x,y[0].y);for(let w=1;w<y.length-1;w++){const x=(y[w].x+y[w+1].x)/2,b=(y[w].y+y[w+1].y)/2;t.quadraticCurveTo(y[w].x,y[w].y,x,b)}t.lineTo(y[y.length-1].x,y[y.length-1].y);const g=e.length-1;t.arc(e[g].x,e[g].y,u[g]/2,Math.atan2(y[g].y-e[g].y,y[g].x-e[g].x),Math.atan2(m[g].y-e[g].y,m[g].x-e[g].x),!1);for(let w=m.length-2;w>0;w--){const x=(m[w].x+m[w-1].x)/2,b=(m[w].y+m[w-1].y)/2;t.quadraticCurveTo(m[w].x,m[w].y,x,b)}t.lineTo(m[0].x,m[0].y),t.arc(e[0].x,e[0].y,u[0]/2,Math.atan2(m[0].y-e[0].y,m[0].x-e[0].x),Math.atan2(y[0].y-e[0].y,y[0].x-e[0].x),!1)}t.closePath(),t.fill()}renderMarker(t,e,o,i,s){t.globalAlpha=(i??100)/100*s*.5,t.globalCompositeOperation="multiply",this.renderFineliner(t,e,o*4)}definePath(t,e){const o=Ht(e.points).map(s=>({x:e.x+s.x,y:e.y+s.y}));if(o.length<2)return;if(o.length<6){t.moveTo(o[0].x,o[0].y);for(let s=1;s<o.length;s++)t.lineTo(o[s].x,o[s].y);return}t.moveTo(o[0].x,o[0].y);for(let s=1;s<o.length-2;s++){const r=(o[s].x+o[s+1].x)/2,a=(o[s].y+o[s+1].y)/2;t.quadraticCurveTo(o[s].x,o[s].y,r,a)}const i=o.length-1;t.quadraticCurveTo(o[i-1].x,o[i-1].y,o[i].x,o[i].y)}estimatePathLength(t){const e=Ht(t.points);if(e.length<2)return 0;let o=0;for(let i=1;i<e.length;i++){const s=e[i].x-e[i-1].x,r=e[i].y-e[i-1].y;o+=Math.sqrt(s*s+r*r)}return o}}class gy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=V.adjustColor(s.strokeColor,r),l=s.backgroundColor==="transparent"?void 0:V.adjustColor(s.backgroundColor,r),d=Hn(s);if(!d)return;if(i.save(),i.translate(e,o),["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(s.type)&&d.type==="multi"){const u=a.fill&&a.fill!=="transparent"&&a.fill!=="none";d.shapes.forEach(y=>{u&&l&&(i.fillStyle=y.shade?V.shadeColor(l,y.shade):l,i.beginPath(),V.renderGeometry(i,y),i.fill()),i.strokeStyle=c,i.lineWidth=s.strokeWidth,i.lineJoin=s.strokeLineJoin||"round",i.beginPath(),V.renderGeometry(i,y),i.stroke(),s.drawInnerBorder})}else if(a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&l&&(i.fillStyle=l,i.beginPath(),V.renderGeometry(i,d),i.fill()),i.strokeStyle=c,i.lineWidth=s.strokeWidth,i.lineJoin=s.strokeLineJoin||"round",i.beginPath(),V.renderGeometry(i,d),i.stroke(),s.drawInnerBorder){const y=s.innerBorderDistance||5,m=(s.width-y*2)/s.width,g=(s.height-y*2)/s.height;m>0&&g>0&&(i.save(),i.scale(m,g),i.strokeStyle=s.innerBorderColor||c,i.beginPath(),V.renderGeometry(i,d),i.stroke(),i.restore())}i.restore(),V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,ctx:s,element:r,isDarkMode:a}=t,c=V.buildRenderOptions(r,a),l=Hn(r);if(!l)return;s.save(),s.translate(e,o),this.renderSketchGeometry(i,l,c);const d=["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(r.type);if(r.drawInnerBorder&&!d){const h=r.innerBorderDistance||5,u=(r.width-h*2)/r.width,y=(r.height-h*2)/r.height;if(u>0&&y>0){const m={...c,stroke:r.innerBorderColor||c.stroke,fill:"none"};s.save(),s.scale(u,y),this.renderSketchGeometry(i,l,m),s.restore()}}s.restore(),V.renderText(t,e,o)}renderSketchGeometry(t,e,o){const i=e.shade&&o.fill&&o.fill!=="transparent"&&o.fill!=="none"?{...o,fill:V.shadeColor(o.fill,e.shade)}:o;if(e.type==="rect")t.rectangle(e.x,e.y,e.w,e.h,i);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx*2,e.ry*2,i);else if(e.type==="points"){const s=e.points.map(r=>[r.x,r.y]);e.isClosed===!1?t.linearPath(s,i):t.polygon(s,i)}else e.type==="path"?t.path(e.path,i):e.type==="multi"&&e.shapes.forEach(s=>this.renderSketchGeometry(t,s,i))}definePath(t,e){const o=Hn(e);o&&(t.translate(e.x+e.width/2,e.y+e.height/2),V.renderGeometry(t,o))}}class my extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r);i.beginPath(),i.rect(s.x,s.y,s.width,s.height),i.fillStyle=a.fill||"transparent",a.fill&&a.fill!=="none"&&i.fill(),i.lineWidth=s.strokeWidth,i.strokeStyle=a.stroke||"#000000",i.stroke();const c=this.calculateLayout(i,s);this.drawDividers(i,s,c,a.stroke||"#000000"),this.renderTexts(t,s,c)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r);i.rectangle(s.x,s.y,s.width,s.height,a);const l=document.createElement("canvas").getContext("2d"),d=this.calculateLayout(l,s);this.drawSketchDividers(i,s,d,a),this.renderTexts(t,s,d)}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}calculateLayout(t,e){const o=e.containerText||"";let i=30;if(o){const a=ve(t,e,o,e.width-10);i=Math.max(30,a.textHeight+20)}const s=e.attributesText||"";let r=0;if(s){const a=ve(t,{...e,fontSize:(e.fontSize||20)*.9},s,e.width-10);r=Math.max(20,a.textHeight+10)}else e.type==="umlClass"&&(r=20);return{headerHeight:i,attrHeight:r,hasAttributes:!!s||e.type==="umlClass",hasMethods:!!e.methodsText||e.type==="umlClass"}}drawDividers(t,e,o,i){t.strokeStyle=i,t.lineWidth=1;const s=e.y+o.headerHeight;if(s<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,s),t.lineTo(e.x+e.width,s),t.stroke()),o.hasAttributes&&o.hasMethods){const r=s+o.attrHeight;r<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,r),t.lineTo(e.x+e.width,r),t.stroke())}}drawSketchDividers(t,e,o,i){const s=e.y+o.headerHeight;if(s<e.y+e.height&&t.line(e.x,s,e.x+e.width,s,i),o.hasAttributes&&o.hasMethods){const r=s+o.attrHeight;r<e.y+e.height&&t.line(e.x,r,e.x+e.width,r,i)}}renderTexts(t,e,o){const{ctx:i,isDarkMode:s}=t;if(e.containerText&&this.renderSectionText(i,e,e.containerText,e.x+e.width/2,e.y+o.headerHeight/2,e.width-10,"center",!0,s),e.attributesText){const r=e.y+o.headerHeight+10,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.attributesText,e.x+10,r,e.width-20,"left",!1,s)}if(e.methodsText){const r=e.y+o.headerHeight+o.attrHeight+10,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.methodsText,e.x+10,r,e.width-20,"left",!1,s)}}renderSectionText(t,e,o,i,s,r,a,c,l){if(!o)return;t.save(),t.font=ro({...e,fontWeight:c?"bold":e.fontWeight});const d=V.adjustColor(e.strokeColor||"#000",l);t.fillStyle=d,t.textAlign=a,t.textBaseline=a==="center"?"middle":"top";const h=ve(t,e,o,r);h.lines.forEach((u,y)=>{const m=s+y*h.lineHeight-(a==="center"?(h.lines.length-1)*h.lineHeight/2:0);t.fillText(u,i,m)}),t.restore()}}class xy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=s.width,l=s.height,d=s.x,h=s.y;if(i.beginPath(),s.type==="umlActor")this.drawActorPath(i,d,h,c,l);else if(s.type==="umlUseCase"||s.type==="umlInterface")i.ellipse(d+c/2,h+l/2,c/2,l/2,0,0,Math.PI*2);else if(s.type==="umlPackage")this.drawPackagePath(i,d,h,c,l);else if(s.type==="umlNote")this.drawNotePath(i,d,h,c,l);else if(s.type==="umlComponent")i.rect(d,h,c,l);else if(s.type==="umlLifeline"){const u=Math.max(30,l*.2);i.rect(d,h,c,u)}else s.type==="umlFragment"&&i.rect(d,h,c,l);if(i.fillStyle=a.fill||"transparent",a.fill&&a.fill!=="none"&&i.fill(),i.lineWidth=s.strokeWidth,i.strokeStyle=a.stroke||"#000000",i.stroke(),s.type==="umlNote"){const u=Math.min(c,l)*.15;i.beginPath(),i.moveTo(d+c-u,h),i.lineTo(d+c-u,h+u),i.lineTo(d+c,h+u),i.stroke()}if(s.type==="umlComponent"){const u=Math.min(16,c*.15),y=Math.min(10,l*.08),m=d-u/2;i.fillStyle=a.fill||"transparent",i.strokeStyle=a.stroke||"#000000",i.beginPath(),i.rect(m,h+l*.25-y/2,u,y),a.fill&&a.fill!=="none"&&i.fill(),i.stroke(),i.beginPath(),i.rect(m,h+l*.55-y/2,u,y),a.fill&&a.fill!=="none"&&i.fill(),i.stroke()}if(s.type==="umlLifeline"){const u=Math.max(30,l*.2);i.save(),i.setLineDash([8,6]),i.beginPath(),i.moveTo(d+c/2,h+u),i.lineTo(d+c/2,h+l),i.stroke(),i.restore()}if(s.type==="umlFragment"){const u=Math.min(c*.3,60),y=Math.min(l*.12,22);i.fillStyle=a.fill||"transparent",i.strokeStyle=a.stroke||"#000000",i.beginPath(),i.moveTo(d,h),i.lineTo(d+u,h),i.lineTo(d+u,h+y),i.lineTo(d+u-5,h+y+5),i.lineTo(d,h+y+5),i.closePath(),a.fill&&a.fill!=="none"&&i.fill(),i.stroke()}if(s.type==="umlLifeline"){const u=Math.max(30,l*.2),y=s.y+u/2;V.renderText(t,e,y)}else V.renderText(t,e,o)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=V.buildRenderOptions(s,r),c=s.width,l=s.height,d=s.x,h=s.y;if(s.type==="umlActor"){const u=c*.15;i.circle(d+c/2,h+u,u*2,a),i.line(d+c/2,h+u*2,d+c/2,h+l*.6,a),i.line(d,h+l*.3,d+c,h+l*.3,a),i.line(d+c/2,h+l*.6,d,h+l,a),i.line(d+c/2,h+l*.6,d+c,h+l,a)}else if(s.type==="umlUseCase"||s.type==="umlInterface")i.ellipse(d+c/2,h+l/2,c,l,a);else if(s.type==="umlPackage"){const u=l*.15,y=c*.4,m=`M ${d} ${h} L ${d+y} ${h} L ${d+y} ${h+u} L ${d+c} ${h+u} L ${d+c} ${h+l} L ${d} ${h+l} Z`;i.path(m,a),i.line(d,h+u,d+y,h+u,a)}else if(s.type==="umlNote"){const u=Math.min(c,l)*.15,y=`M ${d} ${h} L ${d+c-u} ${h} L ${d+c} ${h+u} L ${d+c} ${h+l} L ${d} ${h+l} L ${d} ${h} Z`;i.path(y,a),i.path(`M ${d+c-u} ${h} L ${d+c-u} ${h+u} L ${d+c} ${h+u}`,a)}else if(s.type==="umlComponent"){i.rectangle(d,h,c,l,a);const u=Math.min(16,c*.15),y=Math.min(10,l*.08),m=d-u/2;i.rectangle(m,h+l*.25-y/2,u,y,a),i.rectangle(m,h+l*.55-y/2,u,y,a)}else if(s.type==="umlLifeline"){const u=Math.max(30,l*.2);i.rectangle(d,h,c,u,a);const y={...a,strokeLineDash:[8,6],fill:"none"};i.line(d+c/2,h+u,d+c/2,h+l,y)}else if(s.type==="umlFragment"){i.rectangle(d,h,c,l,a);const u=Math.min(c*.3,60),y=Math.min(l*.12,22),m=`M ${d} ${h} L ${d+u} ${h} L ${d+u} ${h+y} L ${d+u-5} ${h+y+5} L ${d} ${h+y+5} Z`;i.path(m,a)}if(s.type==="umlLifeline"){const u=Math.max(30,l*.2),y=s.y+u/2;V.renderText(t,e,y)}else V.renderText(t,e,o)}definePath(t,e){e.type==="umlActor"?this.drawActorPath(t,e.x,e.y,e.width,e.height):e.type==="umlUseCase"||e.type==="umlInterface"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):e.type==="umlPackage"?this.drawPackagePath(t,e.x,e.y,e.width,e.height):e.type==="umlNote"?this.drawNotePath(t,e.x,e.y,e.width,e.height):(e.type==="umlComponent"||e.type==="umlLifeline"||e.type==="umlFragment")&&t.rect(e.x,e.y,e.width,e.height)}drawActorPath(t,e,o,i,s){const r=i*.15;t.moveTo(e+i/2+r,o+r),t.arc(e+i/2,o+r,r,0,Math.PI*2),t.moveTo(e+i/2,o+r*2),t.lineTo(e+i/2,o+s*.6),t.moveTo(e,o+s*.3),t.lineTo(e+i,o+s*.3),t.moveTo(e+i/2,o+s*.6),t.lineTo(e,o+s),t.moveTo(e+i/2,o+s*.6),t.lineTo(e+i,o+s)}drawPackagePath(t,e,o,i,s){const r=s*.15,a=i*.4;t.moveTo(e,o),t.lineTo(e+a,o),t.lineTo(e+a,o+r),t.lineTo(e+i,o+r),t.lineTo(e+i,o+s),t.lineTo(e,o+s),t.closePath()}drawNotePath(t,e,o,i,s){const r=Math.min(i,s)*.15;t.moveTo(e,o),t.lineTo(e+i-r,o),t.lineTo(e+i,o+r),t.lineTo(e+i,o+s),t.lineTo(e,o+s),t.closePath()}}class wy extends se{renderArchitectural(t,e,o){const{ctx:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);i.beginPath(),a>0?i.roundRect(s.x,s.y,s.width,s.height,a):i.rect(s.x,s.y,s.width,s.height),i.fillStyle=c.fill||"transparent",c.fill&&c.fill!=="none"&&i.fill(),i.lineWidth=s.strokeWidth,i.strokeStyle=c.stroke||"#000000",i.stroke();const l=this.calculateLayout(i,s);this.drawDivider(i,s,l,c.stroke||"#000000",!1),this.renderTexts(t,s,l)}renderSketch(t,e,o){const{rc:i,element:s,isDarkMode:r}=t,a=this.getRadius(s),c=V.buildRenderOptions(s,r);if(a>0){const h=this.getRoundedRectPath(s.x,s.y,s.width,s.height,a);i.path(h,c)}else i.rectangle(s.x,s.y,s.width,s.height,c);const l=Uh(),d=this.calculateLayout(l,s);this.drawDivider(null,s,d,c.stroke||"#000000",!0,i,c),this.renderTexts(t,s,d)}definePath(t,e){const o=this.getRadius(e);o>0?t.roundRect(e.x,e.y,e.width,e.height,o):t.rect(e.x,e.y,e.width,e.height)}getRadius(t){return Math.min(Math.abs(t.width),Math.abs(t.height))*.15}getRoundedRectPath(t,e,o,i,s){const r=Math.min(Math.abs(o)/2,s),a=Math.min(Math.abs(i)/2,s);return`M ${t+r} ${e} L ${t+o-r} ${e} Q ${t+o} ${e} ${t+o} ${e+a} L ${t+o} ${e+i-a} Q ${t+o} ${e+i} ${t+o-r} ${e+i} L ${t+r} ${e+i} Q ${t} ${e+i} ${t} ${e+i-a} L ${t} ${e+a} Q ${t} ${e} ${t+r} ${e}`}calculateLayout(t,e){const o=e.containerText||"";let i=Math.min(e.height,35);if(o){const s=ve(t,e,o,e.width-20);i=Math.max(i,s.textHeight+15)}return{headerHeight:i}}drawDivider(t,e,o,i,s,r,a){const c=e.y+o.headerHeight;c<e.y+e.height&&(s&&r?r.line(e.x,c,e.x+e.width,c,a):t&&(t.strokeStyle=i,t.lineWidth=1,t.beginPath(),t.moveTo(e.x,c),t.lineTo(e.x+e.width,c),t.stroke()))}renderTexts(t,e,o){const{ctx:i,isDarkMode:s}=t;if(e.containerText&&this.renderSectionText(i,e,e.containerText,e.x+e.width/2,e.y+o.headerHeight/2,e.width-20,"center",!0,s),e.attributesText){const r=e.y+o.headerHeight+5,a=(e.fontSize||20)*.9;this.renderSectionText(i,{...e,fontSize:a},e.attributesText,e.x+10,r,e.width-20,"left",!1,s)}}renderSectionText(t,e,o,i,s,r,a,c,l){if(!o)return;t.save(),t.font=ro({...e,fontWeight:c?"bold":e.fontWeight});const d=V.adjustColor(e.strokeColor||"#000",l);t.fillStyle=d,t.textAlign=a,t.textBaseline=a==="center"?"middle":"top";const h=ve(t,e,o,r);h.lines.forEach((u,y)=>{const m=s+y*h.lineHeight-(a==="center"?(h.lines.length-1)*h.lineHeight/2:0);t.fillText(u,i,m)}),t.restore()}}function by(){console.log("Registering all shapes including specialty..."),Jt.register("rectangle",new ey),Jt.register("circle",new ny),Jt.register("diamond",new iy),Jt.register("text",new oy),Jt.register("image",new sy),Jt.register("stickyNote",new ry);const n=new ay;["triangle","hexagon","octagon","parallelogram","trapezoid","rightTriangle","pentagon","septagon","polygon"].forEach(X=>Jt.register(X,n));const e=new ly;["database","document","predefinedProcess","internalStorage"].forEach(X=>Jt.register(X,e));const i=new cy;["starPerson","lightbulb","signpost","burstBlob","scroll","wavyDivider","doubleBanner"].forEach(X=>Jt.register(X,i));const r=new dy;["server","loadBalancer","firewall","user","messageQueue","lambda","router"].forEach(X=>Jt.register(X,r));const c=new hy;["browserWindow","mobilePhone"].forEach(X=>Jt.register(X,c));const d=new uy;["organicBranch"].forEach(X=>Jt.register(X,d));const u=new fy;["browser","ghostButton","inputField"].forEach(X=>Jt.register(X,u));const m=new py;Jt.register("line",m),Jt.register("arrow",m),Jt.register("bezier",m);const g=new yy;["fineliner","inkbrush","marker","ink"].forEach(X=>Jt.register(X,g));const x=new gy;["cloud","heart","star","burst","callout","speechBubble","ribbon","bracketLeft","bracketRight","cross","checkmark","capsule","arrowLeft","arrowRight","arrowUp","arrowDown","dfdProcess","dfdDataStore","isometricCube","solidBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","perspectiveBlock","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].forEach(X=>Jt.register(X,x));const S=new my;Jt.register("umlClass",S);const P=new wy;Jt.register("umlState",P);const A=new xy;["umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlLifeline","umlFragment"].forEach(X=>Jt.register(X,A))}const vy="1.3.0",Sy={version:vy};var ky=nt('<button class=floating-settings-btn title="Toggle Properties (Alt+Enter)"style="position:fixed;bottom:5px;left:230px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease">'),My=nt('<button class=floating-settings-btn title="Shortcuts &amp; Help (?)"style="position:fixed;bottom:5px;left:290px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease;font-weight:bold;font-size:20px">?'),Py=nt('<div style="position:fixed;bottom:8px;left:50%;transform:translateX(-50%);font-size:11px;color:var(--text-secondary, #6b7280);pointer-events:none;user-select:none;z-index:999;opacity:0.9">v'),$y=nt("<div>");const Cy=fe(()=>he(()=>import("./property-panel-D_ZvAIX5.js"),__vite__mapDeps([16,1,2,3,17]),import.meta.url)),Ty=fe(()=>he(()=>import("./layer-panel-BM0fLs6i.js"),__vite__mapDeps([18,1,2,3,19]),import.meta.url)),Iy=fe(()=>he(()=>import("./command-palette-Bi4vILsj.js"),__vite__mapDeps([20,1,2,3,21]),import.meta.url)),Ly=fe(()=>he(()=>import("./state-panel-B-m4OUb-.js"),__vite__mapDeps([22,1,2,3,23]),import.meta.url).then(n=>({default:n.StatePanel}))),Ey=fe(()=>he(()=>Promise.resolve().then(()=>cd),void 0,import.meta.url)),Ry=fe(()=>he(()=>import("./mindmap-action-toolbar-CWW-KLaF.js"),__vite__mapDeps([24,1,2,3,25]),import.meta.url).then(n=>({default:n.MindmapActionToolbar}))),Ay=fe(()=>he(()=>import("./slide-navigator-R4fnrQDB.js"),__vite__mapDeps([26,1,2,3,27]),import.meta.url).then(n=>({default:n.SlideNavigator}))),Dy=fe(()=>he(()=>import("./slide-control-toolbar-B6T-rlHI.js"),__vite__mapDeps([28,1,2,3]),import.meta.url).then(n=>({default:n.SlideControlToolbar}))),Oy=fe(()=>he(()=>import("./presentation-controls-lstETJ7z.js"),__vite__mapDeps([29,1,2,3]),import.meta.url).then(n=>({default:n.PresentationControls}))),_y=()=>(hn(()=>{console.log("App: Registering shapes..."),by(),ty();const n=async o=>{if(zl()||Bl()||Xl()||Yl()||p.showExportDialog)return;if(o.key==="F5"){o.preventDefault(),Ri(!0);return}if(o.key==="Escape"&&p.appMode==="presentation"){o.preventDefault(),Ri(!1);return}const i=o.code,s=o.key.toLowerCase();if(o.ctrlKey||o.metaKey){if(s==="z"){o.preventDefault(),o.shiftKey?Hi():ps();return}else if(s==="y"){o.preventDefault(),Hi();return}else if(s==="k"){o.preventDefault(),Sl(!0);return}else if(s==="a"){o.preventDefault(),$("selection",p.elements.map(a=>a.id));return}else if(s==="o"&&o.altKey){o.preventDefault(),zi(!0);return}else if(s==="s"&&o.altKey){o.preventDefault();return}else if(s==="e"&&o.shiftKey){o.preventDefault(),Ei(!0);return}}if(o.defaultPrevented)return;const r=o.target;if(!(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable)){if(o.altKey&&!o.ctrlKey&&!o.metaKey)if(i==="Enter"||s==="enter")o.preventDefault(),$n();else if(i==="KeyL"||s==="l")o.preventDefault(),Fi();else if(i==="KeyM"||s==="m")o.preventDefault(),oo();else if(i==="KeyZ"||s==="z"){o.preventDefault();const a=!p.zenMode;Ls(a),Es(!a)}else if(i==="KeyI"||s==="i")o.preventDefault(),Et("ink");else if(s==="\\"||i==="Backslash"){o.preventDefault();const a=p.showPropertyPanel||p.showLayerPanel;$n(!a),Fi(!a)}else if(s==="["||i==="BracketLeft"){o.preventDefault();const c=p.layers.findIndex(l=>l.id===p.activeLayerId);c>0&&Xo(c,c-1)}else if(s==="]"||i==="BracketRight"){o.preventDefault();const a=p.layers,c=a.findIndex(l=>l.id===p.activeLayerId);c!==-1&&c<a.length-1&&Xo(c,c+1)}else if(s==="n"||i==="KeyN")o.preventDefault(),ns();else if(s>="1"&&s<="9"){o.preventDefault();const a=parseInt(s)-1;Kd(a)}else i==="ArrowRight"?(o.preventDefault(),vs()):i==="ArrowLeft"&&(o.preventDefault(),Ss());if(o.ctrlKey||o.metaKey){if(s==="g")o.preventDefault(),o.shiftKey?Ms():ks();else if(s==="m")o.preventDefault(),ul();else if(s==="c"||i==="KeyC")o.preventDefault(),o.altKey?As():await so();else if(s==="v"||i==="KeyV")o.preventDefault(),o.altKey?Ds():await Gi();else if(s==="x"||i==="KeyX")o.preventDefault(),await Rs();else if(s==="]")o.preventDefault(),p.selection.length>0&&ms(p.selection);else if(s==="[")o.preventDefault(),p.selection.length>0&&xs(p.selection);else if(s==="d"){o.preventDefault();const a=p.elements.filter(c=>p.selection.includes(c.id));if(a.length>0){const c=new Map;a.forEach(h=>{h.groupIds?.forEach(u=>{c.has(u)||c.set(u,crypto.randomUUID())})});const l=20,d=a.map(h=>({...h,id:crypto.randomUUID(),x:h.x+l,y:h.y+l,groupIds:h.groupIds?.map(u=>c.get(u))}));$("elements",[...p.elements,...d]),$("selection",d.map(h=>h.id))}}return}if(!o.altKey&&!o.ctrlKey&&!o.metaKey){if(p.appMode==="presentation"){if(i==="PageDown"||i==="Enter"||i==="NumpadEnter"||i==="Space"||i==="ArrowRight"){o.preventDefault(),bs();return}else if(i==="ArrowLeft"||i==="PageUp"||i==="Backspace"){o.preventDefault(),hl();return}}if(i==="Home"){o.preventDefault(),p.states.length>0?io(p.states[0].id):We(0);return}if(s==="s")o.preventDefault(),xh();else if(s==="f")o.preventDefault(),wh();else if(s==="?"&&o.shiftKey)o.preventDefault(),ts(!0);else if(s==='"'||s==="'"&&o.shiftKey)o.preventDefault(),Ts();else if(s===":"||s===";"&&o.shiftKey)o.preventDefault(),Is();else if(s==="delete"||s==="backspace")o.preventDefault(),p.selection.length>0&&Qe(p.selection);else if(["arrowup","arrowdown","arrowleft","arrowright"].includes(s)){if(p.selection.length>0){o.preventDefault();const a=o.shiftKey?10:1;let c=0,l=0;s==="arrowup"?l=-a:s==="arrowdown"?l=a:s==="arrowleft"?c=-a:s==="arrowright"&&(c=a),dl(c,l,!0)}}else s==="tab"?p.selection.length===1&&(o.preventDefault(),ys(p.selection[0])):s==="enter"?p.selection.length===1&&(o.preventDefault(),gs(p.selection[0])):s===" "?p.selection.length>0&&(o.preventDefault(),cl()):o.shiftKey&&s==="n"?(o.preventDefault(),xl()):o.shiftKey&&s==="p"?(o.preventDefault(),Et("laser")):s==="v"||s==="1"?Et("selection"):s==="r"||s==="2"?Et("rectangle"):s==="o"||s==="3"?Et("circle"):s==="l"||s==="4"?Et("line"):s==="a"||s==="5"?Et("arrow"):s==="t"||s==="6"?Et("text"):s==="e"||s==="7"?Et("eraser"):s==="p"||s==="8"?Et("fineliner"):s==="9"||s==="i"?window.triggerImageUpload?.():s==="b"||s==="0"?Et("bezier"):s==="d"?Et("diamond"):s==="h"&&Et("pan")}}},t=()=>{!document.fullscreenElement&&p.appMode==="presentation"&&Ri(!1)},e=o=>{};window.addEventListener("keydown",n,!0),window.addEventListener("beforeunload",e),document.addEventListener("fullscreenchange",t),oe(()=>{window.removeEventListener("keydown",n,!0),window.removeEventListener("beforeunload",e),document.removeEventListener("fullscreenchange",t)})}),(()=>{var n=$y();return Y(n,I(pr,{fallback:null,get children(){return[I(St,{get when(){return p.appMode!=="presentation"},get children(){return[I(St,{get when(){return p.showMainToolbar},get children(){return I(ap,{})}}),I(St,{get when(){return!p.zenMode},get children(){return[I(Cy,{}),I(Ty,{}),I(Vp,{})]}}),I(jp,{})]}}),I(Nu,{}),I(St,{get when(){return p.docType==="slides"},get children(){return I(St,{get when(){return Cn(()=>p.appMode!=="presentation"&&!p.zenMode)()&&p.showSlideNavigator},get fallback(){return I(St,{get when(){return p.appMode==="presentation"},get children(){return I(Oy,{})}})},get children(){return I(Ay,{})}})}}),I(St,{get when(){return p.appMode!=="presentation"},get children(){return[I(Iy,{}),I(Ly,{}),I(fp,{})]}}),I(St,{get when(){return p.appMode!=="presentation"},get children(){return[(()=>{var t=ky();return t.$$click=()=>$n(),Y(t,I(Zc,{size:24})),pt(()=>t.classList.toggle("active",!!p.showPropertyPanel)),t})(),(()=>{var t=My();return t.$$click=()=>ts(!0),t})(),I(Dy,{}),I(Ry,{})]}}),I(Ey,{}),(()=>{var t=Py();return t.firstChild,Y(t,()=>Sy.version,null),t})()]}})),n})());ne(["click"]);const zy=document.getElementById("root");td(()=>I(_y,{}),zy);export{ks as $,Gy as A,sh as B,Ny as C,Ud as D,Fd as E,rn as F,je as G,So as H,Jd as I,Vd as J,eh as K,nh as L,Zd as M,th as N,Qd as O,Cl as P,jy as Q,fh as R,xl as S,Fi as T,ph as U,Xo as V,$s as W,Qy as X,Et as Y,ps as Z,Hi as _,K as a,Ms as a0,ms as a1,xs as a2,Ts as a3,Is as a4,Ls as a5,oo as a6,Ps as a7,ml as a8,$ as a9,Jy as aA,Ky as aB,Hu as aC,pl as aa,Sl as ab,fl as ac,io as ad,qd as ae,jd as af,Gd as ag,xd as ah,al as ai,Rp as aj,We as ak,Hd as al,Yd as am,ul as an,Ri as ao,wl as ap,uh as aq,Ad as ar,yi as as,hl as at,bs as au,Ir as av,pp as aw,rr as ax,Lu as ay,Eu as az,Yi as b,Wd as c,Ns as d,gl as e,Vy as f,Bt as g,ih as h,Wo as i,Qe as j,mh as k,bh as l,qy as m,ys as n,gs as o,Pl as p,Yo as q,Hy as r,p as s,$n as t,Z as u,vn as v,Mt as w,oh as x,Fy as y,Uy as z};
