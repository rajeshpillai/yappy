import{t as v,h as C,i as o,x as z,m as N,r as A,az as K,e as T,d as X}from"./vendor-rendering-DiNU4-Fn.js";import{e as g,l as Y,d as L,h as r,S as y,F as j,a as q}from"./solid-framework-CtC0wtKI.js";import{az as F,g as O}from"./index-BGC4VVmd.js";import"./vendor-export-B6WwIQ1_.js";var H=v("<div class=loading>Loading..."),R=v("<div class=empty>No saved drawings found."),U=v("<div class=modal-overlay><div class=modal-content><div class=modal-header><h3>Open Drawing</h3><button class=close-btn></button></div><div class=modal-body><div class=file-list>"),V=v("<div><div style=display:flex;align-items:center;gap:8px;flex:1><span></span></div><button class=delete-file-btn title=Delete>");const W=a=>{const[h,S]=g([]),[$,_]=g(!1),[f,u]=g(null),[b,p]=g(!1);let x=0,D=0;const E=async()=>{_(!0);try{const t=(await F.listDrawings()).map(e=>({id:e,name:e})).sort((e,i)=>e.name.localeCompare(i.name));S(t),t.length>0&&u(t[0].id)}catch(n){console.error(n)}finally{_(!1)}},M=async(n,t)=>{t.stopPropagation();const e=n;if(confirm(`Are you sure you want to delete "${e}"?`))try{await F.deleteDrawing(n),E(),O(`Deleted "${e}"`,"success")}catch{O("Failed to delete file","error")}};return Y(()=>{const n=e=>{if(!a.isOpen)return;const i=h();if(console.log("FileOpenDialog Key:",e.key,{files:i.length,activeId:f()}),i.length===0)return;const d=f(),c=i.findIndex(l=>l.id===d);if(e.key==="ArrowDown"){e.preventDefault(),e.stopImmediatePropagation(),p(!0);const l=(c+1)%i.length;u(i[l].id)}else if(e.key==="ArrowUp"){e.preventDefault(),e.stopImmediatePropagation(),p(!0);const l=(c-1+i.length)%i.length;u(i[l].id)}else e.key==="Enter"?(e.preventDefault(),e.stopImmediatePropagation(),d&&a.onSelect(d)):e.key==="Escape"&&(e.preventDefault(),e.stopImmediatePropagation(),a.onClose())},t=e=>{(Math.abs(e.clientX-x)>2||Math.abs(e.clientY-D)>2)&&p(!1),x=e.clientX,D=e.clientY};return window.addEventListener("keydown",n,!0),window.addEventListener("mousemove",t),()=>{window.removeEventListener("keydown",n,!0),window.removeEventListener("mousemove",t)}}),L(()=>{a.isOpen&&(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),window.focus(),console.log("FileOpenDialog opened. Fetching files..."),E())}),L(()=>{f()&&a.isOpen&&b()&&setTimeout(()=>{const t=document.querySelector(".file-item.active");t&&t.scrollIntoView({block:"nearest",behavior:"smooth"})},0)}),r(y,{get when(){return a.isOpen},get children(){var n=U(),t=n.firstChild,e=t.firstChild,i=e.firstChild,d=i.nextSibling,c=e.nextSibling,l=c.firstChild;return C(n,"click",a.onClose,!0),t.$$click=s=>s.stopPropagation(),C(d,"click",a.onClose,!0),o(d,r(z,{size:20})),o(c,r(y,{get when(){return $()},get children(){return H()}}),l),o(c,r(y,{get when(){return N(()=>!$())()&&h().length===0},get children(){return R()}}),l),o(l,r(j,{get each(){return h()},children:s=>(()=>{var m=V(),w=m.firstChild,k=w.firstChild,I=w.nextSibling;return m.addEventListener("mouseenter",()=>{b()||u(s.id)}),m.$$click=()=>a.onSelect(s.id),o(w,r(A,{size:16}),k),o(k,()=>s.name),I.$$click=P=>M(s.id,P),o(I,r(K,{size:16})),q(()=>T(m,`file-item ${f()===s.id?"active":""}`)),m})()})),n}})};X(["click"]);export{W as default};
