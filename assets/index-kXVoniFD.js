(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const ns=!1,ss=(t,e)=>t===e,Me=Symbol("solid-proxy"),Mn=typeof Proxy=="function",Wt=Symbol("solid-track"),xt={equals:ss};let _n=On;const Re=1,$t=2,Cn={owned:null,cleanups:null,context:null,owner:null};var he=null;let Nt=null,is=null,ce=null,pe=null,Ie=null,It=0;function vt(t,e){const n=ce,s=he,i=t.length===0,l=e===void 0?s:e,r=i?Cn:{owned:null,cleanups:null,context:l?l.context:null,owner:l},a=i?t:()=>t(()=>Te(()=>nt(r)));he=r,ce=null;try{return Ze(a,!0)}finally{ce=n,he=s}}function ee(t,e){e=e?Object.assign({},xt,e):xt;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=i=>(typeof i=="function"&&(i=i(n.value)),Tn(n,i));return[Pn.bind(n),s]}function Q(t,e,n){const s=nn(t,e,!1,Re);ct(s)}function We(t,e,n){_n=os;const s=nn(t,e,!1,Re);s.user=!0,Ie?Ie.push(s):ct(s)}function Se(t,e,n){n=n?Object.assign({},xt,n):xt;const s=nn(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=n.equals||void 0,ct(s),Pn.bind(s)}function ls(t){return Ze(t,!1)}function Te(t){if(ce===null)return t();const e=ce;ce=null;try{return t()}finally{ce=e}}function rt(t){We(()=>Te(t))}function ot(t){return he===null||(he.cleanups===null?he.cleanups=[t]:he.cleanups.push(t)),t}function Ht(){return ce}function Pn(){if(this.sources&&this.state)if(this.state===Re)ct(this);else{const t=pe;pe=null,Ze(()=>Mt(this),!1),pe=t}if(ce){const t=this.observers?this.observers.length:0;ce.sources?(ce.sources.push(this),ce.sourceSlots.push(t)):(ce.sources=[this],ce.sourceSlots=[t]),this.observers?(this.observers.push(ce),this.observerSlots.push(ce.sources.length-1)):(this.observers=[ce],this.observerSlots=[ce.sources.length-1])}return this.value}function Tn(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&Ze(()=>{for(let i=0;i<t.observers.length;i+=1){const l=t.observers[i],r=Nt&&Nt.running;r&&Nt.disposed.has(l),(r?!l.tState:!l.state)&&(l.pure?pe.push(l):Ie.push(l),l.observers&&En(l)),r||(l.state=Re)}if(pe.length>1e6)throw pe=[],new Error},!1)),e}function ct(t){if(!t.fn)return;nt(t);const e=It;as(t,t.value,e)}function as(t,e,n){let s;const i=he,l=ce;ce=he=t;try{s=t.fn(e)}catch(r){return t.pure&&(t.state=Re,t.owned&&t.owned.forEach(nt),t.owned=null),t.updatedAt=n+1,Ln(r)}finally{ce=l,he=i}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Tn(t,s):t.value=s,t.updatedAt=n)}function nn(t,e,n,s=Re,i){const l={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:he,context:he?he.context:null,pure:n};return he===null||he!==Cn&&(he.owned?he.owned.push(l):he.owned=[l]),l}function St(t){if(t.state===0)return;if(t.state===$t)return Mt(t);if(t.suspense&&Te(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<It);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===Re)ct(t);else if(t.state===$t){const s=pe;pe=null,Ze(()=>Mt(t,e[0]),!1),pe=s}}function Ze(t,e){if(pe)return t();let n=!1;e||(pe=[]),Ie?n=!0:Ie=[],It++;try{const s=t();return rs(n),s}catch(s){n||(Ie=null),pe=null,Ln(s)}}function rs(t){if(pe&&(On(pe),pe=null),t)return;const e=Ie;Ie=null,e.length&&Ze(()=>_n(e),!1)}function On(t){for(let e=0;e<t.length;e++)St(t[e])}function os(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:St(s)}for(e=0;e<n;e++)St(t[e])}function Mt(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const s=t.sources[n];if(s.sources){const i=s.state;i===Re?s!==e&&(!s.updatedAt||s.updatedAt<It)&&St(s):i===$t&&Mt(s,e)}}}function En(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=$t,n.pure?pe.push(n):Ie.push(n),n.observers&&En(n))}}function nt(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const l=i.pop(),r=n.observerSlots.pop();s<i.length&&(l.sourceSlots[r]=s,i[s]=l,n.observerSlots[s]=r)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)nt(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)nt(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function cs(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Ln(t,e=he){throw cs(t)}const ds=Symbol("fallback");function cn(t){for(let e=0;e<t.length;e++)t[e]()}function hs(t,e,n={}){let s=[],i=[],l=[],r=0,a=e.length>1?[]:null;return ot(()=>cn(l)),()=>{let o=t()||[],d=o.length,c,h;return o[Wt],Te(()=>{let p,m,x,y,$,P,T,O,R;if(d===0)r!==0&&(cn(l),l=[],s=[],i=[],r=0,a&&(a=[])),n.fallback&&(s=[ds],i[0]=vt(N=>(l[0]=N,n.fallback())),r=1);else if(r===0){for(i=new Array(d),h=0;h<d;h++)s[h]=o[h],i[h]=vt(u);r=d}else{for(x=new Array(d),y=new Array(d),a&&($=new Array(d)),P=0,T=Math.min(r,d);P<T&&s[P]===o[P];P++);for(T=r-1,O=d-1;T>=P&&O>=P&&s[T]===o[O];T--,O--)x[O]=i[T],y[O]=l[T],a&&($[O]=a[T]);for(p=new Map,m=new Array(O+1),h=O;h>=P;h--)R=o[h],c=p.get(R),m[h]=c===void 0?-1:c,p.set(R,h);for(c=P;c<=T;c++)R=s[c],h=p.get(R),h!==void 0&&h!==-1?(x[h]=i[c],y[h]=l[c],a&&($[h]=a[c]),h=m[h],p.set(R,h)):l[c]();for(h=P;h<d;h++)h in x?(i[h]=x[h],l[h]=y[h],a&&(a[h]=$[h],a[h](h))):i[h]=vt(u);i=i.slice(0,r=d),s=o.slice(0)}return i});function u(p){if(l[h]=p,a){const[m,x]=ee(h);return a[h]=x,e(o[h],m)}return e(o[h])}}}function k(t,e){return Te(()=>t(e||{}))}function ft(){return!0}const Vt={get(t,e,n){return e===Me?n:t.get(e)},has(t,e){return e===Me?!0:t.has(e)},set:ft,deleteProperty:ft,getOwnPropertyDescriptor(t,e){return{configurable:!0,enumerable:!0,get(){return t.get(e)},set:ft,deleteProperty:ft}},ownKeys(t){return t.keys()}};function zt(t){return(t=typeof t=="function"?t():t)?t:{}}function us(){for(let t=0,e=this.length;t<e;++t){const n=this[t]();if(n!==void 0)return n}}function q(...t){let e=!1;for(let r=0;r<t.length;r++){const a=t[r];e=e||!!a&&Me in a,t[r]=typeof a=="function"?(e=!0,Se(a)):a}if(Mn&&e)return new Proxy({get(r){for(let a=t.length-1;a>=0;a--){const o=zt(t[a])[r];if(o!==void 0)return o}},has(r){for(let a=t.length-1;a>=0;a--)if(r in zt(t[a]))return!0;return!1},keys(){const r=[];for(let a=0;a<t.length;a++)r.push(...Object.keys(zt(t[a])));return[...new Set(r)]}},Vt);const n={},s=Object.create(null);for(let r=t.length-1;r>=0;r--){const a=t[r];if(!a)continue;const o=Object.getOwnPropertyNames(a);for(let d=o.length-1;d>=0;d--){const c=o[d];if(c==="__proto__"||c==="constructor")continue;const h=Object.getOwnPropertyDescriptor(a,c);if(!s[c])s[c]=h.get?{enumerable:!0,configurable:!0,get:us.bind(n[c]=[h.get.bind(a)])}:h.value!==void 0?h:void 0;else{const u=n[c];u&&(h.get?u.push(h.get.bind(a)):h.value!==void 0&&u.push(()=>h.value))}}}const i={},l=Object.keys(s);for(let r=l.length-1;r>=0;r--){const a=l[r],o=s[a];o&&o.get?Object.defineProperty(i,a,o):i[a]=o?o.value:void 0}return i}function An(t,...e){const n=e.length;if(Mn&&Me in t){const i=n>1?e.flat():e[0],l=e.map(r=>new Proxy({get(a){return r.includes(a)?t[a]:void 0},has(a){return r.includes(a)&&a in t},keys(){return r.filter(a=>a in t)}},Vt));return l.push(new Proxy({get(r){return i.includes(r)?void 0:t[r]},has(r){return i.includes(r)?!1:r in t},keys(){return Object.keys(t).filter(r=>!i.includes(r))}},Vt)),l}const s=[];for(let i=0;i<=n;i++)s[i]={};for(const i of Object.getOwnPropertyNames(t)){let l=n;for(let o=0;o<e.length;o++)if(e[o].includes(i)){l=o;break}const r=Object.getOwnPropertyDescriptor(t,i);!r.get&&!r.set&&r.enumerable&&r.writable&&r.configurable?s[l][i]=r.value:Object.defineProperty(s[l],i,r)}return s}const fs=t=>`Stale read from <${t}>.`;function Ae(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Se(hs(()=>t.each,t.children,e||void 0))}function fe(t){const e=t.keyed,n=Se(()=>t.when,void 0,void 0),s=e?n:Se(n,void 0,{equals:(i,l)=>!i==!l});return Se(()=>{const i=s();if(i){const l=t.children;return typeof l=="function"&&l.length>0?Te(()=>l(e?i:()=>{if(!Te(s))throw fs("Show");return n()})):l}return t.fallback},void 0,void 0)}const ps=["allowfullscreen","async","alpha","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","adauctionheaders","browsingtopics","credentialless","defaultchecked","defaultmuted","defaultselected","defer","disablepictureinpicture","disableremoteplayback","preservespitch","shadowrootclonable","shadowrootcustomelementregistry","shadowrootdelegatesfocus","shadowrootserializable","sharedstoragewritable"],gs=new Set(["className","value","readOnly","noValidate","formNoValidate","isMap","noModule","playsInline","adAuctionHeaders","allowFullscreen","browsingTopics","defaultChecked","defaultMuted","defaultSelected","disablePictureInPicture","disableRemotePlayback","preservesPitch","shadowRootClonable","shadowRootCustomElementRegistry","shadowRootDelegatesFocus","shadowRootSerializable","sharedStorageWritable",...ps]),ys=new Set(["innerHTML","textContent","innerText","children"]),ms=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),bs=Object.assign(Object.create(null),{class:"className",novalidate:{$:"noValidate",FORM:1},formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1},adauctionheaders:{$:"adAuctionHeaders",IFRAME:1},allowfullscreen:{$:"allowFullscreen",IFRAME:1},browsingtopics:{$:"browsingTopics",IMG:1},defaultchecked:{$:"defaultChecked",INPUT:1},defaultmuted:{$:"defaultMuted",AUDIO:1,VIDEO:1},defaultselected:{$:"defaultSelected",OPTION:1},disablepictureinpicture:{$:"disablePictureInPicture",VIDEO:1},disableremoteplayback:{$:"disableRemotePlayback",AUDIO:1,VIDEO:1},preservespitch:{$:"preservesPitch",AUDIO:1,VIDEO:1},shadowrootclonable:{$:"shadowRootClonable",TEMPLATE:1},shadowrootdelegatesfocus:{$:"shadowRootDelegatesFocus",TEMPLATE:1},shadowrootserializable:{$:"shadowRootSerializable",TEMPLATE:1},sharedstoragewritable:{$:"sharedStorageWritable",IFRAME:1,IMG:1}});function vs(t,e){const n=bs[t];return typeof n=="object"?n[e]?n.$:void 0:n}const ws=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),ks=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),xs={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},dt=t=>Se(()=>t());function $s(t,e,n){let s=n.length,i=e.length,l=s,r=0,a=0,o=e[i-1].nextSibling,d=null;for(;r<i||a<l;){if(e[r]===n[a]){r++,a++;continue}for(;e[i-1]===n[l-1];)i--,l--;if(i===r){const c=l<s?a?n[a-1].nextSibling:n[l-a]:o;for(;a<l;)t.insertBefore(n[a++],c)}else if(l===a)for(;r<i;)(!d||!d.has(e[r]))&&e[r].remove(),r++;else if(e[r]===n[l-1]&&n[a]===e[i-1]){const c=e[--i].nextSibling;t.insertBefore(n[a++],e[r++].nextSibling),t.insertBefore(n[--l],c),e[i]=n[l]}else{if(!d){d=new Map;let h=a;for(;h<l;)d.set(n[h],h++)}const c=d.get(e[r]);if(c!=null)if(a<c&&c<l){let h=r,u=1,p;for(;++h<i&&h<l&&!((p=d.get(e[h]))==null||p!==c+u);)u++;if(u>c-a){const m=e[r];for(;a<c;)t.insertBefore(n[a++],m)}else t.replaceChild(n[a++],e[r++])}else r++;else e[r++].remove()}}}const dn="_$DX_DELEGATE";function Ss(t,e,n,s={}){let i;return vt(l=>{i=l,e===document?t():C(e,t(),e.firstChild?null:void 0,n)},s.owner),()=>{i(),e.textContent=""}}function Y(t,e,n,s){let i;const l=()=>{const a=document.createElement("template");return a.innerHTML=t,a.content.firstChild},r=()=>(i||(i=l())).cloneNode(!0);return r.cloneNode=r,r}function _e(t,e=window.document){const n=e[dn]||(e[dn]=new Set);for(let s=0,i=t.length;s<i;s++){const l=t[s];n.has(l)||(n.add(l),e.addEventListener(l,Es))}}function be(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function Ms(t,e,n,s){s==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,s)}function _s(t,e,n){n?t.setAttribute(e,""):t.removeAttribute(e)}function ve(t,e){e==null?t.removeAttribute("class"):t.className=e}function we(t,e,n,s){if(s)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const i=n[0];t.addEventListener(e,n[0]=l=>i.call(t,n[1],l))}else t.addEventListener(e,n,typeof n!="function"&&n)}function Cs(t,e,n={}){const s=Object.keys(e||{}),i=Object.keys(n);let l,r;for(l=0,r=i.length;l<r;l++){const a=i[l];!a||a==="undefined"||e[a]||(hn(t,a,!1),delete n[a])}for(l=0,r=s.length;l<r;l++){const a=s[l],o=!!e[a];!a||a==="undefined"||n[a]===o||!o||(hn(t,a,!0),n[a]=o)}return n}function Ps(t,e,n){if(!e)return n?be(t,"style"):e;const s=t.style;if(typeof e=="string")return s.cssText=e;typeof n=="string"&&(s.cssText=n=void 0),n||(n={}),e||(e={});let i,l;for(l in n)e[l]==null&&s.removeProperty(l),delete n[l];for(l in e)i=e[l],i!==n[l]&&(s.setProperty(l,i),n[l]=i);return n}function Ne(t,e,n){n!=null?t.style.setProperty(e,n):t.style.removeProperty(e)}function In(t,e={},n,s){const i={};return s||Q(()=>i.children=st(t,e.children,i.children)),Q(()=>typeof e.ref=="function"&&Ve(e.ref,t)),Q(()=>Ts(t,e,n,!0,i,!0)),i}function Ve(t,e,n){return Te(()=>t(e,n))}function C(t,e,n,s){if(n!==void 0&&!s&&(s=[]),typeof e!="function")return st(t,e,s,n);Q(i=>st(t,e(),i,n),s)}function Ts(t,e,n,s,i={},l=!1){e||(e={});for(const r in i)if(!(r in e)){if(r==="children")continue;i[r]=un(t,r,null,i[r],n,l,e)}for(const r in e){if(r==="children")continue;const a=e[r];i[r]=un(t,r,a,i[r],n,l,e)}}function Os(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function hn(t,e,n){const s=e.trim().split(/\s+/);for(let i=0,l=s.length;i<l;i++)t.classList.toggle(s[i],n)}function un(t,e,n,s,i,l,r){let a,o,d,c,h;if(e==="style")return Ps(t,n,s);if(e==="classList")return Cs(t,n,s);if(n===s)return s;if(e==="ref")l||n(t);else if(e.slice(0,3)==="on:"){const u=e.slice(3);s&&t.removeEventListener(u,s,typeof s!="function"&&s),n&&t.addEventListener(u,n,typeof n!="function"&&n)}else if(e.slice(0,10)==="oncapture:"){const u=e.slice(10);s&&t.removeEventListener(u,s,!0),n&&t.addEventListener(u,n,!0)}else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),p=ws.has(u);if(!p&&s){const m=Array.isArray(s)?s[0]:s;t.removeEventListener(u,m)}(p||n)&&(we(t,u,n,p),p&&_e([u]))}else if(e.slice(0,5)==="attr:")be(t,e.slice(5),n);else if(e.slice(0,5)==="bool:")_s(t,e.slice(5),n);else if((h=e.slice(0,5)==="prop:")||(d=ys.has(e))||!i&&((c=vs(e,t.tagName))||(o=gs.has(e)))||(a=t.nodeName.includes("-")||"is"in r))h&&(e=e.slice(5),o=!0),e==="class"||e==="className"?ve(t,n):a&&!o&&!d?t[Os(e)]=n:t[c||e]=n;else{const u=i&&e.indexOf(":")>-1&&xs[e.split(":")[0]];u?Ms(t,u,e,n):be(t,ms[e]||e,n)}return n}function Es(t){let e=t.target;const n=`$$${t.type}`,s=t.target,i=t.currentTarget,l=o=>Object.defineProperty(t,"target",{configurable:!0,value:o}),r=()=>{const o=e[n];if(o&&!e.disabled){const d=e[`${n}Data`];if(d!==void 0?o.call(e,d,t):o.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&l(e.host),!0},a=()=>{for(;r()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const o=t.composedPath();l(o[0]);for(let d=0;d<o.length-2&&(e=o[d],!!r());d++){if(e._$host){e=e._$host,a();break}if(e.parentNode===i)break}}else a();l(s)}function st(t,e,n,s,i){for(;typeof n=="function";)n=n();if(e===n)return n;const l=typeof e,r=s!==void 0;if(t=r&&n[0]&&n[0].parentNode||t,l==="string"||l==="number"){if(l==="number"&&(e=e.toString(),e===n))return n;if(r){let a=n[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),n=Ue(t,n,s,a)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||l==="boolean")n=Ue(t,n,s);else{if(l==="function")return Q(()=>{let a=e();for(;typeof a=="function";)a=a();n=st(t,a,n,s)}),()=>n;if(Array.isArray(e)){const a=[],o=n&&Array.isArray(n);if(Ut(a,e,n,i))return Q(()=>n=st(t,a,n,s,!0)),()=>n;if(a.length===0){if(n=Ue(t,n,s),r)return n}else o?n.length===0?fn(t,a,s):$s(t,n,a):(n&&Ue(t),fn(t,a));n=a}else if(e.nodeType){if(Array.isArray(n)){if(r)return n=Ue(t,n,s,e);Ue(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Ut(t,e,n,s){let i=!1;for(let l=0,r=e.length;l<r;l++){let a=e[l],o=n&&n[t.length],d;if(!(a==null||a===!0||a===!1))if((d=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))i=Ut(t,a,o)||i;else if(d==="function")if(s){for(;typeof a=="function";)a=a();i=Ut(t,Array.isArray(a)?a:[a],Array.isArray(o)?o:[o])||i}else t.push(a),i=!0;else{const c=String(a);o&&o.nodeType===3&&o.data===c?t.push(o):t.push(document.createTextNode(c))}}return i}function fn(t,e,n=null){for(let s=0,i=e.length;s<i;s++)t.insertBefore(e[s],n)}function Ue(t,e,n,s){if(n===void 0)return t.textContent="";const i=s||document.createTextNode("");if(e.length){let l=!1;for(let r=e.length-1;r>=0;r--){const a=e[r];if(i!==a){const o=a.parentNode===t;!l&&!r?o?t.replaceChild(i,a):t.insertBefore(i,n):o&&a.remove()}else l=!0}}else t.insertBefore(i,n);return[i]}const Ls="http://www.w3.org/2000/svg";function As(t,e=!1,n=void 0){return e?document.createElementNS(Ls,t):document.createElement(t,{is:n})}function Is(t,e){const n=Se(t);return Se(()=>{const s=n();switch(typeof s){case"function":return Te(()=>s(e));case"string":const i=ks.has(s),l=As(s,i,Te(()=>e.is));return In(l,e,i),l}})}function Ds(t){const[,e]=An(t,["component"]);return Is(()=>t.component,e)}const Gt=Symbol("store-raw"),qe=Symbol("store-node"),Le=Symbol("store-has"),Dn=Symbol("store-self");function Nn(t){let e=t[Me];if(!e&&(Object.defineProperty(t,Me,{value:e=new Proxy(t,Rs)}),!Array.isArray(t))){const n=Object.keys(t),s=Object.getOwnPropertyDescriptors(t);for(let i=0,l=n.length;i<l;i++){const r=n[i];s[r].get&&Object.defineProperty(t,r,{enumerable:s[r].enumerable,get:s[r].get.bind(e)})}}return e}function _t(t){let e;return t!=null&&typeof t=="object"&&(t[Me]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function it(t,e=new Set){let n,s,i,l;if(n=t!=null&&t[Gt])return n;if(!_t(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let r=0,a=t.length;r<a;r++)i=t[r],(s=it(i,e))!==i&&(t[r]=s)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const r=Object.keys(t),a=Object.getOwnPropertyDescriptors(t);for(let o=0,d=r.length;o<d;o++)l=r[o],!a[l].get&&(i=t[l],(s=it(i,e))!==i&&(t[l]=s))}return t}function Ct(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function lt(t,e,n){if(t[e])return t[e];const[s,i]=ee(n,{equals:!1,internal:!0});return s.$=i,t[e]=s}function Ns(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===Me||e===qe||(delete n.value,delete n.writable,n.get=()=>t[Me][e]),n}function zn(t){Ht()&&lt(Ct(t,qe),Dn)()}function zs(t){return zn(t),Reflect.ownKeys(t)}const Rs={get(t,e,n){if(e===Gt)return t;if(e===Me)return n;if(e===Wt)return zn(t),n;const s=Ct(t,qe),i=s[e];let l=i?i():t[e];if(e===qe||e===Le||e==="__proto__")return l;if(!i){const r=Object.getOwnPropertyDescriptor(t,e);Ht()&&(typeof l!="function"||t.hasOwnProperty(e))&&!(r&&r.get)&&(l=lt(s,e,l)())}return _t(l)?Nn(l):l},has(t,e){return e===Gt||e===Me||e===Wt||e===qe||e===Le||e==="__proto__"?!0:(Ht()&&lt(Ct(t,Le),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:zs,getOwnPropertyDescriptor:Ns};function Pt(t,e,n,s=!1){if(!s&&t[e]===n)return;const i=t[e],l=t.length;n===void 0?(delete t[e],t[Le]&&t[Le][e]&&i!==void 0&&t[Le][e].$()):(t[e]=n,t[Le]&&t[Le][e]&&i===void 0&&t[Le][e].$());let r=Ct(t,qe),a;if((a=lt(r,e,i))&&a.$(()=>n),Array.isArray(t)&&t.length!==l){for(let o=t.length;o<l;o++)(a=r[o])&&a.$();(a=lt(r,"length",l))&&a.$(t.length)}(a=r[Dn])&&a.$()}function Rn(t,e){const n=Object.keys(e);for(let s=0;s<n.length;s+=1){const i=n[s];Pt(t,i,e[i])}}function Xs(t,e){if(typeof e=="function"&&(e=e(t)),e=it(e),Array.isArray(e)){if(t===e)return;let n=0,s=e.length;for(;n<s;n++){const i=e[n];t[n]!==i&&Pt(t,n,i)}Pt(t,"length",s)}else Rn(t,e)}function tt(t,e,n=[]){let s,i=t;if(e.length>1){s=e.shift();const r=typeof s,a=Array.isArray(t);if(Array.isArray(s)){for(let o=0;o<s.length;o++)tt(t,[s[o]].concat(e),n);return}else if(a&&r==="function"){for(let o=0;o<t.length;o++)s(t[o],o)&&tt(t,[o].concat(e),n);return}else if(a&&r==="object"){const{from:o=0,to:d=t.length-1,by:c=1}=s;for(let h=o;h<=d;h+=c)tt(t,[h].concat(e),n);return}else if(e.length>1){tt(t[s],e,[s].concat(n));return}i=t[s],n=[s].concat(n)}let l=e[0];typeof l=="function"&&(l=l(i,n),l===i)||s===void 0&&l==null||(l=it(l),s===void 0||_t(i)&&_t(l)&&!Array.isArray(l)?Rn(i,l):Pt(t,s,l))}function js(...[t,e]){const n=it(t||{}),s=Array.isArray(n),i=Nn(n);function l(...r){ls(()=>{s&&r.length===1?Xs(n,r[0]):tt(n,r)})}return[i,l]}const Xn={elements:[],viewState:{scale:1,panX:0,panY:0},selectedTool:"selection",selection:[],defaultElementStyles:{strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",roughness:1,renderStyle:"sketch",opacity:100,angle:0,roundness:null,locked:!1,fontFamily:1,fontSize:20,textAlign:"left",startArrowhead:null,endArrowhead:"arrow",seed:0},theme:localStorage.getItem("theme")||"light",layers:[{id:"default-layer",name:"Layer 1",visible:!0,locked:!1,order:0}],activeLayerId:"default-layer",gridSettings:{enabled:!1,snapToGrid:!1,gridSize:20,gridColor:"#e0e0e0",gridOpacity:.5}},[g,j]=js(Xn),He=[],at=[],ke=()=>{const t={elements:JSON.parse(JSON.stringify(g.elements)),layers:JSON.parse(JSON.stringify(g.layers))};He.push(t),He.length>50&&He.shift(),at.length=0},jn=()=>{if(He.length===0)return;const t={elements:JSON.parse(JSON.stringify(g.elements)),layers:JSON.parse(JSON.stringify(g.layers))};at.push(t);const e=He.pop();e&&(j("elements",e.elements),j("layers",e.layers))},Bt=()=>{if(at.length===0)return;const t={elements:JSON.parse(JSON.stringify(g.elements)),layers:JSON.parse(JSON.stringify(g.layers))};He.push(t);const e=at.pop();e&&(j("elements",e.elements),j("layers",e.layers))},qt=t=>{ke(),j("elements",e=>[...e,t])},Ke=t=>{t.length!==0&&(ke(),j("elements",e=>e.filter(n=>!t.includes(n.id))),j("selection",[]))},$e=(t,e,n=!1)=>{n&&ke(),j("elements",s=>s.id===t,e)},Pe=t=>{j("viewState",e=>({...e,...t}))},Ys=t=>{j("selectedTool",t)},Fs=t=>{j("defaultElementStyles",e=>({...e,...t}))},Ws=()=>{He.length=0,at.length=0},Hs=t=>{const e=g.elements.find(l=>l.id===t);if(!e)return;ke();const n=crypto.randomUUID(),s=10/g.viewState.scale,i={...e,id:n,x:e.x+s,y:e.y+s,points:e.points?e.points.map(l=>({...l})):void 0,roundness:e.roundness?{...e.roundness}:null,crop:e.crop?{...e.crop}:null,boundElements:null,groupIds:e.groupIds?[...e.groupIds]:void 0,seed:Math.floor(Math.random()*2147483647)};j("elements",l=>[...l,i]),j("selection",[n])},pt=(t,e)=>{const n=g.elements.findIndex(s=>s.id===t);n!==-1&&(ke(),j("elements",s=>{const i=[...s],l=i.splice(n,1)[0];if(e==="front")i.push(l);else if(e==="back")i.unshift(l);else if(e==="forward"){const r=Math.min(i.length,n+1);i.splice(r,0,l)}else if(e==="backward"){const r=Math.max(0,n-1);i.splice(r,0,l)}return i}))},Vs=()=>{const t=g.theme==="light"?"dark":"light";j("theme",t),localStorage.setItem("theme",t),document.documentElement.setAttribute("data-theme",t)},Us=()=>{if(g.elements.length===0){j("viewState",{scale:1,panX:0,panY:0});return}let t=1/0,e=1/0,n=-1/0,s=-1/0;g.elements.forEach(y=>{t=Math.min(t,y.x),n=Math.max(n,y.x+y.width),e=Math.min(e,y.y),s=Math.max(s,y.y+y.height)});const i=n-t,l=s-e;if(i===0&&l===0){const y=t,$=e,P=window.innerWidth/2,T=window.innerHeight/2;j("viewState",{scale:1,panX:-y+P,panY:-$+T});return}const r=50,a=window.innerWidth,o=window.innerHeight,d=(a-r*2)/i,c=(o-r*2)/l;let h=Math.min(d,c);h=Math.min(Math.max(h,.1),2);const u=t+i/2,p=e+l/2,m=a/2,x=o/2;j("viewState",{scale:h,panX:-u*h+m,panY:-p*h+x})},Gs=t=>{ke();const e=crypto.randomUUID(),n=Math.max(...g.layers.map(i=>i.order),-1),s={id:e,name:`Layer ${g.layers.length+1}`,visible:!0,locked:!1,order:n+1};return j("layers",[...g.layers,s]),j("activeLayerId",e),e},Bs=t=>{if(g.layers.length<=1){alert("Cannot delete the last layer.");return}const e=g.layers.find(s=>s.id===t);if(!e)return;const n=g.elements.filter(s=>s.layerId===t);if(n.length>0){const s=confirm(`Layer "${e.name}" contains ${n.length} element(s).

Click "OK" to delete the layer AND all its elements.
Click "Cancel" to delete the layer but move elements to another layer.`);if(ke(),s)j("elements",g.elements.filter(i=>i.layerId!==t));else{const i=g.layers.find(l=>l.id!==t);i&&g.elements.forEach((l,r)=>{l.layerId===t&&j("elements",r,"layerId",i.id)})}}else ke();j("layers",g.layers.filter(s=>s.id!==t)),g.activeLayerId===t&&j("activeLayerId",g.layers[0]?.id||"default-layer")},Rt=(t,e)=>{const n=g.layers.findIndex(s=>s.id===t);n!==-1&&j("layers",n,e)},qs=t=>{const e=g.layers.find(a=>a.id===t);if(!e)return;ke();const n=crypto.randomUUID(),s={...e,id:n,name:`${e.name} Copy`,order:e.order+.5},l=g.elements.filter(a=>a.layerId===t).map(a=>({...a,id:crypto.randomUUID(),layerId:n,x:a.x+10,y:a.y+10}));j("layers",[...g.layers,s]),j("elements",[...g.elements,...l]),[...g.layers].sort((a,o)=>a.order-o.order).forEach((a,o)=>{const d=g.layers.findIndex(c=>c.id===a.id);j("layers",d,"order",o)}),j("activeLayerId",n)},Ks=(t,e)=>{if(t===e)return;ke();const n=[...g.layers],[s]=n.splice(t,1);n.splice(e,0,s),n.forEach((i,l)=>{i.order=l}),j("layers",n)},Yn=t=>{g.layers.find(n=>n.id===t)&&j("activeLayerId",t)},Zs=()=>{j("gridSettings","enabled",!g.gridSettings.enabled)},Js=()=>{j("gridSettings","snapToGrid",!g.gridSettings.snapToGrid)};document.documentElement.setAttribute("data-theme",Xn.theme);function Kt(t,e,n){if(t&&t.length){const[s,i]=e,l=Math.PI/180*n,r=Math.cos(l),a=Math.sin(l);for(const o of t){const[d,c]=o;o[0]=(d-s)*r-(c-i)*a+s,o[1]=(d-s)*a+(c-i)*r+i}}}function Qs(t,e,n){const s=[];t.forEach(i=>s.push(...i)),Kt(s,e,n)}function ei(t,e){return t[0]===e[0]&&t[1]===e[1]}function ti(t,e,n,s=1){const i=n,l=Math.max(e,.1),r=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,a=[0,0];if(i)for(const d of r)Kt(d,a,i);const o=ni(r,l,s);if(i){for(const d of r)Kt(d,a,-i);Qs(o,a,-i)}return o}function ni(t,e,n){const s=[];for(const d of t){const c=[...d];ei(c[0],c[c.length-1])||c.push([c[0][0],c[0][1]]),c.length>2&&s.push(c)}const i=[];e=Math.max(e,.1);const l=[];for(const d of s)for(let c=0;c<d.length-1;c++){const h=d[c],u=d[c+1];if(h[1]!==u[1]){const p=Math.min(h[1],u[1]);l.push({ymin:p,ymax:Math.max(h[1],u[1]),x:p===h[1]?h[0]:u[0],islope:(u[0]-h[0])/(u[1]-h[1])})}}if(l.sort((d,c)=>d.ymin<c.ymin?-1:d.ymin>c.ymin?1:d.x<c.x?-1:d.x>c.x?1:d.ymax===c.ymax?0:(d.ymax-c.ymax)/Math.abs(d.ymax-c.ymax)),!l.length)return i;let r=[],a=l[0].ymin,o=0;for(;r.length||l.length;){if(l.length){let d=-1;for(let h=0;h<l.length&&!(l[h].ymin>a);h++)d=h;l.splice(0,d+1).forEach(h=>{r.push({s:a,edge:h})})}if(r=r.filter(d=>!(d.edge.ymax<=a)),r.sort((d,c)=>d.edge.x===c.edge.x?0:(d.edge.x-c.edge.x)/Math.abs(d.edge.x-c.edge.x)),(n!==1||o%e===0)&&r.length>1)for(let d=0;d<r.length;d=d+2){const c=d+1;if(c>=r.length)break;const h=r[d].edge,u=r[c].edge;i.push([[Math.round(h.x),a],[Math.round(u.x),a]])}a+=n,r.forEach(d=>{d.edge.x=d.edge.x+n*d.edge.islope}),o++}return i}function ht(t,e){var n;const s=e.hachureAngle+90;let i=e.hachureGap;i<0&&(i=e.strokeWidth*4),i=Math.round(Math.max(i,.1));let l=1;return e.roughness>=1&&(((n=e.randomizer)===null||n===void 0?void 0:n.next())||Math.random())>.7&&(l=i),ti(t,i,s,l||1)}class sn{constructor(e){this.helper=e}fillPolygons(e,n){return this._fillPolygons(e,n)}_fillPolygons(e,n){const s=ht(e,n);return{type:"fillSketch",ops:this.renderLines(s,n)}}renderLines(e,n){const s=[];for(const i of e)s.push(...this.helper.doubleLineOps(i[0][0],i[0][1],i[1][0],i[1][1],n));return s}}function Dt(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}class si extends sn{fillPolygons(e,n){let s=n.hachureGap;s<0&&(s=n.strokeWidth*4),s=Math.max(s,.1);const i=Object.assign({},n,{hachureGap:s}),l=ht(e,i),r=Math.PI/180*n.hachureAngle,a=[],o=s*.5*Math.cos(r),d=s*.5*Math.sin(r);for(const[h,u]of l)Dt([h,u])&&a.push([[h[0]-o,h[1]+d],[...u]],[[h[0]+o,h[1]-d],[...u]]);return{type:"fillSketch",ops:this.renderLines(a,n)}}}class ii extends sn{fillPolygons(e,n){const s=this._fillPolygons(e,n),i=Object.assign({},n,{hachureAngle:n.hachureAngle+90}),l=this._fillPolygons(e,i);return s.ops=s.ops.concat(l.ops),s}}class li{constructor(e){this.helper=e}fillPolygons(e,n){n=Object.assign({},n,{hachureAngle:0});const s=ht(e,n);return this.dotsOnLines(s,n)}dotsOnLines(e,n){const s=[];let i=n.hachureGap;i<0&&(i=n.strokeWidth*4),i=Math.max(i,.1);let l=n.fillWeight;l<0&&(l=n.strokeWidth/2);const r=i/4;for(const a of e){const o=Dt(a),d=o/i,c=Math.ceil(d)-1,h=o-c*i,u=(a[0][0]+a[1][0])/2-i/4,p=Math.min(a[0][1],a[1][1]);for(let m=0;m<c;m++){const x=p+h+m*i,y=u-r+Math.random()*2*r,$=x-r+Math.random()*2*r,P=this.helper.ellipse(y,$,l,l,n);s.push(...P.ops)}}return{type:"fillSketch",ops:s}}}class ai{constructor(e){this.helper=e}fillPolygons(e,n){const s=ht(e,n);return{type:"fillSketch",ops:this.dashedLine(s,n)}}dashedLine(e,n){const s=n.dashOffset<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashOffset,i=n.dashGap<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashGap,l=[];return e.forEach(r=>{const a=Dt(r),o=Math.floor(a/(s+i)),d=(a+i-o*(s+i))/2;let c=r[0],h=r[1];c[0]>h[0]&&(c=r[1],h=r[0]);const u=Math.atan((h[1]-c[1])/(h[0]-c[0]));for(let p=0;p<o;p++){const m=p*(s+i),x=m+s,y=[c[0]+m*Math.cos(u)+d*Math.cos(u),c[1]+m*Math.sin(u)+d*Math.sin(u)],$=[c[0]+x*Math.cos(u)+d*Math.cos(u),c[1]+x*Math.sin(u)+d*Math.sin(u)];l.push(...this.helper.doubleLineOps(y[0],y[1],$[0],$[1],n))}}),l}}class ri{constructor(e){this.helper=e}fillPolygons(e,n){const s=n.hachureGap<0?n.strokeWidth*4:n.hachureGap,i=n.zigzagOffset<0?s:n.zigzagOffset;n=Object.assign({},n,{hachureGap:s+i});const l=ht(e,n);return{type:"fillSketch",ops:this.zigzagLines(l,i,n)}}zigzagLines(e,n,s){const i=[];return e.forEach(l=>{const r=Dt(l),a=Math.round(r/(2*n));let o=l[0],d=l[1];o[0]>d[0]&&(o=l[1],d=l[0]);const c=Math.atan((d[1]-o[1])/(d[0]-o[0]));for(let h=0;h<a;h++){const u=h*2*n,p=(h+1)*2*n,m=Math.sqrt(2*Math.pow(n,2)),x=[o[0]+u*Math.cos(c),o[1]+u*Math.sin(c)],y=[o[0]+p*Math.cos(c),o[1]+p*Math.sin(c)],$=[x[0]+m*Math.cos(c+Math.PI/4),x[1]+m*Math.sin(c+Math.PI/4)];i.push(...this.helper.doubleLineOps(x[0],x[1],$[0],$[1],s),...this.helper.doubleLineOps($[0],$[1],y[0],y[1],s))}}),i}}const ge={};function oi(t,e){let n=t.fillStyle||"hachure";if(!ge[n])switch(n){case"zigzag":ge[n]||(ge[n]=new si(e));break;case"cross-hatch":ge[n]||(ge[n]=new ii(e));break;case"dots":ge[n]||(ge[n]=new li(e));break;case"dashed":ge[n]||(ge[n]=new ai(e));break;case"zigzag-line":ge[n]||(ge[n]=new ri(e));break;default:n="hachure",ge[n]||(ge[n]=new sn(e));break}return ge[n]}function ci(){return Math.floor(Math.random()*2**31)}class di{constructor(e){this.seed=e}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const hi=0,Zt=1,Fn=2,gt={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function ui(t){const e=new Array;for(;t!=="";)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:hi,text:RegExp.$1},t=t.substr(RegExp.$1.length);else if(t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))e[e.length]={type:Zt,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length);else return[];return e[e.length]={type:Fn,text:""},e}function Xt(t,e){return t.type===e}function ln(t){const e=[],n=ui(t);let s="BOD",i=0,l=n[i];for(;!Xt(l,Fn);){let r=0;const a=[];if(s==="BOD")if(l.text==="M"||l.text==="m")i++,r=gt[l.text],s=l.text;else return ln("M0,0"+t);else Xt(l,Zt)?r=gt[s]:(i++,r=gt[l.text],s=l.text);if(i+r<n.length){for(let o=i;o<i+r;o++){const d=n[o];if(Xt(d,Zt))a[a.length]=+d.text;else throw new Error("Param not a number: "+s+","+d.text)}if(typeof gt[s]=="number"){const o={key:s,data:a};e.push(o),i+=r,l=n[i],s==="M"&&(s="L"),s==="m"&&(s="l")}else throw new Error("Bad segment: "+s)}else throw new Error("Path data ended short")}return e}function Wn(t){let e=0,n=0,s=0,i=0;const l=[];for(const{key:r,data:a}of t)switch(r){case"M":l.push({key:"M",data:[...a]}),[e,n]=a,[s,i]=a;break;case"m":e+=a[0],n+=a[1],l.push({key:"M",data:[e,n]}),s=e,i=n;break;case"L":l.push({key:"L",data:[...a]}),[e,n]=a;break;case"l":e+=a[0],n+=a[1],l.push({key:"L",data:[e,n]});break;case"C":l.push({key:"C",data:[...a]}),e=a[4],n=a[5];break;case"c":{const o=a.map((d,c)=>c%2?d+n:d+e);l.push({key:"C",data:o}),e=o[4],n=o[5];break}case"Q":l.push({key:"Q",data:[...a]}),e=a[2],n=a[3];break;case"q":{const o=a.map((d,c)=>c%2?d+n:d+e);l.push({key:"Q",data:o}),e=o[2],n=o[3];break}case"A":l.push({key:"A",data:[...a]}),e=a[5],n=a[6];break;case"a":e+=a[5],n+=a[6],l.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],e,n]});break;case"H":l.push({key:"H",data:[...a]}),e=a[0];break;case"h":e+=a[0],l.push({key:"H",data:[e]});break;case"V":l.push({key:"V",data:[...a]}),n=a[0];break;case"v":n+=a[0],l.push({key:"V",data:[n]});break;case"S":l.push({key:"S",data:[...a]}),e=a[2],n=a[3];break;case"s":{const o=a.map((d,c)=>c%2?d+n:d+e);l.push({key:"S",data:o}),e=o[2],n=o[3];break}case"T":l.push({key:"T",data:[...a]}),e=a[0],n=a[1];break;case"t":e+=a[0],n+=a[1],l.push({key:"T",data:[e,n]});break;case"Z":case"z":l.push({key:"Z",data:[]}),e=s,n=i;break}return l}function Hn(t){const e=[];let n="",s=0,i=0,l=0,r=0,a=0,o=0;for(const{key:d,data:c}of t){switch(d){case"M":e.push({key:"M",data:[...c]}),[s,i]=c,[l,r]=c;break;case"C":e.push({key:"C",data:[...c]}),s=c[4],i=c[5],a=c[2],o=c[3];break;case"L":e.push({key:"L",data:[...c]}),[s,i]=c;break;case"H":s=c[0],e.push({key:"L",data:[s,i]});break;case"V":i=c[0],e.push({key:"L",data:[s,i]});break;case"S":{let h=0,u=0;n==="C"||n==="S"?(h=s+(s-a),u=i+(i-o)):(h=s,u=i),e.push({key:"C",data:[h,u,...c]}),a=c[0],o=c[1],s=c[2],i=c[3];break}case"T":{const[h,u]=c;let p=0,m=0;n==="Q"||n==="T"?(p=s+(s-a),m=i+(i-o)):(p=s,m=i);const x=s+2*(p-s)/3,y=i+2*(m-i)/3,$=h+2*(p-h)/3,P=u+2*(m-u)/3;e.push({key:"C",data:[x,y,$,P,h,u]}),a=p,o=m,s=h,i=u;break}case"Q":{const[h,u,p,m]=c,x=s+2*(h-s)/3,y=i+2*(u-i)/3,$=p+2*(h-p)/3,P=m+2*(u-m)/3;e.push({key:"C",data:[x,y,$,P,p,m]}),a=h,o=u,s=p,i=m;break}case"A":{const h=Math.abs(c[0]),u=Math.abs(c[1]),p=c[2],m=c[3],x=c[4],y=c[5],$=c[6];h===0||u===0?(e.push({key:"C",data:[s,i,y,$,y,$]}),s=y,i=$):(s!==y||i!==$)&&(Vn(s,i,y,$,h,u,p,m,x).forEach(function(T){e.push({key:"C",data:T})}),s=y,i=$);break}case"Z":e.push({key:"Z",data:[]}),s=l,i=r;break}n=d}return e}function fi(t){return Math.PI*t/180}function Qe(t,e,n){const s=t*Math.cos(n)-e*Math.sin(n),i=t*Math.sin(n)+e*Math.cos(n);return[s,i]}function Vn(t,e,n,s,i,l,r,a,o,d){const c=fi(r);let h=[],u=0,p=0,m=0,x=0;if(d)[u,p,m,x]=d;else{[t,e]=Qe(t,e,-c),[n,s]=Qe(n,s,-c);const ie=(t-n)/2,L=(e-s)/2;let I=ie*ie/(i*i)+L*L/(l*l);I>1&&(I=Math.sqrt(I),i=I*i,l=I*l);const U=a===o?-1:1,te=i*i,ae=l*l,xe=te*ae-te*L*L-ae*ie*ie,re=te*L*L+ae*ie*ie,W=U*Math.sqrt(Math.abs(xe/re));m=W*i*L/l+(t+n)/2,x=W*-l*ie/i+(e+s)/2,u=Math.asin(parseFloat(((e-x)/l).toFixed(9))),p=Math.asin(parseFloat(((s-x)/l).toFixed(9))),t<m&&(u=Math.PI-u),n<m&&(p=Math.PI-p),u<0&&(u=Math.PI*2+u),p<0&&(p=Math.PI*2+p),o&&u>p&&(u=u-Math.PI*2),!o&&p>u&&(p=p-Math.PI*2)}let y=p-u;if(Math.abs(y)>Math.PI*120/180){const ie=p,L=n,I=s;o&&p>u?p=u+Math.PI*120/180*1:p=u+Math.PI*120/180*-1,n=m+i*Math.cos(p),s=x+l*Math.sin(p),h=Vn(n,s,L,I,i,l,r,0,o,[p,ie,m,x])}y=p-u;const $=Math.cos(u),P=Math.sin(u),T=Math.cos(p),O=Math.sin(p),R=Math.tan(y/4),N=4/3*i*R,H=4/3*l*R,F=[t,e],Z=[t+N*P,e-H*$],se=[n+N*O,s-H*T],le=[n,s];if(Z[0]=2*F[0]-Z[0],Z[1]=2*F[1]-Z[1],d)return[Z,se,le].concat(h);{h=[Z,se,le].concat(h);const ie=[];for(let L=0;L<h.length;L+=3){const I=Qe(h[L][0],h[L][1],c),U=Qe(h[L+1][0],h[L+1][1],c),te=Qe(h[L+2][0],h[L+2][1],c);ie.push([I[0],I[1],U[0],U[1],te[0],te[1]])}return ie}}const pi={randOffset:vi,randOffsetWithRange:wi,ellipse:mi,doubleLineOps:ki};function Un(t,e,n,s,i){return{type:"path",ops:ze(t,e,n,s,i)}}function wt(t,e,n){const s=(t||[]).length;if(s>2){const i=[];for(let l=0;l<s-1;l++)i.push(...ze(t[l][0],t[l][1],t[l+1][0],t[l+1][1],n));return e&&i.push(...ze(t[s-1][0],t[s-1][1],t[0][0],t[0][1],n)),{type:"path",ops:i}}else if(s===2)return Un(t[0][0],t[0][1],t[1][0],t[1][1],n);return{type:"path",ops:[]}}function gi(t,e){return wt(t,!0,e)}function yi(t,e,n,s,i){const l=[[t,e],[t+n,e],[t+n,e+s],[t,e+s]];return gi(l,i)}function pn(t,e){if(t.length){const s=typeof t[0][0]=="number"?[t]:t,i=yt(s[0],1*(1+e.roughness*.2),e),l=e.disableMultiStroke?[]:yt(s[0],1.5*(1+e.roughness*.22),mn(e));for(let r=1;r<s.length;r++){const a=s[r];if(a.length){const o=yt(a,1*(1+e.roughness*.2),e),d=e.disableMultiStroke?[]:yt(a,1.5*(1+e.roughness*.22),mn(e));for(const c of o)c.op!=="move"&&i.push(c);for(const c of d)c.op!=="move"&&l.push(c)}}return{type:"path",ops:i.concat(l)}}return{type:"path",ops:[]}}function mi(t,e,n,s,i){const l=Gn(n,s,i);return Jt(t,e,i,l).opset}function Gn(t,e,n){const s=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),i=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*s)),l=Math.PI*2/i;let r=Math.abs(t/2),a=Math.abs(e/2);const o=1-n.curveFitting;return r+=X(r*o,n),a+=X(a*o,n),{increment:l,rx:r,ry:a}}function Jt(t,e,n,s){const[i,l]=bn(s.increment,t,e,s.rx,s.ry,1,s.increment*Tt(.1,Tt(.4,1,n),n),n);let r=Ot(i,null,n);if(!n.disableMultiStroke&&n.roughness!==0){const[a]=bn(s.increment,t,e,s.rx,s.ry,1.5,0,n),o=Ot(a,null,n);r=r.concat(o)}return{estimatedPoints:l,opset:{type:"path",ops:r}}}function gn(t,e,n,s,i,l,r,a,o){const d=t,c=e;let h=Math.abs(n/2),u=Math.abs(s/2);h+=X(h*.01,o),u+=X(u*.01,o);let p=i,m=l;for(;p<0;)p+=Math.PI*2,m+=Math.PI*2;m-p>Math.PI*2&&(p=0,m=Math.PI*2);const x=Math.PI*2/o.curveStepCount,y=Math.min(x/2,(m-p)/2),$=vn(y,d,c,h,u,p,m,1,o);if(!o.disableMultiStroke){const P=vn(y,d,c,h,u,p,m,1.5,o);$.push(...P)}return r&&(a?$.push(...ze(d,c,d+h*Math.cos(p),c+u*Math.sin(p),o),...ze(d,c,d+h*Math.cos(m),c+u*Math.sin(m),o)):$.push({op:"lineTo",data:[d,c]},{op:"lineTo",data:[d+h*Math.cos(p),c+u*Math.sin(p)]})),{type:"path",ops:$}}function yn(t,e){const n=Hn(Wn(ln(t))),s=[];let i=[0,0],l=[0,0];for(const{key:r,data:a}of n)switch(r){case"M":{l=[a[0],a[1]],i=[a[0],a[1]];break}case"L":s.push(...ze(l[0],l[1],a[0],a[1],e)),l=[a[0],a[1]];break;case"C":{const[o,d,c,h,u,p]=a;s.push(...xi(o,d,c,h,u,p,l,e)),l=[u,p];break}case"Z":s.push(...ze(l[0],l[1],i[0],i[1],e)),l=[i[0],i[1]];break}return{type:"path",ops:s}}function jt(t,e){const n=[];for(const s of t)if(s.length){const i=e.maxRandomnessOffset||0,l=s.length;if(l>2){n.push({op:"move",data:[s[0][0]+X(i,e),s[0][1]+X(i,e)]});for(let r=1;r<l;r++)n.push({op:"lineTo",data:[s[r][0]+X(i,e),s[r][1]+X(i,e)]})}}return{type:"fillPath",ops:n}}function Be(t,e){return oi(e,pi).fillPolygons(t,e)}function bi(t,e,n,s,i,l,r){const a=t,o=e;let d=Math.abs(n/2),c=Math.abs(s/2);d+=X(d*.01,r),c+=X(c*.01,r);let h=i,u=l;for(;h<0;)h+=Math.PI*2,u+=Math.PI*2;u-h>Math.PI*2&&(h=0,u=Math.PI*2);const p=(u-h)/r.curveStepCount,m=[];for(let x=h;x<=u;x=x+p)m.push([a+d*Math.cos(x),o+c*Math.sin(x)]);return m.push([a+d*Math.cos(u),o+c*Math.sin(u)]),m.push([a,o]),Be([m],r)}function vi(t,e){return X(t,e)}function wi(t,e,n){return Tt(t,e,n)}function ki(t,e,n,s,i){return ze(t,e,n,s,i,!0)}function mn(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}function Bn(t){return t.randomizer||(t.randomizer=new di(t.seed||0)),t.randomizer.next()}function Tt(t,e,n,s=1){return n.roughness*s*(Bn(n)*(e-t)+t)}function X(t,e,n=1){return Tt(-t,t,e,n)}function ze(t,e,n,s,i,l=!1){const r=l?i.disableMultiStrokeFill:i.disableMultiStroke,a=Qt(t,e,n,s,i,!0,!1);if(r)return a;const o=Qt(t,e,n,s,i,!0,!0);return a.concat(o)}function Qt(t,e,n,s,i,l,r){const a=Math.pow(t-n,2)+Math.pow(e-s,2),o=Math.sqrt(a);let d=1;o<200?d=1:o>500?d=.4:d=-.0016668*o+1.233334;let c=i.maxRandomnessOffset||0;c*c*100>a&&(c=o/10);const h=c/2,u=.2+Bn(i)*.2;let p=i.bowing*i.maxRandomnessOffset*(s-e)/200,m=i.bowing*i.maxRandomnessOffset*(t-n)/200;p=X(p,i,d),m=X(m,i,d);const x=[],y=()=>X(h,i,d),$=()=>X(c,i,d),P=i.preserveVertices;return r?x.push({op:"move",data:[t+(P?0:y()),e+(P?0:y())]}):x.push({op:"move",data:[t+(P?0:X(c,i,d)),e+(P?0:X(c,i,d))]}),r?x.push({op:"bcurveTo",data:[p+t+(n-t)*u+y(),m+e+(s-e)*u+y(),p+t+2*(n-t)*u+y(),m+e+2*(s-e)*u+y(),n+(P?0:y()),s+(P?0:y())]}):x.push({op:"bcurveTo",data:[p+t+(n-t)*u+$(),m+e+(s-e)*u+$(),p+t+2*(n-t)*u+$(),m+e+2*(s-e)*u+$(),n+(P?0:$()),s+(P?0:$())]}),x}function yt(t,e,n){if(!t.length)return[];const s=[];s.push([t[0][0]+X(e,n),t[0][1]+X(e,n)]),s.push([t[0][0]+X(e,n),t[0][1]+X(e,n)]);for(let i=1;i<t.length;i++)s.push([t[i][0]+X(e,n),t[i][1]+X(e,n)]),i===t.length-1&&s.push([t[i][0]+X(e,n),t[i][1]+X(e,n)]);return Ot(s,null,n)}function Ot(t,e,n){const s=t.length,i=[];if(s>3){const l=[],r=1-n.curveTightness;i.push({op:"move",data:[t[1][0],t[1][1]]});for(let a=1;a+2<s;a++){const o=t[a];l[0]=[o[0],o[1]],l[1]=[o[0]+(r*t[a+1][0]-r*t[a-1][0])/6,o[1]+(r*t[a+1][1]-r*t[a-1][1])/6],l[2]=[t[a+1][0]+(r*t[a][0]-r*t[a+2][0])/6,t[a+1][1]+(r*t[a][1]-r*t[a+2][1])/6],l[3]=[t[a+1][0],t[a+1][1]],i.push({op:"bcurveTo",data:[l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1]]})}}else s===3?(i.push({op:"move",data:[t[1][0],t[1][1]]}),i.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):s===2&&i.push(...Qt(t[0][0],t[0][1],t[1][0],t[1][1],n,!0,!0));return i}function bn(t,e,n,s,i,l,r,a){const o=a.roughness===0,d=[],c=[];if(o){t=t/4,c.push([e+s*Math.cos(-t),n+i*Math.sin(-t)]);for(let h=0;h<=Math.PI*2;h=h+t){const u=[e+s*Math.cos(h),n+i*Math.sin(h)];d.push(u),c.push(u)}c.push([e+s*Math.cos(0),n+i*Math.sin(0)]),c.push([e+s*Math.cos(t),n+i*Math.sin(t)])}else{const h=X(.5,a)-Math.PI/2;c.push([X(l,a)+e+.9*s*Math.cos(h-t),X(l,a)+n+.9*i*Math.sin(h-t)]);const u=Math.PI*2+h-.01;for(let p=h;p<u;p=p+t){const m=[X(l,a)+e+s*Math.cos(p),X(l,a)+n+i*Math.sin(p)];d.push(m),c.push(m)}c.push([X(l,a)+e+s*Math.cos(h+Math.PI*2+r*.5),X(l,a)+n+i*Math.sin(h+Math.PI*2+r*.5)]),c.push([X(l,a)+e+.98*s*Math.cos(h+r),X(l,a)+n+.98*i*Math.sin(h+r)]),c.push([X(l,a)+e+.9*s*Math.cos(h+r*.5),X(l,a)+n+.9*i*Math.sin(h+r*.5)])}return[c,d]}function vn(t,e,n,s,i,l,r,a,o){const d=l+X(.1,o),c=[];c.push([X(a,o)+e+.9*s*Math.cos(d-t),X(a,o)+n+.9*i*Math.sin(d-t)]);for(let h=d;h<=r;h=h+t)c.push([X(a,o)+e+s*Math.cos(h),X(a,o)+n+i*Math.sin(h)]);return c.push([e+s*Math.cos(r),n+i*Math.sin(r)]),c.push([e+s*Math.cos(r),n+i*Math.sin(r)]),Ot(c,null,o)}function xi(t,e,n,s,i,l,r,a){const o=[],d=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.3];let c=[0,0];const h=a.disableMultiStroke?1:2,u=a.preserveVertices;for(let p=0;p<h;p++)p===0?o.push({op:"move",data:[r[0],r[1]]}):o.push({op:"move",data:[r[0]+(u?0:X(d[0],a)),r[1]+(u?0:X(d[0],a))]}),c=u?[i,l]:[i+X(d[p],a),l+X(d[p],a)],o.push({op:"bcurveTo",data:[t+X(d[p],a),e+X(d[p],a),n+X(d[p],a),s+X(d[p],a),c[0],c[1]]});return o}function et(t){return[...t]}function wn(t,e=0){const n=t.length;if(n<3)throw new Error("A curve must have at least three points.");const s=[];if(n===3)s.push(et(t[0]),et(t[1]),et(t[2]),et(t[2]));else{const i=[];i.push(t[0],t[0]);for(let a=1;a<t.length;a++)i.push(t[a]),a===t.length-1&&i.push(t[a]);const l=[],r=1-e;s.push(et(i[0]));for(let a=1;a+2<i.length;a++){const o=i[a];l[0]=[o[0],o[1]],l[1]=[o[0]+(r*i[a+1][0]-r*i[a-1][0])/6,o[1]+(r*i[a+1][1]-r*i[a-1][1])/6],l[2]=[i[a+1][0]+(r*i[a][0]-r*i[a+2][0])/6,i[a+1][1]+(r*i[a][1]-r*i[a+2][1])/6],l[3]=[i[a+1][0],i[a+1][1]],s.push(l[1],l[2],l[3])}}return s}function $i(t,e){return Math.sqrt(kt(t,e))}function kt(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function Si(t,e,n){const s=kt(e,n);if(s===0)return kt(t,e);let i=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/s;return i=Math.max(0,Math.min(1,i)),kt(t,Fe(e,n,i))}function Fe(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function Mi(t,e){const n=t[e+0],s=t[e+1],i=t[e+2],l=t[e+3];let r=3*s[0]-2*n[0]-l[0];r*=r;let a=3*s[1]-2*n[1]-l[1];a*=a;let o=3*i[0]-2*l[0]-n[0];o*=o;let d=3*i[1]-2*l[1]-n[1];return d*=d,r<o&&(r=o),a<d&&(a=d),r+a}function en(t,e,n,s){const i=s||[];if(Mi(t,e)<n){const l=t[e+0];i.length?$i(i[i.length-1],l)>1&&i.push(l):i.push(l),i.push(t[e+3])}else{const r=t[e+0],a=t[e+1],o=t[e+2],d=t[e+3],c=Fe(r,a,.5),h=Fe(a,o,.5),u=Fe(o,d,.5),p=Fe(c,h,.5),m=Fe(h,u,.5),x=Fe(p,m,.5);en([r,c,p,x],0,n,i),en([x,m,u,d],0,n,i)}return i}function _i(t,e){return Et(t,0,t.length,e)}function Et(t,e,n,s,i){const l=i||[],r=t[e],a=t[n-1];let o=0,d=1;for(let c=e+1;c<n-1;++c){const h=Si(t[c],r,a);h>o&&(o=h,d=c)}return Math.sqrt(o)>s?(Et(t,e,d+1,s,l),Et(t,d,n,s,l)):(l.length||l.push(r),l.push(a)),l}function tn(t,e=.15,n){const s=[],i=(t.length-1)/3;for(let l=0;l<i;l++){const r=l*3;en(t,r,e,s)}return n&&n>0?Et(s,0,s.length,n):s}function Ci(t,e,n){const s=ln(t),i=Hn(Wn(s)),l=[];let r=[],a=[0,0],o=[];const d=()=>{o.length>=4&&r.push(...tn(o,e)),o=[]},c=()=>{d(),r.length&&(l.push(r),r=[])};for(const{key:u,data:p}of i)switch(u){case"M":c(),a=[p[0],p[1]],r.push(a);break;case"L":d(),r.push([p[0],p[1]]);break;case"C":if(!o.length){const m=r.length?r[r.length-1]:a;o.push([m[0],m[1]])}o.push([p[0],p[1]]),o.push([p[2],p[3]]),o.push([p[4],p[5]]);break;case"Z":d(),r.push([a[0],a[1]]);break}if(c(),!n)return l;const h=[];for(const u of l){const p=_i(u,n);p.length&&h.push(p)}return h}const me="none";class Lt{constructor(e){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=e||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return ci()}_o(e){return e?Object.assign({},this.defaultOptions,e):this.defaultOptions}_d(e,n,s){return{shape:e,sets:n||[],options:s||this.defaultOptions}}line(e,n,s,i,l){const r=this._o(l);return this._d("line",[Un(e,n,s,i,r)],r)}rectangle(e,n,s,i,l){const r=this._o(l),a=[],o=yi(e,n,s,i,r);if(r.fill){const d=[[e,n],[e+s,n],[e+s,n+i],[e,n+i]];r.fillStyle==="solid"?a.push(jt([d],r)):a.push(Be([d],r))}return r.stroke!==me&&a.push(o),this._d("rectangle",a,r)}ellipse(e,n,s,i,l){const r=this._o(l),a=[],o=Gn(s,i,r),d=Jt(e,n,r,o);if(r.fill)if(r.fillStyle==="solid"){const c=Jt(e,n,r,o).opset;c.type="fillPath",a.push(c)}else a.push(Be([d.estimatedPoints],r));return r.stroke!==me&&a.push(d.opset),this._d("ellipse",a,r)}circle(e,n,s,i){const l=this.ellipse(e,n,s,s,i);return l.shape="circle",l}linearPath(e,n){const s=this._o(n);return this._d("linearPath",[wt(e,!1,s)],s)}arc(e,n,s,i,l,r,a=!1,o){const d=this._o(o),c=[],h=gn(e,n,s,i,l,r,a,!0,d);if(a&&d.fill)if(d.fillStyle==="solid"){const u=Object.assign({},d);u.disableMultiStroke=!0;const p=gn(e,n,s,i,l,r,!0,!1,u);p.type="fillPath",c.push(p)}else c.push(bi(e,n,s,i,l,r,d));return d.stroke!==me&&c.push(h),this._d("arc",c,d)}curve(e,n){const s=this._o(n),i=[],l=pn(e,s);if(s.fill&&s.fill!==me)if(s.fillStyle==="solid"){const r=pn(e,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(r.ops)})}else{const r=[],a=e;if(a.length){const d=typeof a[0][0]=="number"?[a]:a;for(const c of d)c.length<3?r.push(...c):c.length===3?r.push(...tn(wn([c[0],c[0],c[1],c[2]]),10,(1+s.roughness)/2)):r.push(...tn(wn(c),10,(1+s.roughness)/2))}r.length&&i.push(Be([r],s))}return s.stroke!==me&&i.push(l),this._d("curve",i,s)}polygon(e,n){const s=this._o(n),i=[],l=wt(e,!0,s);return s.fill&&(s.fillStyle==="solid"?i.push(jt([e],s)):i.push(Be([e],s))),s.stroke!==me&&i.push(l),this._d("polygon",i,s)}path(e,n){const s=this._o(n),i=[];if(!e)return this._d("path",i,s);e=(e||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const l=s.fill&&s.fill!=="transparent"&&s.fill!==me,r=s.stroke!==me,a=!!(s.simplification&&s.simplification<1),o=a?4-4*(s.simplification||1):(1+s.roughness)/2,d=Ci(e,1,o),c=yn(e,s);if(l)if(s.fillStyle==="solid")if(d.length===1){const h=yn(e,Object.assign(Object.assign({},s),{disableMultiStroke:!0,roughness:s.roughness?s.roughness+s.fillShapeRoughnessGain:0}));i.push({type:"fillPath",ops:this._mergedShape(h.ops)})}else i.push(jt(d,s));else i.push(Be(d,s));return r&&(a?d.forEach(h=>{i.push(wt(h,!1,s))}):i.push(c)),this._d("path",i,s)}opsToPath(e,n){let s="";for(const i of e.ops){const l=typeof n=="number"&&n>=0?i.data.map(r=>+r.toFixed(n)):i.data;switch(i.op){case"move":s+=`M${l[0]} ${l[1]} `;break;case"bcurveTo":s+=`C${l[0]} ${l[1]}, ${l[2]} ${l[3]}, ${l[4]} ${l[5]} `;break;case"lineTo":s+=`L${l[0]} ${l[1]} `;break}}return s.trim()}toPaths(e){const n=e.sets||[],s=e.options||this.defaultOptions,i=[];for(const l of n){let r=null;switch(l.type){case"path":r={d:this.opsToPath(l),stroke:s.stroke,strokeWidth:s.strokeWidth,fill:me};break;case"fillPath":r={d:this.opsToPath(l),stroke:me,strokeWidth:0,fill:s.fill||me};break;case"fillSketch":r=this.fillSketch(l,s);break}r&&i.push(r)}return i}fillSketch(e,n){let s=n.fillWeight;return s<0&&(s=n.strokeWidth/2),{d:this.opsToPath(e),stroke:n.fill||me,strokeWidth:s,fill:me}}_mergedShape(e){return e.filter((n,s)=>s===0?!0:n.op!=="move")}}class Pi{constructor(e,n){this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gen=new Lt(n)}draw(e){const n=e.sets||[],s=e.options||this.getDefaultOptions(),i=this.ctx,l=e.options.fixedDecimalPlaceDigits;for(const r of n)switch(r.type){case"path":i.save(),i.strokeStyle=s.stroke==="none"?"transparent":s.stroke,i.lineWidth=s.strokeWidth,s.strokeLineDash&&i.setLineDash(s.strokeLineDash),s.strokeLineDashOffset&&(i.lineDashOffset=s.strokeLineDashOffset),this._drawToContext(i,r,l),i.restore();break;case"fillPath":{i.save(),i.fillStyle=s.fill||"";const a=e.shape==="curve"||e.shape==="polygon"||e.shape==="path"?"evenodd":"nonzero";this._drawToContext(i,r,l,a),i.restore();break}case"fillSketch":this.fillSketch(i,r,s);break}}fillSketch(e,n,s){let i=s.fillWeight;i<0&&(i=s.strokeWidth/2),e.save(),s.fillLineDash&&e.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(e.lineDashOffset=s.fillLineDashOffset),e.strokeStyle=s.fill||"",e.lineWidth=i,this._drawToContext(e,n,s.fixedDecimalPlaceDigits),e.restore()}_drawToContext(e,n,s,i="nonzero"){e.beginPath();for(const l of n.ops){const r=typeof s=="number"&&s>=0?l.data.map(a=>+a.toFixed(s)):l.data;switch(l.op){case"move":e.moveTo(r[0],r[1]);break;case"bcurveTo":e.bezierCurveTo(r[0],r[1],r[2],r[3],r[4],r[5]);break;case"lineTo":e.lineTo(r[0],r[1]);break}}n.type==="fillPath"?e.fill(i):e.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(e,n,s,i,l){const r=this.gen.line(e,n,s,i,l);return this.draw(r),r}rectangle(e,n,s,i,l){const r=this.gen.rectangle(e,n,s,i,l);return this.draw(r),r}ellipse(e,n,s,i,l){const r=this.gen.ellipse(e,n,s,i,l);return this.draw(r),r}circle(e,n,s,i){const l=this.gen.circle(e,n,s,i);return this.draw(l),l}linearPath(e,n){const s=this.gen.linearPath(e,n);return this.draw(s),s}polygon(e,n){const s=this.gen.polygon(e,n);return this.draw(s),s}arc(e,n,s,i,l,r,a=!1,o){const d=this.gen.arc(e,n,s,i,l,r,a,o);return this.draw(d),d}curve(e,n){const s=this.gen.curve(e,n);return this.draw(s),s}path(e,n){const s=this.gen.path(e,n);return this.draw(s),s}}const mt="http://www.w3.org/2000/svg";class Ti{constructor(e,n){this.svg=e,this.gen=new Lt(n)}draw(e){const n=e.sets||[],s=e.options||this.getDefaultOptions(),i=this.svg.ownerDocument||window.document,l=i.createElementNS(mt,"g"),r=e.options.fixedDecimalPlaceDigits;for(const a of n){let o=null;switch(a.type){case"path":{o=i.createElementNS(mt,"path"),o.setAttribute("d",this.opsToPath(a,r)),o.setAttribute("stroke",s.stroke),o.setAttribute("stroke-width",s.strokeWidth+""),o.setAttribute("fill","none"),s.strokeLineDash&&o.setAttribute("stroke-dasharray",s.strokeLineDash.join(" ").trim()),s.strokeLineDashOffset&&o.setAttribute("stroke-dashoffset",`${s.strokeLineDashOffset}`);break}case"fillPath":{o=i.createElementNS(mt,"path"),o.setAttribute("d",this.opsToPath(a,r)),o.setAttribute("stroke","none"),o.setAttribute("stroke-width","0"),o.setAttribute("fill",s.fill||""),(e.shape==="curve"||e.shape==="polygon")&&o.setAttribute("fill-rule","evenodd");break}case"fillSketch":{o=this.fillSketch(i,a,s);break}}o&&l.appendChild(o)}return l}fillSketch(e,n,s){let i=s.fillWeight;i<0&&(i=s.strokeWidth/2);const l=e.createElementNS(mt,"path");return l.setAttribute("d",this.opsToPath(n,s.fixedDecimalPlaceDigits)),l.setAttribute("stroke",s.fill||""),l.setAttribute("stroke-width",i+""),l.setAttribute("fill","none"),s.fillLineDash&&l.setAttribute("stroke-dasharray",s.fillLineDash.join(" ").trim()),s.fillLineDashOffset&&l.setAttribute("stroke-dashoffset",`${s.fillLineDashOffset}`),l}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(e,n){return this.gen.opsToPath(e,n)}line(e,n,s,i,l){const r=this.gen.line(e,n,s,i,l);return this.draw(r)}rectangle(e,n,s,i,l){const r=this.gen.rectangle(e,n,s,i,l);return this.draw(r)}ellipse(e,n,s,i,l){const r=this.gen.ellipse(e,n,s,i,l);return this.draw(r)}circle(e,n,s,i){const l=this.gen.circle(e,n,s,i);return this.draw(l)}linearPath(e,n){const s=this.gen.linearPath(e,n);return this.draw(s)}polygon(e,n){const s=this.gen.polygon(e,n);return this.draw(s)}arc(e,n,s,i,l,r,a=!1,o){const d=this.gen.arc(e,n,s,i,l,r,a,o);return this.draw(d)}curve(e,n){const s=this.gen.curve(e,n);return this.draw(s)}path(e,n){const s=this.gen.path(e,n);return this.draw(s)}}const an={canvas(t,e){return new Pi(t,e)},svg(t,e){return new Ti(t,e)},generator(t){return new Lt(t)},newSeed(){return Lt.newSeed()}},qn=(t,e,n)=>{const s=t.x,i=t.y,l=e.x,r=e.y,a=n.x,o=n.y,d=s-l,c=i-r,h=a-l,u=o-r,p=d*h+c*u,m=h*h+u*u;let x=-1;m!==0&&(x=p/m);let y,$;x<0?(y=l,$=r):x>1?(y=a,$=o):(y=l+x*h,$=r+x*u);const P=s-y,T=i-$;return Math.sqrt(P*P+T*T)},Oi=(t,e,n)=>{if(e.length<2)return!1;for(let s=0;s<e.length-1;s++)if(qn(t,e[s],e[s+1])<=n)return!0;return!1},Ei=(t,e,n,s,i)=>{const l=Math.abs(s/2),r=Math.abs(i/2),a=e+s/2,o=n+i/2;return l<=0||r<=0?!1:Math.pow(t.x-a,2)/Math.pow(l,2)+Math.pow(t.y-o,2)/Math.pow(r,2)<=1},Yt=new Map,bt=new Set,Li=t=>{if(Yt.has(t))return Yt.get(t);if(!bt.has(t)){bt.add(t);const e=new Image;e.src=t,e.onload=()=>{Yt.set(t,e),bt.delete(t)},e.onerror=()=>{bt.delete(t)}}return null},Kn=(t,e,n)=>{e.save(),e.globalAlpha=(n.opacity??100)/100;const s=n.x+n.width/2,i=n.y+n.height/2;n.angle&&(e.translate(s,i),e.rotate(n.angle),e.translate(-s,-i));const l={seed:n.seed,roughness:n.roughness,stroke:n.strokeColor,strokeWidth:n.strokeWidth,fill:n.backgroundColor==="transparent"?void 0:n.backgroundColor,fillStyle:n.fillStyle,strokeLineDash:n.strokeStyle==="dashed"?[10,10]:n.strokeStyle==="dotted"?[5,10]:void 0};if(n.type==="rectangle")t.rectangle(n.x,n.y,n.width,n.height,l);else if(n.type==="circle")t.ellipse(n.x+n.width/2,n.y+n.height/2,Math.abs(n.width),Math.abs(n.height),l);else if(n.type==="line"||n.type==="arrow"){const r=n.x+n.width,a=n.y+n.height;if(t.line(n.x,n.y,r,a,l),n.type==="arrow"){const o=Math.atan2(n.height,n.width),d=15,c={x:r-d*Math.cos(o-Math.PI/6),y:a-d*Math.sin(o-Math.PI/6)},h={x:r-d*Math.cos(o+Math.PI/6),y:a-d*Math.sin(o+Math.PI/6)};t.line(r,a,c.x,c.y,l),t.line(r,a,h.x,h.y,l)}}else if(n.type==="pencil"&&n.points&&n.points.length>0){const r=n.points.map(a=>[n.x+a.x,n.y+a.y]);t.linearPath(r,l)}else if(n.type==="image"&&n.dataURL){const r=Li(n.dataURL);r?e.drawImage(r,n.x,n.y,n.width,n.height):(e.save(),e.fillStyle="#e5e5e5",e.fillRect(n.x,n.y,n.width,n.height),e.fillStyle="#999",e.font="12px sans-serif",e.fillText("Loading image...",n.x+10,n.y+20),e.restore())}else if(n.type==="text"&&n.text){const r=n.fontSize||20;e.font=`${r}px sans-serif`;const o=e.measureText(n.text).width,d=n.width&&o?n.width/o:1;e.fillStyle=n.strokeColor,d!==1?(e.save(),e.translate(n.x,n.y),e.scale(d,1),e.fillText(n.text,0,r),e.restore()):e.fillText(n.text,n.x,n.y+r)}e.restore()};var Ai=Y("<div class=context-menu>"),Ii=Y("<span class=menu-item-shortcut>"),Di=Y("<button><span class=menu-item-check></span><span class=menu-item-label>"),Ni=Y("<div class=context-menu-separator>");const zi=t=>{let e;const[n,s]=ee({x:t.x,y:t.y});rt(()=>{if(e){const a=e.getBoundingClientRect(),o=window.innerWidth,d=window.innerHeight;let c=t.x,h=t.y;t.x+a.width>o&&(c=o-a.width-10),t.y+a.height>d&&(h=d-a.height-10),s({x:c,y:h})}const l=a=>{e&&!e.contains(a.target)&&t.onClose()},r=a=>{a.key==="Escape"&&t.onClose()};document.addEventListener("mousedown",l),document.addEventListener("keydown",r),ot(()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",r)})});const i=l=>{!l.disabled&&!l.separator&&(l.onClick(),t.onClose())};return(()=>{var l=Ai(),r=e;return typeof r=="function"?Ve(r,l):e=l,C(l,k(Ae,{get each(){return t.items},children:a=>k(fe,{get when(){return!a.separator},get fallback(){return Ni()},get children(){var o=Di(),d=o.firstChild,c=d.nextSibling;return o.$$click=()=>i(a),C(d,()=>a.checked?"":""),C(c,()=>a.label),C(o,k(fe,{get when(){return a.shortcut},get children(){var h=Ii();return C(h,()=>a.shortcut),h}}),null),Q(h=>{var u=`context-menu-item ${a.disabled?"disabled":""}`,p=a.disabled;return u!==h.e&&ve(o,h.e=u),p!==h.t&&(o.disabled=h.t=p),h},{e:void 0,t:void 0}),o}})})),Q(a=>{var o=`${n().x}px`,d=`${n().y}px`;return o!==a.e&&Ne(l,"left",a.e=o),d!==a.t&&Ne(l,"top",a.t=d),a},{e:void 0,t:void 0}),l})()};_e(["click"]);const kn=(t,e)=>Math.round(t/e)*e,Ft=(t,e,n)=>({x:kn(t,n),y:kn(e,n)});var Ri=Y("<canvas style=display:block;touch-action:none>"),Xi=Y('<div style=position:fixed;bottom:30px;left:50%;transform:translateX(-50%);z-index:100><button style="background-color:white;border:1px solid #e5e7eb;padding:8px 16px;border-radius:9999px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);cursor:pointer;color:#3b82f6;font-weight:500;font-size:14px;transition:all 0.2s">Scroll back to content'),ji=Y('<textarea style="position:absolute;background:transparent;border:1px dashed #007acc;outline:none;margin:0;padding:0;resize:none;overflow:hidden;min-width:50px;min-height:1em">');const Yi=()=>{We(()=>{const f=g.selection;if(f.length>0){let v=null,_=-1/0;f.forEach(S=>{const A=g.elements.find(w=>w.id===S);if(A){const w=g.layers.find(b=>b.id===A.layerId);w&&w.order>_&&(_=w.order,v=w.id)}}),v&&v!==g.activeLayerId&&Yn(v)}});let t,e=!1,n=null,s=0,i=0;const[l,r]=ee(null),[a,o]=ee("");let d,c=!1,h=!1,u=null;const[p,m]=ee(null);let x=new Map,y=0,$=0,P=0,T=0,O,R=20;const N=()=>{t&&(t.width=window.innerWidth,t.height=window.innerHeight,L())},[H,F]=ee("default"),[Z,se]=ee(!1),[le,ie]=ee({x:0,y:0}),L=()=>{if(!t)return;const f=t.getContext("2d");if(!f)return;f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,t.width,t.height),f.fillStyle="#fafafa",f.fillRect(0,0,t.width,t.height),f.save();const{scale:v,panX:_,panY:S}=g.viewState;if(f.translate(_,S),f.scale(v,v),g.gridSettings.enabled){const b=g.gridSettings.gridSize,M=g.gridSettings.gridColor,E=g.gridSettings.gridOpacity;f.save(),f.setTransform(1,0,0,1,0,0),f.strokeStyle=M,f.globalAlpha=E,f.lineWidth=1;const z=Math.floor(-_/v/b)*b,D=Math.ceil((t.width-_)/v/b)*b,V=Math.floor(-S/v/b)*b,K=Math.ceil((t.height-S)/v/b)*b;f.beginPath();for(let B=z;B<=D;B+=b){const oe=B*v+_;f.moveTo(oe,0),f.lineTo(oe,t.height)}for(let B=V;B<=K;B+=b){const oe=B*v+S;f.moveTo(0,oe),f.lineTo(t.width,oe)}f.stroke(),f.restore(),f.translate(_,S),f.scale(v,v)}g.elements.map(b=>{const M=g.layers.find(E=>E.id===b.layerId);return{element:b,layer:M}}).filter(({layer:b})=>b?.visible!==!1).sort((b,M)=>{const E=(b.layer?.order??999)-(M.layer?.order??999);return E!==0?E:g.elements.indexOf(b.element)-g.elements.indexOf(M.element)}).forEach(({element:b})=>{let M=b.x+b.width/2,E=b.y+b.height/2;if(b.type!=="text"||l()!==b.id){const z=an.canvas(t);Kn(z,f,b)}if(g.selection.includes(b.id)){f.save(),b.angle&&(f.translate(M,E),f.rotate(b.angle),f.translate(-M,-E)),f.strokeStyle="#3b82f6",f.lineWidth=1/v;const z=2/v;if(f.strokeRect(b.x-z,b.y-z,b.width+z*2,b.height+z*2),g.selection.length===1){const D=8/v;f.fillStyle="#ffffff",f.strokeStyle="#3b82f6",f.lineWidth=2/v,[{x:b.x-z,y:b.y-z},{x:b.x+b.width+z,y:b.y-z},{x:b.x+b.width+z,y:b.y+b.height+z},{x:b.x-z,y:b.y+b.height+z},{x:b.x+b.width/2,y:b.y-z},{x:b.x+b.width+z,y:b.y+b.height/2},{x:b.x+b.width/2,y:b.y+b.height+z},{x:b.x-z,y:b.y+b.height/2}].forEach(B=>{f.fillRect(B.x-D/2,B.y-D/2,D,D),f.strokeRect(B.x-D/2,B.y-D/2,D,D)});const K={x:b.x+b.width/2,y:b.y-z-20/v};f.beginPath(),f.moveTo(b.x+b.width/2,b.y-z),f.lineTo(K.x,K.y),f.stroke(),f.beginPath(),f.arc(K.x,K.y,D/2,0,2*Math.PI),f.fill(),f.stroke(),f.stroke(),f.restore()}else f.restore()}});const w=p();w&&(f.save(),f.fillStyle="rgba(59, 130, 246, 0.2)",f.strokeStyle="#3b82f6",f.lineWidth=1/v,f.fillRect(w.x,w.y,w.w,w.h),f.strokeRect(w.x,w.y,w.w,w.h),f.restore())};We(()=>{g.elements.length,g.elements.forEach(f=>{f.x,f.y,f.width,f.height,f.points&&f.points.length,f.angle,f.opacity,f.strokeColor,f.backgroundColor,f.fillStyle,f.strokeWidth,f.strokeStyle,f.roughness,f.roundness,f.text,f.fontSize,f.fontFamily,f.textAlign,f.startArrowhead,f.endArrowhead}),g.viewState.scale,g.viewState.panX,g.viewState.panY,g.selection.length,p(),g.layers.length,g.layers.forEach(f=>{f.visible,f.order}),g.gridSettings.enabled,g.gridSettings.gridSize,g.gridSettings.gridColor,g.gridSettings.gridOpacity,requestAnimationFrame(L)});const I=f=>({x:f.clientX,y:f.clientY}),U=(f,v)=>{const{scale:_,panX:S,panY:A}=g.viewState;return{x:(f-S)/_,y:(v-A)/_}},te=f=>{f.preventDefault();const v=f.deltaMode===1?33:f.deltaMode===2?400:1,_=f.deltaX*v,S=f.deltaY*v;if(f.ctrlKey||f.metaKey){const w=1-S*.001,b=Math.min(Math.max(g.viewState.scale*w,.1),10),{x:M,y:E}=I(f),{scale:z,panX:D,panY:V}=g.viewState,K=(M-D)/z,B=(E-V)/z,oe=M-K*b,ye=E-B*b;Pe({scale:b,panX:oe,panY:ye})}else f.shiftKey?Pe({panX:g.viewState.panX-(S||_),panY:g.viewState.panY}):Pe({panX:g.viewState.panX-_,panY:g.viewState.panY-S})},ae=(f,v,_,S,A)=>{const w=Math.cos(A),b=Math.sin(A);return{x:w*(f-_)-b*(v-S)+_,y:b*(f-_)+w*(v-S)+S}},xe=(f,v,_,S,A)=>ae(f,v,_,S,-A),re=(f,v)=>{const{scale:_}=g.viewState,S=10/_;for(let A=g.elements.length-1;A>=0;A--){const w=g.elements[A];if(!g.selection.includes(w.id))continue;const b=w.x+w.width/2,M=w.y+w.height/2,E=w.angle||0,z=xe(f,v,b,M,E),D=2/_,V=[{type:"tl",x:w.x-D,y:w.y-D},{type:"tr",x:w.x+w.width+D,y:w.y-D},{type:"br",x:w.x+w.width+D,y:w.y+w.height+D},{type:"bl",x:w.x-D,y:w.y+w.height+D},{type:"tm",x:w.x+w.width/2,y:w.y-D},{type:"rm",x:w.x+w.width+D,y:w.y+w.height/2},{type:"bm",x:w.x+w.width/2,y:w.y+w.height+D},{type:"lm",x:w.x-D,y:w.y+w.height/2}];for(const B of V)if(Math.abs(z.x-B.x)<=S/2&&Math.abs(z.y-B.y)<=S/2)return{id:w.id,handle:B.type};const K={x:w.x+w.width/2,y:w.y-D-20/_};if(Math.abs(z.x-K.x)<=S&&Math.abs(z.y-K.y)<=S/2)return{id:w.id,handle:"rotate"}}return null},W=f=>{if(!f.points||f.points.length===0)return null;let v=1/0,_=1/0,S=-1/0,A=-1/0;f.points.forEach(E=>{v=Math.min(v,E.x),_=Math.min(_,E.y),S=Math.max(S,E.x),A=Math.max(A,E.y)});const w=S-v,b=A-_,M=f.points.map(E=>({x:E.x-v,y:E.y-_}));return{x:f.x+v,y:f.y+_,width:w,height:b,points:M}},de=(f,v,_,S)=>{const A=f.x+f.width/2,w=f.y+f.height/2,b=xe(v,_,A,w,f.angle||0);if(b.x<f.x-S||b.x>f.x+f.width+S||b.y<f.y-S||b.y>f.y+f.height+S)return!1;if(f.type==="rectangle")return!0;if(f.type==="circle")return Ei(b,f.x,f.y,f.width,f.height);if(f.type==="line"||f.type==="arrow")return qn(b,{x:f.x,y:f.y},{x:f.x+f.width,y:f.y+f.height})<=S;if(f.type==="pencil"&&f.points){const M={x:b.x-f.x,y:b.y-f.y};return Oi(M,f.points,S)}else if(f.type==="text"||f.type==="image")return!0;return!1},De=f=>g.layers.find(_=>_.id===f.layerId)?.locked!==!0,Oe=f=>{f.currentTarget.setPointerCapture(f.pointerId);const{x:v,y:_}=U(f.clientX,f.clientY);if(l()){Xe();return}if(g.selectedTool==="selection"){const M=re(v,_);if(M&&g.selection.length===1){ke(),c=!0,u=M.handle;const D=g.elements.find(V=>V.id===M.id);D&&(y=D.x,$=D.y,P=D.width,T=D.height,O=D.points?[...D.points]:void 0,R=D.fontSize||20,s=v,i=_);return}let E=null;const z=10/g.viewState.scale;for(let D=g.elements.length-1;D>=0;D--){const V=g.elements[D];if(De(V)&&de(V,v,_,z)){E=V.id;break}}if(E){const D=g.selection.includes(E);f.shiftKey?D?j("selection",V=>V.filter(K=>K!==E)):j("selection",V=>[...V,E]):D||j("selection",[E]),g.selection.length>0&&(ke(),c=!0,u=null,s=v,i=_,x.clear(),g.elements.forEach(V=>{g.selection.includes(V.id)&&x.set(V.id,{x:V.x,y:V.y})}))}else f.shiftKey||j("selection",[]),h=!0,s=v,i=_,m({x:v,y:_,w:0,h:0});return}const S=g.layers.find(M=>M.id===g.activeLayerId);if(!S?.visible){alert("Cannot draw on a hidden layer. Please show the layer first or select a visible layer.");return}if(S?.locked){alert("Cannot draw on a locked layer. Please unlock the layer first or select an unlocked layer.");return}if(g.selectedTool==="text"){const M=crypto.randomUUID(),E={id:M,type:"text",x:v,y:_,width:100,height:30,strokeColor:"#000000",backgroundColor:"transparent",strokeWidth:1,text:"",fontSize:20,angle:0,opacity:100,fillStyle:"hachure",strokeStyle:"solid",roughness:1,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,layerId:g.activeLayerId};qt(E),r(M),o(""),setTimeout(()=>d?.focus(),0);return}if(g.selectedTool==="eraser"){e=!0;const M=10/g.viewState.scale;for(let E=g.elements.length-1;E>=0;E--){const z=g.elements[E];de(z,v,_,M)&&Ke([z.id])}return}if(g.selectedTool==="pan"){c=!0,F("grabbing");return}e=!0;let A=v,w=_;if(g.gridSettings.snapToGrid){const M=Ft(v,_,g.gridSettings.gridSize);A=M.x,w=M.y}s=A,i=w,n=crypto.randomUUID();const b={id:n,type:g.selectedTool,x:A,y:w,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",strokeWidth:2,points:g.selectedTool==="pencil"?[{x:0,y:0}]:void 0,angle:0,opacity:100,strokeStyle:"solid",fillStyle:"hachure",roughness:1,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,layerId:g.activeLayerId};qt(b)},Ee=f=>{const{x:v,y:_}=U(f.clientX,f.clientY);if(g.selectedTool==="pan")F(c?"grabbing":"grab");else if(g.selectedTool==="selection"&&!c){const S=re(v,_);S?S.handle==="rotate"?F("grab"):S.handle==="tl"||S.handle==="br"?F("nwse-resize"):S.handle==="tr"||S.handle==="bl"?F("nesw-resize"):S.handle==="tm"||S.handle==="bm"?F("ns-resize"):(S.handle==="lm"||S.handle==="rm")&&F("ew-resize"):F("default")}if(g.selectedTool==="pan"){c&&Pe({panX:g.viewState.panX+f.movementX,panY:g.viewState.panY+f.movementY});return}if(g.selectedTool==="selection"){if(h){const S=v-s,A=_-i;m({x:S>0?s:s+S,y:A>0?i:i+A,w:Math.abs(S),h:Math.abs(A)});return}if(c&&g.selection.length>0){const S=g.selection[0],A=g.elements.find(w=>w.id===S);if(!A)return;if(u)if(u==="rotate"){const w=A.x+A.width/2,b=A.y+A.height/2,M=Math.atan2(_-b,v-w);$e(S,{angle:M+Math.PI/2})}else{let w=v,b=_;if(g.gridSettings.snapToGrid){const oe=Ft(v,_,g.gridSettings.gridSize);w=oe.x,b=oe.y}const M=w-s,E=b-i;let z=y,D=$,V=P,K=T;u==="tl"?(z+=M,D+=E,V-=M,K-=E):u==="tr"?(D+=E,V+=M,K-=E):u==="bl"?(z+=M,V-=M,K+=E):u==="br"?(V+=M,K+=E):u==="tm"?(D+=E,K-=E):u==="bm"?K+=E:u==="lm"?(z+=M,V-=M):u==="rm"&&(V+=M);const B={x:z,y:D,width:V,height:K};if(A.type==="pencil"&&O){const oe=V/P,ye=K/T,Ye=O.map(Je=>({x:Je.x*(P===0?1:oe),y:Je.y*(T===0?1:ye)}));B.points=Ye}if(A.type==="text"){const oe=K/T;if(oe>0){let ye=R*oe;ye=Math.max(ye,8),B.fontSize=ye,B.width=V}}$e(S,B)}else{let w=v-s,b=_-i;if(g.gridSettings.snapToGrid){const M=g.gridSettings.gridSize;w=Math.round(w/M)*M,b=Math.round(b/M)*M}g.selection.forEach(M=>{const E=x.get(M);E&&$e(M,{x:E.x+w,y:E.y+b})})}}}if(!e||!n){if(e&&g.selectedTool==="eraser"){const S=10/g.viewState.scale;for(let A=g.elements.length-1;A>=0;A--){const w=g.elements[A];de(w,v,_,S)&&Ke([w.id])}}return}if(g.selectedTool==="pencil"){const S=g.elements.find(A=>A.id===n);S&&S.points&&$e(n,{points:[...S.points,{x:v-s,y:_-i}]})}else{let S=v,A=_;if(g.gridSettings.snapToGrid){const w=Ft(v,_,g.gridSettings.gridSize);S=w.x,A=w.y}$e(n,{width:S-s,height:A-i})}if(c||e){const w=f.clientX,b=f.clientY;let M=0,E=0;w<50&&(M=10),w>window.innerWidth-50&&(M=-10),b<50&&(E=10),b>window.innerHeight-50&&(E=-10),(M!==0||E!==0)&&Pe({panX:g.viewState.panX+M,panY:g.viewState.panY+E})}},Ce=f=>{if(f.currentTarget.releasePointerCapture(f.pointerId),g.selectedTool==="pan"){c=!1,F("grab");return}if(g.selectedTool==="selection"){if(h){const v=p();if(v){const _=[],S=v.x,A=v.y,w=v.w,b=v.h;if(g.elements.forEach(M=>{const E=M.x,z=M.y,D=M.width,V=M.height;S<E+D&&S+w>E&&A<z+V&&A+b>z&&_.push(M.id)}),f.shiftKey){const M=new Set(g.selection);_.forEach(E=>M.add(E)),j("selection",Array.from(M))}else j("selection",_)}h=!1,m(null)}c=!1,u=null,x.clear();return}if(e&&n){const v=g.elements.find(_=>_.id===n);if(v){if(v.type==="rectangle"||v.type==="circle")v.width<0&&$e(n,{x:v.x+v.width,width:Math.abs(v.width)}),v.height<0&&$e(n,{y:v.y+v.height,height:Math.abs(v.height)});else if(v.type==="pencil"){const _=W(v);_&&$e(n,_)}}}e=!1,n=null},Xe=()=>{const f=l();if(f){const v=a().trim();if(v){const _=g.elements.find(w=>w.id===f);let S=0,A=0;if(t&&_){const w=t.getContext("2d");if(w){const b=_.fontSize||20;w.font=`${b}px sans-serif`,S=w.measureText(v).width,A=b}}S=Math.max(S,10),A=Math.max(A,10),$e(f,{text:a(),width:S,height:A},!0)}else Ke([f]);r(null),o(""),requestAnimationFrame(L)}},G=()=>{l()&&Xe()},ne=()=>{const f=l();return f?g.elements.find(v=>v.id===f):null};We(()=>{l()&&d&&(d.style.height="auto",d.style.height=d.scrollHeight+"px")});const[ue,je]=ee(!1);We(()=>{const{scale:f,panX:v,panY:_}=g.viewState;if(!t||g.elements.length===0){je(!1);return}const S=-v/f,A=-_/f,w=t.width/f,b=t.height/f;let M=1/0,E=1/0,z=-1/0,D=-1/0;g.elements.forEach(K=>{const B=K.x,oe=K.x+K.width,ye=K.y,Ye=K.y+K.height;M=Math.min(M,B,oe),z=Math.max(z,B,oe),E=Math.min(E,ye,Ye),D=Math.max(D,ye,Ye)});const V=!(M>S+w||z<S||E>A+b||D<A);je(!V)});const ut=()=>{if(g.elements.length===0)return;let f=1/0,v=1/0,_=-1/0,S=-1/0;g.elements.forEach(B=>{const oe=B.x,ye=B.x+B.width,Ye=B.y,Je=B.y+B.height;f=Math.min(f,oe,ye),_=Math.max(_,oe,ye),v=Math.min(v,Ye,Je),S=Math.max(S,Ye,Je)});const A=_-f,w=S-v,b=f+A/2,M=v+w/2,{scale:E}=g.viewState,z=window.innerWidth/2,D=window.innerHeight/2,V=-b*E+z,K=-M*E+D;Pe({panX:V,panY:K})};return rt(()=>{window.addEventListener("resize",N),N(),ot(()=>window.removeEventListener("resize",N))}),[(()=>{var f=Ri();f.$$contextmenu=_=>{_.preventDefault(),ie({x:_.clientX,y:_.clientY}),se(!0)},f.$$pointerup=Ce,f.$$pointermove=Ee,f.$$pointerdown=Oe,f.addEventListener("wheel",te);var v=t;return typeof v=="function"?Ve(v,f):t=f,Q(_=>Ne(f,"cursor",H())),f})(),k(fe,{get when(){return ue()},get children(){var f=Xi(),v=f.firstChild;return v.$$click=ut,f}}),k(fe,{get when(){return dt(()=>!!l())()&&ne()},children:f=>{const v=ne(),{scale:_,panX:S,panY:A}=g.viewState,w=v.x*_+S,b=v.y*_+A;return(()=>{var M=ji();M.addEventListener("blur",G),M.$$input=z=>o(z.currentTarget.value);var E=d;return typeof E=="function"?Ve(E,M):d=M,Ne(M,"top",`${b}px`),Ne(M,"left",`${w}px`),Ne(M,"font",`${20*_}px sans-serif`),Q(z=>Ne(M,"color",v.strokeColor)),Q(()=>M.value=a()),M})()}}),k(fe,{get when(){return Z()},get children(){return k(zi,{get x(){return le().x},get y(){return le().y},get items(){return[{label:"Paste",shortcut:"Ctrl+V",onClick:()=>{},disabled:!0},{label:"Select all",shortcut:"Ctrl+A",onClick:()=>j("selection",g.elements.map(f=>f.id))},{separator:!0},{label:"Show grid",shortcut:"Ctrl+'",onClick:Zs,checked:g.gridSettings.enabled},{label:"Snap to grid",shortcut:"Ctrl+Shift+'",onClick:Js,checked:g.gridSettings.snapToGrid},{separator:!0},{label:"Reset view",shortcut:"Ctrl+0",onClick:()=>Pe({scale:1,panX:0,panY:0})}]},onClose:()=>se(!1)})}})]};_e(["pointerdown","pointermove","pointerup","contextmenu","click","input"]);var Fi={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Ge=Fi,Wi=Y("<svg>"),xn=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Hi=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,s)=>s?s.toUpperCase():n.toLowerCase()),Vi=t=>{const e=Hi(t);return e.charAt(0).toUpperCase()+e.slice(1)},Ui=(...t)=>t.filter((e,n,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===n).join(" ").trim(),Gi=t=>{const[e,n]=An(t,["color","size","strokeWidth","children","class","name","iconNode","absoluteStrokeWidth"]);return(()=>{var s=Wi();return In(s,q(Ge,{get width(){return e.size??Ge.width},get height(){return e.size??Ge.height},get stroke(){return e.color??Ge.stroke},get"stroke-width"(){return dt(()=>!!e.absoluteStrokeWidth)()?Number(e.strokeWidth??Ge["stroke-width"])*24/Number(e.size):Number(e.strokeWidth??Ge["stroke-width"])},get class(){return Ui("lucide","lucide-icon",...e.name!=null?[`lucide-${xn(Vi(e.name))}`,`lucide-${xn(e.name)}`]:[],e.class!=null?e.class:"")}},n),!0,!0),C(s,k(Ae,{get each(){return e.iconNode},children:([i,l])=>k(Ds,q({component:i},l))})),s})()},J=Gi,Bi=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],qi=t=>k(J,q(t,{iconNode:Bi,name:"chevron-down"})),Ki=qi,Zi=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ji=t=>k(J,q(t,{iconNode:Zi,name:"chevron-up"})),Qi=Ji,el=[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]],tl=t=>k(J,q(t,{iconNode:el,name:"chevrons-down"})),nl=tl,sl=[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]],il=t=>k(J,q(t,{iconNode:sl,name:"chevrons-up"})),ll=il,al=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],rl=t=>k(J,q(t,{iconNode:al,name:"circle"})),ol=rl,cl=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],dl=t=>k(J,q(t,{iconNode:cl,name:"copy"})),hl=dl,ul=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],fl=t=>k(J,q(t,{iconNode:ul,name:"download"})),pl=fl,gl=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],yl=t=>k(J,q(t,{iconNode:gl,name:"eraser"})),ml=yl,bl=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],vl=t=>k(J,q(t,{iconNode:bl,name:"file-plus"})),wl=vl,kl=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],xl=t=>k(J,q(t,{iconNode:kl,name:"file-text"})),$l=xl,Sl=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ml=t=>k(J,q(t,{iconNode:Sl,name:"folder-open"})),_l=Ml,Cl=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],Pl=t=>k(J,q(t,{iconNode:Cl,name:"hand"})),Tl=Pl,Ol=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],El=t=>k(J,q(t,{iconNode:Ol,name:"image"})),Zn=El,Ll=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Al=t=>k(J,q(t,{iconNode:Ll,name:"maximize"})),Il=Al,Dl=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Nl=t=>k(J,q(t,{iconNode:Dl,name:"menu"})),zl=Nl,Rl=[["path",{d:"M5 12h14",key:"1ays0h"}]],Xl=t=>k(J,q(t,{iconNode:Rl,name:"minus"})),Jn=Xl,jl=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Yl=t=>k(J,q(t,{iconNode:jl,name:"moon"})),Fl=Yl,Wl=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],Hl=t=>k(J,q(t,{iconNode:Wl,name:"mouse-pointer-2"})),Vl=Hl,Ul=[["path",{d:"M13 5H19V11",key:"1n1gyv"}],["path",{d:"M19 5L5 19",key:"72u4yj"}]],Gl=t=>k(J,q(t,{iconNode:Ul,name:"move-up-right"})),Bl=Gl,ql=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Kl=t=>k(J,q(t,{iconNode:ql,name:"pencil"})),Zl=Kl,Jl=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ql=t=>k(J,q(t,{iconNode:Jl,name:"plus"})),ea=Ql,ta=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],na=t=>k(J,q(t,{iconNode:ta,name:"redo-2"})),Qn=na,sa=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],ia=t=>k(J,q(t,{iconNode:sa,name:"save"})),la=ia,aa=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ra=t=>k(J,q(t,{iconNode:aa,name:"share-2"})),oa=ra,ca=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],da=t=>k(J,q(t,{iconNode:ca,name:"square"})),ha=da,ua=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],fa=t=>k(J,q(t,{iconNode:ua,name:"sun"})),pa=fa,ga=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ya=t=>k(J,q(t,{iconNode:ga,name:"trash-2"})),rn=ya,ma=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],ba=t=>k(J,q(t,{iconNode:ma,name:"type"})),va=ba,wa=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],ka=t=>k(J,q(t,{iconNode:wa,name:"undo-2"})),es=ka,xa=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],$a=t=>k(J,q(t,{iconNode:xa,name:"upload"})),Sa=$a,Ma=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],_a=t=>k(J,q(t,{iconNode:Ma,name:"x"})),on=_a,Ca=Y("<div class=toolbar-container><input type=file accept=image/* style=display:none>"),Pa=Y("<button>");const Ta=[{type:"pan",icon:Tl,label:"Pan Tool"},{type:"selection",icon:Vl,label:"Selection"},{type:"rectangle",icon:ha,label:"Rectangle"},{type:"circle",icon:ol,label:"Circle"},{type:"arrow",icon:Bl,label:"Arrow"},{type:"line",icon:Jn,label:"Line"},{type:"pencil",icon:Zl,label:"Pencil"},{type:"text",icon:va,label:"Text"},{type:"image",icon:Zn,label:"Insert Image"},{type:"eraser",icon:ml,label:"Eraser"}],Oa=()=>{let t=null;const e=s=>{s==="image"?t?.click():Ys(s)},n=s=>{const i=s.target.files?.[0];if(!i)return;const l=new FileReader;l.onload=r=>{const a=r.target?.result;if(a){const o=new Image;o.src=a,o.onload=()=>{let c=o.width,h=o.height;if(c>500||h>500){const u=c/h;c>h?(c=500,h=c/u):(h=500,c=h*u)}qt({id:crypto.randomUUID(),type:"image",x:100,y:100,width:c,height:h,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:0,strokeStyle:"solid",roughness:0,opacity:100,angle:0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,dataURL:a,mimeType:i.type,layerId:g.activeLayerId})}}},l.readAsDataURL(i),s.target.value=""};return(()=>{var s=Ca(),i=s.firstChild;return i.addEventListener("change",n),Ve(l=>t=l,i),C(s,()=>Ta.map(l=>(()=>{var r=Pa();return r.$$click=()=>e(l.type),C(r,k(l.icon,{size:20})),Q(a=>{var o=`toolbar-btn ${g.selectedTool===l.type?"active":""}`,d=l.label;return o!==a.e&&ve(r,a.e=o),d!==a.t&&be(r,"title",a.t=d),a},{e:void 0,t:void 0}),r})()),null),s})()};_e(["click"]);class Ea{baseUrl="/api/drawings";async saveDrawing(e,n){await fetch(`${this.baseUrl}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}async loadDrawing(e){const n=await fetch(`${this.baseUrl}/${e}`);return n.ok?await n.json():null}async listDrawings(){const e=await fetch(this.baseUrl);return e.ok?await e.json():[]}async deleteDrawing(e){await fetch(`${this.baseUrl}/${e}`,{method:"DELETE"})}}const At=new Ea;var La=Y("<div class=loading>Loading..."),Aa=Y("<div class=empty>No saved drawings found."),Ia=Y("<div class=modal-overlay><div class=modal-content><div class=modal-header><h3>Open Drawing</h3><button class=close-btn></button></div><div class=modal-body><div class=file-list>"),Da=Y("<div class=file-item><div style=display:flex;align-items:center;gap:8px;flex:1><span></span></div><button class=delete-file-btn title=Delete>");const Na=t=>{const[e,n]=ee([]),[s,i]=ee(!1),l=async()=>{i(!0);try{const a=await At.listDrawings();n(a.map(o=>o.replace(".json","")))}catch(a){console.error(a)}finally{i(!1)}},r=async(a,o)=>{if(o.stopPropagation(),confirm(`Are you sure you want to delete "${a}"?`))try{await At.deleteDrawing(a),l()}catch{alert("Failed to delete file")}};return rt(()=>{t.isOpen&&l()}),We(()=>{t.isOpen&&l()}),k(fe,{get when(){return t.isOpen},get children(){var a=Ia(),o=a.firstChild,d=o.firstChild,c=d.firstChild,h=c.nextSibling,u=d.nextSibling,p=u.firstChild;return we(a,"click",t.onClose,!0),o.$$click=m=>m.stopPropagation(),we(h,"click",t.onClose,!0),C(h,k(on,{size:20})),C(u,k(fe,{get when(){return s()},get children(){return La()}}),p),C(u,k(fe,{get when(){return dt(()=>!s())()&&e().length===0},get children(){return Aa()}}),p),C(p,k(Ae,{get each(){return e()},children:m=>(()=>{var x=Da(),y=x.firstChild,$=y.firstChild,P=y.nextSibling;return x.$$click=()=>t.onSelect(m),C(y,k($l,{size:16}),$),C($,m),P.$$click=T=>r(m,T),C(P,k(rn,{size:16})),x})()})),a}})};_e(["click"]);const za=async(t,e)=>{const n=g.elements;if(n.length===0)return;let s=1/0,i=1/0,l=-1/0,r=-1/0;n.forEach(m=>{s=Math.min(s,m.x),i=Math.min(i,m.y),l=Math.max(l,m.x+m.width),r=Math.max(r,m.y+m.height)});const a=20,o=l-s+a*2,d=r-i+a*2,c=document.createElement("canvas");c.width=o*t,c.height=d*t;const h=c.getContext("2d");if(!h)return;e&&(h.fillStyle="#ffffff",h.fillRect(0,0,c.width,c.height)),h.scale(t,t),h.translate(-s+a,-i+a);const u=an.canvas(c);n.forEach(m=>{Kn(u,h,m)});const p=document.createElement("a");p.download="yappy_drawing.png",p.href=c.toDataURL("image/png"),p.click()},Ra=()=>{const t=g.elements;if(t.length===0)return;let e=1/0,n=1/0,s=-1/0,i=-1/0;t.forEach(y=>{e=Math.min(e,y.x),n=Math.min(n,y.y),s=Math.max(s,y.x+y.width),i=Math.max(i,y.y+y.height)});const l=20,r=s-e+l*2,a=i-n+l*2,o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",`${r}`),o.setAttribute("height",`${a}`),o.setAttribute("viewBox",`0 0 ${r} ${a}`),o.style.backgroundColor="#ffffff";const d=an.svg(o),c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttribute("transform",`translate(${-e+l}, ${-n+l})`),o.appendChild(c),t.forEach(y=>{let $=null;const P={seed:y.seed,roughness:y.roughness,stroke:y.strokeColor,strokeWidth:y.strokeWidth,fill:y.backgroundColor==="transparent"?void 0:y.backgroundColor,fillStyle:y.fillStyle,strokeLineDash:y.strokeStyle==="dashed"?[10,10]:y.strokeStyle==="dotted"?[5,10]:void 0};if(y.type==="rectangle")$=d.rectangle(y.x,y.y,y.width,y.height,P);else if(y.type==="circle")$=d.ellipse(y.x+y.width/2,y.y+y.height/2,Math.abs(y.width),Math.abs(y.height),P);else if(y.type==="line"||y.type==="arrow"){const T=y.x+y.width,O=y.y+y.height;if(y.type==="arrow"){const R=document.createElementNS("http://www.w3.org/2000/svg","g");R.appendChild(d.line(y.x,y.y,T,O,P));const N=Math.atan2(y.height,y.width),H=15,F={x:T-H*Math.cos(N-Math.PI/6),y:O-H*Math.sin(N-Math.PI/6)},Z={x:T-H*Math.cos(N+Math.PI/6),y:O-H*Math.sin(N+Math.PI/6)};R.appendChild(d.line(T,O,F.x,F.y,P)),R.appendChild(d.line(T,O,Z.x,Z.y,P)),$=R}else $=d.line(y.x,y.y,T,O,P)}else if(y.type==="pencil"&&y.points){const T=y.points.map(O=>[y.x+O.x,y.y+O.y]);$=d.linearPath(T,P)}else if(y.type==="text"&&y.text){const T=document.createElementNS("http://www.w3.org/2000/svg","text");T.textContent=y.text,T.setAttribute("x",`${y.x}`),T.setAttribute("y",`${y.y+(y.fontSize||20)}`),T.setAttribute("fill",y.strokeColor),T.setAttribute("font-family","sans-serif"),T.setAttribute("font-size",`${y.fontSize||20}px`),$=T}else if(y.type==="image"&&y.dataURL){const T=document.createElementNS("http://www.w3.org/2000/svg","image");T.setAttribute("href",y.dataURL),T.setAttribute("x",`${y.x}`),T.setAttribute("y",`${y.y}`),T.setAttribute("width",`${y.width}`),T.setAttribute("height",`${y.height}`),$=T}if($){if($.setAttribute("opacity",`${(y.opacity??100)/100}`),y.angle){const T=y.x+y.width/2,O=y.y+y.height/2;$.setAttribute("transform",`rotate(${y.angle*(180/Math.PI)}, ${T}, ${O})`)}c.appendChild($)}});const u=new XMLSerializer().serializeToString(o),p=new Blob([u],{type:"image/svg+xml"}),m=URL.createObjectURL(p),x=document.createElement("a");x.download="yappy_drawing.svg",x.href=m,x.click()};var Xa=Y("<div class=option-group><label>Scale</label><div class=scale-group><button>1x</button><button>2x</button><button>3x"),ja=Y("<div class=option-group><label class=checkbox-label><input type=checkbox>White Background"),Ya=Y("<div class=export-modal-overlay><div class=export-modal><div class=export-header><h3>Export Image</h3><button class=close-btn></button></div><div class=export-options><div class=option-group><label>Format</label><div class=radio-group><label class=radio-label><input type=radio name=format>PNG</label><label class=radio-label><input type=radio name=format>SVG</label></div></div></div><div class=export-actions><button class=cancel-btn>Cancel</button><button class=export-confirm-btn>Export");const Fa=t=>{const[e,n]=ee("png"),[s,i]=ee(2),[l,r]=ee(!0),a=()=>{e()==="png"?za(s(),l()):Ra(),t.onClose()};return k(fe,{get when(){return t.isOpen},get children(){var o=Ya(),d=o.firstChild,c=d.firstChild,h=c.firstChild,u=h.nextSibling,p=c.nextSibling,m=p.firstChild,x=m.firstChild,y=x.nextSibling,$=y.firstChild,P=$.firstChild,T=$.nextSibling,O=T.firstChild,R=p.nextSibling,N=R.firstChild,H=N.nextSibling;return we(o,"click",t.onClose,!0),d.$$click=F=>F.stopPropagation(),we(u,"click",t.onClose,!0),C(u,k(on,{size:20})),P.addEventListener("change",()=>n("png")),O.addEventListener("change",()=>n("svg")),C(p,k(fe,{get when(){return e()==="png"},get children(){return[(()=>{var F=Xa(),Z=F.firstChild,se=Z.nextSibling,le=se.firstChild,ie=le.nextSibling,L=ie.nextSibling;return le.$$click=()=>i(1),ie.$$click=()=>i(2),L.$$click=()=>i(3),Q(I=>{var U=`scale-btn ${s()===1?"active":""}`,te=`scale-btn ${s()===2?"active":""}`,ae=`scale-btn ${s()===3?"active":""}`;return U!==I.e&&ve(le,I.e=U),te!==I.t&&ve(ie,I.t=te),ae!==I.a&&ve(L,I.a=ae),I},{e:void 0,t:void 0,a:void 0}),F})(),(()=>{var F=ja(),Z=F.firstChild,se=Z.firstChild;return se.addEventListener("change",le=>r(le.currentTarget.checked)),Q(()=>se.checked=l()),F})()]}}),null),we(N,"click",t.onClose,!0),H.$$click=a,Q(()=>P.checked=e()==="png"),Q(()=>O.checked=e()==="svg"),o}})};_e(["click"]);var Wa=Y("<div class=save-overlay><div class=save-modal><div class=save-header><h2>Save Drawing</h2><button class=close-btn></button></div><div class=save-content><div class=input-group><label>Filename</label><input type=text class=filename-input autofocus></div><div class=save-actions><button class=cancel-btn>Cancel</button><button class=confirm-btn>Save");const Ha=t=>{const[e,n]=ee("");We(()=>{t.isOpen&&n(t.initialFilename||"untitled")});const s=()=>{e().trim()&&(t.onSave(e().trim()),t.onClose())},i=l=>{l.key==="Enter"?s():l.key==="Escape"&&t.onClose()};return k(fe,{get when(){return t.isOpen},get children(){var l=Wa(),r=l.firstChild,a=r.firstChild,o=a.firstChild,d=o.nextSibling,c=a.nextSibling,h=c.firstChild,u=h.firstChild,p=u.nextSibling,m=h.nextSibling,x=m.firstChild,y=x.nextSibling;return we(l,"click",t.onClose,!0),r.$$click=$=>$.stopPropagation(),we(d,"click",t.onClose,!0),C(d,k(on,{size:20})),p.$$keydown=i,p.$$input=$=>n($.currentTarget.value),we(x,"click",t.onClose,!0),y.$$click=s,Q(()=>p.value=e()),l}})};_e(["click","input","keydown"]);const ts="default-layer",Va=t=>t.map(e=>({...e,layerId:e.layerId||ts})),$n=t=>{const e=t.layers||[{id:ts,name:"Layer 1",visible:!0,locked:!1,order:0}];return{elements:Va(t.elements||[]),layers:e}};var Ua=Y("<div class=menu-backdrop>"),Ga=Y("<input type=file accept=.json style=display:none>"),Ba=Y("<div class=app-title>"),qa=Y('<div class=menu-dropdown><button class=menu-item><span class=label>Open from Workspace...</span><span class=shortcut>Ctrl+O</span></button><button class=menu-item><span class=label>Save to Workspace...</span><span class=shortcut>Ctrl+S</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Open from Disk...</span></button><button class=menu-item><span class=label>Save to Disk...</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Export image...</span><span class=shortcut>Ctrl+Shift+E</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Reset Canvas</span></button><div class=menu-separator></div><div style="padding:4px 12px;font-size:12px;color:var(--text-secondary)">Found a bug? <a href=https://github.com/rajeshpillai/yappy/issues target=_blank rel="noopener noreferrer">Report'),Ka=Y('<div style=position:fixed;top:12px;left:12px;z-index:1001><div class=menu-container style=position:relative><button title=Menu></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Undo (Ctrl+Z)"></button><button class=menu-btn title="Redo (Ctrl+Y)"></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title=Delete></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Zoom to Fit">'),Za=Y('<div style=position:fixed;top:12px;right:12px;z-index:100><div class=menu-container><button class="menu-btn primary"title=Share><span style=margin-left:4px>Share</span></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Toggle Theme">');const Ja=()=>{const[t,e]=ee("default"),[n,s]=ee(!1),[i,l]=ee(!1),[r,a]=ee(!1),[o,d]=ee(!1);let c;const[h,u]=ee("workspace"),p=O=>{u(O),a(!0),d(!1)},m=async O=>{if(e(O),h()==="workspace")try{await At.saveDrawing(O,{elements:g.elements,viewState:g.viewState,layers:g.layers}),alert(`Drawing saved as "${O}"!`)}catch(R){console.error(R),alert("Failed to save to workspace")}else{const R=JSON.stringify({elements:g.elements,viewState:g.viewState,layers:g.layers,version:1},null,2),N=new Blob([R],{type:"application/json"}),H=`${O}.json`,F=new File([N],H,{type:"application/json"});if(navigator.canShare&&navigator.canShare({files:[F]}))try{await navigator.share({files:[F],title:"Yappy Drawing",text:"Save your drawing JSON"});return}catch(le){le.name!=="AbortError"&&console.error("Share failed:",le)}const Z=URL.createObjectURL(N),se=document.createElement("a");se.href=Z,se.download=H,document.body.appendChild(se),se.click(),document.body.removeChild(se),URL.revokeObjectURL(Z)}},x=async O=>{const R=O||t();try{const N=await At.loadDrawing(R);if(N){const H=$n(N);j({elements:H.elements,viewState:N.viewState||{scale:1,panX:0,panY:0},layers:H.layers,activeLayerId:H.layers[0]?.id||"default-layer"}),e(R)}else alert("Drawing not found")}catch(N){console.error(N),alert("Failed to load")}},y=()=>{confirm("Clear canvas?")&&(j("elements",[]),j("viewState",{scale:1,panX:0,panY:0}),j("selection",[]),Ws(),e("untitled")),d(!1)},$=()=>{Us()},P=()=>{const O=`${window.location.origin}${window.location.pathname}?id=${t()}`;navigator.clipboard.writeText(O),alert(`Link copied: ${O}`)},T=O=>{const R=O.target.files?.[0];if(!R)return;const N=new FileReader;N.onload=H=>{try{const F=JSON.parse(H.target?.result);if(F.elements){const Z=$n(F);j({elements:Z.elements,viewState:F.viewState||{scale:1,panX:0,panY:0},layers:Z.layers,activeLayerId:Z.layers[0]?.id||"default-layer"});const se=R.name.replace(/\.json$/i,"");e(se)}else alert("Invalid file format")}catch(F){console.error(F),alert("Failed to parse JSON")}},N.readAsText(R),d(!1),O.target.value=""};return rt(()=>{const R=new URLSearchParams(window.location.search).get("id");R&&(e(R),x(R));const N=H=>{H.ctrlKey&&(H.key==="o"?(H.preventDefault(),s(!0)):H.key==="s"?(H.preventDefault(),p("workspace")):H.key.toLowerCase()==="e"&&H.shiftKey&&(H.preventDefault(),l(!0)))};window.addEventListener("keydown",N),ot(()=>window.removeEventListener("keydown",N))}),[k(fe,{get when(){return o()},get children(){var O=Ua();return O.$$click=()=>d(!1),O}}),(()=>{var O=Ga();O.addEventListener("change",T);var R=c;return typeof R=="function"?Ve(R,O):c=O,O})(),k(Na,{get isOpen(){return n()},onClose:()=>s(!1),onSelect:O=>{x(O),s(!1)}}),k(Fa,{get isOpen(){return i()},onClose:()=>l(!1)}),k(Ha,{get isOpen(){return r()},onClose:()=>a(!1),onSave:m,get initialFilename(){return t()}}),(()=>{var O=Ba();return C(O,t),O})(),(()=>{var O=Ka(),R=O.firstChild,N=R.firstChild,H=N.nextSibling,F=H.nextSibling,Z=F.nextSibling,se=Z.nextSibling,le=se.nextSibling,ie=le.nextSibling,L=ie.nextSibling;return N.$$click=()=>d(!o()),C(N,k(zl,{size:20})),C(R,k(fe,{get when(){return o()},get children(){var I=qa(),U=I.firstChild,te=U.firstChild,ae=U.nextSibling,xe=ae.firstChild,re=ae.nextSibling,W=re.nextSibling,de=W.firstChild,De=W.nextSibling,Oe=De.firstChild,Ee=De.nextSibling,Ce=Ee.nextSibling,Xe=Ce.firstChild,G=Ce.nextSibling,ne=G.nextSibling,ue=ne.firstChild,je=ne.nextSibling;return je.nextSibling,U.$$click=()=>{s(!0),d(!1)},C(U,k(_l,{size:16}),te),ae.$$click=()=>p("workspace"),C(ae,k(la,{size:16}),xe),W.$$click=()=>{c?.click(),d(!1)},C(W,k(Sa,{size:16}),de),De.$$click=()=>p("disk"),C(De,k(pl,{size:16}),Oe),Ce.$$click=()=>{l(!0),d(!1)},C(Ce,k(Zn,{size:16}),Xe),ne.$$click=y,C(ne,k(wl,{size:16}),ue),I}}),H),we(F,"click",jn,!0),C(F,k(es,{size:18})),we(Z,"click",Bt,!0),C(Z,k(Qn,{size:18})),le.$$click=()=>Ke(g.selection),C(le,k(rn,{size:18})),L.$$click=$,C(L,k(Il,{size:18})),Q(I=>{var U=`menu-btn ${o()?"active":""}`,te=g.selection.length===0;return U!==I.e&&ve(N,I.e=U),te!==I.t&&(le.disabled=I.t=te),I},{e:void 0,t:void 0}),O})(),(()=>{var O=Za(),R=O.firstChild,N=R.firstChild,H=N.firstChild,F=N.nextSibling,Z=F.nextSibling;return N.$$click=P,C(N,k(oa,{size:18}),H),we(Z,"click",Vs,!0),C(Z,(()=>{var se=dt(()=>g.theme==="dark");return()=>se()?k(pa,{size:18}):k(Fl,{size:18})})()),O})()]};_e(["click"]);var Qa=Y('<div class=zoom-container><div class=zoom-group><button class=zoom-btn title="Zoom Out"></button><button class="zoom-btn text-btn"title="Reset Zoom">%</button><button class=zoom-btn title="Zoom In"></button></div><div class=zoom-group style=margin-left:12px><button class=zoom-btn title="Undo (Coming Soon)"></button><button class=zoom-btn title="Redo (Coming Soon)">');const er=()=>{const t=()=>{const s=Math.min(g.viewState.scale*1.1,10);Pe({scale:s})},e=()=>{const s=Math.max(g.viewState.scale*.9,.1);Pe({scale:s})},n=()=>{Pe({scale:1})};return(()=>{var s=Qa(),i=s.firstChild,l=i.firstChild,r=l.nextSibling,a=r.firstChild,o=r.nextSibling,d=i.nextSibling,c=d.firstChild,h=c.nextSibling;return l.$$click=e,C(l,k(Jn,{size:16})),r.$$click=n,C(r,()=>Math.round(g.viewState.scale*100),a),o.$$click=t,C(o,k(ea,{size:16})),C(c,k(es,{size:16})),C(h,k(Qn,{size:16})),s})()};_e(["click"]);const tr=[{key:"renderStyle",label:"Style",type:"select",group:"style",options:[{label:"Sketch",value:"sketch"},{label:"Architectural",value:"architectural"}],applicableTo:["rectangle","circle","line","arrow"],defaultValue:"sketch"},{key:"strokeColor",label:"Stroke",type:"color",group:"stroke",applicableTo:"all",defaultValue:"#000000"},{key:"backgroundColor",label:"Background",type:"color",group:"background",applicableTo:["rectangle","circle","text"],defaultValue:"transparent"},{key:"fillStyle",label:"Fill",type:"select",group:"background",options:[{label:"Solid",value:"solid"},{label:"Hachure",value:"hachure"},{label:"Cross-Hatch",value:"cross-hatch"}],applicableTo:["rectangle","circle"],defaultValue:"hachure"},{key:"strokeWidth",label:"Width",type:"slider",min:1,max:20,step:1,group:"stroke",applicableTo:["rectangle","circle","line","arrow","pencil"],defaultValue:1},{key:"strokeStyle",label:"Stroke Style",type:"select",group:"stroke",options:[{label:"Solid",value:"solid"},{label:"Dashed",value:"dashed"},{label:"Dotted",value:"dotted"}],applicableTo:["rectangle","circle","line","arrow","pencil"],defaultValue:"solid"},{key:"roughness",label:"Sloppiness",type:"slider",min:0,max:3,step:.1,group:"style",applicableTo:["rectangle","circle","line","arrow"],defaultValue:1},{key:"opacity",label:"Opacity",type:"slider",min:0,max:100,step:1,group:"style",applicableTo:"all",defaultValue:100},{key:"fontSize",label:"Size",type:"select",options:[{label:"Small",value:16},{label:"Medium",value:20},{label:"Large",value:28},{label:"XL",value:36}],group:"text",applicableTo:["text"],defaultValue:20},{key:"fontFamily",label:"Font",type:"select",options:[{label:"Hand-drawn",value:1},{label:"Normal",value:2},{label:"Code",value:3}],group:"text",applicableTo:["text"],defaultValue:1},{key:"textAlign",label:"Align",type:"select",options:[{label:"Left",value:"left"},{label:"Center",value:"center"},{label:"Right",value:"right"}],group:"text",applicableTo:["text"],defaultValue:"left"},{key:"text",label:"Content",type:"textarea",group:"text",applicableTo:["text"],defaultValue:""},{key:"startArrowhead",label:"Start Arrow",type:"select",options:[{label:"None",value:null},{label:"Arrow",value:"arrow"},{label:"Dot",value:"dot"}],group:"style",applicableTo:["arrow","line"],defaultValue:null},{key:"endArrowhead",label:"End Arrow",type:"select",options:[{label:"None",value:null},{label:"Arrow",value:"arrow"},{label:"Dot",value:"dot"},{label:"Triangle",value:"triangle"}],group:"style",applicableTo:["arrow","line"],defaultValue:"arrow"},{key:"angle",label:"Angle",type:"number",group:"dimensions",applicableTo:"all",defaultValue:0},{key:"locked",label:"Locked",type:"toggle",group:"advanced",applicableTo:"all",defaultValue:!1},{key:"link",label:"Link",type:"input",group:"advanced",applicableTo:"all",defaultValue:null}];var nr=Y('<div class=control-col><label></label><div class=color-picker-container><div class=color-grid></div><div class=hex-input-row><span class=hash>#</span><input type=text class=hex-input><div class=system-picker-wrapper><input type=color title="Custom Color">'),sr=Y("<button>"),ir=Y("<div class=diagonal-line-sm>"),lr=Y("<div class=control-row><label></label><div class=slider-wrapper><input type=range><span class=value-display>"),ar=Y("<div class=control-row><label></label><select>"),Sn=Y("<option>"),rr=Y("<div class=control-row><label></label><input type=checkbox>"),or=Y("<div class=control-row><label></label><input type=text>"),cr=Y('<div class=control-col><label></label><textarea rows=3 style="width:100%;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical">'),dr=Y("<div class=header-actions><button title=Duplicate></button><button class=delete-btn title=Delete>"),hr=Y('<div class=property-group><div class=group-title>LAYERS</div><div class=control-row><label>Layer</label><select></select></div><div class=control-row><label>Z-Order</label></div><div class=layer-controls><button title="To Front"></button><button title=Forward></button><button title=Backward></button><button title="To Back">'),ur=Y("<div class=property-panel-container><div class=property-header><h3></h3></div><div class=property-content>"),fr=Y("<div class=property-group><div class=group-title>");const pr=()=>{const t=Se(()=>{if(g.selection.length===1){const r=g.elements.find(a=>a.id===g.selection[0]);return r?{type:"element",data:r}:null}return null}),e=Se(()=>{const r=t();if(!r)return[];const a=r.data.type;return tr.filter(o=>o.applicableTo==="all"?!0:Array.isArray(o.applicableTo)?o.applicableTo.includes(a):!0)}),n=(r,a)=>{const o=t();o&&(o.type==="element"?$e(o.data.id,{[r]:a},!0):Fs({[r]:a}))},s=()=>{g.selection.length>0&&Ke(g.selection)},i=(r,a)=>{switch(r.type){case"color":const o=["transparent","#ffffff","#f8f9fa","#f1f3f5","#fff5f5","#fff0f6","#f3f0ff","#e03131","#e8590c","#fcc419","#2f9e44","#1971c2","#6741d9","#c2255c","#343a40"];return(()=>{var d=nr(),c=d.firstChild,h=c.nextSibling,u=h.firstChild,p=u.nextSibling,m=p.firstChild,x=m.nextSibling,y=x.nextSibling,$=y.firstChild;return C(c,()=>r.label),C(u,k(Ae,{each:o,children:P=>(()=>{var T=sr();return T.$$click=()=>n(r.key,P),ve(T,`color-swatch ${a===P?"selected":""}`),Ne(T,"background",P==="transparent"?"white":P),be(T,"title",P),C(T,P==="transparent"&&ir()),T})()})),x.$$input=P=>{let T=P.currentTarget.value;n(r.key,"#"+T)},$.$$input=P=>n(r.key,P.currentTarget.value),Q(()=>x.value=a?.replace("#","")||""),Q(()=>$.value=a?.startsWith("#")?a:"#000000"),d})();case"slider":return(()=>{var d=lr(),c=d.firstChild,h=c.nextSibling,u=h.firstChild,p=u.nextSibling;return C(c,()=>r.label),u.$$input=m=>n(r.key,Number(m.currentTarget.value)),C(p,a),Q(m=>{var x=r.min,y=r.max,$=r.step;return x!==m.e&&be(u,"min",m.e=x),y!==m.t&&be(u,"max",m.t=y),$!==m.a&&be(u,"step",m.a=$),m},{e:void 0,t:void 0,a:void 0}),Q(()=>u.value=a??r.defaultValue),d})();case"select":return(()=>{var d=ar(),c=d.firstChild,h=c.nextSibling;return C(c,()=>r.label),h.addEventListener("change",u=>{const p=u.currentTarget.value,m=r.options?.some(x=>typeof x.value=="number");n(r.key,m?Number(p):p)}),C(h,k(Ae,{get each(){return r.options},children:u=>(()=>{var p=Sn();return C(p,()=>u.label),Q(()=>p.value=u.value??""),p})()})),Q(()=>h.value=a??r.defaultValue),d})();case"toggle":return(()=>{var d=rr(),c=d.firstChild,h=c.nextSibling;return C(c,()=>r.label),h.addEventListener("change",u=>n(r.key,u.currentTarget.checked)),h.checked=!!a,d})();case"input":return(()=>{var d=or(),c=d.firstChild,h=c.nextSibling;return C(c,()=>r.label),h.$$input=u=>n(r.key,u.currentTarget.value),h.value=a||"",d})();case"textarea":return(()=>{var d=cr(),c=d.firstChild,h=c.nextSibling;return C(c,()=>r.label),h.$$input=u=>n(r.key,u.currentTarget.value),h.value=a||"",d})();default:return null}},l=Se(()=>{const r={};return e().forEach(a=>{r[a.group]||(r[a.group]=[]),r[a.group].push(a)}),r});return k(fe,{get when(){return t()},get children(){var r=ur(),a=r.firstChild,o=a.firstChild,d=a.nextSibling;return C(o,()=>t()?.type==="element"?"Properties":"Defaults"),C(a,k(fe,{get when(){return t()?.type==="element"},get children(){var c=dr(),h=c.firstChild,u=h.nextSibling;return h.$$click=()=>Hs(t().data.id),C(h,k(hl,{size:16})),u.$$click=s,C(u,k(rn,{size:16})),c}}),null),C(d,k(Ae,{get each(){return Object.entries(l())},children:([c,h])=>(()=>{var u=fr(),p=u.firstChild;return C(p,()=>c.toUpperCase()),C(u,k(Ae,{each:h,children:m=>i(m,(t()?.data)[m.key])}),null),u})()}),null),C(d,k(fe,{get when(){return t()?.type==="element"},get children(){var c=hr(),h=c.firstChild,u=h.nextSibling,p=u.firstChild,m=p.nextSibling,x=u.nextSibling,y=x.nextSibling,$=y.firstChild,P=$.nextSibling,T=P.nextSibling,O=T.nextSibling;return m.addEventListener("change",R=>{const N=R.currentTarget.value,H=t().data.id;$e(H,{layerId:N},!0)}),C(m,k(Ae,{get each(){return g.layers},children:R=>(()=>{var N=Sn();return C(N,()=>R.name,null),C(N,()=>R.visible?"":" (hidden)",null),C(N,()=>R.locked?" (locked)":"",null),Q(()=>N.value=R.id),N})()})),$.$$click=()=>pt(t().data.id,"front"),C($,k(ll,{size:16})),P.$$click=()=>pt(t().data.id,"forward"),C(P,k(Qi,{size:16})),T.$$click=()=>pt(t().data.id,"backward"),C(T,k(Ki,{size:16})),O.$$click=()=>pt(t().data.id,"back"),C(O,k(nl,{size:16})),Q(()=>m.value=t().data.layerId),c}}),null),r}})};_e(["input","click"]);var gr=Y("<div class=layer-list>"),yr=Y('<div><div class=layer-panel-header><h3>Layers</h3><div style=display:flex;gap:4px><button class=layer-collapse-btn></button><button class=layer-add-btn title="Add new layer">+'),mr=Y('<div><span class=drag-handle title="Drag to reorder"></span><button></button><button></button><button class=layer-duplicate-btn title="Duplicate layer"></button><button class=layer-delete-btn title="Delete layer">'),br=Y("<input type=text class=layer-name-input>"),vr=Y('<span class=layer-name title="Double-click or long-press to rename">');const wr=()=>{const[t,e]=ee(null),[n,s]=ee(""),[i,l]=ee(!1),[r,a]=ee(null),[o,d]=ee(null);let c=null;const h=()=>{Gs()},u=L=>{Yn(L)},p=(L,I)=>{I.stopPropagation();const U=g.layers.find(te=>te.id===L);U&&Rt(L,{visible:!U.visible})},m=(L,I)=>{I.stopPropagation();const U=g.layers.find(te=>te.id===L);U&&Rt(L,{locked:!U.locked})},x=(L,I)=>{I.stopPropagation(),g.layers.length>1&&Bs(L)},y=(L,I)=>{I.stopPropagation(),qs(L)},$=(L,I,U)=>{U.stopPropagation(),e(L),s(I)},P=L=>{const I=n().trim();I&&I!==g.layers.find(U=>U.id===L)?.name&&Rt(L,{name:I}),e(null),s("")},T=()=>{e(null),s("")},O=(L,I)=>{L.key==="Enter"?(L.preventDefault(),P(I)):L.key==="Escape"&&(L.preventDefault(),T())},R=(L,I,U)=>{c=window.setTimeout(()=>{$(L,I,U)},500)},N=()=>{c&&(clearTimeout(c),c=null)},H=(L,I)=>{a(L),I.dataTransfer.effectAllowed="move",I.dataTransfer.setData("text/plain",L),setTimeout(()=>{I.target.style.opacity="0.5"},0)},F=L=>{L.target.style.opacity="1",a(null),d(null)},Z=(L,I)=>{I.preventDefault(),I.dataTransfer.dropEffect="move",d(L)},se=()=>{d(null)},le=(L,I)=>{I.preventDefault();const U=r();if(U&&U!==L){const te=[...g.layers].reverse(),ae=te.findIndex(re=>re.id===U),xe=te.findIndex(re=>re.id===L);if(ae!==-1&&xe!==-1){const re=g.layers.length-1-ae,W=g.layers.length-1-xe;Ks(re,W)}}a(null),d(null)},ie=()=>[...g.layers].reverse();return(()=>{var L=yr(),I=L.firstChild,U=I.firstChild,te=U.nextSibling,ae=te.firstChild,xe=ae.nextSibling;return ae.$$click=()=>l(!i()),C(ae,()=>i()?"":""),xe.$$click=h,C(L,k(fe,{get when(){return!i()},get children(){var re=gr();return C(re,k(Ae,{get each(){return ie()},children:W=>(()=>{var de=mr(),De=de.firstChild,Oe=De.nextSibling,Ee=Oe.nextSibling,Ce=Ee.nextSibling,Xe=Ce.nextSibling;return de.addEventListener("drop",G=>le(W.id,G)),de.addEventListener("dragleave",se),de.addEventListener("dragover",G=>Z(W.id,G)),de.addEventListener("dragend",F),de.addEventListener("dragstart",G=>H(W.id,G)),de.$$click=()=>u(W.id),be(de,"draggable",!0),Oe.$$click=G=>p(W.id,G),C(Oe,()=>W.visible?"":""),Ee.$$click=G=>m(W.id,G),C(Ee,()=>W.locked?"":""),C(de,(()=>{var G=dt(()=>t()===W.id);return()=>G()?(()=>{var ne=br();return Ve(ue=>setTimeout(()=>ue?.select(),0),ne),ne.$$click=ue=>ue.stopPropagation(),ne.addEventListener("blur",()=>P(W.id)),ne.$$keydown=ue=>O(ue,W.id),ne.$$input=ue=>s(ue.currentTarget.value),Q(()=>ne.value=n()),ne})():(()=>{var ne=vr();return ne.addEventListener("pointercancel",N),ne.$$pointerup=N,ne.$$pointerdown=ue=>R(W.id,W.name,ue),ne.$$dblclick=ue=>$(W.id,W.name,ue),C(ne,()=>W.name),ne})()})(),Ce),Ce.$$click=G=>y(W.id,G),Xe.$$click=G=>x(W.id,G),Q(G=>{var ne=`layer-item ${g.activeLayerId===W.id?"active":""} ${o()===W.id?"drag-over":""}`,ue=`layer-visibility-btn ${W.visible?"visible":"hidden"}`,je=W.visible?"Hide layer":"Show layer",ut=`layer-lock-btn ${W.locked?"locked":""}`,f=W.locked?"Unlock layer":"Lock layer",v=g.layers.length<=1;return ne!==G.e&&ve(de,G.e=ne),ue!==G.t&&ve(Oe,G.t=ue),je!==G.a&&be(Oe,"title",G.a=je),ut!==G.o&&ve(Ee,G.o=ut),f!==G.i&&be(Ee,"title",G.i=f),v!==G.n&&(Xe.disabled=G.n=v),G},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),de})()})),re}}),null),Q(re=>{var W=`layer-panel ${i()?"collapsed":""}`,de=i()?"Expand layers":"Collapse layers";return W!==re.e&&ve(L,re.e=W),de!==re.t&&be(ae,"title",re.t=de),re},{e:void 0,t:void 0}),L})()};_e(["click","input","keydown","dblclick","pointerdown","pointerup"]);var kr=Y("<div>");const xr=()=>(rt(()=>{const t=e=>{(e.ctrlKey||e.metaKey)&&e.key==="z"?(e.preventDefault(),e.shiftKey?Bt():jn()):(e.ctrlKey||e.metaKey)&&e.key==="y"?(e.preventDefault(),Bt()):(e.key==="Delete"||e.key==="Backspace")&&document.activeElement?.tagName!=="INPUT"&&document.activeElement?.tagName!=="TEXTAREA"&&(e.preventDefault(),g.selection.length>0&&Ke(g.selection))};window.addEventListener("keydown",t),ot(()=>window.removeEventListener("keydown",t))}),(()=>{var t=kr();return C(t,k(Oa,{}),null),C(t,k(pr,{}),null),C(t,k(wr,{}),null),C(t,k(Ja,{}),null),C(t,k(er,{}),null),C(t,k(Yi,{}),null),t})()),$r=document.getElementById("root");Ss(()=>k(xr,{}),$r);
