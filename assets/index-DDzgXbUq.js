const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./morph-animator-BIBwsBSm.js","./vendor-rendering-CqcgmY0d.js","./solid-framework-CtC0wtKI.js","./vendor-export-B6WwIQ1_.js","./help-dialog-DSBV5Qx-.js","./help-dialog-BuEFoCdI.css","./load-export-dialog-BYs88Bjr.js","./load-export-dialog-BI080PEg.css","./file-open-dialog-ClqvdtWH.js","./file-open-dialog-fDkqaZuJ.css","./export-dialog-DHqTuauA.js","./export-dialog-B7S2OIzO.css","./save-dialog-C4iCAfhC.js","./save-dialog-DKlfwlwa.css","./template-browser-7TWYuBWm.js","./template-browser-wA56mJ0X.css","./property-panel-CLPyb107.js","./property-panel-BMe2r3Df.css","./layer-panel-lGN8R735.js","./layer-panel-C0mSt2Wp.css","./command-palette-CO3X5UB7.js","./command-palette-CVDazVxS.css","./state-panel-DM7THTuo.js","./state-panel-Clr9NUEJ.css","./mindmap-action-toolbar-ziq6nTYP.js","./mindmap-action-toolbar-CAFnKVn8.css","./slide-navigator-DOT44yqr.js","./slide-navigator-zAK9vOL6.css","./slide-control-toolbar-BwhnLEsy.js","./presentation-controls-B6gxVAKE.js"])))=>i.map(i=>d[i]);
import{d as ht,t as $,i as I,c as Yt,a as al,b as ll,l as cl,x as Vi,e as it,s as L,m as $e,f as ot,u as tt,g as Ue,h as kt,j as Kn,k as It,P as $t,p as hl,n as dl,o as Rt,q as Qi,r as ho,v as ul,w as Zi,y as fl,z as pl,A as gl,B as yl,C as Ji,D as ml,E as uo,F as fo,G as bl,H as wl,I as vl,J as xl,K as po,L as kl,M as Sl,N as Ml,O as Pl,Q as Cl,R as go,S as _l,T as Al,U as Tl,V as yo,W as Ll,X as Il,Y as $l,Z as Rl,_ as El,$ as Nl,a0 as Ol,a1 as Bl,a2 as Dl,a3 as zl,a4 as Fl,a5 as Ki,a6 as mo,a7 as tr,a8 as Wl,a9 as ke,aa as jl,ab as Ul,ac as ql,ad as Hl,ae as Yl,af as Xl,ag as Gl,ah as Vl,ai as Ql,aj as Zl,ak as Jl,al as Kl,am as tc,an as ec,ao as nc,ap as ic,aq as rc,ar as fi,as as oc,at as sc,au as ac,av as lc,aw as cc,ax as zr,ay as hc,az as dc,aA as uc,aB as fc,aC as pc,aD as gc,aE as yc,aF as mc,aG as bc,aH as wc}from"./vendor-rendering-CqcgmY0d.js";import{_ as Ct,E as Fr,P as vc}from"./vendor-export-B6WwIQ1_.js";import{$ as pe,i as ee,j as Wr,k as Ci,e as H,h as _,S as q,a as N,l as ye,F as zt,o as mt,d as ct,b as pi,u as In,n as _t,p as bo}from"./solid-framework-CtC0wtKI.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();const _i=Symbol("store-raw"),Ce=Symbol("store-node"),Jt=Symbol("store-has"),wo=Symbol("store-self");function vo(i){let t=i[pe];if(!t&&(Object.defineProperty(i,pe,{value:t=new Proxy(i,Sc)}),!Array.isArray(i))){const n=Object.keys(i),r=Object.getOwnPropertyDescriptors(i);for(let e=0,o=n.length;e<o;e++){const l=n[e];r[l].get&&Object.defineProperty(i,l,{enumerable:r[l].enumerable,get:r[l].get.bind(t)})}}return t}function Dn(i){let t;return i!=null&&typeof i=="object"&&(i[pe]||!(t=Object.getPrototypeOf(i))||t===Object.prototype||Array.isArray(i))}function qe(i,t=new Set){let n,r,e,o;if(n=i!=null&&i[_i])return n;if(!Dn(i)||t.has(i))return i;if(Array.isArray(i)){Object.isFrozen(i)?i=i.slice(0):t.add(i);for(let l=0,s=i.length;l<s;l++)e=i[l],(r=qe(e,t))!==e&&(i[l]=r)}else{Object.isFrozen(i)?i=Object.assign({},i):t.add(i);const l=Object.keys(i),s=Object.getOwnPropertyDescriptors(i);for(let a=0,c=l.length;a<c;a++)o=l[a],!s[o].get&&(e=i[o],(r=qe(e,t))!==e&&(i[o]=r))}return i}function zn(i,t){let n=i[t];return n||Object.defineProperty(i,t,{value:n=Object.create(null)}),n}function He(i,t,n){if(i[t])return i[t];const[r,e]=H(n,{equals:!1,internal:!0});return r.$=e,i[t]=r}function xc(i,t){const n=Reflect.getOwnPropertyDescriptor(i,t);return!n||n.get||!n.configurable||t===pe||t===Ce||(delete n.value,delete n.writable,n.get=()=>i[pe][t]),n}function xo(i){Ci()&&He(zn(i,Ce),wo)()}function kc(i){return xo(i),Reflect.ownKeys(i)}const Sc={get(i,t,n){if(t===_i)return i;if(t===pe)return n;if(t===Wr)return xo(i),n;const r=zn(i,Ce),e=r[t];let o=e?e():i[t];if(t===Ce||t===Jt||t==="__proto__")return o;if(!e){const l=Object.getOwnPropertyDescriptor(i,t);Ci()&&(typeof o!="function"||i.hasOwnProperty(t))&&!(l&&l.get)&&(o=He(r,t,o)())}return Dn(o)?vo(o):o},has(i,t){return t===_i||t===pe||t===Wr||t===Ce||t===Jt||t==="__proto__"?!0:(Ci()&&He(zn(i,Jt),t)(),t in i)},set(){return!0},deleteProperty(){return!0},ownKeys:kc,getOwnPropertyDescriptor:xc};function Fn(i,t,n,r=!1){if(!r&&i[t]===n)return;const e=i[t],o=i.length;n===void 0?(delete i[t],i[Jt]&&i[Jt][t]&&e!==void 0&&i[Jt][t].$()):(i[t]=n,i[Jt]&&i[Jt][t]&&e===void 0&&i[Jt][t].$());let l=zn(i,Ce),s;if((s=He(l,t,e))&&s.$(()=>n),Array.isArray(i)&&i.length!==o){for(let a=i.length;a<o;a++)(s=l[a])&&s.$();(s=He(l,"length",o))&&s.$(i.length)}(s=l[wo])&&s.$()}function ko(i,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const e=n[r];Fn(i,e,t[e])}}function Mc(i,t){if(typeof t=="function"&&(t=t(i)),t=qe(t),Array.isArray(t)){if(i===t)return;let n=0,r=t.length;for(;n<r;n++){const e=t[n];i[n]!==e&&Fn(i,n,e)}Fn(i,"length",r)}else ko(i,t)}function Fe(i,t,n=[]){let r,e=i;if(t.length>1){r=t.shift();const l=typeof r,s=Array.isArray(i);if(Array.isArray(r)){for(let a=0;a<r.length;a++)Fe(i,[r[a]].concat(t),n);return}else if(s&&l==="function"){for(let a=0;a<i.length;a++)r(i[a],a)&&Fe(i,[a].concat(t),n);return}else if(s&&l==="object"){const{from:a=0,to:c=i.length-1,by:h=1}=r;for(let d=a;d<=c;d+=h)Fe(i,[d].concat(t),n);return}else if(t.length>1){Fe(i[r],t,[r].concat(n));return}e=i[r],n=[r].concat(n)}let o=t[0];typeof o=="function"&&(o=o(e,n),o===e)||r===void 0&&o==null||(o=qe(o),r===void 0||Dn(e)&&Dn(o)&&!Array.isArray(o)?ko(e,o):Fn(i,r,o))}function Pc(...[i,t]){const n=qe(i||{}),r=Array.isArray(n),e=vo(n);function o(...l){ee(()=>{r&&l.length===1?Mc(n,l[0]):Fe(n,l)})}return[e,o]}const Ye={type:"none",duration:500,easing:"easeInOutQuad"},ti=(i,t,n=0,r=0)=>({id:crypto.randomUUID(),name:t||"Slide 1",spatialPosition:{x:n,y:r},dimensions:{width:1920,height:1080},backgroundColor:"#ffffff",order:0,transition:{...Ye}}),So=(i,t="slides")=>({version:4,metadata:{name:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),docType:t},elements:[],layers:[{id:"default-layer",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent"}],slides:[ti()],globalSettings:{},gridSettings:{enabled:!1,snapToGrid:!1,objectSnapping:!0,gridSize:20,gridColor:"#cccccc",gridOpacity:.5,style:"lines"}});var Cc=$("<div><div class=toast-icon></div><div class=toast-message></div><button class=toast-close>");const[se,Ai]=H({message:"",type:"info",visible:!1});let je;const nt=(i,t="info",n=3e3)=>{const r=t==="loading"?0:n;Ai({message:i,type:t,visible:!0}),je&&clearTimeout(je),r>0&&(je=window.setTimeout(()=>{Ai(e=>({...e,visible:!1}))},r))},Mo=()=>{Ai(i=>({...i,visible:!1})),je&&clearTimeout(je)},_c=()=>_(q,{get when(){return se().visible},get children(){var i=Cc(),t=i.firstChild,n=t.nextSibling,r=n.nextSibling;return I(t,_(q,{get when(){return se().type==="success"},get children(){return _(Yt,{size:18})}}),null),I(t,_(q,{get when(){return se().type==="error"},get children(){return _(al,{size:18})}}),null),I(t,_(q,{get when(){return se().type==="info"},get children(){return _(ll,{size:18})}}),null),I(t,_(q,{get when(){return se().type==="loading"},get children(){return _(cl,{size:18,class:"spin"})}}),null),I(n,()=>se().message),r.$$click=Mo,I(r,_(Vi,{size:14})),N(()=>it(i,`toast toast-${se().type}`)),i}});ht(["click"]);const Ac=Object.freeze(Object.defineProperty({__proto__:null,default:_c,hideToast:Mo,showToast:nt},Symbol.toStringTag,{value:"Module"})),jr=["#e03131","#1971c2","#2f9e44","#f08c00","#9c36b5","#0b7285","#748ffc","#f76707","#099268"];class Po{hSpacing=100;vSpacing=40;buildTree(t,n){const r=n.find(l=>l.id===t);if(!r)return null;const e={id:r.id,element:r,children:[],width:r.width,height:r.height,x:r.x,y:r.y},o=n.filter(l=>l.parentId===t);for(const l of o){const s=this.buildTree(l.id,n);s&&e.children.push(s)}return e}layoutHorizontal(t,n="right"){this.calculateSubtreeHeights(t),this.assignHorizontalPositions(t,t.x,t.y,n)}layoutVertical(t,n="down"){this.calculateSubtreeWidths(t),this.assignVerticalPositions(t,t.x,t.y,n)}calculateSubtreeHeights(t){if(t.children.length===0)return t.totalHeight=t.height,t.totalHeight;const n=t.children.reduce((e,o)=>e+this.calculateSubtreeHeights(o),0),r=(t.children.length-1)*this.vSpacing;return t.totalHeight=Math.max(t.height,n+r),t.totalHeight}assignHorizontalPositions(t,n,r,e){if(t.x=n,t.y=r,t.children.length===0)return;const o=e==="right"?n+t.width+this.hSpacing:n-this.hSpacing;let l=r-t.totalHeight/2+t.children[0].totalHeight/2;const s=t.children.reduce((a,c)=>a+c.totalHeight,0)+(t.children.length-1)*this.vSpacing;l=r+t.height/2-s/2;for(const a of t.children){const c=e==="right"?o:o-a.width,h=l+a.totalHeight/2-a.height/2;this.assignHorizontalPositions(a,c,h,e),l+=a.totalHeight+this.vSpacing}}calculateSubtreeWidths(t){if(t.children.length===0)return t.totalWidth=t.width,t.totalWidth;const n=t.children.reduce((e,o)=>e+this.calculateSubtreeWidths(o),0),r=(t.children.length-1)*this.hSpacing;return t.totalWidth=Math.max(t.width,n+r),t.totalWidth}assignVerticalPositions(t,n,r,e){if(t.x=n,t.y=r,t.children.length===0)return;const o=e==="down"?r+t.height+this.vSpacing:r-this.vSpacing,l=t.children.reduce((a,c)=>a+c.totalWidth,0)+(t.children.length-1)*this.hSpacing;let s=n+t.width/2-l/2;for(const a of t.children){const c=e==="down"?o:o-a.height,h=s+a.totalWidth/2-a.width/2;this.assignVerticalPositions(a,h,c,e),s+=a.totalWidth+this.hSpacing}}layoutRadial(t){this.assignRadialPositions(t,t.x,t.y,0,Math.PI*2,250)}assignRadialPositions(t,n,r,e,o,l){if(t.x=n,t.y=r,t.children.length===0)return;const s=n+t.width/2,a=r+t.height/2,h=(o-e)/t.children.length;for(let d=0;d<t.children.length;d++){const u=t.children[d],f=e+(d+.5)*h,g=s+Math.cos(f)*(l+t.width/2),p=a+Math.sin(f)*(l+t.height/2),m=g-u.width/2,y=p-u.height/2,w=Math.min(Math.PI/2,h*.9);this.assignRadialPositions(u,m,y,f-w/2,f+w/2,l*.8)}}applySemanticStyling(t,n){t.styleUpdates={},t.children.forEach((r,e)=>{const o=jr[e%jr.length];this.styleSubtree(r,o,1,n)})}styleSubtree(t,n,r,e){const o=Math.max(1,4-r*.5),l=Math.max(40,100-r*10);t.styleUpdates={strokeColor:n,strokeWidth:o,opacity:l},e.find(s=>(s.type==="arrow"||s.type==="line"||s.type==="bezier")&&s.endBinding?.elementId===t.id);for(const s of t.children)this.styleSubtree(s,n,r+1,e)}getUpdates(t,n,r=new Map){const e={x:t.x,y:t.y,...t.styleUpdates};r.set(t.id,e);const o=n.find(l=>(l.type==="arrow"||l.type==="line"||l.type==="bezier")&&l.endBinding?.elementId===t.id);o&&t.styleUpdates&&r.set(o.id,{strokeColor:t.styleUpdates.strokeColor,strokeWidth:t.styleUpdates.strokeWidth,opacity:t.styleUpdates.opacity});for(const l of t.children)this.getUpdates(l,n,r);return r}}function Co(i=170,t=26,n=1,r=0){return e=>{if(e===0||e===1)return e;const l=e*1,s=Math.max(n,.01),a=Math.max(i,.01),c=Math.sqrt(a/s),h=t/(2*Math.sqrt(a*s)),d=-1,u=r;let f;const g=.001;if(h<1-g){const p=c*Math.sqrt(1-h*h),m=Math.exp(-h*c*l),y=d,w=(u+h*c*d)/p;f=1+m*(y*Math.cos(p*l)+w*Math.sin(p*l))}else if(h>1+g){const p=-c*(h+Math.sqrt(h*h-1)),m=-c*(h-Math.sqrt(h*h-1)),y=(u-m*d)/(p-m),w=d-y;f=1+y*Math.exp(p*l)+w*Math.exp(m*l)}else f=1+Math.exp(-c*l)*(d+(u+c*d)*l);return f}}const he={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>i*(2-i),easeInOutQuad:i=>i<.5?2*i*i:-1+(4-2*i)*i,easeInCubic:i=>i*i*i,easeOutCubic:i=>--i*i*i+1,easeInOutCubic:i=>i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1,easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:1-Math.pow(2,-10*i),easeInOutExpo:i=>i===0?0:i===1?1:i<.5?Math.pow(2,10*(2*i-1))/2:(2-Math.pow(2,-10*(2*i-1)))/2,easeOutBounce:i=>i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375,easeInBounce:i=>1-he.easeOutBounce(1-i),easeInOutBounce:i=>i<.5?(1-he.easeOutBounce(1-2*i))/2:(1+he.easeOutBounce(2*i-1))/2,easeOutElastic:i=>{const t=2*Math.PI/3;return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*t)+1},easeInElastic:i=>{const t=2*Math.PI/3;return i===0?0:i===1?1:-Math.pow(2,10*i-10)*Math.sin((i*10-10.75)*t)},easeOutBack:i=>1+2.70158*Math.pow(i-1,3)+1.70158*Math.pow(i-1,2),easeInBack:i=>2.70158*i*i*i-1.70158*i*i,easeSpring:Co(170,26,1,0)};function Ti(i){return i?typeof i=="function"?i:he[i]??he.linear:he.linear}function de(i,t,n){return isNaN(i)?t:isNaN(t)?i:i+(t-i)*n}function Tc(i,t,n){if(!i)return t||"#000000";if(!t)return i;const r=f=>{const g=f.replace("#","");return g.length<6?[0,0,0]:[parseInt(g.substring(0,2),16)||0,parseInt(g.substring(2,4),16)||0,parseInt(g.substring(4,6),16)||0]},[e,o,l]=r(i),[s,a,c]=r(t),h=Math.round(de(e,s,n)),d=Math.round(de(o,a,n)),u=Math.round(de(l,c,n));return`#${h.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`}const[Lc,Ic]=H(0),[Ur,$c]=H(0),[K1,qr]=H(!1),[ae,gi]=H(!1),[Ht,yi]=H(!1);class Rc{animations=new Map;rafId=null;isRunning=!1;forceTicker=!1;lastTickTime=0;setForceTicker(t){this.forceTicker=t,t&&this.ensureLoopRunning()}create(t,n,r){const e={id:t,state:"idle",startTime:0,pauseTime:null,duration:r.duration??0,delay:r.delay??0,easing:Ti(r.easing),onUpdate:n,onComplete:r.onComplete,onStart:r.onStart,loop:r.loop??!1,loopCount:r.loopCount??1/0,currentLoop:0,alternate:r.alternate??!1,direction:1};return this.animations.set(t,e),t}start(t){const n=this.animations.get(t);if(n){if(n.state==="paused"&&n.pauseTime!==null){const r=n.pauseTime-n.startTime;n.startTime=performance.now()-r,n.pauseTime=null}else n.startTime=performance.now(),n.currentLoop=0,n.direction=1;n.state="running",n.onStart?.(),this.ensureLoopRunning()}}pause(t){const n=this.animations.get(t);!n||n.state!=="running"||(n.state="paused",n.pauseTime=performance.now())}stop(t){const n=this.animations.get(t);n&&(n.state="completed",this.animations.delete(t),this.animations.size===0&&!this.forceTicker&&this.stopLoop())}reset(t){const n=this.animations.get(t);n&&(n.state="idle",n.startTime=0,n.pauseTime=null,n.currentLoop=0,n.direction=1,n.onUpdate(0))}getState(t){return this.animations.get(t)?.state??null}has(t){return this.animations.has(t)}stopAll(){this.animations.clear(),gi(!1),yi(!1),this.stopLoop()}pauseAll(){for(const t of this.animations.values())t.state==="running"&&(t.state="paused",t.pauseTime=performance.now())}resumeAll(){const t=performance.now();for(const n of this.animations.values())if(n.state==="paused"&&n.pauseTime!==null){const r=n.pauseTime-n.startTime;n.startTime=t-r,n.pauseTime=null,n.state="running"}this.ensureLoopRunning()}tick=t=>{if(!this.isRunning){this.lastTickTime=0;return}this.lastTickTime===0&&(this.lastTickTime=t);const n=t-this.lastTickTime;this.lastTickTime=t;const r=b.globalSettings?.animationEnabled??!0;let e=!1;ee(()=>{Ic(t),Ht()||$c(l=>l+n);for(const l of this.animations.values()){if(l.state!=="running")continue;if(e=!0,!r){l.onUpdate(1),l.state="completed",l.onComplete?.(),this.animations.delete(l.id);continue}const s=t-l.startTime-l.delay;if(s<0)continue;let a=Math.min(s/l.duration,1);l.direction===-1&&(a=1-a);const c=l.easing(a);l.onUpdate(c),s>=l.duration&&(l.loop&&l.currentLoop<l.loopCount-1?(l.currentLoop++,l.startTime=t,l.alternate&&(l.direction=l.direction===1?-1:1)):(l.state="completed",l.onComplete?.(),this.animations.delete(l.id)))}});let o=!1;if(!e){for(const l of this.animations.values())if(l.state==="paused"){o=!0;break}}gi(e),yi(o),e||this.animations.size>0||this.forceTicker?this.rafId=requestAnimationFrame(this.tick):this.stopLoop()};ensureLoopRunning(){this.isRunning||(this.isRunning=!0,qr(!0),this.rafId=requestAnimationFrame(this.tick))}stopLoop(){this.isRunning=!1,qr(!1),gi(!1),yi(!1),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}const st=new Rc;let Ec=0;function Te(i="anim"){return`${i}-${Date.now()}-${++Ec}`}function mi(i){const{width:t,height:n}=i.dimensions,{x:r,y:e}=i.spatialPosition,o=40,l=window.innerWidth-o*2,s=window.innerHeight-o*2,a=l/t,c=s/n,h=Math.min(a,c),d=(window.innerWidth-t*h)/2-r*h,u=(window.innerHeight-n*h)/2-e*h;return{scale:h,panX:d,panY:u}}class Nc{activeAnimationId=null;isTransitioning=!1;fadeOverlay=null;get transitioning(){return this.isTransitioning}async transitionTo(t,n){if(t<0||t>=b.slides.length||t===b.activeSlideIndex&&!this.isTransitioning)return;this.cancelActiveTransition();const r=b.activeSlideIndex,e=b.slides[r],o=b.slides[t],l=o.transition||Ye,s=t>r?"forward":"backward",a={fromSlide:e,toSlide:o,fromIndex:r,toIndex:t,direction:s};if(n?.skipAnimation||l.type==="none"||b.globalSettings?.animationEnabled===!1||b.globalSettings?.reducedMotion===!0){this.applyImmediateSwitch(t);return}this.isTransitioning=!0;try{await this.executeTransition(a,l)}finally{this.isTransitioning=!1,this.activeAnimationId=null}}applyImmediateSwitch(t){P("activeSlideIndex",t);const n=b.slides[t];if(n){const r=b.appMode==="design"&&n.lastViewState?n.lastViewState:mi(n);St(r)}}cancelActiveTransition(){this.activeAnimationId&&(st.stop(this.activeAnimationId),this.activeAnimationId=null),this.removeFadeOverlay(),this.isTransitioning=!1}async executeTransition(t,n){switch(n.type){case"fade":return this.executeFade(t,n);case"slide-left":case"slide-right":case"slide-up":case"slide-down":return this.executeSlide(t,n);case"zoom-in":case"zoom-out":return this.executeZoom(t,n);default:this.applyImmediateSwitch(t.toIndex)}}executeFade(t,n){return new Promise(r=>{const e=n.duration/2,o=t.toSlide.backgroundColor||"#ffffff";this.fadeOverlay=document.createElement("div"),this.fadeOverlay.style.cssText=`
                position: fixed;
                inset: 0;
                z-index: 99999;
                background: ${o};
                opacity: 0;
                pointer-events: none;
                transition: opacity ${e}ms ease-in-out;
            `,document.body.appendChild(this.fadeOverlay),requestAnimationFrame(()=>{this.fadeOverlay&&(this.fadeOverlay.style.opacity="1")}),setTimeout(()=>{this.applyImmediateSwitch(t.toIndex),this.fadeOverlay&&(this.fadeOverlay.style.opacity="0"),setTimeout(()=>{this.removeFadeOverlay(),r()},e)},e)})}executeSlide(t,n){return new Promise(r=>{const e=mi(t.toSlide),o=window.innerWidth,l=window.innerHeight;let s=0,a=0;switch(n.type){case"slide-left":s=o;break;case"slide-right":s=-o;break;case"slide-up":a=l;break;case"slide-down":a=-l;break}t.direction==="backward"&&(s=-s,a=-a);const c=e.panX+s,h=e.panY+a;P("activeSlideIndex",t.toIndex);const d=Te("slide-transition");this.activeAnimationId=d;const u=Ti(n.easing);st.create(d,f=>{const g=u(f),p=de(c,e.panX,g),m=de(h,e.panY,g);St({panX:p,panY:m,scale:e.scale})},{duration:n.duration,onComplete:()=>{this.activeAnimationId=null,St(e),r()}}),st.start(d)})}executeZoom(t,n){return new Promise(r=>{const e=mi(t.toSlide),l=n.type==="zoom-in"?e.scale*.15:e.scale*3,s=t.toSlide.spatialPosition.x+t.toSlide.dimensions.width/2,a=t.toSlide.spatialPosition.y+t.toSlide.dimensions.height/2,c=window.innerWidth/2,h=window.innerHeight/2;P("activeSlideIndex",t.toIndex);const d=Te("zoom-transition");this.activeAnimationId=d;const u=Ti(n.easing);st.create(d,f=>{const g=u(f),p=de(l,e.scale,g),m=c-s*p,y=h-a*p;St({scale:p,panX:m,panY:y})},{duration:n.duration,onComplete:()=>{this.activeAnimationId=null,St(e),r()}}),st.start(d)})}removeFadeOverlay(){this.fadeOverlay&&this.fadeOverlay.parentNode&&(this.fadeOverlay.parentNode.removeChild(this.fadeOverlay),this.fadeOverlay=null)}async previewTransition(t){if(!(t<0||t>=b.slides.length))if(t===0){const n=b.slides[0],r=n.transition||Ye;await this.executeTransition({fromSlide:n,toSlide:n,fromIndex:-1,toIndex:0,direction:"forward"},r)}else await this.transitionTo(t-1,{skipAnimation:!0}),await new Promise(n=>setTimeout(n,300)),await this.transitionTo(t)}}const bi=new Nc;class ue{static parsePath(t){const n=[],r=t.match(/[a-zA-Z]|[-+]?[0-9]*\.?[0-9]+/g);if(!r)return[];let e=0,o=0,l=0,s=0,a=0;for(;a<r.length;){const c=r[a];switch(a++,c){case"M":{const h=parseFloat(r[a++]),d=parseFloat(r[a++]);e=h,o=d,l=h,s=d;break}case"L":{const h=parseFloat(r[a++]),d=parseFloat(r[a++]),u=Math.hypot(h-e,d-o);n.push({type:"L",start:{x:e,y:o},points:[{x:h,y:d}],length:u}),e=h,o=d;break}case"Q":{const h=parseFloat(r[a++]),d=parseFloat(r[a++]),u=parseFloat(r[a++]),f=parseFloat(r[a++]),g=this.estimateBezierLength(e,o,h,d,u,f);n.push({type:"Q",start:{x:e,y:o},points:[{x:h,y:d},{x:u,y:f}],length:g}),e=u,o=f;break}case"C":{const h=parseFloat(r[a++]),d=parseFloat(r[a++]),u=parseFloat(r[a++]),f=parseFloat(r[a++]),g=parseFloat(r[a++]),p=parseFloat(r[a++]),m=this.estimateCubicBezierLength(e,o,h,d,u,f,g,p);n.push({type:"C",start:{x:e,y:o},points:[{x:h,y:d},{x:u,y:f},{x:g,y:p}],length:m}),e=g,o=p;break}case"Z":{const h=Math.hypot(l-e,s-o);h>0&&n.push({type:"L",start:{x:e,y:o},points:[{x:l,y:s}],length:h}),e=l,o=s;break}}}return n}static getPointOnPath(t,n){if(t.length===0)return{x:0,y:0,angle:0};const r=t.reduce((l,s)=>l+s.length,0),e=n*r;let o=0;for(const l of t){if(o+l.length>=e||l===t[t.length-1]){const s=Math.max(0,Math.min(1,(e-o)/l.length));return this.interpolateSegment(l,s)}o+=l.length}return this.interpolateSegment(t[t.length-1],1)}static interpolateSegment(t,n){const{start:r}=t;let e=0,o=0,l=0;if(t.type==="L"){const s=t.points[0];e=r.x+(s.x-r.x)*n,o=r.y+(s.y-r.y)*n,l=Math.atan2(s.y-r.y,s.x-r.x)}else if(t.type==="Q"){const s=t.points[0],a=t.points[1],c=1-n;e=c*c*r.x+2*c*n*s.x+n*n*a.x,o=c*c*r.y+2*c*n*s.y+n*n*a.y;const h=2*c*(s.x-r.x)+2*n*(a.x-s.x),d=2*c*(s.y-r.y)+2*n*(a.y-s.y);l=Math.atan2(d,h)}else if(t.type==="C"){const s=t.points[0],a=t.points[1],c=t.points[2],h=1-n,d=h*h,u=n*n;e=d*h*r.x+3*d*n*s.x+3*h*u*a.x+u*n*c.x,o=d*h*r.y+3*d*n*s.y+3*h*u*a.y+u*n*c.y;const f=3*d*(s.x-r.x)+6*h*n*(a.x-s.x)+3*u*(c.x-a.x),g=3*d*(s.y-r.y)+6*h*n*(a.y-s.y)+3*u*(c.y-a.y);l=Math.atan2(g,f)}return{x:e,y:o,angle:l}}static estimateBezierLength(t,n,r,e,o,l){const s=Math.hypot(o-t,l-n);return(Math.hypot(r-t,e-n)+Math.hypot(o-r,l-e)+s)/2}static estimateCubicBezierLength(t,n,r,e,o,l,s,a){const c=Math.hypot(s-t,a-n);return(Math.hypot(r-t,e-n)+Math.hypot(o-r,l-e)+Math.hypot(s-o,a-l)+c)/2}static svgToPoints(t){const n=this.parsePath(t),r=[];if(n.length===0)return[];r.push({x:n[0].start.x,y:n[0].start.y,type:"anchor"});for(const e of n)e.type==="L"?r.push({x:e.points[0].x,y:e.points[0].y,type:"anchor"}):e.type==="Q"?(r.push({x:e.points[0].x,y:e.points[0].y,type:"control"}),r.push({x:e.points[1].x,y:e.points[1].y,type:"anchor"})):e.type==="C"&&(r.push({x:e.points[0].x,y:e.points[0].y,type:"control"}),r.push({x:e.points[1].x,y:e.points[1].y,type:"control_end"}),r.push({x:e.points[2].x,y:e.points[2].y,type:"anchor"}));return r}static pointsToSvg(t){if(t.length===0)return"";let n=`M ${Math.round(t[0].x)} ${Math.round(t[0].y)}`,r=1;for(;r<t.length;){const e=t[r];if(e.type.includes("control")){const o=t[r+1];if(!o)break;if(o.type.includes("control")){const l=t[r+2];l&&l.type==="anchor"?(n+=` C ${Math.round(e.x)} ${Math.round(e.y)} ${Math.round(o.x)} ${Math.round(o.y)} ${Math.round(l.x)} ${Math.round(l.y)}`,r+=3):r++}else o.type==="anchor"?(n+=` Q ${Math.round(e.x)} ${Math.round(e.y)} ${Math.round(o.x)} ${Math.round(o.y)}`,r+=2):r++}else n+=` L ${Math.round(e.x)} ${Math.round(e.y)}`,r++}return n}}const cn=(i,t,n,r,e)=>`M ${i+e} ${t} L ${i+n-e} ${t} Q ${i+n} ${t} ${i+n} ${t+e} L ${i+n} ${t+r-e} Q ${i+n} ${t+r} ${i+n-e} ${t+r} L ${i+e} ${t+r} Q ${i} ${t+r} ${i} ${t+r-e} L ${i} ${t+e} Q ${i} ${t} ${i+e} ${t}`,Ft=i=>{if(i.points&&i.points.length>0)return console.log("[getShapeGeometry] Using custom points:",i.id,i.points.length),{type:"points",points:i.points};const t=i.width,n=i.height,r=t/2,e=n/2,o=-r,l=-e;switch(i.type){case"rectangle":case"image":case"text":case"umlClass":case"umlNote":case"umlPackage":case"umlActor":case"umlComponent":case"umlLifeline":case"umlFragment":return{type:"rect",x:o,y:l,w:t,h:n,r:i.roundness?10:0};case"umlState":return{type:"rect",x:o,y:l,w:t,h:n,r:Math.min(Math.abs(t),Math.abs(n))*.15};case"umlInterface":case"umlUseCase":case"umlProvidedInterface":case"circle":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:n/2};case"umlRequiredInterface":{const s=Math.min(t,n)/2;return{type:"path",path:`M 0 ${-s} A ${s} ${s} 0 0 1 0 ${s}`}}case"umlSignalSend":{const s=t*.2;return{type:"points",points:[{x:-r,y:-e},{x:r-s,y:-e},{x:r,y:0},{x:r-s,y:e},{x:-r,y:e}]}}case"umlSignalReceive":{const s=t*.2;return{type:"points",points:[{x:-r+s,y:-e},{x:r,y:-e},{x:r,y:e},{x:-r+s,y:e},{x:-r,y:0}]}}case"triangle":return{type:"points",points:[{x:0,y:-e},{x:-r,y:e},{x:r,y:e}]};case"diamond":return{type:"points",points:[{x:0,y:-e},{x:r,y:0},{x:0,y:e},{x:-r,y:0}]};case"hexagon":{const s=[];for(let a=0;a<6;a++){const c=Math.PI/3*a-Math.PI/2;s.push({x:t/2*Math.cos(c),y:n/2*Math.sin(c)})}return{type:"points",points:s}}case"octagon":{const s=[];for(let a=0;a<8;a++){const c=Math.PI/4*a-Math.PI/2;s.push({x:t/2*Math.cos(c),y:n/2*Math.sin(c)})}return{type:"points",points:s}}case"pentagon":{const s=[];for(let a=0;a<5;a++){const c=Math.PI*2/5*a-Math.PI/2;s.push({x:t/2*Math.cos(c),y:n/2*Math.sin(c)})}return{type:"points",points:s}}case"septagon":{const s=[];for(let a=0;a<7;a++){const c=Math.PI*2/7*a-Math.PI/2;s.push({x:t/2*Math.cos(c),y:n/2*Math.sin(c)})}return{type:"points",points:s}}case"star":{const s=Math.min(t,n)/2,a=(i.shapeRatio!==void 0?i.shapeRatio:38)/100,c=s*a,h=i.starPoints||5,d=[];for(let u=0;u<h*2;u++){const f=Math.PI/h*u-Math.PI/2,g=u%2===0?s:c;d.push({x:g*Math.cos(f),y:g*Math.sin(f)})}return{type:"points",points:d}}case"burst":{const s=Math.min(Math.abs(t),Math.abs(n))/2,a=(i.shapeRatio!==void 0?i.shapeRatio:70)/100,c=s*a,h=i.burstPoints||16,d=[];for(let u=0;u<h*2;u++){const f=Math.PI/h*u-Math.PI/2,g=u%2===0?s:c;d.push({x:g*Math.cos(f),y:g*Math.sin(f)})}return{type:"points",points:d}}case"parallelogram":{const s=t*.2;return{type:"points",points:[{x:o+s,y:l},{x:o+t,y:l},{x:o+t-s,y:l+n},{x:o,y:l+n}]}}case"trapezoid":{const s=t*.2;return{type:"points",points:[{x:o+s,y:l},{x:o+t-s,y:l},{x:o+t,y:l+n},{x:o,y:l+n}]}}case"rightTriangle":return{type:"points",points:[{x:o,y:l},{x:o,y:l+n},{x:o+t,y:l+n}]};case"capsule":return{type:"path",path:cn(o,l,t,n,Math.min(t,n)/2)};case"stickyNote":{const s=Math.min(t,n)*.15;return{type:"points",points:[{x:o,y:l},{x:o+t,y:l},{x:o+t,y:l+n-s},{x:o+t-s,y:l+n},{x:o,y:l+n}]}}case"callout":{const s=n*.2,a=n-s;return{type:"path",path:`M ${o} ${l} L ${o+t} ${l} L ${o+t} ${l+a} L ${o+t*.7} ${l+a} L 0 ${e} L ${o+t*.3} ${l+a} L ${o} ${l+a} Z`}}case"speechBubble":{const s=Math.min(t,n)*((i.borderRadius!==void 0?i.borderRadius:20)/100),a=t*.15,c=n*.2,h=n-c,d=(i.tailPosition!==void 0?i.tailPosition:20)/100,u=o+t*d;let f,g;d<=.5?(f=u+t*.1,g=f+a):(g=u-t*.1,f=g-a);const p=Math.min(t/2,s),m=Math.min(h/2,s);return{type:"path",path:`M ${o+p} ${l} L ${o+t-p} ${l} Q ${o+t} ${l} ${o+t} ${l+m} L ${o+t} ${l+h-m} Q ${o+t} ${l+h} ${o+t-p} ${l+h} L ${g} ${l+h} L ${u} ${e} L ${f} ${l+h} L ${o+p} ${l+h} Q ${o} ${l+h} ${o} ${l+h-m} L ${o} ${l+m} Q ${o} ${l} ${o+p} ${l} Z`}}case"cloud":{const s=t*.2,a=t*.25,c=t*.2,h=t*.3;return{type:"path",path:`M ${o+s} 0 A ${s} ${s} 0 0 1 ${o+t*.3} ${l+a} A ${a} ${a} 0 0 1 ${o+t*.7} ${l+a} A ${c} ${c} 0 0 1 ${o+t-c} 0 A ${h} ${h} 0 0 1 ${o+t*.6} ${l+n-h*.5} A ${h} ${h} 0 0 1 ${o+t*.3} ${l+n-h*.5} A ${h} ${h} 0 0 1 ${o+s} 0 Z`}}case"heart":return{type:"path",path:`M 0 ${l+n*.3} C 0 ${l+n*.15} ${o+t*.3} ${l} ${o+t*.5} ${l+n*.15} C ${o+t*.7} ${l} ${o+t} ${l+n*.15} ${o+t} ${l+n*.35} C ${o+t} ${l+n*.6} 0 ${l+n*.8} 0 ${l+n} C 0 ${l+n*.8} ${o} ${l+n*.6} ${o} ${l+n*.35} C ${o} ${l+n*.15} ${o+t*.3} ${l} ${o+t*.5} ${l+n*.15} Z`};case"polygon":{const s=i.polygonSides||6,a=[];for(let c=0;c<s;c++){const h=2*Math.PI/s*c-Math.PI/2;a.push({x:t/2*Math.cos(h),y:n/2*Math.sin(h)})}return{type:"points",points:a}}case"starPerson":{const s=Math.min(t,n)*.15,a=l+s*2;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:l+s,rx:s,ry:s},{type:"points",points:[{x:0,y:a},{x:o,y:l+n*.4},{x:0,y:l+n*.5},{x:o+t,y:l+n*.4},{x:0,y:a},{x:o+t*.8,y:l+n},{x:0,y:l+n*.7},{x:o+t*.2,y:l+n},{x:0,y:a}]}]}}case"lightbulb":{const s=Math.min(t,n/1.5)/2,a=t*.4,c=n*.25,h=l+n-c;return{type:"multi",shapes:[{type:"path",path:`M ${-a/2} ${h} C ${-a/2} ${l+s} ${o} ${l+s*1.5} ${o} ${l+s} A ${s} ${s} 0 1 1 ${o+t} ${l+s} C ${o+t} ${l+s*1.5} ${a/2} ${l+s} ${a/2} ${h} Z`},{type:"rect",x:-a/2,y:h,w:a,h:c}]}}case"signpost":{const s=Math.max(4,t*.05),a=n*.3,c=t*.9,h=l+n*.1;return{type:"multi",shapes:[{type:"rect",x:-s/2,y:l,w:s,h:n},{type:"rect",x:-c/2,y:h,w:c,h:a}]}}case"burstBlob":{const s=t/2,a=n/2,c=12,h=Math.min(s,a),d=h*.6,u=i.seed||1,f=p=>{let m=p+=1831565813;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296},g=[];for(let p=0;p<c*2;p++){const y=(p%2===0?h:d)+(f(u+p)-.5)*(h*.1),w=Math.PI*p/c;g.push({x:Math.cos(w)*(t/n)*y,y:Math.sin(w)*y})}return{type:"points",points:g}}case"scroll":{const s=n*.15;return{type:"path",path:`M ${o} ${l+s} L ${o+t} ${l+s} L ${o+t} ${l+n-s} L ${o} ${l+n-s} Z M ${o} ${l+s} C ${o-s} ${l+s} ${o-s} ${l} ${o} ${l} L ${o+t} ${l} C ${o+t+s} ${l} ${o+t+s} ${l+s} ${o+t} ${l+s} M ${o} ${l+n-s} C ${o-s} ${l+n-s} ${o-s} ${l+n} ${o} ${l+n} L ${o+t} ${l+n} C ${o+t+s} ${l+n} ${o+t+s} ${l+n-s} ${o+t} ${l+n-s}`}}case"doubleBanner":{const s=t*.15,a=n*.25;return{type:"multi",shapes:[{type:"points",points:[{x:o+s,y:l+a},{x:o,y:l+a},{x:o+s/2,y:0},{x:o,y:e},{x:o+s,y:e}]},{type:"points",points:[{x:o+t-s,y:l+a},{x:o+t,y:l+a},{x:o+t-s/2,y:0},{x:o+t,y:e},{x:o+t-s,y:e}]},{type:"points",points:[{x:o+s,y:l},{x:o+t-s,y:l},{x:o+t-s,y:l+n-a},{x:o+s,y:l+n-a}]}]}}case"document":{const s=n*.1;return{type:"path",path:`M ${o} ${l} L ${o+t} ${l} L ${o+t} ${l+n-s} Q ${o+t*.75} ${l+n-s*2} ${o+t*.5} ${l+n-s} T ${o} ${l+n-s} Z`}}case"database":{const s=n*.1;return{type:"path",path:`M ${o} ${l+s} L ${o} ${l+n-s} A ${r} ${s} 0 0 0 ${o+t} ${l+n-s} L ${o+t} ${l+s} A ${r} ${s} 0 0 1 ${o} ${l+s}`}}case"predefinedProcess":case"internalStorage":return{type:"rect",x:o,y:l,w:t,h:n};case"cross":return{type:"multi",shapes:[{type:"points",points:[{x:o,y:l},{x:o+t,y:l+n}]},{type:"points",points:[{x:o+t,y:l},{x:o,y:l+n}]}]};case"checkmark":return{type:"points",points:[{x:o,y:l+n*.5},{x:o+t*.4,y:e},{x:o+t,y:l}]};case"wavyDivider":{let s=`M ${o} 0`;for(let a=1;a<=20;a++)s+=` L ${o+a/20*t} ${Math.sin(a/20*Math.PI*4)*(n/2)}`;return{type:"path",path:s}}case"ribbon":{const s=t*.15,a=n*.7;return{type:"path",path:`M ${o+s} ${l} L ${o+t-s} ${l} L ${o+t-s} ${l+a} L ${o+t} ${l+n/2} L ${o+t-s} ${l+n*.8} L ${o+s} ${l+n*.8} L ${o} ${l+n/2} L ${o+s} ${l+a} Z`}}case"bracketLeft":return{type:"points",isClosed:!1,points:[{x:o+t,y:l},{x:o,y:l+n/2},{x:o+t,y:l+n}]};case"bracketRight":return{type:"points",isClosed:!1,points:[{x:o,y:l},{x:o+t,y:l+n/2},{x:o,y:l+n}]};case"arrowLeft":{const s=n*.4,a=l+(n-s)/2,c=t*.4;return{type:"points",points:[{x:o+c,y:l},{x:o+c,y:a},{x:o+t,y:a},{x:o+t,y:a+s},{x:o+c,y:a+s},{x:o+c,y:l+n},{x:o,y:l+n/2}]}}case"arrowRight":{const s=n*.4,a=l+(n-s)/2,c=t*.4;return{type:"points",points:[{x:o+t-c,y:l},{x:o+t,y:l+n/2},{x:o+t-c,y:l+n},{x:o+t-c,y:a+s},{x:o,y:a+s},{x:o,y:a},{x:o+t-c,y:a}]}}case"arrowUp":{const s=t*.4,a=o+(t-s)/2,c=n*.4;return{type:"points",points:[{x:o+t/2,y:l},{x:o+t,y:l+c},{x:a+s,y:l+c},{x:a+s,y:l+n},{x:a,y:l+n},{x:a,y:l+c},{x:o,y:l+c}]}}case"arrowDown":{const s=t*.4,a=o+(t-s)/2,c=n*.4;return{type:"points",points:[{x:a,y:l},{x:a+s,y:l},{x:a+s,y:l+n-c},{x:o+t,y:l+n-c},{x:o+t/2,y:l+n},{x:o,y:l+n-c},{x:a,y:l+n-c}]}}case"dfdProcess":{const s=n*.25;return{type:"multi",shapes:[{type:"rect",x:o,y:l,w:t,h:n,r:10},{type:"points",points:[{x:o,y:l+s},{x:o+t,y:l+s}],isClosed:!1}]}}case"dfdDataStore":{const s=t*.2;return{type:"multi",shapes:[{type:"points",isClosed:!1,points:[{x:o+t,y:l},{x:o,y:l},{x:o,y:l+n},{x:o+t,y:l+n}]},{type:"points",isClosed:!1,points:[{x:o+s,y:l},{x:o+s,y:l+n}]}]}}case"isometricCube":{const s=(i.shapeRatio!==void 0?i.shapeRatio:25)/100,a=(i.sideRatio!==void 0?i.sideRatio:50)/100,c=o+t*a,h=o+t*(1-a),d=n*s,u=l+d,f=l+d/2;return{type:"multi",shapes:[{type:"points",points:[{x:h,y:l},{x:o+t,y:f},{x:c,y:u},{x:o,y:f}],shade:1.1},{type:"points",points:[{x:o,y:f},{x:c,y:u},{x:c,y:l+n},{x:o,y:l+n-d/2}],shade:.9},{type:"points",points:[{x:c,y:u},{x:o+t,y:f},{x:o+t,y:l+n-d/2},{x:c,y:l+n}],shade:.7}]}}case"solidBlock":{const s=i.depth!==void 0?i.depth:50,c=(i.viewAngle!==void 0?i.viewAngle:45)*Math.PI/180,h=s*Math.cos(c),d=s*Math.sin(c),u={x:o,y:l},f={x:o+t,y:l},g={x:o+t,y:l+n},p={x:o,y:l+n},m={x:o+h,y:l+d},y={x:o+t+h,y:l+d},w={x:o+t+h,y:l+n+d},v={x:o+h,y:l+n+d};return{type:"multi",shapes:[{type:"points",points:[m,y,w,v],shade:.6},{type:"points",points:[u,f,y,m],shade:1.1},{type:"points",points:[f,g,w,y],shade:.8},{type:"points",points:[g,p,v,w],shade:.7},{type:"points",points:[p,u,m,v],shade:.9},{type:"points",points:[u,f,g,p],shade:1}]}}case"perspectiveBlock":{const s=i.depth!==void 0?i.depth:50,c=(i.viewAngle!==void 0?i.viewAngle:45)*Math.PI/180,h=i.taper!==void 0?i.taper:0,d=(i.skewX!==void 0?i.skewX:0)*t,u=(i.skewY!==void 0?i.skewY:0)*n,f=i.frontTaper!==void 0?i.frontTaper:0,g=(i.frontSkewX!==void 0?i.frontSkewX:0)*t,p=(i.frontSkewY!==void 0?i.frontSkewY:0)*n,m=s*Math.cos(c)+d,y=s*Math.sin(c)+u,w=1-f,v=r*w,x=e*w,k={x:-v+g,y:-x+p},S={x:v+g,y:-x+p},M={x:v+g,y:x+p},C={x:-v+g,y:x+p},R=1-h,E=r*R,O=e*R,z={x:m-E,y:y-O},F={x:m+E,y:y-O},U={x:m+E,y:y+O},J={x:m-E,y:y+O};return{type:"multi",shapes:[{type:"points",points:[z,F,U,J],shade:.6},{type:"points",points:[k,S,F,z],shade:1.1},{type:"points",points:[S,M,U,F],shade:.8},{type:"points",points:[M,C,J,U],shade:.7},{type:"points",points:[C,k,z,J],shade:.9},{type:"points",points:[k,S,M,C],shade:1}]}}case"cylinder":{const s=i.depth!==void 0?i.depth:50,c=(i.viewAngle!==void 0?i.viewAngle:45)*Math.PI/180,h=t/2,d=n/2,u=s*Math.cos(c),f=s*Math.sin(c),g=0,p=0,m=u,y=f,w=Math.atan2(f*h*h,u*d*d)+Math.PI/2,v=h*Math.cos(w),x=d*Math.sin(w);return{type:"multi",shapes:[{type:"ellipse",cx:m,cy:y,rx:h,ry:d,shade:.6},{type:"points",points:[{x:g+v,y:p+x},{x:m+v,y:y+x},{x:m-v,y:y-x},{x:g-v,y:p-x}],shade:.8},{type:"ellipse",cx:g,cy:p,rx:h,ry:d,shade:1}]}}case"stateStart":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:n/2};case"stateEnd":return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:0,rx:t/2,ry:n/2},{type:"ellipse",cx:0,cy:0,rx:t/3,ry:n/3}]};case"stateSync":return{type:"rect",x:o,y:l,w:t,h:n,r:2};case"activationBar":return{type:"rect",x:o,y:l,w:t,h:n,r:0};case"externalEntity":return{type:"multi",shapes:[{type:"rect",x:o+4,y:l+4,w:t,h:n,r:0},{type:"rect",x:o,y:l,w:t,h:n,r:0}]};case"trophy":{const s=t*.6,a=t*.1,c=t*.5;return{type:"multi",shapes:[{type:"rect",x:-s/2,y:l,w:s,h:n*.55},{type:"rect",x:-a/2,y:l+n*.55,w:a,h:n*.25},{type:"rect",x:-c/2,y:l+n*.8,w:c,h:n*.2}]}}case"clock":case"target":{const s=Math.min(t,n)/2;return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"gear":{const s=Math.min(t,n)/2,a=s*.7,c=8,h=s-a,d=[];for(let u=0;u<c;u++){const f=Math.PI*2*u/c,g=Math.PI*2*(u+.35)/c,p=Math.PI*2*(u+.5)/c,m=Math.PI*2*(u+.85)/c;d.push({x:Math.cos(f)*a,y:Math.sin(f)*a},{x:Math.cos(g)*(a+h),y:Math.sin(g)*(a+h)},{x:Math.cos(p)*(a+h),y:Math.sin(p)*(a+h)},{x:Math.cos(m)*a,y:Math.sin(m)*a})}return{type:"points",points:d}}case"rocket":{const s=t*.5,a=n*.25,c=l+n*.75,h=t*.2,d=n*.25;let u=`M 0 ${l}`;return u+=` C ${s/2} ${l+a*.5} ${s/2} ${l+a} ${s/2} ${l+a}`,u+=` L ${s/2} ${c} L ${-s/2} ${c} L ${-s/2} ${l+a}`,u+=` C ${-s/2} ${l+a} ${-s/2} ${l+a*.5} 0 ${l} Z`,u+=` M ${-s/2} ${c-d*.3} L ${-s/2-h} ${c+d*.5} L ${-s/2} ${c} Z`,u+=` M ${s/2} ${c-d*.3} L ${s/2+h} ${c+d*.5} L ${s/2} ${c} Z`,{type:"path",path:u}}case"flag":{const s=Math.max(3,t*.04),a=o+t*.15-s/2,c=o+t*.15,h=o+t,d=n*.55,u=d*.15;return{type:"multi",shapes:[{type:"rect",x:a,y:l,w:s,h:n},{type:"path",path:`M ${c} ${l} C ${c+(h-c)*.33} ${l-u} ${c+(h-c)*.66} ${l+u} ${h} ${l} L ${h} ${l+d} C ${c+(h-c)*.66} ${l+d+u} ${c+(h-c)*.33} ${l+d-u} ${c} ${l+d} Z`}]}}case"key":{const s=t*.35,a=n*.25,c=l+a,h=t*.12,d=c+a*.7,u=l+n;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:c,rx:s,ry:a},{type:"rect",x:-h/2,y:d,w:h,h:u-d}]}}case"magnifyingGlass":{const s=Math.min(t,n)*.32,a=o+t*.42,c=l+n*.38,h=Math.max(t*.1,4),d=Math.PI/4,u=a+Math.cos(d)*s,f=c+Math.sin(d)*s,g=Math.min(t,n)*.4,p=u+Math.cos(d)*g,m=f+Math.sin(d)*g,y=Math.cos(d+Math.PI/2)*h/2,w=Math.sin(d+Math.PI/2)*h/2;let v=`M ${a-s} ${c}`;return v+=` A ${s} ${s} 0 1 1 ${a+s} ${c}`,v+=` A ${s} ${s} 0 1 1 ${a-s} ${c} Z`,v+=` M ${u+y} ${f+w} L ${p+y} ${m+w}`,v+=` L ${p-y} ${m-w} L ${u-y} ${f-w} Z`,{type:"path",path:v}}case"book":{const a=l+n*.05,c=l+n*.95,h=n*.08;let d=`M 0 ${a}`;return d+=` C ${0-t*.1} ${a+h} ${o+t*.05} ${a+h} ${o} ${a}`,d+=` L ${o} ${c}`,d+=` C ${o+t*.05} ${c-h} ${0-t*.1} ${c-h} 0 ${c} Z`,d+=` M 0 ${a}`,d+=` C ${0+t*.1} ${a+h} ${o+t*.95} ${a+h} ${o+t} ${a}`,d+=` L ${o+t} ${c}`,d+=` C ${o+t*.95} ${c-h} ${0+t*.1} ${c-h} 0 ${c} Z`,{type:"path",path:d}}case"megaphone":{const s=o+t*.15,a=o+t,c=l+n*.25,h=l+n*.5,d=l,u=l+n*.75,f=t*.12,g=n*.25,p=s-f*.3;return{type:"multi",shapes:[{type:"points",points:[{x:s,y:c},{x:a,y:d},{x:a,y:u},{x:s,y:h}]},{type:"rect",x:p,y:h,w:f,h:g}]}}case"eye":{const s=t/2,a=n/2;return{type:"path",path:`M ${o} 0 C ${o+s*.4} ${-a*1.3} ${o+s*1.6} ${-a*1.3} ${o+t} 0 C ${o+s*1.6} ${a*1.3} ${o+s*.4} ${a*1.3} ${o} 0 Z`}}case"thoughtBubble":{const s=n*.8,a=l+s/2,c=t*.48,h=s*.45,d=8;let u="";for(let f=0;f<d;f++){const g=Math.PI*2*f/d,p=Math.PI*2*(f+1)/d,m=(g+p)/2,y=Math.cos(g)*c,w=a+Math.sin(g)*h,v=Math.cos(m)*c*1.25,x=a+Math.sin(m)*h*1.25,k=Math.cos(p)*c,S=a+Math.sin(p)*h;f===0&&(u=`M ${y} ${w}`),u+=` Q ${v} ${x} ${k} ${S}`}return u+=" Z",{type:"path",path:u}}case"stickFigure":{const s=Math.min(t,n)*.12;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:l+s,rx:s,ry:s},{type:"points",points:[{x:o+t*.15,y:l+s*2},{x:o+t*.85,y:l+s*2},{x:o+t*.8,y:l+n},{x:o+t*.2,y:l+n}]}]}}case"sittingPerson":{const s=Math.min(t,n)*.11;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:l+s,rx:s,ry:s},{type:"points",points:[{x:o+t*.2,y:l+s*2},{x:o+t*.8,y:l+s*2},{x:o+t*.8,y:l+n},{x:0,y:l+n*.55}]}]}}case"presentingPerson":{const s=Math.min(t,n)*.1;return{type:"multi",shapes:[{type:"ellipse",cx:o+t*.3,cy:l+s,rx:s,ry:s},{type:"rect",x:o+t*.55,y:l,w:t*.45,h:n*.5}]}}case"handPointRight":{const s=o,a=o+t*.35,c=l+n*.15,h=l+n*.55,d=o+t,u=l+n*.08,f=l+n*.32,g=Math.min(t,n)*.06,p=o+t*.2,m=l,y=h,w=l+n,v=o+t*.08,x=a+t*.05,k=y+(w-y)*.33,S=y+(w-y)*.66;let M=`M ${s} ${c}`;return M+=` Q ${p-t*.05} ${m+n*.02} ${p} ${m}`,M+=` Q ${p+t*.08} ${m} ${a-t*.05} ${u+n*.02}`,M+=` L ${a} ${u} L ${d-g} ${u}`,M+=` Q ${d} ${u} ${d} ${(u+f)/2}`,M+=` Q ${d} ${f} ${d-g} ${f}`,M+=` L ${a} ${f} L ${x} ${y}`,M+=` Q ${x+t*.1} ${y+(k-y)*.5} ${x} ${k}`,M+=` Q ${x+t*.1} ${k+(S-k)*.5} ${x} ${S}`,M+=` Q ${x+t*.08} ${S+(w-S)*.5} ${x-t*.05} ${w}`,M+=` L ${v} ${w}`,M+=` Q ${s-t*.02} ${w} ${s} ${h} Z`,{type:"path",path:M}}case"thumbsUp":{const s=o+t*.1,a=o+t*.9,c=l+n*.42,h=l+n,d=Math.min(t,n)*.06,u=o+t*.28,f=o+t*.52,g=l,p=(f-u)/2;let m=`M ${u} ${c}`;return m+=` L ${u} ${g+p}`,m+=` Q ${u} ${g} ${(u+f)/2} ${g}`,m+=` Q ${f} ${g} ${f} ${g+p}`,m+=` L ${f} ${c} L ${a-d} ${c}`,m+=` Q ${a} ${c} ${a} ${c+d}`,m+=` L ${a} ${h-d}`,m+=` Q ${a} ${h} ${a-d} ${h}`,m+=` L ${s+d} ${h}`,m+=` Q ${s} ${h} ${s} ${h-d}`,m+=` L ${s} ${c+d}`,m+=` Q ${s} ${c} ${s+d} ${c} Z`,{type:"path",path:m}}case"faceHappy":case"faceSad":case"faceConfused":{const s=Math.min(t,n)/2;return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"checkbox":case"checkboxChecked":{const s=Math.min(t,n)*.15;return{type:"rect",x:o,y:l,w:t,h:n,r:s}}case"numberedBadge":case"questionMark":case"exclamationMark":{const s=Math.min(t,n)/2;return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"tag":{const s=o+t*.08;return{type:"points",points:[{x:s,y:l},{x:o+t,y:l},{x:o+t,y:l+n},{x:s,y:l+n},{x:o,y:0}]}}case"pin":{const s=Math.min(t,n)*.3,a=l+s,c=l+n;return{type:"path",path:`M 0 ${c} C ${-s*.6} ${a+s*1.5} ${-s} ${a+s*.5} ${-s} ${a} A ${s} ${s} 0 1 1 ${s} ${a} C ${s} ${a+s*.5} ${s*.6} ${a+s*1.5} 0 ${c} Z`}}case"stamp":{const s=Math.min(t,n)/2,a=s*.85,c=16,h=[];for(let d=0;d<c*2;d++){const u=Math.PI*2*d/(c*2),f=d%2===0?s:a;h.push({x:Math.cos(u)*f,y:Math.sin(u)*f})}return{type:"points",points:h}}case"kubernetes":case"cdn":{const s=Math.min(t,n)/2;return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"container":case"apiGateway":{const s=Math.min(t,n)*.06;return{type:"rect",x:o,y:l,w:t,h:n,r:s}}case"storageBlob":{const s=n*.075,a=l+s,c=l+n-s;return{type:"path",path:`M ${o} ${a} L ${o} ${c} A ${r} ${s} 0 0 0 ${o+t} ${c} L ${o+t} ${a} A ${r} ${s} 0 0 1 ${o} ${a}`}}case"eventBus":{const s=n*.25,a=l+(n-s)/2,c=s/2;return{type:"path",path:cn(o,a,t,s,c)}}case"microservice":{const s=[],a=t/2,c=n/2;for(let h=0;h<6;h++){const d=Math.PI*2*h/6-Math.PI/6;s.push({x:Math.cos(d)*a,y:Math.sin(d)*c})}return{type:"points",points:s}}case"shield":{const a=l,c=l+n*.55,h=l+n;return{type:"path",path:`M 0 ${a} L ${o+t} ${a} L ${o+t} ${c} Q ${o+t} ${h*.85+a*.15} 0 ${h} Q ${o} ${h*.85+a*.15} ${o} ${c} L ${o} ${a} Z`}}case"barChart":case"trendUp":case"trendDown":case"table":return{type:"rect",x:o,y:l,w:t,h:n};case"pieChart":{const s=Math.min(t,n)/2;return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"funnel":{const s=o,a=o+t,c=o+t*.3,h=o+t*.7;return{type:"points",points:[{x:s,y:l},{x:a,y:l},{x:h,y:l+n},{x:c,y:l+n}]}}case"gauge":{const s=Math.min(t/2,n*.8);return{type:"ellipse",cx:0,cy:0,rx:s,ry:s}}case"puzzlePiece":{const s=t*.15,a=n*.15;let c=`M ${o} ${l}`;return c+=` L ${o+t*.35} ${l}`,c+=` A ${a} ${a} 0 0 1 ${o+t*.65} ${l}`,c+=` L ${o+t} ${l}`,c+=` L ${o+t} ${l+n*.35}`,c+=` A ${s} ${s} 0 0 1 ${o+t} ${l+n*.65}`,c+=` L ${o+t} ${l+n}`,c+=` L ${o} ${l+n} Z`,{type:"path",path:c}}case"chainLink":{const s=t*.55,a=n*.4,c=a/2;return{type:"multi",shapes:[{type:"path",path:cn(o,l+n*.1,s,a,c)},{type:"path",path:cn(o+t-s,l+n*.5,s,a,c)}]}}case"bridge":{const s=l+n*.4;return{type:"path",path:`M ${o} ${s} Q 0 ${l} ${o+t} ${s} L ${o+t} ${l+n} L ${o} ${l+n} Z`}}case"magnet":{const s=t*.28,a=n-n*.35,c=(t-s*2)/2,h=t/2;let d=`M ${o} ${l}`;return d+=` L ${o} ${l+a}`,d+=` A ${h} ${h} 0 0 0 ${o+t} ${l+a}`,d+=` L ${o+t} ${l}`,d+=` L ${o+t-s} ${l}`,d+=` L ${o+t-s} ${l+a}`,d+=` A ${c} ${c} 0 0 1 ${o+s} ${l+a}`,d+=` L ${o+s} ${l} Z`,{type:"path",path:d}}case"scale":{const s=t*.3,a=n*.08,c=l+n*.15;return{type:"multi",shapes:[{type:"rect",x:o+t*.04,y:c,w:t*.92,h:n*.03},{type:"rect",x:-t*.02,y:c,w:t*.04,h:n*.77},{type:"rect",x:-s/2,y:l+n-a,w:s,h:a}]}}case"seedling":{const s=l+n*.75,a=l+n*.25,c=t*.3,h=n*.25;return{type:"multi",shapes:[{type:"ellipse",cx:-c*.35,cy:a,rx:c*.5,ry:h*.4},{type:"ellipse",cx:c*.2,cy:a-h*.4,rx:c*.4,ry:h*.45},{type:"ellipse",cx:0,cy:s,rx:t*.25,ry:n*.08}]}}case"tree":{const s=Math.min(t,n*.55)*.48,a=l+n*.38,c=a+s*.5,h=t*.18;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:a,rx:s,ry:s},{type:"rect",x:-h/2,y:c,w:h,h:l+n-c}]}}case"mountain":return{type:"points",points:[{x:-t*.05,y:l},{x:o+t,y:l+n},{x:o,y:l+n}]}}return null};class ve{static resamplePolygon(t,n){if(t.length<2)return Array(n).fill(t[0]||{x:0,y:0});let r=0;const e=[];for(let c=0;c<t.length;c++){const h=t[c],d=t[(c+1)%t.length],u=Math.hypot(d.x-h.x,d.y-h.y);r+=u,e.push({length:u,start:h,end:d})}if(r===0)return Array(n).fill(t[0]);const o=[],l=r/n;let s=0,a=0;for(let c=0;c<n;c++){const h=c*l;for(;a<e.length;){const d=e[a];if(s+d.length>=h){const f=(h-s)/d.length;o.push({x:d.start.x+(d.end.x-d.start.x)*f,y:d.start.y+(d.end.y-d.start.y)*f});break}else s+=d.length,a++}o.length<=c&&o.push(t[t.length-1])}return o}static interpolatePoints(t,n,r){return t.length!==n.length?(console.warn("Interpolation mismatch",t.length,n.length),t):t.map((e,o)=>{const l=n[o];return{x:e.x+(l.x-e.x)*r,y:e.y+(l.y-e.y)*r}})}static alignPolygons(t,n){if(t.length!==n.length)return n;let r=0,e=1/0;for(let l=0;l<n.length;l++){let s=0;for(let a=0;a<t.length;a++){const c=t[a],h=n[(a+l)%n.length];s+=(c.x-h.x)**2+(c.y-h.y)**2}s<e&&(e=s,r=l)}const o=Array(n.length);for(let l=0;l<n.length;l++)o[l]=n[(l+r)%n.length];return o}static getPointsFromElement(t,n){const r=n?{...t,type:n}:t;if(r.type==="line"||r.type==="arrow")return r.points||[{x:0,y:0},{x:r.width,y:r.height}];const e=Ft(r);return e?this.geometryToPoints(e,r.width,r.height):this.generateCirclePoints(r.width/2,r.height/2)}static geometryToPoints(t,n,r){switch(t.type){case"points":return t.points.length===0?[]:t.points;case"rect":return[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}];case"ellipse":const e=[],o=60;for(let c=0;c<o;c++){const h=c/o*Math.PI*2;e.push({x:t.cx+t.rx*Math.cos(h),y:t.cy+t.ry*Math.sin(h)})}return e;case"path":const l=ue.parsePath(t.path),s=[],a=60;for(let c=0;c<a;c++){const h=ue.getPointOnPath(l,c/a);s.push({x:h.x,y:h.y})}return s;case"multi":return t.shapes.length>0?this.geometryToPoints(t.shapes[0],n,r):[]}return[]}static generateCirclePoints(t,n){const r=[];for(let o=0;o<60;o++){const l=o/60*Math.PI*2;r.push({x:t*Math.cos(l),y:n*Math.sin(l)})}return r}}const pt=new Map;function Ge(i,t){const n=pt.get(i);if(!n)return;const r=[];for(const[e,o]of n.entries())for(const l of o)if(t.has(l)){r.push(e);break}r.forEach(e=>{st.stop(e),n.delete(e)}),n.size===0&&pt.delete(i)}function Li(i){const t=pt.get(i);t&&(t.forEach((n,r)=>st.stop(r)),pt.delete(i))}function Oc(i){const t=pt.get(i);return t?t.size>0:!1}function Bc(i,t){return i[t]}function B(i,t,n){const r=b.elements.find(h=>h.id===i);if(!r)return console.warn(`animateElement: Element ${i} not found`),"";const e=Te("el"),o={},l=[],s=[],a={},c=new Set;for(const h of Object.keys(t)){c.add(h);const d=Bc(r,h);d!==void 0?(o[h]=d,typeof d=="number"?l.push(h):typeof d=="string"&&s.push(h)):a[h]=t[h]}return Ge(i,c),pt.has(i)||pt.set(i,new Map),pt.get(i).set(e,c),Object.keys(a).length>0&&D(i,a,!1),st.create(e,h=>{const d={},u={};for(const f of l){const g=o[f],p=t[f],m=de(g,p,h);d[f]=m,u[f]=m}for(const f of s){const g=o[f],p=t[f];if(g&&p&&g.startsWith("#")&&p.startsWith("#")){const m=Tc(g,p,h);d[f]=m,u[f]=m}}D(i,d,!1),n.onUpdate?.(u)},{duration:n.duration,easing:n.easing,delay:n.delay,onStart:n.onStart,onComplete:()=>{const h=pt.get(i);h&&(h.delete(e),h.size===0&&pt.delete(i)),n.onComplete?.()},loop:n.loop,loopCount:n.loopCount,alternate:n.alternate}),st.start(e),e}function _o(i,t,n,r=0){return i.map((e,o)=>B(e,t,{...n,delay:(n.delay??0)+r*o}))}function Ao(i){st.stop(i)}function To(i){st.pause(i)}function Lo(i,t,n){const r=b.elements.find(h=>h.id===i);if(!r)return"";const e=ue.parsePath(t);if(e.length===0)return"";const o=Te("path"),l=new Set(["x","y"]);n.orientToPath&&l.add("angle"),Ge(i,l),pt.has(i)||pt.set(i,new Map),pt.get(i).set(o,l);const s=r.x+r.width/2,a=r.y+r.height/2,c=n.isRelative??!0;return st.create(o,h=>{const d=ue.getPointOnPath(e,h);let u,f;c?(u=s+d.x-r.width/2,f=a+d.y-r.height/2):(u=d.x-r.width/2,f=d.y-r.height/2);const g={x:u,y:f};n.orientToPath&&(g.angle=d.angle),D(i,g,!1),n.onUpdate?.({x:g.x,y:g.y,angle:g.angle})},{duration:n.duration,easing:n.easing,delay:n.delay,onStart:n.onStart,onComplete:()=>{const h=pt.get(i);h&&(h.delete(o),h.size===0&&pt.delete(i)),n.onComplete?.()},loop:n.loop,loopCount:n.loopCount,alternate:n.alternate}),st.start(o),o}function Io(i){st.start(i)}function $o(i,t=300,n={}){return D(i,{opacity:0},!1),B(i,{opacity:100},{duration:t,easing:"easeOutQuad",...n})}function Ro(i,t=300,n={}){return B(i,{opacity:0},{duration:t,easing:"easeOutQuad",...n})}function er(i,t=300,n={}){const r=b.elements.find(d=>d.id===i);if(!r)return"";const e=r.x,o=r.y,l=r.width,s=r.height,a=100,c=e+l/2,h=o+s/2;return D(i,{width:0,height:0,x:c,y:h,opacity:0},!1),B(i,{width:l,height:s,x:e,y:o,opacity:a},{duration:t,easing:"easeOutBack",onStart:n.onStart,onComplete:n.onComplete,delay:n.delay})}function ei(i,t=450,n={}){const r=b.elements.find(s=>s.id===i);if(!r)return"";const e=n.intensity??20,o=r.y;if(n.loop&&(n.loopCount===void 0||n.loopCount===1/0)){const s=a=>B(i,{y:o-e},{duration:t*.33,easing:"easeOutQuad",delay:a?n.delay:0,onStart:a?n.onStart:void 0,onComplete:()=>{B(i,{y:o},{duration:t*.67,easing:"easeOutBounce",onComplete:()=>s(!1)})}});return s(!0)}return B(i,{y:o-e},{duration:t*.33,easing:"easeOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{y:o},{duration:t*.67,easing:"easeOutBounce",onComplete:n.onComplete})}})}function ni(i,t=300,n={}){const r=b.elements.find(g=>g.id===i);if(!r)return"";const e=n.scale??1.1,o=r.width,l=r.height,s=r.x,a=r.y,c=o*e,h=l*e,d=(c-o)/2,u=(h-l)/2;if(n.loop&&(n.loopCount===void 0||n.loopCount===1/0)){const g=p=>B(i,{width:c,height:h,x:s-d,y:a-u},{duration:t/2,easing:"easeOutQuad",delay:p?n.delay:0,onStart:p?n.onStart:void 0,onComplete:()=>{B(i,{width:o,height:l,x:s,y:a},{duration:t/2,easing:"easeOutQuad",onComplete:()=>g(!1)})}});return g(!0)}return B(i,{width:c,height:h,x:s-d,y:a-u},{duration:t/2,easing:"easeOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{width:o,height:l,x:s,y:a},{duration:t/2,easing:"easeOutQuad",onComplete:n.onComplete})}})}function nr(i,t=1e3,n={}){return B(i,{opacity:0},{duration:t/4,easing:"linear",loop:!0,loopCount:2,alternate:!0,delay:n.delay,onStart:n.onStart,onComplete:n.onComplete})}function ir(i,t=1e3,n={}){const r=b.elements.find(a=>a.id===i);if(!r)return"";const e=r.width,o=r.height,l=r.x,s=r.y;return B(i,{width:e*1.25,height:o*.75,x:l-e*.25/2,y:s+o*.25/2},{duration:t*.3,easing:"easeOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{width:e*.75,height:o*1.25,x:l+e*.25/2,y:s-o*.25/2},{duration:t*.3,easing:"easeInOutQuad",onComplete:()=>{B(i,{width:e,height:o,x:l,y:s},{duration:t*.4,easing:"easeOutElastic",onComplete:n.onComplete})}})}})}function ii(i,t=400,n={}){const r=b.elements.find(s=>s.id===i);if(!r)return"";const e=n.intensity??10,o=r.x;return n.loop&&(n.loopCount===void 0||n.loopCount===1/0)?B(i,{x:o+e},{duration:t/4,easing:"linear",loop:!0,loopCount:1/0,alternate:!0,delay:n.delay,onStart:n.onStart}):B(i,{x:o+e},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:n.delay,onStart:n.onStart,onComplete:()=>{D(i,{x:o},!1),n.onComplete?.()}})}function rr(i,t=400,n={}){const r=b.elements.find(s=>s.id===i);if(!r)return"";const e=n.intensity??10,o=r.y;return n.loop&&(n.loopCount===void 0||n.loopCount===1/0)?B(i,{y:o+e},{duration:t/4,easing:"linear",loop:!0,loopCount:1/0,alternate:!0,delay:n.delay,onStart:n.onStart}):B(i,{y:o+e},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:n.delay,onStart:n.onStart,onComplete:()=>{D(i,{y:o},!1),n.onComplete?.()}})}function Eo(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.x;return B(i,{x:e-6},{duration:t/5,easing:"easeInOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{x:e+5},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{B(i,{x:e-3},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{B(i,{x:e+2},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{B(i,{x:e},{duration:t/5,easing:"easeInOutQuad",onComplete:n.onComplete})}})}})}})}})}function No(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.angle;return B(i,{angle:e+.25},{duration:t*.2,easing:"linear",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{angle:e-.17},{duration:t*.2,easing:"linear",onComplete:()=>{B(i,{angle:e+.08},{duration:t*.2,easing:"linear",onComplete:()=>{B(i,{angle:e-.05},{duration:t*.2,easing:"linear",onComplete:()=>{B(i,{angle:e},{duration:t*.2,easing:"linear",onComplete:n.onComplete})}})}})}})}})}function Oo(i,t=1e3,n={}){const r=b.elements.find(c=>c.id===i);if(!r)return"";const e=r.width,o=r.height,l=r.x,s=r.y,a=r.angle;return B(i,{width:e*.9,height:o*.9,x:l+e*.1/2,y:s+o*.1/2,angle:a-.05},{duration:t*.1,easing:"linear",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{width:e*1.1,height:o*1.1,x:l-e*.1/2,y:s-o*.1/2,angle:a+.05},{duration:t*.3,easing:"linear",loop:!0,loopCount:3,alternate:!0,onComplete:()=>{B(i,{width:e,height:o,x:l,y:s,angle:a},{duration:t*.1,easing:"linear",onComplete:n.onComplete})}})}})}function Bo(i,t=1e3,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.x,o=r.angle;return B(i,{x:e-r.width*.25,angle:o-.08},{duration:t*.15,easing:"linear",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{x:e+r.width*.2,angle:o+.05},{duration:t*.15,easing:"linear",onComplete:()=>{B(i,{x:e-r.width*.15,angle:o-.05},{duration:t*.15,easing:"linear",onComplete:()=>{B(i,{x:e+r.width*.1,angle:o+.03},{duration:t*.15,easing:"linear",onComplete:()=>{B(i,{x:e,angle:o},{duration:t*.15,easing:"linear",onComplete:n.onComplete})}})}})}})}})}function Do(i,t=1e3,n={}){const r=b.elements.find(a=>a.id===i);if(!r)return"";const e=r.width,o=r.height,l=r.x,s=r.y;return B(i,{width:e*1.1,height:o*.9,x:l-e*.1/2,y:s+o*.1/2},{duration:t*.2,easing:"linear",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{width:e*.9,height:o*1.1,x:l+e*.1/2,y:s-o*.1/2},{duration:t*.2,easing:"linear",onComplete:()=>{B(i,{width:e*1.05,height:o*.95,x:l-e*.05/2,y:s+o*.05/2},{duration:t*.2,easing:"linear",onComplete:()=>{B(i,{width:e,height:o,x:l,y:s},{duration:t*.4,easing:"easeOutQuad",onComplete:n.onComplete})}})}})}})}function zo(i,t=1300,n={}){const r=b.elements.find(a=>a.id===i);if(!r)return"";const e=r.width,o=r.height,l=r.x,s=r.y;return B(i,{width:e*1.3,height:o*1.3,x:l-e*.3/2,y:s-o*.3/2},{duration:t*.2,easing:"easeOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{width:e,height:o,x:l,y:s},{duration:t*.2,easing:"easeInQuad",onComplete:()=>{B(i,{width:e*1.3,height:o*1.3,x:l-e*.3/2,y:s-o*.3/2},{duration:t*.2,easing:"easeOutQuad",onComplete:()=>{B(i,{width:e,height:o,x:l,y:s},{duration:t*.4,easing:"easeInQuad",onComplete:n.onComplete})}})}})}})}function Fo(i,t=300,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.x+r.width/2,o=r.y+r.height/2;return B(i,{width:0,height:0,x:e,y:o,opacity:0},{duration:t,easing:"easeInBack",onStart:n.onStart,onComplete:n.onComplete,delay:n.delay})}function Dc(i,t=300,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.x,o=-r.width-50;return D(i,{x:o,opacity:0},!1),B(i,{x:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function zc(i,t=300,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.x,o=window.innerWidth+50;return D(i,{x:o,opacity:0},!1),B(i,{x:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function Fc(i,t=300,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.y,o=-r.height-50;return D(i,{y:o,opacity:0},!1),B(i,{y:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function Wc(i,t=300,n={}){const r=b.elements.find(l=>l.id===i);if(!r)return"";const e=r.y,o=window.innerHeight+50;return D(i,{y:o,opacity:0},!1),B(i,{y:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function jc(i,t=300,n={}){const r=b.elements.find(e=>e.id===i);return r?B(i,{x:-r.width,opacity:0},{duration:t,easing:"easeInQuad",...n}):""}function Uc(i,t=300,n={}){return B(i,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInQuad",...n})}function qc(i,t=300,n={}){const r=b.elements.find(e=>e.id===i);return r?B(i,{y:-r.height,opacity:0},{duration:t,easing:"easeInQuad",...n}):""}function Hc(i,t=300,n={}){return B(i,{y:window.innerHeight+100,opacity:0},{duration:t,easing:"easeInQuad",...n})}function ri(i,t,n,r={}){const e=b.elements.find(s=>s.id===i);if(!e)return"";const o=e.x,l=e.y;return D(i,{x:t.x??o,y:t.y??l,opacity:70,width:e.width*.7,height:e.height*.7},!1),B(i,{x:o,y:l,opacity:100,width:e.width,height:e.height},{duration:n,easing:"easeOutBack",...r})}function Wo(i,t=1e3,n={}){return ri(i,{y:-window.innerHeight},t,n)}function jo(i,t=1e3,n={}){return ri(i,{x:-window.innerWidth},t,n)}function Uo(i,t=1e3,n={}){return ri(i,{x:window.innerWidth+100},t,n)}function qo(i,t=1e3,n={}){return ri(i,{y:window.innerHeight+100},t,n)}function oi(i,t,n,r={}){const e=b.elements.find(o=>o.id===i);return e?B(i,{x:t.x??e.x,y:t.y??e.y,opacity:0,width:e.width*.7,height:e.height*.7},{duration:n,easing:"easeInBack",...r}):""}function Ho(i,t=1e3,n={}){return oi(i,{y:window.innerHeight+100},t,n)}function Yo(i,t=1e3,n={}){return oi(i,{x:-window.innerWidth},t,n)}function Xo(i,t=1e3,n={}){return oi(i,{x:window.innerWidth+100},t,n)}function Go(i,t=1e3,n={}){return oi(i,{y:-window.innerHeight},t,n)}function Ve(i,t,n,r={}){const e=b.elements.find(s=>s.id===i);if(!e)return"";const o=e.x,l=e.y;return D(i,{x:t.x??o,y:t.y??l,opacity:0,width:e.width*.3,height:e.height*.3},!1),B(i,{x:o,y:l,opacity:100,width:e.width,height:e.height},{duration:n,easing:"easeOutBounce",...r})}function Vo(i,t=750,n={}){return Ve(i,{},t,n)}function Qo(i,t=1e3,n={}){return Ve(i,{y:-window.innerHeight},t,n)}function Zo(i,t=1e3,n={}){return Ve(i,{x:-window.innerWidth},t,n)}function Jo(i,t=1e3,n={}){return Ve(i,{x:window.innerWidth+100},t,n)}function Ko(i,t=1e3,n={}){return Ve(i,{y:window.innerHeight+100},t,n)}function Qe(i,t,n,r={}){const e=b.elements.find(o=>o.id===i);return e?B(i,{x:t.x??e.x,y:t.y??e.y,opacity:0,width:e.width*.3,height:e.height*.3},{duration:n,easing:"easeInBounce",...r}):""}function ts(i,t=750,n={}){return Qe(i,{},t,n)}function es(i,t=1e3,n={}){return Qe(i,{y:window.innerHeight+100},t,n)}function ns(i,t=1e3,n={}){return Qe(i,{x:-window.innerWidth},t,n)}function is(i,t=1e3,n={}){return Qe(i,{x:window.innerWidth+100},t,n)}function rs(i,t=1e3,n={}){return Qe(i,{y:-window.innerHeight},t,n)}function Wt(i,t,n,r={}){const e=b.elements.find(s=>s.id===i);if(!e)return"";const o=e.x,l=e.y;return D(i,{x:t.x??o,y:t.y??l,opacity:0},!1),B(i,{x:o,y:l,opacity:100},{duration:n,easing:"easeOutQuad",...r})}function os(i,t=1e3,n={}){return Wt(i,{y:(b.selection.length>0,-100)},t,n)}function ss(i,t=1e3,n={}){return Wt(i,{y:-window.innerHeight},t,n)}function as(i,t=1e3,n={}){return Wt(i,{x:-100},t,n)}function ls(i,t=1e3,n={}){return Wt(i,{x:-window.innerWidth},t,n)}function cs(i,t=1e3,n={}){return Wt(i,{x:window.innerWidth+100},t,n)}function hs(i,t=1e3,n={}){return Wt(i,{x:window.innerWidth+2e3},t,n)}function ds(i,t=1e3,n={}){return Wt(i,{y:100},t,n)}function us(i,t=1e3,n={}){return Wt(i,{y:window.innerHeight+100},t,n)}function fs(i,t=1e3,n={}){return Wt(i,{x:-100,y:-100},t,n)}function ps(i,t=1e3,n={}){return Wt(i,{x:100,y:-100},t,n)}function gs(i,t=1e3,n={}){return Wt(i,{x:-100,y:100},t,n)}function ys(i,t=1e3,n={}){return Wt(i,{x:100,y:100},t,n)}function jt(i,t,n,r={}){const e=b.elements.find(o=>o.id===i);return e?B(i,{x:t.x??e.x,y:t.y??e.y,opacity:0},{duration:n,easing:"easeInQuad",...r}):""}function ms(i,t=1e3,n={}){return jt(i,{y:100},t,n)}function bs(i,t=1e3,n={}){return jt(i,{y:window.innerHeight+100},t,n)}function ws(i,t=1e3,n={}){return jt(i,{x:-100},t,n)}function vs(i,t=1e3,n={}){return jt(i,{x:-window.innerWidth},t,n)}function xs(i,t=1e3,n={}){return jt(i,{x:100},t,n)}function ks(i,t=1e3,n={}){return jt(i,{x:window.innerWidth+100},t,n)}function Ss(i,t=1e3,n={}){return jt(i,{y:-100},t,n)}function Ms(i,t=1e3,n={}){return jt(i,{y:-window.innerHeight},t,n)}function Ps(i,t=1e3,n={}){return jt(i,{x:-100,y:-100},t,n)}function Cs(i,t=1e3,n={}){return jt(i,{x:100,y:-100},t,n)}function _s(i,t=1e3,n={}){return jt(i,{x:-100,y:100},t,n)}function As(i,t=1e3,n={}){return jt(i,{x:100,y:100},t,n)}function Ts(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.angle;return B(i,{angle:e+Math.PI},{duration:t/2,easing:"easeInOutQuad",delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{angle:e+Math.PI*2},{duration:t/2,easing:"easeInOutQuad",onComplete:()=>{D(i,{angle:e},!1),n.onComplete?.()}})}})}function Ls(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.height;return D(i,{height:0,opacity:0},!1),B(i,{height:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function Is(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.width;return D(i,{width:0,opacity:0},!1),B(i,{width:e,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function $s(i,t=1e3,n={}){return B(i,{height:0,opacity:0},{duration:t,easing:"easeInQuad",...n})}function Rs(i,t=1e3,n={}){return B(i,{width:0,opacity:0},{duration:t,easing:"easeInQuad",...n})}function Es(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.x;return D(i,{x:window.innerWidth+100,opacity:0},!1),B(i,{x:e,opacity:100},{duration:t,easing:"easeOutExpo",...n})}function Ns(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.x;return D(i,{x:-window.innerWidth,opacity:0},!1),B(i,{x:e,opacity:100},{duration:t,easing:"easeOutExpo",...n})}function Os(i,t=1e3,n={}){return B(i,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInExpo",...n})}function Bs(i,t=1e3,n={}){return B(i,{x:-window.innerWidth,opacity:0},{duration:t,easing:"easeInExpo",...n})}function Ze(i,t,n,r={}){const e=b.elements.find(a=>a.id===i);if(!e)return"";const o=e.x,l=e.y,s=e.angle;return D(i,{x:t.x??o,y:t.y??l,angle:t.angle??s-Math.PI*2,opacity:0},!1),B(i,{x:o,y:l,angle:s,opacity:100},{duration:n,easing:"easeOutQuad",...r})}function Ds(i,t=1e3,n={}){return Ze(i,{},t,n)}function zs(i,t=1e3,n={}){return Ze(i,{x:-100,y:-100,angle:-Math.PI/2},t,n)}function Fs(i,t=1e3,n={}){return Ze(i,{x:100,y:-100,angle:Math.PI/2},t,n)}function Ws(i,t=1e3,n={}){return Ze(i,{x:-100,y:100,angle:Math.PI/2},t,n)}function js(i,t=1e3,n={}){return Ze(i,{x:100,y:100,angle:-Math.PI/2},t,n)}function Je(i,t,n,r={}){const e=b.elements.find(o=>o.id===i);return e?B(i,{x:t.x??e.x,y:t.y??e.y,angle:t.angle??e.angle+Math.PI*2,opacity:0},{duration:n,easing:"easeInQuad",...r}):""}function Us(i,t=1e3,n={}){return Je(i,{},t,n)}function qs(i,t=1e3,n={}){return Je(i,{x:-100,y:100,angle:Math.PI/2},t,n)}function Hs(i,t=1e3,n={}){return Je(i,{x:100,y:100,angle:-Math.PI/2},t,n)}function Ys(i,t=1e3,n={}){return Je(i,{x:-100,y:-100,angle:-Math.PI/2},t,n)}function Xs(i,t=1e3,n={}){return Je(i,{x:100,y:-100,angle:Math.PI/2},t,n)}function Yc(i,t=2e3,n={}){const r=b.elements.find(u=>u.id===i);if(!r)return"";const o=(n.params||{}).radius??50,l=r.x,s=r.y,a=l+o,c=s,h=new Set(["x","y"]),d=Te("revolve");return Ge(i,h),pt.has(i)||pt.set(i,new Map),pt.get(i).set(d,h),st.create(d,u=>{const f=u*Math.PI*2,g=a-o*Math.cos(f),p=c-o*Math.sin(f);D(i,{x:g,y:p},!1)},{duration:t,easing:n.easing||"linear",delay:n.delay,loop:n.loop,loopCount:n.loopCount,alternate:n.alternate,onComplete:()=>{const u=pt.get(i);u&&(u.delete(d),u.size===0&&pt.delete(i)),n.onComplete?.()}}),st.start(d),d}function Gs(i,t=2e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.angle;return B(i,{angle:e+1.2},{duration:t*.4,easing:"easeInOutQuad",alternate:!0,loop:!0,loopCount:2,delay:n.delay,onStart:n.onStart,onComplete:()=>{B(i,{y:window.innerHeight+500,opacity:0},{duration:t*.6,easing:"easeInQuad",onComplete:n.onComplete})}})}function Vs(i,t=1e3,n={}){const r=b.elements.find(a=>a.id===i);if(!r)return"";const e=r.width,o=r.height,l=r.x,s=r.y;return D(i,{width:0,height:0,x:l+e/2,y:s+o/2,angle:-.5,opacity:0},!1),B(i,{width:e,height:o,x:l,y:s,angle:0,opacity:100},{duration:t,easing:"easeOutBack",...n})}function Qs(i,t=1e3,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.x;return D(i,{x:e-400,angle:-Math.PI*2,opacity:0},!1),B(i,{x:e,angle:0,opacity:100},{duration:t,easing:"easeOutQuad",...n})}function Zs(i,t=1e3,n={}){const r=b.elements.find(e=>e.id===i);return r?B(i,{x:r.x+400,angle:Math.PI*2,opacity:0},{duration:t,easing:"easeInQuad",...n}):""}function Ke(i,t,n,r={}){const e=b.elements.find(g=>g.id===i);if(!e)return"";const o=e.x,l=e.y,s=e.width,a=e.height,c=t.scale??.1,h=s*c,d=a*c,u=(t.x??o)+(s-h)/2,f=(t.y??l)+(a-d)/2;return D(i,{x:u,y:f,width:h,height:d,opacity:0},!1),B(i,{x:o,y:l,width:s,height:a,opacity:100},{duration:n,easing:"easeOutQuad",...r})}function Js(i,t=1e3,n={}){return Ke(i,{},t,n)}function Ks(i,t=1e3,n={}){return Ke(i,{y:-window.innerHeight},t,n)}function ta(i,t=1e3,n={}){return Ke(i,{x:-window.innerWidth},t,n)}function ea(i,t=1e3,n={}){return Ke(i,{x:window.innerWidth+100},t,n)}function na(i,t=1e3,n={}){return Ke(i,{y:window.innerHeight+100},t,n)}function tn(i,t,n,r={}){const e=b.elements.find(l=>l.id===i);if(!e)return"";const o=t.scale??.1;return B(i,{x:(t.x??e.x)+e.width*(1-o)/2,y:(t.y??e.y)+e.height*(1-o)/2,width:e.width*o,height:e.height*o,opacity:0},{duration:n,easing:"easeInQuad",...r})}function ia(i,t=1e3,n={}){return tn(i,{},t,n)}function ra(i,t=1e3,n={}){return tn(i,{y:window.innerHeight+100},t,n)}function oa(i,t=1e3,n={}){return tn(i,{x:-window.innerWidth},t,n)}function sa(i,t=1e3,n={}){return tn(i,{x:window.innerWidth+100},t,n)}function aa(i,t=1e3,n={}){return tn(i,{y:-window.innerHeight},t,n)}function la(i,t=1500,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.opacity??100;return D(i,{drawProgress:0,opacity:0},!1),B(i,{drawProgress:100},{duration:t,easing:"easeInOutQuad",...n,onComplete:()=>{D(i,{drawProgress:void 0,opacity:e},!1),n.onComplete?.()}})}function ca(i,t=1500,n={}){const r=b.elements.find(o=>o.id===i);if(!r)return"";const e=r.opacity??100;return D(i,{drawProgress:100,opacity:0},!1),B(i,{drawProgress:0},{duration:t,easing:"easeInOutQuad",...n,onComplete:()=>{D(i,{drawProgress:void 0,opacity:e},!1),n.onComplete?.()}})}const Kt=new Map;function ha(i){return Kt.get(i)}function Xc(i,t={}){const n=b.elements.find(h=>h.id===i);if(!n)return"";const r=n.entranceAnimation??"none",e=n.animationDuration??300,{isPreview:o=!0,onComplete:l}=t;o&&!Kt.has(i)&&Kt.set(i,{x:n.x,y:n.y,width:n.width,height:n.height,opacity:n.opacity,angle:n.angle,drawProgress:void 0});const s=o?Kt.get(i):null,a=()=>{o&&s&&(D(i,s,!1),Kt.delete(i)),l?.()},c={onComplete:a};switch(r){case"fadeIn":return D(i,{opacity:0},!1),B(i,{opacity:100},{duration:e,easing:"easeOutQuad",onComplete:a});case"fadeInDown":return os(i,e,c);case"fadeInDownBig":return ss(i,e,c);case"fadeInLeft":return as(i,e,c);case"fadeInLeftBig":return ls(i,e,c);case"fadeInRight":return cs(i,e,c);case"fadeInRightBig":return hs(i,e,c);case"fadeInUp":return ds(i,e,c);case"fadeInUpBig":return us(i,e,c);case"fadeInTopLeft":return fs(i,e,c);case"fadeInTopRight":return ps(i,e,c);case"fadeInBottomLeft":return gs(i,e,c);case"fadeInBottomRight":return ys(i,e,c);case"bounce":return ei(i,e,c);case"flash":return nr(i,e,c);case"pulse":return ni(i,e,{scale:1.1,...c});case"rubberBand":return ir(i,e,c);case"shakeX":return ii(i,e,{intensity:10,...c});case"shakeY":return rr(i,e,{intensity:10,...c});case"headShake":return Eo(i,e);case"swing":return No(i,e);case"tada":return Oo(i,e);case"wobble":return Bo(i,e);case"jello":return Do(i,e);case"heartBeat":return zo(i,e);case"backInDown":return Wo(i,e,c);case"backInLeft":return jo(i,e,c);case"backInRight":return Uo(i,e,c);case"backInUp":return qo(i,e,c);case"bounceIn":return Vo(i,e,c);case"bounceInDown":return Qo(i,e,c);case"bounceInLeft":return Zo(i,e,c);case"bounceInRight":return Jo(i,e,c);case"bounceInUp":return Ko(i,e,c);case"zoomIn":return Js(i,e,c);case"zoomInDown":return Ks(i,e,c);case"zoomInLeft":return ta(i,e,c);case"zoomInRight":return ea(i,e,c);case"zoomInUp":return na(i,e,c);case"slideInDown":{const h=n.y;return D(i,{y:-n.height,opacity:0},!1),B(i,{y:h,opacity:100},{duration:e,easing:"easeOutQuad",onComplete:a})}case"slideInLeft":{const h=n.x;return D(i,{x:-n.width,opacity:0},!1),B(i,{x:h,opacity:100},{duration:e,easing:"easeOutQuad",onComplete:a})}case"slideInRight":{const h=n.x;return D(i,{x:window.innerWidth+100,opacity:0},!1),B(i,{x:h,opacity:100},{duration:e,easing:"easeOutQuad",onComplete:a})}case"slideInUp":{const h=n.y;return D(i,{y:window.innerHeight+100,opacity:0},!1),B(i,{y:h,opacity:100},{duration:e,easing:"easeOutQuad",onComplete:a})}case"rotateIn":return Ds(i,e,c);case"rotateInDownLeft":return zs(i,e,c);case"rotateInDownRight":return Fs(i,e,c);case"rotateInUpLeft":return Ws(i,e,c);case"rotateInUpRight":return js(i,e,c);case"flip":return Ts(i,e,c);case"flipInX":return Ls(i,e,c);case"flipInY":return Is(i,e,c);case"lightSpeedInRight":return Es(i,e,c);case"lightSpeedInLeft":return Ns(i,e,c);case"rollIn":return Qs(i,e,c);case"jackInTheBox":return Vs(i,e,c);case"scaleIn":return er(i,e,c);case"drawIn":return la(i,e,c);default:return""}}function Gc(i,t={}){const n=b.elements.find(h=>h.id===i);if(!n)return"";const r=n.exitAnimation??"none",e=n.animationDuration??300,{isPreview:o=!0,onComplete:l}=t;o&&!Kt.has(i)&&Kt.set(i,{x:n.x,y:n.y,width:n.width,height:n.height,opacity:n.opacity,angle:n.angle,drawProgress:void 0});const s=o?Kt.get(i):null,a=()=>{o&&s&&(D(i,s,!1),Kt.delete(i)),l?.()},c={onComplete:a};switch(r){case"fadeOut":return B(i,{opacity:0},{duration:e,easing:"easeOutQuad",onComplete:a});case"fadeOutDown":return ms(i,e,c);case"fadeOutDownBig":return bs(i,e,c);case"fadeOutLeft":return ws(i,e,c);case"fadeOutLeftBig":return vs(i,e,c);case"fadeOutRight":return xs(i,e,c);case"fadeOutRightBig":return ks(i,e,c);case"fadeOutUp":return Ss(i,e,c);case"fadeOutUpBig":return Ms(i,e,c);case"fadeOutTopLeft":return Ps(i,e,c);case"fadeOutTopRight":return Cs(i,e,c);case"fadeOutBottomLeft":return _s(i,e,c);case"fadeOutBottomRight":return As(i,e,c);case"backOutDown":return Ho(i,e,c);case"backOutLeft":return Yo(i,e,c);case"backOutRight":return Xo(i,e,c);case"backOutUp":return Go(i,e,c);case"bounceOut":return ts(i,e,c);case"bounceOutDown":return es(i,e,c);case"bounceOutLeft":return ns(i,e,c);case"bounceOutRight":return is(i,e,c);case"bounceOutUp":return rs(i,e,c);case"zoomOut":return ia(i,e,c);case"zoomOutDown":return ra(i,e,c);case"zoomOutLeft":return oa(i,e,c);case"zoomOutRight":return sa(i,e,c);case"zoomOutUp":return aa(i,e,c);case"slideOutDown":return B(i,{y:window.innerHeight+100,opacity:0},{duration:e,easing:"easeInQuad",onComplete:a});case"slideOutLeft":return B(i,{x:-n.width,opacity:0},{duration:e,easing:"easeInQuad",onComplete:a});case"slideOutRight":return B(i,{x:window.innerWidth+100,opacity:0},{duration:e,easing:"easeInQuad",onComplete:a});case"slideOutUp":return B(i,{y:-n.height,opacity:0},{duration:e,easing:"easeInQuad",onComplete:a});case"bounce":return ei(i,e,c);case"flash":return nr(i,e,c);case"pulse":return ni(i,e,{scale:1.1,...c});case"rubberBand":return ir(i,e,c);case"shakeX":return ii(i,e,{intensity:10,...c});case"shakeY":return rr(i,e,{intensity:10,...c});case"rotateOut":return Us(i,e,c);case"rotateOutDownLeft":return qs(i,e,c);case"rotateOutDownRight":return Hs(i,e,c);case"rotateOutUpLeft":return Ys(i,e,c);case"rotateOutUpRight":return Xs(i,e,c);case"flipOutX":return $s(i,e,c);case"flipOutY":return Rs(i,e,c);case"lightSpeedOutRight":return Os(i,e,c);case"lightSpeedOutLeft":return Bs(i,e,c);case"rollOut":return Zs(i,e,c);case"hinge":return Gs(i,e,c);case"scaleOut":return Fo(i,e,c);case"drawOut":return ca(i,e,c);default:return""}}function da(i,t,n){const r=b.elements.find(d=>d.id===i);if(!r)return"";const e=Te("morph"),o=new Set(["points","type"]);Ge(i,o),pt.has(i)||pt.set(i,new Map),pt.get(i).set(e,o);const l=120,s=ve.getPointsFromElement(r),a=ve.getPointsFromElement(r,t),c=ve.resamplePolygon(s,l);let h=ve.resamplePolygon(a,l);return h=ve.alignPolygons(c,h),console.log("[Morph] Starting morph:",r.type,"",t,"samples:",l),st.create(e,d=>{console.log("[Morph] Progress:",d.toFixed(3));const u=ve.interpolatePoints(c,h,d),f=b.elements.findIndex(g=>g.id===i);if(f!==-1){const g=[...b.elements];g[f]={...g[f],points:[...u]},P("elements",g)}},{duration:n.duration,easing:n.easing,delay:n.delay,loop:n.loop,loopCount:n.loopCount,alternate:n.alternate,onComplete:()=>{const d=pt.get(i);d&&(d.delete(e),d.size===0&&pt.delete(i)),D(i,{type:t,points:void 0},!1),n.onComplete?.()}}),st.start(e),e}const Vc=Object.freeze(Object.defineProperty({__proto__:null,animateAlongPath:Lo,animateElement:B,animateElements:_o,animateMorph:da,backInDown:Wo,backInLeft:jo,backInRight:Uo,backInUp:qo,backOutDown:Ho,backOutLeft:Yo,backOutRight:Xo,backOutUp:Go,bounce:ei,bounceIn:Vo,bounceInDown:Qo,bounceInLeft:Zo,bounceInRight:Jo,bounceInUp:Ko,bounceOut:ts,bounceOutDown:es,bounceOutLeft:ns,bounceOutRight:is,bounceOutUp:rs,drawIn:la,drawOut:ca,fadeIn:$o,fadeInBottomLeft:gs,fadeInBottomRight:ys,fadeInDown:os,fadeInDownBig:ss,fadeInLeft:as,fadeInLeftBig:ls,fadeInRight:cs,fadeInRightBig:hs,fadeInTopLeft:fs,fadeInTopRight:ps,fadeInUp:ds,fadeInUpBig:us,fadeOut:Ro,fadeOutBottomLeft:_s,fadeOutBottomRight:As,fadeOutDown:ms,fadeOutDownBig:bs,fadeOutLeft:ws,fadeOutLeftBig:vs,fadeOutRight:xs,fadeOutRightBig:ks,fadeOutTopLeft:Ps,fadeOutTopRight:Cs,fadeOutUp:Ss,fadeOutUpBig:Ms,flash:nr,flip:Ts,flipInX:Ls,flipInY:Is,flipOutX:$s,flipOutY:Rs,getElementPreviewBaseState:ha,headShake:Eo,heartBeat:zo,hinge:Gs,isElementAnimating:Oc,jackInTheBox:Vs,jello:Do,lightSpeedInLeft:Ns,lightSpeedInRight:Es,lightSpeedOutLeft:Bs,lightSpeedOutRight:Os,pauseElementAnimation:To,playEntranceAnimation:Xc,playExitAnimation:Gc,pulse:ni,resumeElementAnimation:Io,revolve:Yc,rollIn:Qs,rollOut:Zs,rotateIn:Ds,rotateInDownLeft:zs,rotateInDownRight:Fs,rotateInUpLeft:Ws,rotateInUpRight:js,rotateOut:Us,rotateOutDownLeft:qs,rotateOutDownRight:Hs,rotateOutUpLeft:Ys,rotateOutUpRight:Xs,rubberBand:ir,scaleIn:er,scaleOut:Fo,shakeX:ii,shakeY:rr,slideInDown:Wc,slideInLeft:Dc,slideInRight:zc,slideInUp:Fc,slideOutDown:Hc,slideOutLeft:jc,slideOutRight:Uc,slideOutUp:qc,stopAllElementAnimations:Li,stopConflictingAnimations:Ge,stopElementAnimation:Ao,swing:No,tada:Oo,wobble:Bo,zoomIn:Js,zoomInDown:Ks,zoomInLeft:ta,zoomInRight:ea,zoomInUp:na,zoomOut:ia,zoomOutDown:ra,zoomOutLeft:oa,zoomOutRight:sa,zoomOutUp:aa},Symbol.toStringTag,{value:"Module"}));class Qc{activeSequences=new Set;playSequence(t,n="programmatic"){const r=b.elements.find(c=>c.id===t),e=r?.animations&&r.animations.length>0,o=r?.spinEnabled||r?.orbitEnabled;if(!r||!e&&!(n==="programmatic"&&o))return;let l=null;n==="programmatic"&&(this.activeSequences.add(t),hn(!0),st.setForceTicker(!0),l={x:r.x,y:r.y,width:r.width,height:r.height,opacity:r.opacity,angle:r.angle,strokeColor:r.strokeColor,backgroundColor:r.backgroundColor});const s=r.animations?r.animations.filter((c,h)=>n==="programmatic"?!0:h===0?c.trigger===n||c.trigger==="after-prev":!0):[];if(s.length===0)return void 0;const a=()=>{this.activeSequences.has(t)&&(Li(t),n==="programmatic"&&(this.activeSequences.delete(t),this.activeSequences.size===0&&(hn(!1),st.setForceTicker(!1))),l&&(s[s.length-1]?.restoreAfter??!0)&&setTimeout(()=>{D(t,l,!1)},500))};this.runStep(t,s,0,a)}stopSequence(t){Li(t),this.activeSequences.has(t)&&this.activeSequences.delete(t),this.activeSequences.size===0&&(hn(!1),st.setForceTicker(!1))}playAll(t="programmatic",n){(n?b.elements.filter(e=>n.includes(e.id)):b.elements).forEach(e=>{this.playSequence(e.id,t)})}stopAll(){this.activeSequences.clear(),hn(!1),st.setForceTicker(!1),b.elements.forEach(t=>{this.stopSequence(t.id)})}runStep(t,n,r,e){if(!this.activeSequences.has(t))return;if(r>=n.length){e?.();return}const o=n[r],l=r+1,s=o.repeat===-1;let a=l;for(;a<n.length&&n[a].trigger==="with-prev";)a++;const c=a<n.length,h=()=>{this.activeSequences.has(t)&&(o.restoreAfter&&b.elements.find(g=>g.id===t)&&d&&D(t,d,!1),c?this.runStep(t,n,a,e):e?.())};let d=null;if(o.restoreAfter){const f=b.elements.find(g=>g.id===t);f&&(d={...f})}let u=l;for(;u<n.length;){const f=n[u];if(f.trigger==="with-prev")this.executeAnimation(t,f,()=>{f.restoreAfter}),u++;else break}s?this.executeAnimation(t,o,()=>{}):this.executeAnimation(t,o,h)}playAnimation(t,n,r){this.executeAnimation(t,n,r)}executeAnimation(t,n,r){const e={duration:n.duration,delay:n.delay,easing:n.easing,onComplete:r,params:n.params,loop:n.repeat===-1,loopCount:n.repeat!==-1&&(n.repeat||0)>0?n.repeat:void 0,alternate:n.yoyo};if(n.type==="preset"){const o=Vc[n.name];typeof o=="function"?o(t,n.duration,e):(console.warn(`Unknown preset: ${n.name}`),r())}else n.type==="property"?this.animateProperty(t,n,e):n.type==="rotate"?this.animateRotate(t,n,e):n.type==="autoSpin"?this.animateAutoSpin(t,n,e):n.type==="path"?Lo(t,n.pathData,{...e,orientToPath:n.orientToPath,isRelative:n.isRelative}):n.type==="morph"&&da(t,n.targetShape,e)}animateRotate(t,n,r){const e=b.elements.find(l=>l.id===t);if(!e){r.onComplete?.();return}const o=n.relative?(e.angle||0)+n.toAngle*Math.PI/180:n.toAngle*Math.PI/180;B(t,{angle:o},r)}animateAutoSpin(t,n,r){const e=b.elements.find(h=>h.id===t);if(!e){r.onComplete?.();return}const o=e.angle||0,l=n.direction==="counterclockwise"?-1:1,s=n.iterations==="infinite"?1/0:n.iterations||1,a=l*Math.PI*2,c={...r};if(s===1/0){c.loop=!0,c.loopCount=1/0,c.duration=r.duration||1e3,c.easing="linear";const h=r.onComplete;setTimeout(()=>{h?.()},0);const d=o+a;B(t,{angle:d},{...c,onComplete:void 0})}else{const h=a*s,d=o+h;B(t,{angle:d},c)}}animateProperty(t,n,r){const e={},o=n.to;n.property==="opacity"||n.property==="x"||n.property==="y"||n.property==="width"||n.property==="height"||n.property==="angle"||n.property==="strokeWidth"||n.property==="roughness"?e[n.property]=Number(o):(n.property==="strokeColor"||n.property==="backgroundColor")&&(e[n.property]=String(o)),B(t,e,r)}}const Wn=new Qc,Zc=(i,t,n)=>{const r=n[i];if(!r)return[];const{x:e,y:o}=r.spatialPosition,{width:l,height:s}=r.dimensions;return t.filter(a=>{const c=a.x+(a.width||0)/2,h=a.y+(a.height||0)/2;return c>=e&&c<=e+l&&h>=o&&h<=o+s})},or=(i,t,n)=>{const r=i.x+i.width/2,e=i.y+i.height/2;let o=0,l=0;for(const s of n){const{x:a,y:c}=s.spatialPosition,{width:h,height:d}=s.dimensions;if(r>=a&&r<=a+h&&e>=c&&e<=c+d){o=a,l=c;break}}return{x:i.x-o+t.spatialPosition.x,y:i.y-l+t.spatialPosition.y}};class Jc{buildSequence=[];isPlaying=!1;init(t){this.reset();const n=Zc(t,b.elements,b.slides),r=[];n.forEach(e=>{e.animations&&e.animations.length>0&&e.animations.forEach(o=>{r.push({elementId:e.id,animation:o,played:!1})})}),this.buildSequence=r.sort((e,o)=>{const l=n.find(a=>a.id===e.elementId),s=n.find(a=>a.id===o.elementId);if(l.layerId!==s.layerId){const a=b.layers.find(h=>h.id===l.layerId),c=b.layers.find(h=>h.id===s.layerId);return(a?.order??0)-(c?.order??0)}return e.elementId===o.elementId?(l.animations?.indexOf(e.animation)??0)-(s.animations?.indexOf(o.animation)??0):e.elementId.localeCompare(o.elementId)})}reset(){this.buildSequence=[],this.isPlaying=!1,Wn.stopAll()}playInitial(){b.appMode==="presentation"&&this.buildSequence.forEach((t,n)=>{t.animation.trigger==="on-load"&&!t.played&&this.executeStep(n)})}hasMoreSteps(){return this.buildSequence.some(t=>!t.played&&t.animation.trigger==="on-click")}async playNext(){if(this.isPlaying)return!0;const t=this.buildSequence.findIndex(n=>!n.played&&n.animation.trigger==="on-click");return t===-1?!1:(this.isPlaying=!0,await this.executeStep(t),this.isPlaying=!1,!0)}executeStep(t){const n=this.buildSequence[t];return!n||n.played?Promise.resolve():(n.played=!0,new Promise(r=>{const e=()=>{this.triggerAfterPrev(t).then(r)};Wn.playAnimation(n.elementId,n.animation,e),this.triggerWithPrev(t)}))}triggerWithPrev(t){let n=t+1;for(;n<this.buildSequence.length&&this.buildSequence[n].animation.trigger==="with-prev";)this.executeStep(n),n++}async triggerAfterPrev(t){let n=t+1;n<this.buildSequence.length&&this.buildSequence[n].animation.trigger==="after-prev"&&await this.executeStep(n)}}const Le=new Jc,Kc={rectangle:"rect",circle:"circ",triangle:"tria",diamond:"diam",hexagon:"hexa",octagon:"octa",parallelogram:"para",arrow:"arrw",line:"line",text:"text",image:"imag",ink:"ink_",laser:"lasr",group:"grup",slide:"slid",layer:"layr",star:"star",cloud:"clou",heart:"hear",cross:"cros",checkmark:"chck",capsule:"caps",stickyNote:"note",callout:"call",burst:"brst",speechBubble:"bubl",ribbon:"ribb",database:"data",document:"docu",server:"serv",user:"user",firewall:"fire",browser:"brow"},Lt=i=>{let t=Kc[i];t||(t=i.substring(0,4).toLowerCase()),t.length<4&&(t=t.padEnd(4,"_"));const n=`${t}-`;let r=0;return b.elements.forEach(e=>{if(e.id.startsWith(n)){const o=e.id.substring(n.length),l=parseInt(o,10);!isNaN(l)&&String(l)===o&&l>r&&(r=l)}}),`${n}${r+1}`},th=(i,t,n)=>{const r=t.filter(d=>i.includes(d.id));if(r.length<2)return[];let e=1/0,o=1/0,l=-1/0,s=-1/0;r.forEach(d=>{e=Math.min(e,d.x),o=Math.min(o,d.y),l=Math.max(l,d.x+d.width),s=Math.max(s,d.y+d.height)});const a=e+(l-e)/2,c=o+(s-o)/2,h=[];return r.forEach(d=>{const u={};switch(n){case"left":u.x=e;break;case"center":u.x=a-d.width/2;break;case"right":u.x=l-d.width;break;case"top":u.y=o;break;case"middle":u.y=c-d.height/2;break;case"bottom":u.y=s-d.height;break}(u.x!==void 0||u.y!==void 0)&&h.push({id:d.id,updates:u})}),h},eh=(i,t,n)=>{const r=t.filter(s=>i.includes(s.id));if(r.length<3)return[];const e=[...r].sort((s,a)=>n==="horizontal"?s.x+s.width/2-(a.x+a.width/2):s.y+s.height/2-(a.y+a.height/2)),o=e[0],l=e[e.length-1];if(n==="horizontal"){const s=o.x+o.width/2,h=(l.x+l.width/2-s)/(e.length-1),d=[];return e.forEach((u,f)=>{if(f===0||f===e.length-1)return;const p=s+h*f-u.width/2;d.push({id:u.id,updates:{x:p}})}),d}else{const s=o.y+o.height/2,h=(l.y+l.height/2-s)/(e.length-1),d=[];return e.forEach((u,f)=>{if(f===0||f===e.length-1)return;const p=s+h*f-u.height/2;d.push({id:u.id,updates:{y:p}})}),d}},Ne=So(),Pe={elements:Ne.elements,viewState:{scale:1,panX:0,panY:0},layers:Ne.layers,activeLayerId:Ne.layers[0].id,gridSettings:Ne.gridSettings,canvasBackgroundColor:"#ffffff",dimensions:{width:1920,height:1080},slides:Ne.slides,activeSlideIndex:0,docType:"infinite",canvasTexture:"none",isPreviewing:!1,selectedTool:"selection",selectedUmlType:"umlClass",selection:[],flowTick:0,isRecording:!1,readOnly:!1,defaultElementStyles:{strokeColor:localStorage.getItem("theme")==="dark"?"#ffffff":"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,renderStyle:"sketch",opacity:100,angle:0,roundness:null,locked:!1,fontSize:28,fontFamily:"hand-drawn",fontWeight:!1,fontStyle:!1,textAlign:"center",startArrowhead:null,endArrowhead:null,startArrowheadSize:12,endArrowheadSize:12,autoResize:!1,flowColor:void 0,seed:0,shadowEnabled:!1,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:10,shadowOffsetX:5,shadowOffsetY:5,gradientStart:"#ffffff",gradientEnd:"#000000",gradientDirection:45,smoothing:3,taperAmount:.15,velocitySensitivity:.5},toolStyles:{},theme:localStorage.getItem("theme")||"light",globalSettings:{animationEnabled:!0,reducedMotion:!1,renderStyle:"sketch",showMindmapToolbar:!0},showCanvasProperties:!1,undoStackLength:0,redoStackLength:0,showPropertyPanel:!1,showLayerPanel:!1,isPropertyPanelMinimized:!1,isLayerPanelMinimized:!1,minimapVisible:!1,zenMode:!1,appMode:"design",showCommandPalette:!1,selectedPenType:"fineliner",selectedShapeType:"triangle",selectedInfraType:"server",selectedMathType:"trapezoid",selectedSketchnoteType:"starPerson",selectedPeopleType:"stickFigure",selectedStatusType:"checkbox",selectedCloudInfraType:"kubernetes",selectedDataMetricsType:"barChart",selectedConnectionRelType:"puzzlePiece",selectedWireframeType:"browserWindow",layerGroupingModeEnabled:!1,maxLayers:20,selectedTechnicalType:"dfdProcess",states:[],showStatePanel:!1,showSlideNavigator:!0,showSlideToolbar:!0,showMainToolbar:!0,slideToolbarPosition:{x:window.innerWidth/2-150,y:window.innerHeight-80},showExportDialog:!1,showUtilityToolbar:!0,pathEditState:{isActive:!1,elementId:null,animationId:null}},[b,P]=Pc(Pe),Xt=[],fe=[],Q=()=>{const i={elements:JSON.parse(JSON.stringify(b.elements)),layers:JSON.parse(JSON.stringify(b.layers))};Xt.push(i),Xt.length>50&&Xt.shift(),fe.length=0,P("undoStackLength",Xt.length),P("redoStackLength",0)},sr=()=>{if(Xt.length===0)return;const i={elements:JSON.parse(JSON.stringify(b.elements)),layers:JSON.parse(JSON.stringify(b.layers))};fe.push(i);const t=Xt.pop();t&&(P("elements",t.elements),P("layers",t.layers),P("selection",[])),P("undoStackLength",Xt.length),P("redoStackLength",fe.length)},jn=()=>{if(fe.length===0)return;const i={elements:JSON.parse(JSON.stringify(b.elements)),layers:JSON.parse(JSON.stringify(b.layers))};Xt.push(i);const t=fe.pop();t&&(P("elements",t.elements),P("layers",t.layers),P("selection",[])),P("undoStackLength",Xt.length),P("redoStackLength",fe.length)},ge=i=>{Q(),P("elements",t=>[...t,i])},ar=i=>{const t=b.elements.find(a=>a.id===i);if(!t)return;Q();const n=Lt(t.type),r=150,o={...b.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:t.backgroundColor,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:n,type:t.type==="image"||t.type==="line"||t.type==="arrow"?"rectangle":t.type,x:t.x+t.width+r,y:t.y+0,width:t.width>0?t.width:100,height:t.height>0?t.height:60,layerId:b.activeLayerId,parentId:t.id,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},l={...b.defaultElementStyles,id:Lt("arrow"),type:"arrow",x:t.x+t.width,y:t.y+t.height/2,width:r,height:0,layerId:b.activeLayerId,startBinding:{elementId:t.id,gap:5,position:"right",focus:0},endBinding:{elementId:n,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,r,0]},s=l.id;return P("elements",a=>[...a,o,l]),P("elements",a=>a.id===i,"boundElements",a=>[...a||[],{id:s,type:"arrow"}]),P("elements",a=>a.id===n,"boundElements",a=>[...a||[],{id:s,type:"arrow"}]),P("selection",[n]),n},lr=i=>{const t=b.elements.find(a=>a.id===i);if(!t)return;const n=t.parentId;if(!n)return;Q();const r=Lt(t.type),e=t.height+40,o={...b.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:r,type:t.type,x:t.x,y:t.y+e,width:t.width,height:t.height,layerId:b.activeLayerId,parentId:n,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},l={...b.defaultElementStyles,id:Lt("arrow"),type:"arrow",x:t.x-150,y:t.y+e+t.height/2,width:150,height:0,layerId:b.activeLayerId,startBinding:{elementId:n,gap:5,position:"right",focus:0},endBinding:{elementId:r,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,150,0]},s=l.id;return P("elements",a=>[...a,o,l]),P("elements",a=>a.id===n,"boundElements",a=>[...a||[],{id:s,type:"arrow"}]),P("elements",a=>a.id===r,"boundElements",a=>[...a||[],{id:s,type:"arrow"}]),P("selection",[r]),r},ua=()=>{b.selection.length!==0&&(Q(),P("elements",i=>b.selection.includes(i.id),i=>({isCollapsed:!i.isCollapsed})))},fa=i=>{P("showCanvasProperties",i),i&&(P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1))},oe=i=>{i.length!==0&&(Q(),P("elements",t=>t.filter(n=>!i.includes(n.id))),P("selection",[]))},cr=i=>{i.length!==0&&(Q(),P("elements",t=>{const n=t.filter(e=>i.includes(e.id));return[...t.filter(e=>!i.includes(e.id)),...n]}))},hr=i=>{i.length!==0&&(Q(),P("elements",t=>{const n=t.filter(e=>i.includes(e.id)),r=t.filter(e=>!i.includes(e.id));return[...n,...r]}))},nh=()=>{const i=b.elements.some(t=>t.flowAnimation);st.setForceTicker(i)},D=(i,t,n=!1)=>{n&&Q(),P("elements",r=>r.id===i,t),"flowAnimation"in t&&nh()},Hr=(i,t,n,r=!1)=>{r&&Q(),P("elements",e=>e.id===i,"animations",e=>e.id===t,n)},t2=(i,t,n,r=!0)=>{const e=b.elements.find(c=>c.id===i);if(!e||!e.animations)return;const o=[...e.animations],l=o.findIndex(c=>c.id===t);if(l===-1)return;const s=n==="up"?l-1:l+1;if(s<0||s>=o.length)return;r&&Q();const[a]=o.splice(l,1);o.splice(s,0,a),P("elements",c=>c.id===i,"animations",o)},pa=(i,t,n=!1)=>{b.selection.length!==0&&(n&&Q(),P("elements",r=>b.selection.includes(r.id),r=>({x:r.x+i,y:r.y+t})))},St=i=>{P("viewState",t=>({...t,...i}))},Z=i=>{const t=b.selectedTool;if(t!=="selection"){const n=JSON.parse(JSON.stringify(b.defaultElementStyles));P("toolStyles",t,n)}if(P("selectedTool",i),i!=="selection"&&i!=="pan"&&i!=="eraser"&&P("selection",[]),i!=="selection"){const n=b.toolStyles[i];n&&ne(n)}i==="arrow"?ne({endArrowhead:"arrow"}):i==="line"&&ne({endArrowhead:null}),ne(i==="starPerson"||i==="scroll"||i==="wavyDivider"||i==="doubleBanner"||i==="lightbulb"||i==="signpost"||i==="burstBlob"||i==="browserWindow"||i==="mobilePhone"||i==="ghostButton"||i==="inputField"?{autoResize:!1}:{autoResize:!1})},ne=i=>{P("defaultElementStyles",t=>({...t,...i}))},e2=i=>{P("globalSettings",t=>({...t,...i})),i.renderStyle&&ne({renderStyle:i.renderStyle})},ih=(i,t=null,n=null)=>{P("pathEditState",{isActive:i,elementId:t,animationId:n}),i&&nt("Path Edit Mode Active","info")},rh=(i,t)=>{P("slides",i,"thumbnail",t)},Xe=()=>{const i=b.activeSlideIndex;if(i<0||i>=b.slides.length)return;const t={backgroundColor:b.canvasBackgroundColor,dimensions:JSON.parse(JSON.stringify(b.dimensions)),thumbnail:b.slides[b.activeSlideIndex].thumbnail};P("slides",i,t)},Gt=async(i,t)=>{if(i<0||i>=b.slides.length||i===b.activeSlideIndex&&!bi.transitioning)return;b.appMode==="design"&&b.activeSlideIndex!==-1&&P("slides",b.activeSlideIndex,{lastViewState:{...b.viewState}}),P("selection",[]),b.appMode==="presentation"&&!0?await bi.transitionTo(i):await bi.transitionTo(i,{skipAnimation:!0});const r=b.slides[i];r&&(r.backgroundColor&&P("canvasBackgroundColor",r.backgroundColor),P("dimensions",JSON.parse(JSON.stringify(r.dimensions))),b.appMode==="presentation"&&(Le.init(i),Le.playInitial())),nt(`Slide ${i+1}`,"info")},dr=async()=>{if(b.states.findIndex(t=>t.id===b.activeStateId)<b.states.length-1){ur();return}if(Le.hasMoreSteps()){await Le.playNext();return}b.activeSlideIndex<b.slides.length-1&&await Gt(b.activeSlideIndex+1)},ga=async()=>{if(b.states.findIndex(t=>t.id===b.activeStateId)>0){fr();return}b.activeSlideIndex>0&&await Gt(b.activeSlideIndex-1)},ya=()=>{Xe();const i=b.slides.length,t=b.slides[b.slides.length-1],n=t?t.spatialPosition.x+2e3:0,r=ti(void 0,`Slide ${i+1}`,n,0);r.order=i,P("slides",e=>[...e,r]),Gt(i),nt("Slide added","success")},n2=(i,t)=>{Xe();const n=[...b.slides].sort((c,h)=>c.spatialPosition.x-h.spatialPosition.x),r=n[n.length-1],e=r?r.spatialPosition.x+2e3:0,o=t==="before"?i:i+1,l=ti(void 0,`Slide ${b.slides.length+1}`,e,0),s=b.slides.map(c=>({...c}));s.splice(o,0,l),s.forEach((c,h)=>c.order=h);let a=b.activeSlideIndex;o<=a&&a++,ee(()=>{P("slides",s),P("activeSlideIndex",a)}),Gt(o),nt("Slide inserted","success")},oh=i=>{if(i<0||i>=b.slides.length)return;Q(),Xe();const t=b.slides[i],{x:n,y:r}=t.spatialPosition,{width:e,height:o}=t.dimensions,l=b.elements.filter(g=>{const p=g.x+(g.width||0)/2,m=g.y+(g.height||0)/2;return p>=n&&p<=n+e&&m>=r&&m<=r+o}),a=b.slides.reduce((g,p)=>g.spatialPosition.x>p.spatialPosition.x?g:p).spatialPosition.x+2e3,c={x:a-n,y:0},h=new Map;l.forEach(g=>h.set(g.id,crypto.randomUUID()));const d=l.map(g=>{const p=h.get(g.id),m=JSON.parse(JSON.stringify(g));return m.id=p,m.x+=c.x,m.y+=c.y,m.seed=Math.floor(Math.random()*2147483647),m.startBinding&&h.has(m.startBinding.elementId)?m.startBinding.elementId=h.get(m.startBinding.elementId):m.startBinding&&(m.startBinding=void 0),m.endBinding&&h.has(m.endBinding.elementId)?m.endBinding.elementId=h.get(m.endBinding.elementId):m.endBinding&&(m.endBinding=void 0),m.boundElements&&(m.boundElements=m.boundElements.filter(y=>h.has(y.id)).map(y=>({...y,id:h.get(y.id)}))),m.parentId&&h.has(m.parentId)?m.parentId=h.get(m.parentId):m.parentId&&(m.parentId=void 0),m}),u={...JSON.parse(JSON.stringify(t)),id:crypto.randomUUID(),name:`${t.name} (Copy)`,spatialPosition:{x:a,y:0},order:i+1,thumbnail:void 0},f=b.slides.map(g=>({...g}));f.splice(i+1,0,u),f.forEach((g,p)=>g.order=p),ee(()=>{P("slides",f),P("elements",g=>[...g,...d]),Gt(i+1)}),nt("Slide duplicated","success")},sh=i=>{if(b.slides.length<=1){nt("Cannot delete the last slide","error");return}const t=b.slides.filter((r,e)=>e!==i).map(r=>({...r}));t.forEach((r,e)=>r.order=e);let n=b.activeSlideIndex;n>=t.length&&(n=t.length-1),ee(()=>{P("slides",t),Gt(n)}),nt("Slide deleted","info")},ah=(i,t)=>{if(i===t)return;const n=b.slides.map(o=>({...o})),[r]=n.splice(i,1);n.splice(t,0,r),n.forEach((o,l)=>o.order=l);let e=b.activeSlideIndex;b.activeSlideIndex===i?e=t:i<b.activeSlideIndex&&t>=b.activeSlideIndex?e--:i>b.activeSlideIndex&&t<=b.activeSlideIndex&&e++,P("slides",n),P("activeSlideIndex",e)},lh=(i,t)=>{if(i<0||i>=b.slides.length)return;const n=b.slides[i]?.transition||{...Ye};P("slides",i,"transition",{...n,...t})},ce=(i,t)=>{i<0||i>=b.slides.length||(typeof t=="string"?(t.startsWith("#")||t.startsWith("rgb")||t.startsWith("hsl")||t.startsWith("color(")||t.includes("display-p3"))&&(P("slides",i,{backgroundColor:t,fillStyle:"solid"}),i===b.activeSlideIndex&&P("canvasBackgroundColor",t)):(P("slides",i,t),i===b.activeSlideIndex&&t.backgroundColor&&P("canvasBackgroundColor",t.backgroundColor)))},Un=i=>{ee(()=>{let t=[],n=[],r=[],e=i.gridSettings||Pe.gridSettings,o=i.states||[];if(i.version===4)t=i.elements,n=i.slides,r=i.layers,o=i.states||[],e=i.gridSettings||e;else if(i.version===3){r=i.slides[0]?.layers||Pe.layers;const s=2e3;i.slides.forEach((a,c)=>{const h=c*s,d=0,u=a.elements.map(f=>({...f,x:f.x+h,y:f.y+d}));t.push(...u),n.push({id:a.id,name:a.name,spatialPosition:{x:h,y:d},dimensions:a.dimensions||{width:1920,height:1080},order:c,backgroundColor:a.backgroundColor,thumbnail:a.thumbnail}),a.states&&o.push(...a.states)})}else t=i.elements||[],r=i.layers||Pe.layers,n=[ti()];n.forEach(s=>{s.transition||(s.transition={...Ye})}),P("elements",JSON.parse(JSON.stringify(t))),P("slides",JSON.parse(JSON.stringify(n))),P("layers",JSON.parse(JSON.stringify(r))),P("states",JSON.parse(JSON.stringify(o))),P("gridSettings",JSON.parse(JSON.stringify(e))),P("globalSettings",i.globalSettings||Pe.globalSettings);const l=i.metadata?.docType||(i.version>=3?"slides":"infinite");P("docType",l),P("showSlideNavigator",l==="slides"),P("showSlideToolbar",!0),P("showUtilityToolbar",!0),P("activeSlideIndex",0),P("selection",[]),r.some(s=>s.id===b.activeLayerId)||P("activeLayerId",r[0]?.id||"default-layer"),setTimeout(()=>{const s=b.slides[0];b.appMode==="design"&&s?.lastViewState?St(s.lastViewState):ie()},100)}),ba()},ch=i=>{ee(()=>{P("docType",i),P("showSlideNavigator",i==="slides")})},ma=i=>{P("showStatePanel",i??!b.showStatePanel)},hh=i=>{const t=crypto.randomUUID(),n={};b.elements.forEach(e=>{n[e.id]={x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,text:e.text}});const r={id:t,name:i,overrides:n};P("states",e=>[...e,r]),P("activeStateId",t),nt(`State "${i}" captured`,"success")},dh=i=>{const t=b.states.findIndex(r=>r.id===i);if(t===-1)return;const n={};b.elements.forEach(r=>{n[r.id]={x:r.x,y:r.y,width:r.width,height:r.height,opacity:r.opacity,angle:r.angle,backgroundColor:r.backgroundColor,strokeColor:r.strokeColor,text:r.text}}),P("states",t,"overrides",n),nt("State updated","success")},uh=i=>{P("states",t=>t.filter(n=>n.id!==i)),b.activeStateId===i&&P("activeStateId",void 0),nt("State deleted","info")},si=async(i,t=!0)=>{const n=b.states.find(r=>r.id===i);if(n)if(P("activeStateId",i),t){const{MorphAnimator:r}=await Ct(async()=>{const{MorphAnimator:e}=await import("./morph-animator-BIBwsBSm.js");return{MorphAnimator:e}},__vite__mapDeps([0,1,2,3]),import.meta.url);r.morphTo(n)}else ee(()=>{Object.entries(n.overrides).forEach(([r,e])=>{D(r,e,!1)})})},ur=async()=>{if(b.states.length===0)return;const t=(b.states.findIndex(n=>n.id===b.activeStateId)+1)%b.states.length;await si(b.states[t].id)},fr=async()=>{if(b.states.length===0)return;let t=b.states.findIndex(n=>n.id===b.activeStateId)-1;t<0&&(t=b.states.length-1),await si(b.states[t].id)},ba=()=>{Xt.length=0,fe.length=0,P("undoStackLength",0),P("redoStackLength",0)},wa=(i="slides")=>{const t=So("Untitled",i);Un(t),P("showSlideToolbar",!0),P("showUtilityToolbar",!0),setTimeout(()=>{const n=b.slides[0];if(n){const{x:r,y:e}=n.spatialPosition,{width:o,height:l}=n.dimensions;P("viewState",{scale:1,panX:(window.innerWidth-o)/2-r,panY:(window.innerHeight-l)/2-e})}else P("viewState",{scale:1,panX:0,panY:0})},120),nt(`New ${i==="slides"?"presentation":"sketch"} created`,"info")},va=i=>{const t=b.elements.find(o=>o.id===i);if(!t)return;Q();const n=Lt(t.type),r=10/b.viewState.scale,e={...t,id:n,x:t.x+r,y:t.y+r,points:t.points?t.pointsEncoding==="flat"?[...t.points]:t.points.map(o=>({...o})):void 0,roundness:t.roundness?{...t.roundness}:null,crop:t.crop?{...t.crop}:null,boundElements:null,groupIds:t.groupIds?[...t.groupIds]:void 0,seed:Math.floor(Math.random()*2147483647)};P("elements",o=>[...o,e]),P("selection",[n])},pr=()=>{if(b.selection.length<2)return;Q();const i=Lt("group");P("elements",t=>b.selection.includes(t.id),"groupIds",t=>[...t||[],i])},gr=()=>{if(b.selection.length===0)return;const i=new Set;b.elements.forEach(t=>{b.selection.includes(t.id)&&t.groupIds&&t.groupIds.length>0&&i.add(t.groupIds[t.groupIds.length-1])}),i.size!==0&&(Q(),P("elements",t=>{if(!t.groupIds||t.groupIds.length===0)return!1;const n=t.groupIds[t.groupIds.length-1];return i.has(n)},"groupIds",t=>t&&t.slice(0,-1)))},Ii=(i,t)=>{const n=b.elements.findIndex(r=>r.id===i);n!==-1&&(Q(),P("elements",r=>{const e=[...r],o=e.splice(n,1)[0];if(t==="front")e.push(o);else if(t==="back")e.unshift(o);else if(t==="forward"){const l=Math.min(e.length,n+1);e.splice(l,0,o)}else if(t==="backward"){const l=Math.max(0,n-1);e.splice(l,0,o)}return e}))},xa=()=>{const i=b.theme==="light"?"dark":"light";P("theme",i),localStorage.setItem("theme",i),document.documentElement.setAttribute("data-theme",i);const t=i==="dark"?"#000000":"#ffffff",n=i==="dark"?"#ffffff":"#000000";P("defaultElementStyles","strokeColor",n);for(const r of Object.keys(b.toolStyles))b.toolStyles[r]?.strokeColor===t&&P("toolStyles",r,"strokeColor",n)},yr=()=>{if(b.elements.length===0){P("viewState",{scale:1,panX:0,panY:0});return}let i=1/0,t=1/0,n=-1/0,r=-1/0;b.elements.forEach(m=>{i=Math.min(i,m.x),n=Math.max(n,m.x+m.width),t=Math.min(t,m.y),r=Math.max(r,m.y+m.height)});const e=n-i,o=r-t;if(e===0&&o===0){const m=i,y=t,w=window.innerWidth/2,v=window.innerHeight/2;P("viewState",{scale:1,panX:-m+w,panY:-y+v});return}const l=50,s=window.innerWidth,a=window.innerHeight,c=(s-l*2)/e,h=(a-l*2)/o;let d=Math.min(c,h);d=Math.min(Math.max(d,.1),2);const u=i+e/2,f=t+o/2,g=s/2,p=a/2;P("viewState",{scale:d,panX:-u*d+g,panY:-f*d+p})},ka=(i,t)=>{if(b.layers.length>=b.maxLayers){console.warn(`Layer limit reached (${b.maxLayers} layers max)`);return}Q();const n=crypto.randomUUID(),r=Math.max(...b.layers.map(o=>o.order),-1),e={id:n,name:i||`Layer ${b.layers.length+1}`,visible:!0,locked:!1,opacity:1,order:r+1,backgroundColor:"transparent",colorTag:void 0,parentId:t,isGroup:!1,expanded:!0};return P("layers",[...b.layers,e]),P("activeLayerId",n),n},fh=i=>{if(b.layers.length<=1){nt("Cannot delete the last layer.","error");return}const t=b.layers.find(r=>r.id===i);if(!t)return;const n=b.elements.filter(r=>r.layerId===i);if(n.length>0){const r=confirm(`Layer "${t.name}" contains ${n.length} element(s).

Click "OK" to delete the layer AND all its elements.
Click "Cancel" to delete the layer but move elements to another layer.`);if(Q(),r)P("elements",b.elements.filter(e=>e.layerId!==i));else{const e=b.layers.find(o=>o.id!==i);e&&b.elements.forEach((o,l)=>{o.layerId===i&&P("elements",l,"layerId",e.id)})}}else Q();P("layers",b.layers.filter(r=>r.id!==i)),b.activeLayerId===i&&P("activeLayerId",b.layers[0]?.id||"default-layer")},ph=(i,t)=>{const n=b.layers.findIndex(r=>r.id===i);n!==-1&&P("layers",n,t)},gh=i=>{if(b.layers.length>=b.maxLayers){console.warn(`Layer limit reached (${b.maxLayers} layers max)`);return}const t=b.layers.find(s=>s.id===i);if(!t)return;Q();const n=crypto.randomUUID(),r={...t,id:n,name:`${t.name} Copy`,opacity:t.opacity??1,order:t.order+.5,backgroundColor:t.backgroundColor||"transparent",parentId:t.parentId,isGroup:t.isGroup,expanded:t.expanded},o=b.elements.filter(s=>s.layerId===i).map(s=>({...s,id:crypto.randomUUID(),layerId:n,x:s.x+10,y:s.y+10}));P("layers",[...b.layers,r]),P("elements",[...b.elements,...o]),[...b.layers].sort((s,a)=>s.order-a.order).forEach((s,a)=>{const c=b.layers.findIndex(h=>h.id===s.id);P("layers",c,"order",a)}),P("activeLayerId",n)},$i=(i,t)=>{if(i===t)return;Q();const n=[...b.layers],[r]=n.splice(i,1);n.splice(t,0,r),n.forEach((e,o)=>{e.order=o}),P("layers",n)},mr=i=>{b.layers.find(n=>n.id===i)&&P("activeLayerId",i)},yh=i=>{const n=[...b.layers].sort((r,e)=>r.order-e.order).reverse()[i];n&&mr(n.id)},mh=i=>{const t=b.layers.findIndex(e=>e.id===i);if(t<=0)return;const n=b.layers[t],r=b.layers[t-1];Q(),P("elements",e=>e.layerId===n.id,"layerId",r.id),P("layers",e=>e.filter(o=>o.id!==n.id)),b.activeLayerId===n.id&&P("activeLayerId",r.id)},bh=()=>{if(b.layers.length<=1)return;Q();const i=b.layers[0];P("elements",t=>t.layerId!==i.id,"layerId",i.id),P("layers",[i]),P("activeLayerId",i.id)},Vt=i=>{const t=b.layers.find(n=>n.id===i);return!t||t.visible===!1?!1:b.layerGroupingModeEnabled&&t.parentId?Vt(t.parentId):!0},br=i=>{const t=b.layers.find(n=>n.id===i);return t?t.locked?!0:b.layerGroupingModeEnabled&&t.parentId?br(t.parentId):t.locked||!1:!1},wh=i=>{b.layers.forEach((t,n)=>{t.id!==i?P("layers",n,"visible",!1):P("layers",n,"visible",!0)})},vh=()=>{b.layers.forEach((i,t)=>{P("layers",t,"visible",!0)})},xh=(i,t)=>{b.layers.find(r=>r.id===t)&&(Q(),i.forEach(r=>{const e=b.elements.findIndex(o=>o.id===r);e!==-1&&P("elements",e,"layerId",t)}))},wr=()=>{P("gridSettings","enabled",!b.gridSettings.enabled)},vr=()=>{P("gridSettings","snapToGrid",!b.gridSettings.snapToGrid)},i2=i=>{P("gridSettings",i)},kh=i=>{P("canvasBackgroundColor",i)},Sh=i=>{P("canvasTexture",i)},Mh=i=>{P("selectedPenType",i)},Ph=i=>{P("selectedShapeType",i)},Ch=i=>{P("selectedInfraType",i)},_h=i=>{P("selectedMathType",i)},Ah=i=>{P("selectedSketchnoteType",i)},Th=i=>{P("selectedPeopleType",i)},Lh=i=>{P("selectedStatusType",i)},Ih=i=>{P("selectedCloudInfraType",i)},$h=i=>{P("selectedDataMetricsType",i)},Rh=i=>{P("selectedConnectionRelType",i)},Eh=i=>{P("selectedWireframeType",i)},r2=i=>{P("gridSettings","style",i)},o2=i=>P("maxLayers",i),hn=i=>P("isPreviewing",i),_e=i=>{b.isPropertyPanelMinimized&&(i===void 0||i===!0)?(P("isPropertyPanelMinimized",!1),P("showPropertyPanel",!0)):P("showPropertyPanel",i??!b.showPropertyPanel)},qn=i=>{P("showLayerPanel",t=>i??!t)},Sa=i=>{P("showSlideToolbar",t=>i??!t)},Nh=(i,t)=>{P("slideToolbarPosition",{x:i,y:t})},$n=i=>{P("showExportDialog",i)},Ma=i=>{P("showUtilityToolbar",t=>i??!t)},s2=i=>{P("isPropertyPanelMinimized",t=>!t)},a2=i=>{P("isLayerPanelMinimized",t=>i??!t)},l2=()=>{P("layerGroupingModeEnabled",i=>!i)},Oh=i=>{Q();const t=crypto.randomUUID(),n=Math.max(...b.layers.map(e=>e.order),-1),r={id:t,name:i||`Group ${b.layers.filter(e=>e.isGroup).length+1}`,visible:!0,locked:!1,opacity:1,order:n+1,backgroundColor:"transparent",isGroup:!0,expanded:!0};return P("layers",[...b.layers,r]),P("activeLayerId",t),t},Bh=i=>{P("layers",t=>t.id===i,"expanded",t=>!t)},ai=i=>{P("minimapVisible",t=>i??!t)},xr=i=>{P("zenMode",t=>i??!t)},kr=i=>{P("showSlideNavigator",t=>i??!t)},Pa=i=>{P("showMainToolbar",t=>i??!t)},ie=()=>{const i=b.slides[b.activeSlideIndex];if(!i)return;const{width:t,height:n}=i.dimensions,{x:r,y:e}=i.spatialPosition,o=40,l=window.innerWidth-o*2,s=window.innerHeight-o*2,a=l/t,c=s/n,h=Math.min(a,c),d=(window.innerWidth-t*h)/2-r*h,u=(window.innerHeight-n*h)/2-e*h;P("viewState",{scale:h,panX:d,panY:u})},Rn=i=>{const t=b.appMode==="presentation",n=i??!t;ee(()=>{P("appMode",n?"presentation":"design"),n&&(P("selection",[]),setTimeout(()=>{ie()},100),Le.init(b.activeSlideIndex),Le.playInitial())}),n?document.documentElement.requestFullscreen?.().catch(r=>{console.warn("Fullscreen failed:",r)}):document.fullscreenElement&&document.exitFullscreen?.()},Dh=i=>{P("selectedTechnicalType",i)},zh=i=>{P("selectedUmlType",i)},Ca=i=>{P("showCommandPalette",t=>i??!t)};document.documentElement.setAttribute("data-theme",Pe.theme);const Fh=i=>{if(b.selection.length<2)return;const t=th(b.selection,b.elements,i);t.length>0&&(Q(),P("elements",n=>t.some(r=>r.id===n.id),n=>{const r=t.find(e=>e.id===n.id)?.updates;return r?{...n,...r}:n}))},Wh=()=>{if(b.selection.length===0){const i=["solid","dashed","dotted"],t=b.defaultElementStyles.strokeStyle||"solid",n=i[(i.indexOf(t)+1)%i.length];ne({strokeStyle:n});return}Q(),P("elements",i=>b.selection.includes(i.id),i=>{const t=["solid","dashed","dotted"],n=i.strokeStyle||"solid";return{strokeStyle:t[(t.indexOf(n)+1)%t.length]}})},jh=()=>{if(b.selection.length===0){const i=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],t=b.defaultElementStyles.fillStyle||"hachure",n=i[(i.indexOf(t)+1)%i.length];ne({fillStyle:n});return}Q(),P("elements",i=>b.selection.includes(i.id),i=>{const t=["hachure","solid","zigzag","cross-hatch","dots","dashed","zigzag-line"],n=i.fillStyle||"hachure";return{fillStyle:t[(t.indexOf(n)+1)%t.length]}})},Uh=i=>{if(b.selection.length<3)return;const t=eh(b.selection,b.elements,i);t.length>0&&(Q(),P("elements",n=>t.some(r=>r.id===n.id),n=>{const r=t.find(e=>e.id===n.id)?.updates;return r?{...n,...r}:n}))},_a=i=>{ba(),P({elements:i.elements,layers:i.layers,activeLayerId:i.layers[0]?.id||"default-layer",viewState:i.viewState||{scale:1,panX:0,panY:0},gridSettings:i.gridSettings||b.gridSettings,globalSettings:i.globalSettings||b.globalSettings,canvasBackgroundColor:i.canvasBackgroundColor||b.canvasBackgroundColor,selection:[]})},Sr=i=>{const t=b.elements.find(n=>n.id===i);t&&D(i,{isCollapsed:!t.isCollapsed},!0)},Aa=(i,t)=>{D(i,{parentId:t},!0)},qh=i=>{D(i,{parentId:null},!0)},Se=(i,t)=>{const n=new Po,r=n.buildTree(i,b.elements);if(!r)return;Q(),t.startsWith("horizontal")?n.layoutHorizontal(r,t==="horizontal-right"?"right":"left"):t.startsWith("vertical")?n.layoutVertical(r,t==="vertical-down"?"down":"up"):t==="radial"&&n.layoutRadial(r);const e=n.getUpdates(r,b.elements),o=b.elements.map(l=>{const s=e.get(l.id);return s?{...l,...s}:l});P("elements",o),nt(`Mindmap layout updated (${t})`,"success")},Ta=i=>{const t=new Po,n=t.buildTree(i,b.elements);if(!n)return;Q(),t.applySemanticStyling(n,b.elements);const r=t.getUpdates(n,b.elements),e=b.elements.map(o=>{const l=r.get(o.id);return l?{...o,...l}:o});P("elements",e),nt("Semantic styling applied to branch","success")};typeof window<"u"&&setInterval(()=>{const i=Date.now(),t=b.elements.filter(n=>n.ttl&&i>n.ttl).map(n=>n.id);t.length>0&&P("elements",n=>n.filter(r=>!t.includes(r.id)))},500);const c2=(i,t)=>{if(!(!t||i===t)){if(b.elements.some(n=>n.id===t)){nt("ID already exists","error");return}Q(),P("elements",n=>n.map(r=>{if(r.id===i)return{...r,id:t};let e={};return r.parentId===i&&(e.parentId=t),r.orbitCenterId===i&&(e.orbitCenterId=t),r.startBinding?.elementId===i&&(e.startBinding={...r.startBinding,elementId:t}),r.endBinding?.elementId===i&&(e.endBinding={...r.endBinding,elementId:t}),Object.keys(e).length>0?{...r,...e}:r})),b.selection.includes(i)&&P("selection",n=>n.map(r=>r===i?t:r))}},La=(i,t,n,r,e=new Set,o=!1)=>{if(r.has(i.id))return r.get(i.id);if(e.has(i.id))return{x:i.x,y:i.y,angle:i.angle||0,opacity:i.opacity||100};e.add(i.id);let l=i.x,s=i.y,a=i.angle||0;const c=i.orbitSpeed!==void 0?Number(i.orbitSpeed):1,h=i.orbitRadius!==void 0?Number(i.orbitRadius):150;if(i.orbitEnabled&&i.orbitCenterId&&!isNaN(h)&&!isNaN(c)){const f=n.get(i.orbitCenterId);if(f){const g=La(f,t,n,r,e,o),p=Number(g.x)||0,m=Number(g.y)||0,y=Number(f.width)||0,w=Number(f.height)||0,v=p+y/2,x=m+w/2;if(o){const k=t*.001*c,S=v+h*Math.cos(k),M=x+h*Math.sin(k);l=S-(Number(i.width)||0)/2,s=M-(Number(i.height)||0)/2}}}const d=i.spinSpeed!==void 0?Number(i.spinSpeed):5;if(i.spinEnabled&&!isNaN(d)&&o){const f=t*.001;a+=f*(d*Math.PI/3)}isNaN(l)&&(l=i.x),isNaN(s)&&(s=i.y),isNaN(a)&&(a=i.angle||0);const u={x:l,y:s,angle:a,opacity:i.opacity||100};return r.set(i.id,u),e.delete(i.id),u},Mr=(i,t,n=!1)=>{const r=new Map;i.forEach(l=>r.set(l.id,l));const e=new Map,o=new Set;return i.forEach(l=>{La(l,t,r,e,o,n)}),e};class Hh{renderers=new Map;register(t,n){this.renderers.set(t,n)}getRenderer(t){return this.renderers.get(t)}}const dt=new Hh,ft=i=>{if(!i||i.length===0)return[];if(typeof i[0]=="number"){const t=[];for(let n=0;n<i.length-1;n+=2)t.push({x:i[n],y:i[n+1]});return t}return i},dn=(i,t,n,r,e)=>{const o=1-e;return o*o*o*i+3*o*o*e*t+3*o*e*e*n+e*e*e*r},te=(i,t,n,r=!1,e=1)=>{const o=dt.getRenderer(n.type);if(o){o.render({rc:i,ctx:t,element:n,isDarkMode:r,layerOpacity:e});return}console.warn(`No renderer registered for element type: ${n.type}`)};var Yh=$("<div class=context-menu>"),Xh=$("<span class=menu-item-icon style=font-size:20px;line-height:1>"),Gh=$("<span class=menu-item-shortcut>"),Vh=$("<span class=menu-item-arrow>"),Qh=$("<button><span class=menu-item-check>"),Zh=$("<div class=menu-item-wrapper style=position:relative>"),Jh=$("<div class=context-menu-separator>"),Kh=$("<span class=menu-item-label>");const Ia=i=>{let t;const[n,r]=H({x:i.x,y:i.y}),[e,o]=H(null);ye(()=>{if(!i.parent){if(t){const h=t.getBoundingClientRect(),d=window.innerWidth,u=window.innerHeight;let f=i.x,g=i.y;i.x+h.width>d&&(f=d-h.width-10),i.y+h.height>u&&(g=u-h.height-10),r({x:f,y:g})}const a=h=>{h.target.closest(".context-menu")||i.onClose()},c=h=>{h.key==="Escape"&&i.onClose()};document.addEventListener("mousedown",a),document.addEventListener("keydown",c),mt(()=>{document.removeEventListener("mousedown",a),document.removeEventListener("keydown",c)})}});const l=(a,c)=>{a.disabled||a.separator||(a.submenu?o(e()===c?null:c):(a.onClick?.(),i.onClose()))},s=a=>{i.items[a].submenu?o(a):o(null)};return(()=>{var a=Yh(),c=t;return typeof c=="function"?tt(c,a):t=a,I(a,_(zt,{get each(){return i.items},children:(h,d)=>(()=>{var u=Zh();return u.addEventListener("mouseenter",()=>s(d())),I(u,_(q,{get when(){return!h.separator},get fallback(){return Jh()},get children(){return[(()=>{var f=Qh(),g=f.firstChild;return f.$$click=()=>l(h,d()),I(g,()=>h.checked?"":""),I(f,_(q,{get when(){return h.icon},get fallback(){return(()=>{var p=Kh();return I(p,()=>h.label),p})()},get children(){var p=Xh();return I(p,()=>h.icon),p}}),null),I(f,_(q,{get when(){return h.shortcut},get children(){var p=Gh();return I(p,()=>h.shortcut),p}}),null),I(f,_(q,{get when(){return h.submenu},get children(){return Vh()}}),null),N(p=>{var m=`context-menu-item ${h.disabled?"disabled":""} ${e()===d()?"active":""}`,y=h.disabled,w=h.tooltip||h.label;return m!==p.e&&it(f,p.e=m),y!==p.t&&(f.disabled=p.t=y),w!==p.a&&L(f,"title",p.a=w),p},{e:void 0,t:void 0,a:void 0}),f})(),_(q,{get when(){return $e(()=>!!h.submenu)()&&e()===d()},get children(){return _(Ia,{get x(){const f=t?.querySelector(`.menu-item-wrapper:nth-child(${d()+1}) button`)?.getBoundingClientRect();return f?f.right:0},get y(){const f=t?.querySelector(`.menu-item-wrapper:nth-child(${d()+1}) button`)?.getBoundingClientRect();return f?f.top:0},get items(){return h.submenu},get onClose(){return i.onClose},parent:!1,get gridColumns(){return h.gridColumns}})}})]}})),u})()})),N(h=>{var d=i.parent?"100%":`${n().x}px`,u=i.parent?"0":`${n().y}px`,f=i.parent?"absolute":"fixed",g=i.parent?"-4px":"0",p=i.gridColumns?"grid":"block",m=i.gridColumns?`repeat(${i.gridColumns}, 1fr)`:void 0,y=i.gridColumns?"4px":void 0,w=i.gridColumns?"8px":void 0;return d!==h.e&&ot(a,"left",h.e=d),u!==h.t&&ot(a,"top",h.t=u),f!==h.a&&ot(a,"position",h.a=f),g!==h.o&&ot(a,"margin-left",h.o=g),p!==h.i&&ot(a,"display",h.i=p),m!==h.n&&ot(a,"grid-template-columns",h.n=m),y!==h.s&&ot(a,"gap",h.s=y),w!==h.h&&ot(a,"padding",h.h=w),h},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),a})()};ht(["click"]);const wi=new Map,un=new Set;let Ri=null;const td=i=>{Ri=i},$a=i=>{if(wi.has(i))return wi.get(i);if(!un.has(i)){un.add(i);const t=new Image;t.src=i,t.onload=()=>{wi.set(i,t),un.delete(i),Ri&&Ri()},t.onerror=()=>{un.delete(i)}}return null};function ed(){return{isDrawing:!1,currentId:null,startX:0,startY:0,isDragging:!1,isSelecting:!1,draggingHandle:null,initialPositions:new Map,draggingFromConnector:null,hoveredConnector:null,initialElementX:0,initialElementY:0,initialElementWidth:0,initialElementHeight:0,initialElementFontSize:20,lastSnappingTime:0,laserTrailData:[],laserRafPending:!1,lastLaserUpdateTime:0,penPointsBuffer:[],lastPenUpdateTime:0,penUpdatePending:!1}}const nd=(i,t)=>{let n=!1;for(let r=0,e=t.length-1;r<t.length;e=r++){const o=t[r].x,l=t[r].y,s=t[e].x,a=t[e].y;l>i.y!=a>i.y&&i.x<(s-o)*(i.y-l)/(a-l)+o&&(n=!n)}return n},Ei=(i,t,n)=>{const r=i.x,e=i.y,o=t.x,l=t.y,s=n.x,a=n.y,c=r-o,h=e-l,d=s-o,u=a-l,f=c*d+h*u,g=d*d+u*u;let p=-1;g!==0&&(p=f/g);let m,y;p<0?(m=o,y=l):p>1?(m=s,y=a):(m=o+p*d,y=l+p*u);const w=r-m,v=e-y;return Math.sqrt(w*w+v*v)},Hn=(i,t,n,r,e)=>{const o=1-e;return o*o*o*i+3*o*o*e*t+3*o*e*e*n+e*e*e*r},id=(i,t,n,r,e)=>{const o=3*(1-e)*(1-e)*(t.x-i.x)+6*(1-e)*e*(n.x-t.x)+3*e*e*(r.x-n.x),l=3*(1-e)*(1-e)*(t.y-i.y)+6*(1-e)*e*(n.y-t.y)+3*e*e*(r.y-n.y);return Math.atan2(l,o)},Ra=(i,t,n,r,e)=>{const l=Math.max(e*8,4),s=Math.max(e*2,2),a=[],c=[];for(let h=0;h<=20;h++){const d=h/20,u=Hn(i.x,n.x,r.x,t.x,d),f=Hn(i.y,n.y,r.y,t.y,d),g=id(i,n,r,t,d),m=(l+(s-l)*d)/2,y=Math.cos(g+Math.PI/2)*m,w=Math.sin(g+Math.PI/2)*m;a.push({x:u+y,y:f+w}),c.push({x:u-y,y:f-w})}return[...a,...c.reverse()]},rd=(i,t,n,r,e=20)=>{const o=[];for(let l=0;l<=e;l++){const s=l/e;o.push({x:Hn(i.x,t.x,n.x,r.x,s),y:Hn(i.y,t.y,n.y,r.y,s)})}return o},fn=(i,t,n,r,e,o)=>{const l=rd(t,n,r,e,20);return En(i,l,o)},En=(i,t,n)=>{if(t.length<2)return!1;for(let r=0;r<t.length-1;r++)if(Ei(i,t[r],t[r+1])<=n)return!0;return!1},od=(i,t,n,r,e,o=0)=>{const l=Math.abs(r/2)+o,s=Math.abs(e/2)+o,a=t+r/2,c=n+e/2;return l<=0||s<=0?!1:Math.pow(i.x-a,2)/Math.pow(l,2)+Math.pow(i.y-c,2)/Math.pow(s,2)<=1},Pt=(i,t,n,r,e)=>{const o=Math.cos(e),l=Math.sin(e);return{x:o*(i-n)-l*(t-r)+n,y:l*(i-n)+o*(t-r)+r}},Ni=(i,t,n=0)=>{const r=i.x+i.width/2,e=i.y+i.height/2;if(i.type==="rectangle"||i.type==="image"||i.type==="text"){let o={x:t.x,y:t.y};i.angle&&(o=Pt(t.x,t.y,r,e,-i.angle));const l=i.width,s=i.height,a=r-l/2-n,c=r+l/2+n,h=e-s/2-n,d=e+s/2+n,u=o.x-r,f=o.y-e;if(u===0&&f===0)return{x:r,y:e};let g=1/0;if(u!==0){const y=(a-r)/u;y>0&&(g=Math.min(g,y));const w=(c-r)/u;w>0&&(g=Math.min(g,w))}if(f!==0){const y=(h-e)/f;y>0&&(g=Math.min(g,y));const w=(d-e)/f;w>0&&(g=Math.min(g,w))}if(g===1/0)return null;const p=r+u*g,m=e+f*g;return i.angle?Pt(p,m,r,e,i.angle):{x:p,y:m}}else if(i.type==="circle"){const o=i.width/2+n,l=i.height/2+n;let s={x:t.x,y:t.y};i.angle&&(s=Pt(t.x,t.y,r,e,-i.angle));const a=s.x-r,c=s.y-e;if(a===0&&c===0)return null;const h=a*a/(o*o)+c*c/(l*l),d=1/Math.sqrt(h),u=r+a*d,f=e+c*d;return i.angle?Pt(u,f,r,e,i.angle):{x:u,y:f}}else if(i.type==="diamond"){let o={x:t.x,y:t.y};i.angle&&(o=Pt(t.x,t.y,r,e,-i.angle));const l=i.width/2+n,s=i.height/2+n,a=o.x-r,c=o.y-e;if(a===0&&c===0)return{x:r,y:e};const h=Math.atan2(c,a),d=Math.abs(Math.tan(h)),u=1/(1/l+d/s),f=r+(a>0?1:-1)*u,g=e+(a>0?1:-1)*u*Math.tan(h);return i.angle?Pt(f,g,r,e,i.angle):{x:f,y:g}}else if(i.type==="triangle"||i.type==="hexagon"||i.type==="octagon"||i.type==="parallelogram"||i.type==="star"||i.type==="cloud"||i.type==="heart"||i.type==="arrowLeft"||i.type==="arrowRight"||i.type==="arrowUp"||i.type==="arrowDown"||i.type==="capsule"||i.type==="stickyNote"||i.type==="callout"||i.type==="burst"||i.type==="speechBubble"||i.type==="ribbon"||i.type==="bracketLeft"||i.type==="bracketRight"||i.type==="database"||i.type==="document"||i.type==="predefinedProcess"||i.type==="internalStorage"||i.type==="server"||i.type==="loadBalancer"||i.type==="firewall"||i.type==="user"||i.type==="messageQueue"||i.type==="lambda"||i.type==="router"||i.type==="browser"||i.type==="trapezoid"||i.type==="rightTriangle"||i.type==="pentagon"||i.type==="septagon"||i.type==="starPerson"||i.type==="scroll"||i.type==="wavyDivider"||i.type==="doubleBanner"||i.type==="lightbulb"||i.type==="signpost"||i.type==="burstBlob"||i.type==="browserWindow"||i.type==="mobilePhone"||i.type==="ghostButton"||i.type==="inputField"||i.type==="fineliner"||i.type==="inkbrush"||i.type==="marker"){let o={x:t.x,y:t.y};i.angle&&(o=Pt(t.x,t.y,r,e,-i.angle));const l=i.width,s=i.height,a=r-l/2-n,c=r+l/2+n,h=e-s/2-n,d=e+s/2+n,u=o.x-r,f=o.y-e;if(u===0&&f===0)return{x:r,y:e};let g=1/0;if(u!==0){const y=(a-r)/u;y>0&&(g=Math.min(g,y));const w=(c-r)/u;w>0&&(g=Math.min(g,w))}if(f!==0){const y=(h-e)/f;y>0&&(g=Math.min(g,y));const w=(d-e)/f;w>0&&(g=Math.min(g,w))}if(g===1/0)return null;const p=r+u*g,m=e+f*g;return i.angle?Pt(p,m,r,e,i.angle):{x:p,y:m}}return null},Ae=(i,t,n)=>{if((i.type==="line"||i.type==="arrow")&&i.endBinding){const o=i.endBinding.elementId,l=n?n.get(o):t.find(s=>s.id===o);if(l&&Ae(l,t,n))return!0}if(!i.parentId)return!1;let r=i.parentId;const e=new Set;for(;r&&!e.has(r);){e.add(r);const o=r,l=n?n.get(o):t.find(s=>s.id===o);if(!l)break;if(l.isCollapsed)return!0;r=l.parentId||null}return!1},Ea=(i,t)=>{const n=[],r=[i],e=new Set;for(;r.length>0;){const o=r.shift();if(e.has(o))continue;e.add(o);const l=t.filter(s=>s.parentId===o);n.push(...l),r.push(...l.map(s=>s.id))}return n};function sd(i,t,n,r,e){return Pt(i,t,n,r,-e)}function en(i,t,n,r,e,o){if(Ae(i,e,o))return!1;const l=i.x+i.width/2,s=i.y+i.height/2,a=sd(t,n,l,s,i.angle||0);let c=Math.min(i.x,i.x+i.width),h=Math.max(i.x,i.x+i.width),d=Math.min(i.y,i.y+i.height),u=Math.max(i.y,i.y+i.height);if(i.type==="solidBlock"){const f=i.depth!==void 0?i.depth:50,g=(i.viewAngle!==void 0?i.viewAngle:45)*Math.PI/180,p=f*Math.cos(g),m=f*Math.sin(g);c=Math.min(c,c+p,h+p),h=Math.max(h,c+p,h+p),d=Math.min(d,d+m,u+m),u=Math.max(u,d+m,u+m)}else if(i.type==="perspectiveBlock"){const f=i.depth!==void 0?i.depth:50,g=(i.viewAngle!==void 0?i.viewAngle:45)*Math.PI/180,p=(i.skewX||0)*i.width,m=(i.skewY||0)*i.height,y=f*Math.cos(g)+p,w=f*Math.sin(g)+m,v=i.taper||0,x=i.width/2*(1-v),k=i.height/2*(1-v),S=i.x+i.width/2,M=i.y+i.height/2,C=S+y-x,R=S+y+x,E=M+w-k,O=M+w+k;c=Math.min(c,C,R),h=Math.max(h,C,R),d=Math.min(d,E,O),u=Math.max(u,E,O)}if(a.x<c-r||a.x>h+r||a.y<d-r||a.y>u+r)return!1;if(i.type==="rectangle"||i.type==="solidBlock"||i.type==="isometricCube"||i.type==="perspectiveBlock")return!0;if(i.type==="diamond"){const f=i.x+i.width/2,g=i.y+i.height/2,p=Math.abs(a.x-f),m=Math.abs(a.y-g);return 2*p/i.width+2*m/i.height<=1}else{if(i.type==="circle")return od(a,i.x,i.y,i.width,i.height,r);if(i.type==="line"||i.type==="arrow"){const f=i.x+i.width,g=i.y+i.height;if(i.curveType==="bezier"){const p=i.width,m=i.height;let y={x:i.x,y:i.y},w={x:f,y:g};if(i.controlPoints&&i.controlPoints.length>0){const v={x:i.x,y:i.y},x={x:f,y:g};if(i.controlPoints.length===2)return fn(a,v,i.controlPoints[0],i.controlPoints[1],x,r);{const k=i.controlPoints[0],S={x:v.x+2/3*(k.x-v.x),y:v.y+2/3*(k.y-v.y)},M={x:x.x+2/3*(k.x-x.x),y:x.y+2/3*(k.y-x.y)};return fn(a,v,S,M,x,r)}}else return Math.abs(p)>Math.abs(m)?(y={x:i.x+p/2,y:i.y},w={x:f-p/2,y:g},fn(a,{x:i.x,y:i.y},y,w,{x:f,y:g},r)):(y={x:i.x,y:i.y+m/2},w={x:f,y:g-m/2},fn(a,{x:i.x,y:i.y},y,w,{x:f,y:g},r))}else if(i.curveType==="elbow"){const p=ft(i.points);if(p&&p.length>0){const m={x:a.x-i.x,y:a.y-i.y};return En(m,p,r)}else return Ei(a,{x:i.x,y:i.y},{x:f,y:g})<=r}else{if(i.points&&i.points.length>0){const p=ft(i.points);if(p.length>1){const m={x:a.x-i.x,y:a.y-i.y};return En(m,p,r)}}return Ei(a,{x:i.x,y:i.y},{x:i.x+i.width,y:i.y+i.height})<=r}}else if(i.type==="fineliner"||i.type==="marker"||i.type==="inkbrush"||i.type==="ink"){const f=ft(i.points);if(f.length>0){const g={x:a.x-i.x,y:a.y-i.y};return En(g,f,r+(i.strokeWidth||0)/2)}return!1}else if(i.type==="organicBranch"){const f=ft(i.points),g=i.controlPoints||[];if(f.length<2||g.length<2)return!1;const p={x:i.x+f[0].x,y:i.y+f[0].y},m={x:i.x+f[f.length-1].x,y:i.y+f[f.length-1].y},y=Ra(p,m,g[0],g[1],i.strokeWidth);return nd(a,y)}else{if(i.type==="text"||i.type==="image")return!0;if(i.type==="triangle"||i.type==="hexagon"||i.type==="octagon"||i.type==="parallelogram"||i.type==="star"||i.type==="cloud"||i.type==="heart"||i.type==="cross"||i.type==="checkmark"||i.type==="arrowLeft"||i.type==="arrowRight"||i.type==="arrowUp"||i.type==="arrowDown"||i.type==="capsule"||i.type==="stickyNote"||i.type==="callout"||i.type==="burst"||i.type==="speechBubble"||i.type==="ribbon"||i.type==="bracketLeft"||i.type==="bracketRight"||i.type==="database"||i.type==="document"||i.type==="predefinedProcess"||i.type==="internalStorage"||i.type==="server"||i.type==="loadBalancer"||i.type==="firewall"||i.type==="user"||i.type==="messageQueue"||i.type==="lambda"||i.type==="router"||i.type==="browser"||i.type==="trapezoid"||i.type==="rightTriangle"||i.type==="pentagon"||i.type==="septagon"||i.type==="starPerson"||i.type==="scroll"||i.type==="wavyDivider"||i.type==="doubleBanner"||i.type==="lightbulb"||i.type==="signpost"||i.type==="burstBlob"||i.type==="browserWindow"||i.type==="mobilePhone"||i.type==="ghostButton"||i.type==="inputField"||i.type==="polygon"||i.type==="dfdProcess"||i.type==="dfdDataStore"||i.type==="cylinder"||i.type==="stateStart"||i.type==="stateEnd"||i.type==="stateSync"||i.type==="activationBar"||i.type==="externalEntity"||i.type==="umlClass"||i.type==="umlInterface"||i.type==="umlActor"||i.type==="umlUseCase"||i.type==="umlNote"||i.type==="umlPackage"||i.type==="umlComponent"||i.type==="umlState"||i.type==="umlLifeline"||i.type==="umlFragment"||i.type==="umlSignalSend"||i.type==="umlSignalReceive"||i.type==="umlProvidedInterface"||i.type==="umlRequiredInterface"||i.type==="trophy"||i.type==="clock"||i.type==="gear"||i.type==="target"||i.type==="rocket"||i.type==="flag"||i.type==="key"||i.type==="magnifyingGlass"||i.type==="book"||i.type==="megaphone"||i.type==="eye"||i.type==="thoughtBubble"||i.type==="stickFigure"||i.type==="sittingPerson"||i.type==="presentingPerson"||i.type==="handPointRight"||i.type==="thumbsUp"||i.type==="faceHappy"||i.type==="faceSad"||i.type==="faceConfused"||i.type==="checkbox"||i.type==="checkboxChecked"||i.type==="numberedBadge"||i.type==="questionMark"||i.type==="exclamationMark"||i.type==="tag"||i.type==="pin"||i.type==="stamp"||i.type==="kubernetes"||i.type==="container"||i.type==="apiGateway"||i.type==="cdn"||i.type==="storageBlob"||i.type==="eventBus"||i.type==="microservice"||i.type==="shield"||i.type==="barChart"||i.type==="pieChart"||i.type==="trendUp"||i.type==="trendDown"||i.type==="funnel"||i.type==="gauge"||i.type==="table"||i.type==="puzzlePiece"||i.type==="chainLink"||i.type==="bridge"||i.type==="magnet"||i.type==="scale"||i.type==="seedling"||i.type==="tree"||i.type==="mountain")return!0}}return!1}function ad(i,t,n){if(b.appMode!=="presentation")return!1;const r=b.selectedTool==="selection"||b.selectedTool==="pan";return b.docType==="slides"?r?(i.button===0&&dr(),!0):!1:i.button===0||i.button===1?(t.isDragging=!0,t.startX=i.clientX,t.startY=i.clientY,i.currentTarget.setPointerCapture(i.pointerId),!0):!1}function ld(i,t){if(b.appMode!=="presentation")return!1;const n=b.selectedTool==="selection"||b.selectedTool==="pan";return b.docType==="slides"&&n?!0:b.docType==="slides"?!1:t.isDragging?(St({panX:b.viewState.panX+i.movementX,panY:b.viewState.panY+i.movementY}),!0):!1}function cd(i){if(b.appMode!=="presentation")return!1;const t=b.selectedTool==="selection"||b.selectedTool==="pan";return b.docType==="slides"&&t?!0:b.docType!=="slides"?(i.isDragging=!1,!0):!1}function hd(i,t){i.isDragging=!0,t.setCursor("grabbing")}function dd(i,t,n){n.setCursor(t.isDragging?"grabbing":"grab"),t.isDragging&&St({panX:b.viewState.panX+i.movementX,panY:b.viewState.panY+i.movementY})}function ud(i,t){i.isDragging=!1,t.setCursor("grab")}function fd(i,t,n){n.isDrawing=!0,n.laserTrailData=[{x:i,y:t,timestamp:Date.now()}],n.lastLaserUpdateTime=Date.now()}function pd(i,t,n,r,e){if(!t.isDrawing)return;const o=Date.now();if(o-t.lastLaserUpdateTime>=r){t.lastLaserUpdateTime=o;const{x:l,y:s}=n.getWorldCoordinates(i.clientX,i.clientY);t.laserTrailData.length>=e&&t.laserTrailData.shift(),t.laserTrailData.push({x:l,y:s,timestamp:o}),t.laserRafPending||(t.laserRafPending=!0,requestAnimationFrame(()=>{t.laserRafPending=!1,n.draw()}))}}function gd(i,t){i.isDrawing=!1;const n=()=>{i.laserTrailData.length>0&&(t.draw(),requestAnimationFrame(n))};requestAnimationFrame(n)}function yd(i,t,n){const r=Lt("text"),e={...b.defaultElementStyles,id:r,type:"text",x:i,y:t,width:100,height:30,text:"",layerId:b.activeLayerId};ge(e),n.setEditingId(r),n.setEditText(""),setTimeout(()=>n.textInputRef?.focus(),0)}function md(i,t,n){n.isDrawing=!0,n.startX=i,n.startY=t,n.currentId=Lt("ink");const r={...b.defaultElementStyles,id:n.currentId,type:"ink",x:i,y:t,width:0,height:0,strokeColor:"#ef4444",strokeWidth:4,opacity:100,points:[0,0],pointsEncoding:"flat",ttl:Date.now()+3e3,layerId:b.activeLayerId,seed:Math.floor(Math.random()*2**31)};ge(r)}function bd(i,t,n,r){n.isDrawing=!0;const e=10/b.viewState.scale,o=new Map;for(const l of b.elements)o.set(l.id,l);for(let l=b.elements.length-1;l>=0;l--){const s=b.elements[l];r.canInteractWithElement(s)&&Vt(s.layerId)&&en(r.applyMasterProjection(s),i,t,e,b.elements,o)&&oe([s.id])}}function wd(i,t,n){const r=10/b.viewState.scale,e=new Map;for(const o of b.elements)e.set(o.id,o);for(let o=b.elements.length-1;o>=0;o--){const l=b.elements[o];n.canInteractWithElement(l)&&Vt(l.layerId)&&en(n.applyMasterProjection(l),i,t,r,b.elements,e)&&oe([l.id])}}function vd(i,t){const n=b.elements.find(h=>h.id===i.id);if(!n)return;const r=i.handle.replace("connector-",""),e=n.x+n.width/2,o=n.y+n.height/2;let l,s;switch(r){case"top":l=e,s=n.y;break;case"right":l=n.x+n.width,s=o;break;case"bottom":l=e,s=n.y+n.height;break;case"left":l=n.x,s=o;break;default:l=e,s=o}t.isDrawing=!0,t.startX=l,t.startY=s,t.currentId=Lt("arrow"),t.draggingFromConnector={elementId:n.id,anchorPosition:r,startX:l,startY:s};const a={...b.defaultElementStyles,id:t.currentId,type:"arrow",x:l,y:s,width:0,height:0,seed:Math.floor(Math.random()*2**31),layerId:b.activeLayerId,curveType:b.defaultElementStyles.curveType||"straight",startBinding:{elementId:n.id,focus:0,gap:5,position:r}};ge(a);const c=n.boundElements||[];D(n.id,{boundElements:[...c,{id:t.currentId,type:"arrow"}]})}function xd(i,t,n){if(!i.currentId)return;if(b.elements.find(e=>e.id===i.currentId)){if(t.suggestedBinding()){const e=t.suggestedBinding(),o={elementId:e.elementId,focus:0,gap:5};D(i.currentId,{endBinding:o});const l=b.elements.find(s=>s.id===e.elementId);if(l){const s=l.boundElements||[];s.find(a=>a.id===i.currentId)||D(l.id,{boundElements:[...s,{id:i.currentId,type:"arrow"}]})}}P("selection",[i.currentId])}i.isDrawing=!1,i.currentId=null,i.draggingFromConnector=null,t.setSuggestedBinding(null),requestAnimationFrame(n.draw)}function kd(i,t){if(!t.isDragging&&!t.isDrawing)return;const n=50,r=10,e=i.clientX,o=i.clientY;let l=0,s=0;e<n&&(l=r),e>window.innerWidth-n&&(l=-r),o<n&&(s=r),o>window.innerHeight-n&&(s=-r),(l!==0||s!==0)&&St({panX:b.viewState.panX+l,panY:b.viewState.panY+s})}const Yr=(i,t)=>Math.round(i/t)*t,Pr=(i,t,n)=>({x:Yr(i,n),y:Yr(t,n)}),Sd=["rectangle","circle","diamond","triangle","hexagon","octagon","pentagon","septagon","star","cloud","heart","capsule","stickyNote","callout","speechBubble","database","document","cylinder","isometricCube","solidBlock","perspectiveBlock","umlClass","umlInterface","umlActor","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive"],Md=["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","browserWindow","mobilePhone","ghostButton","inputField"],Pd=["selection","pan","eraser","fineliner","inkbrush","marker","text","block-text","ink"];function Cd(i,t,n,r){n.isDrawing=!0,n.penPointsBuffer=[],n.lastPenUpdateTime=0;let e=i,o=t;if(b.gridSettings.snapToGrid){const f=Pr(i,t,b.gridSettings.gridSize);e=f.x,o=f.y}n.startX=e,n.startY=o,n.currentId=Lt(b.selectedTool);const l=b.selectedTool,s=l==="bezier"?"line":l,a=l==="bezier"||l==="organicBranch"?"bezier":b.defaultElementStyles.curveType||"straight";let c,h=e,d=o;if(l==="line"||l==="arrow"||l==="bezier"||l==="organicBranch"){const f=r.checkBinding(e,o,n.currentId);f&&(c={elementId:f.element.id,focus:0,gap:5,position:f.position},h=f.snapPoint.x,d=f.snapPoint.y,n.startX=h,n.startY=d)}const u={...b.defaultElementStyles,id:n.currentId,type:s,x:h,y:d,width:0,height:0,seed:Math.floor(Math.random()*2**31)+1,layerId:b.activeLayerId,curveType:a,points:l==="fineliner"||l==="inkbrush"||l==="marker"?[0,0]:void 0,pointsEncoding:l==="fineliner"||l==="inkbrush"||l==="marker"?"flat":void 0,startBinding:c,strokeStyle:Sd.includes(s)?"solid":b.defaultElementStyles.strokeStyle};if(s==="stickyNote"&&(u.backgroundColor="#fef08a",u.fillStyle="solid",u.strokeColor="#000000"),ge(u),c){const f=b.elements.find(g=>g.id===c.elementId);if(f){const g=f.boundElements||[];D(f.id,{boundElements:[...g,{id:n.currentId,type:s}]})}}}function _d(i,t,n,r,e){let o=i,l=t;if(b.selectedTool==="line"||b.selectedTool==="arrow"||b.selectedTool==="bezier"||b.selectedTool==="organicBranch"||n.draggingFromConnector){if(n.currentId){const a=r.checkBinding(i,t,n.currentId);a?(e.setSuggestedBinding({elementId:a.element.id,px:a.snapPoint.x,py:a.snapPoint.y,position:a.position}),o=a.snapPoint.x,l=a.snapPoint.y):e.setSuggestedBinding(null)}}else e.setSuggestedBinding(null);if(!e.suggestedBinding()&&b.gridSettings.snapToGrid){const a=Pr(i,t,b.gridSettings.gridSize);o=a.x,l=a.y}const s={width:o-n.startX,height:l-n.startY};if(b.selectedTool==="organicBranch"){const a=o-n.startX,c=l-n.startY;s.points=[0,0,a,c];const h={x:n.startX+a*.5,y:n.startY},d={x:o-a*.5,y:l};s.controlPoints=[h,d]}n.currentId&&D(n.currentId,s)}function Ad(i,t,n){if(!i.isDrawing||!i.currentId){i.isDrawing=!1,i.currentId=null,i.draggingFromConnector=null;return}const r=b.elements.find(e=>e.id===i.currentId);if(r){if((r.type==="line"||r.type==="arrow"||r.type==="bezier"||r.type==="organicBranch")&&n.suggestedBinding()){const e=n.suggestedBinding(),o={elementId:e.elementId,focus:0,gap:5,position:e.position};D(i.currentId,{endBinding:o});const l=b.elements.find(s=>s.id===e.elementId);if(l){const s=l.boundElements||[];D(l.id,{boundElements:[...s,{id:i.currentId,type:r.type}]})}n.setSuggestedBinding(null)}if(Md.includes(r.type))r.width<0&&D(i.currentId,{x:r.x+r.width,width:Math.abs(r.width)}),r.height<0&&D(i.currentId,{y:r.y+r.height,height:Math.abs(r.height)});else if(r.type==="fineliner"||r.type==="inkbrush"||r.type==="marker"||r.type==="ink"){t.flushPenPoints();const e=b.elements.find(o=>o.id===i.currentId);if(e&&e.points&&e.points.length>2){const o=t.normalizePencil({...e,points:e.points});o&&D(i.currentId,o)}}else r.type==="organicBranch"&&Td(i.currentId,r);Pd.includes(b.selectedTool)||Z("selection"),i.draggingFromConnector&&(P("selection",[i.currentId]),Z("selection"))}i.isDrawing=!1,i.currentId=null,i.draggingFromConnector=null}function Td(i,t){const n=Math.min(t.x,t.x+t.width),r=Math.min(t.y,t.y+t.height),e=Math.abs(t.width),o=Math.abs(t.height),l=t.x-n,s=t.y-r,a=t.x+t.width-n,c=t.y+t.height-r,h=a-l,d={x:n+l+h*.5,y:r+s},u={x:n+a-h*.5,y:r+c};D(i,{x:n,y:r,width:e,height:o,points:[l,s,a,c],controlPoints:[d,u]})}function Ld(i,t,n,r){const{x:e,y:o}=n.getWorldCoordinates(i.clientX,i.clientY),l=e-t.startX,s=o-t.startY;t.penPointsBuffer.push(l,s);const a=Date.now();a-t.lastPenUpdateTime>=r?(t.lastPenUpdateTime=a,n.flushPenPoints()):t.penUpdatePending||(t.penUpdatePending=!0,requestAnimationFrame(()=>{t.penUpdatePending=!1,n.flushPenPoints()}))}function Xr(i,t,n,r,e){return Pt(i,t,n,r,-e)}function Yn(i,t){if(t.length===0)return null;let n=1/0,r=1/0,e=-1/0,o=-1/0,l=!1;return i.forEach(s=>{t.includes(s.id)&&(n=Math.min(n,s.x),r=Math.min(r,s.y),e=Math.max(e,s.x+s.width),o=Math.max(o,s.y+s.height),l=!0)}),l?{x:n,y:r,width:e-n,height:o-r}:null}function Cr(i,t,n,r,e){const o=12/e,l=2/e;if(r.length>1){const s=Yn(n,r);if(s){const a=[{type:"tl",x:s.x-l,y:s.y-l},{type:"tr",x:s.x+s.width+l,y:s.y-l},{type:"br",x:s.x+s.width+l,y:s.y+s.height+l},{type:"bl",x:s.x-l,y:s.y+s.height+l},{type:"tm",x:s.x+s.width/2,y:s.y-l},{type:"rm",x:s.x+s.width+l,y:s.y+s.height/2},{type:"bm",x:s.x+s.width/2,y:s.y+s.height+l},{type:"lm",x:s.x-l,y:s.y+s.height/2}];for(const c of a)if(Math.abs(i-c.x)<=o/2&&Math.abs(t-c.y)<=o/2)return{id:"multi",handle:c.type}}}for(let s=n.length-1;s>=0;s--){const a=n[s];if(Ae(a,n))continue;if(n.some(h=>h.parentId===a.id)&&a.type!=="line"&&a.type!=="arrow"){const h=a.x+a.width/2,d=a.y+a.height/2,u=Xr(i,t,h,d,a.angle||0),f=14/e,g=a.x+a.width+15/e,p=a.y+a.height/2;if(Math.sqrt(Math.pow(u.x-g,2)+Math.pow(u.y-p,2))<=f/2+5/e)return{id:a.id,handle:"mindmap-toggle"}}}for(let s=n.length-1;s>=0;s--){const a=n[s];if(!r.includes(a.id)||r.length>1)continue;const c=a.x+a.width/2,h=a.y+a.height/2,d=a.angle||0,u=Xr(i,t,c,h,d);let f=[{type:"tl",x:a.x-l,y:a.y-l},{type:"tr",x:a.x+a.width+l,y:a.y-l},{type:"br",x:a.x+a.width+l,y:a.y+a.height+l},{type:"bl",x:a.x-l,y:a.y+a.height+l},{type:"tm",x:a.x+a.width/2,y:a.y-l},{type:"rm",x:a.x+a.width+l,y:a.y+a.height/2},{type:"bm",x:a.x+a.width/2,y:a.y+a.height+l},{type:"lm",x:a.x-l,y:a.y+a.height/2}];if(a.type==="line"||a.type==="arrow"||a.type==="organicBranch"){let p=a.x,m=a.y,y=a.x+a.width,w=a.y+a.height;if(a.type==="organicBranch"&&a.points&&a.points.length>=2){const v=ft(a.points);v.length>=2&&(p=a.x+v[0].x,m=a.y+v[0].y,y=a.x+v[v.length-1].x,w=a.y+v[v.length-1].y)}f=[{type:"tl",x:p,y:m},{type:"br",x:y,y:w}]}for(const p of f)if(Math.abs(u.x-p.x)<=o/2&&Math.abs(u.y-p.y)<=o/2)return{id:a.id,handle:p.type};const g={x:a.x+a.width/2,y:a.y-l-20/e};if(Math.abs(u.x-g.x)<=o&&Math.abs(u.y-g.y)<=o/2)return{id:a.id,handle:"rotate"};if(a.type==="isometricCube"){const p=(a.shapeRatio!==void 0?a.shapeRatio:25)/100,m=(a.sideRatio!==void 0?a.sideRatio:50)/100,y=a.height*p,w=a.y+y,v=a.x+a.width*m;if(Math.abs(u.x-v)<=o&&Math.abs(u.y-w)<=o)return{id:a.id,handle:"control-1"}}else if(a.type==="solidBlock"||a.type==="cylinder"){const p=a.depth!==void 0?a.depth:50,m=(a.viewAngle!==void 0?a.viewAngle:45)*Math.PI/180,y=a.x+a.width/2,w=a.y+a.height/2,v=y+p*Math.cos(m),x=w+p*Math.sin(m);if(Math.abs(u.x-v)<=o&&Math.abs(u.y-x)<=o)return{id:a.id,handle:"control-1"}}else if(a.type==="perspectiveBlock"){const p=a.depth!==void 0?a.depth:50,m=(a.viewAngle!==void 0?a.viewAngle:45)*Math.PI/180,y=a.taper!==void 0?a.taper:0,w=(a.skewX!==void 0?a.skewX:0)*a.width,v=(a.skewY!==void 0?a.skewY:0)*a.height,x=a.x+a.width/2,k=a.y+a.height/2,S=p*Math.cos(m)+w,M=p*Math.sin(m)+v,C=1-y,R=a.width/2*C,E=a.height/2*C,O=1-(a.frontTaper||0),z=a.width/2*O,F=a.height/2*O,U=(a.frontSkewX||0)*a.width,J=(a.frontSkewY||0)*a.height,rt=[{x:x+S,y:k+M,handle:"control-1"},{x:x+S-R,y:k+M-E,handle:"control-2"},{x:x+S+R,y:k+M-E,handle:"control-3"},{x:x+S+R,y:k+M+E,handle:"control-4"},{x:x+S-R,y:k+M+E,handle:"control-5"},{x:x+U-z,y:k+J-F,handle:"control-6"},{x:x+U+z,y:k+J-F,handle:"control-7"},{x:x+U+z,y:k+J+F,handle:"control-8"},{x:x+U-z,y:k+J+F,handle:"control-9"}];for(const X of rt)if(Math.abs(u.x-X.x)<=o&&Math.abs(u.y-X.y)<=o)return{id:a.id,handle:X.handle}}else if(a.type==="star"||a.type==="burst"){const p=(a.shapeRatio!==void 0?a.shapeRatio:25)/100,m=a.x+a.width/2,y=a.y+a.height*p;if(Math.abs(u.x-m)<=o&&Math.abs(u.y-y)<=o)return{id:a.id,handle:"control-1"}}if((a.type==="line"||a.type==="arrow"||a.type==="bezier"||a.type==="organicBranch")&&a.controlPoints)if(a.controlPoints.length===1){const p=a.controlPoints[0];let m={x:a.x,y:a.y},y={x:a.x+a.width,y:a.y+a.height};if(a.points&&a.points.length>=2){const x=ft(a.points);x.length>0&&(m={x:a.x+x[0].x,y:a.y+x[0].y},y={x:a.x+x[x.length-1].x,y:a.y+x[x.length-1].y})}const w=.25*m.x+.5*p.x+.25*y.x,v=.25*m.y+.5*p.y+.25*y.y;if(Math.abs(i-w)<=o/2&&Math.abs(t-v)<=o/2)return{id:a.id,handle:"control-0"}}else for(let p=0;p<a.controlPoints.length;p++){const m=a.controlPoints[p];if(Math.abs(i-m.x)<=o/2&&Math.abs(t-m.y)<=o/2)return{id:a.id,handle:`control-${p}`}}if(a.type!=="line"&&a.type!=="arrow"){const p=14/e,m=32/e,y=a.x+a.width/2,w=a.y+a.height/2,v=[{type:"connector-top",x:y,y:a.y-m},{type:"connector-right",x:a.x+a.width+m,y:w},{type:"connector-bottom",x:y,y:a.y+a.height+m},{type:"connector-left",x:a.x-m,y:w}];for(const x of v)if(Math.sqrt(Math.pow(u.x-x.x,2)+Math.pow(u.y-x.y,2))<=p/2+2/e)return{id:a.id,handle:x.type}}}return null}const Id=(i,t,n,r,e)=>{const o=t.filter(x=>i.includes(x.id));if(o.length===0)return{dx:n,dy:r,guides:[]};const l=Math.min(...o.map(x=>x.x))+n,s=Math.max(...o.map(x=>x.x+x.width))+n,a=Math.min(...o.map(x=>x.y))+r,c=Math.max(...o.map(x=>x.y+x.height))+r,h=(l+s)/2,d=(a+c)/2,u=[l,h,s],f=[a,d,c],g=[];let p=0,m=0,y=e+1,w=e+1;const v=t.filter(x=>!i.includes(x.id)&&x.layerId===o[0].layerId);for(const x of v){const k=x.x,S=x.x+x.width,M=(k+S)/2,C=[k,M,S],R=x.y,E=x.y+x.height,O=(R+E)/2,z=[R,O,E];for(const F of u)for(const U of C){const J=Math.abs(F-U);J<y&&(y=J,p=U-F)}for(const F of f)for(const U of z){const J=Math.abs(F-U);J<w&&(w=J,m=U-F)}}if(y<=e)for(const x of v){const k=x.x,S=x.x+x.width,M=(k+S)/2,C=[k,M,S];for(const R of u)for(const E of C)Math.abs(R+p-E)<.1&&g.push({type:"vertical",coordinate:E,elementIds:[x.id]})}if(w<=e)for(const x of v){const k=x.y,S=x.y+x.height,M=(k+S)/2,C=[k,M,S];for(const R of f)for(const E of C)Math.abs(R+m-E)<.1&&g.push({type:"horizontal",coordinate:E,elementIds:[x.id]})}return{dx:n+(y<=e?p:0),dy:r+(w<=e?m:0),guides:g}},$d=(i,t,n,r,e)=>{const o=t.filter(w=>i.includes(w.id));if(o.length===0)return{dx:n,dy:r,guides:[]};let l={minX:Math.min(...o.map(w=>w.x))+n,maxX:Math.max(...o.map(w=>w.x+w.width))+n,minY:Math.min(...o.map(w=>w.y))+r,maxY:Math.max(...o.map(w=>w.y+w.height))+r,centerX:0,centerY:0};l.centerX=(l.minX+l.maxX)/2,l.centerY=(l.minY+l.maxY)/2;const s=t.filter(w=>!i.includes(w.id)&&w.layerId===o[0].layerId).map(w=>({...w,minX:w.x,maxX:w.x+w.width,minY:w.y,maxY:w.y+w.height,centerX:w.x+w.width/2,centerY:w.y+w.height/2}));if(s.length<2)return{dx:n,dy:r,guides:[]};let a=0,c=0,h=e+1,d=e+1;const u=[],f=(w,v)=>Math.max(0,Math.min(w.maxY,v.maxY)-Math.max(w.minY,v.minY))>0;for(let w=0;w<s.length;w++){const v=s[w];if(f(l,v))for(let x=w+1;x<s.length;x++){const k=s[x];if(!f(l,k)||!f(v,k))continue;const S=[{id:"active",...l},v,k];S.sort((F,U)=>F.minX-U.minX);const[M,C,R]=S,E=C.minX-M.maxX,O=R.minX-C.maxX;let z=0;M.id==="active"?z=C.minX-O-M.maxX:C.id==="active"?z=(M.maxX+R.minX)/2-C.centerX:R.id==="active"&&(z=C.maxX+E-R.minX),Math.abs(z)<h&&(h=Math.abs(z),a=z),u.push({type:"gap",orientation:"horizontal",gap:(E+O)/2,start:M.maxX,variableCoordinate:(M.centerY+C.centerY+R.centerY)/3,elements:[M.id,C.id,R.id],segments:[{from:M.maxX,to:C.minX},{from:C.maxX,to:R.minX}],_correction:z})}}const g=(w,v)=>Math.max(0,Math.min(w.maxX,v.maxX)-Math.max(w.minX,v.minX))>0;for(let w=0;w<s.length;w++){const v=s[w];if(g(l,v))for(let x=w+1;x<s.length;x++){const k=s[x];if(!g(l,k)||!g(v,k))continue;const S=[{id:"active",...l},v,k];S.sort((F,U)=>F.minY-U.minY);const[M,C,R]=S,E=C.minY-M.maxY,O=R.minY-C.maxY;let z=0;M.id==="active"?z=C.minY-O-M.maxY:C.id==="active"?z=(M.maxY+R.minY)/2-C.centerY:R.id==="active"&&(z=C.maxY+E-R.minY),Math.abs(z)<d&&(d=Math.abs(z),c=z),u.push({type:"gap",orientation:"vertical",gap:(E+O)/2,start:M.maxY,variableCoordinate:(M.centerX+C.centerX+R.centerX)/3,elements:[M.id,C.id,R.id],segments:[{from:M.maxY,to:C.minY},{from:C.maxY,to:R.minY}],_correction:z})}}const p=h<=e?a:0,m=d<=e?c:0,y=u.filter(w=>w.orientation==="horizontal"?p!==0&&Math.abs(w._correction-p)<.1:m!==0&&Math.abs(w._correction-m)<.1);return y.forEach(w=>delete w._correction),{dx:n+p,dy:r+m,guides:y}};function Rd(i,t){const n=t.filter(s=>s.groupIds&&s.groupIds.includes(i));if(n.length===0)return null;let r=1/0,e=1/0,o=-1/0,l=-1/0;return n.forEach(s=>{const a=s.x,c=s.y,h=s.x+s.width,d=s.y+s.height;r=Math.min(r,a),e=Math.min(e,c),o=Math.max(o,h),l=Math.max(l,d)}),{x:r,y:e,width:o-r,height:l-e}}function Ed(i,t,n,r){const e=Rd(n,r);return e?i>=e.x&&i<=e.x+e.width&&t>=e.y&&t<=e.y+e.height:!1}function Nd(i,t){const n=new Map;return i.forEach((r,e)=>{if(r.groupIds&&r.groupIds.length>0){const o=r.groupIds[r.groupIds.length-1];if(!n.has(o)){const l=t.find(s=>s.id===r.layerId);n.set(o,{layerOrder:l?.order??999,elementIndex:e})}}}),Array.from(n.entries()).map(([r,{layerOrder:e,elementIndex:o}])=>({groupId:r,layerOrder:e,elementIndex:o})).sort((r,e)=>r.layerOrder!==e.layerOrder?e.layerOrder-r.layerOrder:e.elementIndex-r.elementIndex)}function Od(i,t){i.initialPositions.clear(),b.elements.forEach(n=>{t.has(n.id)&&i.initialPositions.set(n.id,{x:n.x,y:n.y,width:n.width,height:n.height,fontSize:n.fontSize,points:n.points?[...n.points]:void 0,controlPoints:n.controlPoints?n.controlPoints.map(r=>({...r})):void 0})})}function Gr(i,t,n){Q(),i.isDragging=!0,i.draggingHandle=null,i.startX=t,i.startY=n,i.initialPositions.clear();const r=new Set(b.selection);b.selection.forEach(e=>{Ea(e,b.elements).forEach(o=>r.add(o.id))}),Od(i,r)}function Bd(i,t,n,r,e,o){const l=Cr(t,n,b.elements,b.selection,b.viewState.scale);if(l){if(l.handle==="mindmap-toggle"){Sr(l.id);return}if(l.handle.startsWith("connector-")){Q(),vd(l,r);return}if(Q(),r.isDragging=!0,r.draggingHandle=l.handle,r.startX=t,r.startY=n,l.id==="multi"){const p=Yn(b.elements,b.selection);if(p){r.initialElementX=p.x,r.initialElementY=p.y,r.initialElementWidth=p.width,r.initialElementHeight=p.height,r.initialPositions.clear();const m=new Set(b.selection);b.selection.forEach(y=>{Ea(y,b.elements).forEach(w=>m.add(w.id))}),b.elements.forEach(y=>{m.has(y.id)&&r.initialPositions.set(y.id,{x:y.x,y:y.y,width:y.width,height:y.height,fontSize:y.fontSize,points:y.points?[...y.points]:void 0})})}}else{const p=b.elements.find(m=>m.id===l.id);p&&(r.initialElementX=p.x,r.initialElementY=p.y,r.initialElementWidth=p.width,r.initialElementHeight=p.height,r.initialElementFontSize=p.fontSize||28,r.initialPositions.clear(),r.initialPositions.set(p.id,{x:p.x,y:p.y,width:p.width,height:p.height,fontSize:p.fontSize,points:p.points?[...p.points]:void 0}))}return}let s=null;const a=10/b.viewState.scale,c=Nd(b.elements,b.layers);for(const{groupId:p}of c){const m=b.elements.filter(w=>w.groupIds&&w.groupIds.includes(p));if(m.some(w=>e.canInteractWithElement(w)&&Vt(w.layerId))&&Ed(t,n,p,b.elements)){const w=m.map(x=>x.id),v=w.every(x=>b.selection.includes(x));i.shiftKey||i.ctrlKey||i.metaKey?v?P("selection",x=>x.filter(k=>!w.includes(k))):P("selection",x=>[...new Set([...x,...w])]):v||P("selection",w),b.selection.length>0&&Gr(r,t,n);return}}const h=new Map;for(const p of b.elements)h.set(p.id,p);const d=b.elements.map((p,m)=>{const y=b.layers.find(w=>w.id===p.layerId);return{el:p,index:m,layerOrder:y?.order??999,layerVisible:Vt(p.layerId)}}).sort((p,m)=>p.layerOrder!==m.layerOrder?m.layerOrder-p.layerOrder:m.index-p.index),u=window.yappyGlobalTime||0,f=b.appMode==="presentation"||b.isPreviewing,g=Mr(b.elements,u,f);for(const{el:p,layerVisible:m}of d){if(!m||!e.canInteractWithElement(p))continue;const y=g.get(p.id),w=e.applyMasterProjection(y?{...p,x:y.x,y:y.y,angle:y.angle}:p);if(en(w,t,n,a,b.elements,h)){s=p.id;break}}if(s){const p=b.elements.find(w=>w.id===s);let m=[s];if(p&&p.groupIds&&p.groupIds.length>0){const w=p.groupIds[p.groupIds.length-1];m=b.elements.filter(v=>v.groupIds&&v.groupIds.includes(w)).map(v=>v.id)}const y=m.every(w=>b.selection.includes(w));i.shiftKey||i.ctrlKey||i.metaKey?y?P("selection",w=>w.filter(v=>!m.includes(v))):P("selection",w=>[...new Set([...w,...m])]):y||P("selection",m),b.selection.length>0&&Gr(r,t,n)}else{if(b.selection.length>0){const p=Yn(b.elements,b.selection);if(p){const m=10/b.viewState.scale;if(t>=p.x-m&&t<=p.x+p.width+m&&n>=p.y-m&&n<=p.y+p.height+m){Q(),r.isDragging=!0,r.draggingHandle=null,r.startX=t,r.startY=n,r.initialPositions.clear(),b.elements.forEach(y=>{b.selection.includes(y.id)&&r.initialPositions.set(y.id,{x:y.x,y:y.y,width:y.width,height:y.height,fontSize:y.fontSize,points:y.points?[...y.points]:void 0,controlPoints:y.controlPoints?y.controlPoints.map(w=>({...w})):void 0})});return}}}!i.shiftKey&&!i.ctrlKey&&!i.metaKey&&(P("selection",[]),fa(!1)),r.isSelecting=!0,r.startX=t,r.startY=n,o.setSelectionBox({x:t,y:n,w:0,h:0})}}function Dd(i,t,n,r,e,o,l){if(!r.isDragging){const s=Cr(t,n,b.elements,b.selection,b.viewState.scale),a=r.hoveredConnector;s?s.handle==="rotate"?e.setCursor("grab"):s.handle==="tl"||s.handle==="br"?e.setCursor("nwse-resize"):s.handle==="tr"||s.handle==="bl"?e.setCursor("nesw-resize"):s.handle==="tm"||s.handle==="bm"?e.setCursor("ns-resize"):s.handle==="lm"||s.handle==="rm"?e.setCursor("ew-resize"):s.handle.startsWith("connector-")?(e.setCursor("crosshair"),r.hoveredConnector={elementId:s.id,handle:s.handle}):r.hoveredConnector=null:(e.setCursor("default"),r.hoveredConnector=null),(a&&!r.hoveredConnector||!a&&r.hoveredConnector||a&&r.hoveredConnector&&(a.elementId!==r.hoveredConnector.elementId||a.handle!==r.hoveredConnector.handle))&&requestAnimationFrame(e.draw)}if(r.isSelecting){const s=t-r.startX,a=n-r.startY;o.setSelectionBox({x:s>0?r.startX:r.startX+s,y:a>0?r.startY:r.startY+a,w:Math.abs(s),h:Math.abs(a)});return}if(r.isDragging&&b.selection.length>0){const s=b.selection[0],a=b.elements.find(c=>c.id===s);if(!a||r.draggingHandle&&!e.canInteractWithElement(a))return;r.draggingHandle?zd(i,t,n,s,a,r,e,o):Ud(i,t,n,r,e,o,l)}}function zd(i,t,n,r,e,o,l,s){if((e.type==="line"||e.type==="arrow"||e.type==="organicBranch")&&(o.draggingHandle==="tl"||o.draggingHandle==="br")){const v=l.checkBinding(t,n,e.id);v?(s.setSuggestedBinding({elementId:v.element.id,px:v.snapPoint.x,py:v.snapPoint.y,position:v.position}),t=v.snapPoint.x,n=v.snapPoint.y):s.setSuggestedBinding(null)}else s.setSuggestedBinding(null);if(o.draggingHandle==="rotate"){const v=e.x+e.width/2,x=e.y+e.height/2,k=Math.atan2(n-x,t-v);D(r,{angle:k+Math.PI/2});return}let a=t,c=n;if(b.gridSettings.snapToGrid){const v=Pr(t,n,b.gridSettings.gridSize);a=v.x,c=v.y}const h=a-o.startX,d=c-o.startY;let u=o.initialElementX,f=o.initialElementY,g=o.initialElementWidth,p=o.initialElementHeight;o.draggingHandle==="tl"?(u+=h,f+=d,g-=h,p-=d):o.draggingHandle==="tr"?(f+=d,g+=h,p-=d):o.draggingHandle==="bl"?(u+=h,g-=h,p+=d):o.draggingHandle==="br"?(g+=h,p+=d):o.draggingHandle==="tm"?(f+=d,p-=d):o.draggingHandle==="bm"?p+=d:o.draggingHandle==="lm"?(u+=h,g-=h):o.draggingHandle==="rm"&&(g+=h);const m=b.selection.length>1,y=b.elements.find(v=>v.id===b.selection[0]);let w=i.shiftKey||b.selection.length===1&&y?.constrained;if(b.selection.length===1&&y?.type==="text"&&(w=!i.shiftKey),w&&o.initialElementWidth!==0&&o.initialElementHeight!==0){const v=o.initialElementWidth/o.initialElementHeight;["tm","bm"].includes(o.draggingHandle)?(g=p*v,o.draggingHandle,u=o.initialElementX+o.initialElementWidth/2-g/2):["lm","rm"].includes(o.draggingHandle)?(p=g/v,f=o.initialElementY+o.initialElementHeight/2-p/2):(Math.abs(g)/v>Math.abs(p)?p=g/v:g=p*v,o.draggingHandle==="tl"?(u=o.initialElementX+o.initialElementWidth-g,f=o.initialElementY+o.initialElementHeight-p):o.draggingHandle==="tr"?f=o.initialElementY+o.initialElementHeight-p:o.draggingHandle==="bl"&&(u=o.initialElementX+o.initialElementWidth-g))}o.draggingHandle&&o.draggingHandle.startsWith("control-")?Fd(t,n,r,o):jd(r,e,m,u,f,g,p,o,l)}function Fd(i,t,n,r,e){const o=parseInt(r.draggingHandle.replace("control-",""),10),l=b.elements.find(a=>a.id===n);if(l){let a=l.controlPoints?[...l.controlPoints]:[];for(;a.length<=o;)a.push({x:i,y:t});if(l.controlPoints&&l.controlPoints.length===1&&o===0){let c={x:l.x,y:l.y},h={x:l.x+l.width,y:l.y+l.height};if(l.points&&l.points.length>=2){const f=ft(l.points);f.length>0&&(c={x:l.x+f[0].x,y:l.y+f[0].y},h={x:l.x+f[f.length-1].x,y:l.y+f[f.length-1].y})}const d=2*i-.5*c.x-.5*h.x,u=2*t-.5*c.y-.5*h.y;a[0]={x:d,y:u}}else a[o]={x:i,y:t};D(l.id,{controlPoints:a})}const s=b.elements.find(a=>a.id===n);if(s){if(s.type==="isometricCube"&&r.draggingHandle==="control-1"){let a=(t-s.y)/s.height;a=Math.max(.1,Math.min(.9,a));const c=Math.round(a*100);let h=(i-s.x)/s.width;h=Math.max(0,Math.min(1,h));const d=Math.round(h*100);D(s.id,{shapeRatio:c,sideRatio:d},!1)}else if((s.type==="solidBlock"||s.type==="cylinder")&&r.draggingHandle==="control-1"){const a=s.x+s.width/2,c=s.y+s.height/2,h=i-a,d=t-c;let u=Math.sqrt(h*h+d*d);u=Math.round(u);let f=Math.atan2(d,h),g=Math.round(f*180/Math.PI);g<0&&(g+=360),D(s.id,{depth:u,viewAngle:g},!1)}else if(s.type==="perspectiveBlock")Wd(i,t,s,r);else if((s.type==="star"||s.type==="burst")&&r.draggingHandle==="control-1"){let a=(t-s.y)/s.height;a=Math.max(.1,Math.min(.9,a));const c=Math.round(a*100);D(s.id,{shapeRatio:c},!1)}else if(s.type==="speechBubble"&&r.draggingHandle==="control-1"){let a=(i-s.x)/s.width,c=(t-s.y)/s.height;a=Math.max(-.5,Math.min(1.5,a)),c=Math.max(-.5,Math.min(1.5,c)),D(s.id,{tailX:a,tailY:c},!1)}}}function Wd(i,t,n,r){if(r.draggingHandle==="control-1"){const e=n.x+n.width/2,o=n.y+n.height/2,l=i-e-(n.skewX||0)*n.width,s=t-o-(n.skewY||0)*n.height;let a=Math.sqrt(l*l+s*s),c=Math.atan2(s,l),h=Math.round(c*180/Math.PI);h<0&&(h+=360),D(n.id,{depth:Math.round(a),viewAngle:h},!1)}else if(r.draggingHandle==="control-2"||r.draggingHandle==="control-3"||r.draggingHandle==="control-4"||r.draggingHandle==="control-5"){const e=n.width/2,o=n.height/2,l=n.x+e,s=n.y+o,a=(n.viewAngle||45)*Math.PI/180,c=n.depth||50,h=l+c*Math.cos(a),d=s+c*Math.sin(a),u=i-h,f=t-d,g=r.draggingHandle==="control-3"||r.draggingHandle==="control-4"?1:-1,p=r.draggingHandle==="control-4"||r.draggingHandle==="control-5"?1:-1,m=Math.sqrt(u*u+f*f),y=Math.sqrt(e*e+o*o),w=Math.max(0,Math.min(1,1-m/y)),v=(u-g*e*(1-w))/n.width,x=(f-p*o*(1-w))/n.height;D(n.id,{taper:w,skewX:v,skewY:x},!1)}else if(r.draggingHandle==="control-6"||r.draggingHandle==="control-7"||r.draggingHandle==="control-8"||r.draggingHandle==="control-9"){const e=n.width/2,o=n.height/2,l=n.x+e,s=n.y+o,a=i-l,c=t-s,h=r.draggingHandle==="control-7"||r.draggingHandle==="control-8"?1:-1,d=r.draggingHandle==="control-8"||r.draggingHandle==="control-9"?1:-1,u=Math.sqrt(a*a+c*c),f=Math.sqrt(e*e+o*o),g=Math.max(0,Math.min(1,1-u/f)),p=(a-h*e*(1-g))/n.width,m=(c-d*o*(1-g))/n.height;D(n.id,{frontTaper:g,frontSkewX:p,frontSkewY:m},!1)}}function jd(i,t,n,r,e,o,l,s,a){if(n){const c=s.initialElementWidth===0?1:o/s.initialElementWidth,h=s.initialElementHeight===0?1:l/s.initialElementHeight;b.selection.forEach(d=>{const u=s.initialPositions.get(d);if(!u)return;const f=u.x-s.initialElementX,g=u.y-s.initialElementY,p={x:r+f*c,y:e+g*h,width:u.width*c,height:u.height*h};if(u.points)if(typeof u.points[0]=="number"){const y=u.points,w=[];for(let v=0;v<y.length;v+=2)w.push(y[v]*c,y[v+1]*h);p.points=w}else p.points=u.points.map(y=>({x:y.x*c,y:y.y*h}));const m=b.elements.find(y=>y.id===d);m&&m.type==="text"&&(p.fontSize=Math.max(8,(u.fontSize||28)*h)),D(d,p,!1)})}else{const c=b.elements.find(h=>h.id===i);if(c){const h={x:r,y:e,width:o,height:l},d=s.initialElementWidth===0?1:o/s.initialElementWidth,u=s.initialElementHeight===0?1:l/s.initialElementHeight;if(c.type==="text"&&u>0){let f=s.initialElementFontSize*u;f=Math.max(f,8),h.fontSize=f}if((c.type==="fineliner"||c.type==="inkbrush"||c.type==="marker")&&c.points){const f=s.initialPositions.get(i);if(f&&f.points)if(c.pointsEncoding==="flat"||f.points.length>0&&typeof f.points[0]=="number"){const g=f.points,p=[];for(let m=0;m<g.length;m+=2)p.push(g[m]*d,g[m+1]*u);h.points=p}else h.points=f.points.map(g=>({x:g.x*d,y:g.y*u,...g.p!==void 0?{p:g.p}:{}}))}if((c.type==="line"||c.type==="arrow"||c.type==="bezier")&&(h.points=a.refreshLinePoints(c,r,e,r+o,e+l)),c.type==="organicBranch"){h.points=[0,0,o,l];const f=r,g=e,p=r+o,m=e+l,y={x:f+o*.5,y:g},w={x:p-o*.5,y:m};h.controlPoints=[y,w]}D(i,h,!1)}}}function Ud(i,t,n,r,e,o,l){let s=t-r.startX,a=n-r.startY;if(b.gridSettings.objectSnapping&&!i.shiftKey){const h=performance.now();if(h-r.lastSnappingTime>=l){const d=Id(b.selection,b.elements,s,a,5/b.viewState.scale);s=d.dx,a=d.dy,o.setSnappingGuides(d.guides);const u=$d(b.selection,b.elements,s,a,5/b.viewState.scale);s=u.dx,a=u.dy,o.setSpacingGuides(u.guides),r.lastSnappingTime=h}}else o.setSnappingGuides([]),o.setSpacingGuides([]);if(b.gridSettings.snapToGrid&&!i.shiftKey&&o.snappingGuides().length===0){const h=b.gridSettings.gridSize;s=Math.round(s/h)*h,a=Math.round(a/h)*h}const c=i.altKey;r.initialPositions.forEach((h,d)=>{if(c&&!b.selection.includes(d))return;const u=b.elements.find(f=>f.id===d);if(u&&e.canInteractWithElement(u)){const f={x:h.x+s,y:h.y+a};h.controlPoints&&(f.controlPoints=h.controlPoints.map(g=>({x:g.x+s,y:g.y+a}))),D(d,f,!1),u.boundElements&&u.boundElements.forEach(g=>e.refreshBoundLine(g.id))}})}function qd(i,t,n,r){if(t.isSelecting){const e=r.selectionBox();if(e){const o=[],l=e.x,s=e.y,a=e.w,c=e.h;if(b.elements.forEach(h=>{const d=h.x,u=h.y,f=h.width,g=h.height,p=Math.min(d,d+f),m=Math.max(d,d+f),y=Math.min(u,u+g),w=Math.max(u,u+g);l<m&&l+a>p&&s<w&&s+c>y&&o.push(h.id)}),i.shiftKey||i.ctrlKey||i.metaKey){const h=new Set(b.selection);o.forEach(d=>h.add(d)),P("selection",Array.from(h))}else P("selection",o)}t.isSelecting=!1,r.setSelectionBox(null)}if(t.isDragging){const e=r.suggestedBinding();if(e&&b.selection.length===1&&t.draggingHandle){const o=b.selection[0],l=b.elements.find(s=>s.id===o);if(l&&(l.type==="line"||l.type==="arrow"||l.type==="organicBranch")){const s=t.draggingHandle==="tl",a={elementId:e.elementId,focus:0,gap:5,position:e.position};D(o,s?{startBinding:a}:{endBinding:a});const c=b.elements.find(h=>h.id===e.elementId);if(c){const h=c.boundElements||[];h.find(d=>d.id===o)||D(c.id,{boundElements:[...h,{id:o,type:l.type}]})}}}r.setSuggestedBinding(null)}t.isDragging=!1,t.draggingHandle=null,t.initialPositions.clear(),r.setSnappingGuides([])}function Xn(i){const t=i.x+i.width/2,n=i.y+i.height/2,r=i.width,e=i.height;let o=[];if(i.type==="rectangle"||i.type==="image"||i.type==="text"){const l=[{x:t-r/2,y:n-e/2,position:"top-left"},{x:t+r/2,y:n-e/2,position:"top-right"},{x:t-r/2,y:n+e/2,position:"bottom-left"},{x:t+r/2,y:n+e/2,position:"bottom-right"},{x:t,y:n-e/2,position:"top"},{x:t+r/2,y:n,position:"right"},{x:t,y:n+e/2,position:"bottom"},{x:t-r/2,y:n,position:"left"}];i.angle?o=l.map(s=>({...Pt(s.x,s.y,t,n,i.angle),position:s.position})):o=l}else if(i.type==="circle"){const l=r/2,s=e/2,a=[{x:t,y:n-s,position:"top"},{x:t+l,y:n,position:"right"},{x:t,y:n+s,position:"bottom"},{x:t-l,y:n,position:"left"}];i.angle?o=a.map(c=>({...Pt(c.x,c.y,t,n,i.angle),position:c.position})):o=a}else if(i.type==="diamond"){const l=[{x:t,y:n-e/2,position:"top"},{x:t+r/2,y:n,position:"right"},{x:t,y:n+e/2,position:"bottom"},{x:t-r/2,y:n,position:"left"}];i.angle?o=l.map(s=>({...Pt(s.x,s.y,t,n,i.angle),position:s.position})):o=l}else if(i.type==="triangle"||i.type==="hexagon"||i.type==="octagon"||i.type==="parallelogram"||i.type==="star"){const l=[{x:t,y:n-e/2,position:"top"},{x:t+r/2,y:n,position:"right"},{x:t,y:n+e/2,position:"bottom"},{x:t-r/2,y:n,position:"left"}];i.angle?o=l.map(s=>({...Pt(s.x,s.y,t,n,i.angle),position:s.position})):o=l}else if(i.type==="cloud"||i.type==="heart"||i.type==="checkmark"||i.type==="cross"||i.type==="arrowLeft"||i.type==="arrowRight"||i.type==="arrowUp"||i.type==="arrowDown"||i.type==="capsule"||i.type==="stickyNote"||i.type==="callout"||i.type==="burst"||i.type==="speechBubble"||i.type==="ribbon"||i.type==="server"||i.type==="loadBalancer"||i.type==="firewall"||i.type==="user"||i.type==="messageQueue"||i.type==="lambda"||i.type==="router"||i.type==="browser"||i.type==="trapezoid"||i.type==="rightTriangle"||i.type==="pentagon"||i.type==="septagon"||i.type==="starPerson"||i.type==="scroll"||i.type==="wavyDivider"||i.type==="doubleBanner"||i.type==="lightbulb"||i.type==="signpost"||i.type==="burstBlob"||i.type==="browserWindow"||i.type==="mobilePhone"||i.type==="ghostButton"||i.type==="inputField"||i.type==="bracketLeft"||i.type==="bracketRight"||i.type==="database"||i.type==="document"||i.type==="predefinedProcess"||i.type==="internalStorage"){const l=[{x:t,y:n-e/2,position:"top"},{x:t+r/2,y:n,position:"right"},{x:t,y:n+e/2,position:"bottom"},{x:t-r/2,y:n,position:"left"}];i.angle?o=l.map(s=>({...Pt(s.x,s.y,t,n,i.angle),position:s.position})):o=l}else{const l=[{x:t,y:n-e/2,position:"top"},{x:t+r/2,y:n,position:"right"},{x:t,y:n+e/2,position:"bottom"},{x:t-r/2,y:n,position:"left"}];i.angle?o=l.map(s=>({...Pt(s.x,s.y,t,n,i.angle),position:s.position})):o=l}return o}function Hd(i,t,n=15){const r=Xn(i);let e=null,o=n;for(const l of r){const s=l.x-t.x,a=l.y-t.y,c=Math.sqrt(s*s+a*a);c<o&&(o=c,e=l)}return e}const vi=(i,t,n,r)=>{const e=[{x:i.x,y:i.y}],o=20;if(!n&&!r){const d=(i.x+t.x)/2;return e.push({x:d,y:i.y}),e.push({x:d,y:t.y}),e.push({x:t.x,y:t.y}),Oi(e)}const l=(d,u)=>u==="top"?{x:d.x,y:d.y-o}:u==="bottom"?{x:d.x,y:d.y+o}:u==="left"?{x:d.x-o,y:d.y}:u==="right"?{x:d.x+o,y:d.y}:d;let s=i;n&&(s=l(i,n),e.push(s));let a=t;r&&(a=l(t,r));const c=d=>d==="top"||d==="bottom",h=d=>d==="left"||d==="right";return c(r)?e.push({x:a.x,y:s.y}):h(r)?e.push({x:s.x,y:a.y}):c(n)?e.push({x:t.x,y:s.y}):h(n)?e.push({x:s.x,y:t.y}):Math.abs(t.y-i.y)>Math.abs(t.x-i.x)?e.push({x:s.x,y:t.y}):e.push({x:t.x,y:s.y}),r&&e.push(a),e.push({x:t.x,y:t.y}),Oi(e)},Oi=i=>{if(i.length<2)return i;const t=[i[0]];for(let n=1;n<i.length;n++){const r=t[t.length-1],e=i[n];if(!(Math.abs(r.x-e.x)<.1&&Math.abs(r.y-e.y)<.1)){if(t.length>=2){const o=t[t.length-2];if(Math.abs(o.x-r.x)<.1&&Math.abs(r.x-e.x)<.1||Math.abs(o.y-r.y)<.1&&Math.abs(r.y-e.y)<.1){t[t.length-1]=e;continue}}t.push(e)}}return t},Yd=(i,t,n,r,e,o,l)=>{const c=n.filter(C=>{if(C.type==="line"||C.type==="arrow"||C.type==="text")return!1;const R=Math.min(i.x,t.x)-100,E=Math.max(i.x,t.x)+100,O=Math.min(i.y,t.y)-100,z=Math.max(i.y,t.y)+100;return!(C.x>E||C.x+C.width<R||C.y>z||C.y+C.height<O)});if(c.length===0)return vi(i,t,o,l);const h=new Set([i.x,t.x]),d=new Set([i.y,t.y]);c.forEach(C=>{const R=C.x-15,E=C.x+C.width+15,O=C.y-15,z=C.y+C.height+15;h.add(R),h.add(E),d.add(O),d.add(z),h.add(C.x+C.width/2),d.add(C.y+C.height/2)});const u=(C,R)=>{R&&(R==="top"&&(h.add(C.x),d.add(C.y-20)),R==="bottom"&&(h.add(C.x),d.add(C.y+20)),R==="left"&&(h.add(C.x-20),d.add(C.y)),R==="right"&&(h.add(C.x+20),d.add(C.y)))};u(i,o),u(t,l);const f=Array.from(h).sort((C,R)=>C-R),g=Array.from(d).sort((C,R)=>C-R),p=f.findIndex(C=>Math.abs(C-i.x)<.1),m=g.findIndex(C=>Math.abs(C-i.y)<.1),y=f.findIndex(C=>Math.abs(C-t.x)<.1),w=g.findIndex(C=>Math.abs(C-t.y)<.1);if(p===-1||m===-1||y===-1||w===-1)return vi(i,t,o,l);const v=[{gx:p,gy:m,g:0,h:Math.abs(i.x-t.x)+Math.abs(i.y-t.y),parent:null,dir:null}],x=new Set,k=(C,R,E)=>c.some(O=>O.id===E?!1:C>O.x+1&&C<O.x+O.width-1&&R>O.y+1&&R<O.y+O.height-1),S=(C,R,E,O)=>{const z=(C+E)/2,F=(R+O)/2;return c.some(U=>{const rt=U.id===r?.id||U.id===e?.id?3:1;return z>U.x+rt&&z<U.x+U.width-rt&&F>U.y+rt&&F<U.y+U.height-rt})};let M=0;for(;v.length>0&&M<800;){M++,v.sort((E,O)=>E.g+E.h-(O.g+O.h));const C=v.shift();if(C.gx===y&&C.gy===w){const E=[];let O=C;for(;O;)E.push({x:f[O.gx],y:g[O.gy]}),O=O.parent;return Oi(E.reverse())}x.add(`${C.gx},${C.gy}`);const R=[{dx:-1,dy:0,dir:"h",name:"left"},{dx:1,dy:0,dir:"h",name:"right"},{dx:0,dy:-1,dir:"v",name:"top"},{dx:0,dy:1,dir:"v",name:"bottom"}];for(const E of R){const O=C.gx+E.dx,z=C.gy+E.dy;if(O<0||O>=f.length||z<0||z>=g.length||x.has(`${O},${z}`))continue;const F=ut=>["top","bottom","left","right"].includes(ut||"");if(C.gx===p&&C.gy===m&&F(o)&&E.name!==o)continue;if(O===y&&z===w&&F(l)){const ut={top:"bottom",bottom:"top",left:"right",right:"left"}[l];if(E.name!==ut)continue}const U=f[C.gx],J=g[C.gy],rt=f[O],X=g[z];if(S(U,J,rt,X))continue;const W=Math.abs(rt-U)+Math.abs(X-J),Y=C.dir&&C.dir!==E.dir?100:0,lt=k(rt,X)?500:0,gt=C.g+W+Y+lt,yt=v.find(ut=>ut.gx===O&&ut.gy===z);yt?gt<yt.g&&(yt.g=gt,yt.parent=C,yt.dir=E.dir):v.push({gx:O,gy:z,g:gt,h:Math.abs(rt-t.x)+Math.abs(X-t.y),parent:C,dir:E.dir})}}return vi(i,t,o,l)};function Xd(i,t,n,r,e,o,l){const s=40/e,a=25/e;let c=null;for(const h of r){if(h.id===n||!l(h)||h.type==="line"||h.type==="arrow"||h.type==="bezier"||h.type==="organicBranch"||h.layerId!==o)continue;let d=!1;if(h.type==="text"||h.type==="image"||h.type==="rectangle")i>=h.x-s&&i<=h.x+h.width+s&&t>=h.y-s&&t<=h.y+h.height+s&&(d=!0);else if(h.type==="circle"){const u=h.x+h.width/2,f=h.y+h.height/2,g=h.width/2+s,p=h.height/2+s;(i-u)**2/g**2+(t-f)**2/p**2<=1&&(d=!0)}else i>=h.x-s&&i<=h.x+h.width+s&&t>=h.y-s&&t<=h.y+h.height+s&&(d=!0);if(d){c=h;break}}if(c){const h=Hd(c,{x:i,y:t},a);if(h)return{element:c,snapPoint:{x:h.x,y:h.y},position:h.position};const d=Ni(c,{x:i,y:t},5);if(d)return{element:c,snapPoint:d,position:"edge"}}return null}function Na(i,t,n,r,e,o){const l=n??i.x,s=r??i.y,a=e??i.x+i.width,c=o??i.y+i.height;if(i.curveType==="elbow"){const h=t.find(f=>f.id===i.startBinding?.elementId),d=t.find(f=>f.id===i.endBinding?.elementId);return Yd({x:l,y:s},{x:a,y:c},t,h,d,i.startBinding?.position,i.endBinding?.position).map(f=>({x:f.x-l,y:f.y-s}))}if(i.points&&i.points.length>=2)return[0,0,a-l,c-s]}function Oa(i,t,n){const r=t(),e=r.find(u=>u.id===i);if(!e||e.type!=="line"&&e.type!=="arrow"&&e.type!=="organicBranch"&&e.type!=="bezier")return;let o=e.x,l=e.y,s=e.x+e.width,a=e.y+e.height,c=!1;const h=e.startBinding?r.find(u=>u.id===e.startBinding?.elementId):null,d=e.endBinding?r.find(u=>u.id===e.endBinding?.elementId):null;if(h&&d){const u=h.x+h.width/2,f=h.y+h.height/2,g=d.x+d.width/2,p=d.y+d.height/2,m=g-u,y=p-f,w=e.startBinding?.position,v=e.endBinding?.position;let x,k;if(Math.abs(m)>Math.abs(y)?(x=m>0?"right":"left",k=m>0?"left":"right"):(x=y>0?"bottom":"top",k=y>0?"top":"bottom"),w!==x||v!==k)return n(e.id,{startBinding:{...e.startBinding,position:x},endBinding:{...e.endBinding,position:k}},!1),Oa(i,t,n)}if(e.startBinding){const u=h||r.find(f=>f.id===e.startBinding.elementId);if(u){const f=e.startBinding.position;let g;if(f&&f!=="edge"){const m=Xn(u).find(y=>y.position===f);m&&(g={x:m.x,y:m.y})}g||(g=Ni(u,{x:s,y:a},e.startBinding.gap)),g&&(o=g.x,l=g.y,c=!0)}}if(e.endBinding){const u=d||r.find(f=>f.id===e.endBinding.elementId);if(u){const f=e.endBinding.position;let g;if(f&&f!=="edge"){const m=Xn(u).find(y=>y.position===f);m&&(g={x:m.x,y:m.y})}g||(g=Ni(u,{x:o,y:l},e.endBinding.gap)),g&&(s=g.x,a=g.y,c=!0)}}if(c){const u=Na(e,r,o,l,s,a);if(o!==e.x||l!==e.y||s-o!==e.width||a-l!==e.height||JSON.stringify(u)!==JSON.stringify(e.points)){const f={x:o,y:l,width:s-o,height:a-l,points:u};if(e.controlPoints&&e.controlPoints.length===2){const p=o-e.x,m=l-e.y,y=s-(e.x+e.width),w=a-(e.y+e.height),v={x:e.controlPoints[0].x+p,y:e.controlPoints[0].y+m},x={x:e.controlPoints[1].x+y,y:e.controlPoints[1].y+w};f.controlPoints=[v,x]}n(e.id,f,!1)}}}function Gd(i,t,n,r){const{scale:e,isSelected:o,selectionLength:l,isDarkMode:s,elements:a,selectedTool:c,hoveredConnector:h}=r,d=2/e;if(o){const u=n.x,f=n.y,g=n.width,p=n.height,m=n.angle,y=u+g/2,w=f+p/2;if(i.save(),m&&(i.translate(y,w),i.rotate(m),i.translate(-y,-w)),i.strokeStyle="#3b82f6",i.lineWidth=1/e,t.type!=="line"&&t.type!=="arrow"&&t.type!=="bezier"&&t.type!=="organicBranch")i.strokeRect(u-d,f-d,g+d*2,p+d*2);else if(t.type==="organicBranch"&&t.points&&t.points.length>=2&&t.controlPoints&&t.controlPoints.length>=2){const x=ft(t.points);if(x.length>=2){const k={x:t.x+x[0].x,y:t.y+x[0].y},S={x:t.x+x[x.length-1].x,y:t.y+x[x.length-1].y},M=Ra(k,S,t.controlPoints[0],t.controlPoints[1],t.strokeWidth);i.save(),i.strokeStyle="#3b82f6",i.lineWidth=2/e,i.beginPath(),i.moveTo(M[0].x,M[0].y);for(let C=1;C<M.length;C++)i.lineTo(M[C].x,M[C].y);i.closePath(),i.stroke(),i.restore()}}if(l===1){const x=8/e;if(i.fillStyle="#ffffff",i.strokeStyle="#3b82f6",i.lineWidth=2/e,t.type==="line"||t.type==="arrow"||t.type==="bezier"||t.type==="organicBranch"){let k=u,S=f,M=u+g,C=f+p;if(t.type==="organicBranch"&&t.points&&t.points.length>=2){const E=ft(t.points);E.length>=2&&(k=t.x+E[0].x,S=t.y+E[0].y,M=t.x+E[E.length-1].x,C=t.y+E[E.length-1].y)}[{x:k,y:S},{x:M,y:C}].forEach(E=>{i.beginPath(),i.arc(E.x,E.y,x/1.5,0,Math.PI*2),i.fill(),i.stroke()})}else{[{x:u-d,y:f-d},{x:u+g+d,y:f-d},{x:u+g+d,y:f+p+d},{x:u-d,y:f+p+d},{x:u+g/2,y:f-d},{x:u+g+d,y:f+p/2},{x:u+g/2,y:f+p+d},{x:u-d,y:f+p/2}].forEach(M=>{i.fillRect(M.x-x/2,M.y-x/2,x,x),i.strokeRect(M.x-x/2,M.y-x/2,x,x)});const S={x:t.x+t.width/2,y:t.y-d-20/e};i.beginPath(),i.moveTo(t.x+t.width/2,t.y-d),i.lineTo(S.x,S.y),i.stroke(),i.beginPath(),i.arc(S.x,S.y,x/2,0,Math.PI*2),i.fill(),i.stroke()}}if(a.some(x=>x.parentId===t.id)&&t.type!=="line"&&t.type!=="arrow"){const x=14/e,k=t.x+t.width+15/e,S=t.y+t.height/2;i.beginPath(),i.arc(k,S,x/2,0,Math.PI*2),i.fillStyle=t.isCollapsed?"#10b981":s?"#333":"#fff",i.fill(),i.strokeStyle="#10b981",i.lineWidth=2/e,i.stroke(),i.beginPath(),i.strokeStyle=t.isCollapsed?"#fff":"#10b981",i.lineWidth=2/e,i.moveTo(k-x/4,S),i.lineTo(k+x/4,S),t.isCollapsed&&(i.moveTo(k,S-x/4),i.lineTo(k,S+x/4)),i.stroke()}i.restore()}if(t.isCollapsed&&!o){const u=t.x+t.width/2,f=t.y+t.height/2;i.save(),t.angle&&(i.translate(u,f),i.rotate(t.angle),i.translate(-u,-f)),i.shadowBlur=10/e,i.shadowColor="#10b981",i.strokeStyle="#10b981",i.lineWidth=1/e;const g=1/e;i.strokeRect(t.x-g,t.y-g,t.width+g*2,t.height+g*2),i.restore()}if(o&&(t.type==="isometricCube"||t.type==="star"||t.type==="burst"||t.type==="solidBlock"||t.type==="perspectiveBlock"||t.type==="cylinder")){const u=10/e;let f=0,g=0;if(t.type==="isometricCube"){const p=(t.shapeRatio!==void 0?t.shapeRatio:25)/100,m=(t.sideRatio!==void 0?t.sideRatio:50)/100,y=t.height*p;g=t.y+y,f=t.x+t.width*m}else if(t.type==="solidBlock"||t.type==="cylinder"){const p=t.depth!==void 0?t.depth:50,m=(t.viewAngle!==void 0?t.viewAngle:45)*Math.PI/180,y=t.x+t.width/2,w=t.y+t.height/2;f=y+p*Math.cos(m),g=w+p*Math.sin(m)}else if(t.type==="perspectiveBlock"){const p=t.depth!==void 0?t.depth:50,m=(t.viewAngle!==void 0?t.viewAngle:45)*Math.PI/180,y=t.taper!==void 0?t.taper:0,w=(t.skewX!==void 0?t.skewX:0)*t.width,v=(t.skewY!==void 0?t.skewY:0)*t.height,x=t.x+t.width/2,k=t.y+t.height/2,S=p*Math.cos(m)+w,M=p*Math.sin(m)+v,C=1-y,R=t.width/2*C,E=t.height/2*C,O=1-(t.frontTaper||0),z=t.width/2*O,F=t.height/2*O,U=(t.frontSkewX||0)*t.width,J=(t.frontSkewY||0)*t.height,rt=[{x:x+S,y:k+M,type:"depth"},{x:x+S-R,y:k+M-E,type:"bTL"},{x:x+S+R,y:k+M-E,type:"bTR"},{x:x+S+R,y:k+M+E,type:"bBR"},{x:x+S-R,y:k+M+E,type:"bBL"},{x:x+U-z,y:k+J-F,type:"fTL"},{x:x+U+z,y:k+J-F,type:"fTR"},{x:x+U+z,y:k+J+F,type:"fBR"},{x:x+U-z,y:k+J+F,type:"fBL"}];i.strokeStyle="#ffffff",i.lineWidth=1.5/e;for(const X of rt)X.type==="depth"?i.fillStyle="#f59e0b":X.type.startsWith("b")?i.fillStyle="#3b82f6":i.fillStyle="#10b981",i.beginPath(),i.arc(X.x,X.y,u/2,0,Math.PI*2),i.fill(),i.stroke();return}else if(t.type==="star"||t.type==="burst"){const p=(t.shapeRatio!==void 0?t.shapeRatio:25)/100;f=t.x+t.width/2,g=t.y+t.height*p}i.fillStyle="#f59e0b",i.strokeStyle="#ffffff",i.lineWidth=1.5/e,i.beginPath(),i.arc(f,g,u/2,0,Math.PI*2),i.fill(),i.stroke()}if(o){if((t.type==="line"||t.type==="arrow"||t.type==="bezier"||t.type==="organicBranch")&&t.controlPoints&&c==="selection"){const u=10/e;if(t.controlPoints.length===1){const f=t.controlPoints[0];let g={x:t.x,y:t.y},p={x:t.x+t.width,y:t.y+t.height};if(t.points&&t.points.length>=2){const w=ft(t.points);w.length>0&&(g={x:t.x+w[0].x,y:t.y+w[0].y},p={x:t.x+w[w.length-1].x,y:t.y+w[w.length-1].y})}const m=.25*g.x+.5*f.x+.25*p.x,y=.25*g.y+.5*f.y+.25*p.y;i.fillStyle="#3b82f6",i.strokeStyle="#ffffff",i.lineWidth=1.5/e,i.beginPath(),i.arc(m,y,u/2,0,Math.PI*2),i.fill(),i.stroke()}else t.controlPoints.forEach(f=>{i.fillStyle="#3b82f6",i.strokeStyle="#ffffff",i.lineWidth=1.5/e,i.beginPath(),i.arc(f.x,f.y,u/2,0,Math.PI*2),i.fill(),i.stroke()})}if(t.type!=="line"&&t.type!=="arrow"&&c==="selection"){const u=14/e,f=32/e,g=t.x+t.width/2,p=t.y+t.height/2;[{pos:"top",x:g,y:t.y-f},{pos:"right",x:t.x+t.width+f,y:p},{pos:"bottom",x:g,y:t.y+t.height+f},{pos:"left",x:t.x-f,y:p}].forEach(y=>{const w=h&&h.elementId===t.id&&h.handle===`connector-${y.pos}`,v=w?u*1.3:u;i.strokeStyle=w?"rgba(16, 185, 129, 0.8)":"rgba(16, 185, 129, 0.4)",i.lineWidth=(w?2:1)/e,i.setLineDash([3/e,3/e]),i.beginPath(),y.pos==="top"?(i.moveTo(y.x,t.y),i.lineTo(y.x,y.y)):y.pos==="right"?(i.moveTo(t.x+t.width,y.y),i.lineTo(y.x,y.y)):y.pos==="bottom"?(i.moveTo(y.x,t.y+t.height),i.lineTo(y.x,y.y)):y.pos==="left"&&(i.moveTo(t.x,y.y),i.lineTo(y.x,y.y)),i.stroke(),i.setLineDash([]),i.shadowColor="rgba(16, 185, 129, 0.5)",i.shadowBlur=(w?8:4)/e,i.fillStyle=w?"#059669":"#10b981",i.strokeStyle="#ffffff",i.lineWidth=2/e,i.beginPath(),i.arc(y.x,y.y,v/2,0,Math.PI*2),i.fill(),i.stroke(),i.shadowBlur=0,i.strokeStyle="#ffffff",i.lineWidth=1.8/e;const x=v*.25;i.beginPath(),y.pos==="top"?(i.moveTo(y.x-x,y.y+x/2),i.lineTo(y.x,y.y-x/2),i.lineTo(y.x+x,y.y+x/2)):y.pos==="right"?(i.moveTo(y.x-x/2,y.y-x),i.lineTo(y.x+x/2,y.y),i.lineTo(y.x-x/2,y.y+x)):y.pos==="bottom"?(i.moveTo(y.x-x,y.y-x/2),i.lineTo(y.x,y.y+x/2),i.lineTo(y.x+x,y.y-x/2)):y.pos==="left"&&(i.moveTo(y.x+x/2,y.y-x),i.lineTo(y.x-x/2,y.y),i.lineTo(y.x+x/2,y.y+x)),i.stroke()})}}}function Vd(i,t,n){const r=2/n,e=8/n;i.save(),i.strokeStyle="#3b82f6",i.lineWidth=1/n,i.setLineDash([5/n,5/n]),i.strokeRect(t.x-r,t.y-r,t.width+r*2,t.height+r*2),i.setLineDash([]),i.fillStyle="#ffffff",i.lineWidth=2/n,[{x:t.x-r,y:t.y-r},{x:t.x+t.width+r,y:t.y-r},{x:t.x+t.width+r,y:t.y+t.height+r},{x:t.x-r,y:t.y+t.height+r},{x:t.x+t.width/2,y:t.y-r},{x:t.x+t.width+r,y:t.y+t.height/2},{x:t.x+t.width/2,y:t.y+t.height+r},{x:t.x-r,y:t.y+t.height/2}].forEach(l=>{i.fillRect(l.x-e/2,l.y-e/2,e,e),i.strokeRect(l.x-e/2,l.y-e/2,e,e)}),i.restore()}function Qd(i,t,n){i.save(),i.fillStyle="rgba(59, 130, 246, 0.2)",i.strokeStyle="#3b82f6",i.lineWidth=1/n,i.fillRect(t.x,t.y,t.w,t.h),i.strokeRect(t.x,t.y,t.w,t.h),i.restore()}function Zd(i,t,n,r){i.save(),i.strokeStyle="#f59e0b",i.lineWidth=2/r,i.strokeRect(t.x-4/r,t.y-4/r,t.width+8/r,t.height+8/r),i.fillStyle="#f59e0b",i.beginPath(),i.arc(n.px,n.py,5/r,0,Math.PI*2),i.fill(),i.restore()}function Jd(i,t,n){t.length!==0&&(i.save(),i.strokeStyle="#ff00ff",i.setLineDash([5/n,5/n]),i.lineWidth=1/n,t.forEach(r=>{i.beginPath(),r.type==="vertical"?(i.moveTo(r.coordinate,-1e5),i.lineTo(r.coordinate,1e5)):(i.moveTo(-1e5,r.coordinate),i.lineTo(1e5,r.coordinate)),i.stroke()}),i.restore())}function Kd(i,t,n){t.length!==0&&(i.save(),i.strokeStyle="#ff00ff",i.fillStyle="#ff00ff",i.lineWidth=1/n,i.font=`${Math.floor(10/n)}px sans-serif`,i.textAlign="center",i.textBaseline="middle",t.forEach(r=>{r.segments.forEach(e=>{if(i.beginPath(),r.orientation==="horizontal"){i.moveTo(e.from,r.variableCoordinate),i.lineTo(e.to,r.variableCoordinate),i.stroke();const o=4/n;i.beginPath(),i.moveTo(e.from,r.variableCoordinate-o),i.lineTo(e.from,r.variableCoordinate+o),i.moveTo(e.to,r.variableCoordinate-o),i.lineTo(e.to,r.variableCoordinate+o),i.stroke();const l=(e.from+e.to)/2,s=Math.round(r.gap).toString(),a=2/n,c=i.measureText(s).width+a*4,h=12/n;i.fillStyle="#ff00ff",i.fillRect(l-c/2,r.variableCoordinate-h/2,c,h),i.fillStyle="white",i.fillText(s,l,r.variableCoordinate),i.fillStyle="#ff00ff"}else{i.beginPath(),i.moveTo(r.variableCoordinate,e.from),i.lineTo(r.variableCoordinate,e.to),i.stroke();const o=4/n;i.beginPath(),i.moveTo(r.variableCoordinate-o,e.from),i.lineTo(r.variableCoordinate+o,e.from),i.moveTo(r.variableCoordinate-o,e.to),i.lineTo(r.variableCoordinate+o,e.to),i.stroke();const l=(e.from+e.to)/2,s=Math.round(r.gap).toString(),a=2/n,c=i.measureText(s).width+a*4,h=12/n;i.fillStyle="#ff00ff",i.fillRect(r.variableCoordinate-c/2,l-h/2,c,h),i.fillStyle="white",i.fillText(s,r.variableCoordinate,l),i.fillStyle="#ff00ff"}})}),i.restore())}function tu(i,t,n,r){const e=-n/t,o=(i.width-n)/t,l=-r/t,s=(i.height-r)/t,a=(o-e)*.1,c=(s-l)*.1;return{minX:e,maxX:o,minY:l,maxY:s,bufferX:a,bufferY:c}}function eu(i,t,n,r,e,o){if(r==="slides"&&t.length>0){const c=t[e];if(c){const{x:h,y:d}=c.spatialPosition,{width:u,height:f}=c.dimensions,g=200,p=new Set(n.filter(v=>v.isMaster).map(v=>v.id)),m=i.filter(v=>{if(p.has(v.layerId))return!0;const x=v.x+v.width/2,k=v.y+v.height/2;return x>=h-g&&x<=h+u+g&&k>=d-g&&k<=d+f+g}),y=new Set(m.map(v=>v.orbitCenterId).filter(Boolean)),w=i.filter(v=>y.has(v.id));return m.length===i.length?i:[...new Set([...m,...w])]}}const l=i.filter(c=>{const h=Math.max(Math.abs(c.width),Math.abs(c.height))*.5;return!(c.x+c.width+h<o.minX-o.bufferX||c.x-h>o.maxX+o.bufferX||c.y+c.height+h<o.minY-o.bufferY||c.y-h>o.maxY+o.bufferY)}),s=new Set(l.map(c=>c.orbitCenterId).filter(Boolean)),a=i.filter(c=>s.has(c.id));return l.length===i.length?i:[...new Set([...l,...a])]}function nu(i,t){if(i.length===0)return;const n=Date.now();let r=0;for(let e=0;e<i.length;e++)n-i[e].timestamp<t&&(i[r++]=i[e]);i.length=r}function iu(i,t,n){const r=n?"#1a1a1b":"#e2e8f0";i.fillStyle=r,i.fillRect(0,0,t.width,t.height)}function Ba(i,t,n,r,e,o,l,s){const a=n.fillStyle||"solid",c=s?"#121212":"#ffffff";if(a==="solid"){let h=n.backgroundColor||c;h==="transparent"&&(h=c),i.fillStyle=h,i.fillRect(r,e,o,l)}else if(["linear","radial","conic"].includes(a)){const h=n.gradientStops||[],d=n.gradientDirection||0;if(h.length===0){let p=n.backgroundColor||c;p==="transparent"&&(p=c),i.fillStyle=p,i.fillRect(r,e,o,l);return}const u=r+o/2,f=e+l/2;let g;if(a==="linear"){const p=d*Math.PI/180,m=Math.sqrt(o*o+l*l)/2,y=Math.cos(p)*m,w=Math.sin(p)*m;g=i.createLinearGradient(u-y,f-w,u+y,f+w)}else{const p=d*Math.PI/180,m=Math.max(o,l)/2,y=m*.4,w=u+Math.cos(p)*y,v=f+Math.sin(p)*y;g=i.createRadialGradient(w,v,0,u,f,m)}h.forEach(p=>{g.addColorStop(p.offset,p.color)}),i.fillStyle=g,i.fillRect(r,e,o,l)}else if(["hachure","cross-hatch","zigzag","dots","dashed","zigzag-line"].includes(a)){const h=n.backgroundColor||c;i.fillStyle=h,i.fillRect(r,e,o,l);const d=n.strokeColor||(s?"#ffffff":"#000000");t.rectangle(r,e,o,l,{fill:d,fillStyle:a,fillWeight:.5,hachureGap:8,stroke:"transparent",roughness:0})}else if(a==="image"&&n.backgroundImage){const h=$a(n.backgroundImage);if(h){i.save(),i.globalAlpha=n.backgroundOpacity??1;const d=h.width/h.height,u=o/l;let f,g,p,m;d>u?(g=l,f=l*d,p=r-(f-o)/2,m=e):(f=o,g=o/d,p=r,m=e-(g-l)/2),i.drawImage(h,p,m,f,g),i.restore()}else i.fillStyle=s?"#1a1a1a":"#f0f0f0",i.fillRect(r,e,o,l)}}function ru(i,t,n,r,e,o,l,s,a){if(i.save(),i.translate(l,s),i.scale(o,o),r==="slides"){const c=n[e];if(c){const{width:h,height:d}=c.dimensions,{x:u,y:f}=c.spatialPosition;i.save(),i.shadowColor=a?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.15)",i.shadowBlur=40,i.shadowOffsetY=10,i.fillStyle="black",i.fillRect(u,f,h,d),i.restore(),Ba(i,t,c,u,f,h,d,a)}}else r==="infinite"&&n.length>1&&n.forEach((c,h)=>{const{width:d,height:u}=c.dimensions,{x:f,y:g}=c.spatialPosition;i.save(),i.strokeStyle=a?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",i.lineWidth=2,i.setLineDash([10,5]),i.strokeRect(f,g,d,u),i.setLineDash([]),i.restore(),i.fillStyle=a?"rgba(100,149,237,0.03)":"rgba(70,130,180,0.02)",i.fillRect(f,g,d,u),i.save();const p=`Slide ${h+1}`,m=Math.max(14,16/o);i.font=`${m}px Inter, sans-serif`;const y=8,w=i.measureText(p),v=m+y*2,x=w.width+y*2;i.fillStyle=a?"rgba(30,30,30,0.8)":"rgba(255,255,255,0.9)",i.fillRect(f,g,x,v),i.strokeStyle=a?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",i.lineWidth=1,i.strokeRect(f,g,x,v),i.fillStyle=a?"rgba(100,149,237,0.8)":"rgba(70,130,180,0.7)",i.fillText(p,f+y,g+m+y/2),i.restore()});i.restore()}function ou(i,t,n,r,e,o,l){if(n!=="none"){if(i.save(),i.setTransform(1,0,0,1,0,0),n==="dots"||n==="grid"||n==="graph"){const s=n==="graph"?40:20,a=s/4,c=l?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",h=l?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.03)",d=l?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.07)",u=e%(s*r),f=o%(s*r);if(n==="dots"){i.fillStyle=c;for(let g=u;g<t.width;g+=s*r)for(let p=f;p<t.height;p+=s*r)i.beginPath(),i.arc(g,p,1,0,Math.PI*2),i.fill()}else if(n==="grid"){i.strokeStyle=h,i.lineWidth=1,i.beginPath();for(let g=u;g<t.width;g+=s*r)i.moveTo(g,0),i.lineTo(g,t.height);for(let g=f;g<t.height;g+=s*r)i.moveTo(0,g),i.lineTo(t.width,g);i.stroke()}else if(n==="graph"){i.strokeStyle=h,i.lineWidth=.5,i.beginPath();for(let g=e%(a*r);g<t.width;g+=a*r)i.moveTo(g,0),i.lineTo(g,t.height);for(let g=o%(a*r);g<t.height;g+=a*r)i.moveTo(0,g),i.lineTo(t.width,g);i.stroke(),i.strokeStyle=d,i.lineWidth=1,i.beginPath();for(let g=u;g<t.width;g+=s*r)i.moveTo(g,0),i.lineTo(g,t.height);for(let g=f;g<t.height;g+=s*r)i.moveTo(0,g),i.lineTo(t.width,g);i.stroke()}}i.restore()}}function su(i,t,n,r,e,o,l){if(!n.enabled)return;const s=n.gridSize;let a=n.gridColor;l&&a==="#e0e0e0"&&(a="#333333");const c=n.gridOpacity,h=n.style||"lines";i.save(),i.setTransform(1,0,0,1,0,0),i.strokeStyle=a,i.fillStyle=a,i.globalAlpha=c,i.lineWidth=1;const d=Math.floor(-e/r/s)*s,u=Math.ceil((t.width-e)/r/s)*s,f=Math.floor(-o/r/s)*s,g=Math.ceil((t.height-o)/r/s)*s;if(h==="lines"){i.beginPath();for(let p=d;p<=u;p+=s){const m=p*r+e;i.moveTo(m,0),i.lineTo(m,t.height)}for(let p=f;p<=g;p+=s){const m=p*r+o;i.moveTo(0,m),i.lineTo(t.width,m)}i.stroke()}else{!l&&h==="dots"&&(a==="#e0e0e0"||a==="#fafafa")&&(i.fillStyle="#b0b0b0");for(let m=d;m<=u;m+=s)for(let y=f;y<=g;y+=s){const w=m*r+e,v=y*r+o;w>=-3&&w<=t.width+3&&v>=-3&&v<=t.height+3&&(i.beginPath(),i.arc(w,v,3/2,0,Math.PI*2),i.fill())}}i.restore()}function au(i,t,n){const{elements:r,layers:e,slides:o,docType:l,activeSlideIndex:s,selection:a,selectedTool:c,animatedStates:h,viewportBounds:d,scale:u,isDarkMode:f,currentDrawingId:g,hoveredConnector:p,editingId:m}=n,y=[...e].sort((x,k)=>x.order-k.order);let w=0;const v=new Map;for(const x of r)v.set(x.id,x);return y.forEach(x=>{if(!Vt(x.id))return;if(x.backgroundColor&&x.backgroundColor!=="transparent"){i.save(),i.globalAlpha=x.opacity,i.fillStyle=x.backgroundColor;const S=1e6;i.fillRect(-S,-S,S*2,S*2),i.restore()}const k=r.filter(S=>{if(S.layerId!==x.id)return!1;if(S.id===g||x.isMaster)return!0;if(Ae(S,r,v))return!1;if(S.type==="line"||S.type==="arrow"||S.type==="bezier"){if(S.startBinding){const E=v.get(S.startBinding.elementId);if(E&&Ae(E,r,v))return!1}if(S.endBinding){const E=v.get(S.endBinding.elementId);if(E&&Ae(E,r,v))return!1}}const M=Math.abs(S.width)*u,C=Math.abs(S.height)*u;if(M<1&&C<1)return!1;const R=Math.max(Math.abs(S.width),Math.abs(S.height))*.5;return!(S.x+S.width+R<d.minX-d.bufferX||S.x-R>d.maxX+d.bufferX||S.y+S.height+R<d.minY-d.bufferY||S.y-R>d.maxY+d.bufferY)});w+=k.length,k.forEach(S=>{const M=h.get(S.id),C=M?{...S,x:M.x,y:M.y,angle:M.angle}:JSON.parse(JSON.stringify(S)),R=x.isMaster;if(R&&l==="slides"){const E=o[s];if(E){const O=or(C,E,o);C.x=O.x,C.y=O.y}}if(l==="slides"&&!R){const E=o[s];if(E){const{x:O,y:z}=E.spatialPosition,{width:F,height:U}=E.dimensions,J=C.x+C.width/2,rt=C.y+C.height/2;if(!(J>=O&&J<=O+F&&rt>=z&&rt<=z+U))return}}if(C.type==="text"&&C.text){if(C.text.startsWith("=="))C.text=C.text.substring(1);else if(C.text.startsWith("=")){const E=(s+1).toString(),O=o.length.toString();C.text=C.text.substring(1).replace(/\$\{slideNumber\}/g,E).replace(/\$\{totalSlides\}/g,O)}}if(C.type!=="text"||m!==C.id){const E=x?.opacity??1;te(t,i,C,f,E)}Gd(i,S,C,{scale:u,isSelected:a.includes(S.id),selectionLength:a.length,isDarkMode:f,elements:r,selectedTool:c,hoveredConnector:p})})}),w}function lu(i,t){const{elements:n,selection:r,scale:e,selectionBox:o,suggestedBinding:l,snappingGuides:s,spacingGuides:a}=t;if(r.length>1){const c=Yn(n,r);c&&Vd(i,c,e)}if(o&&Qd(i,o,e),l){const c=n.find(h=>h.id===l.elementId);c&&Zd(i,c,l,e)}Jd(i,s,e),Kd(i,a,e)}function cu(i,t){const{elements:n,selectedTool:r,currentDrawingId:e,isDrawing:o,activeLayerId:l,scale:s,canInteractWithElement:a}=t;if(!(r==="line"||r==="arrow")||!o||!e)return;const c=n.find(g=>g.id===e);if(!c||c.type!=="line"&&c.type!=="arrow")return;const h=c.x+c.width,d=c.y+c.height,u=50/s,f=15/s;i.save();for(const g of n){if(g.id===e||!a(g)||g.type==="line"||g.type==="arrow"||g.type==="bezier"||g.layerId!==l)continue;const p=g.x+g.width/2,m=g.y+g.height/2;if(Math.sqrt((p-h)**2+(m-d)**2)<u){const w=Xn(g);for(const v of w){const x=v.x-h,k=v.y-d,M=Math.sqrt(x*x+k*k)<f,C=M?6/s:4/s;i.beginPath(),i.arc(v.x,v.y,C,0,Math.PI*2),M?(i.fillStyle="#3b82f6",i.fill()):(i.fillStyle="rgba(59, 130, 246, 0.4)",i.fill(),i.strokeStyle="#3b82f6",i.lineWidth=1/s,i.stroke())}}}i.restore()}function hu(i,t,n,r){if(t.length<=1)return;const e=Date.now();i.save(),i.lineCap="round",i.lineJoin="round",i.shadowBlur=8,i.shadowColor="rgba(255, 50, 50, 0.6)";const o=4/n;let l=-1;for(let s=0;s<t.length-1;s++){const a=t[s],c=t[s+1],h=e-a.timestamp,d=Math.max(0,1-h/r);if(d<=0)continue;const u=Math.ceil(d*5);if(u!==l){l!==-1&&i.stroke(),l=u;const f=u/5;i.beginPath(),i.strokeStyle=`rgba(255, 30, 30, ${f})`,i.lineWidth=o*f,i.moveTo(a.x,a.y)}i.lineTo(c.x,c.y)}l!==-1&&i.stroke(),i.restore()}var du=$('<div class=minimap-container><div class=minimap-header><span class=minimap-title>Navigator</span><button class=minimap-close title="Close minimap (Alt+M)"></button></div><canvas width=200 height=150 class=minimap-canvas>');const uu=i=>{let t,n,r=!1;const e=200,o=150,l=10,s=()=>{if(b.elements.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800,width:1e3,height:800};let g=1/0,p=1/0,m=-1/0,y=-1/0;b.elements.forEach(v=>{g=Math.min(g,v.x),m=Math.max(m,v.x+v.width),p=Math.min(p,v.y),y=Math.max(y,v.y+v.height)});const w=50;return g-=w,p-=w,m+=w,y+=w,{minX:g,minY:p,maxX:m,maxY:y,width:m-g,height:y-p}},a=g=>{const p=(e-l*2)/g.width,m=(o-l*2)/g.height;return Math.min(p,m)},c=g=>{if(!t)return;const p=t.getContext("2d");if(!p)return;const m=s(),y=a(m);p.clearRect(0,0,e,o);const w=b.theme==="dark";let v=b.canvasBackgroundColor;v||(v=w?"#121212":"#fafafa"),p.fillStyle=v,p.fillRect(0,0,e,o),p.save(),p.translate(l,l),p.scale(y,y),p.translate(-m.minX,-m.minY),b.elements.forEach(z=>{const F=b.layers.find(U=>U.id===z.layerId);F?.visible&&te(g,p,z,b.theme==="dark",F?.opacity??1)}),p.restore();const x=-b.viewState.panX/b.viewState.scale,k=-b.viewState.panY/b.viewState.scale,S=i.canvasWidth/b.viewState.scale,M=i.canvasHeight/b.viewState.scale,C=(x-m.minX)*y+l,R=(k-m.minY)*y+l,E=S*y,O=M*y;p.save(),p.strokeStyle=b.theme==="dark"?"#60a5fa":"#3b82f6",p.lineWidth=2,p.fillStyle=b.theme==="dark"?"rgba(96, 165, 250, 0.1)":"rgba(59, 130, 246, 0.1)",p.fillRect(C,R,E,O),p.strokeRect(C,R,E,O),p.restore()},h=g=>{if(r)return;const p=t?.getBoundingClientRect();if(!p)return;const m=g.clientX-p.left,y=g.clientY-p.top,w=s(),v=a(w),x=(m-l)/v+w.minX,k=(y-l)/v+w.minY;St({panX:-x*b.viewState.scale+i.canvasWidth/2,panY:-k*b.viewState.scale+i.canvasHeight/2})},d=g=>{if(!t)return;const p=t.getBoundingClientRect(),m=g.clientX-p.left,y=g.clientY-p.top,w=s(),v=a(w),x=-b.viewState.panX/b.viewState.scale,k=-b.viewState.panY/b.viewState.scale,S=i.canvasWidth/b.viewState.scale,M=i.canvasHeight/b.viewState.scale,C=(x-w.minX)*v+l,R=(k-w.minY)*v+l,E=S*v,O=M*v;m>=C&&m<=C+E&&y>=R&&y<=R+O&&(r=!0,t.setPointerCapture(g.pointerId))},u=g=>{if(!r||!t)return;const p=t.getBoundingClientRect(),m=g.clientX-p.left,y=g.clientY-p.top,w=s(),v=a(w),x=(m-l)/v+w.minX,k=(y-l)/v+w.minY;St({panX:-x*b.viewState.scale+i.canvasWidth/2,panY:-k*b.viewState.scale+i.canvasHeight/2})},f=g=>{r&&t&&(t.releasePointerCapture(g.pointerId),r=!1)};return ct(()=>{if(!t)return;const g=Ue.canvas(t);b.elements.forEach(y=>{if(y.points?.length,y.x,y.y,y.width,y.height,y.opacity,y.layerId,y.strokeColor,y.backgroundColor,y.renderStyle,y.points){const w=ft(y.points);if(w.length>0){const v=w[w.length-1];v.x,v.y}}}),b.viewState.panX,b.viewState.panY,b.viewState.scale,b.theme,b.layers.forEach(y=>{y.visible,y.opacity});const m=requestAnimationFrame(()=>c(g));mt(()=>cancelAnimationFrame(m))}),ye(()=>{if(t&&(t.addEventListener("click",h),t.addEventListener("pointerdown",d),t.addEventListener("pointermove",u),t.addEventListener("pointerup",f),t.addEventListener("pointercancel",f)),mt(()=>{t&&(t.removeEventListener("click",h),t.removeEventListener("pointerdown",d),t.removeEventListener("pointermove",u),t.removeEventListener("pointerup",f),t.removeEventListener("pointercancel",f))}),t){const g=Ue.canvas(t);c(g)}}),(()=>{var g=du(),p=g.firstChild,m=p.firstChild,y=m.nextSibling,w=p.nextSibling,v=n;typeof v=="function"?tt(v,g):n=g,y.$$click=()=>ai(!1),I(y,_(Vi,{size:14}));var x=t;return typeof x=="function"?tt(x,w):t=w,g})()};ht(["click"]);const li=async()=>{if(b.selection.length===0)return;const t={type:"yappy-elements",elements:b.elements.filter(n=>b.selection.includes(n.id))};try{await navigator.clipboard.writeText(JSON.stringify(t))}catch(n){console.error("Failed to copy: ",n)}},_r=async()=>{await li(),oe(b.selection)},Gn=async()=>{try{const i=await navigator.clipboard.readText();if(!i)return;const t=JSON.parse(i);if(t.type==="yappy-elements"&&Array.isArray(t.elements)){Q();const n=[],r=-b.viewState.panX/b.viewState.scale+window.innerWidth/2/b.viewState.scale,e=-b.viewState.panY/b.viewState.scale+window.innerHeight/2/b.viewState.scale;let o=1/0,l=1/0,s=-1/0,a=-1/0;t.elements.forEach(f=>{o=Math.min(o,f.x),l=Math.min(l,f.y),s=Math.max(s,f.x+f.width),a=Math.max(a,f.y+f.height)});const c=o+(s-o)/2,h=l+(a-l)/2,d=r-c,u=e-h;t.elements.forEach(f=>{const g=Lt(f.type),p={...f,id:g,x:f.x+d,y:f.y+u,layerId:b.activeLayerId,groupIds:[]};P("elements",m=>[...m,p]),n.push(g)}),P("selection",n)}}catch(i){console.error("Failed to paste: ",i)}},Vr=i=>{if(b.selection.length===0)return;Q();let t=1/0,n=-1/0;b.elements.forEach(e=>{b.selection.includes(e.id)&&(i==="horizontal"?(t=Math.min(t,e.x),n=Math.max(n,e.x+e.width)):(t=Math.min(t,e.y),n=Math.max(n,e.y+e.height)))});const r=t+(n-t)/2;b.selection.forEach(e=>{const o=b.elements.find(l=>l.id===e);if(o)if(i==="horizontal"){const s=o.x+o.width/2-r,a=r-s-o.width/2;if(o.points){const c=ft(o.points);if(c.length>0){const h=c.map(d=>({x:o.width-d.x,y:d.y}));D(e,{x:a,points:h,pointsEncoding:void 0,seed:o.seed+1},!1)}else(!o.points||o.points.length===0)&&D(e,{x:a,seed:o.seed+1},!1)}else D(e,{x:a,seed:o.seed+1},!1)}else{const s=o.y+o.height/2-r,a=r-s-o.height/2;if(o.points){const c=ft(o.points);if(c.length>0){const h=c.map(d=>({x:d.x,y:o.height-d.y}));D(e,{y:a,points:h,pointsEncoding:void 0,seed:o.seed+1},!1)}else D(e,{y:a,seed:o.seed+1},!1)}else D(e,{y:a,seed:o.seed+1},!1)}})},fu=i=>{b.selection.forEach(t=>{D(t,{locked:i})})};let Bi=null;const Ar=()=>{if(b.selection.length!==1)return;const i=b.elements.find(t=>t.id===b.selection[0]);i&&(Bi={strokeColor:i.strokeColor,backgroundColor:i.backgroundColor,fillStyle:i.fillStyle,strokeWidth:i.strokeWidth,strokeStyle:i.strokeStyle,roughness:i.roughness,opacity:i.opacity,fontFamily:i.fontFamily,fontSize:i.fontSize,textAlign:i.textAlign,roundness:i.roundness,gradientStart:i.gradientStart,gradientEnd:i.gradientEnd,gradientDirection:i.gradientDirection,gradientStops:i.gradientStops?JSON.parse(JSON.stringify(i.gradientStops)):void 0,gradientType:i.gradientType,gradientHandlePositions:i.gradientHandlePositions?JSON.parse(JSON.stringify(i.gradientHandlePositions)):void 0,shadowEnabled:i.shadowEnabled,shadowColor:i.shadowColor,shadowBlur:i.shadowBlur,shadowOffsetX:i.shadowOffsetX,shadowOffsetY:i.shadowOffsetY,drawInnerBorder:i.drawInnerBorder,innerBorderColor:i.innerBorderColor,innerBorderDistance:i.innerBorderDistance,strokeLineJoin:i.strokeLineJoin,fillDensity:i.fillDensity,renderStyle:i.renderStyle,flowAnimation:i.flowAnimation,flowSpeed:i.flowSpeed,flowStyle:i.flowStyle})},Tr=()=>{!Bi||b.selection.length===0||(Q(),b.selection.forEach(i=>{D(i,Bi)}))},Qr=(i,t,n=!0)=>{const r=b.elements.find(a=>a.id===i);if(!r||r.type===t)return;const e=a=>["line","arrow","bezier","organicBranch"].includes(a),o=e(r.type),l=e(t);if(o!==l){console.warn(`Cannot transform ${r.type} to ${t}: Incompatible families.`);return}const s={type:t};if(l)if(t==="bezier"||t==="organicBranch"){if(s.curveType="bezier",!r.controlPoints||r.controlPoints.length!==2){const a=r.x,c=r.y,h=r.x+r.width,d=r.y+r.height,u=h-a,f=d-c,g={x:a+u*.25,y:c+f*.1},p={x:h-u*.25,y:d-f*.1};s.controlPoints=[g,p]}}else(r.type==="bezier"||r.type==="organicBranch")&&(s.curveType="straight",s.controlPoints=void 0);D(i,s,n)},Zr=i=>{const t=["line","arrow","bezier","organicBranch"],n=["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","polygon","star","cloud","heart","cross","checkmark","arrowLeft","arrowRight","arrowUp","arrowDown","capsule","stickyNote","callout","speechBubble","burst","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","browserWindow","mobilePhone","ghostButton","inputField","starPerson","lightbulb","signpost","burstBlob","scroll","wavyDivider","doubleBanner","trophy","clock","gear","target","rocket","flag","key","magnifyingGlass","book","megaphone","eye","thoughtBubble","stickFigure","sittingPerson","presentingPerson","handPointRight","thumbsUp","faceHappy","faceSad","faceConfused","checkbox","checkboxChecked","numberedBadge","questionMark","exclamationMark","tag","pin","stamp","kubernetes","container","apiGateway","cdn","storageBlob","eventBus","microservice","shield","barChart","pieChart","trendUp","trendDown","funnel","gauge","table","puzzlePiece","chainLink","bridge","magnet","scale","seedling","tree","mountain","dfdProcess","dfdDataStore","externalEntity","isometricCube","solidBlock","perspectiveBlock","cylinder","stateStart","stateEnd","stateSync","activationBar"],r=["umlClass","umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"];return t.includes(i)?t.filter(e=>e!==i):n.includes(i)?n.filter(e=>e!==i):r.includes(i)?r.filter(e=>e!==i):[]},Jr=i=>({line:"",arrow:"",bezier:"",organicBranch:"",straight:"",elbow:"",rectangle:"",circle:"",diamond:"",triangle:"",hexagon:"",octagon:"",parallelogram:"",polygon:"",star:"",cloud:"",heart:"",cross:"",checkmark:"",arrowLeft:"",arrowRight:"",arrowUp:"",arrowDown:"",database:"",document:"",predefinedProcess:"",internalStorage:"",server:"",loadBalancer:"",firewall:"",user:"",messageQueue:"",lambda:"",router:"",browser:"",capsule:"",stickyNote:"",callout:"",speechBubble:"",burst:"",ribbon:"",bracketLeft:"",bracketRight:"",trapezoid:"",rightTriangle:"",pentagon:"",septagon:"",browserWindow:"",mobilePhone:"",ghostButton:"",inputField:"",starPerson:"",lightbulb:"",signpost:"",burstBlob:"",scroll:"",wavyDivider:"",doubleBanner:"",trophy:"",clock:"",gear:"",target:"",rocket:"",flag:"",key:"",magnifyingGlass:"",book:"",megaphone:"",eye:"",thoughtBubble:"",stickFigure:"",sittingPerson:"",presentingPerson:"",handPointRight:"",thumbsUp:"",faceHappy:"",faceSad:"",faceConfused:"",checkbox:"",checkboxChecked:"",numberedBadge:"",questionMark:"",exclamationMark:"",tag:"",pin:"",stamp:"",kubernetes:"",container:"",apiGateway:"",cdn:"",storageBlob:"",eventBus:"",microservice:"",shield:"",barChart:"",pieChart:"",trendUp:"",trendDown:"",funnel:"",gauge:"",table:"",puzzlePiece:"",chainLink:"",bridge:"",magnet:"",scale:"",seedling:"",tree:"",mountain:"",dfdProcess:"",dfdDataStore:"",externalEntity:"",isometricCube:"",solidBlock:"",perspectiveBlock:"",cylinder:"",stateStart:"",stateEnd:"",stateSync:"",activationBar:"",umlClass:"",umlInterface:"",umlActor:"",umlUseCase:"",umlNote:"",umlPackage:"",umlComponent:"",umlState:"",umlLifeline:"",umlFragment:"",umlSignalSend:"",umlSignalReceive:"",umlProvidedInterface:"",umlRequiredInterface:""})[i]||"",Kr=i=>i.charAt(0).toUpperCase()+i.slice(1).replace(/([A-Z])/g," $1"),pu=i=>["straight","bezier","elbow"].filter(t=>t!==i),gu=i=>({straight:"",bezier:"",elbow:""})[i]||"",yu=i=>i.charAt(0).toUpperCase()+i.slice(1);function Di(i,t,n){if(i&&i.length){const[r,e]=t,o=Math.PI/180*n,l=Math.cos(o),s=Math.sin(o);for(const a of i){const[c,h]=a;a[0]=(c-r)*l-(h-e)*s+r,a[1]=(c-r)*s+(h-e)*l+e}}}function mu(i,t,n){const r=[];i.forEach(e=>r.push(...e)),Di(r,t,n)}function bu(i,t){return i[0]===t[0]&&i[1]===t[1]}function wu(i,t,n,r=1){const e=n,o=Math.max(t,.1),l=i[0]&&i[0][0]&&typeof i[0][0]=="number"?[i]:i,s=[0,0];if(e)for(const c of l)Di(c,s,e);const a=vu(l,o,r);if(e){for(const c of l)Di(c,s,-e);mu(a,s,-e)}return a}function vu(i,t,n){const r=[];for(const c of i){const h=[...c];bu(h[0],h[h.length-1])||h.push([h[0][0],h[0][1]]),h.length>2&&r.push(h)}const e=[];t=Math.max(t,.1);const o=[];for(const c of r)for(let h=0;h<c.length-1;h++){const d=c[h],u=c[h+1];if(d[1]!==u[1]){const f=Math.min(d[1],u[1]);o.push({ymin:f,ymax:Math.max(d[1],u[1]),x:f===d[1]?d[0]:u[0],islope:(u[0]-d[0])/(u[1]-d[1])})}}if(o.sort((c,h)=>c.ymin<h.ymin?-1:c.ymin>h.ymin?1:c.x<h.x?-1:c.x>h.x?1:c.ymax===h.ymax?0:(c.ymax-h.ymax)/Math.abs(c.ymax-h.ymax)),!o.length)return e;let l=[],s=o[0].ymin,a=0;for(;l.length||o.length;){if(o.length){let c=-1;for(let d=0;d<o.length&&!(o[d].ymin>s);d++)c=d;o.splice(0,c+1).forEach(d=>{l.push({s,edge:d})})}if(l=l.filter(c=>!(c.edge.ymax<=s)),l.sort((c,h)=>c.edge.x===h.edge.x?0:(c.edge.x-h.edge.x)/Math.abs(c.edge.x-h.edge.x)),(n!==1||a%t===0)&&l.length>1)for(let c=0;c<l.length;c=c+2){const h=c+1;if(h>=l.length)break;const d=l[c].edge,u=l[h].edge;e.push([[Math.round(d.x),s],[Math.round(u.x),s]])}s+=n,l.forEach(c=>{c.edge.x=c.edge.x+n*c.edge.islope}),a++}return e}function nn(i,t){var n;const r=t.hachureAngle+90;let e=t.hachureGap;e<0&&(e=t.strokeWidth*4),e=Math.round(Math.max(e,.1));let o=1;return t.roughness>=1&&(((n=t.randomizer)===null||n===void 0?void 0:n.next())||Math.random())>.7&&(o=e),wu(i,e,r,o||1)}class Lr{constructor(t){this.helper=t}fillPolygons(t,n){return this._fillPolygons(t,n)}_fillPolygons(t,n){const r=nn(t,n);return{type:"fillSketch",ops:this.renderLines(r,n)}}renderLines(t,n){const r=[];for(const e of t)r.push(...this.helper.doubleLineOps(e[0][0],e[0][1],e[1][0],e[1][1],n));return r}}function ci(i){const t=i[0],n=i[1];return Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2))}class xu extends Lr{fillPolygons(t,n){let r=n.hachureGap;r<0&&(r=n.strokeWidth*4),r=Math.max(r,.1);const e=Object.assign({},n,{hachureGap:r}),o=nn(t,e),l=Math.PI/180*n.hachureAngle,s=[],a=r*.5*Math.cos(l),c=r*.5*Math.sin(l);for(const[d,u]of o)ci([d,u])&&s.push([[d[0]-a,d[1]+c],[...u]],[[d[0]+a,d[1]-c],[...u]]);return{type:"fillSketch",ops:this.renderLines(s,n)}}}class ku extends Lr{fillPolygons(t,n){const r=this._fillPolygons(t,n),e=Object.assign({},n,{hachureAngle:n.hachureAngle+90}),o=this._fillPolygons(t,e);return r.ops=r.ops.concat(o.ops),r}}class Su{constructor(t){this.helper=t}fillPolygons(t,n){n=Object.assign({},n,{hachureAngle:0});const r=nn(t,n);return this.dotsOnLines(r,n)}dotsOnLines(t,n){const r=[];let e=n.hachureGap;e<0&&(e=n.strokeWidth*4),e=Math.max(e,.1);let o=n.fillWeight;o<0&&(o=n.strokeWidth/2);const l=e/4;for(const s of t){const a=ci(s),c=a/e,h=Math.ceil(c)-1,d=a-h*e,u=(s[0][0]+s[1][0])/2-e/4,f=Math.min(s[0][1],s[1][1]);for(let g=0;g<h;g++){const p=f+d+g*e,m=u-l+Math.random()*2*l,y=p-l+Math.random()*2*l,w=this.helper.ellipse(m,y,o,o,n);r.push(...w.ops)}}return{type:"fillSketch",ops:r}}}class Mu{constructor(t){this.helper=t}fillPolygons(t,n){const r=nn(t,n);return{type:"fillSketch",ops:this.dashedLine(r,n)}}dashedLine(t,n){const r=n.dashOffset<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashOffset,e=n.dashGap<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashGap,o=[];return t.forEach(l=>{const s=ci(l),a=Math.floor(s/(r+e)),c=(s+e-a*(r+e))/2;let h=l[0],d=l[1];h[0]>d[0]&&(h=l[1],d=l[0]);const u=Math.atan((d[1]-h[1])/(d[0]-h[0]));for(let f=0;f<a;f++){const g=f*(r+e),p=g+r,m=[h[0]+g*Math.cos(u)+c*Math.cos(u),h[1]+g*Math.sin(u)+c*Math.sin(u)],y=[h[0]+p*Math.cos(u)+c*Math.cos(u),h[1]+p*Math.sin(u)+c*Math.sin(u)];o.push(...this.helper.doubleLineOps(m[0],m[1],y[0],y[1],n))}}),o}}class Pu{constructor(t){this.helper=t}fillPolygons(t,n){const r=n.hachureGap<0?n.strokeWidth*4:n.hachureGap,e=n.zigzagOffset<0?r:n.zigzagOffset;n=Object.assign({},n,{hachureGap:r+e});const o=nn(t,n);return{type:"fillSketch",ops:this.zigzagLines(o,e,n)}}zigzagLines(t,n,r){const e=[];return t.forEach(o=>{const l=ci(o),s=Math.round(l/(2*n));let a=o[0],c=o[1];a[0]>c[0]&&(a=o[1],c=o[0]);const h=Math.atan((c[1]-a[1])/(c[0]-a[0]));for(let d=0;d<s;d++){const u=d*2*n,f=(d+1)*2*n,g=Math.sqrt(2*Math.pow(n,2)),p=[a[0]+u*Math.cos(h),a[1]+u*Math.sin(h)],m=[a[0]+f*Math.cos(h),a[1]+f*Math.sin(h)],y=[p[0]+g*Math.cos(h+Math.PI/4),p[1]+g*Math.sin(h+Math.PI/4)];e.push(...this.helper.doubleLineOps(p[0],p[1],y[0],y[1],r),...this.helper.doubleLineOps(y[0],y[1],m[0],m[1],r))}}),e}}const Tt={};function Cu(i,t){let n=i.fillStyle||"hachure";if(!Tt[n])switch(n){case"zigzag":Tt[n]||(Tt[n]=new xu(t));break;case"cross-hatch":Tt[n]||(Tt[n]=new ku(t));break;case"dots":Tt[n]||(Tt[n]=new Su(t));break;case"dashed":Tt[n]||(Tt[n]=new Mu(t));break;case"zigzag-line":Tt[n]||(Tt[n]=new Pu(t));break;default:n="hachure",Tt[n]||(Tt[n]=new Lr(t));break}return Tt[n]}function _u(){return Math.floor(Math.random()*2**31)}class Au{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const Tu=0,zi=1,Da=2,pn={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Lu(i){const t=new Array;for(;i!=="";)if(i.match(/^([ \t\r\n,]+)/))i=i.substr(RegExp.$1.length);else if(i.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:Tu,text:RegExp.$1},i=i.substr(RegExp.$1.length);else if(i.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:zi,text:`${parseFloat(RegExp.$1)}`},i=i.substr(RegExp.$1.length);else return[];return t[t.length]={type:Da,text:""},t}function xi(i,t){return i.type===t}function Ir(i){const t=[],n=Lu(i);let r="BOD",e=0,o=n[e];for(;!xi(o,Da);){let l=0;const s=[];if(r==="BOD")if(o.text==="M"||o.text==="m")e++,l=pn[o.text],r=o.text;else return Ir("M0,0"+i);else xi(o,zi)?l=pn[r]:(e++,l=pn[o.text],r=o.text);if(e+l<n.length){for(let a=e;a<e+l;a++){const c=n[a];if(xi(c,zi))s[s.length]=+c.text;else throw new Error("Param not a number: "+r+","+c.text)}if(typeof pn[r]=="number"){const a={key:r,data:s};t.push(a),e+=l,o=n[e],r==="M"&&(r="L"),r==="m"&&(r="l")}else throw new Error("Bad segment: "+r)}else throw new Error("Path data ended short")}return t}function za(i){let t=0,n=0,r=0,e=0;const o=[];for(const{key:l,data:s}of i)switch(l){case"M":o.push({key:"M",data:[...s]}),[t,n]=s,[r,e]=s;break;case"m":t+=s[0],n+=s[1],o.push({key:"M",data:[t,n]}),r=t,e=n;break;case"L":o.push({key:"L",data:[...s]}),[t,n]=s;break;case"l":t+=s[0],n+=s[1],o.push({key:"L",data:[t,n]});break;case"C":o.push({key:"C",data:[...s]}),t=s[4],n=s[5];break;case"c":{const a=s.map((c,h)=>h%2?c+n:c+t);o.push({key:"C",data:a}),t=a[4],n=a[5];break}case"Q":o.push({key:"Q",data:[...s]}),t=s[2],n=s[3];break;case"q":{const a=s.map((c,h)=>h%2?c+n:c+t);o.push({key:"Q",data:a}),t=a[2],n=a[3];break}case"A":o.push({key:"A",data:[...s]}),t=s[5],n=s[6];break;case"a":t+=s[5],n+=s[6],o.push({key:"A",data:[s[0],s[1],s[2],s[3],s[4],t,n]});break;case"H":o.push({key:"H",data:[...s]}),t=s[0];break;case"h":t+=s[0],o.push({key:"H",data:[t]});break;case"V":o.push({key:"V",data:[...s]}),n=s[0];break;case"v":n+=s[0],o.push({key:"V",data:[n]});break;case"S":o.push({key:"S",data:[...s]}),t=s[2],n=s[3];break;case"s":{const a=s.map((c,h)=>h%2?c+n:c+t);o.push({key:"S",data:a}),t=a[2],n=a[3];break}case"T":o.push({key:"T",data:[...s]}),t=s[0],n=s[1];break;case"t":t+=s[0],n+=s[1],o.push({key:"T",data:[t,n]});break;case"Z":case"z":o.push({key:"Z",data:[]}),t=r,n=e;break}return o}function Fa(i){const t=[];let n="",r=0,e=0,o=0,l=0,s=0,a=0;for(const{key:c,data:h}of i){switch(c){case"M":t.push({key:"M",data:[...h]}),[r,e]=h,[o,l]=h;break;case"C":t.push({key:"C",data:[...h]}),r=h[4],e=h[5],s=h[2],a=h[3];break;case"L":t.push({key:"L",data:[...h]}),[r,e]=h;break;case"H":r=h[0],t.push({key:"L",data:[r,e]});break;case"V":e=h[0],t.push({key:"L",data:[r,e]});break;case"S":{let d=0,u=0;n==="C"||n==="S"?(d=r+(r-s),u=e+(e-a)):(d=r,u=e),t.push({key:"C",data:[d,u,...h]}),s=h[0],a=h[1],r=h[2],e=h[3];break}case"T":{const[d,u]=h;let f=0,g=0;n==="Q"||n==="T"?(f=r+(r-s),g=e+(e-a)):(f=r,g=e);const p=r+2*(f-r)/3,m=e+2*(g-e)/3,y=d+2*(f-d)/3,w=u+2*(g-u)/3;t.push({key:"C",data:[p,m,y,w,d,u]}),s=f,a=g,r=d,e=u;break}case"Q":{const[d,u,f,g]=h,p=r+2*(d-r)/3,m=e+2*(u-e)/3,y=f+2*(d-f)/3,w=g+2*(u-g)/3;t.push({key:"C",data:[p,m,y,w,f,g]}),s=d,a=u,r=f,e=g;break}case"A":{const d=Math.abs(h[0]),u=Math.abs(h[1]),f=h[2],g=h[3],p=h[4],m=h[5],y=h[6];d===0||u===0?(t.push({key:"C",data:[r,e,m,y,m,y]}),r=m,e=y):(r!==m||e!==y)&&(Wa(r,e,m,y,d,u,f,g,p).forEach(function(v){t.push({key:"C",data:v})}),r=m,e=y);break}case"Z":t.push({key:"Z",data:[]}),r=o,e=l;break}n=c}return t}function Iu(i){return Math.PI*i/180}function Oe(i,t,n){const r=i*Math.cos(n)-t*Math.sin(n),e=i*Math.sin(n)+t*Math.cos(n);return[r,e]}function Wa(i,t,n,r,e,o,l,s,a,c){const h=Iu(l);let d=[],u=0,f=0,g=0,p=0;if(c)[u,f,g,p]=c;else{[i,t]=Oe(i,t,-h),[n,r]=Oe(n,r,-h);const z=(i-n)/2,F=(t-r)/2;let U=z*z/(e*e)+F*F/(o*o);U>1&&(U=Math.sqrt(U),e=U*e,o=U*o);const J=s===a?-1:1,rt=e*e,X=o*o,W=rt*X-rt*F*F-X*z*z,Y=rt*F*F+X*z*z,lt=J*Math.sqrt(Math.abs(W/Y));g=lt*e*F/o+(i+n)/2,p=lt*-o*z/e+(t+r)/2,u=Math.asin(parseFloat(((t-p)/o).toFixed(9))),f=Math.asin(parseFloat(((r-p)/o).toFixed(9))),i<g&&(u=Math.PI-u),n<g&&(f=Math.PI-f),u<0&&(u=Math.PI*2+u),f<0&&(f=Math.PI*2+f),a&&u>f&&(u=u-Math.PI*2),!a&&f>u&&(f=f-Math.PI*2)}let m=f-u;if(Math.abs(m)>Math.PI*120/180){const z=f,F=n,U=r;a&&f>u?f=u+Math.PI*120/180*1:f=u+Math.PI*120/180*-1,n=g+e*Math.cos(f),r=p+o*Math.sin(f),d=Wa(n,r,F,U,e,o,l,0,a,[f,z,g,p])}m=f-u;const y=Math.cos(u),w=Math.sin(u),v=Math.cos(f),x=Math.sin(f),k=Math.tan(m/4),S=4/3*e*k,M=4/3*o*k,C=[i,t],R=[i+S*w,t-M*y],E=[n+S*x,r-M*v],O=[n,r];if(R[0]=2*C[0]-R[0],R[1]=2*C[1]-R[1],c)return[R,E,O].concat(d);{d=[R,E,O].concat(d);const z=[];for(let F=0;F<d.length;F+=3){const U=Oe(d[F][0],d[F][1],h),J=Oe(d[F+1][0],d[F+1][1],h),rt=Oe(d[F+2][0],d[F+2][1],h);z.push([U[0],U[1],J[0],J[1],rt[0],rt[1]])}return z}}const $u={randOffset:Bu,randOffsetWithRange:Du,ellipse:Nu,doubleLineOps:zu};function ja(i,t,n,r,e){return{type:"path",ops:re(i,t,n,r,e)}}function Nn(i,t,n){const r=(i||[]).length;if(r>2){const e=[];for(let o=0;o<r-1;o++)e.push(...re(i[o][0],i[o][1],i[o+1][0],i[o+1][1],n));return t&&e.push(...re(i[r-1][0],i[r-1][1],i[0][0],i[0][1],n)),{type:"path",ops:e}}else if(r===2)return ja(i[0][0],i[0][1],i[1][0],i[1][1],n);return{type:"path",ops:[]}}function Ru(i,t){return Nn(i,!0,t)}function Eu(i,t,n,r,e){const o=[[i,t],[i+n,t],[i+n,t+r],[i,t+r]];return Ru(o,e)}function to(i,t){if(i.length){const r=typeof i[0][0]=="number"?[i]:i,e=gn(r[0],1*(1+t.roughness*.2),t),o=t.disableMultiStroke?[]:gn(r[0],1.5*(1+t.roughness*.22),io(t));for(let l=1;l<r.length;l++){const s=r[l];if(s.length){const a=gn(s,1*(1+t.roughness*.2),t),c=t.disableMultiStroke?[]:gn(s,1.5*(1+t.roughness*.22),io(t));for(const h of a)h.op!=="move"&&e.push(h);for(const h of c)h.op!=="move"&&o.push(h)}}return{type:"path",ops:e.concat(o)}}return{type:"path",ops:[]}}function Nu(i,t,n,r,e){const o=Ua(n,r,e);return Fi(i,t,e,o).opset}function Ua(i,t,n){const r=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(i/2,2)+Math.pow(t/2,2))/2)),e=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*r)),o=Math.PI*2/e;let l=Math.abs(i/2),s=Math.abs(t/2);const a=1-n.curveFitting;return l+=V(l*a,n),s+=V(s*a,n),{increment:o,rx:l,ry:s}}function Fi(i,t,n,r){const[e,o]=ro(r.increment,i,t,r.rx,r.ry,1,r.increment*Vn(.1,Vn(.4,1,n),n),n);let l=Qn(e,null,n);if(!n.disableMultiStroke&&n.roughness!==0){const[s]=ro(r.increment,i,t,r.rx,r.ry,1.5,0,n),a=Qn(s,null,n);l=l.concat(a)}return{estimatedPoints:o,opset:{type:"path",ops:l}}}function eo(i,t,n,r,e,o,l,s,a){const c=i,h=t;let d=Math.abs(n/2),u=Math.abs(r/2);d+=V(d*.01,a),u+=V(u*.01,a);let f=e,g=o;for(;f<0;)f+=Math.PI*2,g+=Math.PI*2;g-f>Math.PI*2&&(f=0,g=Math.PI*2);const p=Math.PI*2/a.curveStepCount,m=Math.min(p/2,(g-f)/2),y=oo(m,c,h,d,u,f,g,1,a);if(!a.disableMultiStroke){const w=oo(m,c,h,d,u,f,g,1.5,a);y.push(...w)}return l&&(s?y.push(...re(c,h,c+d*Math.cos(f),h+u*Math.sin(f),a),...re(c,h,c+d*Math.cos(g),h+u*Math.sin(g),a)):y.push({op:"lineTo",data:[c,h]},{op:"lineTo",data:[c+d*Math.cos(f),h+u*Math.sin(f)]})),{type:"path",ops:y}}function no(i,t){const n=Fa(za(Ir(i))),r=[];let e=[0,0],o=[0,0];for(const{key:l,data:s}of n)switch(l){case"M":{o=[s[0],s[1]],e=[s[0],s[1]];break}case"L":r.push(...re(o[0],o[1],s[0],s[1],t)),o=[s[0],s[1]];break;case"C":{const[a,c,h,d,u,f]=s;r.push(...Fu(a,c,h,d,u,f,o,t)),o=[u,f];break}case"Z":r.push(...re(o[0],o[1],e[0],e[1],t)),o=[e[0],e[1]];break}return{type:"path",ops:r}}function ki(i,t){const n=[];for(const r of i)if(r.length){const e=t.maxRandomnessOffset||0,o=r.length;if(o>2){n.push({op:"move",data:[r[0][0]+V(e,t),r[0][1]+V(e,t)]});for(let l=1;l<o;l++)n.push({op:"lineTo",data:[r[l][0]+V(e,t),r[l][1]+V(e,t)]})}}return{type:"fillPath",ops:n}}function Me(i,t){return Cu(t,$u).fillPolygons(i,t)}function Ou(i,t,n,r,e,o,l){const s=i,a=t;let c=Math.abs(n/2),h=Math.abs(r/2);c+=V(c*.01,l),h+=V(h*.01,l);let d=e,u=o;for(;d<0;)d+=Math.PI*2,u+=Math.PI*2;u-d>Math.PI*2&&(d=0,u=Math.PI*2);const f=(u-d)/l.curveStepCount,g=[];for(let p=d;p<=u;p=p+f)g.push([s+c*Math.cos(p),a+h*Math.sin(p)]);return g.push([s+c*Math.cos(u),a+h*Math.sin(u)]),g.push([s,a]),Me([g],l)}function Bu(i,t){return V(i,t)}function Du(i,t,n){return Vn(i,t,n)}function zu(i,t,n,r,e){return re(i,t,n,r,e,!0)}function io(i){const t=Object.assign({},i);return t.randomizer=void 0,i.seed&&(t.seed=i.seed+1),t}function qa(i){return i.randomizer||(i.randomizer=new Au(i.seed||0)),i.randomizer.next()}function Vn(i,t,n,r=1){return n.roughness*r*(qa(n)*(t-i)+i)}function V(i,t,n=1){return Vn(-i,i,t,n)}function re(i,t,n,r,e,o=!1){const l=o?e.disableMultiStrokeFill:e.disableMultiStroke,s=Wi(i,t,n,r,e,!0,!1);if(l)return s;const a=Wi(i,t,n,r,e,!0,!0);return s.concat(a)}function Wi(i,t,n,r,e,o,l){const s=Math.pow(i-n,2)+Math.pow(t-r,2),a=Math.sqrt(s);let c=1;a<200?c=1:a>500?c=.4:c=-.0016668*a+1.233334;let h=e.maxRandomnessOffset||0;h*h*100>s&&(h=a/10);const d=h/2,u=.2+qa(e)*.2;let f=e.bowing*e.maxRandomnessOffset*(r-t)/200,g=e.bowing*e.maxRandomnessOffset*(i-n)/200;f=V(f,e,c),g=V(g,e,c);const p=[],m=()=>V(d,e,c),y=()=>V(h,e,c),w=e.preserveVertices;return l?p.push({op:"move",data:[i+(w?0:m()),t+(w?0:m())]}):p.push({op:"move",data:[i+(w?0:V(h,e,c)),t+(w?0:V(h,e,c))]}),l?p.push({op:"bcurveTo",data:[f+i+(n-i)*u+m(),g+t+(r-t)*u+m(),f+i+2*(n-i)*u+m(),g+t+2*(r-t)*u+m(),n+(w?0:m()),r+(w?0:m())]}):p.push({op:"bcurveTo",data:[f+i+(n-i)*u+y(),g+t+(r-t)*u+y(),f+i+2*(n-i)*u+y(),g+t+2*(r-t)*u+y(),n+(w?0:y()),r+(w?0:y())]}),p}function gn(i,t,n){if(!i.length)return[];const r=[];r.push([i[0][0]+V(t,n),i[0][1]+V(t,n)]),r.push([i[0][0]+V(t,n),i[0][1]+V(t,n)]);for(let e=1;e<i.length;e++)r.push([i[e][0]+V(t,n),i[e][1]+V(t,n)]),e===i.length-1&&r.push([i[e][0]+V(t,n),i[e][1]+V(t,n)]);return Qn(r,null,n)}function Qn(i,t,n){const r=i.length,e=[];if(r>3){const o=[],l=1-n.curveTightness;e.push({op:"move",data:[i[1][0],i[1][1]]});for(let s=1;s+2<r;s++){const a=i[s];o[0]=[a[0],a[1]],o[1]=[a[0]+(l*i[s+1][0]-l*i[s-1][0])/6,a[1]+(l*i[s+1][1]-l*i[s-1][1])/6],o[2]=[i[s+1][0]+(l*i[s][0]-l*i[s+2][0])/6,i[s+1][1]+(l*i[s][1]-l*i[s+2][1])/6],o[3]=[i[s+1][0],i[s+1][1]],e.push({op:"bcurveTo",data:[o[1][0],o[1][1],o[2][0],o[2][1],o[3][0],o[3][1]]})}}else r===3?(e.push({op:"move",data:[i[1][0],i[1][1]]}),e.push({op:"bcurveTo",data:[i[1][0],i[1][1],i[2][0],i[2][1],i[2][0],i[2][1]]})):r===2&&e.push(...Wi(i[0][0],i[0][1],i[1][0],i[1][1],n,!0,!0));return e}function ro(i,t,n,r,e,o,l,s){const a=s.roughness===0,c=[],h=[];if(a){i=i/4,h.push([t+r*Math.cos(-i),n+e*Math.sin(-i)]);for(let d=0;d<=Math.PI*2;d=d+i){const u=[t+r*Math.cos(d),n+e*Math.sin(d)];c.push(u),h.push(u)}h.push([t+r*Math.cos(0),n+e*Math.sin(0)]),h.push([t+r*Math.cos(i),n+e*Math.sin(i)])}else{const d=V(.5,s)-Math.PI/2;h.push([V(o,s)+t+.9*r*Math.cos(d-i),V(o,s)+n+.9*e*Math.sin(d-i)]);const u=Math.PI*2+d-.01;for(let f=d;f<u;f=f+i){const g=[V(o,s)+t+r*Math.cos(f),V(o,s)+n+e*Math.sin(f)];c.push(g),h.push(g)}h.push([V(o,s)+t+r*Math.cos(d+Math.PI*2+l*.5),V(o,s)+n+e*Math.sin(d+Math.PI*2+l*.5)]),h.push([V(o,s)+t+.98*r*Math.cos(d+l),V(o,s)+n+.98*e*Math.sin(d+l)]),h.push([V(o,s)+t+.9*r*Math.cos(d+l*.5),V(o,s)+n+.9*e*Math.sin(d+l*.5)])}return[h,c]}function oo(i,t,n,r,e,o,l,s,a){const c=o+V(.1,a),h=[];h.push([V(s,a)+t+.9*r*Math.cos(c-i),V(s,a)+n+.9*e*Math.sin(c-i)]);for(let d=c;d<=l;d=d+i)h.push([V(s,a)+t+r*Math.cos(d),V(s,a)+n+e*Math.sin(d)]);return h.push([t+r*Math.cos(l),n+e*Math.sin(l)]),h.push([t+r*Math.cos(l),n+e*Math.sin(l)]),Qn(h,null,a)}function Fu(i,t,n,r,e,o,l,s){const a=[],c=[s.maxRandomnessOffset||1,(s.maxRandomnessOffset||1)+.3];let h=[0,0];const d=s.disableMultiStroke?1:2,u=s.preserveVertices;for(let f=0;f<d;f++)f===0?a.push({op:"move",data:[l[0],l[1]]}):a.push({op:"move",data:[l[0]+(u?0:V(c[0],s)),l[1]+(u?0:V(c[0],s))]}),h=u?[e,o]:[e+V(c[f],s),o+V(c[f],s)],a.push({op:"bcurveTo",data:[i+V(c[f],s),t+V(c[f],s),n+V(c[f],s),r+V(c[f],s),h[0],h[1]]});return a}function Be(i){return[...i]}function so(i,t=0){const n=i.length;if(n<3)throw new Error("A curve must have at least three points.");const r=[];if(n===3)r.push(Be(i[0]),Be(i[1]),Be(i[2]),Be(i[2]));else{const e=[];e.push(i[0],i[0]);for(let s=1;s<i.length;s++)e.push(i[s]),s===i.length-1&&e.push(i[s]);const o=[],l=1-t;r.push(Be(e[0]));for(let s=1;s+2<e.length;s++){const a=e[s];o[0]=[a[0],a[1]],o[1]=[a[0]+(l*e[s+1][0]-l*e[s-1][0])/6,a[1]+(l*e[s+1][1]-l*e[s-1][1])/6],o[2]=[e[s+1][0]+(l*e[s][0]-l*e[s+2][0])/6,e[s+1][1]+(l*e[s][1]-l*e[s+2][1])/6],o[3]=[e[s+1][0],e[s+1][1]],r.push(o[1],o[2],o[3])}}return r}function Wu(i,t){return Math.sqrt(On(i,t))}function On(i,t){return Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)}function ju(i,t,n){const r=On(t,n);if(r===0)return On(i,t);let e=((i[0]-t[0])*(n[0]-t[0])+(i[1]-t[1])*(n[1]-t[1]))/r;return e=Math.max(0,Math.min(1,e)),On(i,le(t,n,e))}function le(i,t,n){return[i[0]+(t[0]-i[0])*n,i[1]+(t[1]-i[1])*n]}function Uu(i,t){const n=i[t+0],r=i[t+1],e=i[t+2],o=i[t+3];let l=3*r[0]-2*n[0]-o[0];l*=l;let s=3*r[1]-2*n[1]-o[1];s*=s;let a=3*e[0]-2*o[0]-n[0];a*=a;let c=3*e[1]-2*o[1]-n[1];return c*=c,l<a&&(l=a),s<c&&(s=c),l+s}function ji(i,t,n,r){const e=r||[];if(Uu(i,t)<n){const o=i[t+0];e.length?Wu(e[e.length-1],o)>1&&e.push(o):e.push(o),e.push(i[t+3])}else{const l=i[t+0],s=i[t+1],a=i[t+2],c=i[t+3],h=le(l,s,.5),d=le(s,a,.5),u=le(a,c,.5),f=le(h,d,.5),g=le(d,u,.5),p=le(f,g,.5);ji([l,h,f,p],0,n,e),ji([p,g,u,c],0,n,e)}return e}function qu(i,t){return Zn(i,0,i.length,t)}function Zn(i,t,n,r,e){const o=e||[],l=i[t],s=i[n-1];let a=0,c=1;for(let h=t+1;h<n-1;++h){const d=ju(i[h],l,s);d>a&&(a=d,c=h)}return Math.sqrt(a)>r?(Zn(i,t,c+1,r,o),Zn(i,c,n,r,o)):(o.length||o.push(l),o.push(s)),o}function Ui(i,t=.15,n){const r=[],e=(i.length-1)/3;for(let o=0;o<e;o++){const l=o*3;ji(i,l,t,r)}return n&&n>0?Zn(r,0,r.length,n):r}function Hu(i,t,n){const r=Ir(i),e=Fa(za(r)),o=[];let l=[],s=[0,0],a=[];const c=()=>{a.length>=4&&l.push(...Ui(a,t)),a=[]},h=()=>{c(),l.length&&(o.push(l),l=[])};for(const{key:u,data:f}of e)switch(u){case"M":h(),s=[f[0],f[1]],l.push(s);break;case"L":c(),l.push([f[0],f[1]]);break;case"C":if(!a.length){const g=l.length?l[l.length-1]:s;a.push([g[0],g[1]])}a.push([f[0],f[1]]),a.push([f[2],f[3]]),a.push([f[4],f[5]]);break;case"Z":c(),l.push([s[0],s[1]]);break}if(h(),!n)return o;const d=[];for(const u of o){const f=qu(u,n);f.length&&d.push(f)}return d}const Bt="none";class Jn{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return _u()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,n,r){return{shape:t,sets:n||[],options:r||this.defaultOptions}}line(t,n,r,e,o){const l=this._o(o);return this._d("line",[ja(t,n,r,e,l)],l)}rectangle(t,n,r,e,o){const l=this._o(o),s=[],a=Eu(t,n,r,e,l);if(l.fill){const c=[[t,n],[t+r,n],[t+r,n+e],[t,n+e]];l.fillStyle==="solid"?s.push(ki([c],l)):s.push(Me([c],l))}return l.stroke!==Bt&&s.push(a),this._d("rectangle",s,l)}ellipse(t,n,r,e,o){const l=this._o(o),s=[],a=Ua(r,e,l),c=Fi(t,n,l,a);if(l.fill)if(l.fillStyle==="solid"){const h=Fi(t,n,l,a).opset;h.type="fillPath",s.push(h)}else s.push(Me([c.estimatedPoints],l));return l.stroke!==Bt&&s.push(c.opset),this._d("ellipse",s,l)}circle(t,n,r,e){const o=this.ellipse(t,n,r,r,e);return o.shape="circle",o}linearPath(t,n){const r=this._o(n);return this._d("linearPath",[Nn(t,!1,r)],r)}arc(t,n,r,e,o,l,s=!1,a){const c=this._o(a),h=[],d=eo(t,n,r,e,o,l,s,!0,c);if(s&&c.fill)if(c.fillStyle==="solid"){const u=Object.assign({},c);u.disableMultiStroke=!0;const f=eo(t,n,r,e,o,l,!0,!1,u);f.type="fillPath",h.push(f)}else h.push(Ou(t,n,r,e,o,l,c));return c.stroke!==Bt&&h.push(d),this._d("arc",h,c)}curve(t,n){const r=this._o(n),e=[],o=to(t,r);if(r.fill&&r.fill!==Bt)if(r.fillStyle==="solid"){const l=to(t,Object.assign(Object.assign({},r),{disableMultiStroke:!0,roughness:r.roughness?r.roughness+r.fillShapeRoughnessGain:0}));e.push({type:"fillPath",ops:this._mergedShape(l.ops)})}else{const l=[],s=t;if(s.length){const c=typeof s[0][0]=="number"?[s]:s;for(const h of c)h.length<3?l.push(...h):h.length===3?l.push(...Ui(so([h[0],h[0],h[1],h[2]]),10,(1+r.roughness)/2)):l.push(...Ui(so(h),10,(1+r.roughness)/2))}l.length&&e.push(Me([l],r))}return r.stroke!==Bt&&e.push(o),this._d("curve",e,r)}polygon(t,n){const r=this._o(n),e=[],o=Nn(t,!0,r);return r.fill&&(r.fillStyle==="solid"?e.push(ki([t],r)):e.push(Me([t],r))),r.stroke!==Bt&&e.push(o),this._d("polygon",e,r)}path(t,n){const r=this._o(n),e=[];if(!t)return this._d("path",e,r);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const o=r.fill&&r.fill!=="transparent"&&r.fill!==Bt,l=r.stroke!==Bt,s=!!(r.simplification&&r.simplification<1),a=s?4-4*(r.simplification||1):(1+r.roughness)/2,c=Hu(t,1,a),h=no(t,r);if(o)if(r.fillStyle==="solid")if(c.length===1){const d=no(t,Object.assign(Object.assign({},r),{disableMultiStroke:!0,roughness:r.roughness?r.roughness+r.fillShapeRoughnessGain:0}));e.push({type:"fillPath",ops:this._mergedShape(d.ops)})}else e.push(ki(c,r));else e.push(Me(c,r));return l&&(s?c.forEach(d=>{e.push(Nn(d,!1,r))}):e.push(h)),this._d("path",e,r)}opsToPath(t,n){let r="";for(const e of t.ops){const o=typeof n=="number"&&n>=0?e.data.map(l=>+l.toFixed(n)):e.data;switch(e.op){case"move":r+=`M${o[0]} ${o[1]} `;break;case"bcurveTo":r+=`C${o[0]} ${o[1]}, ${o[2]} ${o[3]}, ${o[4]} ${o[5]} `;break;case"lineTo":r+=`L${o[0]} ${o[1]} `;break}}return r.trim()}toPaths(t){const n=t.sets||[],r=t.options||this.defaultOptions,e=[];for(const o of n){let l=null;switch(o.type){case"path":l={d:this.opsToPath(o),stroke:r.stroke,strokeWidth:r.strokeWidth,fill:Bt};break;case"fillPath":l={d:this.opsToPath(o),stroke:Bt,strokeWidth:0,fill:r.fill||Bt};break;case"fillSketch":l=this.fillSketch(o,r);break}l&&e.push(l)}return e}fillSketch(t,n){let r=n.fillWeight;return r<0&&(r=n.strokeWidth/2),{d:this.opsToPath(t),stroke:n.fill||Bt,strokeWidth:r,fill:Bt}}_mergedShape(t){return t.filter((n,r)=>r===0?!0:n.op!=="move")}}class Yu{constructor(t,n){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new Jn(n)}draw(t){const n=t.sets||[],r=t.options||this.getDefaultOptions(),e=this.ctx,o=t.options.fixedDecimalPlaceDigits;for(const l of n)switch(l.type){case"path":e.save(),e.strokeStyle=r.stroke==="none"?"transparent":r.stroke,e.lineWidth=r.strokeWidth,r.strokeLineDash&&e.setLineDash(r.strokeLineDash),r.strokeLineDashOffset&&(e.lineDashOffset=r.strokeLineDashOffset),this._drawToContext(e,l,o),e.restore();break;case"fillPath":{e.save(),e.fillStyle=r.fill||"";const s=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(e,l,o,s),e.restore();break}case"fillSketch":this.fillSketch(e,l,r);break}}fillSketch(t,n,r){let e=r.fillWeight;e<0&&(e=r.strokeWidth/2),t.save(),r.fillLineDash&&t.setLineDash(r.fillLineDash),r.fillLineDashOffset&&(t.lineDashOffset=r.fillLineDashOffset),t.strokeStyle=r.fill||"",t.lineWidth=e,this._drawToContext(t,n,r.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,n,r,e="nonzero"){t.beginPath();for(const o of n.ops){const l=typeof r=="number"&&r>=0?o.data.map(s=>+s.toFixed(r)):o.data;switch(o.op){case"move":t.moveTo(l[0],l[1]);break;case"bcurveTo":t.bezierCurveTo(l[0],l[1],l[2],l[3],l[4],l[5]);break;case"lineTo":t.lineTo(l[0],l[1]);break}}n.type==="fillPath"?t.fill(e):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,n,r,e,o){const l=this.gen.line(t,n,r,e,o);return this.draw(l),l}rectangle(t,n,r,e,o){const l=this.gen.rectangle(t,n,r,e,o);return this.draw(l),l}ellipse(t,n,r,e,o){const l=this.gen.ellipse(t,n,r,e,o);return this.draw(l),l}circle(t,n,r,e){const o=this.gen.circle(t,n,r,e);return this.draw(o),o}linearPath(t,n){const r=this.gen.linearPath(t,n);return this.draw(r),r}polygon(t,n){const r=this.gen.polygon(t,n);return this.draw(r),r}arc(t,n,r,e,o,l,s=!1,a){const c=this.gen.arc(t,n,r,e,o,l,s,a);return this.draw(c),c}curve(t,n){const r=this.gen.curve(t,n);return this.draw(r),r}path(t,n){const r=this.gen.path(t,n);return this.draw(r),r}}const yn="http://www.w3.org/2000/svg";class Xu{constructor(t,n){this.svg=t,this.gen=new Jn(n)}draw(t){const n=t.sets||[],r=t.options||this.getDefaultOptions(),e=this.svg.ownerDocument||window.document,o=e.createElementNS(yn,"g"),l=t.options.fixedDecimalPlaceDigits;for(const s of n){let a=null;switch(s.type){case"path":{a=e.createElementNS(yn,"path"),a.setAttribute("d",this.opsToPath(s,l)),a.setAttribute("stroke",r.stroke),a.setAttribute("stroke-width",r.strokeWidth+""),a.setAttribute("fill","none"),r.strokeLineDash&&a.setAttribute("stroke-dasharray",r.strokeLineDash.join(" ").trim()),r.strokeLineDashOffset&&a.setAttribute("stroke-dashoffset",`${r.strokeLineDashOffset}`);break}case"fillPath":{a=e.createElementNS(yn,"path"),a.setAttribute("d",this.opsToPath(s,l)),a.setAttribute("stroke","none"),a.setAttribute("stroke-width","0"),a.setAttribute("fill",r.fill||""),(t.shape==="curve"||t.shape==="polygon")&&a.setAttribute("fill-rule","evenodd");break}case"fillSketch":{a=this.fillSketch(e,s,r);break}}a&&o.appendChild(a)}return o}fillSketch(t,n,r){let e=r.fillWeight;e<0&&(e=r.strokeWidth/2);const o=t.createElementNS(yn,"path");return o.setAttribute("d",this.opsToPath(n,r.fixedDecimalPlaceDigits)),o.setAttribute("stroke",r.fill||""),o.setAttribute("stroke-width",e+""),o.setAttribute("fill","none"),r.fillLineDash&&o.setAttribute("stroke-dasharray",r.fillLineDash.join(" ").trim()),r.fillLineDashOffset&&o.setAttribute("stroke-dashoffset",`${r.fillLineDashOffset}`),o}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,n){return this.gen.opsToPath(t,n)}line(t,n,r,e,o){const l=this.gen.line(t,n,r,e,o);return this.draw(l)}rectangle(t,n,r,e,o){const l=this.gen.rectangle(t,n,r,e,o);return this.draw(l)}ellipse(t,n,r,e,o){const l=this.gen.ellipse(t,n,r,e,o);return this.draw(l)}circle(t,n,r,e){const o=this.gen.circle(t,n,r,e);return this.draw(o)}linearPath(t,n){const r=this.gen.linearPath(t,n);return this.draw(r)}polygon(t,n){const r=this.gen.polygon(t,n);return this.draw(r)}arc(t,n,r,e,o,l,s=!1,a){const c=this.gen.arc(t,n,r,e,o,l,s,a);return this.draw(c)}curve(t,n){const r=this.gen.curve(t,n);return this.draw(r)}path(t,n){const r=this.gen.path(t,n);return this.draw(r)}}const Ie={canvas(i,t){return new Yu(i,t)},svg(i,t){return new Xu(i,t)},generator(i){return new Jn(i)},newSeed(){return Jn.newSeed()}},Gu=async(i,t,n)=>{let r=b.elements;if(n){if(b.selection.length===0)return;r=r.filter(p=>b.selection.includes(p.id))}if(r.length===0)return;let e=1/0,o=1/0,l=-1/0,s=-1/0;r.forEach(p=>{e=Math.min(e,p.x),o=Math.min(o,p.y),l=Math.max(l,p.x+p.width),s=Math.max(s,p.y+p.height)});const a=20,c=l-e+a*2,h=s-o+a*2,d=document.createElement("canvas");d.width=c*i,d.height=h*i;const u=d.getContext("2d");if(!u)return;t&&(u.fillStyle="#ffffff",u.fillRect(0,0,d.width,d.height)),u.scale(i,i),u.translate(-e+a,-o+a);const f=Ie.canvas(d);r.forEach(p=>{te(f,u,p)});const g=document.createElement("a");g.download="yappy_drawing.png",g.href=d.toDataURL("image/png"),g.click()},Vu=i=>{let t=b.elements;if(i){if(b.selection.length===0)return;t=t.filter(y=>b.selection.includes(y.id))}if(t.length===0)return;let n=1/0,r=1/0,e=-1/0,o=-1/0;t.forEach(y=>{n=Math.min(n,y.x),r=Math.min(r,y.y),e=Math.max(e,y.x+y.width),o=Math.max(o,y.y+y.height)});const l=20,s=e-n+l*2,a=o-r+l*2,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",`${s}`),c.setAttribute("height",`${a}`),c.setAttribute("viewBox",`0 0 ${s} ${a}`),c.style.backgroundColor="#ffffff";const h=Ie.svg(c),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("transform",`translate(${-n+l}, ${-r+l})`),c.appendChild(d),t.forEach(y=>{let w=null;const v={seed:y.seed,roughness:y.roughness,stroke:y.strokeColor,strokeWidth:y.strokeWidth,fill:y.backgroundColor==="transparent"?void 0:y.backgroundColor,fillStyle:y.fillStyle,strokeLineDash:y.strokeStyle==="dashed"?[10,10]:y.strokeStyle==="dotted"?[5,10]:void 0};if(y.type==="rectangle")w=h.rectangle(y.x,y.y,y.width,y.height,v);else if(y.type==="circle")w=h.ellipse(y.x+y.width/2,y.y+y.height/2,Math.abs(y.width),Math.abs(y.height),v);else if(y.type==="line"||y.type==="arrow"){const x=y.x+y.width,k=y.y+y.height;if(y.type==="arrow"){const S=document.createElementNS("http://www.w3.org/2000/svg","g");S.appendChild(h.line(y.x,y.y,x,k,v));const M=Math.atan2(y.height,y.width),C=y.startArrowheadSize||15,R=y.endArrowheadSize||15;if(y.startArrowhead){const E={x:y.x-C*Math.cos(M+Math.PI-Math.PI/6),y:y.y-C*Math.sin(M+Math.PI-Math.PI/6)},O={x:y.x-C*Math.cos(M+Math.PI+Math.PI/6),y:y.y-C*Math.sin(M+Math.PI+Math.PI/6)};S.appendChild(h.line(y.x,y.y,E.x,E.y,v)),S.appendChild(h.line(y.x,y.y,O.x,O.y,v))}if(y.endArrowhead||!y.startArrowhead&&!y.endArrowhead){const E={x:x-R*Math.cos(M-Math.PI/6),y:k-R*Math.sin(M-Math.PI/6)},O={x:x-R*Math.cos(M+Math.PI/6),y:k-R*Math.sin(M+Math.PI/6)};S.appendChild(h.line(x,k,E.x,E.y,v)),S.appendChild(h.line(x,k,O.x,O.y,v))}w=S}else w=h.line(y.x,y.y,x,k,v)}else if(y.type==="text"&&y.text){const x=document.createElementNS("http://www.w3.org/2000/svg","text");x.textContent=y.text,x.setAttribute("x",`${y.x}`),x.setAttribute("y",`${y.y+(y.fontSize||28)}`),x.setAttribute("fill",y.strokeColor),x.setAttribute("font-family","sans-serif"),x.setAttribute("font-size",`${y.fontSize||28}px`),w=x}else if((y.type==="fineliner"||y.type==="inkbrush"||y.type==="marker")&&y.points){let x=[];if(y.pointsEncoding==="flat"){const k=y.points;for(let S=0;S<k.length;S+=2)x.push({x:k[S],y:k[S+1]})}else x=y.points;if(x.length>1){const k=x.map(S=>[y.x+S.x,y.y+S.y]);w=h.curve(k,v)}}else if(y.type==="image"&&y.dataURL){const x=document.createElementNS("http://www.w3.org/2000/svg","image");x.setAttribute("href",y.dataURL),x.setAttribute("x",`${y.x}`),x.setAttribute("y",`${y.y}`),x.setAttribute("width",`${y.width}`),x.setAttribute("height",`${y.height}`),w=x}if(w){if(w.setAttribute("opacity",`${(y.opacity??100)/100}`),y.angle){const x=y.x+y.width/2,k=y.y+y.height/2;w.setAttribute("transform",`rotate(${y.angle*(180/Math.PI)}, ${x}, ${k})`)}d.appendChild(w)}});const f=new XMLSerializer().serializeToString(c),g=new Blob([f],{type:"image/svg+xml"}),p=URL.createObjectURL(g),m=document.createElement("a");m.download="yappy_drawing.svg",m.href=p,m.click()},h2=async(i,t,n)=>{const r=b.elements;if(r.length===0)return;if(b.docType==="slides"&&b.slides.length>0&&!n){const o=[...b.slides].sort((d,u)=>d.order-u.order),l=o[0],{width:s,height:a}=l.dimensions,c=s>=a?"landscape":"portrait",h=new Fr({orientation:c,unit:"px",format:[s,a],hotfixes:["px_scaling"]});for(let d=0;d<o.length;d++){const u=o[d],{width:f,height:g}=u.dimensions,{x:p,y:m}=u.spatialPosition,y=r.filter(S=>{const M=S.x+S.width/2,C=S.y+S.height/2;return M>=p&&M<=p+f&&C>=m&&C<=m+g}),w=document.createElement("canvas");w.width=f*i,w.height=g*i;const v=w.getContext("2d");if(!v)continue;t&&(v.fillStyle=u.backgroundColor||"#ffffff",v.fillRect(0,0,w.width,w.height)),v.scale(i,i),v.translate(-p,-m);const x=Ie.canvas(w);if(y.forEach(S=>{te(x,v,S)}),d>0){const S=f>=g?"landscape":"portrait";h.addPage([f,g],S)}const k=w.toDataURL("image/jpeg",.92);h.addImage(k,"JPEG",0,0,f,g)}h.save("yappy_drawing.pdf")}else{let o=r;if(n){if(b.selection.length===0)return;o=o.filter(v=>b.selection.includes(v.id))}if(o.length===0)return;let l=1/0,s=1/0,a=-1/0,c=-1/0;o.forEach(v=>{l=Math.min(l,v.x),s=Math.min(s,v.y),a=Math.max(a,v.x+v.width),c=Math.max(c,v.y+v.height)});const h=20,d=a-l+h*2,u=c-s+h*2,f=document.createElement("canvas");f.width=d*i,f.height=u*i;const g=f.getContext("2d");if(!g)return;t&&(g.fillStyle="#ffffff",g.fillRect(0,0,f.width,f.height)),g.scale(i,i),g.translate(-l+h,-s+h);const p=Ie.canvas(f);o.forEach(v=>{te(p,g,v)});const m=d>=u?"landscape":"portrait",y=new Fr({orientation:m,unit:"px",format:[d,u],hotfixes:["px_scaling"]}),w=f.toDataURL("image/jpeg",.92);y.addImage(w,"JPEG",0,0,d,u),y.save("yappy_drawing.pdf")}},d2=async(i,t,n)=>{const r=b.elements;if(r.length===0)return;const e=new vc;if(b.docType==="slides"&&b.slides.length>0&&!n){const l=[...b.slides].sort((h,d)=>h.order-d.order),s=l[0],a=10,c=10*(s.dimensions.height/s.dimensions.width);e.defineLayout({name:"CUSTOM",width:a,height:c}),e.layout="CUSTOM";for(const h of l){const{width:d,height:u}=h.dimensions,{x:f,y:g}=h.spatialPosition,p=r.filter(S=>{const M=S.x+S.width/2,C=S.y+S.height/2;return M>=f&&M<=f+d&&C>=g&&C<=g+u}),m=document.createElement("canvas");m.width=d*i,m.height=u*i;const y=m.getContext("2d");if(!y)continue;t&&(y.fillStyle=h.backgroundColor||"#ffffff",y.fillRect(0,0,m.width,m.height)),y.scale(i,i),y.translate(-f,-g);const w=Ie.canvas(m);p.forEach(S=>{te(w,y,S)});const v=10,x=10*(u/d);e.addSlide().addImage({data:m.toDataURL("image/png"),x:0,y:0,w:v,h:x})}}else{let l=r;if(n){if(b.selection.length===0)return;l=l.filter(x=>b.selection.includes(x.id))}if(l.length===0)return;let s=1/0,a=1/0,c=-1/0,h=-1/0;l.forEach(x=>{s=Math.min(s,x.x),a=Math.min(a,x.y),c=Math.max(c,x.x+x.width),h=Math.max(h,x.y+x.height)});const d=20,u=c-s+d*2,f=h-a+d*2,g=document.createElement("canvas");g.width=u*i,g.height=f*i;const p=g.getContext("2d");if(!p)return;t&&(p.fillStyle="#ffffff",p.fillRect(0,0,g.width,g.height)),p.scale(i,i),p.translate(-s+d,-a+d);const m=Ie.canvas(g);l.forEach(x=>{te(m,p,x)});const y=10,w=10*(f/u);e.defineLayout({name:"CUSTOM",width:y,height:w}),e.layout="CUSTOM",e.addSlide().addImage({data:g.toDataURL("image/png"),x:0,y:0,w:y,h:w})}await e.writeFile({fileName:"yappy_drawing.pptx"})};function Qu(i){const t=b.selection.length,n=t>0,r=[];if(n){r.push({label:"Copy",shortcut:"Ctrl+C",onClick:li},{label:"Paste",shortcut:"Ctrl+V",onClick:Gn},{label:"Cut",shortcut:"Ctrl+X",onClick:_r},{label:"Duplicate",shortcut:"Ctrl+D",onClick:()=>b.selection.forEach(d=>va(d))},{separator:!0});const e=b.selection[0],o=b.elements.find(d=>d.id===e);if(o){const d=[];if(t===1&&(d.push({label:"Add Child",onClick:()=>ar(e)}),o.parentId&&d.push({label:"Add Sibling",onClick:()=>lr(e)}),d.push({separator:!0})),o.parentId&&d.push({label:"Clear Parent",onClick:()=>qh(e)}),b.elements.some(g=>g.parentId===e)&&d.push({label:o.isCollapsed?"Expand Subtree":"Collapse Subtree",onClick:()=>Sr(e)}),t===2){const g=b.selection[0],p=b.selection[1];d.push({label:"Set as Child of Selected",onClick:()=>Aa(g,p)})}const f=[{label:"Horizontal (Right)",icon:"",onClick:()=>Se(e,"horizontal-right")},{label:"Horizontal (Left)",icon:"",onClick:()=>Se(e,"horizontal-left")},{label:"Vertical (Down)",icon:"",onClick:()=>Se(e,"vertical-down")},{label:"Vertical (Up)",icon:"",onClick:()=>Se(e,"vertical-up")},{label:"Radial (Neuron)",icon:"",onClick:()=>Se(e,"radial")}];d.push({separator:!0}),d.push({label:"Auto Layout",submenu:f,icon:""}),d.push({label:"Auto Style Branch",icon:"",onClick:()=>Ta(e)}),d.length>0&&r.push({label:"Hierarchy",submenu:d})}const l=b.selection.map(d=>b.elements.find(u=>u.id===d)).filter(Boolean),s=l.filter(d=>{const u=d.type;return u!=="line"&&u!=="arrow"&&u!=="bezier"&&u!=="organicBranch"&&u!=="text"&&u!=="image"}),a=l.filter(d=>{const u=d.type;return u==="line"||u==="arrow"||u==="bezier"||u==="organicBranch"});if(s.length>0){let d=Zr(s[0].type);new Set(s.map(f=>f.type)).size>1&&d.push(s[0].type),d.length>0&&r.push({label:s.length>1?`Transform ${s.length} Shapes`:"Transform Shape",submenu:d.map(f=>({icon:Jr(f),tooltip:Kr(f),onClick:()=>{Q(),s.forEach(g=>Qr(g.id,f,!1)),requestAnimationFrame(i)}})),gridColumns:3})}if(a.length>0){let d=Zr(a[0].type);new Set(a.map(f=>f.type)).size>1&&d.push(a[0].type),d.length>0&&r.push({label:a.length>1?`Transform ${a.length} Connectors`:"Transform Connector",submenu:d.map(f=>({icon:Jr(f),tooltip:Kr(f),onClick:()=>{Q(),a.forEach(g=>Qr(g.id,f,!1)),requestAnimationFrame(i)}})),gridColumns:3})}if(a.length>0){const u=a[0].curveType||"straight",f=pu(u);new Set(a.map(p=>p.curveType||"straight")).size>1&&f.push(u),f.length>0&&r.push({label:a.length>1?"Change All Curve Styles":"Change Curve Style",submenu:f.map(p=>({icon:gu(p),tooltip:yu(p),onClick:()=>{Q(),a.forEach(m=>D(m.id,{curveType:p},!1)),requestAnimationFrame(i)}})),gridColumns:3})}r.push({separator:!0}),t>1&&r.push({label:"Group",shortcut:"Ctrl+G",onClick:pr}),b.selection.some(d=>{const u=b.elements.find(f=>f.id===d);return u?.groupIds&&u.groupIds.length>0})&&r.push({label:"Ungroup",shortcut:"Ctrl+Shift+G",onClick:gr}),r.push({separator:!0}),r.push({label:"Export as PNG",onClick:()=>Gu(2,!0,!0)},{label:"Export as SVG",onClick:()=>Vu(!0)}),r.push({separator:!0}),r.push({label:"Bring to Front",shortcut:"Ctrl+]",onClick:()=>cr(b.selection)},{label:"Send to Back",shortcut:"Ctrl+[",onClick:()=>hr(b.selection)},{label:"Bring Forward",onClick:()=>b.selection.forEach(d=>Ii(d,"forward"))},{label:"Send Backward",onClick:()=>b.selection.forEach(d=>Ii(d,"backward"))},{separator:!0}),t===1&&r.push({label:"Copy Styles",shortcut:"Ctrl+Alt+C",onClick:Ar},{label:"Paste Styles",shortcut:"Ctrl+Alt+V",onClick:Tr},{separator:!0});const h=b.selection.some(d=>b.elements.find(u=>u.id===d)?.locked);r.push({label:h?"Unlock":"Lock",shortcut:"Ctrl+Shift+L",onClick:()=>fu(!h)},{label:"Flip Horizontal",shortcut:"Shift+H",onClick:()=>Vr("horizontal")},{label:"Flip Vertical",shortcut:"Shift+V",onClick:()=>Vr("vertical")},{separator:!0},{label:"Delete",shortcut:"Delete",onClick:()=>oe(b.selection)},{separator:!0},{label:"Show Properties",onClick:()=>_e(!0)})}else r.push({label:"Paste",shortcut:"Ctrl+V",onClick:Gn},{separator:!0},{label:"Select all",shortcut:"Ctrl+A",onClick:()=>P("selection",b.elements.map(e=>e.id))},{label:"Zoom to Fit",shortcut:"Shift+1",onClick:b.docType==="slides"?ie:yr},{separator:!0},{label:"Show Grid",checked:b.gridSettings.enabled,onClick:wr},{label:"Snap to Grid",checked:b.gridSettings.snapToGrid,onClick:vr},{label:"Smart Snapping",checked:b.gridSettings.objectSnapping,onClick:()=>P("gridSettings","objectSnapping",!b.gridSettings.objectSnapping)},{separator:!0},{label:"Zen Mode",shortcut:"Alt+Z",checked:b.zenMode,onClick:xr},{label:"Reset View",onClick:()=>St({scale:1,panX:0,panY:0})},{separator:!0},{label:"Canvas Settings",onClick:()=>fa(!0)});return r}var Zu=$('<div class=path-editor-overlay style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none><svg style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999><path fill=none stroke=#3b82f6 stroke-width=2 stroke-dasharray="5 5"></path></svg><div style=position:absolute;top:0;left:0;width:100%;height:100%;z-index:998;pointer-events:all;cursor:crosshair></div><button style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:2000;background:#3b82f6;color:white;padding:8px 16px;border-radius:20px;border:none;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;pointer-events:all">Done Editing Path'),Ju=$('<div class=path-control-point style="position:absolute;transform:translate(-50%, -50%);width:10px;height:10px;border:2px solid #3b82f6;border-radius:50%;pointer-events:all;cursor:move;z-index:1000">');const Ku=i=>{const t=pi(()=>b.elements.find(e=>e.id===i.elementId)),n=pi(()=>{const e=t();if(!e||!i.animationId)return[];const o=e.animations?.find(l=>l.id===i.animationId);return!o||o.type!=="path"?[]:ue.svgToPoints(o.pathData)}),r=pi(()=>{const e=t();if(!e)return`translate(${i.panX}, ${i.panY}) scale(${i.scale})`;const l=e.animations?.find(c=>c.id===i.animationId)?.isRelative??!0,s=l?e.x+e.width/2:0,a=l?e.y+e.height/2:0;return`translate(${i.panX}, ${i.panY}) scale(${i.scale}) translate(${s}, ${a})`});return _(q,{get when(){return $e(()=>!!t())()&&n().length>0},get children(){var e=Zu(),o=e.firstChild,l=o.firstChild,s=o.nextSibling,a=s.nextSibling;return I(e,_(zt,{get each(){return n()},children:(c,h)=>{const d=t(),f=(d.animations?.find(w=>w.id===i.animationId)).isRelative??!0;let g=c.x,p=c.y;if(f){const w=d.x+d.width/2,v=d.y+d.height/2;g=w+c.x,p=v+c.y}const m=g*i.scale+i.panX,y=p*i.scale+i.panY;return(()=>{var w=Ju();return w.$$pointerdown=v=>{v.stopPropagation(),v.currentTarget.setPointerCapture(v.pointerId);const x=v.clientX,k=v.clientY,S={...c},M=R=>{const E=(R.clientX-x)/i.scale,O=(R.clientY-k)/i.scale,z=[...n()];z[h()]={...z[h()],x:S.x+E,y:S.y+O};const F=ue.pointsToSvg(z);Hr(i.elementId,i.animationId,{pathData:F})},C=R=>{v.currentTarget.releasePointerCapture(R.pointerId),window.removeEventListener("pointermove",M),window.removeEventListener("pointerup",C),Q()};window.addEventListener("pointermove",M),window.addEventListener("pointerup",C)},ot(w,"left",`${m}px`),ot(w,"top",`${y}px`),N(v=>{var x=c.type==="anchor"?"#3b82f6":"#ffffff",k=`Point ${h()}: ${c.type}`;return x!==v.e&&ot(w,"background",v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})()}}),o),s.$$pointerdown=c=>{c.stopPropagation();const h=t(),u=(h.animations?.find(v=>v.id===i.animationId)).isRelative??!0,f=(c.clientX-i.panX)/i.scale,g=(c.clientY-i.panY)/i.scale;let p=f,m=g;if(u){const v=h.x+h.width/2,x=h.y+h.height/2;p=f-v,m=g-x}const y=[...n()];y.push({x:p,y:m,type:"anchor"});const w=ue.pointsToSvg(y);Hr(i.elementId,i.animationId,{pathData:w})},a.$$click=()=>ih(!1),N(c=>{var h=t()?.animations?.find(u=>u.id===i.animationId)?.pathData||"",d=r();return h!==c.e&&L(l,"d",c.e=h),d!==c.t&&L(l,"transform",c.t=d),c},{e:void 0,t:void 0}),e}})};ht(["pointerdown","click"]);const hi=i=>{const t=i.fontSize||28,n=i.fontFamily==="sans-serif"?"Inter, sans-serif":i.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",r=i.fontWeight?typeof i.fontWeight=="string"?i.fontWeight+" ":"bold ":"";return`${i.fontStyle?typeof i.fontStyle=="string"?i.fontStyle+" ":"italic ":""}${r}${t}px ${n}`};let Si=null;const tf=()=>(Si||(Si=document.createElement("canvas").getContext("2d")),Si),ef=(i,t,n)=>{const r=t.split(/\s+/),e=[];let o="";for(const l of r){if(!l)continue;const s=o?`${o} ${l}`:l;i.measureText(s).width>n&&o?(e.push(o),o=l):o=s}return o&&e.push(o),e},Dt=(i,t,n,r)=>{const e=t.fontSize||28;i.save(),i.font=hi(t);let o=r;t.type==="circle"||t.type==="diamond"?o=r*.707:t.type==="doubleBanner"?o=r*.65:t.type==="lightbulb"?o=r*.7:t.type==="signpost"?o=r*.8:t.type==="burstBlob"&&(o=r*.6);const l=n.split(`
`),s=[];l.forEach(h=>{if(h==="")s.push("");else{const d=ef(i,h,o);s.push(...d)}});const a=e*1.2;let c=0;return s.forEach(h=>{c=Math.max(c,i.measureText(h).width)}),i.restore(),{textWidth:c,textHeight:s.length*a,lines:s,lineHeight:a}},Ha=(i,t,n)=>{if(!n||n.trim()==="")return{width:t.width||100,height:t.height||60};const r=32,e=t.fontSize||28,o=n.length,l=Math.sqrt(o*e*e*1.5);let s=Math.max(60,Math.min(500,l)),a=Dt(i,t,n,s);const c=t.type==="circle"||t.type==="diamond"?.707:t.type==="doubleBanner"?.65:t.type==="lightbulb"?.7:t.type==="signpost"?.8:t.type==="burstBlob"?.6:1;let h=a.textWidth/c+r,d=a.textHeight/c+r;if(t.type==="circle"||t.type==="diamond"){const u=Math.max(h,d);return{width:u,height:u}}return(t.type==="parallelogram"||t.type==="trapezoid")&&(h+=40),{width:h,height:d}};function nf(i){const t=i.editingId();if(!t)return;const n=b.elements.find(e=>e.id===t);if(!n)return;const r=i.editText().trim();if(n.type==="text")if(r){let e=0,o=0;if(i.canvasRef){const l=i.canvasRef.getContext("2d");if(l){const s=n.fontSize||28;l.font=`${s}px sans-serif`,e=l.measureText(r).width,o=s}}e=Math.max(e,10),o=Math.max(o,10),D(t,{text:r,width:e,height:o},!0)}else oe([t]);else{const e=n.type==="line"||n.type==="arrow"||n.type==="organicBranch",o=i.editingProperty();if(n.autoResize&&i.canvasRef&&!e&&o==="containerText"){const l=i.canvasRef.getContext("2d");if(l){const s=Ha(l,n,r);D(t,{[o]:r,width:s.width,height:s.height},!0)}else D(t,{[o]:r},!0)}else D(t,{[o]:r},!0)}i.setEditingId(null),i.setEditText(""),requestAnimationFrame(i.redrawFn)}function rf(i,t){if(i.preventDefault(),b.selectedTool!=="selection")return;const{x:n,y:r}=t.getWorldCoordinates(i.clientX,i.clientY),e=10/b.viewState.scale,o=new Map;for(const l of b.elements)o.set(l.id,l);for(let l=b.elements.length-1;l>=0;l--){const s=b.elements[l];if(t.canInteractWithElement(s)&&Vt(s.layerId)&&en(t.applyMasterProjection(s),n,r,e,b.elements,o)){if(["star","burst","speechBubble","isometricCube","solidBlock","perspectiveBlock"].includes(s.type)){const c=Cr(n,r,b.elements,b.selection,b.viewState.scale);if(c&&c.handle.startsWith("control-"))return}if(s.type==="line"||s.type==="arrow"||s.type==="bezier"){const c=s.controlPoints?[...s.controlPoints]:[];if(c.length>=2)return;c.push({x:n,y:r}),D(s.id,{controlPoints:c,curveType:"bezier"},!0);return}if(["rectangle","circle","diamond","line","arrow","text","triangle","hexagon","octagon","parallelogram","polygon","star","cloud","heart","cross","checkmark","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","starPerson","scroll","wavyDivider","doubleBanner","lightbulb","signpost","burstBlob","browserWindow","mobilePhone","ghostButton","inputField","trophy","clock","gear","target","rocket","flag","dfdProcess","dfdDataStore","isometricCube","solidBlock","perspectiveBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","umlClass","umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface","key","magnifyingGlass","book","megaphone","eye","thoughtBubble","stickFigure","sittingPerson","presentingPerson","handPointRight","thumbsUp","faceHappy","faceSad","faceConfused","checkbox","checkboxChecked","numberedBadge","questionMark","exclamationMark","tag","pin","stamp","kubernetes","container","apiGateway","cdn","storageBlob","eventBus","microservice","shield","barChart","pieChart","trendUp","trendDown","funnel","gauge","table","puzzlePiece","chainLink","bridge","magnet","scale","seedling","tree","mountain"].includes(s.type)){if(t.setEditingId(s.id),s.type==="umlClass"){const c=r-s.y,h=t.canvasRef?.getContext("2d");let d=30;if(s.containerText&&h){const f=Dt(h,s,s.containerText,s.width-10);d=Math.max(30,f.textHeight+20)}let u=20;if(s.attributesText&&h){const f=Dt(h,{...s,fontSize:(s.fontSize||28)*.9},s.attributesText,s.width-10);u=Math.max(20,f.textHeight+10)}c<d?(t.setEditingProperty("containerText"),t.setEditText(s.containerText||"")):c<d+u?(t.setEditingProperty("attributesText"),t.setEditText(s.attributesText||"")):(t.setEditingProperty("methodsText"),t.setEditText(s.methodsText||""))}else if(s.type==="umlState"){const c=r-s.y,h=t.canvasRef?.getContext("2d");let d=35;if(s.containerText&&h){const u=Dt(h,s,s.containerText,s.width-20);d=Math.max(35,u.textHeight+15)}c<d?(t.setEditingProperty("containerText"),t.setEditText(s.containerText||"")):(t.setEditingProperty("attributesText"),t.setEditText(s.attributesText||""))}else if(s.type==="umlFragment"){const c=r-s.y,h=n-s.x,d=Math.min(s.width*.3,60),u=Math.min(s.height*.12,22)+5;h<d&&c<u?(t.setEditingProperty("containerText"),t.setEditText(s.containerText||"")):(t.setEditingProperty("attributesText"),t.setEditText(s.attributesText||""))}else s.type==="text"?(t.setEditingProperty("text"),t.setEditText(s.text||"")):(t.setEditingProperty("containerText"),t.setEditText(s.containerText||""));setTimeout(()=>{t.textInputRef?.focus(),t.textInputRef?.select()},0);return}break}}}function of(i){i.dataTransfer&&(i.preventDefault(),i.dataTransfer.dropEffect="copy")}async function sf(i,t){i.preventDefault(),i.stopPropagation();const n=i.dataTransfer?.getData("text/plain");if(!n)return;const r=n.startsWith("color(")||n.startsWith("#")||n.startsWith("rgba(")||n.startsWith("rgb(")||n.startsWith("oklch(")||n.startsWith("hsl(")||n.includes("display-p3")||n.includes("oklch"),e=n.startsWith("http")||n.startsWith("data:image");if(!r&&!e)return;const{x:o,y:l}=t.getWorldCoordinates(i.clientX,i.clientY),s=10/b.viewState.scale,a=new Map;for(const g of b.elements)a.set(g.id,g);const c=b.elements.map((g,p)=>{const m=b.layers.find(y=>y.id===g.layerId);return{el:g,index:p,layerOrder:m?.order??999,layerVisible:Vt(g.layerId)}}).sort((g,p)=>g.layerOrder!==p.layerOrder?p.layerOrder-g.layerOrder:p.index-g.index),h=window.yappyGlobalTime||0,d=b.appMode==="presentation"||b.isPreviewing,u=Mr(b.elements,h,d);let f=null;for(const{el:g,layerVisible:p}of c){if(!p||!t.canInteractWithElement(g))continue;const m=u.get(g.id),y=t.applyMasterProjection(m?{...g,x:m.x,y:m.y,angle:m.angle}:g);if(en(y,o,l,s,b.elements,a)){f=g.id;break}}if(f)Q(),r?D(f,{backgroundColor:n,fillStyle:"solid"}):e&&D(f,{type:"image",dataURL:n});else if(b.docType==="slides"){const g=b.activeSlideIndex;g!==-1?(Q(),r?ce(g,{backgroundColor:n,fillStyle:"solid"}):e&&ce(g,{backgroundImage:n,fillStyle:"image"})):b.slides.length>0&&(Q(),r?ce(0,{backgroundColor:n,fillStyle:"solid"}):e&&ce(0,{backgroundImage:n,fillStyle:"image"}))}}function af(i){if(b.appMode==="presentation"&&b.docType==="slides")return;i.preventDefault();const t=i.deltaMode===1?33:i.deltaMode===2?400:1,n=i.deltaX*t,r=i.deltaY*t;if(i.ctrlKey||i.metaKey){const o=1-r*.001,l=Math.min(Math.max(b.viewState.scale*o,.1),10),s=i.clientX,a=i.clientY,{scale:c,panX:h,panY:d}=b.viewState,u=(s-h)/c,f=(a-d)/c,g=s-u*l,p=a-f*l;St({scale:l,panX:g,panY:p})}else i.shiftKey?St({panX:b.viewState.panX-(r||n),panY:b.viewState.panY}):St({panX:b.viewState.panX-n,panY:b.viewState.panY-r})}class lf{frameCount=0;lastReportTime=0;slowFrames=0;totalDrawTime=0;enabled;constructor(t=!0){this.enabled=t,this.lastReportTime=performance.now()}measureFrame(t,n,r){if(!this.enabled)return;this.frameCount++,this.totalDrawTime+=t,t>16.67&&this.slowFrames++;const e=performance.now();if(e-this.lastReportTime>=1e3){const o=e-this.lastReportTime,l=this.frameCount/o*1e3,s=this.totalDrawTime/this.frameCount,a=r!==void 0?` | ${r} visible`:"";console.log(`[Perf] ${l.toFixed(1)} FPS | ${s.toFixed(2)}ms avg | ${n} elements${a} | ${this.slowFrames} slow frames`),this.frameCount=0,this.slowFrames=0,this.totalDrawTime=0,this.lastReportTime=e}}setEnabled(t){this.enabled=t}}const cf=new lf(!1);var hf=$("<div class=recording-overlay><div class=recording-indicator><div class=pulse-dot></div><span class=recording-text>REC</span></div><div class=recording-timer></div><button class=stop-btn><span>Stop");const df=i=>{const[t,n]=H(0);ye(()=>{const e=setInterval(()=>{n(o=>o+1)},1e3);mt(()=>clearInterval(e))});const r=e=>{const o=Math.floor(e/60),l=e%60;return`${o}:${l.toString().padStart(2,"0")}`};return(()=>{var e=hf(),o=e.firstChild,l=o.nextSibling,s=l.nextSibling,a=s.firstChild;return I(l,()=>r(t())),kt(s,"click",i.onStop,!0),I(s,_(Kn,{size:16,fill:"white",strokeWidth:0}),a),e})()};ht(["click"]);class uf{mediaRecorder=null;chunks=[];stream=null;canvas;onStopCallback=null;constructor(t){this.canvas=t}start(t="webm"){try{this.stream=this.canvas.captureStream(60);let n="video/webm;codecs=vp9";return t==="mp4"&&(MediaRecorder.isTypeSupported("video/mp4")?n="video/mp4":MediaRecorder.isTypeSupported("video/webm;codecs=h264")&&(n="video/webm;codecs=h264")),MediaRecorder.isTypeSupported(n)||(console.warn(`Mime type ${n} not supported, falling back to default.`),n=""),this.mediaRecorder=new MediaRecorder(this.stream,n?{mimeType:n}:void 0),this.chunks=[],this.mediaRecorder.ondataavailable=r=>{r.data.size>0&&this.chunks.push(r.data)},this.mediaRecorder.onstop=()=>{this.saveFile(),this.onStopCallback&&this.onStopCallback(),this.cleanup()},this.mediaRecorder.start(),!0}catch(n){return console.error("Failed to start recording:",n),!1}}stop(t){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.onStopCallback=t||null,this.mediaRecorder.stop())}saveFile(){if(this.chunks.length===0)return;const t=new Blob(this.chunks,{type:this.mediaRecorder?.mimeType||"video/webm"}),n=URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=n;const e=t.type.includes("mp4")?"mp4":"webm",o=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);r.download=`yappy-recording-${o}.${e}`,document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),window.URL.revokeObjectURL(n)},100)}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.chunks=[]}}const[ff,pf]=H(null);function gf(i){let t=null;ct(()=>{const l=ff();l&&l.start&&(e(l.format||"webm"),pf(null))});const n=()=>{if(!i())return;const s=b.slides[b.activeSlideIndex];if(!s)return;const{width:a,height:c}=s.dimensions,{x:h,y:d}=s.spatialPosition;if(a===0||c===0)return;const u=document.createElement("canvas"),f=320,g=f*c/a;u.width=f,u.height=g;const p=u.getContext("2d");if(!p)return;const m=f/a;p.save(),p.scale(m,m),p.translate(-h,-d);const y=b.theme==="dark",w=Ue.canvas(u);Ba(p,w,s,h,d,a,c,y),[...b.layers].sort((k,S)=>k.order-S.order).forEach(k=>{if(!Vt(k.id))return;b.elements.filter(M=>M.layerId===k.id).forEach(M=>{let C=M;if(k.isMaster&&s){const E=or(M,s,b.slides);C={...M,x:E.x,y:E.y}}const R=k?.opacity??1;te(w,p,C,y,R)})}),p.restore();const x=u.toDataURL("image/jpeg",.6);rh(b.activeSlideIndex,x)};let r;ct(()=>{b.activeSlideIndex,b.elements,window.clearTimeout(r),r=window.setTimeout(()=>{In(()=>n())},1e3)});const e=l=>{const s=i();if(!s){console.error("[DEBUG] Canvas: No canvasRef available");return}t||(console.log("[DEBUG] Canvas: Initializing VideoRecorder"),t=new uf(s)),console.log("[DEBUG] Canvas: Starting recorder...");const a=t.start(l);console.log("[DEBUG] Canvas: Recorder start returned:",a),a?(P("isRecording",!0),nt("Recording started...","info")):nt("Failed to start recording","error")};return{handleStopRecording:()=>{t&&t.stop(()=>{P("isRecording",!1),nt("Recording saved!","success")})}}}var yf=$('<div style=position:fixed;bottom:30px;left:50%;transform:translateX(-50%);z-index:100><button style="background-color:white;border:1px solid #e5e7eb;padding:8px 16px;border-radius:9999px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);cursor:pointer;color:#3b82f6;font-weight:500;font-size:14px;transition:all 0.2s">Scroll back to content');const mf=i=>{const[t,n]=H(!1);ct(()=>{const{scale:e,panX:o,panY:l}=b.viewState;if(!i.canvasRef){n(!1);return}const s=-o/e,a=-l/e,c=i.canvasRef.width/e,h=i.canvasRef.height/e;let d,u,f,g;if(b.docType==="slides"){const m=b.slides[b.activeSlideIndex];if(!m){n(!1);return}d=m.spatialPosition.x,u=m.spatialPosition.y,f=d+m.dimensions.width,g=u+m.dimensions.height}else{if(b.elements.length===0){n(!1);return}d=1/0,u=1/0,f=-1/0,g=-1/0,b.elements.forEach(m=>{const y=m.x,w=m.x+m.width,v=m.y,x=m.y+m.height;d=Math.min(d,y,w),f=Math.max(f,y,w),u=Math.min(u,v,x),g=Math.max(g,v,x)})}const p=!(d>s+c||f<s||u>a+h||g<a);n(!p)});const r=()=>{if(b.docType==="slides"){ie();return}if(b.elements.length===0)return;let e=1/0,o=1/0,l=-1/0,s=-1/0;b.elements.forEach(y=>{const w=y.x,v=y.x+y.width,x=y.y,k=y.y+y.height;e=Math.min(e,w,v),l=Math.max(l,w,v),o=Math.min(o,x,k),s=Math.max(s,x,k)});const a=l-e,c=s-o,h=e+a/2,d=o+c/2,{scale:u}=b.viewState,f=window.innerWidth/2,g=window.innerHeight/2,p=-h*u+f,m=-d*u+g;St({panX:p,panY:m})};return _(q,{get when(){return t()},get children(){var e=yf(),o=e.firstChild;return o.$$click=r,e}})};ht(["click"]);var bf=$('<textarea style="position:absolute;transform:translate(-50%, -50%);box-sizing:border-box;background:transparent;border:1px dashed #007acc;outline:none;margin:0;padding:4px;resize:none;overflow:hidden;min-height:1em">');const wf=i=>{let t;const n=()=>{const e=i.editingId();return e?b.elements.find(o=>o.id===e):null},r=()=>{i.editingId()&&i.onCommitText()};return ct(()=>{i.editingId()&&t&&(t.style.height="auto",t.style.height=t.scrollHeight+"px")}),_(q,{get when(){return $e(()=>!!i.editingId())()&&n()},children:e=>{const o=n(),l=ha(o.id),s=l?l.x:o.x,a=l?l.y:o.y,c=l?l.width:o.width,h=l?l.height:o.height,{scale:d,panX:u,panY:f}=b.viewState;let g=(s+c/2)*d+u,p=(a+h/2)*d+f,m="center",y=o.fontSize||28,w=c*d;if(o.type==="umlClass"){const S=i.editingProperty();if(S==="attributesText"||S==="methodsText"){m="left",y=y*.9;const M=i.canvasRef?i.canvasRef.getContext("2d"):null;let C=30;if(o.containerText&&M){const O=Dt(M,o,o.containerText,o.width-10);C=Math.max(30,O.textHeight+20)}let R=C,E=20;if(o.attributesText&&M){const O=Dt(M,{...o,fontSize:y},o.attributesText,o.width-10);E=Math.max(20,O.textHeight+10)}if(S==="attributesText")p=(a+R+E/2)*d+f,g=(s+c/2)*d+u;else if(S==="methodsText"){const O=R+E;p=(a+O+20)*d+f,g=(s+c/2)*d+u}}}const v=o.fontFamily==="sans-serif"?"Inter, sans-serif":o.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",x=o.fontWeight||"normal",k=o.fontStyle||"normal";return(()=>{var S=bf();return S.$$keydown=M=>{M.key==="Escape"&&(M.preventDefault(),i.setEditingId(null),i.setEditText(""))},S.addEventListener("blur",r),S.$$input=M=>i.setEditText(M.currentTarget.value),tt(M=>{t=M,i.onTextInputRef(M)},S),ot(S,"top",`${p}px`),ot(S,"left",`${g}px`),ot(S,"font",`${k} ${x} ${y*d}px ${v}`),ot(S,"text-align",m),N(M=>{var C=`${Math.max(50,w)}px`,R=o.strokeColor;return C!==M.e&&ot(S,"width",M.e=C),R!==M.t&&ot(S,"color",M.t=R),M},{e:void 0,t:void 0}),N(()=>S.value=i.editText()),S})()}})};ht(["input","keydown"]);var vf=$("<canvas style=display:block;touch-action:none;user-select:none>"),xf=$("<div style=position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0>");const kf=()=>{ct(()=>{const T=b.selection;if(T.length>0){let j=null,G=-1/0;T.forEach(K=>{const at=b.elements.find(xt=>xt.id===K);if(at){const xt=b.layers.find(Ut=>Ut.id===at.layerId);xt&&xt.order>G&&(G=xt.order,j=xt.id)}}),j&&j!==In(()=>b.activeLayerId)&&mr(j)}}),ct(()=>{if(!i)return;const T=i.getContext("2d");T&&b.elements.forEach(j=>{const G=j.type==="line"||j.type==="arrow";if(j.isSelected&&j.autoResize&&j.containerText&&!G){j.fontSize,j.fontFamily,j.fontWeight,j.fontStyle,j.containerText;const K=Ha(T,j,j.containerText);(Math.abs(K.width-j.width)>2||Math.abs(K.height-j.height)>2)&&In(()=>D(j.id,{width:K.width,height:K.height}))}})}),ct(()=>{if(b.appMode==="presentation")st.setForceTicker(!0);else{const T=b.elements.some(j=>j.flowAnimation);st.setForceTicker(T)}});let i;const{handleStopRecording:t}=gf(()=>i),n=ed(),[r,e]=H(null),[o,l]=H("containerText"),[s,a]=H("");let c;const[h,d]=H(null),[u,f]=H(null),[g,p]=H([]),[m,y]=H([]),w=16,v=8,x=800,k=100,S=16,M=()=>{if(!n.currentId||n.penPointsBuffer.length===0)return;const T=b.elements.find(j=>j.id===n.currentId);if(T&&T.points){const K={points:[...T.points,...n.penPointsBuffer]};T.type==="ink"&&(K.ttl=Date.now()+3e3),D(n.currentId,K,!1),n.penPointsBuffer=[]}},C=()=>{i&&(i.width=window.innerWidth,i.height=window.innerHeight,b.appMode==="presentation"&&(ie(),setTimeout(ie,50)),J())},[R,E]=H("default"),[O,z]=H(!1),[F,U]=H({x:0,y:0});function J(){if(!i)return;const T=i.getContext("2d");if(!T)return;const j=performance.now(),G=Ur();window.yappyGlobalTime=G;const{scale:K,panX:at,panY:xt}=b.viewState,Ut=b.theme==="dark",Qt=Ue.canvas(i),be=b.appMode==="presentation"||b.isPreviewing,Ot=tu(i,K,at,xt),di=eu(b.elements,b.slides,b.layers,b.docType,b.activeSlideIndex,Ot),we=Mr(di,G,be);T.setTransform(1,0,0,1,0,0),T.clearRect(0,0,i.width,i.height),nu(n.laserTrailData,x),iu(T,i,Ut),ru(T,Qt,b.slides,b.docType,b.activeSlideIndex,K,at,xt,Ut),ou(T,i,b.canvasTexture,K,at,xt,Ut),T.save(),T.translate(at,xt),T.scale(K,K),su(T,i,b.gridSettings,K,at,xt,Ut);const rn=au(T,Qt,{elements:b.elements,layers:b.layers,slides:b.slides,docType:b.docType,activeSlideIndex:b.activeSlideIndex,selection:b.selection,selectedTool:b.selectedTool,activeLayerId:b.activeLayerId,animatedStates:we,viewportBounds:Ot,scale:K,isDarkMode:Ut,currentDrawingId:n.currentId,hoveredConnector:n.hoveredConnector,editingId:r()});lu(T,{elements:b.elements,selection:b.selection,scale:K,selectionBox:h(),suggestedBinding:u(),snappingGuides:g(),spacingGuides:m()}),cu(T,{elements:b.elements,selectedTool:b.selectedTool,currentDrawingId:n.currentId,isDrawing:n.isDrawing,activeLayerId:b.activeLayerId,scale:K,canInteractWithElement:Y}),hu(T,n.laserTrailData,K,x),T.restore(),cf.measureFrame(performance.now()-j,b.elements.length,rn)}ct(()=>{Ur(),b.appMode,b.isPreviewing,b.theme,b.elements.length,b.elements.forEach(T=>{T.x,T.y,T.width,T.height,T.points&&T.points.length,T.angle,T.opacity,T.strokeColor,T.backgroundColor,T.fillStyle,T.strokeWidth,T.strokeStyle,T.roughness,T.roundness,T.text,T.fontSize,T.fontFamily,T.textAlign,T.fontWeight,T.fontStyle,T.textColor,T.textHighlightEnabled,T.textHighlightColor,T.textHighlightPadding,T.textHighlightRadius,T.startArrowhead,T.endArrowhead,T.containerText,T.labelPosition,T.isCollapsed,T.parentId,T.starPoints,T.polygonSides,T.borderRadius,T.burstPoints,T.tailPosition,T.shapeRatio,T.sideRatio,T.depth,T.viewAngle,T.taper,T.skewX,T.skewY,T.frontTaper,T.frontSkewX,T.frontSkewY,T.drawInnerBorder,T.innerBorderDistance,T.strokeStyle,T.renderStyle,T.startArrowhead,T.endArrowhead,T.startArrowheadSize,T.endArrowheadSize,T.fillDensity,T.gradientStart,T.gradientEnd,T.gradientDirection,T.gradientStops,T.gradientType,T.shadowEnabled,T.shadowColor,T.shadowBlur,T.shadowOffsetX,T.shadowOffsetY,T.blendMode,T.spinEnabled,T.spinSpeed,T.orbitEnabled,T.orbitCenterId,T.orbitRadius,T.orbitSpeed,T.orbitDirection}),b.slides.forEach(T=>{T.backgroundColor,T.fillStyle,T.gradientStops,T.gradientDirection,T.backgroundImage,T.backgroundOpacity}),b.viewState.scale,b.viewState.panX,b.viewState.panY,b.selection.length,h(),b.layers.length,b.layers.forEach(T=>{T.visible,T.order,T.opacity,T.backgroundColor}),b.gridSettings.enabled,b.gridSettings.gridSize,b.gridSettings.gridColor,b.gridSettings.gridOpacity,b.gridSettings.style,b.canvasBackgroundColor,b.canvasTexture,g(),requestAnimationFrame(J)}),ct(()=>{b.elements.forEach(T=>{T.boundElements&&T.boundElements.length>0&&(T.x,T.y,T.width,T.height,In(()=>{T.boundElements?.forEach(j=>yt(j.id))}))})});const rt=(T,j)=>{if(!i)return{x:0,y:0};const{scale:G,panX:K,panY:at}=b.viewState,xt=i.getBoundingClientRect();return{x:(T-xt.left-K)/G,y:(j-xt.top-at)/G}},X=T=>{if(!T.points||T.points.length===0)return null;const j=ft(T.points);let G=1/0,K=1/0,at=-1/0,xt=-1/0;j.forEach(Ot=>{G=Math.min(G,Ot.x),K=Math.min(K,Ot.y),at=Math.max(at,Ot.x),xt=Math.max(xt,Ot.y)});const Ut=at-G,Qt=xt-K,be=j.map(Ot=>({x:Ot.x-G,y:Ot.y-K}));return{x:T.x+G,y:T.y+K,width:Ut,height:Qt,points:be}},W=T=>{if(b.docType!=="slides"||!b.layers.find(at=>at.id===T.layerId)?.isMaster)return T;const G=b.slides[b.activeSlideIndex];if(!G)return T;const K=or(T,G,b.slides);return{...T,x:K.x,y:K.y}},Y=T=>T.locked?!1:!br(T.layerId),lt=(T,j,G)=>Xd(T,j,G,b.elements,b.viewState.scale,b.activeLayerId,Y),gt=(T,j,G,K,at)=>Na(T,b.elements,j,G,K,at),yt=T=>Oa(T,()=>b.elements,D),ut={editingId:r,setEditingId:e,editingProperty:o,setEditingProperty:l,editText:s,setEditText:a,get textInputRef(){return c},get canvasRef(){return i},getWorldCoordinates:rt,canInteractWithElement:Y,applyMasterProjection:W,redrawFn:J},Et={getWorldCoordinates:rt,canInteractWithElement:Y,applyMasterProjection:W},Mt=()=>nf(ut),et={getWorldCoordinates:rt,canInteractWithElement:Y,checkBinding:lt,refreshLinePoints:gt,refreshBoundLine:yt,flushPenPoints:M,applyMasterProjection:W,normalizePencil:X,commitText:Mt,draw:J,setCursor:E},wt={editingId:r,setEditingId:e,setEditText:a,selectionBox:h,setSelectionBox:d,suggestedBinding:u,setSuggestedBinding:f,snappingGuides:g,setSnappingGuides:p,spacingGuides:m,setSpacingGuides:y,get textInputRef(){return c}},At=T=>{if(ad(T,n))return;T.currentTarget.setPointerCapture(T.pointerId);const{x:j,y:G}=rt(T.clientX,T.clientY);if(r()){Mt();return}if(b.selectedTool==="selection"){Bd(T,j,G,n,et,wt);return}const K=b.layers.find(at=>at.id===b.activeLayerId);if(!K?.visible){nt("Cannot draw on a hidden layer. Please show the layer first or select a visible layer.","error");return}if(K?.locked){nt("Cannot draw on a locked layer. Please unlock the layer first or select an unlocked layer.","error");return}if(b.selectedTool==="text"){yd(j,G,wt);return}if(b.selectedTool==="laser"){fd(j,G,n);return}if(b.selectedTool==="ink"){md(j,G,n);return}if(b.selectedTool==="eraser"){bd(j,G,n,et);return}if(b.selectedTool==="pan"){hd(n,et);return}Cd(j,G,n,et)},Nt=T=>{if(ld(T,n))return;let{x:j,y:G}=rt(T.clientX,T.clientY);if(b.selectedTool==="pan"){dd(T,n,et);return}if(b.selectedTool==="selection"&&!n.draggingFromConnector){Dd(T,j,G,n,et,wt,w);return}if(b.selectedTool==="laser"&&pd(T,n,et,v,k),!n.isDrawing||!n.currentId){n.isDrawing&&b.selectedTool==="eraser"&&wd(j,G,et);return}b.selectedTool==="fineliner"||b.selectedTool==="marker"||b.selectedTool==="inkbrush"||b.selectedTool==="ink"?Ld(T,n,et,S):_d(j,G,n,et,wt),kd(T,n),(n.isDrawing||n.isDragging)&&requestAnimationFrame(J)},vt=T=>{if(T.currentTarget.releasePointerCapture(T.pointerId),!cd(n)){if(b.selectedTool==="pan"){ud(n,et);return}if(b.selectedTool==="laser"){gd(n,et);return}if(n.draggingFromConnector&&n.isDrawing&&n.currentId){xd(n,wt,et);return}if(b.selectedTool==="selection"){qd(T,n,et,wt);return}Ad(n,et,wt)}},me=T=>rf(T,ut);return ye(()=>{td(()=>{J()}),window.addEventListener("resize",C),document.addEventListener("fullscreenchange",C),C(),mt(()=>{window.removeEventListener("resize",C),document.removeEventListener("fullscreenchange",C)})}),[(()=>{var T=vf();T.$$contextmenu=G=>{G.preventDefault(),U({x:G.clientX,y:G.clientY}),z(!0)},T.addEventListener("drop",G=>sf(G,Et)),kt(T,"dragover",of),T.$$dblclick=me,T.$$pointerup=vt,T.$$pointermove=Nt,T.$$pointerdown=At,kt(T,"wheel",af);var j=i;return typeof j=="function"?tt(j,T):i=T,N(G=>ot(T,"cursor",R())),T})(),_(q,{get when(){return $e(()=>b.canvasTexture!=="none"&&b.canvasTexture!=="grid")()&&b.canvasTexture!=="graph"},get children(){var T=xf();return N(j=>{var G=b.theme==="dark"?.1:.4,K=b.canvasTexture==="paper"?`url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opactiy='0.5'/%3E%3C/svg%3E")`:b.canvasTexture==="dots"?`radial-gradient(${b.theme==="dark"?"#ffffff":"#000000"} 1px, transparent 1px)`:"none",at=b.canvasTexture==="dots"?"20px 20px":"auto";return G!==j.e&&ot(T,"opacity",j.e=G),K!==j.t&&ot(T,"background-image",j.t=K),at!==j.a&&ot(T,"background-size",j.a=at),j},{e:void 0,t:void 0,a:void 0}),T}}),_(mf,{canvasRef:i}),_(wf,{editingId:r,setEditingId:e,editText:s,setEditText:a,editingProperty:o,canvasRef:i,onCommitText:Mt,onTextInputRef:T=>{c=T}}),_(q,{get when(){return O()},get children(){return _(Ia,{get x(){return F().x},get y(){return F().y},get items(){return Qu(J)},onClose:()=>z(!1)})}}),_(q,{get when(){return b.isRecording},get children(){return _(df,{onStop:t})}}),_(q,{get when(){return b.pathEditState.isActive},get children(){return _(Ku,{get elementId(){return b.pathEditState.elementId},get animationId(){return b.pathEditState.animationId},get scale(){return b.viewState.scale},get panX(){return b.viewState.panX},get panY(){return b.viewState.panY}})}}),_(q,{get when(){return b.minimapVisible},get children(){return _(uu,{get canvasWidth(){return i?.width||window.innerWidth},get canvasHeight(){return i?.height||window.innerHeight}})}})]};ht(["pointerdown","pointermove","pointerup","dblclick","contextmenu"]);const Sf={A:[{type:"line",x1:50,y1:0,x2:0,y2:100},{type:"line",x1:50,y1:0,x2:100,y2:100},{type:"line",x1:25,y1:50,x2:75,y2:50}],E:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50},{type:"line",x1:0,y1:100,x2:80,y2:100}],F:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:0,x2:80,y2:0},{type:"line",x1:0,y1:50,x2:60,y2:50}],H:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:100,y1:0,x2:100,y2:100},{type:"line",x1:0,y1:50,x2:100,y2:50}],I:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:20,y1:0,x2:80,y2:0},{type:"line",x1:20,y1:100,x2:80,y2:100}],K:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:60,x2:80,y2:0},{type:"line",x1:20,y1:45,x2:80,y2:100}],L:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:80,y2:100}],M:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:50,y2:60},{type:"line",x1:50,y1:60,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:100,y2:100}],N:[{type:"line",x1:0,y1:100,x2:0,y2:0},{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:100,x2:100,y2:0}],T:[{type:"line",x1:50,y1:0,x2:50,y2:100},{type:"line",x1:0,y1:0,x2:100,y2:0}],V:[{type:"line",x1:0,y1:0,x2:50,y2:100},{type:"line",x1:50,y1:100,x2:100,y2:0}],W:[{type:"line",x1:0,y1:0,x2:25,y2:100},{type:"line",x1:25,y1:100,x2:50,y2:40},{type:"line",x1:50,y1:40,x2:75,y2:100},{type:"line",x1:75,y1:100,x2:100,y2:0}],X:[{type:"line",x1:0,y1:0,x2:100,y2:100},{type:"line",x1:100,y1:0,x2:0,y2:100}],Y:[{type:"line",x1:0,y1:0,x2:50,y2:50},{type:"line",x1:100,y1:0,x2:50,y2:50},{type:"line",x1:50,y1:50,x2:50,y2:100}],Z:[{type:"line",x1:0,y1:0,x2:100,y2:0},{type:"line",x1:100,y1:0,x2:0,y2:100},{type:"line",x1:0,y1:100,x2:100,y2:100}],B:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:70,c1y:0,c2x:70,c2y:50},{type:"bezier",x1:0,y1:50,x2:0,y2:100,c1x:80,c1y:50,c2x:80,c2y:100}],C:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100}],D:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:100,c1x:100,c1y:0,c2x:100,c2y:100}],G:[{type:"bezier",x1:80,y1:20,x2:80,y2:80,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"line",x1:80,y1:80,x2:80,y2:50},{type:"line",x1:80,y1:50,x2:50,y2:50}],J:[{type:"bezier",x1:60,y1:0,x2:40,y2:80,c1x:60,c1y:100,c2x:0,c2y:100}],O:[{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:-10,c1y:0,c2x:-10,c2y:100},{type:"bezier",x1:50,y1:0,x2:50,y2:100,c1x:110,c1y:0,c2x:110,c2y:100}],P:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50}],Q:[{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:-10,c1y:0,c2x:-10,c2y:90},{type:"bezier",x1:50,y1:0,x2:50,y2:90,c1x:110,c1y:0,c2x:110,c2y:90},{type:"line",x1:60,y1:70,x2:90,y2:100}],R:[{type:"line",x1:0,y1:0,x2:0,y2:100},{type:"bezier",x1:0,y1:0,x2:0,y2:50,c1x:80,c1y:0,c2x:80,c2y:50},{type:"line",x1:20,y1:50,x2:80,y2:100}],S:[{type:"bezier",x1:80,y1:20,x2:50,y2:50,c1x:10,c1y:10,c2x:20,c2y:50},{type:"bezier",x1:50,y1:50,x2:20,y2:80,c1x:80,c1y:50,c2x:90,c2y:90}],U:[{type:"bezier",x1:0,y1:0,x2:100,y2:0,c1x:0,c1y:120,c2x:100,c2y:120}]},Mf=(i,t,n,r=60,e="#000000")=>{const o=[],l=Lt("group"),s=r*.4;let a=t;const c=h=>h/100*r;for(let h=0;h<i.length;h++){const d=i[h].toUpperCase();if(d===" "){a+=r*.5;continue}const u=Sf[d];if(!u){const f=r,p={id:Lt("rectangle"),type:"rectangle",x:a,y:n,width:f,height:f,strokeColor:e,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[l],fontSize:16,textAlign:"center",verticalAlign:"middle",containerText:"?"};o.push(p),a+=f+s;continue}u.forEach(f=>{const p={id:Lt("line"),strokeColor:e,backgroundColor:"transparent",fillStyle:"solid",strokeWidth:3,strokeStyle:"solid",roughness:1,opacity:100,angle:0,renderStyle:"sketch",seed:Math.random()*1e5,roundness:null,locked:!1,link:null,layerId:"default-layer",groupIds:[l]};if(f.type==="line")p.type="line",p.x=a+c(f.x1),p.y=n+c(f.y1),p.width=c(f.x2-f.x1),p.height=c(f.y2-f.y1),p.startArrowhead=null,p.endArrowhead=null;else if(f.type==="bezier"){p.type="line",p.curveType="bezier",p.startArrowhead=null,p.endArrowhead=null,p.x=a+c(f.x1),p.y=n+c(f.y1),p.width=c(f.x2-f.x1),p.height=c(f.y2-f.y1);const m=a+c(f.c1x),y=n+c(f.c1y),w=a+c(f.c2x),v=n+c(f.c2y);p.controlPoints=[{x:m,y},{x:w,y:v}]}o.push(p)}),a+=r+s}return o};var Pf=$('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="lucide lucide-marker"><path d="M12 2l7 7-9 9-4-4L12 2z"></path><path d="M7 13l-1.5 1.5">'),Cf=$("<div class=pen-tool-dropdown>"),_f=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Af=$("<button>");const Tf=i=>(()=>{var t=Pf();return N(n=>{var r=i.size||24,e=i.size||24;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Mi=[{type:"fineliner",icon:hl,label:"Fine Liner (P or 8)"},{type:"inkbrush",icon:dl,label:"Ink Brush"},{type:"marker",icon:Tf,label:"Marker"}],Lf=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const h=d=>{const u=d.target;n?.contains(u)||r?.contains(u)||t(!1)};document.addEventListener("pointerdown",h),mt(()=>document.removeEventListener("pointerdown",h))}});const e=()=>Mi.find(h=>h.type===b.selectedPenType)||Mi[0],o=()=>["fineliner","inkbrush","marker"].includes(b.selectedTool),l=h=>{Mh(h),Z(h),t(!1)},s=h=>{h.preventDefault(),b.showPropertyPanel||Z(b.selectedTool),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},a=()=>{o()||Z(b.selectedPenType),t(!i())},c=()=>{if(!n)return{};const h=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${h.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${h.bottom+4}px`,left:`${h.left}px`}};return(()=>{var h=_f(),d=h.firstChild,u=d.firstChild;d.$$contextmenu=s,d.$$click=a;var f=n;return typeof f=="function"?tt(f,d):n=d,I(u,()=>{const g=e().icon;return _(g,{size:20})},null),I(u,_(It,{size:10,class:"submenu-indicator"}),null),I(h,_(q,{get when(){return i()},get children(){return _($t,{get children(){var g=Cf(),p=r;return typeof p=="function"?tt(p,g):r=g,I(g,_(zt,{each:Mi,children:m=>(()=>{var y=Af();return kt(y,"click",()=>l(m.type)),I(y,_(m.icon,{size:18})),N(w=>{var v=`dropdown-item ${b.selectedPenType===m.type?"active":""}`,x=m.label;return v!==w.e&&it(y,w.e=v),x!==w.t&&L(y,"title",w.t=x),w},{e:void 0,t:void 0}),y})()})),N(m=>Rt(g,c(),m)),g}})}}),null),N(g=>{var p=`toolbar-btn ${o()?"active":""}`,m=`${e().label} (P or 8 - Click for more)`;return p!==g.e&&it(d,g.e=p),m!==g.t&&L(d,"title",g.t=m),g},{e:void 0,t:void 0}),h})()};ht(["click","contextmenu"]);var If=$("<div class=pen-tool-dropdown>"),$f=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Rf=$("<button>");const mn=[{type:"database",icon:Qi,label:"Database"},{type:"document",icon:ho,label:"Document"},{type:"predefinedProcess",icon:ul,label:"Predefined Process"},{type:"internalStorage",icon:Zi,label:"Internal Storage"},{type:"capsule",icon:fl,label:"Capsule (Node)"},{type:"stickyNote",icon:pl,label:"Sticky Note"},{type:"callout",icon:gl,label:"Callout (Thought)"},{type:"speechBubble",icon:yl,label:"Speech Bubble"},{type:"burst",icon:Ji,label:"Burst (Impact)"},{type:"ribbon",icon:ml,label:"Ribbon (Title)"},{type:"bracketLeft",icon:uo,label:"Left Bracket"},{type:"bracketRight",icon:fo,label:"Right Bracket"},{type:"triangle",icon:bl,label:"Triangle"},{type:"hexagon",icon:wl,label:"Hexagon"},{type:"octagon",icon:vl,label:"Octagon"},{type:"parallelogram",icon:Kn,label:"Parallelogram"},{type:"star",icon:xl,label:"Star"},{type:"polygon",icon:po,label:"Polygon (Parametric)"},{type:"cloud",icon:kl,label:"Cloud"},{type:"heart",icon:Sl,label:"Heart"},{type:"cross",icon:Vi,label:"Cross (X)"},{type:"checkmark",icon:Yt,label:"Checkmark"},{type:"arrowLeft",icon:Ml,label:"Arrow Left"},{type:"arrowRight",icon:Pl,label:"Arrow Right"},{type:"arrowUp",icon:Cl,label:"Arrow Up"},{type:"arrowDown",icon:go,label:"Arrow Down"}],Ef=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>mn.find(u=>u.type===b.selectedShapeType)||mn[0],o=d=>{Ph(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedShapeType),t(!i())},a=()=>e(),c=()=>mn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=$f(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=If(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>mn.map(y=>(()=>{var w=Rf();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=`${a().label} (Click for more)`;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Nf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=7 r=3></circle><path d="M 12,10 L 5,13 L 12,15 L 19,13 L 12,10"></path><path d="M 12,15 L 9,21"></path><path d="M 12,15 L 15,21">'),Of=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,4 L 18,4 L 18,20 L 6,20 Z"></path><path d="M 6,4 C 4,4 4,2 6,2 L 18,2 C 20,2 20,4 18,4"></path><path d="M 6,20 C 4,20 4,22 6,22 L 18,22 C 20,22 20,20 18,20">'),Bf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 2,12 C 5,8 8,16 11,12 C 14,8 17,16 20,12">'),Df=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 5,6 L 19,6 L 19,14 L 5,14 Z"></path><path d="M 5,8 L 2,10 L 5,12"></path><path d="M 19,8 L 22,10 L 19,12"></path><path d="M 5,14 L 5,16 L 3,16"></path><path d="M 19,14 L 19,16 L 21,16">'),zf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=9 y1=18 x2=15 y2=18></line><line x1=10 y1=22 x2=14 y2=22></line><path d="M 15.09,14 C 15.09,14 17,12.5 17,10.6 C 17,7.5 14.5,5 11,5 C 7.5,5 5,7.5 5,10.6 C 5,12.5 6.91,14 6.91,14">'),Ff=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=12 y1=3 x2=12 y2=22></line><path d="M 4,6 L 18,6 L 21,9 L 18,12 L 4,12 Z"></path><circle cx=12 cy=9 r=1 fill=currentColor stroke=none>'),Wf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 14.5,8 L 21,9 L 16.5,14 L 18,21 L 12,17 L 6,21 L 7.5,14 L 3,9 L 9.5,8 Z">'),jf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 7,3 L 17,3 L 17,11 C 17,14 14.5,16 12,16 C 9.5,16 7,14 7,11 Z"></path><path d="M 7,5 C 4,5 3,7 4,9 C 5,11 7,11 7,11"></path><path d="M 17,5 C 20,5 21,7 20,9 C 19,11 17,11 17,11"></path><line x1=12 y1=16 x2=12 y2=19></line><path d="M 8,19 L 16,19 L 16,21 L 8,21 Z">'),Uf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><polyline points="12,6 12,12 16,14">'),qf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=3></circle><path d="M 12,1 L 13.5,4 L 15.5,3 L 15,6 L 18,5.5 L 16.5,8 L 19.5,9 L 17,11 L 19.5,13 L 16.5,14 L 18,16.5 L 15,16 L 15.5,19 L 13.5,18 L 12,21 L 10.5,18 L 8.5,19 L 9,16 L 6,16.5 L 7.5,14 L 4.5,13 L 7,11 L 4.5,9 L 7.5,8 L 6,5.5 L 9,6 L 8.5,3 L 10.5,4 Z">'),Hf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><circle cx=12 cy=12 r=6></circle><circle cx=12 cy=12 r=2>'),Yf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 C 12,2 7,7 7,14 L 17,14 C 17,7 12,2 12,2 Z"></path><path d="M 7,14 L 4,17 L 7,16"></path><path d="M 17,14 L 20,17 L 17,16"></path><path d="M 9,18 L 12,22 L 15,18"></path><circle cx=12 cy=10 r=2>'),Xf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=5 y1=3 x2=5 y2=22></line><path d="M 5,3 C 9,1 13,5 19,3 L 19,14 C 13,16 9,12 5,14">'),Gf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=8 r=4></circle><line x1=12 y1=12 x2=12 y2=22></line><line x1=12 y1=18 x2=15 y2=18></line><line x1=12 y1=21 x2=15 y2=21>'),Vf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=10 cy=10 r=6></circle><line x1=14.5 y1=14.5 x2=21 y2=21>'),Qf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,4 C 10,2 6,2 2,3 L 2,20 C 6,19 10,19 12,21 C 14,19 18,19 22,20 L 22,3 C 18,2 14,2 12,4 Z"></path><line x1=12 y1=4 x2=12 y2=21>'),Zf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 3,10 L 3,14 L 7,14 L 13,18 L 13,6 L 7,10 Z"></path><line x1=17 y1=9 x2=21 y2=7></line><line x1=17 y1=12 x2=21 y2=12></line><line x1=17 y1=15 x2=21 y2=17>'),Jf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 1,12 C 4,6 8,4 12,4 C 16,4 20,6 23,12 C 20,18 16,20 12,20 C 8,20 4,18 1,12 Z"></path><circle cx=12 cy=12 r=3>'),Kf=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,14 C 3,14 2,12 2,10 C 2,8 3,6 6,6 C 6,3 8,1 12,1 C 16,1 18,3 18,6 C 21,6 22,8 22,10 C 22,12 21,14 18,14 C 18,16 16,17 14,17 L 10,17 C 8,17 6,16 6,14 Z"></path><circle cx=7 cy=20 r=1.5></circle><circle cx=4 cy=22.5 r=1>'),tp=$("<div class=pen-tool-dropdown>"),ep=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),np=$("<button>");const ip=i=>(()=>{var t=Nf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),rp=i=>(()=>{var t=Of();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),op=i=>(()=>{var t=Bf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),sp=i=>(()=>{var t=Df();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),ap=i=>(()=>{var t=zf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),lp=i=>(()=>{var t=Ff();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),cp=i=>(()=>{var t=Wf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),hp=i=>(()=>{var t=jf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),dp=i=>(()=>{var t=Uf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),up=i=>(()=>{var t=qf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),fp=i=>(()=>{var t=Hf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),pp=i=>(()=>{var t=Yf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),gp=i=>(()=>{var t=Xf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),yp=i=>(()=>{var t=Gf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),mp=i=>(()=>{var t=Vf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),bp=i=>(()=>{var t=Qf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),wp=i=>(()=>{var t=Zf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),vp=i=>(()=>{var t=Jf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),xp=i=>(()=>{var t=Kf();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),bn=[{type:"starPerson",icon:ip,label:"Star Person (Character)"},{type:"lightbulb",icon:ap,label:"Lightbulb (Idea)"},{type:"signpost",icon:lp,label:"Signpost (Direction)"},{type:"burstBlob",icon:cp,label:"Jagged Burst (Impact)"},{type:"trophy",icon:hp,label:"Trophy (Achievement)"},{type:"clock",icon:dp,label:"Clock (Time)"},{type:"gear",icon:up,label:"Gear (Process)"},{type:"target",icon:fp,label:"Target (Goal)"},{type:"rocket",icon:pp,label:"Rocket (Launch)"},{type:"flag",icon:gp,label:"Flag (Milestone)"},{type:"key",icon:yp,label:"Key (Insight)"},{type:"magnifyingGlass",icon:mp,label:"Magnifying Glass (Search)"},{type:"book",icon:bp,label:"Book (Knowledge)"},{type:"megaphone",icon:wp,label:"Megaphone (Announce)"},{type:"eye",icon:vp,label:"Eye (Vision)"},{type:"thoughtBubble",icon:xp,label:"Thought Bubble (Thinking)"},{type:"scroll",icon:rp,label:"Scroll Container"},{type:"wavyDivider",icon:op,label:"Wavy Divider"},{type:"doubleBanner",icon:sp,label:"Double Banner"}],kp=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>bn.find(u=>u.type===b.selectedSketchnoteType)||bn[0],o=d=>{Ah(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedSketchnoteType),t(!i())},a=()=>e(),c=()=>bn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=ep(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=tp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>bn.map(y=>(()=>{var w=np();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Sp=$("<div class=pen-tool-dropdown>"),Mp=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Pp=$("<button>");const wn=[{type:"database",icon:Qi,label:"Database"},{type:"server",icon:_l,label:"Server"},{type:"loadBalancer",icon:Al,label:"Load Balancer"},{type:"firewall",icon:Tl,label:"Firewall"},{type:"user",icon:yo,label:"User / Client"},{type:"messageQueue",icon:Ll,label:"Message Queue"},{type:"lambda",icon:Ji,label:"Lambda / Function"},{type:"router",icon:Il,label:"Router"},{type:"browser",icon:$l,label:"Browser / Web"}],Cp=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>wn.find(u=>u.type===b.selectedInfraType)||wn[0],o=d=>{Ch(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedInfraType),t(!i())},a=()=>e(),c=()=>wn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Mp(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=Sp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>wn.map(y=>(()=>{var w=Pp();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var _p=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 4,18 L 8,6 L 16,6 L 20,18 Z">'),Ap=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 6,6 L 6,18 L 18,18 Z">'),Tp=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 19,5 L 22,12 L 19,19 L 12,22 L 5,19 L 2,12 L 5,5 Z">'),Lp=$("<div class=pen-tool-dropdown>"),Ip=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),$p=$("<button>");const Rp=i=>(()=>{var t=_p();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Ep=i=>(()=>{var t=Ap();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Np=i=>(()=>{var t=Tp();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),vn=[{type:"trapezoid",icon:Rp,label:"Trapezoid"},{type:"rightTriangle",icon:Ep,label:"Right-Angle Triangle"},{type:"pentagon",icon:po,label:"Pentagon"},{type:"septagon",icon:Np,label:"Septagon (Heptagon)"}],Op=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>vn.find(u=>u.type===b.selectedMathType)||vn[0],o=d=>{_h(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedMathType),t(!i())},a=()=>e(),c=()=>vn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Ip(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=Lp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>vn.map(y=>(()=>{var w=$p();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Bp=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=2 y=3 width=20 height=18 rx=2 ry=2></rect><line x1=2 y1=8 x2=22 y2=8></line><circle cx=5 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=7 cy=5.5 r=0.5 fill=currentColor></circle><circle cx=9 cy=5.5 r=0.5 fill=currentColor>'),Dp=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=5 y=2 width=14 height=20 rx=2 ry=2></rect><path d="M10 4h4"></path><path d="M11 19h2">'),zp=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-dasharray="2 2"><rect x=3 y=6 width=18 height=12 rx=2 ry=2>'),Fp=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2><rect x=3 y=7 width=18 height=10 rx=1></rect><line x1=7 y1=10 x2=7 y2=14>'),Wp=$("<div class=pen-tool-dropdown>"),jp=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Up=$("<button>");const qp=i=>(()=>{var t=Bp();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Hp=i=>(()=>{var t=Dp();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Yp=i=>(()=>{var t=zp();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Xp=i=>(()=>{var t=Fp();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),xn=[{type:"browserWindow",icon:qp,label:"Browser Window"},{type:"mobilePhone",icon:Hp,label:"Mobile Phone"},{type:"ghostButton",icon:Yp,label:"Ghost Button"},{type:"inputField",icon:Xp,label:"Input Field"}],Gp=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>xn.find(u=>u.type===b.selectedWireframeType)||xn[0],o=d=>{Eh(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedWireframeType),t(!i())},a=()=>e(),c=()=>xn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=jp(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=Wp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>xn.map(y=>(()=>{var w=Up();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Vp=$("<div class=pen-tool-dropdown>"),Qp=$('<div class=pen-tool-group><button title="Mindmap Tools"><div class=tool-icon-wrapper>'),Zp=$("<button>");const De=[{type:"organicBranch",icon:Rl,label:"Organic Branch"},{type:"cloud",icon:El,label:"Central Topic (Cloud)"},{type:"circle",icon:Nl,label:"Topic (Circle)"}],Jp=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>{const d=De.find(f=>f.type===b.selectedTool);return d||De.find(f=>f.type===b.selectedShapeType)||De[0]},o=d=>{Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(e().type),t(!i())},a=()=>e(),c=()=>De.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Qp(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=Vp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>De.map(y=>(()=>{var w=Zp();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(()=>it(u,`toolbar-btn ${c()?"active":""}`)),d})()};ht(["click","contextmenu"]);var Kp=$("<div class=pen-tool-dropdown>"),t0=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),e0=$("<button>");const kn=[{type:"dfdProcess",icon:Ol,label:"DFD Process"},{type:"dfdDataStore",icon:Bl,label:"DFD Data Store"},{type:"isometricCube",icon:Dl,label:"Isometric Cube"},{type:"solidBlock",icon:zl,label:"Solid Block"},{type:"perspectiveBlock",icon:Fl,label:"Perspective Block"},{type:"cylinder",icon:Qi,label:"Cylinder"},{type:"stateStart",icon:Ki,label:"Initial State"},{type:"stateEnd",icon:mo,label:"Final State"},{type:"stateSync",icon:tr,label:"Sync Bar"},{type:"activationBar",icon:Wl,label:"Activation Bar"},{type:"externalEntity",icon:Zi,label:"External Entity"}],n0=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>kn.find(u=>u.type===b.selectedTechnicalType)||kn[0],o=d=>{Dh(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedTechnicalType),t(!i())},a=()=>e(),c=()=>kn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=t0(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=Kp(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>kn.map(y=>(()=>{var w=e0();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var i0=$("<div class=pen-tool-dropdown>"),r0=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),o0=$("<button>");const Sn=[{type:"umlClass",icon:ke,label:"Class"},{type:"umlInterface",icon:jl,label:"Interface"},{type:"umlActor",icon:yo,label:"Actor"},{type:"umlUseCase",icon:Ki,label:"Use Case"},{type:"umlNote",icon:ho,label:"Note"},{type:"umlPackage",icon:Ul,label:"Package"},{type:"umlComponent",icon:ql,label:"Component"},{type:"umlState",icon:Hl,label:"State"},{type:"umlLifeline",icon:go,label:"Lifeline"},{type:"umlFragment",icon:Yl,label:"Fragment"},{type:"umlSignalSend",icon:fo,label:"Signal Send"},{type:"umlSignalReceive",icon:uo,label:"Signal Receive"},{type:"umlProvidedInterface",icon:mo,label:"Provided"},{type:"umlRequiredInterface",icon:Xl,label:"Required"}],s0=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>Sn.find(u=>u.type===b.selectedUmlType)||Sn[0],o=d=>{zh(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedUmlType),t(!i())},a=()=>e(),c=()=>Sn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=r0(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=i0(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>Sn.map(y=>(()=>{var w=o0();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=`UML: ${a().label}`;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var a0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=4 r=3></circle><line x1=12 y1=7 x2=12 y2=15></line><line x1=5 y1=10 x2=19 y2=10></line><line x1=8 y1=22 x2=12 y2=15></line><line x1=12 y1=15 x2=16 y2=22>'),l0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=4 r=3></circle><line x1=12 y1=7 x2=12 y2=14></line><line x1=6 y1=10 x2=18 y2=10></line><line x1=12 y1=14 x2=18 y2=14></line><line x1=18 y1=14 x2=18 y2=22>'),c0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=8 cy=4 r=3></circle><line x1=8 y1=7 x2=8 y2=15></line><line x1=8 y1=9 x2=3 y2=14></line><line x1=8 y1=9 x2=18 y2=3></line><line x1=5 y1=22 x2=8 y2=15></line><line x1=8 y1=15 x2=11 y2=22></line><rect x=14 y=1 width=9 height=11 rx=1>'),h0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 2,10 L 2,16 Q 2,18 4,18 L 8,18 L 8,16"></path><path d="M 8,16 Q 6,17 6,15 Q 6,13 8,14"></path><path d="M 8,14 Q 6,14.5 6,12.5 Q 6,11 8,11.5"></path><path d="M 8,11.5 L 8,9 Q 8,7 10,7 L 20,7 Q 22,7 22,9 L 22,11 Q 22,13 20,13 L 10,13 L 8,13"></path><path d="M 6,10 L 4,8 Q 3,6 5,5 Q 7,5 7,7 L 8,9">'),d0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 10,12 L 10,4 Q 10,2 12,2 Q 14,2 14,4 L 14,12"></path><path d="M 7,12 L 19,12 Q 20,12 20,13 L 20,21 Q 20,22 19,22 L 7,22 Q 6,22 6,21 L 6,13 Q 6,12 7,12 Z"></path><line x1=10 y1=15 x2=18 y2=15></line><line x1=10 y1=18 x2=18 y2=18>'),u0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><circle cx=9 cy=10 r=1 fill=currentColor></circle><circle cx=15 cy=10 r=1 fill=currentColor></circle><path d="M 8,15 Q 12,19 16,15">'),f0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><circle cx=9 cy=10 r=1 fill=currentColor></circle><circle cx=15 cy=10 r=1 fill=currentColor></circle><path d="M 8,18 Q 12,14 16,18">'),p0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><circle cx=9 cy=10 r=1 fill=currentColor></circle><circle cx=15 cy=10 r=1 fill=currentColor></circle><line x1=14 y1=8 x2=16 y2=7></line><path d="M 8,16 Q 10,15 12,16 Q 14,17 16,16">'),g0=$("<div class=pen-tool-dropdown>"),y0=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),m0=$("<button>");const b0=i=>(()=>{var t=a0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),w0=i=>(()=>{var t=l0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),v0=i=>(()=>{var t=c0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),x0=i=>(()=>{var t=h0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),k0=i=>(()=>{var t=d0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),S0=i=>(()=>{var t=u0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),M0=i=>(()=>{var t=f0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),P0=i=>(()=>{var t=p0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Mn=[{type:"stickFigure",icon:b0,label:"Stick Figure (Person)"},{type:"sittingPerson",icon:w0,label:"Sitting Person"},{type:"presentingPerson",icon:v0,label:"Presenting Person"},{type:"handPointRight",icon:x0,label:"Pointing Hand (Right)"},{type:"thumbsUp",icon:k0,label:"Thumbs Up (Approval)"},{type:"faceHappy",icon:S0,label:"Happy Face (Positive)"},{type:"faceSad",icon:M0,label:"Sad Face (Negative)"},{type:"faceConfused",icon:P0,label:"Confused Face (Question)"}],C0=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>Mn.find(u=>u.type===b.selectedPeopleType)||Mn[0],o=d=>{Th(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedPeopleType),t(!i())},a=()=>e(),c=()=>Mn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=y0(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=g0(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>Mn.map(y=>(()=>{var w=m0();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var _0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=3>'),A0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=3></rect><polyline points="7,12 10,16 17,8">'),T0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><text x=12 y=16 text-anchor=middle font-size=12 font-weight=bold fill=currentColor stroke=none>1'),L0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><text x=12 y=16 text-anchor=middle font-size=13 font-weight=bold fill=currentColor stroke=none>?'),I0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><text x=12 y=16 text-anchor=middle font-size=13 font-weight=bold fill=currentColor stroke=none>!'),$0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 4,12 L 7,4 L 21,4 Q 22,4 22,5 L 22,19 Q 22,20 21,20 L 7,20 Z"></path><circle cx=9 cy=12 r=1.5 fill=currentColor>'),R0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,22 C 9,16 5,12 5,8 A 7,7 0 1 1 19,8 C 19,12 15,16 12,22 Z"></path><circle cx=12 cy=8 r=2.5 fill=currentColor>'),E0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path></path><circle cx=12 cy=12 r=6>'),N0=$("<div class=pen-tool-dropdown>"),O0=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),B0=$("<button>");const D0=i=>(()=>{var t=_0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),z0=i=>(()=>{var t=A0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),F0=i=>(()=>{var t=T0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),W0=i=>(()=>{var t=L0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),j0=i=>(()=>{var t=I0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),U0=i=>(()=>{var t=$0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),q0=i=>(()=>{var t=R0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),H0=i=>(()=>{var t=E0(),n=t.firstChild;return N(r=>{var e=i.size||20,o=i.size||20,l=(()=>{let s="";for(let f=0;f<12;f++){const g=Math.PI*2*f/12,p=Math.PI*2*(f+.5)/12,m=Math.PI*2*(f+1)/12,y=12+Math.cos(g)*10,w=12+Math.sin(g)*10,v=12+Math.cos(p)*8.5,x=12+Math.sin(p)*8.5,k=12+Math.cos(m)*10,S=12+Math.sin(m)*10;f===0&&(s=`M ${y} ${w}`),s+=` Q ${v} ${x} ${k} ${S}`}return s+" Z"})();return e!==r.e&&L(t,"width",r.e=e),o!==r.t&&L(t,"height",r.t=o),l!==r.a&&L(n,"d",r.a=l),r},{e:void 0,t:void 0,a:void 0}),t})(),Pn=[{type:"checkbox",icon:D0,label:"Checkbox (Empty)"},{type:"checkboxChecked",icon:z0,label:"Checkbox (Checked)"},{type:"numberedBadge",icon:F0,label:"Numbered Badge"},{type:"questionMark",icon:W0,label:"Question Mark"},{type:"exclamationMark",icon:j0,label:"Exclamation Mark"},{type:"tag",icon:U0,label:"Tag (Label)"},{type:"pin",icon:q0,label:"Map Pin"},{type:"stamp",icon:H0,label:"Stamp (Seal)"}],Y0=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>Pn.find(u=>u.type===b.selectedStatusType)||Pn[0],o=d=>{Lh(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedStatusType),t(!i())},a=()=>e(),c=()=>Pn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=O0(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=N0(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>Pn.map(y=>(()=>{var w=B0();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var X0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><circle cx=12 cy=12 r=3.5></circle><line x1=12 y1=8.5 x2=12 y2=3.5></line><line x1=15 y1=9.5 x2=18.5 y2=6></line><line x1=15.5 y1=12 x2=20 y2=12></line><line x1=15 y1=14.5 x2=18.5 y2=18></line><line x1=12 y1=15.5 x2=12 y2=20.5></line><line x1=9 y1=14.5 x2=5.5 y2=18></line><line x1=8.5 y1=12 x2=4 y2=12>'),G0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=2></rect><line x1=5 y1=8.5 x2=19 y2=8.5></line><line x1=5 y1=13.5 x2=19 y2=13.5></line><line x1=5 y1=18.5 x2=19 y2=18.5>'),V0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=2></rect><line x1=7 y1=12 x2=14 y2=12></line><polyline points="15,9 18,12 15,15">'),Q0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><ellipse cx=12 cy=12 rx=4 ry=10></ellipse><line x1=2 y1=12 x2=22 y2=12>'),Z0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><ellipse cx=12 cy=5 rx=8 ry=3></ellipse><path d="M 4,5 L 4,19"></path><path d="M 20,5 L 20,19"></path><ellipse cx=12 cy=19 rx=8 ry=3>'),J0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=2 y=10 width=20 height=4 rx=2></rect><line x1=7 y1=4 x2=7 y2=10></line><line x1=7 y1=14 x2=7 y2=20></line><line x1=12 y1=4 x2=12 y2=10></line><line x1=12 y1=14 x2=12 y2=20></line><line x1=17 y1=4 x2=17 y2=10></line><line x1=17 y1=14 x2=17 y2=20>'),K0=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><polygon points="12,2 21,7 21,17 12,22 3,17 3,7"></polygon><circle cx=12 cy=12 r=3></circle><line x1=12 y1=9 x2=12 y2=7.5></line><line x1=14.6 y1=10.5 x2=15.9 y2=9.7></line><line x1=14.6 y1=13.5 x2=15.9 y2=14.3></line><line x1=12 y1=15 x2=12 y2=16.5></line><line x1=9.4 y1=13.5 x2=8.1 y2=14.3></line><line x1=9.4 y1=10.5 x2=8.1 y2=9.7>'),tg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 12,2 L 21,2 L 21,13 Q 21,20 12,22 Q 3,20 3,13 L 3,2 Z"></path><polyline points="8,12 11,15 16,9">'),eg=$("<div class=pen-tool-dropdown>"),ng=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),ig=$("<button>");const rg=i=>(()=>{var t=X0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),og=i=>(()=>{var t=G0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),sg=i=>(()=>{var t=V0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),ag=i=>(()=>{var t=Q0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),lg=i=>(()=>{var t=Z0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),cg=i=>(()=>{var t=J0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),hg=i=>(()=>{var t=K0();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),dg=i=>(()=>{var t=tg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Cn=[{type:"kubernetes",icon:rg,label:"Kubernetes"},{type:"container",icon:og,label:"Container"},{type:"apiGateway",icon:sg,label:"API Gateway"},{type:"cdn",icon:ag,label:"CDN (Globe)"},{type:"storageBlob",icon:lg,label:"Storage Blob"},{type:"eventBus",icon:cg,label:"Event Bus"},{type:"microservice",icon:hg,label:"Microservice"},{type:"shield",icon:dg,label:"Shield (Security)"}],ug=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>Cn.find(u=>u.type===b.selectedCloudInfraType)||Cn[0],o=d=>{Ih(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedCloudInfraType),t(!i())},a=()=>e(),c=()=>Cn.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=ng(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=eg(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>Cn.map(y=>(()=>{var w=ig();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var fg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=12 width=4 height=9></rect><rect x=10 y=6 width=4 height=15></rect><rect x=17 y=9 width=4 height=12></rect><line x1=2 y1=22 x2=22 y2=22>'),pg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=12 r=10></circle><line x1=12 y1=12 x2=12 y2=2></line><line x1=12 y1=12 x2=20.5 y2=7.5></line><line x1=12 y1=12 x2=5 y2=19>'),gg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><polyline points="3,17 9,11 13,14 21,6"></polyline><polyline points="16,6 21,6 21,11">'),yg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><polyline points="3,7 9,13 13,10 21,18"></polyline><polyline points="16,18 21,18 21,13">'),mg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><polygon points="2,3 22,3 15,21 9,21"></polygon><line x1=4.5 y1=9 x2=19.5 y2=9></line><line x1=7 y1=15 x2=17 y2=15>'),bg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M 2,18 A 10,10 0 0,1 22,18"></path><line x1=12 y1=18 x2=8 y2=8></line><circle cx=12 cy=18 r=1.5 fill=currentColor>'),wg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=3 y=3 width=18 height=18 rx=1></rect><line x1=3 y1=9 x2=21 y2=9></line><line x1=3 y1=15 x2=21 y2=15></line><line x1=9 y1=3 x2=9 y2=21></line><line x1=15 y1=3 x2=15 y2=21>'),vg=$("<div class=pen-tool-dropdown>"),xg=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),kg=$("<button>");const Sg=i=>(()=>{var t=fg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Mg=i=>(()=>{var t=pg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Pg=i=>(()=>{var t=gg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Cg=i=>(()=>{var t=yg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),_g=i=>(()=>{var t=mg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Ag=i=>(()=>{var t=bg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Tg=i=>(()=>{var t=wg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),_n=[{type:"barChart",icon:Sg,label:"Bar Chart"},{type:"pieChart",icon:Mg,label:"Pie Chart"},{type:"trendUp",icon:Pg,label:"Trend Up"},{type:"trendDown",icon:Cg,label:"Trend Down"},{type:"funnel",icon:_g,label:"Funnel"},{type:"gauge",icon:Ag,label:"Gauge"},{type:"table",icon:Tg,label:"Table"}],Lg=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>_n.find(u=>u.type===b.selectedDataMetricsType)||_n[0],o=d=>{$h(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedDataMetricsType),t(!i())},a=()=>e(),c=()=>_n.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=xg(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=vg(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>_n.map(y=>(()=>{var w=kg();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Ig=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M3 3h7v3a2 2 0 1 0 4 0V3h7v7h-3a2 2 0 1 0 0 4h3v7H3V3z">'),$g=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><rect x=2 y=5 width=12 height=6 rx=3></rect><rect x=10 y=13 width=12 height=6 rx=3>'),Rg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M2 14 Q12 4 22 14"></path><line x1=2 y1=16 x2=22 y2=16></line><line x1=7 y1=16 x2=7 y2=21></line><line x1=12 y1=16 x2=12 y2=21></line><line x1=17 y1=16 x2=17 y2=21>'),Eg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M4 3v10a8 8 0 0 0 16 0V3"></path><path d="M9 3v10a3 3 0 0 0 6 0V3"></path><line x1=4 y1=7 x2=9 y2=7></line><line x1=15 y1=7 x2=20 y2=7>'),Ng=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><line x1=12 y1=3 x2=12 y2=20></line><line x1=4 y1=6 x2=20 y2=6></line><path d="M4 6 L2 14"></path><path d="M4 6 L6 14"></path><path d="M2 14 A4 2 0 0 0 6 14"></path><path d="M20 6 L18 14"></path><path d="M20 6 L22 14"></path><path d="M18 14 A4 2 0 0 0 22 14"></path><rect x=8 y=20 width=8 height=2 rx=1>'),Og=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M12 20 Q11 14 12 10"></path><path d="M12 12 Q6 8 8 4 Q10 6 12 10"></path><path d="M12 10 Q18 4 16 2 Q14 5 12 8"></path><path d="M7 20 A5 3 0 0 1 17 20">'),Bg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><circle cx=12 cy=9 r=7></circle><rect x=10 y=14 width=4 height=8>'),Dg=$('<svg viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><polygon points="11,3 22,21 2,21"></polygon><polyline points="11,3 13,7 9,7 11,3">'),zg=$("<div class=pen-tool-dropdown>"),Fg=$("<div class=pen-tool-group><button><div class=tool-icon-wrapper>"),Wg=$("<button>");const jg=i=>(()=>{var t=Ig();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Ug=i=>(()=>{var t=$g();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),qg=i=>(()=>{var t=Rg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Hg=i=>(()=>{var t=Eg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Yg=i=>(()=>{var t=Ng();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Xg=i=>(()=>{var t=Og();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Gg=i=>(()=>{var t=Bg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),Vg=i=>(()=>{var t=Dg();return N(n=>{var r=i.size||20,e=i.size||20;return r!==n.e&&L(t,"width",n.e=r),e!==n.t&&L(t,"height",n.t=e),n},{e:void 0,t:void 0}),t})(),An=[{type:"puzzlePiece",icon:jg,label:"Puzzle Piece"},{type:"chainLink",icon:Ug,label:"Chain Link"},{type:"bridge",icon:qg,label:"Bridge"},{type:"magnet",icon:Hg,label:"Magnet"},{type:"scale",icon:Yg,label:"Scale (Balance)"},{type:"seedling",icon:Xg,label:"Seedling (Growth)"},{type:"tree",icon:Gg,label:"Tree (Hierarchy)"},{type:"mountain",icon:Vg,label:"Mountain (Peak)"}],Qg=()=>{const[i,t]=H(!1);let n,r;ct(()=>{if(i()){const d=u=>{const f=u.target;n?.contains(f)||r?.contains(f)||t(!1)};document.addEventListener("pointerdown",d),mt(()=>document.removeEventListener("pointerdown",d))}});const e=()=>An.find(u=>u.type===b.selectedConnectionRelType)||An[0],o=d=>{Rh(d),Z(d),t(!1)},l=d=>{d.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},s=()=>{c()||Z(b.selectedConnectionRelType),t(!i())},a=()=>e(),c=()=>An.some(d=>d.type===b.selectedTool),h=()=>{if(!n)return{};const d=n.getBoundingClientRect();return window.innerWidth<=768?{top:`${d.bottom+8}px`,left:"50%",transform:"translateX(-50%)"}:{top:`${d.bottom+4}px`,left:`${d.left}px`}};return(()=>{var d=Fg(),u=d.firstChild,f=u.firstChild;u.$$contextmenu=l,u.$$click=s;var g=n;return typeof g=="function"?tt(g,u):n=u,I(f,()=>{const p=a().icon;return _(p,{size:20})},null),I(f,_(It,{size:10,class:"submenu-indicator"}),null),I(d,_(q,{get when(){return i()},get children(){return _($t,{get children(){var p=zg(),m=r;return typeof m=="function"?tt(m,p):r=p,I(p,()=>An.map(y=>(()=>{var w=Wg();return kt(w,"click",()=>o(y.type)),I(w,_(y.icon,{size:18})),N(v=>{var x=`dropdown-item ${b.selectedTool===y.type?"active":""}`,k=y.label;return x!==v.e&&it(w,v.e=x),k!==v.t&&L(w,"title",v.t=k),v},{e:void 0,t:void 0}),w})())),N(y=>Rt(p,h(),y)),p}})}}),null),N(p=>{var m=`toolbar-btn ${c()?"active":""}`,y=a().label;return m!==p.e&&it(u,p.e=m),y!==p.t&&L(u,"title",p.t=y),p},{e:void 0,t:void 0}),d})()};ht(["click","contextmenu"]);var Zg=$('<div class=toolbar-container><div class=drag-handle title="Drag to move toolbar"><div class=drag-dots></div></div><input type=file accept=image/* style=display:none>'),Tn=$("<button>");const xe=[{type:"pan",icon:Gl,label:"Pan Tool (H)"},{type:"selection",icon:Vl,label:"Selection (V or 1)"},{type:"rectangle",icon:Kn,label:"Rectangle (R or 2)"},{type:"circle",icon:Ki,label:"Circle (O or 3)"},{type:"diamond",icon:Ql,label:"Diamond (D)"},{type:"arrow",icon:Zl,label:"Arrow (A or 5)"},{type:"line",icon:tr,label:"Line (L or 4)"},{type:"bezier",icon:Jl,label:"Bezier Curve (B or 0)"},{type:"text",icon:Kl,label:"Text (T or 6)"},{type:"block-text",icon:tc,label:"Block Text (Sketchnote)"},{type:"image",icon:ec,label:"Insert Image (I or 9)"},{type:"eraser",icon:nc,label:"Eraser (E or 7)"},{type:"laser",icon:Ji,label:"Laser Pointer (Shift+P)"},{type:"ink",icon:ic,label:"Ink Overlay (Alt+I)"}],Jg=()=>{let i=null;const[t,n]=H({x:0,y:0}),[r,e]=H(!1),[o,l]=H({x:0,y:0}),s=p=>{const m=p.target;(m.classList.contains("toolbar-container")||m.closest(".drag-handle"))&&(e(!0),l({x:p.clientX-t().x,y:p.clientY-t().y}),p.preventDefault())},a=p=>{r()&&n({x:p.clientX-o().x,y:p.clientY-o().y})},c=()=>{e(!1)};ye(()=>{window.addEventListener("mousemove",a),window.addEventListener("mouseup",c),mt(()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",c)})});const h=p=>{if(p==="image")i?.click();else if(p==="block-text"){const m=prompt("Enter text to generate (A-Z):");if(m){const y=window.innerWidth/2-b.viewState.panX,w=window.innerHeight/2-b.viewState.panY,v=Mf(m,y-m.length*30,w,80,"#000000");P("elements",[...b.elements,...v]),P("selection",v.map(x=>x.id)),Z("selection")}}else Z(p)},d=p=>{p.preventDefault(),P("showPropertyPanel",!0),P("isPropertyPanelMinimized",!1)},u=p=>{const m=p.target.files?.[0];if(!m)return;const y=new FileReader;y.onload=w=>{const v=w.target?.result;if(v){const x=new Image;x.src=v,x.onload=()=>{let S=x.width,M=x.height;if(S>1500||M>1500){const E=S/M;S>M?(S=1500,M=S/E):(M=1500,S=M*E)}const C=document.createElement("canvas");C.width=S,C.height=M;const R=C.getContext("2d");if(R){R.drawImage(x,0,0,S,M);const E=C.toDataURL("image/webp",.8),O=500;let z=S,F=M;if(z>O||F>O){const U=z/F;z>F?(z=O,F=z/U):(F=O,z=F*U)}ge({id:crypto.randomUUID(),type:"image",x:100,y:100,width:z,height:F,strokeColor:"transparent",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:0,strokeStyle:"solid",roughness:0,opacity:100,angle:0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,dataURL:E,mimeType:"image/webp",layerId:b.activeLayerId})}}}},y.readAsDataURL(m),p.target.value=""},f=xe.findIndex(p=>p.type==="diamond"),g=xe.findIndex(p=>p.type==="bezier");return(()=>{var p=Zg(),m=p.firstChild,y=m.nextSibling;return p.$$mousedown=s,p.$$contextmenu=w=>w.preventDefault(),y.addEventListener("change",u),tt(w=>i=w,y),I(p,_(zt,{get each(){return xe.slice(0,2)},children:w=>(()=>{var v=Tn();return v.$$contextmenu=d,v.$$click=()=>h(w.type),I(v,_(w.icon,{size:20})),N(x=>{var k=`toolbar-btn ${b.selectedTool===w.type?"active":""}`,S=w.label;return k!==x.e&&it(v,x.e=k),S!==x.t&&L(v,"title",x.t=S),x},{e:void 0,t:void 0}),v})()}),null),I(p,_(Lf,{}),null),I(p,_(zt,{get each(){return xe.slice(2,f+1)},children:w=>(()=>{var v=Tn();return v.$$contextmenu=d,v.$$click=()=>h(w.type),I(v,_(w.icon,{size:20})),N(x=>{var k=`toolbar-btn ${b.selectedTool===w.type?"active":""}`,S=w.label;return k!==x.e&&it(v,x.e=k),S!==x.t&&L(v,"title",x.t=S),x},{e:void 0,t:void 0}),v})()}),null),I(p,_(Ef,{}),null),I(p,_(Jp,{}),null),I(p,_(kp,{}),null),I(p,_(C0,{}),null),I(p,_(Y0,{}),null),I(p,_(ug,{}),null),I(p,_(Lg,{}),null),I(p,_(Qg,{}),null),I(p,_(Cp,{}),null),I(p,_(Gp,{}),null),I(p,_(Op,{}),null),I(p,_(n0,{}),null),I(p,_(s0,{}),null),I(p,_(zt,{get each(){return xe.slice(f+1,g+1)},children:w=>(()=>{var v=Tn();return v.$$contextmenu=d,v.$$click=()=>h(w.type),I(v,_(w.icon,{size:20})),N(x=>{var k=`toolbar-btn ${b.selectedTool===w.type?"active":""}`,S=w.label;return k!==x.e&&it(v,x.e=k),S!==x.t&&L(v,"title",x.t=S),x},{e:void 0,t:void 0}),v})()}),null),I(p,_(zt,{get each(){return xe.slice(g+1)},children:w=>(()=>{var v=Tn();return v.$$contextmenu=d,v.$$click=()=>h(w.type),I(v,_(w.icon,{size:20})),N(x=>{var k=`toolbar-btn ${b.selectedTool===w.type?"active":""}`,S=w.label;return k!==x.e&&it(v,x.e=k),S!==x.t&&L(v,"title",x.t=S),x},{e:void 0,t:void 0}),v})()}),null),N(w=>{var v=!!r(),x=`translateX(-50%) translate(${t().x}px, ${t().y}px)`;return v!==w.e&&p.classList.toggle("dragging",w.e=v),x!==w.t&&ot(p,"transform",w.t=x),w},{e:void 0,t:void 0}),p})()};ht(["contextmenu","mousedown","click"]);var Kg=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><path d="M7 1 L13 7 L7 13 L1 7 Z">'),ty=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><rect x=1 y=1 width=12 height=12 rx=1></rect><line x1=1 y1=5 x2=13 y2=5></line><line x1=1 y1=9 x2=13 y2=9>'),ey=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><circle cx=7 cy=7 r=5.5></circle><line x1=1.5 y1=7 x2=12.5 y2=7></line><ellipse cx=7 cy=7 rx=3 ry=5.5>'),ny=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><rect x=1 y=2 width=12 height=10 rx=1.5></rect><line x1=1 y1=5 x2=13 y2=5></line><circle cx=3 cy=3.5 r=0.5 fill=currentColor></circle><circle cx=5 cy=3.5 r=0.5 fill=currentColor>'),iy=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><path d="M3 11 L7 2 L11 11"></path><line x1=4.5 y1=8 x2=9.5 y2=8></line><circle cx=7 cy=2 r=1 fill=currentColor>'),ry=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><circle cx=7 cy=4 r=2.5></circle><path d="M3 13 Q3 9 7 9 Q11 9 11 13">'),oy=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><rect x=1 y=1 width=12 height=12 rx=2></rect><path d="M4 7 L6 9.5 L10 4.5">'),sy=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><path d="M2 7 Q5 2 8 7 Q11 12 13 7"></path><circle cx=13 cy=7 r=1.5 fill=currentColor stroke=none></circle><line x1=1 y1=4 x2=3.5 y2=4 opacity=0.5></line><line x1=0.5 y1=7 x2=2 y2=7 opacity=0.3></line><line x1=1 y1=10 x2=3.5 y2=10 opacity=0.5>'),ay=$('<svg width=14 height=14 viewBox="0 0 14 14"fill=none stroke=currentColor stroke-width=1.5><path d="M2 12 Q4 4 12 2"></path><path d="M8 2 L12 2 L12 6">'),ly=$('<div style="position:absolute;top:150px;left:120px;transform:rotate(-5deg);opacity:0;animation:welcomeFadeIn 0.6s ease-out 0.8s forwards">Export, preferences, languages...'),cy=$('<div style="position:absolute;top:100px;right:150px;transform:rotate(-5deg);opacity:0;animation:welcomeFadeIn 0.6s ease-out 1s forwards;text-align:right;max-width:150px">New! P3 Color Picker'),hy=$('<div style="position:absolute;top:20%;left:60%;transform:rotate(5deg);opacity:0;animation:welcomeFadeIn 0.6s ease-out 0.9s forwards;max-width:200px">Pick a tool & start drawing!'),dy=$('<div style="position:absolute;bottom:120px;left:300px;text-align:left;opacity:0;animation:welcomeFadeIn 0.6s ease-out 1.1s forwards">Shortcuts & help'),uy=$('<div style="position:absolute;top:50%;left:60px;transform:translateY(-50%);display:flex;flex-direction:column;gap:0.6rem;font-family:Inter, sans-serif;font-size:0.85rem;max-width:220px;opacity:0;animation:welcomeSlideInLeft 0.6s ease-out 0.3s forwards">'),fy=$('<div style="position:absolute;top:50%;right:60px;transform:translateY(-50%);display:flex;flex-direction:column;gap:0.6rem;font-family:Inter, sans-serif;font-size:0.85rem;max-width:220px;opacity:0;animation:welcomeSlideInRight 0.6s ease-out 0.3s forwards">'),py=$(`<div style="position:absolute;inset:0;pointer-events:none;z-index:10;color:var(--text-secondary, #6b7280);font-family:Virgil, Segoe UI Emoji, sans-serif;overflow:hidden"><style>
                    @keyframes welcomeFadeInUp {
                        from { opacity: 0; transform: translateY(16px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    @keyframes welcomeFadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes welcomeSlideInLeft {
                        from { opacity: 0; transform: translate(-20px, -50%); }
                        to { opacity: 0.7; transform: translate(0, -50%); }
                    }
                    @keyframes welcomeSlideInRight {
                        from { opacity: 0; transform: translate(20px, -50%); }
                        to { opacity: 0.7; transform: translate(0, -50%); }
                    }
                    @keyframes welcomeScaleIn {
                        from { opacity: 0; transform: scale(0.85); }
                        to { opacity: 1; transform: scale(1); }
                    }
                    @keyframes welcomePillIn {
                        from { opacity: 0; transform: translateY(8px) scale(0.9); }
                        to { opacity: 1; transform: translateY(0) scale(1); }
                    }
                </style><canvas style=position:absolute;top:0;left:0;width:100%;height:100%></canvas><div style="position:absolute;top:45%;left:50%;transform:translate(-50%, -50%);text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem"><h1 style="font-size:5rem;margin:0;line-height:1.2;display:flex;align-items:baseline;gap:0.2rem;opacity:0;animation:welcomeScaleIn 0.7s ease-out 0.1s forwards"><span style="background:linear-gradient(135deg, color(display-p3 0 0.5 1), color(display-p3 0.2 0.6 1));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Yappy</span><span style="background:linear-gradient(135deg, color(display-p3 1 0.8 0), color(display-p3 1 0.9 0.2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Draw</span></h1><p style="font-size:1.2rem;opacity:0;animation:welcomeFadeIn 0.5s ease-out 0.3s forwards">All your data is saved locally in your browser.</p><div style="margin-top:2rem;display:grid;grid-template-columns:auto auto;gap:1rem 3rem;text-align:left;font-family:Inter, sans-serif;font-size:0.9rem;opacity:0;animation:welcomeFadeInUp 0.5s ease-out 0.5s forwards"><span>Open</span><strong>Ctrl+Alt+O</strong><span>Smart Palette</span><strong>Ctrl+K</strong><span>Help</span><strong>?</strong></div><div style=margin-top:2rem;display:flex;flex-wrap:wrap;justify-content:center;gap:0.5rem;max-width:480px>`),ao=$('<div style=display:flex;align-items:center;gap:0.5rem;opacity:0><span style="color:color(display-p3 0.2 0.7 0.4);font-size:1rem;flex-shrink:0"></span><span>'),gy=$('<div style="display:inline-flex;align-items:center;gap:0.35rem;padding:0.3rem 0.7rem;border-radius:999px;font-family:Inter, sans-serif;font-size:0.75rem;white-space:nowrap;opacity:0">');const yy=()=>{const[i,t]=H(),n=()=>b.elements.length===0&&b.selectedTool==="selection"&&b.appMode!=="presentation"&&!b.zenMode,[r,e]=H({width:window.innerWidth,height:window.innerHeight});ct(()=>{const c=()=>{e({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",c),mt(()=>window.removeEventListener("resize",c))}),ct(()=>{const c=i();if(!c||!n())return;const h=c.getContext("2d");if(!h)return;const{width:d,height:u}=r(),f=d<768,g=window.devicePixelRatio||1;c.width=d*g,c.height=u*g,h.scale(g,g),c.style.width=`${d}px`,c.style.height=`${u}px`;const p=Ue.canvas(c),m=d/2,y=u/2,w={id:"mock",type:"arrow",strokeColor:"#9ca3af",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"dashed",roughness:1.5,opacity:100,angle:0,renderStyle:"sketch",seed:1,locked:!1,link:null,layerId:"layer1",roundness:null,curveType:"bezier",startArrowhead:null,endArrowhead:"arrow",strokeLineJoin:"round",width:0,height:0,x:0,y:0},v=(M,C)=>({...w,id:crypto.randomUUID(),x:0,y:0,width:d,height:u,points:M,controlPoints:C}),x=M=>{te(p,h,M,b.globalSettings.theme==="dark",1)};if(!f){const M=v([{x:m-200,y:y-100},{x:100,y:60}],[{x:m-250,y:y-200},{x:200,y:150}]);x(M);const C=v([{x:m+50,y:y-150},{x:m,y:80}],[{x:m+20,y:150},{x:m+10,y:100}]);x(C);const R=v([{x:m+250,y:y-100},{x:d-100,y:60}],[{x:d-180,y:120},{x:d-140,y:90}]);x(R)}const k=f?60:310,S=u-65;if(d>400){const M=v([{x:m-150,y:y+(f?50:100)},{x:k,y:S}],[{x:m-(f?50:200),y:y+(f?100:150)},{x:k+20,y:S-30}]);x(M)}});const o=["100+ shapes & icons","Sketch & Architectural modes","UML & Flowchart diagrams","Cloud infrastructure shapes","Freehand drawing tools","Smart connectors & arrows","20+ preset animations","Path & morph animations"],l=["P3 wide-gamut colors","Gradient & pattern fills","Dark mode support","100% local & private","Slide transitions & builds","Spin, orbit & flow physics","Presentation mode","Export PNG, SVG, JSON"],s=[{label:"Flowcharts",icon:"diamond",color:"color(display-p3 0.3 0.6 1)"},{label:"UML",icon:"class",color:"color(display-p3 0.6 0.3 0.9)"},{label:"Cloud Infra",icon:"cloud",color:"color(display-p3 0.2 0.7 0.9)"},{label:"Wireframes",icon:"browser",color:"color(display-p3 0.5 0.5 0.6)"},{label:"Sketchnotes",icon:"sketch",color:"color(display-p3 0.9 0.6 0.1)"},{label:"People",icon:"people",color:"color(display-p3 0.8 0.4 0.5)"},{label:"Annotations",icon:"status",color:"color(display-p3 0.2 0.75 0.5)"},{label:"Animations",icon:"motion",color:"color(display-p3 1 0.4 0.3)"},{label:"Connectors",icon:"arrow",color:"color(display-p3 0.6 0.6 0.7)"}],a=c=>{switch(c){case"diamond":return Kg();case"class":return ty();case"cloud":return ey();case"browser":return ny();case"sketch":return iy();case"people":return ry();case"status":return oy();case"motion":return sy();case"arrow":return ay();default:return null}};return _(q,{get when(){return n()},get children(){var c=py(),h=c.firstChild,d=h.nextSibling,u=d.nextSibling,f=u.firstChild,g=f.firstChild;g.nextSibling;var p=f.nextSibling,m=p.nextSibling,y=m.nextSibling;return tt(t,d),I(c,_(q,{get when(){return r().width>768},get children(){return[ly(),cy(),hy(),dy()]}}),u),I(c,_(q,{get when(){return r().width>1100},get children(){var w=uy();return I(w,_(zt,{each:o,children:(v,x)=>(()=>{var k=ao(),S=k.firstChild,M=S.nextSibling;return I(M,v),N(C=>ot(k,"animation",`welcomeFadeInUp 0.4s ease-out ${.4+x()*.08}s forwards`)),k})()})),w}}),u),I(c,_(q,{get when(){return r().width>1100},get children(){var w=fy();return I(w,_(zt,{each:l,children:(v,x)=>(()=>{var k=ao(),S=k.firstChild,M=S.nextSibling;return I(M,v),N(C=>ot(k,"animation",`welcomeFadeInUp 0.4s ease-out ${.4+x()*.08}s forwards`)),k})()})),w}}),u),I(y,_(zt,{each:s,children:(w,v)=>(()=>{var x=gy();return I(x,()=>a(w.icon),null),I(x,()=>w.label,null),N(k=>{var S=`1.5px solid ${w.color}`,M=w.color,C=`welcomePillIn 0.4s ease-out ${.7+v()*.06}s forwards`;return S!==k.e&&ot(x,"border",k.e=S),M!==k.t&&ot(x,"color",k.t=M),C!==k.a&&ot(x,"animation",k.a=C),k},{e:void 0,t:void 0,a:void 0}),x})()})),c}})},my={enableWorkspacePersistence:!1},by=i=>i&&(i.version===3||i.version===4)&&Array.isArray(i.slides),Ya="default-layer",wy=i=>({id:i.id,type:i.type,x:i.x??0,y:i.y??0,width:i.width??100,height:i.height??100,strokeColor:i.strokeColor??"#000000",backgroundColor:i.backgroundColor??"transparent",fillStyle:i.fillStyle??"hachure",strokeWidth:i.strokeWidth??1,strokeStyle:i.strokeStyle??"solid",roughness:i.roughness??1,opacity:i.opacity??100,angle:i.angle??0,renderStyle:i.renderStyle??"sketch",seed:i.seed??Math.floor(Math.random()*2147483647),roundness:i.roundness??null,locked:i.locked??!1,link:i.link??null,layerId:i.layerId||Ya,...i.points&&{points:i.points},...i.pointsEncoding!==void 0&&{pointsEncoding:i.pointsEncoding},...i.startArrowhead!==void 0&&{startArrowhead:i.startArrowhead},...i.endArrowhead!==void 0&&{endArrowhead:i.endArrowhead},...i.text!==void 0&&{text:i.text},...i.rawText!==void 0&&{rawText:i.rawText},...i.fontSize!==void 0&&{fontSize:i.fontSize},...i.fontFamily!==void 0&&{fontFamily:i.fontFamily},...i.fontWeight!==void 0&&{fontWeight:i.fontWeight},...i.fontStyle!==void 0&&{fontStyle:i.fontStyle},...i.textAlign!==void 0&&{textAlign:i.textAlign},...i.verticalAlign!==void 0&&{verticalAlign:i.verticalAlign},...i.textColor!==void 0&&{textColor:i.textColor},...i.textHighlightEnabled!==void 0&&{textHighlightEnabled:i.textHighlightEnabled},...i.textHighlightColor!==void 0&&{textHighlightColor:i.textHighlightColor},...i.textHighlightPadding!==void 0&&{textHighlightPadding:i.textHighlightPadding},...i.textHighlightRadius!==void 0&&{textHighlightRadius:i.textHighlightRadius},...i.containerId!==void 0&&{containerId:i.containerId},...i.containerText!==void 0&&{containerText:i.containerText},...i.labelPosition!==void 0&&{labelPosition:i.labelPosition},...i.fileId!==void 0&&{fileId:i.fileId},...i.scale!==void 0&&{scale:i.scale},...i.crop!==void 0&&{crop:i.crop},...i.status!==void 0&&{status:i.status},...i.dataURL!==void 0&&{dataURL:i.dataURL},...i.mimeType!==void 0&&{mimeType:i.mimeType},...i.groupIds!==void 0&&{groupIds:i.groupIds},...i.boundElements!==void 0&&{boundElements:i.boundElements},...i.isSelected!==void 0&&{isSelected:i.isSelected},...i.startBinding!==void 0&&{startBinding:i.startBinding},...i.endBinding!==void 0&&{endBinding:i.endBinding},...i.curveType!==void 0&&{curveType:i.curveType},...i.parentId!==void 0&&{parentId:i.parentId},...i.isCollapsed!==void 0&&{isCollapsed:i.isCollapsed},...i.constrained!==void 0&&{constrained:i.constrained},...i.autoResize!==void 0&&{autoResize:i.autoResize},...i.starPoints!==void 0&&{starPoints:i.starPoints},...i.polygonSides!==void 0&&{polygonSides:i.polygonSides},...i.borderRadius!==void 0&&{borderRadius:i.borderRadius},...i.burstPoints!==void 0&&{burstPoints:i.burstPoints},...i.tailPosition!==void 0&&{tailPosition:i.tailPosition},...i.shapeRatio!==void 0&&{shapeRatio:i.shapeRatio},...i.drawInnerBorder!==void 0&&{drawInnerBorder:i.drawInnerBorder},...i.innerBorderColor!==void 0&&{innerBorderColor:i.innerBorderColor},...i.innerBorderDistance!==void 0&&{innerBorderDistance:i.innerBorderDistance},...i.strokeLineJoin!==void 0&&{strokeLineJoin:i.strokeLineJoin},...i.fillDensity!==void 0&&{fillDensity:i.fillDensity},...i.shadowEnabled!==void 0&&{shadowEnabled:i.shadowEnabled},...i.shadowColor!==void 0&&{shadowColor:i.shadowColor},...i.shadowBlur!==void 0&&{shadowBlur:i.shadowBlur},...i.shadowOffsetX!==void 0&&{shadowOffsetX:i.shadowOffsetX},...i.shadowOffsetY!==void 0&&{shadowOffsetY:i.shadowOffsetY},...i.gradientStart!==void 0&&{gradientStart:i.gradientStart},...i.gradientEnd!==void 0&&{gradientEnd:i.gradientEnd},...i.gradientDirection!==void 0&&{gradientDirection:i.gradientDirection},...i.gradientStops!==void 0&&{gradientStops:i.gradientStops},...i.gradientType!==void 0&&{gradientType:i.gradientType},...i.gradientHandlePositions!==void 0&&{gradientHandlePositions:i.gradientHandlePositions},...i.blendMode!==void 0&&{blendMode:i.blendMode},...i.filter!==void 0&&{filter:i.filter},...i.entranceAnimation!==void 0&&{entranceAnimation:i.entranceAnimation},...i.animations!==void 0&&{animations:i.animations},...i.controlPoints!==void 0&&{controlPoints:i.controlPoints},...i.flowAnimation!==void 0&&{flowAnimation:i.flowAnimation},...i.flowSpeed!==void 0&&{flowSpeed:i.flowSpeed},...i.flowStyle!==void 0&&{flowStyle:i.flowStyle},...i.flowColor!==void 0&&{flowColor:i.flowColor},...i.flowDensity!==void 0&&{flowDensity:i.flowDensity},...i.isMotionPath!==void 0&&{isMotionPath:i.isMotionPath}}),vy=i=>i.map(t=>wy(t)),xy=i=>{const n=(i.layers||[{id:Ya,name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent",colorTag:void 0,parentId:void 0,isGroup:!1,expanded:!0}]).map(e=>({...e,parentId:e.parentId,isGroup:e.isGroup??!1,expanded:e.expanded??!0}));return{elements:vy(i.elements||[]),layers:n,viewState:i.viewState||{scale:1,panX:0,panY:0},gridSettings:i.gridSettings,globalSettings:i.globalSettings,canvasBackgroundColor:i.canvasBackgroundColor,states:i.states||[],initialStateId:i.initialStateId}},qi=i=>i&&(i.version===3||i.version===4)&&Array.isArray(i.slides),Hi=i=>{if(qi(i))return i;const t=xy(i),n={id:crypto.randomUUID(),name:"Slide 1",spatialPosition:{x:0,y:0},dimensions:{width:1920,height:1080},backgroundColor:t.canvasBackgroundColor||"#ffffff",order:0};return{version:4,metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},elements:t.elements,layers:t.layers,slides:[n],globalSettings:i.globalSettings||{},gridSettings:t.gridSettings,states:t.states}};class ky{baseUrl="/api/drawings";async saveDrawing(t,n){let r;by(n)?r={...n,metadata:{...n.metadata,updatedAt:new Date().toISOString()}}:r=Hi(n),r.version===4&&r.elements&&(r.elements=r.elements.map(c=>{if((c.type==="fineliner"||c.type==="inkbrush"||c.type==="marker")&&c.points&&typeof c.points[0]!="number"){const h=[];return c.points.forEach(d=>{h.push(d.x,d.y)}),{...c,points:h,pointsEncoding:"flat"}}return c})),r.slides&&(r.slides=r.slides.map(c=>{const h={...c};return h.elements&&(h.elements=h.elements.map(d=>{if((d.type==="fineliner"||d.type==="inkbrush"||d.type==="marker")&&d.points&&typeof d.points[0]!="number"){const u=[];return d.points.forEach(f=>{u.push(f.x,f.y)}),{...d,points:u,pointsEncoding:"flat"}}return d})),h}));const e=JSON.stringify(r),o=new Blob([e]).stream().pipeThrough(new CompressionStream("gzip")),s=await new Response(o).blob(),a=await fetch(`${this.baseUrl}/${t}`,{method:"POST",headers:{"Content-Type":"application/gzip"},body:s});if(!a.ok){const c=await a.json().catch(()=>({error:"Unknown server error"}));throw new Error(c.error||`Failed to save: ${a.statusText}`)}}async loadDrawing(t){const n=await fetch(`${this.baseUrl}/${t}`);if(!n.ok)return null;const r=n.headers.get("content-type");let e;if(r&&(r.includes("application/gzip")||r.includes("application/x-gzip")||r.includes("application/octet-stream")))try{const o=new DecompressionStream("gzip"),l=n.body.pipeThrough(o);e=await new Response(l).text()}catch(o){console.warn("Decompression failed, falling back to text",o),e=await n.text()}else e=await n.text();return JSON.parse(e)}async listDrawings(){const t=await fetch(this.baseUrl);return t.ok?await t.json():[]}async deleteDrawing(t){const n=await fetch(`${this.baseUrl}/${t}`,{method:"DELETE"});if(!n.ok){const r=await n.json().catch(()=>({error:"Unknown server error"}));throw new Error(r.error||`Failed to delete: ${n.statusText}`)}}}const lo=new ky;function Sy(i){const{l:t,c:n,h:r}=i,e=r*Math.PI/180,o=n*Math.cos(e),l=n*Math.sin(e),s=t+.3963377774*o+.2158037573*l,a=t-.1055613458*o-.0638541728*l,c=t-.0894841775*o-1.291485548*l,h=s*s*s,d=a*a*a,u=c*c*c,f=1.2270138511*h-.5577999807*d+.2812561489*u,g=-.0405801784*h+1.1122568696*d-.0716766787*u,p=-.0763812845*h-.4214819787*d+1.5861632204*u,m=2.4039459*f-.9898517*g-.4141151*p,y=-.7797967*f+1.5445214*g+.0352745*p,w=.0384795*f-.1141381*g+1.0756786*p,v=x=>{const k=Math.abs(x),S=k>.0031308?1.055*Math.pow(k,1/2.4)-.055:12.92*k;return x<0?-S:S};return{r:v(m),g:v(y),b:v(w)}}function Ln(i){return`oklch(${(i.l*100).toFixed(2)}% ${i.c.toFixed(4)} ${i.h.toFixed(2)})`}function My(i){return i.r>=-.001&&i.r<=1+.001&&i.g>=-.001&&i.g<=1+.001&&i.b>=-.001&&i.b<=1+.001}var Py=$('<div style=padding:8px;display:flex;flex-direction:column;gap:12px><div style=position:relative><canvas width=200 height=150 style="width:100%;height:150px;cursor:crosshair;border-radius:8px;border:1px solid rgba(0,0,0,0.1);display:block"></canvas></div><div style="height:12px;width:100%;border-radius:6px;cursor:pointer;position:relative;background:linear-gradient(to right, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000)"><div style="position:absolute;top:50%;transform:translate(-50%, -50%);width:16px;height:16px;background:white;border:2px solid black;border-radius:50%;pointer-events:none"></div></div><div style=display:flex;align-items:center;gap:8px;font-size:11px;font-family:monospace;color:var(--text-secondary)><div style="width:32px;height:32px;border-radius:4px;border:1px solid rgba(0,0,0,0.1)"></div><div><div>');const Cy=i=>{const[t,n]=H({l:.8,c:.15,h:200});let r,e;ct(()=>{const s=t().h;if(!r)return;const a=r.getContext("2d",{colorSpace:"display-p3"});if(!a)return;const c=r.width,h=r.height,d=a.createImageData(c,h),u=d.data;for(let p=0;p<h;p++){const m=1-p/h;for(let y=0;y<c;y++){const w=y/c*.4,v=Sy({l:m,c:w,h:s}),x=My(v),k=(p*c+y)*4;if(x)u[k]=Math.round(v.r*255),u[k+1]=Math.round(v.g*255),u[k+2]=Math.round(v.b*255),u[k+3]=255;else{const M=(Math.floor(y/5)+Math.floor(p/5))%2===0?30:20;u[k]=M,u[k+1]=M,u[k+2]=M,u[k+3]=255}}}a.putImageData(d,0,0);const f=t().c/.4*c,g=(1-t().l)*h;a.strokeStyle="white",a.lineWidth=2,a.beginPath(),a.arc(f,g,5,0,Math.PI*2),a.stroke(),a.strokeStyle="black",a.lineWidth=1,a.beginPath(),a.arc(f,g,6,0,Math.PI*2),a.stroke()});const o=s=>{s.stopPropagation();const a=d=>{if(!r)return;const u=r.getBoundingClientRect(),f=Math.min(Math.max(d.clientX-u.left,0),u.width),p=1-Math.min(Math.max(d.clientY-u.top,0),u.height)/u.height,m=f/u.width*.4;n(y=>({...y,l:p,c:m})),i.onSelect(Ln(t()))};a(s);const c=d=>a(d),h=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",h)},l=s=>{s.stopPropagation();const a=d=>{if(!e)return;const u=e.getBoundingClientRect(),g=Math.min(Math.max(d.clientX-u.left,0),u.width)/u.width*360;n(p=>({...p,h:g})),i.onSelect(Ln(t()))};a(s);const c=d=>a(d),h=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",h)};return(()=>{var s=Py(),a=s.firstChild,c=a.firstChild,h=a.nextSibling,d=h.firstChild,u=h.nextSibling,f=u.firstChild,g=f.nextSibling,p=g.firstChild;c.$$mousedown=o;var m=r;typeof m=="function"?tt(m,c):r=c,h.$$mousedown=l;var y=e;return typeof y=="function"?tt(y,h):e=h,I(p,()=>Ln(t())),N(w=>{var v=`${t().h/360*100}%`,x=Ln(t());return v!==w.e&&ot(d,"left",w.e=v),x!==w.t&&ot(f,"background",w.t=x),w},{e:void 0,t:void 0}),s})()};ht(["mousedown"]);var _y=$('<div style=padding:8px><div style=font-size:10px;font-weight:bold;color:var(--text-secondary);margin-bottom:4px>P3 COLORS</div><div style="display:grid;grid-template-columns:repeat(5, 1fr);gap:8px;margin-bottom:12px"><button title="Advanced Picker"style="width:24px;height:24px;background:var(--toolbar-bg);border-radius:6px;cursor:pointer;border:1px dashed var(--border-color);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--text-secondary)">+</button></div><div style=font-size:10px;font-weight:bold;color:var(--text-secondary);margin-bottom:4px>BACKGROUNDS</div><div style="display:grid;grid-template-columns:repeat(5, 1fr);gap:8px">'),Ay=$("<div>"),Ty=$('<div><div style="padding:4px 8px;display:flex;justify-content:space-between;align-items:center"><span style=font-size:12px;font-weight:bold>OKLCH Picker</span><button style=background:none;border:none;cursor:pointer;font-size:12px;color:var(--text-secondary)>Back'),Ly=$('<div style="width:24px;height:24px;border-radius:6px;cursor:grab;border:1px solid rgba(0,0,0,0.1);transition:transform 0.2s">'),Iy=$('<div style="width:24px;height:24px;background-size:cover;background-position:center;border-radius:6px;cursor:grab;border:1px solid rgba(0,0,0,0.1);transition:transform 0.2s">');const $y=[{name:"P3 Red",value:"color(display-p3 1 0 0)"},{name:"P3 Green",value:"color(display-p3 0 1 0)"},{name:"P3 Blue",value:"color(display-p3 0 0 1)"},{name:"P3 Yellow",value:"color(display-p3 1 1 0)"},{name:"P3 Magenta",value:"color(display-p3 1 0 1)"},{name:"P3 Cyan",value:"color(display-p3 0 1 1)"},{name:"P3 Orange",value:"color(display-p3 1 0.5 0)"},{name:"P3 Purple",value:"color(display-p3 0.5 0 1)"},{name:"P3 Pink",value:"color(display-p3 1 0 0.5)"}],Ry=[{name:"Noise Texture",value:"https://www.transparenttextures.com/patterns/asfalt-dark.png"},{name:"Paper Texture",value:"https://www.transparenttextures.com/patterns/paper.png"},{name:"Carbon Fiber",value:"https://www.transparenttextures.com/patterns/carbon-fibre.png"},{name:"Gradient Blue",value:"https://images.unsplash.com/photo-1557683316-973673baf926?q=80&w=320"},{name:"Gradient Sunset",value:"https://images.unsplash.com/photo-1557683311-eac922347aa1?q=80&w=320"}],Ey=()=>{const[i,t]=H(!1),n=e=>{const o=e.startsWith("http")||e.startsWith("data:image");b.selection.length>0?(Q(),b.selection.forEach(l=>{o?D(l,{type:"image",dataURL:e}):D(l,{backgroundColor:e,fillStyle:"solid"})})):b.docType==="slides"&&(Q(),o?ce(b.activeSlideIndex,{backgroundImage:e,fillStyle:"image"}):ce(b.activeSlideIndex,{backgroundColor:e,fillStyle:"solid"}))},r=(e,o)=>{if(e.dataTransfer){e.dataTransfer.setData("text/plain",o),e.dataTransfer.effectAllowed="copy";const l=o.startsWith("http")||o.startsWith("data:image"),s=document.createElement("div");s.style.width="32px",s.style.height="32px",l?(s.style.backgroundImage=`url(${o})`,s.style.backgroundSize="cover"):s.style.background=o,s.style.borderRadius="4px",s.style.position="absolute",s.style.top="-1000px",s.style.border="1px solid white",document.body.appendChild(s),e.dataTransfer.setDragImage(s,16,16),setTimeout(()=>document.body.removeChild(s),0)}};return(()=>{var e=Ay();return I(e,_(q,{get when(){return!i()},get fallback(){return(()=>{var o=Ty(),l=o.firstChild,s=l.firstChild,a=s.nextSibling;return a.$$click=()=>t(!1),I(o,_(Cy,{onSelect:n}),null),o})()},get children(){var o=_y(),l=o.firstChild,s=l.nextSibling,a=s.firstChild,c=s.nextSibling,h=c.nextSibling;return I(s,_(zt,{each:$y,children:d=>(()=>{var u=Ly();return u.addEventListener("mouseleave",f=>f.currentTarget.style.transform="scale(1)"),u.addEventListener("mouseenter",f=>f.currentTarget.style.transform="scale(1.2)"),u.$$click=f=>{f.stopPropagation(),n(d.value)},u.$$mousedown=f=>f.stopPropagation(),u.addEventListener("dragstart",f=>{f.stopPropagation(),r(f,d.value)}),L(u,"draggable",!0),N(f=>{var g=`${d.name} (Drag to shape/slide)`,p=d.value;return g!==f.e&&L(u,"title",f.e=g),p!==f.t&&ot(u,"background",f.t=p),f},{e:void 0,t:void 0}),u})()}),a),a.$$click=()=>t(!0),I(h,_(zt,{each:Ry,children:d=>(()=>{var u=Iy();return u.addEventListener("mouseleave",f=>f.currentTarget.style.transform="scale(1)"),u.addEventListener("mouseenter",f=>f.currentTarget.style.transform="scale(1.2)"),u.$$click=f=>{f.stopPropagation(),n(d.value)},u.$$mousedown=f=>f.stopPropagation(),u.addEventListener("dragstart",f=>{f.stopPropagation(),r(f,d.value)}),L(u,"draggable",!0),N(f=>{var g=`${d.name} (Drag to shape/slide)`,p=`url(${d.value})`;return g!==f.e&&L(u,"title",f.e=g),p!==f.t&&ot(u,"background-image",f.t=p),f},{e:void 0,t:void 0}),u})()})),o}})),e})()};ht(["click","mousedown"]);function Ny(i,t){const n=r=>{i.contains(r.target)||t()?.()};document.body.addEventListener("click",n),mt(()=>{document.body.removeEventListener("click",n)})}const Oy='const Ig=(n,t)=>n===t,wi=Symbol("solid-proxy"),Dp=typeof Proxy=="function",jh=Symbol("solid-track"),Hl={equals:Ig};let Fp=Up;const As=1,Yl=2,$p={owned:null,cleanups:null,context:null,owner:null};var cr=null;let Qc=null,Og=null,Kn=null,Cr=null,ns=null,mc=0;function Rl(n,t){const e=Kn,i=cr,r=n.length===0,s=t===void 0?i:t,a=r?$p:{owned:null,cleanups:null,context:s?s.context:null,owner:s},o=r?n:()=>n(()=>Fr(()=>wa(a)));cr=a,Kn=null;try{return Po(o,!0)}finally{Kn=e,cr=i}}function En(n,t){t=t?Object.assign({},Hl,t):Hl;const e={value:n,observers:null,observerSlots:null,comparator:t.equals||void 0},i=r=>(typeof r=="function"&&(r=r(e.value)),jp(e,r));return[zp.bind(e),i]}function Ar(n,t,e){const i=wu(n,t,!1,As);La(i)}function mi(n,t,e){Fp=Bg;const i=wu(n,t,!1,As);i.user=!0,ns?ns.push(i):La(i)}function si(n,t,e){e=e?Object.assign({},Hl,e):Hl;const i=wu(n,t,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=e.equals||void 0,La(i),zp.bind(i)}function Ca(n){return Po(n,!1)}function Fr(n){if(Kn===null)return n();const t=Kn;Kn=null;try{return n()}finally{Kn=t}}function No(n){mi(()=>Fr(n))}function Hs(n){return cr===null||(cr.cleanups===null?cr.cleanups=[n]:cr.cleanups.push(n)),n}function Uh(){return Kn}function zp(){if(this.sources&&this.state)if(this.state===As)La(this);else{const n=Cr;Cr=null,Po(()=>Zl(this),!1),Cr=n}if(Kn){const n=this.observers?this.observers.length:0;Kn.sources?(Kn.sources.push(this),Kn.sourceSlots.push(n)):(Kn.sources=[this],Kn.sourceSlots=[n]),this.observers?(this.observers.push(Kn),this.observerSlots.push(Kn.sources.length-1)):(this.observers=[Kn],this.observerSlots=[Kn.sources.length-1])}return this.value}function jp(n,t,e){let i=n.value;return(!n.comparator||!n.comparator(i,t))&&(n.value=t,n.observers&&n.observers.length&&Po(()=>{for(let r=0;r<n.observers.length;r+=1){const s=n.observers[r],a=Qc&&Qc.running;a&&Qc.disposed.has(s),(a?!s.tState:!s.state)&&(s.pure?Cr.push(s):ns.push(s),s.observers&&Wp(s)),a||(s.state=As)}if(Cr.length>1e6)throw Cr=[],new Error},!1)),t}function La(n){if(!n.fn)return;wa(n);const t=mc;Rg(n,n.value,t)}function Rg(n,t,e){let i;const r=cr,s=Kn;Kn=cr=n;try{i=n.fn(t)}catch(a){return n.pure&&(n.state=As,n.owned&&n.owned.forEach(wa),n.owned=null),n.updatedAt=e+1,qp(a)}finally{Kn=s,cr=r}(!n.updatedAt||n.updatedAt<=e)&&(n.updatedAt!=null&&"observers"in n?jp(n,i):n.value=i,n.updatedAt=e)}function wu(n,t,e,i=As,r){const s={fn:n,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:cr,context:cr?cr.context:null,pure:e};return cr===null||cr!==$p&&(cr.owned?cr.owned.push(s):cr.owned=[s]),s}function Vl(n){if(n.state===0)return;if(n.state===Yl)return Zl(n);if(n.suspense&&Fr(n.suspense.inFallback))return n.suspense.effects.push(n);const t=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<mc);)n.state&&t.push(n);for(let e=t.length-1;e>=0;e--)if(n=t[e],n.state===As)La(n);else if(n.state===Yl){const i=Cr;Cr=null,Po(()=>Zl(n,t[0]),!1),Cr=i}}function Po(n,t){if(Cr)return n();let e=!1;t||(Cr=[]),ns?e=!0:ns=[],mc++;try{const i=n();return Tg(e),i}catch(i){e||(ns=null),Cr=null,qp(i)}}function Tg(n){if(Cr&&(Up(Cr),Cr=null),n)return;const t=ns;ns=null,t.length&&Po(()=>Fp(t),!1)}function Up(n){for(let t=0;t<n.length;t++)Vl(n[t])}function Bg(n){let t,e=0;for(t=0;t<n.length;t++){const i=n[t];i.user?n[e++]=i:Vl(i)}for(t=0;t<e;t++)Vl(n[t])}function Zl(n,t){n.state=0;for(let e=0;e<n.sources.length;e+=1){const i=n.sources[e];if(i.sources){const r=i.state;r===As?i!==t&&(!i.updatedAt||i.updatedAt<mc)&&Vl(i):r===Yl&&Zl(i,t)}}}function Wp(n){for(let t=0;t<n.observers.length;t+=1){const e=n.observers[t];e.state||(e.state=Yl,e.pure?Cr.push(e):ns.push(e),e.observers&&Wp(e))}}function wa(n){let t;if(n.sources)for(;n.sources.length;){const e=n.sources.pop(),i=n.sourceSlots.pop(),r=e.observers;if(r&&r.length){const s=r.pop(),a=e.observerSlots.pop();i<r.length&&(s.sourceSlots[a]=i,r[i]=s,e.observerSlots[i]=a)}}if(n.tOwned){for(t=n.tOwned.length-1;t>=0;t--)wa(n.tOwned[t]);delete n.tOwned}if(n.owned){for(t=n.owned.length-1;t>=0;t--)wa(n.owned[t]);n.owned=null}if(n.cleanups){for(t=n.cleanups.length-1;t>=0;t--)n.cleanups[t]();n.cleanups=null}n.state=0}function Eg(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function qp(n,t=cr){throw Eg(n)}const Dg=Symbol("fallback");function kf(n){for(let t=0;t<n.length;t++)n[t]()}function Fg(n,t,e={}){let i=[],r=[],s=[],a=0,o=t.length>1?[]:null;return Hs(()=>kf(s)),()=>{let l=n()||[],c=l.length,h,f;return l[jh],Fr(()=>{let u,y,g,w,m,x,_,L,T;if(c===0)a!==0&&(kf(s),s=[],i=[],r=[],a=0,o&&(o=[])),e.fallback&&(i=[Dg],r[0]=Rl(q=>(s[0]=q,e.fallback())),a=1);else if(a===0){for(r=new Array(c),f=0;f<c;f++)i[f]=l[f],r[f]=Rl(d);a=c}else{for(g=new Array(c),w=new Array(c),o&&(m=new Array(c)),x=0,_=Math.min(a,c);x<_&&i[x]===l[x];x++);for(_=a-1,L=c-1;_>=x&&L>=x&&i[_]===l[L];_--,L--)g[L]=r[_],w[L]=s[_],o&&(m[L]=o[_]);for(u=new Map,y=new Array(L+1),f=L;f>=x;f--)T=l[f],h=u.get(T),y[f]=h===void 0?-1:h,u.set(T,f);for(h=x;h<=_;h++)T=i[h],f=u.get(T),f!==void 0&&f!==-1?(g[f]=r[h],w[f]=s[h],o&&(m[f]=o[h]),f=y[f],u.set(T,f)):s[h]();for(f=x;f<c;f++)f in g?(r[f]=g[f],s[f]=w[f],o&&(o[f]=m[f],o[f](f))):r[f]=Rl(d);r=r.slice(0,a=c),i=l.slice(0)}return r});function d(u){if(s[f]=u,o){const[y,g]=En(f);return o[f]=g,t(l[f],y)}return t(l[f])}}}function Re(n,t){return Fr(()=>n(t||{}))}function cl(){return!0}const Wh={get(n,t,e){return t===wi?e:n.get(t)},has(n,t){return t===wi?!0:n.has(t)},set:cl,deleteProperty:cl,getOwnPropertyDescriptor(n,t){return{configurable:!0,enumerable:!0,get(){return n.get(t)},set:cl,deleteProperty:cl}},ownKeys(n){return n.keys()}};function Jc(n){return(n=typeof n=="function"?n():n)?n:{}}function $g(){for(let n=0,t=this.length;n<t;++n){const e=this[n]();if(e!==void 0)return e}}function $r(...n){let t=!1;for(let a=0;a<n.length;a++){const o=n[a];t=t||!!o&&wi in o,n[a]=typeof o=="function"?(t=!0,si(o)):o}if(Dp&&t)return new Proxy({get(a){for(let o=n.length-1;o>=0;o--){const l=Jc(n[o])[a];if(l!==void 0)return l}},has(a){for(let o=n.length-1;o>=0;o--)if(a in Jc(n[o]))return!0;return!1},keys(){const a=[];for(let o=0;o<n.length;o++)a.push(...Object.keys(Jc(n[o])));return[...new Set(a)]}},Wh);const e={},i=Object.create(null);for(let a=n.length-1;a>=0;a--){const o=n[a];if(!o)continue;const l=Object.getOwnPropertyNames(o);for(let c=l.length-1;c>=0;c--){const h=l[c];if(h==="__proto__"||h==="constructor")continue;const f=Object.getOwnPropertyDescriptor(o,h);if(!i[h])i[h]=f.get?{enumerable:!0,configurable:!0,get:$g.bind(e[h]=[f.get.bind(o)])}:f.value!==void 0?f:void 0;else{const d=e[h];d&&(f.get?d.push(f.get.bind(o)):f.value!==void 0&&d.push(()=>f.value))}}}const r={},s=Object.keys(i);for(let a=s.length-1;a>=0;a--){const o=s[a],l=i[o];l&&l.get?Object.defineProperty(r,o,l):r[o]=l?l.value:void 0}return r}function Xp(n,...t){const e=t.length;if(Dp&&wi in n){const r=e>1?t.flat():t[0],s=t.map(a=>new Proxy({get(o){return a.includes(o)?n[o]:void 0},has(o){return a.includes(o)&&o in n},keys(){return a.filter(o=>o in n)}},Wh));return s.push(new Proxy({get(a){return r.includes(a)?void 0:n[a]},has(a){return r.includes(a)?!1:a in n},keys(){return Object.keys(n).filter(a=>!r.includes(a))}},Wh)),s}const i=[];for(let r=0;r<=e;r++)i[r]={};for(const r of Object.getOwnPropertyNames(n)){let s=e;for(let l=0;l<t.length;l++)if(t[l].includes(r)){s=l;break}const a=Object.getOwnPropertyDescriptor(n,r);!a.get&&!a.set&&a.enumerable&&a.writable&&a.configurable?i[s][r]=a.value:Object.defineProperty(i[s],r,a)}return i}const zg=n=>`Stale read from <${n}>.`;function vu(n){const t="fallback"in n&&{fallback:()=>n.fallback};return si(Fg(()=>n.each,n.children,t||void 0))}function rr(n){const t=n.keyed,e=si(()=>n.when,void 0,void 0),i=t?e:si(e,void 0,{equals:(r,s)=>!r==!s});return si(()=>{const r=i();if(r){const s=n.children;return typeof s=="function"&&s.length>0?Fr(()=>s(t?r:()=>{if(!Fr(i))throw zg("Show");return e()})):s}return n.fallback},void 0,void 0)}const jg=["allowfullscreen","async","alpha","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","adauctionheaders","browsingtopics","credentialless","defaultchecked","defaultmuted","defaultselected","defer","disablepictureinpicture","disableremoteplayback","preservespitch","shadowrootclonable","shadowrootcustomelementregistry","shadowrootdelegatesfocus","shadowrootserializable","sharedstoragewritable"],Ug=new Set(["className","value","readOnly","noValidate","formNoValidate","isMap","noModule","playsInline","adAuctionHeaders","allowFullscreen","browsingTopics","defaultChecked","defaultMuted","defaultSelected","disablePictureInPicture","disableRemotePlayback","preservesPitch","shadowRootClonable","shadowRootCustomElementRegistry","shadowRootDelegatesFocus","shadowRootSerializable","sharedStorageWritable",...jg]),Wg=new Set(["innerHTML","textContent","innerText","children"]),qg=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Xg=Object.assign(Object.create(null),{class:"className",novalidate:{$:"noValidate",FORM:1},formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1},adauctionheaders:{$:"adAuctionHeaders",IFRAME:1},allowfullscreen:{$:"allowFullscreen",IFRAME:1},browsingtopics:{$:"browsingTopics",IMG:1},defaultchecked:{$:"defaultChecked",INPUT:1},defaultmuted:{$:"defaultMuted",AUDIO:1,VIDEO:1},defaultselected:{$:"defaultSelected",OPTION:1},disablepictureinpicture:{$:"disablePictureInPicture",VIDEO:1},disableremoteplayback:{$:"disableRemotePlayback",AUDIO:1,VIDEO:1},preservespitch:{$:"preservesPitch",AUDIO:1,VIDEO:1},shadowrootclonable:{$:"shadowRootClonable",TEMPLATE:1},shadowrootdelegatesfocus:{$:"shadowRootDelegatesFocus",TEMPLATE:1},shadowrootserializable:{$:"shadowRootSerializable",TEMPLATE:1},sharedstoragewritable:{$:"sharedStorageWritable",IFRAME:1,IMG:1}});function Gg(n,t){const e=Xg[n];return typeof e=="object"?e[t]?e.$:void 0:e}const Hg=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),Yg=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),Vg={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},va=n=>si(()=>n());function Zg(n,t,e){let i=e.length,r=t.length,s=i,a=0,o=0,l=t[r-1].nextSibling,c=null;for(;a<r||o<s;){if(t[a]===e[o]){a++,o++;continue}for(;t[r-1]===e[s-1];)r--,s--;if(r===a){const h=s<i?o?e[o-1].nextSibling:e[s-o]:l;for(;o<s;)n.insertBefore(e[o++],h)}else if(s===o)for(;a<r;)(!c||!c.has(t[a]))&&t[a].remove(),a++;else if(t[a]===e[s-1]&&e[o]===t[r-1]){const h=t[--r].nextSibling;n.insertBefore(e[o++],t[a++].nextSibling),n.insertBefore(e[--s],h),t[r]=e[s]}else{if(!c){c=new Map;let f=o;for(;f<s;)c.set(e[f],f++)}const h=c.get(t[a]);if(h!=null)if(o<h&&h<s){let f=a,d=1,u;for(;++f<r&&f<s&&!((u=c.get(t[f]))==null||u!==h+d);)d++;if(d>h-o){const y=t[a];for(;o<h;)n.insertBefore(e[o++],y)}else n.replaceChild(e[o++],t[a++])}else a++;else t[a++].remove()}}}const _f="_$DX_DELEGATE";function Kg(n,t,e,i={}){let r;return Rl(s=>{r=s,t===document?n():yn(t,n(),t.firstChild?null:void 0,e)},i.owner),()=>{r(),t.textContent=""}}function Gn(n,t,e,i){let r;const s=()=>{const o=document.createElement("template");return o.innerHTML=n,o.content.firstChild},a=()=>(r||(r=s())).cloneNode(!0);return a.cloneNode=a,a}function Zs(n,t=window.document){const e=t[_f]||(t[_f]=new Set);for(let i=0,r=n.length;i<r;i++){const s=n[i];e.has(s)||(e.add(s),t.addEventListener(s,iy))}}function qs(n,t,e){e==null?n.removeAttribute(t):n.setAttribute(t,e)}function Qg(n,t,e,i){i==null?n.removeAttributeNS(t,e):n.setAttributeNS(t,e,i)}function Jg(n,t,e){e?n.setAttribute(t,""):n.removeAttribute(t)}function xu(n,t){t==null?n.removeAttribute("class"):n.className=t}function Gp(n,t,e,i){if(i)Array.isArray(e)?(n[`$$${t}`]=e[0],n[`$$${t}Data`]=e[1]):n[`$$${t}`]=e;else if(Array.isArray(e)){const r=e[0];n.addEventListener(t,e[0]=s=>r.call(n,e[1],s))}else n.addEventListener(t,e,typeof e!="function"&&e)}function ty(n,t,e={}){const i=Object.keys(t||{}),r=Object.keys(e);let s,a;for(s=0,a=r.length;s<a;s++){const o=r[s];!o||o==="undefined"||t[o]||(Sf(n,o,!1),delete e[o])}for(s=0,a=i.length;s<a;s++){const o=i[s],l=!!t[o];!o||o==="undefined"||e[o]===l||!l||(Sf(n,o,!0),e[o]=l)}return e}function ey(n,t,e){if(!t)return e?qs(n,"style"):t;const i=n.style;if(typeof t=="string")return i.cssText=t;typeof e=="string"&&(i.cssText=e=void 0),e||(e={}),t||(t={});let r,s;for(s in e)t[s]==null&&i.removeProperty(s),delete e[s];for(s in t)r=t[s],r!==e[s]&&(i.setProperty(s,r),e[s]=r);return e}function Ln(n,t,e){e!=null?n.style.setProperty(t,e):n.style.removeProperty(t)}function Hp(n,t={},e,i){const r={};return i||Ar(()=>r.children=xa(n,t.children,r.children)),Ar(()=>typeof t.ref=="function"&&Lo(t.ref,n)),Ar(()=>ny(n,t,e,!0,r,!0)),r}function Lo(n,t,e){return Fr(()=>n(t,e))}function yn(n,t,e,i){if(e!==void 0&&!i&&(i=[]),typeof t!="function")return xa(n,t,i,e);Ar(r=>xa(n,t(),r,e),i)}function ny(n,t,e,i,r={},s=!1){t||(t={});for(const a in r)if(!(a in t)){if(a==="children")continue;r[a]=Af(n,a,null,r[a],e,s,t)}for(const a in t){if(a==="children")continue;const o=t[a];r[a]=Af(n,a,o,r[a],e,s,t)}}function ry(n){return n.toLowerCase().replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}function Sf(n,t,e){const i=t.trim().split(/\\s+/);for(let r=0,s=i.length;r<s;r++)n.classList.toggle(i[r],e)}function Af(n,t,e,i,r,s,a){let o,l,c,h,f;if(t==="style")return ey(n,e,i);if(t==="classList")return ty(n,e,i);if(e===i)return i;if(t==="ref")s||e(n);else if(t.slice(0,3)==="on:"){const d=t.slice(3);i&&n.removeEventListener(d,i,typeof i!="function"&&i),e&&n.addEventListener(d,e,typeof e!="function"&&e)}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);i&&n.removeEventListener(d,i,!0),e&&n.addEventListener(d,e,!0)}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),u=Hg.has(d);if(!u&&i){const y=Array.isArray(i)?i[0]:i;n.removeEventListener(d,y)}(u||e)&&(Gp(n,d,e,u),u&&Zs([d]))}else if(t.slice(0,5)==="attr:")qs(n,t.slice(5),e);else if(t.slice(0,5)==="bool:")Jg(n,t.slice(5),e);else if((f=t.slice(0,5)==="prop:")||(c=Wg.has(t))||!r&&((h=Gg(t,n.tagName))||(l=Ug.has(t)))||(o=n.nodeName.includes("-")||"is"in a))f&&(t=t.slice(5),l=!0),t==="class"||t==="className"?xu(n,e):o&&!l&&!c?n[ry(t)]=e:n[h||t]=e;else{const d=r&&t.indexOf(":")>-1&&Vg[t.split(":")[0]];d?Qg(n,d,t,e):qs(n,qg[t]||t,e)}return e}function iy(n){let t=n.target;const e=`$$${n.type}`,i=n.target,r=n.currentTarget,s=l=>Object.defineProperty(n,"target",{configurable:!0,value:l}),a=()=>{const l=t[e];if(l&&!t.disabled){const c=t[`${e}Data`];if(c!==void 0?l.call(t,c,n):l.call(t,n),n.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(n.target)&&s(t.host),!0},o=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return t||document}}),n.composedPath){const l=n.composedPath();s(l[0]);for(let c=0;c<l.length-2&&(t=l[c],!!a());c++){if(t._$host){t=t._$host,o();break}if(t.parentNode===r)break}}else o();s(i)}function xa(n,t,e,i,r){for(;typeof e=="function";)e=e();if(t===e)return e;const s=typeof t,a=i!==void 0;if(n=a&&e[0]&&e[0].parentNode||n,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===e))return e;if(a){let o=e[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),e=oo(n,e,i,o)}else e!==""&&typeof e=="string"?e=n.firstChild.data=t:e=n.textContent=t}else if(t==null||s==="boolean")e=oo(n,e,i);else{if(s==="function")return Ar(()=>{let o=t();for(;typeof o=="function";)o=o();e=xa(n,o,e,i)}),()=>e;if(Array.isArray(t)){const o=[],l=e&&Array.isArray(e);if(qh(o,t,e,r))return Ar(()=>e=xa(n,o,e,i,!0)),()=>e;if(o.length===0){if(e=oo(n,e,i),a)return e}else l?e.length===0?Cf(n,o,i):Zg(n,e,o):(e&&oo(n),Cf(n,o));e=o}else if(t.nodeType){if(Array.isArray(e)){if(a)return e=oo(n,e,i,t);oo(n,e,null,t)}else e==null||e===""||!n.firstChild?n.appendChild(t):n.replaceChild(t,n.firstChild);e=t}}return e}function qh(n,t,e,i){let r=!1;for(let s=0,a=t.length;s<a;s++){let o=t[s],l=e&&e[n.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)=="object"&&o.nodeType)n.push(o);else if(Array.isArray(o))r=qh(n,o,l)||r;else if(c==="function")if(i){for(;typeof o=="function";)o=o();r=qh(n,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||r}else n.push(o),r=!0;else{const h=String(o);l&&l.nodeType===3&&l.data===h?n.push(l):n.push(document.createTextNode(h))}}return r}function Cf(n,t,e=null){for(let i=0,r=t.length;i<r;i++)n.insertBefore(t[i],e)}function oo(n,t,e,i){if(e===void 0)return n.textContent="";const r=i||document.createTextNode("");if(t.length){let s=!1;for(let a=t.length-1;a>=0;a--){const o=t[a];if(r!==o){const l=o.parentNode===n;!s&&!a?l?n.replaceChild(r,o):n.insertBefore(r,e):l&&o.remove()}else s=!0}}else n.insertBefore(r,e);return[r]}const sy="http://www.w3.org/2000/svg";function oy(n,t=!1,e=void 0){return t?document.createElementNS(sy,n):document.createElement(n,{is:e})}function ay(n,t){const e=si(n);return si(()=>{const i=e();switch(typeof i){case"function":return Fr(()=>i(t));case"string":const r=Yg.has(i),s=oy(i,r,Fr(()=>t.is));return Hp(s,t,r),s}})}function ly(n){const[,t]=Xp(n,["component"]);return ay(()=>n.component,t)}const Yp=(n,t,e,i,r=new Set,s=!1)=>{if(i.has(n.id))return i.get(n.id);if(r.has(n.id))return{x:n.x,y:n.y,angle:n.angle||0,opacity:n.opacity||100};r.add(n.id);let a=n.x,o=n.y,l=n.angle||0;const c=n.orbitSpeed!==void 0?Number(n.orbitSpeed):1,h=n.orbitRadius!==void 0?Number(n.orbitRadius):150;if(n.orbitEnabled&&n.orbitCenterId&&!isNaN(h)&&!isNaN(c)){const u=e.get(n.orbitCenterId);if(u){const y=Yp(u,t,e,i,r,s),g=Number(y.x)||0,w=Number(y.y)||0,m=Number(u.width)||0,x=Number(u.height)||0,_=g+m/2,L=w+x/2;if(s){const T=t*.001*c,q=_+h*Math.cos(T),U=L+h*Math.sin(T);a=q-(Number(n.width)||0)/2,o=U-(Number(n.height)||0)/2}}}const f=n.spinSpeed!==void 0?Number(n.spinSpeed):5;if(n.spinEnabled&&!isNaN(f)&&s){const u=t*.001;l+=u*(f*Math.PI/3)}isNaN(a)&&(a=n.x),isNaN(o)&&(o=n.y),isNaN(l)&&(l=n.angle||0);const d={x:a,y:o,angle:l,opacity:n.opacity||100};return i.set(n.id,d),r.delete(n.id),d},th=(n,t,e=!1)=>{const i=new Map;n.forEach(a=>i.set(a.id,a));const r=new Map,s=new Set;return n.forEach(a=>{Yp(a,t,i,r,s,e)}),r};function cy(n=170,t=26,e=1,i=0){return r=>{if(r===0||r===1)return r;const a=r*1,o=Math.max(e,.01),l=Math.max(n,.01),c=Math.sqrt(l/o),h=t/(2*Math.sqrt(l*o)),f=-1,d=i;let u;const y=.001;if(h<1-y){const g=c*Math.sqrt(1-h*h),w=Math.exp(-h*c*a),m=f,x=(d+h*c*f)/g;u=1+w*(m*Math.cos(g*a)+x*Math.sin(g*a))}else if(h>1+y){const g=-c*(h+Math.sqrt(h*h-1)),w=-c*(h-Math.sqrt(h*h-1)),m=(d-w*f)/(g-w),x=f-m;u=1+m*Math.exp(g*a)+x*Math.exp(w*a)}else u=1+Math.exp(-c*a)*(f+(d+c*f)*a);return u}}const xo={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n===0?0:n===1?1:n<.5?Math.pow(2,10*(2*n-1))/2:(2-Math.pow(2,-10*(2*n-1)))/2,easeOutBounce:n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,easeInBounce:n=>1-xo.easeOutBounce(1-n),easeInOutBounce:n=>n<.5?(1-xo.easeOutBounce(1-2*n))/2:(1+xo.easeOutBounce(2*n-1))/2,easeOutElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n*10-.75)*t)+1},easeInElastic:n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:-Math.pow(2,10*n-10)*Math.sin((n*10-10.75)*t)},easeOutBack:n=>1+2.70158*Math.pow(n-1,3)+1.70158*Math.pow(n-1,2),easeInBack:n=>2.70158*n*n*n-1.70158*n*n,easeSpring:cy(170,26,1,0)};function Xh(n){return n?typeof n=="function"?n:xo[n]??xo.linear:xo.linear}function Qr(n,t,e){return isNaN(n)?t:isNaN(t)?n:n+(t-n)*e}function hy(n,t,e){if(!n)return t||"#000000";if(!t)return n;const i=u=>{const y=u.replace("#","");return y.length<6?[0,0,0]:[parseInt(y.substring(0,2),16)||0,parseInt(y.substring(2,4),16)||0,parseInt(y.substring(4,6),16)||0]},[r,s,a]=i(n),[o,l,c]=i(t),h=Math.round(Qr(r,o,e)),f=Math.round(Qr(s,l,e)),d=Math.round(Qr(a,c,e));return`#${h.toString(16).padStart(2,"0")}${f.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}`}const uy="modulepreload",fy=function(n){return"/"+n},Lf={},Tl=function(t,e,i){let r=Promise.resolve();if(e&&e.length>0){let l=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");r=l(e.map(c=>{if(c=fy(c),c in Lf)return;Lf[c]=!0;const h=c.endsWith(".css"),f=h?\'[rel="stylesheet"]\':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":uy,h||(d.as="script"),d.crossOrigin="",d.href=c,o&&d.setAttribute("nonce",o),document.head.appendChild(d),h)return new Promise((u,y)=>{d.addEventListener("load",u),d.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},Gh=Symbol("store-raw"),ko=Symbol("store-node"),Ji=Symbol("store-has"),Vp=Symbol("store-self");function Zp(n){let t=n[wi];if(!t&&(Object.defineProperty(n,wi,{value:t=new Proxy(n,gy)}),!Array.isArray(n))){const e=Object.keys(n),i=Object.getOwnPropertyDescriptors(n);for(let r=0,s=e.length;r<s;r++){const a=e[r];i[a].get&&Object.defineProperty(n,a,{enumerable:i[a].enumerable,get:i[a].get.bind(t)})}}return t}function Kl(n){let t;return n!=null&&typeof n=="object"&&(n[wi]||!(t=Object.getPrototypeOf(n))||t===Object.prototype||Array.isArray(n))}function ka(n,t=new Set){let e,i,r,s;if(e=n!=null&&n[Gh])return e;if(!Kl(n)||t.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):t.add(n);for(let a=0,o=n.length;a<o;a++)r=n[a],(i=ka(r,t))!==r&&(n[a]=i)}else{Object.isFrozen(n)?n=Object.assign({},n):t.add(n);const a=Object.keys(n),o=Object.getOwnPropertyDescriptors(n);for(let l=0,c=a.length;l<c;l++)s=a[l],!o[s].get&&(r=n[s],(i=ka(r,t))!==r&&(n[s]=i))}return n}function Ql(n,t){let e=n[t];return e||Object.defineProperty(n,t,{value:e=Object.create(null)}),e}function _a(n,t,e){if(n[t])return n[t];const[i,r]=En(e,{equals:!1,internal:!0});return i.$=r,n[t]=i}function dy(n,t){const e=Reflect.getOwnPropertyDescriptor(n,t);return!e||e.get||!e.configurable||t===wi||t===ko||(delete e.value,delete e.writable,e.get=()=>n[wi][t]),e}function Kp(n){Uh()&&_a(Ql(n,ko),Vp)()}function py(n){return Kp(n),Reflect.ownKeys(n)}const gy={get(n,t,e){if(t===Gh)return n;if(t===wi)return e;if(t===jh)return Kp(n),e;const i=Ql(n,ko),r=i[t];let s=r?r():n[t];if(t===ko||t===Ji||t==="__proto__")return s;if(!r){const a=Object.getOwnPropertyDescriptor(n,t);Uh()&&(typeof s!="function"||n.hasOwnProperty(t))&&!(a&&a.get)&&(s=_a(i,t,s)())}return Kl(s)?Zp(s):s},has(n,t){return t===Gh||t===wi||t===jh||t===ko||t===Ji||t==="__proto__"?!0:(Uh()&&_a(Ql(n,Ji),t)(),t in n)},set(){return!0},deleteProperty(){return!0},ownKeys:py,getOwnPropertyDescriptor:dy};function Jl(n,t,e,i=!1){if(!i&&n[t]===e)return;const r=n[t],s=n.length;e===void 0?(delete n[t],n[Ji]&&n[Ji][t]&&r!==void 0&&n[Ji][t].$()):(n[t]=e,n[Ji]&&n[Ji][t]&&r===void 0&&n[Ji][t].$());let a=Ql(n,ko),o;if((o=_a(a,t,r))&&o.$(()=>e),Array.isArray(n)&&n.length!==s){for(let l=n.length;l<s;l++)(o=a[l])&&o.$();(o=_a(a,"length",s))&&o.$(n.length)}(o=a[Vp])&&o.$()}function Qp(n,t){const e=Object.keys(t);for(let i=0;i<e.length;i+=1){const r=e[i];Jl(n,r,t[r])}}function yy(n,t){if(typeof t=="function"&&(t=t(n)),t=ka(t),Array.isArray(t)){if(n===t)return;let e=0,i=t.length;for(;e<i;e++){const r=t[e];n[e]!==r&&Jl(n,e,r)}Jl(n,"length",i)}else Qp(n,t)}function fa(n,t,e=[]){let i,r=n;if(t.length>1){i=t.shift();const a=typeof i,o=Array.isArray(n);if(Array.isArray(i)){for(let l=0;l<i.length;l++)fa(n,[i[l]].concat(t),e);return}else if(o&&a==="function"){for(let l=0;l<n.length;l++)i(n[l],l)&&fa(n,[l].concat(t),e);return}else if(o&&a==="object"){const{from:l=0,to:c=n.length-1,by:h=1}=i;for(let f=l;f<=c;f+=h)fa(n,[f].concat(t),e);return}else if(t.length>1){fa(n[i],t,[i].concat(e));return}r=n[i],e=[i].concat(e)}let s=t[0];typeof s=="function"&&(s=s(r,e),s===r)||i===void 0&&s==null||(s=ka(s),i===void 0||Kl(r)&&Kl(s)&&!Array.isArray(s)?Qp(r,s):Jl(n,i,s))}function my(...[n,t]){const e=ka(n||{}),i=Array.isArray(e),r=Zp(e);function s(...a){Ca(()=>{i&&a.length===1?yy(e,a[0]):fa(e,a)})}return[r,s]}const tc={type:"none",duration:500,easing:"easeInOutQuad"},Jp=(n,t,e=0,i=0)=>({id:crypto.randomUUID(),name:"Slide 1",spatialPosition:{x:e,y:i},dimensions:{width:1920,height:1080},backgroundColor:"#ffffff",order:0,transition:{...tc}}),by=(n,t="slides")=>({version:4,metadata:{name:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),docType:t},elements:[],layers:[{id:"default-layer",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent"}],slides:[Jp()],globalSettings:{},gridSettings:{enabled:!1,snapToGrid:!1,objectSnapping:!0,gridSize:20,gridColor:"#cccccc",gridOpacity:.5,style:"lines"}});var wy={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},ao=wy,vy=Gn("<svg>"),Mf=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),xy=n=>n.replace(/^([A-Z])|[\\s-_]+(\\w)/g,(t,e,i)=>i?i.toUpperCase():e.toLowerCase()),ky=n=>{const t=xy(n);return t.charAt(0).toUpperCase()+t.slice(1)},_y=(...n)=>n.filter((t,e,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===e).join(" ").trim(),Sy=n=>{const[t,e]=Xp(n,["color","size","strokeWidth","children","class","name","iconNode","absoluteStrokeWidth"]);return(()=>{var i=vy();return Hp(i,$r(ao,{get width(){return t.size??ao.width},get height(){return t.size??ao.height},get stroke(){return t.color??ao.stroke},get"stroke-width"(){return va(()=>!!t.absoluteStrokeWidth)()?Number(t.strokeWidth??ao["stroke-width"])*24/Number(t.size):Number(t.strokeWidth??ao["stroke-width"])},get class(){return _y("lucide","lucide-icon",...t.name!=null?[`lucide-${Mf(ky(t.name))}`,`lucide-${Mf(t.name)}`]:[],t.class!=null?t.class:"")}},e),!0,!0),yn(i,Re(vu,{get each(){return t.iconNode},children:([r,s])=>Re(ly,$r({component:r},s))})),i})()},ai=Sy,Ay=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Cy=n=>Re(ai,$r(n,{iconNode:Ay,name:"check"})),Ly=Cy,My=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ny=n=>Re(ai,$r(n,{iconNode:My,name:"chevron-left"})),Py=Ny,Iy=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Oy=n=>Re(ai,$r(n,{iconNode:Iy,name:"chevron-right"})),Ry=Oy,Ty=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],By=n=>Re(ai,$r(n,{iconNode:Ty,name:"circle-alert"})),Ey=By,Dy=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],Fy=n=>Re(ai,$r(n,{iconNode:Dy,name:"eraser"})),$y=Fy,zy=[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]],jy=n=>Re(ai,$r(n,{iconNode:zy,name:"highlighter"})),Uy=jy,Wy=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qy=n=>Re(ai,$r(n,{iconNode:Wy,name:"info"})),Xy=qy,Gy=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Hy=n=>Re(ai,$r(n,{iconNode:Gy,name:"loader-circle"})),Yy=Hy,Vy=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],Zy=n=>Re(ai,$r(n,{iconNode:Vy,name:"mouse-pointer-2"})),Ky=Zy,Qy=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Jy=n=>Re(ai,$r(n,{iconNode:Qy,name:"square"})),t5=Jy,e5=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],n5=n=>Re(ai,$r(n,{iconNode:e5,name:"x"})),ku=n5,r5=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],i5=n=>Re(ai,$r(n,{iconNode:r5,name:"zap"})),s5=i5,o5=Gn("<div><div class=toast-icon></div><div class=toast-message></div><button class=toast-close>");const[$s,Hh]=En({message:"",type:"info",visible:!1});let ga;const Mi=(n,t="info",e=3e3)=>{const i=t==="loading"?0:e;Hh({message:n,type:t,visible:!0}),ga&&clearTimeout(ga),i>0&&(ga=window.setTimeout(()=>{Hh(r=>({...r,visible:!1}))},i))},a5=()=>{Hh(n=>({...n,visible:!1})),ga&&clearTimeout(ga)},l5=()=>Re(rr,{get when(){return $s().visible},get children(){var n=o5(),t=n.firstChild,e=t.nextSibling,i=e.nextSibling;return yn(t,Re(rr,{get when(){return $s().type==="success"},get children(){return Re(Ly,{size:18})}}),null),yn(t,Re(rr,{get when(){return $s().type==="error"},get children(){return Re(Ey,{size:18})}}),null),yn(t,Re(rr,{get when(){return $s().type==="info"},get children(){return Re(Xy,{size:18})}}),null),yn(t,Re(rr,{get when(){return $s().type==="loading"},get children(){return Re(Yy,{size:18,class:"spin"})}}),null),yn(e,()=>$s().message),i.$$click=a5,yn(i,Re(ku,{size:14})),Ar(()=>xu(n,`toast toast-${$s().type}`)),n}});Zs(["click"]);const Nf=["#e03131","#1971c2","#2f9e44","#f08c00","#9c36b5","#0b7285","#748ffc","#f76707","#099268"];class t0{hSpacing=100;vSpacing=40;buildTree(t,e){const i=e.find(a=>a.id===t);if(!i)return null;const r={id:i.id,element:i,children:[],width:i.width,height:i.height,x:i.x,y:i.y},s=e.filter(a=>a.parentId===t);for(const a of s){const o=this.buildTree(a.id,e);o&&r.children.push(o)}return r}layoutHorizontal(t,e="right"){this.calculateSubtreeHeights(t),this.assignHorizontalPositions(t,t.x,t.y,e)}layoutVertical(t,e="down"){this.calculateSubtreeWidths(t),this.assignVerticalPositions(t,t.x,t.y,e)}calculateSubtreeHeights(t){if(t.children.length===0)return t.totalHeight=t.height,t.totalHeight;const e=t.children.reduce((r,s)=>r+this.calculateSubtreeHeights(s),0),i=(t.children.length-1)*this.vSpacing;return t.totalHeight=Math.max(t.height,e+i),t.totalHeight}assignHorizontalPositions(t,e,i,r){if(t.x=e,t.y=i,t.children.length===0)return;const s=r==="right"?e+t.width+this.hSpacing:e-this.hSpacing;let a=i-t.totalHeight/2+t.children[0].totalHeight/2;const o=t.children.reduce((l,c)=>l+c.totalHeight,0)+(t.children.length-1)*this.vSpacing;a=i+t.height/2-o/2;for(const l of t.children){const c=r==="right"?s:s-l.width,h=a+l.totalHeight/2-l.height/2;this.assignHorizontalPositions(l,c,h,r),a+=l.totalHeight+this.vSpacing}}calculateSubtreeWidths(t){if(t.children.length===0)return t.totalWidth=t.width,t.totalWidth;const e=t.children.reduce((r,s)=>r+this.calculateSubtreeWidths(s),0),i=(t.children.length-1)*this.hSpacing;return t.totalWidth=Math.max(t.width,e+i),t.totalWidth}assignVerticalPositions(t,e,i,r){if(t.x=e,t.y=i,t.children.length===0)return;const s=r==="down"?i+t.height+this.vSpacing:i-this.vSpacing,a=t.children.reduce((l,c)=>l+c.totalWidth,0)+(t.children.length-1)*this.hSpacing;let o=e+t.width/2-a/2;for(const l of t.children){const c=r==="down"?s:s-l.height,h=o+l.totalWidth/2-l.width/2;this.assignVerticalPositions(l,h,c,r),o+=l.totalWidth+this.hSpacing}}layoutRadial(t){this.assignRadialPositions(t,t.x,t.y,0,Math.PI*2,250)}assignRadialPositions(t,e,i,r,s,a){if(t.x=e,t.y=i,t.children.length===0)return;const o=e+t.width/2,l=i+t.height/2,h=(s-r)/t.children.length;for(let f=0;f<t.children.length;f++){const d=t.children[f],u=r+(f+.5)*h,y=o+Math.cos(u)*(a+t.width/2),g=l+Math.sin(u)*(a+t.height/2),w=y-d.width/2,m=g-d.height/2,x=Math.min(Math.PI/2,h*.9);this.assignRadialPositions(d,w,m,u-x/2,u+x/2,a*.8)}}applySemanticStyling(t,e){t.styleUpdates={},t.children.forEach((i,r)=>{const s=Nf[r%Nf.length];this.styleSubtree(i,s,1,e)})}styleSubtree(t,e,i,r){const s=Math.max(1,4-i*.5),a=Math.max(40,100-i*10);t.styleUpdates={strokeColor:e,strokeWidth:s,opacity:a},r.find(o=>(o.type==="arrow"||o.type==="line"||o.type==="bezier")&&o.endBinding?.elementId===t.id);for(const o of t.children)this.styleSubtree(o,e,i+1,r)}getUpdates(t,e,i=new Map){const r={x:t.x,y:t.y,...t.styleUpdates};i.set(t.id,r);const s=e.find(a=>(a.type==="arrow"||a.type==="line"||a.type==="bezier")&&a.endBinding?.elementId===t.id);s&&t.styleUpdates&&i.set(s.id,{strokeColor:t.styleUpdates.strokeColor,strokeWidth:t.styleUpdates.strokeWidth,opacity:t.styleUpdates.opacity});for(const a of t.children)this.getUpdates(a,e,i);return i}}function eh(n){const{width:t,height:e}=n.dimensions,{x:i,y:r}=n.spatialPosition,s=40,a=window.innerWidth-s*2,o=window.innerHeight-s*2,l=a/t,c=o/e,h=Math.min(l,c),f=(window.innerWidth-t*h)/2-i*h,d=(window.innerHeight-e*h)/2-r*h;return{scale:h,panX:f,panY:d}}class c5{activeAnimationId=null;isTransitioning=!1;fadeOverlay=null;get transitioning(){return this.isTransitioning}async transitionTo(t,e){if(t<0||t>=C.slides.length||t===C.activeSlideIndex&&!this.isTransitioning)return;this.cancelActiveTransition();const i=C.activeSlideIndex,r=C.slides[i],s=C.slides[t],a=s.transition||tc,o=t>i?"forward":"backward",l={fromSlide:r,toSlide:s,fromIndex:i,toIndex:t,direction:o};if(e?.skipAnimation||a.type==="none"||C.globalSettings?.animationEnabled===!1||C.globalSettings?.reducedMotion===!0){this.applyImmediateSwitch(t);return}this.isTransitioning=!0;try{await this.executeTransition(l,a)}finally{this.isTransitioning=!1,this.activeAnimationId=null}}applyImmediateSwitch(t){Kt("activeSlideIndex",t);const e=C.slides[t];if(e){const i=eh(e);Or(i)}}cancelActiveTransition(){this.activeAnimationId&&(Fn.stop(this.activeAnimationId),this.activeAnimationId=null),this.removeFadeOverlay(),this.isTransitioning=!1}async executeTransition(t,e){switch(e.type){case"fade":return this.executeFade(t,e);case"slide-left":case"slide-right":case"slide-up":case"slide-down":return this.executeSlide(t,e);case"zoom-in":case"zoom-out":return this.executeZoom(t,e);default:this.applyImmediateSwitch(t.toIndex)}}executeFade(t,e){return new Promise(i=>{const r=e.duration/2,s=t.toSlide.backgroundColor||"#ffffff";this.fadeOverlay=document.createElement("div"),this.fadeOverlay.style.cssText=`\n                position: fixed;\n                inset: 0;\n                z-index: 99999;\n                background: ${s};\n                opacity: 0;\n                pointer-events: none;\n                transition: opacity ${r}ms ease-in-out;\n            `,document.body.appendChild(this.fadeOverlay),requestAnimationFrame(()=>{this.fadeOverlay&&(this.fadeOverlay.style.opacity="1")}),setTimeout(()=>{this.applyImmediateSwitch(t.toIndex),this.fadeOverlay&&(this.fadeOverlay.style.opacity="0"),setTimeout(()=>{this.removeFadeOverlay(),i()},r)},r)})}executeSlide(t,e){return new Promise(i=>{const r={...C.viewState},s=eh(t.toSlide);let a=0,o=0;const l=200;switch(e.type){case"slide-left":a=t.direction==="forward"?-l:l;break;case"slide-right":a=t.direction==="forward"?l:-l;break;case"slide-up":o=t.direction==="forward"?-l:l;break;case"slide-down":o=t.direction==="forward"?l:-l;break}Kt("activeSlideIndex",t.toIndex);const c=Mo("slide-transition");this.activeAnimationId=c;const h=Xh(e.easing);Fn.create(c,f=>{const d=h(f),u=Qr(r.panX+a,s.panX,d),y=Qr(r.panY+o,s.panY,d),g=Qr(r.scale,s.scale,d);Or({panX:u,panY:y,scale:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,Or(s),i()}}),Fn.start(c)})}executeZoom(t,e){return new Promise(i=>{const r={...C.viewState},s=eh(t.toSlide),a=e.type==="zoom-in";Kt("activeSlideIndex",t.toIndex);const o=Mo("zoom-transition");this.activeAnimationId=o;const l=Xh(e.easing),c=a?.3:1.5,h=s.scale*c;Fn.create(o,f=>{const d=l(f);let u,y,g;if(f<.5){const w=d*2;u=Qr(r.scale,h,w),y=Qr(r.panX,(r.panX+s.panX)/2,w),g=Qr(r.panY,(r.panY+s.panY)/2,w)}else{const w=(d-.5)*2;u=Qr(h,s.scale,w),y=Qr((r.panX+s.panX)/2,s.panX,w),g=Qr((r.panY+s.panY)/2,s.panY,w)}Or({scale:u,panX:y,panY:g})},{duration:e.duration,onComplete:()=>{this.activeAnimationId=null,Or(s),i()}}),Fn.start(o)})}removeFadeOverlay(){this.fadeOverlay&&this.fadeOverlay.parentNode&&(this.fadeOverlay.parentNode.removeChild(this.fadeOverlay),this.fadeOverlay=null)}async previewTransition(t){if(!(t<0||t>=C.slides.length))if(t===0){const e=C.slides[0],i=e.transition||tc;await this.executeTransition({fromSlide:e,toSlide:e,fromIndex:-1,toIndex:0,direction:"forward"},i)}else await this.transitionTo(t-1,{skipAnimation:!0}),await new Promise(e=>setTimeout(e,300)),await this.transitionTo(t)}}const nh=new c5;class Xs{static parsePath(t){const e=[],i=t.match(/[a-zA-Z]|[-+]?[0-9]*\\.?[0-9]+/g);if(!i)return[];let r=0,s=0,a=0,o=0,l=0;for(;l<i.length;){const c=i[l];switch(l++,c){case"M":{const h=parseFloat(i[l++]),f=parseFloat(i[l++]);r=h,s=f,a=h,o=f;break}case"L":{const h=parseFloat(i[l++]),f=parseFloat(i[l++]),d=Math.hypot(h-r,f-s);e.push({type:"L",start:{x:r,y:s},points:[{x:h,y:f}],length:d}),r=h,s=f;break}case"Q":{const h=parseFloat(i[l++]),f=parseFloat(i[l++]),d=parseFloat(i[l++]),u=parseFloat(i[l++]),y=this.estimateBezierLength(r,s,h,f,d,u);e.push({type:"Q",start:{x:r,y:s},points:[{x:h,y:f},{x:d,y:u}],length:y}),r=d,s=u;break}case"C":{const h=parseFloat(i[l++]),f=parseFloat(i[l++]),d=parseFloat(i[l++]),u=parseFloat(i[l++]),y=parseFloat(i[l++]),g=parseFloat(i[l++]),w=this.estimateCubicBezierLength(r,s,h,f,d,u,y,g);e.push({type:"C",start:{x:r,y:s},points:[{x:h,y:f},{x:d,y:u},{x:y,y:g}],length:w}),r=y,s=g;break}case"Z":{const h=Math.hypot(a-r,o-s);h>0&&e.push({type:"L",start:{x:r,y:s},points:[{x:a,y:o}],length:h}),r=a,s=o;break}}}return e}static getPointOnPath(t,e){if(t.length===0)return{x:0,y:0,angle:0};const i=t.reduce((a,o)=>a+o.length,0),r=e*i;let s=0;for(const a of t){if(s+a.length>=r||a===t[t.length-1]){const o=Math.max(0,Math.min(1,(r-s)/a.length));return this.interpolateSegment(a,o)}s+=a.length}return this.interpolateSegment(t[t.length-1],1)}static interpolateSegment(t,e){const{start:i}=t;let r=0,s=0,a=0;if(t.type==="L"){const o=t.points[0];r=i.x+(o.x-i.x)*e,s=i.y+(o.y-i.y)*e,a=Math.atan2(o.y-i.y,o.x-i.x)}else if(t.type==="Q"){const o=t.points[0],l=t.points[1],c=1-e;r=c*c*i.x+2*c*e*o.x+e*e*l.x,s=c*c*i.y+2*c*e*o.y+e*e*l.y;const h=2*c*(o.x-i.x)+2*e*(l.x-o.x),f=2*c*(o.y-i.y)+2*e*(l.y-o.y);a=Math.atan2(f,h)}else if(t.type==="C"){const o=t.points[0],l=t.points[1],c=t.points[2],h=1-e,f=h*h,d=e*e;r=f*h*i.x+3*f*e*o.x+3*h*d*l.x+d*e*c.x,s=f*h*i.y+3*f*e*o.y+3*h*d*l.y+d*e*c.y;const u=3*f*(o.x-i.x)+6*h*e*(l.x-o.x)+3*d*(c.x-l.x),y=3*f*(o.y-i.y)+6*h*e*(l.y-o.y)+3*d*(c.y-l.y);a=Math.atan2(y,u)}return{x:r,y:s,angle:a}}static estimateBezierLength(t,e,i,r,s,a){const o=Math.hypot(s-t,a-e);return(Math.hypot(i-t,r-e)+Math.hypot(s-i,a-r)+o)/2}static estimateCubicBezierLength(t,e,i,r,s,a,o,l){const c=Math.hypot(o-t,l-e);return(Math.hypot(i-t,r-e)+Math.hypot(s-i,a-r)+Math.hypot(o-s,l-a)+c)/2}static svgToPoints(t){const e=this.parsePath(t),i=[];if(e.length===0)return[];i.push({x:e[0].start.x,y:e[0].start.y,type:"anchor"});for(const r of e)r.type==="L"?i.push({x:r.points[0].x,y:r.points[0].y,type:"anchor"}):r.type==="Q"?(i.push({x:r.points[0].x,y:r.points[0].y,type:"control"}),i.push({x:r.points[1].x,y:r.points[1].y,type:"anchor"})):r.type==="C"&&(i.push({x:r.points[0].x,y:r.points[0].y,type:"control"}),i.push({x:r.points[1].x,y:r.points[1].y,type:"control_end"}),i.push({x:r.points[2].x,y:r.points[2].y,type:"anchor"}));return i}static pointsToSvg(t){if(t.length===0)return"";let e=`M ${Math.round(t[0].x)} ${Math.round(t[0].y)}`,i=1;for(;i<t.length;){const r=t[i];if(r.type.includes("control")){const s=t[i+1];if(!s)break;if(s.type.includes("control")){const a=t[i+2];a&&a.type==="anchor"?(e+=` C ${Math.round(r.x)} ${Math.round(r.y)} ${Math.round(s.x)} ${Math.round(s.y)} ${Math.round(a.x)} ${Math.round(a.y)}`,i+=3):i++}else s.type==="anchor"?(e+=` Q ${Math.round(r.x)} ${Math.round(r.y)} ${Math.round(s.x)} ${Math.round(s.y)}`,i+=2):i++}else e+=` L ${Math.round(r.x)} ${Math.round(r.y)}`,i++}return e}}const h5=(n,t,e,i,r)=>`M ${n+r} ${t} L ${n+e-r} ${t} Q ${n+e} ${t} ${n+e} ${t+r} L ${n+e} ${t+i-r} Q ${n+e} ${t+i} ${n+e-r} ${t+i} L ${n+r} ${t+i} Q ${n} ${t+i} ${n} ${t+i-r} L ${n} ${t+r} Q ${n} ${t} ${n+r} ${t}`,ya=n=>{if(n.points&&n.points.length>0)return console.log("[getShapeGeometry] Using custom points:",n.id,n.points.length),{type:"points",points:n.points};const t=n.width,e=n.height,i=t/2,r=e/2,s=-i,a=-r;switch(n.type){case"rectangle":case"image":case"text":case"umlClass":case"umlNote":case"umlPackage":case"umlActor":case"umlComponent":case"umlLifeline":case"umlFragment":return{type:"rect",x:s,y:a,w:t,h:e,r:n.roundness?10:0};case"umlState":return{type:"rect",x:s,y:a,w:t,h:e,r:Math.min(Math.abs(t),Math.abs(e))*.15};case"umlInterface":case"umlUseCase":case"umlProvidedInterface":case"circle":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"umlRequiredInterface":{const o=Math.min(t,e)/2;return{type:"path",path:`M 0 ${-o} A ${o} ${o} 0 0 1 0 ${o}`}}case"umlSignalSend":{const o=t*.2;return{type:"points",points:[{x:-i,y:-r},{x:i-o,y:-r},{x:i,y:0},{x:i-o,y:r},{x:-i,y:r}]}}case"umlSignalReceive":{const o=t*.2;return{type:"points",points:[{x:-i+o,y:-r},{x:i,y:-r},{x:i,y:r},{x:-i+o,y:r},{x:-i,y:0}]}}case"triangle":return{type:"points",points:[{x:0,y:-r},{x:-i,y:r},{x:i,y:r}]};case"diamond":return{type:"points",points:[{x:0,y:-r},{x:i,y:0},{x:0,y:r},{x:-i,y:0}]};case"hexagon":{const o=[];for(let l=0;l<6;l++){const c=Math.PI/3*l-Math.PI/2;o.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:o}}case"octagon":{const o=[];for(let l=0;l<8;l++){const c=Math.PI/4*l-Math.PI/2;o.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:o}}case"pentagon":{const o=[];for(let l=0;l<5;l++){const c=Math.PI*2/5*l-Math.PI/2;o.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:o}}case"septagon":{const o=[];for(let l=0;l<7;l++){const c=Math.PI*2/7*l-Math.PI/2;o.push({x:t/2*Math.cos(c),y:e/2*Math.sin(c)})}return{type:"points",points:o}}case"star":{const o=Math.min(t,e)/2,l=(n.shapeRatio!==void 0?n.shapeRatio:38)/100,c=o*l,h=n.starPoints||5,f=[];for(let d=0;d<h*2;d++){const u=Math.PI/h*d-Math.PI/2,y=d%2===0?o:c;f.push({x:y*Math.cos(u),y:y*Math.sin(u)})}return{type:"points",points:f}}case"burst":{const o=Math.min(Math.abs(t),Math.abs(e))/2,l=(n.shapeRatio!==void 0?n.shapeRatio:70)/100,c=o*l,h=n.burstPoints||16,f=[];for(let d=0;d<h*2;d++){const u=Math.PI/h*d-Math.PI/2,y=d%2===0?o:c;f.push({x:y*Math.cos(u),y:y*Math.sin(u)})}return{type:"points",points:f}}case"parallelogram":{const o=t*.2;return{type:"points",points:[{x:s+o,y:a},{x:s+t,y:a},{x:s+t-o,y:a+e},{x:s,y:a+e}]}}case"trapezoid":{const o=t*.2;return{type:"points",points:[{x:s+o,y:a},{x:s+t-o,y:a},{x:s+t,y:a+e},{x:s,y:a+e}]}}case"rightTriangle":return{type:"points",points:[{x:s,y:a},{x:s,y:a+e},{x:s+t,y:a+e}]};case"capsule":return{type:"path",path:h5(s,a,t,e,Math.min(t,e)/2)};case"stickyNote":{const o=Math.min(t,e)*.15;return{type:"points",points:[{x:s,y:a},{x:s+t,y:a},{x:s+t,y:a+e-o},{x:s+t-o,y:a+e},{x:s,y:a+e}]}}case"callout":{const o=e*.2,l=e-o;return{type:"path",path:`M ${s} ${a} L ${s+t} ${a} L ${s+t} ${a+l} L ${s+t*.7} ${a+l} L 0 ${r} L ${s+t*.3} ${a+l} L ${s} ${a+l} Z`}}case"speechBubble":{const o=Math.min(t,e)*((n.borderRadius!==void 0?n.borderRadius:20)/100),l=t*.15,c=e*.2,h=e-c,f=(n.tailPosition!==void 0?n.tailPosition:20)/100,d=s+t*f;let u,y;f<=.5?(u=d+t*.1,y=u+l):(y=d-t*.1,u=y-l);const g=Math.min(t/2,o),w=Math.min(h/2,o);return{type:"path",path:`M ${s+g} ${a} L ${s+t-g} ${a} Q ${s+t} ${a} ${s+t} ${a+w} L ${s+t} ${a+h-w} Q ${s+t} ${a+h} ${s+t-g} ${a+h} L ${y} ${a+h} L ${d} ${r} L ${u} ${a+h} L ${s+g} ${a+h} Q ${s} ${a+h} ${s} ${a+h-w} L ${s} ${a+w} Q ${s} ${a} ${s+g} ${a} Z`}}case"cloud":{const o=t*.2,l=t*.25,c=t*.2,h=t*.3;return{type:"path",path:`M ${s+o} 0 A ${o} ${o} 0 0 1 ${s+t*.3} ${a+l} A ${l} ${l} 0 0 1 ${s+t*.7} ${a+l} A ${c} ${c} 0 0 1 ${s+t-c} 0 A ${h} ${h} 0 0 1 ${s+t*.6} ${a+e-h*.5} A ${h} ${h} 0 0 1 ${s+t*.3} ${a+e-h*.5} A ${h} ${h} 0 0 1 ${s+o} 0 Z`}}case"heart":return{type:"path",path:`M 0 ${a+e*.3} C 0 ${a+e*.15} ${s+t*.3} ${a} ${s+t*.5} ${a+e*.15} C ${s+t*.7} ${a} ${s+t} ${a+e*.15} ${s+t} ${a+e*.35} C ${s+t} ${a+e*.6} 0 ${a+e*.8} 0 ${a+e} C 0 ${a+e*.8} ${s} ${a+e*.6} ${s} ${a+e*.35} C ${s} ${a+e*.15} ${s+t*.3} ${a} ${s+t*.5} ${a+e*.15} Z`};case"polygon":{const o=n.polygonSides||6,l=[];for(let c=0;c<o;c++){const h=2*Math.PI/o*c-Math.PI/2;l.push({x:t/2*Math.cos(h),y:e/2*Math.sin(h)})}return{type:"points",points:l}}case"starPerson":{const o=Math.min(t,e)*.15,l=a+o*2;return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:a+o,rx:o,ry:o},{type:"points",points:[{x:0,y:l},{x:s,y:a+e*.4},{x:0,y:a+e*.5},{x:s+t,y:a+e*.4},{x:0,y:l},{x:s+t*.8,y:a+e},{x:0,y:a+e*.7},{x:s+t*.2,y:a+e},{x:0,y:l}]}]}}case"lightbulb":{const o=Math.min(t,e/1.5)/2,l=t*.4,c=e*.25,h=a+e-c;return{type:"multi",shapes:[{type:"path",path:`M ${-l/2} ${h} C ${-l/2} ${a+o} ${s} ${a+o*1.5} ${s} ${a+o} A ${o} ${o} 0 1 1 ${s+t} ${a+o} C ${s+t} ${a+o*1.5} ${l/2} ${a+o} ${l/2} ${h} Z`},{type:"rect",x:-l/2,y:h,w:l,h:c}]}}case"signpost":{const o=Math.max(4,t*.05),l=e*.3,c=t*.9,h=a+e*.1;return{type:"multi",shapes:[{type:"rect",x:-o/2,y:a,w:o,h:e},{type:"rect",x:-c/2,y:h,w:c,h:l}]}}case"burstBlob":{const o=t/2,l=e/2,c=12,h=Math.min(o,l),f=h*.6,d=n.seed||1,u=g=>{let w=g+=1831565813;return w=Math.imul(w^w>>>15,w|1),w^=w+Math.imul(w^w>>>7,w|61),((w^w>>>14)>>>0)/4294967296},y=[];for(let g=0;g<c*2;g++){const m=(g%2===0?h:f)+(u(d+g)-.5)*(h*.1),x=Math.PI*g/c;y.push({x:Math.cos(x)*(t/e)*m,y:Math.sin(x)*m})}return{type:"points",points:y}}case"scroll":{const o=e*.15;return{type:"path",path:`M ${s} ${a+o} L ${s+t} ${a+o} L ${s+t} ${a+e-o} L ${s} ${a+e-o} Z M ${s} ${a+o} C ${s-o} ${a+o} ${s-o} ${a} ${s} ${a} L ${s+t} ${a} C ${s+t+o} ${a} ${s+t+o} ${a+o} ${s+t} ${a+o} M ${s} ${a+e-o} C ${s-o} ${a+e-o} ${s-o} ${a+e} ${s} ${a+e} L ${s+t} ${a+e} C ${s+t+o} ${a+e} ${s+t+o} ${a+e-o} ${s+t} ${a+e-o}`}}case"doubleBanner":{const o=t*.15,l=e*.25;return{type:"multi",shapes:[{type:"points",points:[{x:s+o,y:a+l},{x:s,y:a+l},{x:s+o/2,y:0},{x:s,y:r},{x:s+o,y:r}]},{type:"points",points:[{x:s+t-o,y:a+l},{x:s+t,y:a+l},{x:s+t-o/2,y:0},{x:s+t,y:r},{x:s+t-o,y:r}]},{type:"points",points:[{x:s+o,y:a},{x:s+t-o,y:a},{x:s+t-o,y:a+e-l},{x:s+o,y:a+e-l}]}]}}case"document":{const o=e*.1;return{type:"path",path:`M ${s} ${a} L ${s+t} ${a} L ${s+t} ${a+e-o} Q ${s+t*.75} ${a+e-o*2} ${s+t*.5} ${a+e-o} T ${s} ${a+e-o} Z`}}case"cross":return{type:"multi",shapes:[{type:"points",points:[{x:s,y:a},{x:s+t,y:a+e}]},{type:"points",points:[{x:s+t,y:a},{x:s,y:a+e}]}]};case"checkmark":return{type:"points",points:[{x:s,y:a+e*.5},{x:s+t*.4,y:r},{x:s+t,y:a}]};case"wavyDivider":{let o=`M ${s} 0`;for(let l=1;l<=20;l++)o+=` L ${s+l/20*t} ${Math.sin(l/20*Math.PI*4)*(e/2)}`;return{type:"path",path:o}}case"ribbon":{const o=t*.15,l=e*.7;return{type:"path",path:`M ${s+o} ${a} L ${s+t-o} ${a} L ${s+t-o} ${a+l} L ${s+t} ${a+e/2} L ${s+t-o} ${a+e*.8} L ${s+o} ${a+e*.8} L ${s} ${a+e/2} L ${s+o} ${a+l} Z`}}case"bracketLeft":return{type:"points",isClosed:!1,points:[{x:s+t,y:a},{x:s,y:a+e/2},{x:s+t,y:a+e}]};case"bracketRight":return{type:"points",isClosed:!1,points:[{x:s,y:a},{x:s+t,y:a+e/2},{x:s,y:a+e}]};case"arrowLeft":{const o=e*.4,l=a+(e-o)/2,c=t*.4;return{type:"points",points:[{x:s+c,y:a},{x:s+c,y:l},{x:s+t,y:l},{x:s+t,y:l+o},{x:s+c,y:l+o},{x:s+c,y:a+e},{x:s,y:a+e/2}]}}case"arrowRight":{const o=e*.4,l=a+(e-o)/2,c=t*.4;return{type:"points",points:[{x:s+t-c,y:a},{x:s+t,y:a+e/2},{x:s+t-c,y:a+e},{x:s+t-c,y:l+o},{x:s,y:l+o},{x:s,y:l},{x:s+t-c,y:l}]}}case"arrowUp":{const o=t*.4,l=s+(t-o)/2,c=e*.4;return{type:"points",points:[{x:s+t/2,y:a},{x:s+t,y:a+c},{x:l+o,y:a+c},{x:l+o,y:a+e},{x:l,y:a+e},{x:l,y:a+c},{x:s,y:a+c}]}}case"arrowDown":{const o=t*.4,l=s+(t-o)/2,c=e*.4;return{type:"points",points:[{x:l,y:a},{x:l+o,y:a},{x:l+o,y:a+e-c},{x:s+t,y:a+e-c},{x:s+t/2,y:a+e},{x:s,y:a+e-c},{x:l,y:a+e-c}]}}case"dfdProcess":{const o=e*.25;return{type:"multi",shapes:[{type:"rect",x:s,y:a,w:t,h:e,r:10},{type:"points",points:[{x:s,y:a+o},{x:s+t,y:a+o}],isClosed:!1}]}}case"dfdDataStore":{const o=t*.2;return{type:"multi",shapes:[{type:"points",isClosed:!1,points:[{x:s+t,y:a},{x:s,y:a},{x:s,y:a+e},{x:s+t,y:a+e}]},{type:"points",isClosed:!1,points:[{x:s+o,y:a},{x:s+o,y:a+e}]}]}}case"isometricCube":{const o=(n.shapeRatio!==void 0?n.shapeRatio:25)/100,l=(n.sideRatio!==void 0?n.sideRatio:50)/100,c=s+t*l,h=s+t*(1-l),f=e*o,d=a+f,u=a+f/2;return{type:"multi",shapes:[{type:"points",points:[{x:h,y:a},{x:s+t,y:u},{x:c,y:d},{x:s,y:u}],shade:1.1},{type:"points",points:[{x:s,y:u},{x:c,y:d},{x:c,y:a+e},{x:s,y:a+e-f/2}],shade:.9},{type:"points",points:[{x:c,y:d},{x:s+t,y:u},{x:s+t,y:a+e-f/2},{x:c,y:a+e}],shade:.7}]}}case"solidBlock":{const o=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,h=o*Math.cos(c),f=o*Math.sin(c),d={x:s,y:a},u={x:s+t,y:a},y={x:s+t,y:a+e},g={x:s,y:a+e},w={x:s+h,y:a+f},m={x:s+t+h,y:a+f},x={x:s+t+h,y:a+e+f},_={x:s+h,y:a+e+f};return{type:"multi",shapes:[{type:"points",points:[w,m,x,_],shade:.6},{type:"points",points:[d,u,m,w],shade:1.1},{type:"points",points:[u,y,x,m],shade:.8},{type:"points",points:[y,g,_,x],shade:.7},{type:"points",points:[g,d,w,_],shade:.9},{type:"points",points:[d,u,y,g],shade:1}]}}case"perspectiveBlock":{const o=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,h=n.taper!==void 0?n.taper:0,f=(n.skewX!==void 0?n.skewX:0)*t,d=(n.skewY!==void 0?n.skewY:0)*e,u=n.frontTaper!==void 0?n.frontTaper:0,y=(n.frontSkewX!==void 0?n.frontSkewX:0)*t,g=(n.frontSkewY!==void 0?n.frontSkewY:0)*e,w=o*Math.cos(c)+f,m=o*Math.sin(c)+d,x=1-u,_=i*x,L=r*x,T={x:-_+y,y:-L+g},q={x:_+y,y:-L+g},U={x:_+y,y:L+g},B={x:-_+y,y:L+g},O=1-h,X=i*O,R=r*O,M={x:w-X,y:m-R},$={x:w+X,y:m-R},S={x:w+X,y:m+R},J={x:w-X,y:m+R};return{type:"multi",shapes:[{type:"points",points:[M,$,S,J],shade:.6},{type:"points",points:[T,q,$,M],shade:1.1},{type:"points",points:[q,U,S,$],shade:.8},{type:"points",points:[U,B,J,S],shade:.7},{type:"points",points:[B,T,M,J],shade:.9},{type:"points",points:[T,q,U,B],shade:1}]}}case"cylinder":{const o=n.depth!==void 0?n.depth:50,c=(n.viewAngle!==void 0?n.viewAngle:45)*Math.PI/180,h=t/2,f=e/2,d=o*Math.cos(c),u=o*Math.sin(c),y=0,g=0,w=d,m=u,x=Math.atan2(u*h*h,d*f*f)+Math.PI/2,_=h*Math.cos(x),L=f*Math.sin(x);return{type:"multi",shapes:[{type:"ellipse",cx:w,cy:m,rx:h,ry:f,shade:.6},{type:"points",points:[{x:y+_,y:g+L},{x:w+_,y:m+L},{x:w-_,y:m-L},{x:y-_,y:g-L}],shade:.8},{type:"ellipse",cx:y,cy:g,rx:h,ry:f,shade:1}]}}case"stateStart":return{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2};case"stateEnd":return{type:"multi",shapes:[{type:"ellipse",cx:0,cy:0,rx:t/2,ry:e/2},{type:"ellipse",cx:0,cy:0,rx:t/3,ry:e/3}]};case"stateSync":return{type:"rect",x:s,y:a,w:t,h:e,r:2};case"activationBar":return{type:"rect",x:s,y:a,w:t,h:e,r:0};case"externalEntity":return{type:"multi",shapes:[{type:"rect",x:s+4,y:a+4,w:t,h:e,r:0},{type:"rect",x:s,y:a,w:t,h:e,r:0}]}}return null};class lo{static resamplePolygon(t,e){if(t.length<2)return Array(e).fill(t[0]||{x:0,y:0});let i=0;const r=[];for(let c=0;c<t.length;c++){const h=t[c],f=t[(c+1)%t.length],d=Math.hypot(f.x-h.x,f.y-h.y);i+=d,r.push({length:d,start:h,end:f})}if(i===0)return Array(e).fill(t[0]);const s=[],a=i/e;let o=0,l=0;for(let c=0;c<e;c++){const h=c*a;for(;l<r.length;){const f=r[l];if(o+f.length>=h){const u=(h-o)/f.length;s.push({x:f.start.x+(f.end.x-f.start.x)*u,y:f.start.y+(f.end.y-f.start.y)*u});break}else o+=f.length,l++}s.length<=c&&s.push(t[t.length-1])}return s}static interpolatePoints(t,e,i){return t.length!==e.length?(console.warn("Interpolation mismatch",t.length,e.length),t):t.map((r,s)=>{const a=e[s];return{x:r.x+(a.x-r.x)*i,y:r.y+(a.y-r.y)*i}})}static alignPolygons(t,e){if(t.length!==e.length)return e;let i=0,r=1/0;for(let a=0;a<e.length;a++){let o=0;for(let l=0;l<t.length;l++){const c=t[l],h=e[(l+a)%e.length];o+=(c.x-h.x)**2+(c.y-h.y)**2}o<r&&(r=o,i=a)}const s=Array(e.length);for(let a=0;a<e.length;a++)s[a]=e[(a+i)%e.length];return s}static getPointsFromElement(t,e){const i=e?{...t,type:e}:t;if(i.type==="line"||i.type==="arrow")return i.points||[{x:0,y:0},{x:i.width,y:i.height}];const r=ya(i);return r?this.geometryToPoints(r,i.width,i.height):this.generateCirclePoints(i.width/2,i.height/2)}static geometryToPoints(t,e,i){switch(t.type){case"points":return t.points.length===0?[]:t.points;case"rect":return[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}];case"ellipse":const r=[],s=60;for(let c=0;c<s;c++){const h=c/s*Math.PI*2;r.push({x:t.cx+t.rx*Math.cos(h),y:t.cy+t.ry*Math.sin(h)})}return r;case"path":const a=Xs.parsePath(t.path),o=[],l=60;for(let c=0;c<l;c++){const h=Xs.getPointOnPath(a,c/l);o.push({x:h.x,y:h.y})}return o;case"multi":return t.shapes.length>0?this.geometryToPoints(t.shapes[0],e,i):[]}return[]}static generateCirclePoints(t,e){const i=[];for(let s=0;s<60;s++){const a=s/60*Math.PI*2;i.push({x:t*Math.cos(a),y:e*Math.sin(a)})}return i}}const Dn=new Map;function Ma(n,t){const e=Dn.get(n);if(!e)return;const i=[];for(const[r,s]of e.entries())for(const a of s)if(t.has(a)){i.push(r);break}i.forEach(r=>{Fn.stop(r),e.delete(r)}),e.size===0&&Dn.delete(n)}function e0(n){const t=Dn.get(n);t&&(t.forEach((e,i)=>Fn.stop(i)),Dn.delete(n))}function u5(n){const t=Dn.get(n);return t?t.size>0:!1}function f5(n,t){return n[t]}function ce(n,t,e){const i=C.elements.find(h=>h.id===n);if(!i)return console.warn(`animateElement: Element ${n} not found`),"";const r=Mo("el"),s={},a=[],o=[],l={},c=new Set;for(const h of Object.keys(t)){c.add(h);const f=f5(i,h);f!==void 0?(s[h]=f,typeof f=="number"?a.push(h):typeof f=="string"&&o.push(h)):l[h]=t[h]}return Ma(n,c),Dn.has(n)||Dn.set(n,new Map),Dn.get(n).set(r,c),Object.keys(l).length>0&&de(n,l,!1),Fn.create(r,h=>{const f={},d={};for(const u of a){const y=s[u],g=t[u],w=Qr(y,g,h);f[u]=w,d[u]=w}for(const u of o){const y=s[u],g=t[u];if(y&&g&&y.startsWith("#")&&g.startsWith("#")){const w=hy(y,g,h);f[u]=w,d[u]=w}}de(n,f,!1),e.onUpdate?.(d)},{duration:e.duration,easing:e.easing,delay:e.delay,onStart:e.onStart,onComplete:()=>{const h=Dn.get(n);h&&(h.delete(r),h.size===0&&Dn.delete(n)),e.onComplete?.()},loop:e.loop,loopCount:e.loopCount,alternate:e.alternate}),Fn.start(r),r}function d5(n,t,e,i=0){return n.map((r,s)=>ce(r,t,{...e,delay:(e.delay??0)+i*s}))}function p5(n){Fn.stop(n)}function g5(n){Fn.pause(n)}function n0(n,t,e){const i=C.elements.find(h=>h.id===n);if(!i)return"";const r=Xs.parsePath(t);if(r.length===0)return"";const s=Mo("path"),a=new Set(["x","y"]);e.orientToPath&&a.add("angle"),Ma(n,a),Dn.has(n)||Dn.set(n,new Map),Dn.get(n).set(s,a);const o=i.x+i.width/2,l=i.y+i.height/2,c=e.isRelative??!0;return Fn.create(s,h=>{const f=Xs.getPointOnPath(r,h);let d,u;c?(d=o+f.x-i.width/2,u=l+f.y-i.height/2):(d=f.x-i.width/2,u=f.y-i.height/2);const y={x:d,y:u};e.orientToPath&&(y.angle=f.angle),de(n,y,!1),e.onUpdate?.({x:y.x,y:y.y,angle:y.angle})},{duration:e.duration,easing:e.easing,delay:e.delay,onStart:e.onStart,onComplete:()=>{const h=Dn.get(n);h&&(h.delete(s),h.size===0&&Dn.delete(n)),e.onComplete?.()},loop:e.loop,loopCount:e.loopCount,alternate:e.alternate}),Fn.start(s),s}function y5(n){Fn.start(n)}function m5(n,t=300,e={}){return de(n,{opacity:0},!1),ce(n,{opacity:100},{duration:t,easing:"easeOutQuad",...e})}function b5(n,t=300,e={}){return ce(n,{opacity:0},{duration:t,easing:"easeOutQuad",...e})}function r0(n,t=300,e={}){const i=C.elements.find(f=>f.id===n);if(!i)return"";const r=i.x,s=i.y,a=i.width,o=i.height,l=100,c=r+a/2,h=s+o/2;return de(n,{width:0,height:0,x:c,y:h,opacity:0},!1),ce(n,{width:a,height:o,x:r,y:s,opacity:l},{duration:t,easing:"easeOutBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function _u(n,t=450,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=e.intensity??20,s=i.y;return ce(n,{y:s-r},{duration:t*.33,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{y:s},{duration:t*.67,easing:"easeOutBounce",onComplete:e.onComplete})}})}function Su(n,t=300,e={}){const i=C.elements.find(u=>u.id===n);if(!i)return"";const r=e.scale??1.1,s=i.width,a=i.height,o=i.x,l=i.y,c=s*r,h=a*r,f=(c-s)/2,d=(h-a)/2;return ce(n,{width:c,height:h,x:o-f,y:l-d},{duration:t/2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{width:s,height:a,x:o,y:l},{duration:t/2,easing:"easeOutQuad",onComplete:e.onComplete})}})}function Au(n,t=1e3,e={}){return ce(n,{opacity:0},{duration:t/4,easing:"linear",loop:!0,loopCount:2,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:e.onComplete})}function Cu(n,t=1e3,e={}){const i=C.elements.find(l=>l.id===n);if(!i)return"";const r=i.width,s=i.height,a=i.x,o=i.y;return ce(n,{width:r*1.25,height:s*.75,x:a-r*.25/2,y:o+s*.25/2},{duration:t*.3,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{width:r*.75,height:s*1.25,x:a+r*.25/2,y:o-s*.25/2},{duration:t*.3,easing:"easeInOutQuad",onComplete:()=>{ce(n,{width:r,height:s,x:a,y:o},{duration:t*.4,easing:"easeOutElastic",onComplete:e.onComplete})}})}})}function Lu(n,t=400,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=e.intensity??10,s=i.x;return ce(n,{x:s+r},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{de(n,{x:s},!1),e.onComplete?.()}})}function Mu(n,t=400,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=e.intensity??10,s=i.y;return ce(n,{y:s+r},{duration:t/4,easing:"linear",loop:!0,loopCount:4,alternate:!0,delay:e.delay,onStart:e.onStart,onComplete:()=>{de(n,{y:s},!1),e.onComplete?.()}})}function i0(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.x;return ce(n,{x:r-6},{duration:t/5,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{x:r+5},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{ce(n,{x:r-3},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{ce(n,{x:r+2},{duration:t/5,easing:"easeInOutQuad",onComplete:()=>{ce(n,{x:r},{duration:t/5,easing:"easeInOutQuad",onComplete:e.onComplete})}})}})}})}})}function s0(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.angle;return ce(n,{angle:r+.25},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{angle:r-.17},{duration:t*.2,easing:"linear",onComplete:()=>{ce(n,{angle:r+.08},{duration:t*.2,easing:"linear",onComplete:()=>{ce(n,{angle:r-.05},{duration:t*.2,easing:"linear",onComplete:()=>{ce(n,{angle:r},{duration:t*.2,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function o0(n,t=1e3,e={}){const i=C.elements.find(c=>c.id===n);if(!i)return"";const r=i.width,s=i.height,a=i.x,o=i.y,l=i.angle;return ce(n,{width:r*.9,height:s*.9,x:a+r*.1/2,y:o+s*.1/2,angle:l-.05},{duration:t*.1,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{width:r*1.1,height:s*1.1,x:a-r*.1/2,y:o-s*.1/2,angle:l+.05},{duration:t*.3,easing:"linear",loop:!0,loopCount:3,alternate:!0,onComplete:()=>{ce(n,{width:r,height:s,x:a,y:o,angle:l},{duration:t*.1,easing:"linear",onComplete:e.onComplete})}})}})}function a0(n,t=1e3,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.x,s=i.angle;return ce(n,{x:r-i.width*.25,angle:s-.08},{duration:t*.15,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{x:r+i.width*.2,angle:s+.05},{duration:t*.15,easing:"linear",onComplete:()=>{ce(n,{x:r-i.width*.15,angle:s-.05},{duration:t*.15,easing:"linear",onComplete:()=>{ce(n,{x:r+i.width*.1,angle:s+.03},{duration:t*.15,easing:"linear",onComplete:()=>{ce(n,{x:r,angle:s},{duration:t*.15,easing:"linear",onComplete:e.onComplete})}})}})}})}})}function l0(n,t=1e3,e={}){const i=C.elements.find(l=>l.id===n);if(!i)return"";const r=i.width,s=i.height,a=i.x,o=i.y;return ce(n,{width:r*1.1,height:s*.9,x:a-r*.1/2,y:o+s*.1/2},{duration:t*.2,easing:"linear",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{width:r*.9,height:s*1.1,x:a+r*.1/2,y:o-s*.1/2},{duration:t*.2,easing:"linear",onComplete:()=>{ce(n,{width:r*1.05,height:s*.95,x:a-r*.05/2,y:o+s*.05/2},{duration:t*.2,easing:"linear",onComplete:()=>{ce(n,{width:r,height:s,x:a,y:o},{duration:t*.4,easing:"easeOutQuad",onComplete:e.onComplete})}})}})}})}function c0(n,t=1300,e={}){const i=C.elements.find(l=>l.id===n);if(!i)return"";const r=i.width,s=i.height,a=i.x,o=i.y;return ce(n,{width:r*1.3,height:s*1.3,x:a-r*.3/2,y:o-s*.3/2},{duration:t*.2,easing:"easeOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{width:r,height:s,x:a,y:o},{duration:t*.2,easing:"easeInQuad",onComplete:()=>{ce(n,{width:r*1.3,height:s*1.3,x:a-r*.3/2,y:o-s*.3/2},{duration:t*.2,easing:"easeOutQuad",onComplete:()=>{ce(n,{width:r,height:s,x:a,y:o},{duration:t*.4,easing:"easeInQuad",onComplete:e.onComplete})}})}})}})}function h0(n,t=300,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.x+i.width/2,s=i.y+i.height/2;return ce(n,{width:0,height:0,x:r,y:s,opacity:0},{duration:t,easing:"easeInBack",onStart:e.onStart,onComplete:e.onComplete,delay:e.delay})}function w5(n,t=300,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.x,s=-i.width-50;return de(n,{x:s,opacity:0},!1),ce(n,{x:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function v5(n,t=300,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.x,s=window.innerWidth+50;return de(n,{x:s,opacity:0},!1),ce(n,{x:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function x5(n,t=300,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.y,s=-i.height-50;return de(n,{y:s,opacity:0},!1),ce(n,{y:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function k5(n,t=300,e={}){const i=C.elements.find(a=>a.id===n);if(!i)return"";const r=i.y,s=window.innerHeight+50;return de(n,{y:s,opacity:0},!1),ce(n,{y:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function _5(n,t=300,e={}){const i=C.elements.find(r=>r.id===n);return i?ce(n,{x:-i.width,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function S5(n,t=300,e={}){return ce(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function A5(n,t=300,e={}){const i=C.elements.find(r=>r.id===n);return i?ce(n,{y:-i.height,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function C5(n,t=300,e={}){return ce(n,{y:window.innerHeight+100,opacity:0},{duration:t,easing:"easeInQuad",...e})}function bc(n,t,e,i={}){const r=C.elements.find(o=>o.id===n);if(!r)return"";const s=r.x,a=r.y;return de(n,{x:t.x??s,y:t.y??a,opacity:70,width:r.width*.7,height:r.height*.7},!1),ce(n,{x:s,y:a,opacity:100,width:r.width,height:r.height},{duration:e,easing:"easeOutBack",...i})}function u0(n,t=1e3,e={}){return bc(n,{y:-window.innerHeight},t,e)}function f0(n,t=1e3,e={}){return bc(n,{x:-window.innerWidth},t,e)}function d0(n,t=1e3,e={}){return bc(n,{x:window.innerWidth+100},t,e)}function p0(n,t=1e3,e={}){return bc(n,{y:window.innerHeight+100},t,e)}function wc(n,t,e,i={}){const r=C.elements.find(s=>s.id===n);return r?ce(n,{x:t.x??r.x,y:t.y??r.y,opacity:0,width:r.width*.7,height:r.height*.7},{duration:e,easing:"easeInBack",...i}):""}function g0(n,t=1e3,e={}){return wc(n,{y:window.innerHeight+100},t,e)}function y0(n,t=1e3,e={}){return wc(n,{x:-window.innerWidth},t,e)}function m0(n,t=1e3,e={}){return wc(n,{x:window.innerWidth+100},t,e)}function b0(n,t=1e3,e={}){return wc(n,{y:-window.innerHeight},t,e)}function Na(n,t,e,i={}){const r=C.elements.find(o=>o.id===n);if(!r)return"";const s=r.x,a=r.y;return de(n,{x:t.x??s,y:t.y??a,opacity:0,width:r.width*.3,height:r.height*.3},!1),ce(n,{x:s,y:a,opacity:100,width:r.width,height:r.height},{duration:e,easing:"easeOutBounce",...i})}function w0(n,t=750,e={}){return Na(n,{},t,e)}function v0(n,t=1e3,e={}){return Na(n,{y:-window.innerHeight},t,e)}function x0(n,t=1e3,e={}){return Na(n,{x:-window.innerWidth},t,e)}function k0(n,t=1e3,e={}){return Na(n,{x:window.innerWidth+100},t,e)}function _0(n,t=1e3,e={}){return Na(n,{y:window.innerHeight+100},t,e)}function Pa(n,t,e,i={}){const r=C.elements.find(s=>s.id===n);return r?ce(n,{x:t.x??r.x,y:t.y??r.y,opacity:0,width:r.width*.3,height:r.height*.3},{duration:e,easing:"easeInBounce",...i}):""}function S0(n,t=750,e={}){return Pa(n,{},t,e)}function A0(n,t=1e3,e={}){return Pa(n,{y:window.innerHeight+100},t,e)}function C0(n,t=1e3,e={}){return Pa(n,{x:-window.innerWidth},t,e)}function L0(n,t=1e3,e={}){return Pa(n,{x:window.innerWidth+100},t,e)}function M0(n,t=1e3,e={}){return Pa(n,{y:-window.innerHeight},t,e)}function li(n,t,e,i={}){const r=C.elements.find(o=>o.id===n);if(!r)return"";const s=r.x,a=r.y;return de(n,{x:t.x??s,y:t.y??a,opacity:0},!1),ce(n,{x:s,y:a,opacity:100},{duration:e,easing:"easeOutQuad",...i})}function N0(n,t=1e3,e={}){return li(n,{y:(C.selection.length>0,-100)},t,e)}function P0(n,t=1e3,e={}){return li(n,{y:-window.innerHeight},t,e)}function I0(n,t=1e3,e={}){return li(n,{x:-100},t,e)}function O0(n,t=1e3,e={}){return li(n,{x:-window.innerWidth},t,e)}function R0(n,t=1e3,e={}){return li(n,{x:window.innerWidth+100},t,e)}function T0(n,t=1e3,e={}){return li(n,{x:window.innerWidth+2e3},t,e)}function B0(n,t=1e3,e={}){return li(n,{y:100},t,e)}function E0(n,t=1e3,e={}){return li(n,{y:window.innerHeight+100},t,e)}function D0(n,t=1e3,e={}){return li(n,{x:-100,y:-100},t,e)}function F0(n,t=1e3,e={}){return li(n,{x:100,y:-100},t,e)}function $0(n,t=1e3,e={}){return li(n,{x:-100,y:100},t,e)}function z0(n,t=1e3,e={}){return li(n,{x:100,y:100},t,e)}function ci(n,t,e,i={}){const r=C.elements.find(s=>s.id===n);return r?ce(n,{x:t.x??r.x,y:t.y??r.y,opacity:0},{duration:e,easing:"easeInQuad",...i}):""}function j0(n,t=1e3,e={}){return ci(n,{y:100},t,e)}function U0(n,t=1e3,e={}){return ci(n,{y:window.innerHeight+100},t,e)}function W0(n,t=1e3,e={}){return ci(n,{x:-100},t,e)}function q0(n,t=1e3,e={}){return ci(n,{x:-window.innerWidth},t,e)}function X0(n,t=1e3,e={}){return ci(n,{x:100},t,e)}function G0(n,t=1e3,e={}){return ci(n,{x:window.innerWidth+100},t,e)}function H0(n,t=1e3,e={}){return ci(n,{y:-100},t,e)}function Y0(n,t=1e3,e={}){return ci(n,{y:-window.innerHeight},t,e)}function V0(n,t=1e3,e={}){return ci(n,{x:-100,y:-100},t,e)}function Z0(n,t=1e3,e={}){return ci(n,{x:100,y:-100},t,e)}function K0(n,t=1e3,e={}){return ci(n,{x:-100,y:100},t,e)}function Q0(n,t=1e3,e={}){return ci(n,{x:100,y:100},t,e)}function J0(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.angle;return ce(n,{angle:r+Math.PI},{duration:t/2,easing:"easeInOutQuad",delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{angle:r+Math.PI*2},{duration:t/2,easing:"easeInOutQuad",onComplete:()=>{de(n,{angle:r},!1),e.onComplete?.()}})}})}function t1(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.height;return de(n,{height:0,opacity:0},!1),ce(n,{height:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function e1(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.width;return de(n,{width:0,opacity:0},!1),ce(n,{width:r,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function n1(n,t=1e3,e={}){return ce(n,{height:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function r1(n,t=1e3,e={}){return ce(n,{width:0,opacity:0},{duration:t,easing:"easeInQuad",...e})}function i1(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.x;return de(n,{x:window.innerWidth+100,opacity:0},!1),ce(n,{x:r,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function s1(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.x;return de(n,{x:-window.innerWidth,opacity:0},!1),ce(n,{x:r,opacity:100},{duration:t,easing:"easeOutExpo",...e})}function o1(n,t=1e3,e={}){return ce(n,{x:window.innerWidth+100,opacity:0},{duration:t,easing:"easeInExpo",...e})}function a1(n,t=1e3,e={}){return ce(n,{x:-window.innerWidth,opacity:0},{duration:t,easing:"easeInExpo",...e})}function Ia(n,t,e,i={}){const r=C.elements.find(l=>l.id===n);if(!r)return"";const s=r.x,a=r.y,o=r.angle;return de(n,{x:t.x??s,y:t.y??a,angle:t.angle??o-Math.PI*2,opacity:0},!1),ce(n,{x:s,y:a,angle:o,opacity:100},{duration:e,easing:"easeOutQuad",...i})}function l1(n,t=1e3,e={}){return Ia(n,{},t,e)}function c1(n,t=1e3,e={}){return Ia(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function h1(n,t=1e3,e={}){return Ia(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function u1(n,t=1e3,e={}){return Ia(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function f1(n,t=1e3,e={}){return Ia(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function Oa(n,t,e,i={}){const r=C.elements.find(s=>s.id===n);return r?ce(n,{x:t.x??r.x,y:t.y??r.y,angle:t.angle??r.angle+Math.PI*2,opacity:0},{duration:e,easing:"easeInQuad",...i}):""}function d1(n,t=1e3,e={}){return Oa(n,{},t,e)}function p1(n,t=1e3,e={}){return Oa(n,{x:-100,y:100,angle:Math.PI/2},t,e)}function g1(n,t=1e3,e={}){return Oa(n,{x:100,y:100,angle:-Math.PI/2},t,e)}function y1(n,t=1e3,e={}){return Oa(n,{x:-100,y:-100,angle:-Math.PI/2},t,e)}function m1(n,t=1e3,e={}){return Oa(n,{x:100,y:-100,angle:Math.PI/2},t,e)}function L5(n,t=2e3,e={}){const i=C.elements.find(d=>d.id===n);if(!i)return"";const s=(e.params||{}).radius??50,a=i.x,o=i.y,l=a+s,c=o,h=new Set(["x","y"]),f=Mo("revolve");return Ma(n,h),Dn.has(n)||Dn.set(n,new Map),Dn.get(n).set(f,h),Fn.create(f,d=>{const u=d*Math.PI*2,y=l-s*Math.cos(u),g=c-s*Math.sin(u);de(n,{x:y,y:g},!1)},{duration:t,easing:e.easing||"linear",delay:e.delay,loop:e.loop,loopCount:e.loopCount,alternate:e.alternate,onComplete:()=>{const d=Dn.get(n);d&&(d.delete(f),d.size===0&&Dn.delete(n)),e.onComplete?.()}}),Fn.start(f),f}function b1(n,t=2e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.angle;return ce(n,{angle:r+1.2},{duration:t*.4,easing:"easeInOutQuad",alternate:!0,loop:!0,loopCount:2,delay:e.delay,onStart:e.onStart,onComplete:()=>{ce(n,{y:window.innerHeight+500,opacity:0},{duration:t*.6,easing:"easeInQuad",onComplete:e.onComplete})}})}function w1(n,t=1e3,e={}){const i=C.elements.find(l=>l.id===n);if(!i)return"";const r=i.width,s=i.height,a=i.x,o=i.y;return de(n,{width:0,height:0,x:a+r/2,y:o+s/2,angle:-.5,opacity:0},!1),ce(n,{width:r,height:s,x:a,y:o,angle:0,opacity:100},{duration:t,easing:"easeOutBack",...e})}function v1(n,t=1e3,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.x;return de(n,{x:r-400,angle:-Math.PI*2,opacity:0},!1),ce(n,{x:r,angle:0,opacity:100},{duration:t,easing:"easeOutQuad",...e})}function x1(n,t=1e3,e={}){const i=C.elements.find(r=>r.id===n);return i?ce(n,{x:i.x+400,angle:Math.PI*2,opacity:0},{duration:t,easing:"easeInQuad",...e}):""}function Ra(n,t,e,i={}){const r=C.elements.find(y=>y.id===n);if(!r)return"";const s=r.x,a=r.y,o=r.width,l=r.height,c=t.scale??.1,h=o*c,f=l*c,d=(t.x??s)+(o-h)/2,u=(t.y??a)+(l-f)/2;return de(n,{x:d,y:u,width:h,height:f,opacity:0},!1),ce(n,{x:s,y:a,width:o,height:l,opacity:100},{duration:e,easing:"easeOutQuad",...i})}function k1(n,t=1e3,e={}){return Ra(n,{},t,e)}function _1(n,t=1e3,e={}){return Ra(n,{y:-window.innerHeight},t,e)}function S1(n,t=1e3,e={}){return Ra(n,{x:-window.innerWidth},t,e)}function A1(n,t=1e3,e={}){return Ra(n,{x:window.innerWidth+100},t,e)}function C1(n,t=1e3,e={}){return Ra(n,{y:window.innerHeight+100},t,e)}function Ta(n,t,e,i={}){const r=C.elements.find(a=>a.id===n);if(!r)return"";const s=t.scale??.1;return ce(n,{x:(t.x??r.x)+r.width*(1-s)/2,y:(t.y??r.y)+r.height*(1-s)/2,width:r.width*s,height:r.height*s,opacity:0},{duration:e,easing:"easeInQuad",...i})}function L1(n,t=1e3,e={}){return Ta(n,{},t,e)}function M1(n,t=1e3,e={}){return Ta(n,{y:window.innerHeight+100},t,e)}function N1(n,t=1e3,e={}){return Ta(n,{x:-window.innerWidth},t,e)}function P1(n,t=1e3,e={}){return Ta(n,{x:window.innerWidth+100},t,e)}function I1(n,t=1e3,e={}){return Ta(n,{y:-window.innerHeight},t,e)}function O1(n,t=1500,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.opacity??100;return de(n,{drawProgress:0,opacity:0},!1),ce(n,{drawProgress:100},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{de(n,{drawProgress:void 0,opacity:r},!1),e.onComplete?.()}})}function R1(n,t=1500,e={}){const i=C.elements.find(s=>s.id===n);if(!i)return"";const r=i.opacity??100;return de(n,{drawProgress:100,opacity:0},!1),ce(n,{drawProgress:0},{duration:t,easing:"easeInOutQuad",...e,onComplete:()=>{de(n,{drawProgress:void 0,opacity:r},!1),e.onComplete?.()}})}const es=new Map;function T1(n){return es.get(n)}function M5(n,t={}){const e=C.elements.find(h=>h.id===n);if(!e)return"";const i=e.entranceAnimation??"none",r=e.animationDuration??300,{isPreview:s=!0,onComplete:a}=t;s&&!es.has(n)&&es.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const o=s?es.get(n):null,l=()=>{s&&o&&(de(n,o,!1),es.delete(n)),a?.()},c={onComplete:l};switch(i){case"fadeIn":return de(n,{opacity:0},!1),ce(n,{opacity:100},{duration:r,easing:"easeOutQuad",onComplete:l});case"fadeInDown":return N0(n,r,c);case"fadeInDownBig":return P0(n,r,c);case"fadeInLeft":return I0(n,r,c);case"fadeInLeftBig":return O0(n,r,c);case"fadeInRight":return R0(n,r,c);case"fadeInRightBig":return T0(n,r,c);case"fadeInUp":return B0(n,r,c);case"fadeInUpBig":return E0(n,r,c);case"fadeInTopLeft":return D0(n,r,c);case"fadeInTopRight":return F0(n,r,c);case"fadeInBottomLeft":return $0(n,r,c);case"fadeInBottomRight":return z0(n,r,c);case"bounce":return _u(n,r,c);case"flash":return Au(n,r,c);case"pulse":return Su(n,r,{scale:1.1,...c});case"rubberBand":return Cu(n,r,c);case"shakeX":return Lu(n,r,{intensity:10,...c});case"shakeY":return Mu(n,r,{intensity:10,...c});case"headShake":return i0(n,r);case"swing":return s0(n,r);case"tada":return o0(n,r);case"wobble":return a0(n,r);case"jello":return l0(n,r);case"heartBeat":return c0(n,r);case"backInDown":return u0(n,r,c);case"backInLeft":return f0(n,r,c);case"backInRight":return d0(n,r,c);case"backInUp":return p0(n,r,c);case"bounceIn":return w0(n,r,c);case"bounceInDown":return v0(n,r,c);case"bounceInLeft":return x0(n,r,c);case"bounceInRight":return k0(n,r,c);case"bounceInUp":return _0(n,r,c);case"zoomIn":return k1(n,r,c);case"zoomInDown":return _1(n,r,c);case"zoomInLeft":return S1(n,r,c);case"zoomInRight":return A1(n,r,c);case"zoomInUp":return C1(n,r,c);case"slideInDown":{const h=e.y;return de(n,{y:-e.height,opacity:0},!1),ce(n,{y:h,opacity:100},{duration:r,easing:"easeOutQuad",onComplete:l})}case"slideInLeft":{const h=e.x;return de(n,{x:-e.width,opacity:0},!1),ce(n,{x:h,opacity:100},{duration:r,easing:"easeOutQuad",onComplete:l})}case"slideInRight":{const h=e.x;return de(n,{x:window.innerWidth+100,opacity:0},!1),ce(n,{x:h,opacity:100},{duration:r,easing:"easeOutQuad",onComplete:l})}case"slideInUp":{const h=e.y;return de(n,{y:window.innerHeight+100,opacity:0},!1),ce(n,{y:h,opacity:100},{duration:r,easing:"easeOutQuad",onComplete:l})}case"rotateIn":return l1(n,r,c);case"rotateInDownLeft":return c1(n,r,c);case"rotateInDownRight":return h1(n,r,c);case"rotateInUpLeft":return u1(n,r,c);case"rotateInUpRight":return f1(n,r,c);case"flip":return J0(n,r,c);case"flipInX":return t1(n,r,c);case"flipInY":return e1(n,r,c);case"lightSpeedInRight":return i1(n,r,c);case"lightSpeedInLeft":return s1(n,r,c);case"rollIn":return v1(n,r,c);case"jackInTheBox":return w1(n,r,c);case"scaleIn":return r0(n,r,c);case"drawIn":return O1(n,r,c);default:return""}}function N5(n,t={}){const e=C.elements.find(h=>h.id===n);if(!e)return"";const i=e.exitAnimation??"none",r=e.animationDuration??300,{isPreview:s=!0,onComplete:a}=t;s&&!es.has(n)&&es.set(n,{x:e.x,y:e.y,width:e.width,height:e.height,opacity:e.opacity,angle:e.angle,drawProgress:void 0});const o=s?es.get(n):null,l=()=>{s&&o&&(de(n,o,!1),es.delete(n)),a?.()},c={onComplete:l};switch(i){case"fadeOut":return ce(n,{opacity:0},{duration:r,easing:"easeOutQuad",onComplete:l});case"fadeOutDown":return j0(n,r,c);case"fadeOutDownBig":return U0(n,r,c);case"fadeOutLeft":return W0(n,r,c);case"fadeOutLeftBig":return q0(n,r,c);case"fadeOutRight":return X0(n,r,c);case"fadeOutRightBig":return G0(n,r,c);case"fadeOutUp":return H0(n,r,c);case"fadeOutUpBig":return Y0(n,r,c);case"fadeOutTopLeft":return V0(n,r,c);case"fadeOutTopRight":return Z0(n,r,c);case"fadeOutBottomLeft":return K0(n,r,c);case"fadeOutBottomRight":return Q0(n,r,c);case"backOutDown":return g0(n,r,c);case"backOutLeft":return y0(n,r,c);case"backOutRight":return m0(n,r,c);case"backOutUp":return b0(n,r,c);case"bounceOut":return S0(n,r,c);case"bounceOutDown":return A0(n,r,c);case"bounceOutLeft":return C0(n,r,c);case"bounceOutRight":return L0(n,r,c);case"bounceOutUp":return M0(n,r,c);case"zoomOut":return L1(n,r,c);case"zoomOutDown":return M1(n,r,c);case"zoomOutLeft":return N1(n,r,c);case"zoomOutRight":return P1(n,r,c);case"zoomOutUp":return I1(n,r,c);case"slideOutDown":return ce(n,{y:window.innerHeight+100,opacity:0},{duration:r,easing:"easeInQuad",onComplete:l});case"slideOutLeft":return ce(n,{x:-e.width,opacity:0},{duration:r,easing:"easeInQuad",onComplete:l});case"slideOutRight":return ce(n,{x:window.innerWidth+100,opacity:0},{duration:r,easing:"easeInQuad",onComplete:l});case"slideOutUp":return ce(n,{y:-e.height,opacity:0},{duration:r,easing:"easeInQuad",onComplete:l});case"bounce":return _u(n,r,c);case"flash":return Au(n,r,c);case"pulse":return Su(n,r,{scale:1.1,...c});case"rubberBand":return Cu(n,r,c);case"shakeX":return Lu(n,r,{intensity:10,...c});case"shakeY":return Mu(n,r,{intensity:10,...c});case"rotateOut":return d1(n,r,c);case"rotateOutDownLeft":return p1(n,r,c);case"rotateOutDownRight":return g1(n,r,c);case"rotateOutUpLeft":return y1(n,r,c);case"rotateOutUpRight":return m1(n,r,c);case"flipOutX":return n1(n,r,c);case"flipOutY":return r1(n,r,c);case"lightSpeedOutRight":return o1(n,r,c);case"lightSpeedOutLeft":return a1(n,r,c);case"rollOut":return x1(n,r,c);case"hinge":return b1(n,r,c);case"scaleOut":return h0(n,r,c);case"drawOut":return R1(n,r,c);default:return""}}function B1(n,t,e){const i=C.elements.find(f=>f.id===n);if(!i)return"";const r=Mo("morph"),s=new Set(["points","type"]);Ma(n,s),Dn.has(n)||Dn.set(n,new Map),Dn.get(n).set(r,s);const a=120,o=lo.getPointsFromElement(i),l=lo.getPointsFromElement(i,t),c=lo.resamplePolygon(o,a);let h=lo.resamplePolygon(l,a);return h=lo.alignPolygons(c,h),console.log("[Morph] Starting morph:",{elementId:n,startPoints:c.length,endPoints:h.length}),Fn.create(r,f=>{const d=lo.interpolatePoints(c,h,f);console.log("[Morph] Progress:",f.toFixed(3));const u=C.elements.findIndex(y=>y.id===n);if(u!==-1){const y=[...C.elements];y[u]={...y[u],points:[...d]},Kt("elements",y)}},{duration:e.duration,easing:e.easing,delay:e.delay,loop:e.loop,loopCount:e.loopCount,alternate:e.alternate,onComplete:()=>{const f=Dn.get(n);f&&(f.delete(r),f.size===0&&Dn.delete(n)),de(n,{type:t,points:void 0},!1),e.onComplete?.()}}),Fn.start(r),r}const P5=Object.freeze(Object.defineProperty({__proto__:null,animateAlongPath:n0,animateElement:ce,animateElements:d5,animateMorph:B1,backInDown:u0,backInLeft:f0,backInRight:d0,backInUp:p0,backOutDown:g0,backOutLeft:y0,backOutRight:m0,backOutUp:b0,bounce:_u,bounceIn:w0,bounceInDown:v0,bounceInLeft:x0,bounceInRight:k0,bounceInUp:_0,bounceOut:S0,bounceOutDown:A0,bounceOutLeft:C0,bounceOutRight:L0,bounceOutUp:M0,drawIn:O1,drawOut:R1,fadeIn:m5,fadeInBottomLeft:$0,fadeInBottomRight:z0,fadeInDown:N0,fadeInDownBig:P0,fadeInLeft:I0,fadeInLeftBig:O0,fadeInRight:R0,fadeInRightBig:T0,fadeInTopLeft:D0,fadeInTopRight:F0,fadeInUp:B0,fadeInUpBig:E0,fadeOut:b5,fadeOutBottomLeft:K0,fadeOutBottomRight:Q0,fadeOutDown:j0,fadeOutDownBig:U0,fadeOutLeft:W0,fadeOutLeftBig:q0,fadeOutRight:X0,fadeOutRightBig:G0,fadeOutTopLeft:V0,fadeOutTopRight:Z0,fadeOutUp:H0,fadeOutUpBig:Y0,flash:Au,flip:J0,flipInX:t1,flipInY:e1,flipOutX:n1,flipOutY:r1,getElementPreviewBaseState:T1,headShake:i0,heartBeat:c0,hinge:b1,isElementAnimating:u5,jackInTheBox:w1,jello:l0,lightSpeedInLeft:s1,lightSpeedInRight:i1,lightSpeedOutLeft:a1,lightSpeedOutRight:o1,pauseElementAnimation:g5,playEntranceAnimation:M5,playExitAnimation:N5,pulse:Su,resumeElementAnimation:y5,revolve:L5,rollIn:v1,rollOut:x1,rotateIn:l1,rotateInDownLeft:c1,rotateInDownRight:h1,rotateInUpLeft:u1,rotateInUpRight:f1,rotateOut:d1,rotateOutDownLeft:p1,rotateOutDownRight:g1,rotateOutUpLeft:y1,rotateOutUpRight:m1,rubberBand:Cu,scaleIn:r0,scaleOut:h0,shakeX:Lu,shakeY:Mu,slideInDown:k5,slideInLeft:w5,slideInRight:v5,slideInUp:x5,slideOutDown:C5,slideOutLeft:_5,slideOutRight:S5,slideOutUp:A5,stopAllElementAnimations:e0,stopConflictingAnimations:Ma,stopElementAnimation:p5,swing:s0,tada:o0,wobble:a0,zoomIn:k1,zoomInDown:_1,zoomInLeft:S1,zoomInRight:A1,zoomInUp:C1,zoomOut:L1,zoomOutDown:M1,zoomOutLeft:N1,zoomOutRight:P1,zoomOutUp:I1},Symbol.toStringTag,{value:"Module"}));class I5{activeSequences=new Set;playSequence(t,e="programmatic"){const i=C.elements.find(c=>c.id===t),r=i?.animations&&i.animations.length>0,s=i?.spinEnabled||i?.orbitEnabled;if(!i||!r&&!(e==="programmatic"&&s))return;let a=null;e==="programmatic"&&(this.activeSequences.add(t),fl(!0),Fn.setForceTicker(!0),a={x:i.x,y:i.y,width:i.width,height:i.height,opacity:i.opacity,angle:i.angle,strokeColor:i.strokeColor,backgroundColor:i.backgroundColor});const o=i.animations?i.animations.filter((c,h)=>e==="programmatic"?!0:h===0?c.trigger===e||c.trigger==="after-prev":!0):[];if(o.length===0)return void 0;const l=()=>{e==="programmatic"&&(this.activeSequences.delete(t),this.activeSequences.size===0&&(fl(!1),Fn.setForceTicker(!1))),a&&(o[o.length-1]?.restoreAfter??!0)&&setTimeout(()=>{de(t,a,!1)},500)};this.runStep(t,o,0,l)}stopSequence(t){e0(t),this.activeSequences.has(t)&&this.activeSequences.delete(t),this.activeSequences.size===0&&(fl(!1),Fn.setForceTicker(!1))}playAll(t="programmatic",e){(e?C.elements.filter(r=>e.includes(r.id)):C.elements).forEach(r=>{this.playSequence(r.id,t)})}stopAll(){this.activeSequences.clear(),fl(!1),Fn.setForceTicker(!1),C.elements.forEach(t=>{this.stopSequence(t.id)})}runStep(t,e,i,r){if(i>=e.length){r?.();return}const s=e[i],a=i+1,o=()=>{s.restoreAfter&&C.elements.find(d=>d.id===t)&&l&&de(t,l,!1);let h=a;for(;h<e.length&&e[h].trigger==="with-prev";)h++;h<e.length?this.runStep(t,e,h,r):r?.()};let l=null;if(s.restoreAfter){const h=C.elements.find(f=>f.id===t);h&&(l={...h})}let c=a;for(;c<e.length;){const h=e[c];if(h.trigger==="with-prev")this.executeAnimation(t,h,()=>{h.restoreAfter}),c++;else break}this.executeAnimation(t,s,o)}playAnimation(t,e,i){this.executeAnimation(t,e,i)}executeAnimation(t,e,i){const r={duration:e.duration,delay:e.delay,easing:e.easing,onComplete:i,params:e.params,loop:e.repeat===-1,loopCount:e.repeat!==-1&&(e.repeat||0)>0?e.repeat:void 0,alternate:e.yoyo};if(e.type==="preset"){const s=P5[e.name];typeof s=="function"?s(t,e.duration,r):(console.warn(`Unknown preset: ${e.name}`),i())}else e.type==="property"?this.animateProperty(t,e,r):e.type==="rotate"?this.animateRotate(t,e,r):e.type==="autoSpin"?this.animateAutoSpin(t,e,r):e.type==="path"?n0(t,e.pathData,{...r,orientToPath:e.orientToPath,isRelative:e.isRelative}):e.type==="morph"&&B1(t,e.targetShape,r)}animateRotate(t,e,i){const r=C.elements.find(a=>a.id===t);if(!r){i.onComplete?.();return}const s=e.relative?(r.angle||0)+e.toAngle*Math.PI/180:e.toAngle*Math.PI/180;ce(t,{angle:s},i)}animateAutoSpin(t,e,i){const r=C.elements.find(h=>h.id===t);if(!r){i.onComplete?.();return}const s=r.angle||0,a=e.direction==="counterclockwise"?-1:1,o=e.iterations==="infinite"?1/0:e.iterations||1,l=a*Math.PI*2,c={...i};if(o===1/0){c.loop=!0,c.loopCount=1/0,c.duration=i.duration||1e3;const h=i.onComplete;setTimeout(()=>{h?.()},0);const f=s+l;ce(t,{angle:f},{...c,onComplete:void 0})}else{const h=l*o,f=s+h;if(o>1&&i.duration){c.loop=!0,c.loopCount=o,c.duration=i.duration/o;const d=s+l;ce(t,{angle:d},c)}else ce(t,{angle:f},c)}}animateProperty(t,e,i){const r={},s=e.to;e.property==="opacity"||e.property==="x"||e.property==="y"||e.property==="width"||e.property==="height"||e.property==="angle"||e.property==="strokeWidth"||e.property==="roughness"?r[e.property]=Number(s):(e.property==="strokeColor"||e.property==="backgroundColor")&&(r[e.property]=String(s)),ce(t,r,i)}}const Pf=new I5,O5=(n,t,e)=>{const i=e[n];if(!i)return[];const{x:r,y:s}=i.spatialPosition,{width:a,height:o}=i.dimensions;return t.filter(l=>{const c=l.x+(l.width||0)/2,h=l.y+(l.height||0)/2;return c>=r&&c<=r+a&&h>=s&&h<=s+o})};class R5{buildSequence=[];isPlaying=!1;init(t){this.reset();const e=O5(t,C.elements,C.slides),i=[];e.forEach(r=>{r.animations&&r.animations.length>0&&r.animations.forEach(s=>{i.push({elementId:r.id,animation:s,played:!1})})}),console.log(`[BuildManager] Initialized for slide ${t}. Found ${i.length} total animations.`),i.forEach(r=>console.log(`  - Element ${r.elementId}: ${r.animation.type} (trigger: ${r.animation.trigger})`)),this.buildSequence=i.sort((r,s)=>{const a=e.find(l=>l.id===r.elementId),o=e.find(l=>l.id===s.elementId);if(a.layerId!==o.layerId){const l=C.layers.find(h=>h.id===a.layerId),c=C.layers.find(h=>h.id===o.layerId);return(l?.order??0)-(c?.order??0)}return r.elementId===s.elementId?(a.animations?.indexOf(r.animation)??0)-(o.animations?.indexOf(s.animation)??0):r.elementId.localeCompare(s.elementId)}),console.log(`[BuildManager] Initialized with ${this.buildSequence.length} steps for slide ${t}`)}reset(){this.buildSequence=[],this.isPlaying=!1,Pf.stopAll()}playInitial(){C.appMode==="presentation"&&this.buildSequence.forEach((t,e)=>{t.animation.trigger==="on-load"&&!t.played&&this.executeStep(e)})}hasMoreSteps(){return this.buildSequence.some(t=>!t.played&&t.animation.trigger==="on-click")}async playNext(){if(this.isPlaying)return console.log("[BuildManager] Already playing, ignoring click"),!0;const t=this.buildSequence.findIndex(e=>!e.played&&e.animation.trigger==="on-click");return t===-1?(console.log("[BuildManager] No more on-click steps found"),!1):(console.log(`[BuildManager] Executing on-click step ${t}`),this.isPlaying=!0,await this.executeStep(t),this.isPlaying=!1,!0)}executeStep(t){const e=this.buildSequence[t];return!e||e.played?Promise.resolve():(e.played=!0,new Promise(i=>{const r=()=>{this.triggerAfterPrev(t).then(i)};Pf.playAnimation(e.elementId,e.animation,r),this.triggerWithPrev(t)}))}triggerWithPrev(t){let e=t+1;for(;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="with-prev";)this.executeStep(e),e++}async triggerAfterPrev(t){let e=t+1;e<this.buildSequence.length&&this.buildSequence[e].animation.trigger==="after-prev"&&await this.executeStep(e)}}const ec=new R5,T5={rectangle:"rect",circle:"circ",triangle:"tria",diamond:"diam",hexagon:"hexa",octagon:"octa",parallelogram:"para",arrow:"arrw",line:"line",text:"text",image:"imag",ink:"ink_",laser:"lasr",group:"grup",slide:"slid",layer:"layr",star:"star",cloud:"clou",heart:"hear",cross:"cros",checkmark:"chck",capsule:"caps",stickyNote:"note",callout:"call",burst:"brst",speechBubble:"bubl",ribbon:"ribb",database:"data",document:"docu",server:"serv",user:"user",firewall:"fire",browser:"brow"},bi=n=>{let t=T5[n];t||(t=n.substring(0,4).toLowerCase()),t.length<4&&(t=t.padEnd(4,"_"));const e=`${t}-`;let i=0;return C.elements.forEach(r=>{if(r.id.startsWith(e)){const s=r.id.substring(e.length),a=parseInt(s,10);!isNaN(a)&&String(a)===s&&a>i&&(i=a)}}),`${e}${i+1}`},ra=by(),bo={elements:ra.elements,viewState:{scale:.5,panX:0,panY:0},layers:ra.layers,activeLayerId:ra.layers[0].id,gridSettings:ra.gridSettings,canvasBackgroundColor:"#ffffff",dimensions:{width:1920,height:1080},slides:ra.slides,activeSlideIndex:0,docType:"infinite",canvasTexture:"none",isPreviewing:!1,selectedTool:"selection",selectedUmlType:"umlClass",selection:[],flowTick:0,isRecording:!1,readOnly:!1,defaultElementStyles:{strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:2,strokeStyle:"solid",roughness:1,renderStyle:"sketch",opacity:100,angle:0,roundness:null,locked:!1,fontSize:20,fontFamily:"hand-drawn",fontWeight:!1,fontStyle:!1,textAlign:"left",startArrowhead:null,endArrowhead:null,autoResize:!1,flowColor:void 0,seed:0,shadowEnabled:!1,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:10,shadowOffsetX:5,shadowOffsetY:5,gradientStart:"#ffffff",gradientEnd:"#000000",gradientDirection:45,smoothing:3,taperAmount:.15,velocitySensitivity:.5},toolStyles:{},theme:localStorage.getItem("theme")||"light",globalSettings:{animationEnabled:!0,reducedMotion:!1,renderStyle:"sketch",showMindmapToolbar:!0},showCanvasProperties:!1,undoStackLength:0,redoStackLength:0,showPropertyPanel:!1,showLayerPanel:!1,isPropertyPanelMinimized:!1,isLayerPanelMinimized:!1,minimapVisible:!1,zenMode:!1,appMode:"design",showCommandPalette:!1,selectedPenType:"fineliner",selectedShapeType:"triangle",selectedInfraType:"server",selectedMathType:"trapezoid",selectedSketchnoteType:"starPerson",selectedWireframeType:"browserWindow",layerGroupingModeEnabled:!1,maxLayers:20,selectedTechnicalType:"dfdProcess",states:[],showStatePanel:!1,showSlideNavigator:!0,showSlideToolbar:!0,showMainToolbar:!0,slideToolbarPosition:{x:window.innerWidth/2-150,y:window.innerHeight-80},showExportDialog:!1,showUtilityToolbar:!0,pathEditState:{isActive:!1,elementId:null,animationId:null}},[C,Kt]=my(bo),da=[],Sn=()=>{const n={elements:JSON.parse(JSON.stringify(C.elements)),layers:JSON.parse(JSON.stringify(C.layers))};da.push(n),da.length>50&&da.shift(),Kt("undoStackLength",da.length),Kt("redoStackLength",0)},hl=n=>{Sn(),Kt("elements",t=>[...t,n])},B5=n=>{const t=C.elements.find(l=>l.id===n);if(!t)return;Sn();const e=bi(t.type),i=150,s={...C.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:t.backgroundColor,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:e,type:t.type==="image"||t.type==="line"||t.type==="arrow"?"rectangle":t.type,x:t.x+t.width+i,y:t.y+0,width:t.width>0?t.width:100,height:t.height>0?t.height:60,layerId:C.activeLayerId,parentId:t.id,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},a={...C.defaultElementStyles,id:bi("arrow"),type:"arrow",x:t.x+t.width,y:t.y+t.height/2,width:i,height:0,layerId:C.activeLayerId,startBinding:{elementId:t.id,gap:5,position:"right",focus:0},endBinding:{elementId:e,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,i,0]},o=a.id;return Kt("elements",l=>[...l,s,a]),Kt("elements",l=>l.id===n,"boundElements",l=>[...l||[],{id:o,type:"arrow"}]),Kt("elements",l=>l.id===e,"boundElements",l=>[...l||[],{id:o,type:"arrow"}]),Kt("selection",[e]),e},E5=n=>{const t=C.elements.find(l=>l.id===n);if(!t)return;const e=t.parentId;if(!e)return;Sn();const i=bi(t.type),r=t.height+40,s={...C.defaultElementStyles,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,renderStyle:t.renderStyle,opacity:t.opacity,strokeStyle:t.strokeStyle||"solid",id:i,type:t.type,x:t.x,y:t.y+r,width:t.width,height:t.height,layerId:C.activeLayerId,parentId:e,text:"",isCollapsed:!1,angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null},a={...C.defaultElementStyles,id:bi("arrow"),type:"arrow",x:t.x-150,y:t.y+r+t.height/2,width:150,height:0,layerId:C.activeLayerId,startBinding:{elementId:e,gap:5,position:"right",focus:0},endBinding:{elementId:i,gap:5,position:"left",focus:0},curveType:"bezier",angle:0,seed:Math.floor(Math.random()*2**31),roundness:null,locked:!1,link:null,opacity:100,renderStyle:t.renderStyle,strokeColor:t.strokeColor,backgroundColor:"transparent",fillStyle:t.fillStyle,strokeStyle:t.strokeStyle,strokeWidth:t.strokeWidth,roughness:t.roughness,points:[0,0,150,0]},o=a.id;return Kt("elements",l=>[...l,s,a]),Kt("elements",l=>l.id===e,"boundElements",l=>[...l||[],{id:o,type:"arrow"}]),Kt("elements",l=>l.id===i,"boundElements",l=>[...l||[],{id:o,type:"arrow"}]),Kt("selection",[i]),i},If=n=>{Kt("showCanvasProperties",n),n&&(Kt("showPropertyPanel",!0),Kt("isPropertyPanelMinimized",!1))},pa=n=>{n.length!==0&&(Sn(),Kt("elements",t=>t.filter(e=>!n.includes(e.id))),Kt("selection",[]))},D5=n=>{n.length!==0&&(Sn(),Kt("elements",t=>{const e=t.filter(r=>n.includes(r.id));return[...t.filter(r=>!n.includes(r.id)),...e]}))},F5=n=>{n.length!==0&&(Sn(),Kt("elements",t=>{const e=t.filter(r=>n.includes(r.id)),i=t.filter(r=>!n.includes(r.id));return[...e,...i]}))},$5=()=>{const n=C.elements.some(t=>t.flowAnimation);Fn.setForceTicker(n)},de=(n,t,e=!1)=>{e&&Sn(),Kt("elements",i=>i.id===n,t),"flowAnimation"in t&&$5()},Of=(n,t,e,i=!1)=>{i&&Sn(),Kt("elements",r=>r.id===n,"animations",r=>r.id===t,e)},Or=n=>{Kt("viewState",t=>({...t,...n}))},wo=n=>{const t=C.selectedTool;if(t!=="selection"){const e=JSON.parse(JSON.stringify(C.defaultElementStyles));Kt("toolStyles",t,e)}if(Kt("selectedTool",n),n!=="selection"&&n!=="pan"&&n!=="eraser"&&Kt("selection",[]),n!=="selection"){const e=C.toolStyles[n];e&&ia(e)}n==="arrow"?ia({endArrowhead:"arrow"}):n==="line"&&ia({endArrowhead:null}),ia(n==="starPerson"||n==="scroll"||n==="wavyDivider"||n==="doubleBanner"||n==="lightbulb"||n==="signpost"||n==="burstBlob"||n==="browserWindow"||n==="mobilePhone"||n==="ghostButton"||n==="inputField"?{autoResize:!1}:{autoResize:!1})},ia=n=>{Kt("defaultElementStyles",t=>({...t,...n}))},z5=(n,t=null,e=null)=>{Kt("pathEditState",{isActive:n,elementId:t,animationId:e})},j5=(n,t)=>{Kt("slides",n,"thumbnail",t)},E1=async(n,t)=>{if(n<0||n>=C.slides.length||n===C.activeSlideIndex&&!nh.transitioning)return;Kt("selection",[]),C.appMode==="presentation"&&!0?await nh.transitionTo(n):await nh.transitionTo(n,{skipAnimation:!0});const i=C.slides[n];i&&(i.backgroundColor&&Kt("canvasBackgroundColor",i.backgroundColor),Kt("dimensions",JSON.parse(JSON.stringify(i.dimensions))),C.appMode==="presentation"&&(ec.init(n),ec.playInitial())),Mi(`Slide ${n+1}`,"info")},D1=async()=>{if(C.states.findIndex(t=>t.id===C.activeStateId)<C.states.length-1){q5();return}if(ec.hasMoreSteps()){await ec.playNext();return}C.activeSlideIndex<C.slides.length-1&&await E1(C.activeSlideIndex+1)},U5=async()=>{if(C.states.findIndex(t=>t.id===C.activeStateId)>0){X5();return}C.activeSlideIndex>0&&await E1(C.activeSlideIndex-1)},ul=(n,t)=>{n<0||n>=C.slides.length||(typeof t=="string"?(t.startsWith("#")||t.startsWith("rgb")||t.startsWith("hsl")||t.startsWith("color(")||t.includes("display-p3"))&&(Kt("slides",n,{backgroundColor:t,fillStyle:"solid"}),n===C.activeSlideIndex&&Kt("canvasBackgroundColor",t)):(Kt("slides",n,t),n===C.activeSlideIndex&&t.backgroundColor&&Kt("canvasBackgroundColor",t.backgroundColor)))},W5=n=>{Ca(()=>{let t=[],e=[],i=[],r=n.gridSettings||bo.gridSettings,s=n.states||[];if(n.version===4)t=n.elements,e=n.slides,i=n.layers,s=n.states||[],r=n.gridSettings||r;else if(n.version===3){i=n.slides[0]?.layers||bo.layers;const o=2e3;n.slides.forEach((l,c)=>{const h=c*o,f=0,d=l.elements.map(u=>({...u,x:u.x+h,y:u.y+f}));t.push(...d),e.push({id:l.id,name:l.name,spatialPosition:{x:h,y:f},dimensions:l.dimensions||{width:1920,height:1080},order:c,backgroundColor:l.backgroundColor,thumbnail:l.thumbnail}),l.states&&s.push(...l.states)})}else t=n.elements||[],i=n.layers||bo.layers,e=[Jp()];e.forEach(o=>{o.transition||(o.transition={...tc})}),Kt("elements",JSON.parse(JSON.stringify(t))),Kt("slides",JSON.parse(JSON.stringify(e))),Kt("layers",JSON.parse(JSON.stringify(i))),Kt("states",JSON.parse(JSON.stringify(s))),Kt("gridSettings",JSON.parse(JSON.stringify(r))),Kt("globalSettings",n.globalSettings||bo.globalSettings);const a=n.metadata?.docType||(n.version>=3?"slides":"infinite");Kt("docType",a),Kt("showSlideNavigator",a==="slides"),Kt("showSlideToolbar",!0),Kt("showUtilityToolbar",!0),Kt("activeSlideIndex",0),Kt("selection",[]),i.some(o=>o.id===C.activeLayerId)||Kt("activeLayerId",i[0]?.id||"default-layer"),setTimeout(()=>Yh(),100)}),G5()},F1=async(n,t=!0)=>{const e=C.states.find(i=>i.id===n);if(e)if(Kt("activeStateId",n),t){const{MorphAnimator:i}=await Tl(async()=>{const{MorphAnimator:r}=await import("./morph-animator.js");return{MorphAnimator:r}},[]);i.morphTo(e)}else Ca(()=>{Object.entries(e.overrides).forEach(([i,r])=>{de(i,r,!1)})})},q5=async()=>{if(C.states.length===0)return;const t=(C.states.findIndex(e=>e.id===C.activeStateId)+1)%C.states.length;await F1(C.states[t].id)},X5=async()=>{if(C.states.length===0)return;let t=C.states.findIndex(e=>e.id===C.activeStateId)-1;t<0&&(t=C.states.length-1),await F1(C.states[t].id)},G5=()=>{da.length=0,Kt("undoStackLength",0),Kt("redoStackLength",0)},H5=n=>{const t=C.elements.find(s=>s.id===n);if(!t)return;Sn();const e=bi(t.type),i=10/C.viewState.scale,r={...t,id:e,x:t.x+i,y:t.y+i,points:t.points?t.pointsEncoding==="flat"?[...t.points]:t.points.map(s=>({...s})):void 0,roundness:t.roundness?{...t.roundness}:null,crop:t.crop?{...t.crop}:null,boundElements:null,groupIds:t.groupIds?[...t.groupIds]:void 0,seed:Math.floor(Math.random()*2147483647)};Kt("elements",s=>[...s,r]),Kt("selection",[e])},Y5=()=>{if(C.selection.length<2)return;Sn();const n=bi("group");Kt("elements",t=>C.selection.includes(t.id),"groupIds",t=>[...t||[],n])},V5=()=>{if(C.selection.length===0)return;const n=new Set;C.elements.forEach(t=>{C.selection.includes(t.id)&&t.groupIds&&t.groupIds.length>0&&n.add(t.groupIds[t.groupIds.length-1])}),n.size!==0&&(Sn(),Kt("elements",t=>{if(!t.groupIds||t.groupIds.length===0)return!1;const e=t.groupIds[t.groupIds.length-1];return n.has(e)},"groupIds",t=>t&&t.slice(0,-1)))},Rf=(n,t)=>{const e=C.elements.findIndex(i=>i.id===n);e!==-1&&(Sn(),Kt("elements",i=>{const r=[...i],s=r.splice(e,1)[0];if(t==="front")r.push(s);else if(t==="back")r.unshift(s);else if(t==="forward"){const a=Math.min(r.length,e+1);r.splice(a,0,s)}else if(t==="backward"){const a=Math.max(0,e-1);r.splice(a,0,s)}return r}))},Z5=()=>{if(C.elements.length===0){Kt("viewState",{scale:1,panX:0,panY:0});return}let n=1/0,t=1/0,e=-1/0,i=-1/0;C.elements.forEach(w=>{n=Math.min(n,w.x),e=Math.max(e,w.x+w.width),t=Math.min(t,w.y),i=Math.max(i,w.y+w.height)});const r=e-n,s=i-t;if(r===0&&s===0){const w=n,m=t,x=window.innerWidth/2,_=window.innerHeight/2;Kt("viewState",{scale:1,panX:-w+x,panY:-m+_});return}const a=50,o=window.innerWidth,l=window.innerHeight,c=(o-a*2)/r,h=(l-a*2)/s;let f=Math.min(c,h);f=Math.min(Math.max(f,.1),2);const d=n+r/2,u=t+s/2,y=o/2,g=l/2;Kt("viewState",{scale:f,panX:-d*f+y,panY:-u*f+g})},K5=n=>{C.layers.find(e=>e.id===n)&&Kt("activeLayerId",n)},Qi=n=>{const t=C.layers.find(e=>e.id===n);return!t||t.visible===!1?!1:C.layerGroupingModeEnabled&&t.parentId?Qi(t.parentId):!0},$1=n=>{const t=C.layers.find(e=>e.id===n);return t?t.locked?!0:C.layerGroupingModeEnabled&&t.parentId?$1(t.parentId):t.locked||!1:!1},Q5=()=>{Kt("gridSettings","enabled",!C.gridSettings.enabled)},J5=()=>{Kt("gridSettings","snapToGrid",!C.gridSettings.snapToGrid)},fl=n=>Kt("isPreviewing",n),tm=n=>{C.isPropertyPanelMinimized&&n===!0?(Kt("isPropertyPanelMinimized",!1),Kt("showPropertyPanel",!0)):Kt("showPropertyPanel",n)},em=n=>{Kt("minimapVisible",t=>n)},nm=n=>{Kt("zenMode",t=>n??!t)},Yh=()=>{const n=C.slides[C.activeSlideIndex];if(!n)return;const{width:t,height:e}=n.dimensions,{x:i,y:r}=n.spatialPosition,s=40,a=window.innerWidth-s*2,o=window.innerHeight-s*2,l=a/t,c=o/e,h=Math.min(l,c),f=(window.innerWidth-t*h)/2-i*h,d=(window.innerHeight-e*h)/2-r*h;Kt("viewState",{scale:h,panX:f,panY:d})},rm=n=>{C.appMode,Ca(()=>{Kt("appMode","design")}),document.fullscreenElement&&document.exitFullscreen?.()};document.documentElement.setAttribute("data-theme",bo.theme);const Tf=n=>{const t=C.elements.find(e=>e.id===n);t&&de(n,{isCollapsed:!t.isCollapsed},!0)},im=(n,t)=>{de(n,{parentId:t},!0)},sm=n=>{de(n,{parentId:null},!0)},sa=(n,t)=>{const e=new t0,i=e.buildTree(n,C.elements);if(!i)return;Sn(),t.startsWith("horizontal")?e.layoutHorizontal(i,t==="horizontal-right"?"right":"left"):t.startsWith("vertical")?e.layoutVertical(i,t==="vertical-down"?"down":"up"):t==="radial"&&e.layoutRadial(i);const r=e.getUpdates(i,C.elements),s=C.elements.map(a=>{const o=r.get(a.id);return o?{...a,...o}:a});Kt("elements",s),Mi(`Mindmap layout updated (${t})`,"success")},om=n=>{const t=new t0,e=t.buildTree(n,C.elements);if(!e)return;Sn(),t.applySemanticStyling(e,C.elements);const i=t.getUpdates(e,C.elements),r=C.elements.map(s=>{const a=i.get(s.id);return a?{...s,...a}:s});Kt("elements",r),Mi("Semantic styling applied to branch","success")};typeof window<"u"&&setInterval(()=>{const n=Date.now(),t=C.elements.filter(e=>e.ttl&&n>e.ttl).map(e=>e.id);t.length>0&&Kt("elements",e=>e.filter(i=>!t.includes(i.id)))},500);const[am,lm]=En(0),[rh,cm]=En(0),[m3,Bf]=En(!1),[b3,ih]=En(!1),[hm,sh]=En(!1);class um{animations=new Map;rafId=null;isRunning=!1;forceTicker=!1;lastTickTime=0;setForceTicker(t){this.forceTicker=t,t&&this.ensureLoopRunning()}create(t,e,i){const r={id:t,state:"idle",startTime:0,pauseTime:null,duration:i.duration??0,delay:i.delay??0,easing:Xh(i.easing),onUpdate:e,onComplete:i.onComplete,onStart:i.onStart,loop:i.loop??!1,loopCount:i.loopCount??1/0,currentLoop:0,alternate:i.alternate??!1,direction:1};return this.animations.set(t,r),t}start(t){const e=this.animations.get(t);if(e){if(e.state==="paused"&&e.pauseTime!==null){const i=e.pauseTime-e.startTime;e.startTime=performance.now()-i,e.pauseTime=null}else e.startTime=performance.now(),e.currentLoop=0,e.direction=1;e.state="running",e.onStart?.(),this.ensureLoopRunning()}}pause(t){const e=this.animations.get(t);!e||e.state!=="running"||(e.state="paused",e.pauseTime=performance.now())}stop(t){const e=this.animations.get(t);e&&(e.state="completed",this.animations.delete(t),this.animations.size===0&&!this.forceTicker&&this.stopLoop())}reset(t){const e=this.animations.get(t);e&&(e.state="idle",e.startTime=0,e.pauseTime=null,e.currentLoop=0,e.direction=1,e.onUpdate(0))}getState(t){return this.animations.get(t)?.state??null}has(t){return this.animations.has(t)}stopAll(){this.animations.clear(),ih(!1),sh(!1),this.stopLoop()}pauseAll(){for(const t of this.animations.values())t.state==="running"&&(t.state="paused",t.pauseTime=performance.now())}resumeAll(){const t=performance.now();for(const e of this.animations.values())if(e.state==="paused"&&e.pauseTime!==null){const i=e.pauseTime-e.startTime;e.startTime=t-i,e.pauseTime=null,e.state="running"}this.ensureLoopRunning()}tick=t=>{if(!this.isRunning){this.lastTickTime=0;return}this.lastTickTime===0&&(this.lastTickTime=t);const e=t-this.lastTickTime;this.lastTickTime=t;const i=C.globalSettings?.animationEnabled??!0;let r=!1;Ca(()=>{lm(t),hm()||cm(a=>a+e);for(const a of this.animations.values()){if(a.state!=="running")continue;if(r=!0,!i){a.onUpdate(1),a.state="completed",a.onComplete?.(),this.animations.delete(a.id);continue}const o=t-a.startTime-a.delay;if(o<0)continue;let l=Math.min(o/a.duration,1);a.direction===-1&&(l=1-l);const c=a.easing(l);a.onUpdate(c),o>=a.duration&&(a.loop&&a.currentLoop<a.loopCount-1?(a.currentLoop++,a.startTime=t,a.alternate&&(a.direction=a.direction===1?-1:1)):(a.state="completed",a.onComplete?.(),this.animations.delete(a.id)))}});let s=!1;if(!r){for(const a of this.animations.values())if(a.state==="paused"){s=!0;break}}ih(r),sh(s),r||this.animations.size>0||this.forceTicker?this.rafId=requestAnimationFrame(this.tick):this.stopLoop()};ensureLoopRunning(){this.isRunning||(this.isRunning=!0,Bf(!0),this.rafId=requestAnimationFrame(this.tick))}stopLoop(){this.isRunning=!1,Bf(!1),ih(!1),sh(!1),this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}}const Fn=new um;let fm=0;function Mo(n="anim"){return`${n}-${Date.now()}-${++fm}`}function oh(n,t,e){if(n&&n.length){const[i,r]=t,s=Math.PI/180*e,a=Math.cos(s),o=Math.sin(s);for(const l of n){const[c,h]=l;l[0]=(c-i)*a-(h-r)*o+i,l[1]=(c-i)*o+(h-r)*a+r}}}function dm(n,t){return n[0]===t[0]&&n[1]===t[1]}function pm(n,t,e,i=1){const r=e,s=Math.max(t,.1),a=n[0]&&n[0][0]&&typeof n[0][0]=="number"?[n]:n,o=[0,0];if(r)for(const c of a)oh(c,o,r);const l=(function(c,h,f){const d=[];for(const x of c){const _=[...x];dm(_[0],_[_.length-1])||_.push([_[0][0],_[0][1]]),_.length>2&&d.push(_)}const u=[];h=Math.max(h,.1);const y=[];for(const x of d)for(let _=0;_<x.length-1;_++){const L=x[_],T=x[_+1];if(L[1]!==T[1]){const q=Math.min(L[1],T[1]);y.push({ymin:q,ymax:Math.max(L[1],T[1]),x:q===L[1]?L[0]:T[0],islope:(T[0]-L[0])/(T[1]-L[1])})}}if(y.sort(((x,_)=>x.ymin<_.ymin?-1:x.ymin>_.ymin?1:x.x<_.x?-1:x.x>_.x?1:x.ymax===_.ymax?0:(x.ymax-_.ymax)/Math.abs(x.ymax-_.ymax))),!y.length)return u;let g=[],w=y[0].ymin,m=0;for(;g.length||y.length;){if(y.length){let x=-1;for(let _=0;_<y.length&&!(y[_].ymin>w);_++)x=_;y.splice(0,x+1).forEach((_=>{g.push({s:w,edge:_})}))}if(g=g.filter((x=>!(x.edge.ymax<=w))),g.sort(((x,_)=>x.edge.x===_.edge.x?0:(x.edge.x-_.edge.x)/Math.abs(x.edge.x-_.edge.x))),(f!==1||m%h==0)&&g.length>1)for(let x=0;x<g.length;x+=2){const _=x+1;if(_>=g.length)break;const L=g[x].edge,T=g[_].edge;u.push([[Math.round(L.x),w],[Math.round(T.x),w]])}w+=f,g.forEach((x=>{x.edge.x=x.edge.x+f*x.edge.islope})),m++}return u})(a,s,i);if(r){for(const c of a)oh(c,o,-r);(function(c,h,f){const d=[];c.forEach((u=>d.push(...u))),oh(d,h,f)})(l,o,-r)}return l}function Ba(n,t){var e;const i=t.hachureAngle+90;let r=t.hachureGap;r<0&&(r=4*t.strokeWidth),r=Math.round(Math.max(r,.1));let s=1;return t.roughness>=1&&(((e=t.randomizer)===null||e===void 0?void 0:e.next())||Math.random())>.7&&(s=r),pm(n,r,i,s||1)}let Nu=class{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const i=Ba(t,e);return{type:"fillSketch",ops:this.renderLines(i,e)}}renderLines(t,e){const i=[];for(const r of t)i.push(...this.helper.doubleLineOps(r[0][0],r[0][1],r[1][0],r[1][1],e));return i}};function vc(n){const t=n[0],e=n[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}let gm=class extends Nu{fillPolygons(t,e){let i=e.hachureGap;i<0&&(i=4*e.strokeWidth),i=Math.max(i,.1);const r=Ba(t,Object.assign({},e,{hachureGap:i})),s=Math.PI/180*e.hachureAngle,a=[],o=.5*i*Math.cos(s),l=.5*i*Math.sin(s);for(const[c,h]of r)vc([c,h])&&a.push([[c[0]-o,c[1]+l],[...h]],[[c[0]+o,c[1]-l],[...h]]);return{type:"fillSketch",ops:this.renderLines(a,e)}}};class ym extends Nu{fillPolygons(t,e){const i=this._fillPolygons(t,e),r=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),s=this._fillPolygons(t,r);return i.ops=i.ops.concat(s.ops),i}}let mm=class{constructor(t){this.helper=t}fillPolygons(t,e){const i=Ba(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(i,e)}dotsOnLines(t,e){const i=[];let r=e.hachureGap;r<0&&(r=4*e.strokeWidth),r=Math.max(r,.1);let s=e.fillWeight;s<0&&(s=e.strokeWidth/2);const a=r/4;for(const o of t){const l=vc(o),c=l/r,h=Math.ceil(c)-1,f=l-h*r,d=(o[0][0]+o[1][0])/2-r/4,u=Math.min(o[0][1],o[1][1]);for(let y=0;y<h;y++){const g=u+f+y*r,w=d-a+2*Math.random()*a,m=g-a+2*Math.random()*a,x=this.helper.ellipse(w,m,s,s,e);i.push(...x.ops)}}return{type:"fillSketch",ops:i}}},bm=class{constructor(t){this.helper=t}fillPolygons(t,e){const i=Ba(t,e);return{type:"fillSketch",ops:this.dashedLine(i,e)}}dashedLine(t,e){const i=e.dashOffset<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashOffset,r=e.dashGap<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashGap,s=[];return t.forEach((a=>{const o=vc(a),l=Math.floor(o/(i+r)),c=(o+r-l*(i+r))/2;let h=a[0],f=a[1];h[0]>f[0]&&(h=a[1],f=a[0]);const d=Math.atan((f[1]-h[1])/(f[0]-h[0]));for(let u=0;u<l;u++){const y=u*(i+r),g=y+i,w=[h[0]+y*Math.cos(d)+c*Math.cos(d),h[1]+y*Math.sin(d)+c*Math.sin(d)],m=[h[0]+g*Math.cos(d)+c*Math.cos(d),h[1]+g*Math.sin(d)+c*Math.sin(d)];s.push(...this.helper.doubleLineOps(w[0],w[1],m[0],m[1],e))}})),s}},wm=class{constructor(t){this.helper=t}fillPolygons(t,e){const i=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,r=e.zigzagOffset<0?i:e.zigzagOffset,s=Ba(t,e=Object.assign({},e,{hachureGap:i+r}));return{type:"fillSketch",ops:this.zigzagLines(s,r,e)}}zigzagLines(t,e,i){const r=[];return t.forEach((s=>{const a=vc(s),o=Math.round(a/(2*e));let l=s[0],c=s[1];l[0]>c[0]&&(l=s[1],c=s[0]);const h=Math.atan((c[1]-l[1])/(c[0]-l[0]));for(let f=0;f<o;f++){const d=2*f*e,u=2*(f+1)*e,y=Math.sqrt(2*Math.pow(e,2)),g=[l[0]+d*Math.cos(h),l[1]+d*Math.sin(h)],w=[l[0]+u*Math.cos(h),l[1]+u*Math.sin(h)],m=[g[0]+y*Math.cos(h+Math.PI/4),g[1]+y*Math.sin(h+Math.PI/4)];r.push(...this.helper.doubleLineOps(g[0],g[1],m[0],m[1],i),...this.helper.doubleLineOps(m[0],m[1],w[0],w[1],i))}})),r}};const Br={};let vm=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}};const xm=0,ah=1,Ef=2,dl={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function lh(n,t){return n.type===t}function Pu(n){const t=[],e=(function(a){const o=new Array;for(;a!=="";)if(a.match(/^([ \\t\\r\\n,]+)/))a=a.substr(RegExp.$1.length);else if(a.match(/^([aAcChHlLmMqQsStTvVzZ])/))o[o.length]={type:xm,text:RegExp.$1},a=a.substr(RegExp.$1.length);else{if(!a.match(/^(([-+]?[0-9]+(\\.[0-9]*)?|[-+]?\\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];o[o.length]={type:ah,text:`${parseFloat(RegExp.$1)}`},a=a.substr(RegExp.$1.length)}return o[o.length]={type:Ef,text:""},o})(n);let i="BOD",r=0,s=e[r];for(;!lh(s,Ef);){let a=0;const o=[];if(i==="BOD"){if(s.text!=="M"&&s.text!=="m")return Pu("M0,0"+n);r++,a=dl[s.text],i=s.text}else lh(s,ah)?a=dl[i]:(r++,a=dl[s.text],i=s.text);if(!(r+a<e.length))throw new Error("Path data ended short");for(let l=r;l<r+a;l++){const c=e[l];if(!lh(c,ah))throw new Error("Param not a number: "+i+","+c.text);o[o.length]=+c.text}if(typeof dl[i]!="number")throw new Error("Bad segment: "+i);{const l={key:i,data:o};t.push(l),r+=a,s=e[r],i==="M"&&(i="L"),i==="m"&&(i="l")}}return t}function z1(n){let t=0,e=0,i=0,r=0;const s=[];for(const{key:a,data:o}of n)switch(a){case"M":s.push({key:"M",data:[...o]}),[t,e]=o,[i,r]=o;break;case"m":t+=o[0],e+=o[1],s.push({key:"M",data:[t,e]}),i=t,r=e;break;case"L":s.push({key:"L",data:[...o]}),[t,e]=o;break;case"l":t+=o[0],e+=o[1],s.push({key:"L",data:[t,e]});break;case"C":s.push({key:"C",data:[...o]}),t=o[4],e=o[5];break;case"c":{const l=o.map(((c,h)=>h%2?c+e:c+t));s.push({key:"C",data:l}),t=l[4],e=l[5];break}case"Q":s.push({key:"Q",data:[...o]}),t=o[2],e=o[3];break;case"q":{const l=o.map(((c,h)=>h%2?c+e:c+t));s.push({key:"Q",data:l}),t=l[2],e=l[3];break}case"A":s.push({key:"A",data:[...o]}),t=o[5],e=o[6];break;case"a":t+=o[5],e+=o[6],s.push({key:"A",data:[o[0],o[1],o[2],o[3],o[4],t,e]});break;case"H":s.push({key:"H",data:[...o]}),t=o[0];break;case"h":t+=o[0],s.push({key:"H",data:[t]});break;case"V":s.push({key:"V",data:[...o]}),e=o[0];break;case"v":e+=o[0],s.push({key:"V",data:[e]});break;case"S":s.push({key:"S",data:[...o]}),t=o[2],e=o[3];break;case"s":{const l=o.map(((c,h)=>h%2?c+e:c+t));s.push({key:"S",data:l}),t=l[2],e=l[3];break}case"T":s.push({key:"T",data:[...o]}),t=o[0],e=o[1];break;case"t":t+=o[0],e+=o[1],s.push({key:"T",data:[t,e]});break;case"Z":case"z":s.push({key:"Z",data:[]}),t=i,e=r}return s}function j1(n){const t=[];let e="",i=0,r=0,s=0,a=0,o=0,l=0;for(const{key:c,data:h}of n){switch(c){case"M":t.push({key:"M",data:[...h]}),[i,r]=h,[s,a]=h;break;case"C":t.push({key:"C",data:[...h]}),i=h[4],r=h[5],o=h[2],l=h[3];break;case"L":t.push({key:"L",data:[...h]}),[i,r]=h;break;case"H":i=h[0],t.push({key:"L",data:[i,r]});break;case"V":r=h[0],t.push({key:"L",data:[i,r]});break;case"S":{let f=0,d=0;e==="C"||e==="S"?(f=i+(i-o),d=r+(r-l)):(f=i,d=r),t.push({key:"C",data:[f,d,...h]}),o=h[0],l=h[1],i=h[2],r=h[3];break}case"T":{const[f,d]=h;let u=0,y=0;e==="Q"||e==="T"?(u=i+(i-o),y=r+(r-l)):(u=i,y=r);const g=i+2*(u-i)/3,w=r+2*(y-r)/3,m=f+2*(u-f)/3,x=d+2*(y-d)/3;t.push({key:"C",data:[g,w,m,x,f,d]}),o=u,l=y,i=f,r=d;break}case"Q":{const[f,d,u,y]=h,g=i+2*(f-i)/3,w=r+2*(d-r)/3,m=u+2*(f-u)/3,x=y+2*(d-y)/3;t.push({key:"C",data:[g,w,m,x,u,y]}),o=f,l=d,i=u,r=y;break}case"A":{const f=Math.abs(h[0]),d=Math.abs(h[1]),u=h[2],y=h[3],g=h[4],w=h[5],m=h[6];f===0||d===0?(t.push({key:"C",data:[i,r,w,m,w,m]}),i=w,r=m):(i!==w||r!==m)&&(U1(i,r,w,m,f,d,u,y,g).forEach((function(x){t.push({key:"C",data:x})})),i=w,r=m);break}case"Z":t.push({key:"Z",data:[]}),i=s,r=a}e=c}return t}function oa(n,t,e){return[n*Math.cos(e)-t*Math.sin(e),n*Math.sin(e)+t*Math.cos(e)]}function U1(n,t,e,i,r,s,a,o,l,c){const h=(f=a,Math.PI*f/180);var f;let d=[],u=0,y=0,g=0,w=0;if(c)[u,y,g,w]=c;else{[n,t]=oa(n,t,-h),[e,i]=oa(e,i,-h);const $=(n-e)/2,S=(t-i)/2;let J=$*$/(r*r)+S*S/(s*s);J>1&&(J=Math.sqrt(J),r*=J,s*=J);const mt=r*r,ot=s*s,ft=mt*ot-mt*S*S-ot*$*$,ct=mt*S*S+ot*$*$,Bt=(o===l?-1:1)*Math.sqrt(Math.abs(ft/ct));g=Bt*r*S/s+(n+e)/2,w=Bt*-s*$/r+(t+i)/2,u=Math.asin(parseFloat(((t-w)/s).toFixed(9))),y=Math.asin(parseFloat(((i-w)/s).toFixed(9))),n<g&&(u=Math.PI-u),e<g&&(y=Math.PI-y),u<0&&(u=2*Math.PI+u),y<0&&(y=2*Math.PI+y),l&&u>y&&(u-=2*Math.PI),!l&&y>u&&(y-=2*Math.PI)}let m=y-u;if(Math.abs(m)>120*Math.PI/180){const $=y,S=e,J=i;y=l&&y>u?u+120*Math.PI/180*1:u+120*Math.PI/180*-1,d=U1(e=g+r*Math.cos(y),i=w+s*Math.sin(y),S,J,r,s,a,0,l,[y,$,g,w])}m=y-u;const x=Math.cos(u),_=Math.sin(u),L=Math.cos(y),T=Math.sin(y),q=Math.tan(m/4),U=4/3*r*q,B=4/3*s*q,O=[n,t],X=[n+U*_,t-B*x],R=[e+U*T,i-B*L],M=[e,i];if(X[0]=2*O[0]-X[0],X[1]=2*O[1]-X[1],c)return[X,R,M].concat(d);{d=[X,R,M].concat(d);const $=[];for(let S=0;S<d.length;S+=3){const J=oa(d[S][0],d[S][1],h),mt=oa(d[S+1][0],d[S+1][1],h),ot=oa(d[S+2][0],d[S+2][1],h);$.push([J[0],J[1],mt[0],mt[1],ot[0],ot[1]])}return $}}const km={randOffset:function(n,t){return Ue(n,t)},randOffsetWithRange:function(n,t,e){return nc(n,t,e)},ellipse:function(n,t,e,i,r){const s=q1(e,i,r);return Vh(n,t,r,s).opset},doubleLineOps:function(n,t,e,i,r){return ks(n,t,e,i,r,!0)}};function W1(n,t,e,i,r){return{type:"path",ops:ks(n,t,e,i,r)}}function Bl(n,t,e){const i=(n||[]).length;if(i>2){const r=[];for(let s=0;s<i-1;s++)r.push(...ks(n[s][0],n[s][1],n[s+1][0],n[s+1][1],e));return t&&r.push(...ks(n[i-1][0],n[i-1][1],n[0][0],n[0][1],e)),{type:"path",ops:r}}return i===2?W1(n[0][0],n[0][1],n[1][0],n[1][1],e):{type:"path",ops:[]}}function _m(n,t,e,i,r){return(function(s,a){return Bl(s,!0,a)})([[n,t],[n+e,t],[n+e,t+i],[n,t+i]],r)}function Df(n,t){if(n.length){const e=typeof n[0][0]=="number"?[n]:n,i=pl(e[0],1*(1+.2*t.roughness),t),r=t.disableMultiStroke?[]:pl(e[0],1.5*(1+.22*t.roughness),zf(t));for(let s=1;s<e.length;s++){const a=e[s];if(a.length){const o=pl(a,1*(1+.2*t.roughness),t),l=t.disableMultiStroke?[]:pl(a,1.5*(1+.22*t.roughness),zf(t));for(const c of o)c.op!=="move"&&i.push(c);for(const c of l)c.op!=="move"&&r.push(c)}}return{type:"path",ops:i.concat(r)}}return{type:"path",ops:[]}}function q1(n,t,e){const i=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(n/2,2)+Math.pow(t/2,2))/2)),r=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*i)),s=2*Math.PI/r;let a=Math.abs(n/2),o=Math.abs(t/2);const l=1-e.curveFitting;return a+=Ue(a*l,e),o+=Ue(o*l,e),{increment:s,rx:a,ry:o}}function Vh(n,t,e,i){const[r,s]=jf(i.increment,n,t,i.rx,i.ry,1,i.increment*nc(.1,nc(.4,1,e),e),e);let a=rc(r,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[o]=jf(i.increment,n,t,i.rx,i.ry,1.5,0,e),l=rc(o,null,e);a=a.concat(l)}return{estimatedPoints:s,opset:{type:"path",ops:a}}}function Ff(n,t,e,i,r,s,a,o,l){const c=n,h=t;let f=Math.abs(e/2),d=Math.abs(i/2);f+=Ue(.01*f,l),d+=Ue(.01*d,l);let u=r,y=s;for(;u<0;)u+=2*Math.PI,y+=2*Math.PI;y-u>2*Math.PI&&(u=0,y=2*Math.PI);const g=2*Math.PI/l.curveStepCount,w=Math.min(g/2,(y-u)/2),m=Uf(w,c,h,f,d,u,y,1,l);if(!l.disableMultiStroke){const x=Uf(w,c,h,f,d,u,y,1.5,l);m.push(...x)}return a&&(o?m.push(...ks(c,h,c+f*Math.cos(u),h+d*Math.sin(u),l),...ks(c,h,c+f*Math.cos(y),h+d*Math.sin(y),l)):m.push({op:"lineTo",data:[c,h]},{op:"lineTo",data:[c+f*Math.cos(u),h+d*Math.sin(u)]})),{type:"path",ops:m}}function $f(n,t){const e=j1(z1(Pu(n))),i=[];let r=[0,0],s=[0,0];for(const{key:a,data:o}of e)switch(a){case"M":s=[o[0],o[1]],r=[o[0],o[1]];break;case"L":i.push(...ks(s[0],s[1],o[0],o[1],t)),s=[o[0],o[1]];break;case"C":{const[l,c,h,f,d,u]=o;i.push(...Sm(l,c,h,f,d,u,s,t)),s=[d,u];break}case"Z":i.push(...ks(s[0],s[1],r[0],r[1],t)),s=[r[0],r[1]]}return{type:"path",ops:i}}function ch(n,t){const e=[];for(const i of n)if(i.length){const r=t.maxRandomnessOffset||0,s=i.length;if(s>2){e.push({op:"move",data:[i[0][0]+Ue(r,t),i[0][1]+Ue(r,t)]});for(let a=1;a<s;a++)e.push({op:"lineTo",data:[i[a][0]+Ue(r,t),i[a][1]+Ue(r,t)]})}}return{type:"fillPath",ops:e}}function co(n,t){return(function(e,i){let r=e.fillStyle||"hachure";if(!Br[r])switch(r){case"zigzag":Br[r]||(Br[r]=new gm(i));break;case"cross-hatch":Br[r]||(Br[r]=new ym(i));break;case"dots":Br[r]||(Br[r]=new mm(i));break;case"dashed":Br[r]||(Br[r]=new bm(i));break;case"zigzag-line":Br[r]||(Br[r]=new wm(i));break;default:r="hachure",Br[r]||(Br[r]=new Nu(i))}return Br[r]})(t,km).fillPolygons(n,t)}function zf(n){const t=Object.assign({},n);return t.randomizer=void 0,n.seed&&(t.seed=n.seed+1),t}function X1(n){return n.randomizer||(n.randomizer=new vm(n.seed||0)),n.randomizer.next()}function nc(n,t,e,i=1){return e.roughness*i*(X1(e)*(t-n)+n)}function Ue(n,t,e=1){return nc(-n,n,t,e)}function ks(n,t,e,i,r,s=!1){const a=s?r.disableMultiStrokeFill:r.disableMultiStroke,o=Zh(n,t,e,i,r,!0,!1);if(a)return o;const l=Zh(n,t,e,i,r,!0,!0);return o.concat(l)}function Zh(n,t,e,i,r,s,a){const o=Math.pow(n-e,2)+Math.pow(t-i,2),l=Math.sqrt(o);let c=1;c=l<200?1:l>500?.4:-.0016668*l+1.233334;let h=r.maxRandomnessOffset||0;h*h*100>o&&(h=l/10);const f=h/2,d=.2+.2*X1(r);let u=r.bowing*r.maxRandomnessOffset*(i-t)/200,y=r.bowing*r.maxRandomnessOffset*(n-e)/200;u=Ue(u,r,c),y=Ue(y,r,c);const g=[],w=()=>Ue(f,r,c),m=()=>Ue(h,r,c),x=r.preserveVertices;return a?g.push({op:"move",data:[n+(x?0:w()),t+(x?0:w())]}):g.push({op:"move",data:[n+(x?0:Ue(h,r,c)),t+(x?0:Ue(h,r,c))]}),a?g.push({op:"bcurveTo",data:[u+n+(e-n)*d+w(),y+t+(i-t)*d+w(),u+n+2*(e-n)*d+w(),y+t+2*(i-t)*d+w(),e+(x?0:w()),i+(x?0:w())]}):g.push({op:"bcurveTo",data:[u+n+(e-n)*d+m(),y+t+(i-t)*d+m(),u+n+2*(e-n)*d+m(),y+t+2*(i-t)*d+m(),e+(x?0:m()),i+(x?0:m())]}),g}function pl(n,t,e){if(!n.length)return[];const i=[];i.push([n[0][0]+Ue(t,e),n[0][1]+Ue(t,e)]),i.push([n[0][0]+Ue(t,e),n[0][1]+Ue(t,e)]);for(let r=1;r<n.length;r++)i.push([n[r][0]+Ue(t,e),n[r][1]+Ue(t,e)]),r===n.length-1&&i.push([n[r][0]+Ue(t,e),n[r][1]+Ue(t,e)]);return rc(i,null,e)}function rc(n,t,e){const i=n.length,r=[];if(i>3){const s=[],a=1-e.curveTightness;r.push({op:"move",data:[n[1][0],n[1][1]]});for(let o=1;o+2<i;o++){const l=n[o];s[0]=[l[0],l[1]],s[1]=[l[0]+(a*n[o+1][0]-a*n[o-1][0])/6,l[1]+(a*n[o+1][1]-a*n[o-1][1])/6],s[2]=[n[o+1][0]+(a*n[o][0]-a*n[o+2][0])/6,n[o+1][1]+(a*n[o][1]-a*n[o+2][1])/6],s[3]=[n[o+1][0],n[o+1][1]],r.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[3][0],s[3][1]]})}}else i===3?(r.push({op:"move",data:[n[1][0],n[1][1]]}),r.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):i===2&&r.push(...Zh(n[0][0],n[0][1],n[1][0],n[1][1],e,!0,!0));return r}function jf(n,t,e,i,r,s,a,o){const l=[],c=[];if(o.roughness===0){n/=4,c.push([t+i*Math.cos(-n),e+r*Math.sin(-n)]);for(let h=0;h<=2*Math.PI;h+=n){const f=[t+i*Math.cos(h),e+r*Math.sin(h)];l.push(f),c.push(f)}c.push([t+i*Math.cos(0),e+r*Math.sin(0)]),c.push([t+i*Math.cos(n),e+r*Math.sin(n)])}else{const h=Ue(.5,o)-Math.PI/2;c.push([Ue(s,o)+t+.9*i*Math.cos(h-n),Ue(s,o)+e+.9*r*Math.sin(h-n)]);const f=2*Math.PI+h-.01;for(let d=h;d<f;d+=n){const u=[Ue(s,o)+t+i*Math.cos(d),Ue(s,o)+e+r*Math.sin(d)];l.push(u),c.push(u)}c.push([Ue(s,o)+t+i*Math.cos(h+2*Math.PI+.5*a),Ue(s,o)+e+r*Math.sin(h+2*Math.PI+.5*a)]),c.push([Ue(s,o)+t+.98*i*Math.cos(h+a),Ue(s,o)+e+.98*r*Math.sin(h+a)]),c.push([Ue(s,o)+t+.9*i*Math.cos(h+.5*a),Ue(s,o)+e+.9*r*Math.sin(h+.5*a)])}return[c,l]}function Uf(n,t,e,i,r,s,a,o,l){const c=s+Ue(.1,l),h=[];h.push([Ue(o,l)+t+.9*i*Math.cos(c-n),Ue(o,l)+e+.9*r*Math.sin(c-n)]);for(let f=c;f<=a;f+=n)h.push([Ue(o,l)+t+i*Math.cos(f),Ue(o,l)+e+r*Math.sin(f)]);return h.push([t+i*Math.cos(a),e+r*Math.sin(a)]),h.push([t+i*Math.cos(a),e+r*Math.sin(a)]),rc(h,null,l)}function Sm(n,t,e,i,r,s,a,o){const l=[],c=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.3];let h=[0,0];const f=o.disableMultiStroke?1:2,d=o.preserveVertices;for(let u=0;u<f;u++)u===0?l.push({op:"move",data:[a[0],a[1]]}):l.push({op:"move",data:[a[0]+(d?0:Ue(c[0],o)),a[1]+(d?0:Ue(c[0],o))]}),h=d?[r,s]:[r+Ue(c[u],o),s+Ue(c[u],o)],l.push({op:"bcurveTo",data:[n+Ue(c[u],o),t+Ue(c[u],o),e+Ue(c[u],o),i+Ue(c[u],o),h[0],h[1]]});return l}function aa(n){return[...n]}function Wf(n,t=0){const e=n.length;if(e<3)throw new Error("A curve must have at least three points.");const i=[];if(e===3)i.push(aa(n[0]),aa(n[1]),aa(n[2]),aa(n[2]));else{const r=[];r.push(n[0],n[0]);for(let o=1;o<n.length;o++)r.push(n[o]),o===n.length-1&&r.push(n[o]);const s=[],a=1-t;i.push(aa(r[0]));for(let o=1;o+2<r.length;o++){const l=r[o];s[0]=[l[0],l[1]],s[1]=[l[0]+(a*r[o+1][0]-a*r[o-1][0])/6,l[1]+(a*r[o+1][1]-a*r[o-1][1])/6],s[2]=[r[o+1][0]+(a*r[o][0]-a*r[o+2][0])/6,r[o+1][1]+(a*r[o][1]-a*r[o+2][1])/6],s[3]=[r[o+1][0],r[o+1][1]],i.push(s[1],s[2],s[3])}}return i}function El(n,t){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function Am(n,t,e){const i=El(t,e);if(i===0)return El(n,t);let r=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;return r=Math.max(0,Math.min(1,r)),El(n,zs(t,e,r))}function zs(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e]}function Kh(n,t,e,i){const r=i||[];if((function(o,l){const c=o[l+0],h=o[l+1],f=o[l+2],d=o[l+3];let u=3*h[0]-2*c[0]-d[0];u*=u;let y=3*h[1]-2*c[1]-d[1];y*=y;let g=3*f[0]-2*d[0]-c[0];g*=g;let w=3*f[1]-2*d[1]-c[1];return w*=w,u<g&&(u=g),y<w&&(y=w),u+y})(n,t)<e){const o=n[t+0];r.length?(s=r[r.length-1],a=o,Math.sqrt(El(s,a))>1&&r.push(o)):r.push(o),r.push(n[t+3])}else{const l=n[t+0],c=n[t+1],h=n[t+2],f=n[t+3],d=zs(l,c,.5),u=zs(c,h,.5),y=zs(h,f,.5),g=zs(d,u,.5),w=zs(u,y,.5),m=zs(g,w,.5);Kh([l,d,g,m],0,e,r),Kh([m,w,y,f],0,e,r)}var s,a;return r}function Cm(n,t){return ic(n,0,n.length,t)}function ic(n,t,e,i,r){const s=r||[],a=n[t],o=n[e-1];let l=0,c=1;for(let h=t+1;h<e-1;++h){const f=Am(n[h],a,o);f>l&&(l=f,c=h)}return Math.sqrt(l)>i?(ic(n,t,c+1,i,s),ic(n,c,e,i,s)):(s.length||s.push(a),s.push(o)),s}function hh(n,t=.15,e){const i=[],r=(n.length-1)/3;for(let s=0;s<r;s++)Kh(n,3*s,t,i);return e&&e>0?ic(i,0,i.length,e):i}const Vr="none";let sc=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,i){return{shape:t,sets:e||[],options:i||this.defaultOptions}}line(t,e,i,r,s){const a=this._o(s);return this._d("line",[W1(t,e,i,r,a)],a)}rectangle(t,e,i,r,s){const a=this._o(s),o=[],l=_m(t,e,i,r,a);if(a.fill){const c=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]];a.fillStyle==="solid"?o.push(ch([c],a)):o.push(co([c],a))}return a.stroke!==Vr&&o.push(l),this._d("rectangle",o,a)}ellipse(t,e,i,r,s){const a=this._o(s),o=[],l=q1(i,r,a),c=Vh(t,e,a,l);if(a.fill)if(a.fillStyle==="solid"){const h=Vh(t,e,a,l).opset;h.type="fillPath",o.push(h)}else o.push(co([c.estimatedPoints],a));return a.stroke!==Vr&&o.push(c.opset),this._d("ellipse",o,a)}circle(t,e,i,r){const s=this.ellipse(t,e,i,i,r);return s.shape="circle",s}linearPath(t,e){const i=this._o(e);return this._d("linearPath",[Bl(t,!1,i)],i)}arc(t,e,i,r,s,a,o=!1,l){const c=this._o(l),h=[],f=Ff(t,e,i,r,s,a,o,!0,c);if(o&&c.fill)if(c.fillStyle==="solid"){const d=Object.assign({},c);d.disableMultiStroke=!0;const u=Ff(t,e,i,r,s,a,!0,!1,d);u.type="fillPath",h.push(u)}else h.push((function(d,u,y,g,w,m,x){const _=d,L=u;let T=Math.abs(y/2),q=Math.abs(g/2);T+=Ue(.01*T,x),q+=Ue(.01*q,x);let U=w,B=m;for(;U<0;)U+=2*Math.PI,B+=2*Math.PI;B-U>2*Math.PI&&(U=0,B=2*Math.PI);const O=(B-U)/x.curveStepCount,X=[];for(let R=U;R<=B;R+=O)X.push([_+T*Math.cos(R),L+q*Math.sin(R)]);return X.push([_+T*Math.cos(B),L+q*Math.sin(B)]),X.push([_,L]),co([X],x)})(t,e,i,r,s,a,c));return c.stroke!==Vr&&h.push(f),this._d("arc",h,c)}curve(t,e){const i=this._o(e),r=[],s=Df(t,i);if(i.fill&&i.fill!==Vr)if(i.fillStyle==="solid"){const a=Df(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));r.push({type:"fillPath",ops:this._mergedShape(a.ops)})}else{const a=[],o=t;if(o.length){const l=typeof o[0][0]=="number"?[o]:o;for(const c of l)c.length<3?a.push(...c):c.length===3?a.push(...hh(Wf([c[0],c[0],c[1],c[2]]),10,(1+i.roughness)/2)):a.push(...hh(Wf(c),10,(1+i.roughness)/2))}a.length&&r.push(co([a],i))}return i.stroke!==Vr&&r.push(s),this._d("curve",r,i)}polygon(t,e){const i=this._o(e),r=[],s=Bl(t,!0,i);return i.fill&&(i.fillStyle==="solid"?r.push(ch([t],i)):r.push(co([t],i))),i.stroke!==Vr&&r.push(s),this._d("polygon",r,i)}path(t,e){const i=this._o(e),r=[];if(!t)return this._d("path",r,i);t=(t||"").replace(/\\n/g," ").replace(/(-\\s)/g,"-").replace("/(ss)/g"," ");const s=i.fill&&i.fill!=="transparent"&&i.fill!==Vr,a=i.stroke!==Vr,o=!!(i.simplification&&i.simplification<1),l=(function(h,f,d){const u=j1(z1(Pu(h))),y=[];let g=[],w=[0,0],m=[];const x=()=>{m.length>=4&&g.push(...hh(m,f)),m=[]},_=()=>{x(),g.length&&(y.push(g),g=[])};for(const{key:T,data:q}of u)switch(T){case"M":_(),w=[q[0],q[1]],g.push(w);break;case"L":x(),g.push([q[0],q[1]]);break;case"C":if(!m.length){const U=g.length?g[g.length-1]:w;m.push([U[0],U[1]])}m.push([q[0],q[1]]),m.push([q[2],q[3]]),m.push([q[4],q[5]]);break;case"Z":x(),g.push([w[0],w[1]])}if(_(),!d)return y;const L=[];for(const T of y){const q=Cm(T,d);q.length&&L.push(q)}return L})(t,1,o?4-4*(i.simplification||1):(1+i.roughness)/2),c=$f(t,i);if(s)if(i.fillStyle==="solid")if(l.length===1){const h=$f(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));r.push({type:"fillPath",ops:this._mergedShape(h.ops)})}else r.push(ch(l,i));else r.push(co(l,i));return a&&(o?l.forEach((h=>{r.push(Bl(h,!1,i))})):r.push(c)),this._d("path",r,i)}opsToPath(t,e){let i="";for(const r of t.ops){const s=typeof e=="number"&&e>=0?r.data.map((a=>+a.toFixed(e))):r.data;switch(r.op){case"move":i+=`M${s[0]} ${s[1]} `;break;case"bcurveTo":i+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":i+=`L${s[0]} ${s[1]} `}}return i.trim()}toPaths(t){const e=t.sets||[],i=t.options||this.defaultOptions,r=[];for(const s of e){let a=null;switch(s.type){case"path":a={d:this.opsToPath(s),stroke:i.stroke,strokeWidth:i.strokeWidth,fill:Vr};break;case"fillPath":a={d:this.opsToPath(s),stroke:Vr,strokeWidth:0,fill:i.fill||Vr};break;case"fillSketch":a=this.fillSketch(s,i)}a&&r.push(a)}return r}fillSketch(t,e){let i=e.fillWeight;return i<0&&(i=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||Vr,strokeWidth:i,fill:Vr}}_mergedShape(t){return t.filter(((e,i)=>i===0||e.op!=="move"))}},Lm=class{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new sc(e)}draw(t){const e=t.sets||[],i=t.options||this.getDefaultOptions(),r=this.ctx,s=t.options.fixedDecimalPlaceDigits;for(const a of e)switch(a.type){case"path":r.save(),r.strokeStyle=i.stroke==="none"?"transparent":i.stroke,r.lineWidth=i.strokeWidth,i.strokeLineDash&&r.setLineDash(i.strokeLineDash),i.strokeLineDashOffset&&(r.lineDashOffset=i.strokeLineDashOffset),this._drawToContext(r,a,s),r.restore();break;case"fillPath":{r.save(),r.fillStyle=i.fill||"";const o=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(r,a,s,o),r.restore();break}case"fillSketch":this.fillSketch(r,a,i)}}fillSketch(t,e,i){let r=i.fillWeight;r<0&&(r=i.strokeWidth/2),t.save(),i.fillLineDash&&t.setLineDash(i.fillLineDash),i.fillLineDashOffset&&(t.lineDashOffset=i.fillLineDashOffset),t.strokeStyle=i.fill||"",t.lineWidth=r,this._drawToContext(t,e,i.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,i,r="nonzero"){t.beginPath();for(const s of e.ops){const a=typeof i=="number"&&i>=0?s.data.map((o=>+o.toFixed(i))):s.data;switch(s.op){case"move":t.moveTo(a[0],a[1]);break;case"bcurveTo":t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"lineTo":t.lineTo(a[0],a[1])}}e.type==="fillPath"?t.fill(r):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,i,r,s){const a=this.gen.line(t,e,i,r,s);return this.draw(a),a}rectangle(t,e,i,r,s){const a=this.gen.rectangle(t,e,i,r,s);return this.draw(a),a}ellipse(t,e,i,r,s){const a=this.gen.ellipse(t,e,i,r,s);return this.draw(a),a}circle(t,e,i,r){const s=this.gen.circle(t,e,i,r);return this.draw(s),s}linearPath(t,e){const i=this.gen.linearPath(t,e);return this.draw(i),i}polygon(t,e){const i=this.gen.polygon(t,e);return this.draw(i),i}arc(t,e,i,r,s,a,o=!1,l){const c=this.gen.arc(t,e,i,r,s,a,o,l);return this.draw(c),c}curve(t,e){const i=this.gen.curve(t,e);return this.draw(i),i}path(t,e){const i=this.gen.path(t,e);return this.draw(i),i}};const gl="http://www.w3.org/2000/svg";let Mm=class{constructor(t,e){this.svg=t,this.gen=new sc(e)}draw(t){const e=t.sets||[],i=t.options||this.getDefaultOptions(),r=this.svg.ownerDocument||window.document,s=r.createElementNS(gl,"g"),a=t.options.fixedDecimalPlaceDigits;for(const o of e){let l=null;switch(o.type){case"path":l=r.createElementNS(gl,"path"),l.setAttribute("d",this.opsToPath(o,a)),l.setAttribute("stroke",i.stroke),l.setAttribute("stroke-width",i.strokeWidth+""),l.setAttribute("fill","none"),i.strokeLineDash&&l.setAttribute("stroke-dasharray",i.strokeLineDash.join(" ").trim()),i.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${i.strokeLineDashOffset}`);break;case"fillPath":l=r.createElementNS(gl,"path"),l.setAttribute("d",this.opsToPath(o,a)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",i.fill||""),t.shape!=="curve"&&t.shape!=="polygon"||l.setAttribute("fill-rule","evenodd");break;case"fillSketch":l=this.fillSketch(r,o,i)}l&&s.appendChild(l)}return s}fillSketch(t,e,i){let r=i.fillWeight;r<0&&(r=i.strokeWidth/2);const s=t.createElementNS(gl,"path");return s.setAttribute("d",this.opsToPath(e,i.fixedDecimalPlaceDigits)),s.setAttribute("stroke",i.fill||""),s.setAttribute("stroke-width",r+""),s.setAttribute("fill","none"),i.fillLineDash&&s.setAttribute("stroke-dasharray",i.fillLineDash.join(" ").trim()),i.fillLineDashOffset&&s.setAttribute("stroke-dashoffset",`${i.fillLineDashOffset}`),s}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,i,r,s){const a=this.gen.line(t,e,i,r,s);return this.draw(a)}rectangle(t,e,i,r,s){const a=this.gen.rectangle(t,e,i,r,s);return this.draw(a)}ellipse(t,e,i,r,s){const a=this.gen.ellipse(t,e,i,r,s);return this.draw(a)}circle(t,e,i,r){const s=this.gen.circle(t,e,i,r);return this.draw(s)}linearPath(t,e){const i=this.gen.linearPath(t,e);return this.draw(i)}polygon(t,e){const i=this.gen.polygon(t,e);return this.draw(i)}arc(t,e,i,r,s,a,o=!1,l){const c=this.gen.arc(t,e,i,r,s,a,o,l);return this.draw(c)}curve(t,e){const i=this.gen.curve(t,e);return this.draw(i)}path(t,e){const i=this.gen.path(t,e);return this.draw(i)}};var oc={canvas:(n,t)=>new Lm(n,t),svg:(n,t)=>new Mm(n,t),generator:n=>new sc(n),newSeed:()=>sc.newSeed()};const po=(n,t,e)=>{if((n.type==="line"||n.type==="arrow")&&n.endBinding){const s=n.endBinding.elementId,a=e?e.get(s):t.find(o=>o.id===s);if(a&&po(a,t,e))return!0}if(!n.parentId)return!1;let i=n.parentId;const r=new Set;for(;i&&!r.has(i);){r.add(i);const s=i,a=e?e.get(s):t.find(o=>o.id===s);if(!a)break;if(a.isCollapsed)return!0;i=a.parentId||null}return!1},uh=(n,t)=>{const e=[],i=[n],r=new Set;for(;i.length>0;){const s=i.shift();if(r.has(s))continue;r.add(s);const a=t.filter(o=>o.parentId===s);e.push(...a),i.push(...a.map(o=>o.id))}return e};class Nm{renderers=new Map;register(t,e){this.renderers.set(t,e)}getRenderer(t){return this.renderers.get(t)}}const qn=new Nm,Tn=n=>{if(!n||n.length===0)return[];if(typeof n[0]=="number"){const t=[];for(let e=0;e<n.length-1;e+=2)t.push({x:n[e],y:n[e+1]});return t}return n},yl=(n,t,e,i,r)=>{const s=1-r;return s*s*s*n+3*s*s*r*t+3*s*r*r*e+r*r*r*i},ac=(n,t,e,i=!1,r=1)=>{const s=qn.getRenderer(e.type);if(s){s.render({rc:n,ctx:t,element:e,isDarkMode:i,layerOpacity:r});return}console.warn(`No renderer registered for element type: ${e.type}`)},Pm=(n,t)=>{let e=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){const s=t[i].x,a=t[i].y,o=t[r].x,l=t[r].y;a>n.y!=l>n.y&&n.x<(o-s)*(n.y-a)/(l-a)+s&&(e=!e)}return e},Qh=(n,t,e)=>{const i=n.x,r=n.y,s=t.x,a=t.y,o=e.x,l=e.y,c=i-s,h=r-a,f=o-s,d=l-a,u=c*f+h*d,y=f*f+d*d;let g=-1;y!==0&&(g=u/y);let w,m;g<0?(w=s,m=a):g>1?(w=o,m=l):(w=s+g*f,m=a+g*d);const x=i-w,_=r-m;return Math.sqrt(x*x+_*_)},lc=(n,t,e,i,r)=>{const s=1-r;return s*s*s*n+3*s*s*r*t+3*s*r*r*e+r*r*r*i},Im=(n,t,e,i,r)=>{const s=3*(1-r)*(1-r)*(t.x-n.x)+6*(1-r)*r*(e.x-t.x)+3*r*r*(i.x-e.x),a=3*(1-r)*(1-r)*(t.y-n.y)+6*(1-r)*r*(e.y-t.y)+3*r*r*(i.y-e.y);return Math.atan2(a,s)},qf=(n,t,e,i,r)=>{const a=Math.max(r*8,4),o=Math.max(r*2,2),l=[],c=[];for(let h=0;h<=20;h++){const f=h/20,d=lc(n.x,e.x,i.x,t.x,f),u=lc(n.y,e.y,i.y,t.y,f),y=Im(n,e,i,t,f),w=(a+(o-a)*f)/2,m=Math.cos(y+Math.PI/2)*w,x=Math.sin(y+Math.PI/2)*w;l.push({x:d+m,y:u+x}),c.push({x:d-m,y:u-x})}return[...l,...c.reverse()]},Om=(n,t,e,i,r=20)=>{const s=[];for(let a=0;a<=r;a++){const o=a/r;s.push({x:lc(n.x,t.x,e.x,i.x,o),y:lc(n.y,t.y,e.y,i.y,o)})}return s},ml=(n,t,e,i,r,s)=>{const a=Om(t,e,i,r,20);return Dl(n,a,s)},Dl=(n,t,e)=>{if(t.length<2)return!1;for(let i=0;i<t.length-1;i++)if(Qh(n,t[i],t[i+1])<=e)return!0;return!1},Rm=(n,t,e,i,r,s=0)=>{const a=Math.abs(i/2)+s,o=Math.abs(r/2)+s,l=t+i/2,c=e+r/2;return a<=0||o<=0?!1:Math.pow(n.x-l,2)/Math.pow(a,2)+Math.pow(n.y-c,2)/Math.pow(o,2)<=1},Dr=(n,t,e,i,r)=>{const s=Math.cos(r),a=Math.sin(r);return{x:s*(n-e)-a*(t-i)+e,y:a*(n-e)+s*(t-i)+i}},fh=(n,t,e=0)=>{const i=n.x+n.width/2,r=n.y+n.height/2;if(n.type==="rectangle"||n.type==="image"||n.type==="text"){let s={x:t.x,y:t.y};n.angle&&(s=Dr(t.x,t.y,i,r,-n.angle));const a=n.width,o=n.height,l=i-a/2-e,c=i+a/2+e,h=r-o/2-e,f=r+o/2+e,d=s.x-i,u=s.y-r;if(d===0&&u===0)return{x:i,y:r};let y=1/0;if(d!==0){const m=(l-i)/d;m>0&&(y=Math.min(y,m));const x=(c-i)/d;x>0&&(y=Math.min(y,x))}if(u!==0){const m=(h-r)/u;m>0&&(y=Math.min(y,m));const x=(f-r)/u;x>0&&(y=Math.min(y,x))}if(y===1/0)return null;const g=i+d*y,w=r+u*y;return n.angle?Dr(g,w,i,r,n.angle):{x:g,y:w}}else if(n.type==="circle"){const s=n.width/2+e,a=n.height/2+e;let o={x:t.x,y:t.y};n.angle&&(o=Dr(t.x,t.y,i,r,-n.angle));const l=o.x-i,c=o.y-r;if(l===0&&c===0)return null;const h=l*l/(s*s)+c*c/(a*a),f=1/Math.sqrt(h),d=i+l*f,u=r+c*f;return n.angle?Dr(d,u,i,r,n.angle):{x:d,y:u}}else if(n.type==="diamond"){let s={x:t.x,y:t.y};n.angle&&(s=Dr(t.x,t.y,i,r,-n.angle));const a=n.width/2+e,o=n.height/2+e,l=s.x-i,c=s.y-r;if(l===0&&c===0)return{x:i,y:r};const h=Math.atan2(c,l),f=Math.abs(Math.tan(h)),d=1/(1/a+f/o),u=i+(l>0?1:-1)*d,y=r+(l>0?1:-1)*d*Math.tan(h);return n.angle?Dr(u,y,i,r,n.angle):{x:u,y}}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"||n.type==="cloud"||n.type==="heart"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="fineliner"||n.type==="inkbrush"||n.type==="marker"){let s={x:t.x,y:t.y};n.angle&&(s=Dr(t.x,t.y,i,r,-n.angle));const a=n.width,o=n.height,l=i-a/2-e,c=i+a/2+e,h=r-o/2-e,f=r+o/2+e,d=s.x-i,u=s.y-r;if(d===0&&u===0)return{x:i,y:r};let y=1/0;if(d!==0){const m=(l-i)/d;m>0&&(y=Math.min(y,m));const x=(c-i)/d;x>0&&(y=Math.min(y,x))}if(u!==0){const m=(h-r)/u;m>0&&(y=Math.min(y,m));const x=(f-r)/u;x>0&&(y=Math.min(y,x))}if(y===1/0)return null;const g=i+d*y,w=r+u*y;return n.angle?Dr(g,w,i,r,n.angle):{x:g,y:w}}return null};function Fl(n){const t=n.x+n.width/2,e=n.y+n.height/2,i=n.width,r=n.height;let s=[];if(n.type==="rectangle"||n.type==="image"||n.type==="text"){const a=[{x:t-i/2,y:e-r/2,position:"top-left"},{x:t+i/2,y:e-r/2,position:"top-right"},{x:t-i/2,y:e+r/2,position:"bottom-left"},{x:t+i/2,y:e+r/2,position:"bottom-right"},{x:t,y:e-r/2,position:"top"},{x:t+i/2,y:e,position:"right"},{x:t,y:e+r/2,position:"bottom"},{x:t-i/2,y:e,position:"left"}];n.angle?s=a.map(o=>({...Dr(o.x,o.y,t,e,n.angle),position:o.position})):s=a}else if(n.type==="circle"){const a=i/2,o=r/2,l=[{x:t,y:e-o,position:"top"},{x:t+a,y:e,position:"right"},{x:t,y:e+o,position:"bottom"},{x:t-a,y:e,position:"left"}];n.angle?s=l.map(c=>({...Dr(c.x,c.y,t,e,n.angle),position:c.position})):s=l}else if(n.type==="diamond"){const a=[{x:t,y:e-r/2,position:"top"},{x:t+i/2,y:e,position:"right"},{x:t,y:e+r/2,position:"bottom"},{x:t-i/2,y:e,position:"left"}];n.angle?s=a.map(o=>({...Dr(o.x,o.y,t,e,n.angle),position:o.position})):s=a}else if(n.type==="triangle"||n.type==="hexagon"||n.type==="octagon"||n.type==="parallelogram"||n.type==="star"){const a=[{x:t,y:e-r/2,position:"top"},{x:t+i/2,y:e,position:"right"},{x:t,y:e+r/2,position:"bottom"},{x:t-i/2,y:e,position:"left"}];n.angle?s=a.map(o=>({...Dr(o.x,o.y,t,e,n.angle),position:o.position})):s=a}else if(n.type==="cloud"||n.type==="heart"||n.type==="checkmark"||n.type==="cross"||n.type==="arrowLeft"||n.type==="arrowRight"||n.type==="arrowUp"||n.type==="arrowDown"||n.type==="capsule"||n.type==="stickyNote"||n.type==="callout"||n.type==="burst"||n.type==="speechBubble"||n.type==="ribbon"||n.type==="server"||n.type==="loadBalancer"||n.type==="firewall"||n.type==="user"||n.type==="messageQueue"||n.type==="lambda"||n.type==="router"||n.type==="browser"||n.type==="trapezoid"||n.type==="rightTriangle"||n.type==="pentagon"||n.type==="septagon"||n.type==="starPerson"||n.type==="scroll"||n.type==="wavyDivider"||n.type==="doubleBanner"||n.type==="lightbulb"||n.type==="signpost"||n.type==="burstBlob"||n.type==="browserWindow"||n.type==="mobilePhone"||n.type==="ghostButton"||n.type==="inputField"||n.type==="bracketLeft"||n.type==="bracketRight"||n.type==="database"||n.type==="document"||n.type==="predefinedProcess"||n.type==="internalStorage"){const a=[{x:t,y:e-r/2,position:"top"},{x:t+i/2,y:e,position:"right"},{x:t,y:e+r/2,position:"bottom"},{x:t-i/2,y:e,position:"left"}];n.angle?s=a.map(o=>({...Dr(o.x,o.y,t,e,n.angle),position:o.position})):s=a}else{const a=[{x:t,y:e-r/2,position:"top"},{x:t+i/2,y:e,position:"right"},{x:t,y:e+r/2,position:"bottom"},{x:t-i/2,y:e,position:"left"}];n.angle?s=a.map(o=>({...Dr(o.x,o.y,t,e,n.angle),position:o.position})):s=a}return s}function Tm(n,t,e=15){const i=Fl(n);let r=null,s=e;for(const a of i){const o=a.x-t.x,l=a.y-t.y,c=Math.sqrt(o*o+l*l);c<s&&(s=c,r=a)}return r}const dh=(n,t,e,i)=>{const r=[{x:n.x,y:n.y}],s=20;if(!e&&!i){const f=(n.x+t.x)/2;return r.push({x:f,y:n.y}),r.push({x:f,y:t.y}),r.push({x:t.x,y:t.y}),Jh(r)}const a=(f,d)=>d==="top"?{x:f.x,y:f.y-s}:d==="bottom"?{x:f.x,y:f.y+s}:d==="left"?{x:f.x-s,y:f.y}:d==="right"?{x:f.x+s,y:f.y}:f;let o=n;e&&(o=a(n,e),r.push(o));let l=t;i&&(l=a(t,i));const c=f=>f==="top"||f==="bottom",h=f=>f==="left"||f==="right";return c(i)?r.push({x:l.x,y:o.y}):h(i)?r.push({x:o.x,y:l.y}):c(e)?r.push({x:t.x,y:o.y}):h(e)?r.push({x:o.x,y:t.y}):Math.abs(t.y-n.y)>Math.abs(t.x-n.x)?r.push({x:o.x,y:t.y}):r.push({x:t.x,y:o.y}),i&&r.push(l),r.push({x:t.x,y:t.y}),Jh(r)},Jh=n=>{if(n.length<2)return n;const t=[n[0]];for(let e=1;e<n.length;e++){const i=t[t.length-1],r=n[e];if(!(Math.abs(i.x-r.x)<.1&&Math.abs(i.y-r.y)<.1)){if(t.length>=2){const s=t[t.length-2];if(Math.abs(s.x-i.x)<.1&&Math.abs(i.x-r.x)<.1||Math.abs(s.y-i.y)<.1&&Math.abs(i.y-r.y)<.1){t[t.length-1]=r;continue}}t.push(r)}}return t},Bm=(n,t,e,i,r,s,a)=>{const c=e.filter(B=>{if(B.type==="line"||B.type==="arrow"||B.type==="text")return!1;const O=Math.min(n.x,t.x)-100,X=Math.max(n.x,t.x)+100,R=Math.min(n.y,t.y)-100,M=Math.max(n.y,t.y)+100;return!(B.x>X||B.x+B.width<O||B.y>M||B.y+B.height<R)});if(c.length===0)return dh(n,t,s,a);const h=new Set([n.x,t.x]),f=new Set([n.y,t.y]);c.forEach(B=>{const O=B.x-15,X=B.x+B.width+15,R=B.y-15,M=B.y+B.height+15;h.add(O),h.add(X),f.add(R),f.add(M),h.add(B.x+B.width/2),f.add(B.y+B.height/2)});const d=(B,O)=>{O&&(O==="top"&&(h.add(B.x),f.add(B.y-20)),O==="bottom"&&(h.add(B.x),f.add(B.y+20)),O==="left"&&(h.add(B.x-20),f.add(B.y)),O==="right"&&(h.add(B.x+20),f.add(B.y)))};d(n,s),d(t,a);const u=Array.from(h).sort((B,O)=>B-O),y=Array.from(f).sort((B,O)=>B-O),g=u.findIndex(B=>Math.abs(B-n.x)<.1),w=y.findIndex(B=>Math.abs(B-n.y)<.1),m=u.findIndex(B=>Math.abs(B-t.x)<.1),x=y.findIndex(B=>Math.abs(B-t.y)<.1);if(g===-1||w===-1||m===-1||x===-1)return dh(n,t,s,a);const _=[{gx:g,gy:w,g:0,h:Math.abs(n.x-t.x)+Math.abs(n.y-t.y),parent:null,dir:null}],L=new Set,T=(B,O,X)=>c.some(R=>R.id===X?!1:B>R.x+1&&B<R.x+R.width-1&&O>R.y+1&&O<R.y+R.height-1),q=(B,O,X,R)=>{const M=(B+X)/2,$=(O+R)/2;return c.some(S=>{const mt=S.id===i?.id||S.id===r?.id?3:1;return M>S.x+mt&&M<S.x+S.width-mt&&$>S.y+mt&&$<S.y+S.height-mt})};let U=0;for(;_.length>0&&U<800;){U++,_.sort((X,R)=>X.g+X.h-(R.g+R.h));const B=_.shift();if(B.gx===m&&B.gy===x){const X=[];let R=B;for(;R;)X.push({x:u[R.gx],y:y[R.gy]}),R=R.parent;return Jh(X.reverse())}L.add(`${B.gx},${B.gy}`);const O=[{dx:-1,dy:0,dir:"h",name:"left"},{dx:1,dy:0,dir:"h",name:"right"},{dx:0,dy:-1,dir:"v",name:"top"},{dx:0,dy:1,dir:"v",name:"bottom"}];for(const X of O){const R=B.gx+X.dx,M=B.gy+X.dy;if(R<0||R>=u.length||M<0||M>=y.length||L.has(`${R},${M}`))continue;const $=Y=>["top","bottom","left","right"].includes(Y||"");if(B.gx===g&&B.gy===w&&$(s)&&X.name!==s)continue;if(R===m&&M===x&&$(a)){const Y={top:"bottom",bottom:"top",left:"right",right:"left"}[a];if(X.name!==Y)continue}const S=u[B.gx],J=y[B.gy],mt=u[R],ot=y[M];if(q(S,J,mt,ot))continue;const ft=Math.abs(mt-S)+Math.abs(ot-J),ct=B.dir&&B.dir!==X.dir?100:0,Bt=T(mt,ot)?500:0,at=B.g+ft+ct+Bt,P=_.find(Y=>Y.gx===R&&Y.gy===M);P?at<P.g&&(P.g=at,P.parent=B,P.dir=X.dir):_.push({gx:R,gy:M,g:at,h:Math.abs(mt-t.x)+Math.abs(ot-t.y),parent:B,dir:X.dir})}}return dh(n,t,s,a)};var Em=Gn("<div class=context-menu>"),Dm=Gn("<span class=menu-item-icon style=font-size:20px;line-height:1>"),Fm=Gn("<span class=menu-item-shortcut>"),$m=Gn("<span class=menu-item-arrow>"),zm=Gn("<button><span class=menu-item-check>"),jm=Gn("<div class=menu-item-wrapper style=position:relative>"),Um=Gn("<div class=context-menu-separator>"),Wm=Gn("<span class=menu-item-label>");const G1=n=>{let t;const[e,i]=En({x:n.x,y:n.y}),[r,s]=En(null);No(()=>{if(!n.parent){if(t){const h=t.getBoundingClientRect(),f=window.innerWidth,d=window.innerHeight;let u=n.x,y=n.y;n.x+h.width>f&&(u=f-h.width-10),n.y+h.height>d&&(y=d-h.height-10),i({x:u,y})}const l=h=>{h.target.closest(".context-menu")||n.onClose()},c=h=>{h.key==="Escape"&&n.onClose()};document.addEventListener("mousedown",l),document.addEventListener("keydown",c),Hs(()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",c)})}});const a=(l,c)=>{l.disabled||l.separator||(l.submenu?s(r()===c?null:c):(l.onClick?.(),n.onClose()))},o=l=>{n.items[l].submenu?s(l):s(null)};return(()=>{var l=Em(),c=t;return typeof c=="function"?Lo(c,l):t=l,yn(l,Re(vu,{get each(){return n.items},children:(h,f)=>(()=>{var d=jm();return d.addEventListener("mouseenter",()=>o(f())),yn(d,Re(rr,{get when(){return!h.separator},get fallback(){return Um()},get children(){return[(()=>{var u=zm(),y=u.firstChild;return u.$$click=()=>a(h,f()),yn(y,()=>h.checked?"":""),yn(u,Re(rr,{get when(){return h.icon},get fallback(){return(()=>{var g=Wm();return yn(g,()=>h.label),g})()},get children(){var g=Dm();return yn(g,()=>h.icon),g}}),null),yn(u,Re(rr,{get when(){return h.shortcut},get children(){var g=Fm();return yn(g,()=>h.shortcut),g}}),null),yn(u,Re(rr,{get when(){return h.submenu},get children(){return $m()}}),null),Ar(g=>{var w=`context-menu-item ${h.disabled?"disabled":""} ${r()===f()?"active":""}`,m=h.disabled,x=h.tooltip||h.label;return w!==g.e&&xu(u,g.e=w),m!==g.t&&(u.disabled=g.t=m),x!==g.a&&qs(u,"title",g.a=x),g},{e:void 0,t:void 0,a:void 0}),u})(),Re(rr,{get when(){return va(()=>!!h.submenu)()&&r()===f()},get children(){return Re(G1,{get x(){const u=t?.querySelector(`.menu-item-wrapper:nth-child(${f()+1}) button`)?.getBoundingClientRect();return u?u.right:0},get y(){const u=t?.querySelector(`.menu-item-wrapper:nth-child(${f()+1}) button`)?.getBoundingClientRect();return u?u.top:0},get items(){return h.submenu},get onClose(){return n.onClose},parent:!1,get gridColumns(){return h.gridColumns}})}})]}})),d})()})),Ar(h=>{var f=n.parent?"100%":`${e().x}px`,d=n.parent?"0":`${e().y}px`,u=n.parent?"absolute":"fixed",y=n.parent?"-4px":"0",g=n.gridColumns?"grid":"block",w=n.gridColumns?`repeat(${n.gridColumns}, 1fr)`:void 0,m=n.gridColumns?"4px":void 0,x=n.gridColumns?"8px":void 0;return f!==h.e&&Ln(l,"left",h.e=f),d!==h.t&&Ln(l,"top",h.t=d),u!==h.a&&Ln(l,"position",h.a=u),y!==h.o&&Ln(l,"margin-left",h.o=y),g!==h.i&&Ln(l,"display",h.i=g),w!==h.n&&Ln(l,"grid-template-columns",h.n=w),m!==h.s&&Ln(l,"gap",h.s=m),x!==h.h&&Ln(l,"padding",h.h=x),h},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),l})()};Zs(["click"]);const Xf=(n,t)=>Math.round(n/t)*t,ph=(n,t,e)=>({x:Xf(n,e),y:Xf(t,e)}),gh=new Map,bl=new Set;let tu=null;const qm=n=>{tu=n},H1=n=>{if(gh.has(n))return gh.get(n);if(!bl.has(n)){bl.add(n);const t=new Image;t.src=n,t.onload=()=>{gh.set(n,t),bl.delete(n),tu&&tu()},t.onerror=()=>{bl.delete(n)}}return null},Xm=(n,t,e,i,r)=>{const s=t.filter(L=>n.includes(L.id));if(s.length===0)return{dx:e,dy:i,guides:[]};const a=Math.min(...s.map(L=>L.x))+e,o=Math.max(...s.map(L=>L.x+L.width))+e,l=Math.min(...s.map(L=>L.y))+i,c=Math.max(...s.map(L=>L.y+L.height))+i,h=(a+o)/2,f=(l+c)/2,d=[a,h,o],u=[l,f,c],y=[];let g=0,w=0,m=r+1,x=r+1;const _=t.filter(L=>!n.includes(L.id)&&L.layerId===s[0].layerId);for(const L of _){const T=L.x,q=L.x+L.width,U=(T+q)/2,B=[T,U,q],O=L.y,X=L.y+L.height,R=(O+X)/2,M=[O,R,X];for(const $ of d)for(const S of B){const J=Math.abs($-S);J<m&&(m=J,g=S-$)}for(const $ of u)for(const S of M){const J=Math.abs($-S);J<x&&(x=J,w=S-$)}}if(m<=r)for(const L of _){const T=L.x,q=L.x+L.width,U=(T+q)/2,B=[T,U,q];for(const O of d)for(const X of B)Math.abs(O+g-X)<.1&&y.push({type:"vertical",coordinate:X,elementIds:[L.id]})}if(x<=r)for(const L of _){const T=L.y,q=L.y+L.height,U=(T+q)/2,B=[T,U,q];for(const O of u)for(const X of B)Math.abs(O+w-X)<.1&&y.push({type:"horizontal",coordinate:X,elementIds:[L.id]})}return{dx:e+(m<=r?g:0),dy:i+(x<=r?w:0),guides:y}},Gm=(n,t,e,i,r)=>{const s=t.filter(x=>n.includes(x.id));if(s.length===0)return{dx:e,dy:i,guides:[]};let a={minX:Math.min(...s.map(x=>x.x))+e,maxX:Math.max(...s.map(x=>x.x+x.width))+e,minY:Math.min(...s.map(x=>x.y))+i,maxY:Math.max(...s.map(x=>x.y+x.height))+i,centerX:0,centerY:0};a.centerX=(a.minX+a.maxX)/2,a.centerY=(a.minY+a.maxY)/2;const o=t.filter(x=>!n.includes(x.id)&&x.layerId===s[0].layerId).map(x=>({...x,minX:x.x,maxX:x.x+x.width,minY:x.y,maxY:x.y+x.height,centerX:x.x+x.width/2,centerY:x.y+x.height/2}));if(o.length<2)return{dx:e,dy:i,guides:[]};let l=0,c=0,h=r+1,f=r+1;const d=[],u=(x,_)=>Math.max(0,Math.min(x.maxY,_.maxY)-Math.max(x.minY,_.minY))>0;for(let x=0;x<o.length;x++){const _=o[x];if(u(a,_))for(let L=x+1;L<o.length;L++){const T=o[L];if(!u(a,T)||!u(_,T))continue;const q=[{id:"active",...a},_,T];q.sort(($,S)=>$.minX-S.minX);const[U,B,O]=q,X=B.minX-U.maxX,R=O.minX-B.maxX;let M=0;U.id==="active"?M=B.minX-R-U.maxX:B.id==="active"?M=(U.maxX+O.minX)/2-B.centerX:O.id==="active"&&(M=B.maxX+X-O.minX),Math.abs(M)<h&&(h=Math.abs(M),l=M),d.push({type:"gap",orientation:"horizontal",gap:(X+R)/2,start:U.maxX,variableCoordinate:(U.centerY+B.centerY+O.centerY)/3,elements:[U.id,B.id,O.id],segments:[{from:U.maxX,to:B.minX},{from:B.maxX,to:O.minX}],_correction:M})}}const y=(x,_)=>Math.max(0,Math.min(x.maxX,_.maxX)-Math.max(x.minX,_.minX))>0;for(let x=0;x<o.length;x++){const _=o[x];if(y(a,_))for(let L=x+1;L<o.length;L++){const T=o[L];if(!y(a,T)||!y(_,T))continue;const q=[{id:"active",...a},_,T];q.sort(($,S)=>$.minY-S.minY);const[U,B,O]=q,X=B.minY-U.maxY,R=O.minY-B.maxY;let M=0;U.id==="active"?M=B.minY-R-U.maxY:B.id==="active"?M=(U.maxY+O.minY)/2-B.centerY:O.id==="active"&&(M=B.maxY+X-O.minY),Math.abs(M)<f&&(f=Math.abs(M),c=M),d.push({type:"gap",orientation:"vertical",gap:(X+R)/2,start:U.maxY,variableCoordinate:(U.centerX+B.centerX+O.centerX)/3,elements:[U.id,B.id,O.id],segments:[{from:U.maxY,to:B.minY},{from:B.maxY,to:O.minY}],_correction:M})}}const g=h<=r?l:0,w=f<=r?c:0,m=d.filter(x=>x.orientation==="horizontal"?g!==0&&Math.abs(x._correction-g)<.1:w!==0&&Math.abs(x._correction-w)<.1);return m.forEach(x=>delete x._correction),{dx:e+g,dy:i+w,guides:m}};var Hm=Gn(\'<div class=minimap-container><div class=minimap-header><span class=minimap-title>Navigator</span><button class=minimap-close title="Close minimap (Alt+M)"></button></div><canvas width=200 height=150 class=minimap-canvas>\');const Ym=n=>{let t,e,i=!1;const r=200,s=150,a=10,o=()=>{if(C.elements.length===0)return{minX:0,minY:0,maxX:1e3,maxY:800,width:1e3,height:800};let y=1/0,g=1/0,w=-1/0,m=-1/0;C.elements.forEach(_=>{y=Math.min(y,_.x),w=Math.max(w,_.x+_.width),g=Math.min(g,_.y),m=Math.max(m,_.y+_.height)});const x=50;return y-=x,g-=x,w+=x,m+=x,{minX:y,minY:g,maxX:w,maxY:m,width:w-y,height:m-g}},l=y=>{const g=(r-a*2)/y.width,w=(s-a*2)/y.height;return Math.min(g,w)},c=y=>{if(!t)return;const g=t.getContext("2d");if(!g)return;const w=o(),m=l(w);g.clearRect(0,0,r,s);const x=C.theme==="dark";let _=C.canvasBackgroundColor;_||(_=x?"#121212":"#fafafa"),g.fillStyle=_,g.fillRect(0,0,r,s),g.save(),g.translate(a,a),g.scale(m,m),g.translate(-w.minX,-w.minY),C.elements.forEach(M=>{const $=C.layers.find(S=>S.id===M.layerId);$?.visible&&ac(y,g,M,C.theme==="dark",$?.opacity??1)}),g.restore();const L=-C.viewState.panX/C.viewState.scale,T=-C.viewState.panY/C.viewState.scale,q=n.canvasWidth/C.viewState.scale,U=n.canvasHeight/C.viewState.scale,B=(L-w.minX)*m+a,O=(T-w.minY)*m+a,X=q*m,R=U*m;g.save(),g.strokeStyle=C.theme==="dark"?"#60a5fa":"#3b82f6",g.lineWidth=2,g.fillStyle=C.theme==="dark"?"rgba(96, 165, 250, 0.1)":"rgba(59, 130, 246, 0.1)",g.fillRect(B,O,X,R),g.strokeRect(B,O,X,R),g.restore()},h=y=>{if(i)return;const g=t?.getBoundingClientRect();if(!g)return;const w=y.clientX-g.left,m=y.clientY-g.top,x=o(),_=l(x),L=(w-a)/_+x.minX,T=(m-a)/_+x.minY;Or({panX:-L*C.viewState.scale+n.canvasWidth/2,panY:-T*C.viewState.scale+n.canvasHeight/2})},f=y=>{if(!t)return;const g=t.getBoundingClientRect(),w=y.clientX-g.left,m=y.clientY-g.top,x=o(),_=l(x),L=-C.viewState.panX/C.viewState.scale,T=-C.viewState.panY/C.viewState.scale,q=n.canvasWidth/C.viewState.scale,U=n.canvasHeight/C.viewState.scale,B=(L-x.minX)*_+a,O=(T-x.minY)*_+a,X=q*_,R=U*_;w>=B&&w<=B+X&&m>=O&&m<=O+R&&(i=!0,t.setPointerCapture(y.pointerId))},d=y=>{if(!i||!t)return;const g=t.getBoundingClientRect(),w=y.clientX-g.left,m=y.clientY-g.top,x=o(),_=l(x),L=(w-a)/_+x.minX,T=(m-a)/_+x.minY;Or({panX:-L*C.viewState.scale+n.canvasWidth/2,panY:-T*C.viewState.scale+n.canvasHeight/2})},u=y=>{i&&t&&(t.releasePointerCapture(y.pointerId),i=!1)};return mi(()=>{if(!t)return;const y=oc.canvas(t);C.elements.forEach(m=>{if(m.points?.length,m.x,m.y,m.width,m.height,m.opacity,m.layerId,m.strokeColor,m.backgroundColor,m.renderStyle,m.points){const x=Tn(m.points);if(x.length>0){const _=x[x.length-1];_.x,_.y}}}),C.viewState.panX,C.viewState.panY,C.viewState.scale,C.theme,C.layers.forEach(m=>{m.visible,m.opacity});const w=requestAnimationFrame(()=>c(y));Hs(()=>cancelAnimationFrame(w))}),No(()=>{if(t&&(t.addEventListener("click",h),t.addEventListener("pointerdown",f),t.addEventListener("pointermove",d),t.addEventListener("pointerup",u),t.addEventListener("pointercancel",u)),Hs(()=>{t&&(t.removeEventListener("click",h),t.removeEventListener("pointerdown",f),t.removeEventListener("pointermove",d),t.removeEventListener("pointerup",u),t.removeEventListener("pointercancel",u))}),t){const y=oc.canvas(t);c(y)}}),(()=>{var y=Hm(),g=y.firstChild,w=g.firstChild,m=w.nextSibling,x=g.nextSibling,_=e;typeof _=="function"?Lo(_,y):e=y,m.$$click=()=>em(!1),yn(m,Re(ku,{size:14}));var L=t;return typeof L=="function"?Lo(L,x):t=x,y})()};Zs(["click"]);const Y1=async()=>{if(C.selection.length===0)return;const t={type:"yappy-elements",elements:C.elements.filter(e=>C.selection.includes(e.id))};try{await navigator.clipboard.writeText(JSON.stringify(t))}catch(e){console.error("Failed to copy: ",e)}},Vm=async()=>{await Y1(),pa(C.selection)},Gf=async()=>{try{const n=await navigator.clipboard.readText();if(!n)return;const t=JSON.parse(n);if(t.type==="yappy-elements"&&Array.isArray(t.elements)){Sn();const e=[],i=-C.viewState.panX/C.viewState.scale+window.innerWidth/2/C.viewState.scale,r=-C.viewState.panY/C.viewState.scale+window.innerHeight/2/C.viewState.scale;let s=1/0,a=1/0,o=-1/0,l=-1/0;t.elements.forEach(u=>{s=Math.min(s,u.x),a=Math.min(a,u.y),o=Math.max(o,u.x+u.width),l=Math.max(l,u.y+u.height)});const c=s+(o-s)/2,h=a+(l-a)/2,f=i-c,d=r-h;t.elements.forEach(u=>{const y=bi(u.type),g={...u,id:y,x:u.x+f,y:u.y+d,layerId:C.activeLayerId,groupIds:[]};Kt("elements",w=>[...w,g]),e.push(y)}),Kt("selection",e)}}catch(n){console.error("Failed to paste: ",n)}},Hf=n=>{if(C.selection.length===0)return;Sn();let t=1/0,e=-1/0;C.elements.forEach(r=>{C.selection.includes(r.id)&&(n==="horizontal"?(t=Math.min(t,r.x),e=Math.max(e,r.x+r.width)):(t=Math.min(t,r.y),e=Math.max(e,r.y+r.height)))});const i=t+(e-t)/2;C.selection.forEach(r=>{const s=C.elements.find(a=>a.id===r);if(s)if(n==="horizontal"){const o=s.x+s.width/2-i,l=i-o-s.width/2;if(s.points){const c=Tn(s.points);if(c.length>0){const h=c.map(f=>({x:s.width-f.x,y:f.y}));de(r,{x:l,points:h,pointsEncoding:void 0,seed:s.seed+1},!1)}else(!s.points||s.points.length===0)&&de(r,{x:l,seed:s.seed+1},!1)}else de(r,{x:l,seed:s.seed+1},!1)}else{const o=s.y+s.height/2-i,l=i-o-s.height/2;if(s.points){const c=Tn(s.points);if(c.length>0){const h=c.map(f=>({x:f.x,y:s.height-f.y}));de(r,{y:l,points:h,pointsEncoding:void 0,seed:s.seed+1},!1)}else de(r,{y:l,seed:s.seed+1},!1)}else de(r,{y:l,seed:s.seed+1},!1)}})},Zm=n=>{C.selection.forEach(t=>{de(t,{locked:n})})};let eu=null;const Km=()=>{if(C.selection.length!==1)return;const n=C.elements.find(t=>t.id===C.selection[0]);n&&(eu={strokeColor:n.strokeColor,backgroundColor:n.backgroundColor,fillStyle:n.fillStyle,strokeWidth:n.strokeWidth,strokeStyle:n.strokeStyle,roughness:n.roughness,opacity:n.opacity,fontFamily:n.fontFamily,fontSize:n.fontSize,textAlign:n.textAlign,roundness:n.roundness,gradientStart:n.gradientStart,gradientEnd:n.gradientEnd,gradientDirection:n.gradientDirection,gradientStops:n.gradientStops?JSON.parse(JSON.stringify(n.gradientStops)):void 0,gradientType:n.gradientType,gradientHandlePositions:n.gradientHandlePositions?JSON.parse(JSON.stringify(n.gradientHandlePositions)):void 0,shadowEnabled:n.shadowEnabled,shadowColor:n.shadowColor,shadowBlur:n.shadowBlur,shadowOffsetX:n.shadowOffsetX,shadowOffsetY:n.shadowOffsetY,drawInnerBorder:n.drawInnerBorder,innerBorderColor:n.innerBorderColor,innerBorderDistance:n.innerBorderDistance,strokeLineJoin:n.strokeLineJoin,fillDensity:n.fillDensity,renderStyle:n.renderStyle,flowAnimation:n.flowAnimation,flowSpeed:n.flowSpeed,flowStyle:n.flowStyle})},Qm=()=>{!eu||C.selection.length===0||(Sn(),C.selection.forEach(n=>{de(n,eu)}))};class Jm{frameCount=0;lastReportTime=0;slowFrames=0;totalDrawTime=0;enabled;constructor(t=!0){this.enabled=t,this.lastReportTime=performance.now()}measureFrame(t,e,i){if(!this.enabled)return;this.frameCount++,this.totalDrawTime+=t,t>16.67&&this.slowFrames++;const r=performance.now();if(r-this.lastReportTime>=1e3){const s=r-this.lastReportTime,a=this.frameCount/s*1e3,o=this.totalDrawTime/this.frameCount,l=i!==void 0?` | ${i} visible`:"";console.log(`[Perf] ${a.toFixed(1)} FPS | ${o.toFixed(2)}ms avg | ${e} elements${l} | ${this.slowFrames} slow frames`),this.frameCount=0,this.slowFrames=0,this.totalDrawTime=0,this.lastReportTime=r}}setEnabled(t){this.enabled=t}}const tb=new Jm(!1),xc=n=>{const t=n.fontSize||20,e=n.fontFamily==="sans-serif"?"Inter, sans-serif":n.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",i=n.fontWeight?typeof n.fontWeight=="string"?n.fontWeight+" ":"bold ":"";return`${n.fontStyle?typeof n.fontStyle=="string"?n.fontStyle+" ":"italic ":""}${i}${t}px ${e}`};let yh=null;const eb=()=>(yh||(yh=document.createElement("canvas").getContext("2d")),yh),nb=(n,t,e)=>{const i=t.split(/\\s+/),r=[];let s="";for(const a of i){if(!a)continue;const o=s?`${s} ${a}`:a;n.measureText(o).width>e&&s?(r.push(s),s=a):s=o}return s&&r.push(s),r},Jr=(n,t,e,i)=>{const r=t.fontSize||20;n.save(),n.font=xc(t);let s=i;t.type==="circle"||t.type==="diamond"?s=i*.707:t.type==="doubleBanner"?s=i*.65:t.type==="lightbulb"?s=i*.7:t.type==="signpost"?s=i*.8:t.type==="burstBlob"&&(s=i*.6);const a=e.split(`\n`),o=[];a.forEach(h=>{if(h==="")o.push("");else{const f=nb(n,h,s);o.push(...f)}});const l=r*1.2;let c=0;return o.forEach(h=>{c=Math.max(c,n.measureText(h).width)}),n.restore(),{textWidth:c,textHeight:o.length*l,lines:o,lineHeight:l}},Yf=(n,t,e)=>{if(!e||e.trim()==="")return{width:t.width||100,height:t.height||60};const i=32,r=t.fontSize||20,s=e.length,a=Math.sqrt(s*r*r*1.5);let o=Math.max(60,Math.min(500,a)),l=Jr(n,t,e,o);const c=t.type==="circle"||t.type==="diamond"?.707:t.type==="doubleBanner"?.65:t.type==="lightbulb"?.7:t.type==="signpost"?.8:t.type==="burstBlob"?.6:1;let h=l.textWidth/c+i,f=l.textHeight/c+i;if(t.type==="circle"||t.type==="diamond"){const d=Math.max(h,f);return{width:d,height:d}}return(t.type==="parallelogram"||t.type==="trapezoid")&&(h+=40),{width:h,height:f}},Vf=(n,t,e=!0)=>{const i=C.elements.find(l=>l.id===n);if(!i||i.type===t)return;const r=l=>["line","arrow","bezier","organicBranch"].includes(l),s=r(i.type),a=r(t);if(s!==a){console.warn(`Cannot transform ${i.type} to ${t}: Incompatible families.`);return}const o={type:t};if(a)if(t==="bezier"||t==="organicBranch"){if(o.curveType="bezier",!i.controlPoints||i.controlPoints.length!==2){const l=i.x,c=i.y,h=i.x+i.width,f=i.y+i.height,d=h-l,u=f-c,y={x:l+d*.25,y:c+u*.1},g={x:h-d*.25,y:f-u*.1};o.controlPoints=[y,g]}}else(i.type==="bezier"||i.type==="organicBranch")&&(o.curveType="straight",o.controlPoints=void 0);de(n,o,e)},Zf=n=>{const t=["line","arrow","bezier","organicBranch"],e=["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","cross","checkmark","capsule","stickyNote","callout","speechBubble","burst","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","mobilePhone","browserWindow"];return t.includes(n)?t.filter(i=>i!==n):e.includes(n)?e.filter(i=>i!==n):[]},Kf=n=>({line:"",arrow:"",bezier:"",organicBranch:"",straight:"",elbow:"",rectangle:"",circle:"",diamond:"",triangle:"",hexagon:"",octagon:"",parallelogram:"",star:"",cloud:"",heart:"",cross:"",checkmark:"",database:"",document:"",predefinedProcess:"",internalStorage:"",server:"",loadBalancer:"",firewall:"",user:"",messageQueue:"",lambda:"",router:"",browser:"",capsule:"",stickyNote:"",callout:"",speechBubble:"",burst:"",trapezoid:"",rightTriangle:"",pentagon:"",septagon:"",browserWindow:"",mobilePhone:""})[n]||"",Qf=n=>n.charAt(0).toUpperCase()+n.slice(1).replace(/([A-Z])/g," $1"),rb=n=>["straight","bezier","elbow"].filter(t=>t!==n),ib=n=>({straight:"",bezier:"",elbow:""})[n]||"",sb=n=>n.charAt(0).toUpperCase()+n.slice(1);function ob(n,t){const e=t.filter(o=>o.groupIds&&o.groupIds.includes(n));if(e.length===0)return null;let i=1/0,r=1/0,s=-1/0,a=-1/0;return e.forEach(o=>{const l=o.x,c=o.y,h=o.x+o.width,f=o.y+o.height;i=Math.min(i,l),r=Math.min(r,c),s=Math.max(s,h),a=Math.max(a,f)}),{x:i,y:r,width:s-i,height:a-r}}function ab(n,t,e,i){const r=ob(e,i);return r?n>=r.x&&n<=r.x+r.width&&t>=r.y&&t<=r.y+r.height:!1}function lb(n,t){const e=new Map;return n.forEach((i,r)=>{if(i.groupIds&&i.groupIds.length>0){const s=i.groupIds[i.groupIds.length-1];if(!e.has(s)){const a=t.find(o=>o.id===i.layerId);e.set(s,{layerOrder:a?.order??999,elementIndex:r})}}}),Array.from(e.entries()).map(([i,{layerOrder:r,elementIndex:s}])=>({groupId:i,layerOrder:r,elementIndex:s})).sort((i,r)=>i.layerOrder!==r.layerOrder?r.layerOrder-i.layerOrder:r.elementIndex-i.elementIndex)}function nu(n,t,e){if(n&&n.length){const[i,r]=t,s=Math.PI/180*e,a=Math.cos(s),o=Math.sin(s);for(const l of n){const[c,h]=l;l[0]=(c-i)*a-(h-r)*o+i,l[1]=(c-i)*o+(h-r)*a+r}}}function cb(n,t,e){const i=[];n.forEach(r=>i.push(...r)),nu(i,t,e)}function hb(n,t){return n[0]===t[0]&&n[1]===t[1]}function ub(n,t,e,i=1){const r=e,s=Math.max(t,.1),a=n[0]&&n[0][0]&&typeof n[0][0]=="number"?[n]:n,o=[0,0];if(r)for(const c of a)nu(c,o,r);const l=fb(a,s,i);if(r){for(const c of a)nu(c,o,-r);cb(l,o,-r)}return l}function fb(n,t,e){const i=[];for(const c of n){const h=[...c];hb(h[0],h[h.length-1])||h.push([h[0][0],h[0][1]]),h.length>2&&i.push(h)}const r=[];t=Math.max(t,.1);const s=[];for(const c of i)for(let h=0;h<c.length-1;h++){const f=c[h],d=c[h+1];if(f[1]!==d[1]){const u=Math.min(f[1],d[1]);s.push({ymin:u,ymax:Math.max(f[1],d[1]),x:u===f[1]?f[0]:d[0],islope:(d[0]-f[0])/(d[1]-f[1])})}}if(s.sort((c,h)=>c.ymin<h.ymin?-1:c.ymin>h.ymin?1:c.x<h.x?-1:c.x>h.x?1:c.ymax===h.ymax?0:(c.ymax-h.ymax)/Math.abs(c.ymax-h.ymax)),!s.length)return r;let a=[],o=s[0].ymin,l=0;for(;a.length||s.length;){if(s.length){let c=-1;for(let f=0;f<s.length&&!(s[f].ymin>o);f++)c=f;s.splice(0,c+1).forEach(f=>{a.push({s:o,edge:f})})}if(a=a.filter(c=>!(c.edge.ymax<=o)),a.sort((c,h)=>c.edge.x===h.edge.x?0:(c.edge.x-h.edge.x)/Math.abs(c.edge.x-h.edge.x)),(e!==1||l%t===0)&&a.length>1)for(let c=0;c<a.length;c=c+2){const h=c+1;if(h>=a.length)break;const f=a[c].edge,d=a[h].edge;r.push([[Math.round(f.x),o],[Math.round(d.x),o]])}o+=e,a.forEach(c=>{c.edge.x=c.edge.x+e*c.edge.islope}),l++}return r}function Ea(n,t){var e;const i=t.hachureAngle+90;let r=t.hachureGap;r<0&&(r=t.strokeWidth*4),r=Math.round(Math.max(r,.1));let s=1;return t.roughness>=1&&(((e=t.randomizer)===null||e===void 0?void 0:e.next())||Math.random())>.7&&(s=r),ub(n,r,i,s||1)}class Iu{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const i=Ea(t,e);return{type:"fillSketch",ops:this.renderLines(i,e)}}renderLines(t,e){const i=[];for(const r of t)i.push(...this.helper.doubleLineOps(r[0][0],r[0][1],r[1][0],r[1][1],e));return i}}function kc(n){const t=n[0],e=n[1];return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}class db extends Iu{fillPolygons(t,e){let i=e.hachureGap;i<0&&(i=e.strokeWidth*4),i=Math.max(i,.1);const r=Object.assign({},e,{hachureGap:i}),s=Ea(t,r),a=Math.PI/180*e.hachureAngle,o=[],l=i*.5*Math.cos(a),c=i*.5*Math.sin(a);for(const[f,d]of s)kc([f,d])&&o.push([[f[0]-l,f[1]+c],[...d]],[[f[0]+l,f[1]-c],[...d]]);return{type:"fillSketch",ops:this.renderLines(o,e)}}}class pb extends Iu{fillPolygons(t,e){const i=this._fillPolygons(t,e),r=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),s=this._fillPolygons(t,r);return i.ops=i.ops.concat(s.ops),i}}class gb{constructor(t){this.helper=t}fillPolygons(t,e){e=Object.assign({},e,{hachureAngle:0});const i=Ea(t,e);return this.dotsOnLines(i,e)}dotsOnLines(t,e){const i=[];let r=e.hachureGap;r<0&&(r=e.strokeWidth*4),r=Math.max(r,.1);let s=e.fillWeight;s<0&&(s=e.strokeWidth/2);const a=r/4;for(const o of t){const l=kc(o),c=l/r,h=Math.ceil(c)-1,f=l-h*r,d=(o[0][0]+o[1][0])/2-r/4,u=Math.min(o[0][1],o[1][1]);for(let y=0;y<h;y++){const g=u+f+y*r,w=d-a+Math.random()*2*a,m=g-a+Math.random()*2*a,x=this.helper.ellipse(w,m,s,s,e);i.push(...x.ops)}}return{type:"fillSketch",ops:i}}}class yb{constructor(t){this.helper=t}fillPolygons(t,e){const i=Ea(t,e);return{type:"fillSketch",ops:this.dashedLine(i,e)}}dashedLine(t,e){const i=e.dashOffset<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashOffset,r=e.dashGap<0?e.hachureGap<0?e.strokeWidth*4:e.hachureGap:e.dashGap,s=[];return t.forEach(a=>{const o=kc(a),l=Math.floor(o/(i+r)),c=(o+r-l*(i+r))/2;let h=a[0],f=a[1];h[0]>f[0]&&(h=a[1],f=a[0]);const d=Math.atan((f[1]-h[1])/(f[0]-h[0]));for(let u=0;u<l;u++){const y=u*(i+r),g=y+i,w=[h[0]+y*Math.cos(d)+c*Math.cos(d),h[1]+y*Math.sin(d)+c*Math.sin(d)],m=[h[0]+g*Math.cos(d)+c*Math.cos(d),h[1]+g*Math.sin(d)+c*Math.sin(d)];s.push(...this.helper.doubleLineOps(w[0],w[1],m[0],m[1],e))}}),s}}class mb{constructor(t){this.helper=t}fillPolygons(t,e){const i=e.hachureGap<0?e.strokeWidth*4:e.hachureGap,r=e.zigzagOffset<0?i:e.zigzagOffset;e=Object.assign({},e,{hachureGap:i+r});const s=Ea(t,e);return{type:"fillSketch",ops:this.zigzagLines(s,r,e)}}zigzagLines(t,e,i){const r=[];return t.forEach(s=>{const a=kc(s),o=Math.round(a/(2*e));let l=s[0],c=s[1];l[0]>c[0]&&(l=s[1],c=s[0]);const h=Math.atan((c[1]-l[1])/(c[0]-l[0]));for(let f=0;f<o;f++){const d=f*2*e,u=(f+1)*2*e,y=Math.sqrt(2*Math.pow(e,2)),g=[l[0]+d*Math.cos(h),l[1]+d*Math.sin(h)],w=[l[0]+u*Math.cos(h),l[1]+u*Math.sin(h)],m=[g[0]+y*Math.cos(h+Math.PI/4),g[1]+y*Math.sin(h+Math.PI/4)];r.push(...this.helper.doubleLineOps(g[0],g[1],m[0],m[1],i),...this.helper.doubleLineOps(m[0],m[1],w[0],w[1],i))}}),r}}const Er={};function bb(n,t){let e=n.fillStyle||"hachure";if(!Er[e])switch(e){case"zigzag":Er[e]||(Er[e]=new db(t));break;case"cross-hatch":Er[e]||(Er[e]=new pb(t));break;case"dots":Er[e]||(Er[e]=new gb(t));break;case"dashed":Er[e]||(Er[e]=new yb(t));break;case"zigzag-line":Er[e]||(Er[e]=new mb(t));break;default:e="hachure",Er[e]||(Er[e]=new Iu(t));break}return Er[e]}function wb(){return Math.floor(Math.random()*2**31)}class vb{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const xb=0,ru=1,V1=2,wl={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function kb(n){const t=new Array;for(;n!=="";)if(n.match(/^([ \\t\\r\\n,]+)/))n=n.substr(RegExp.$1.length);else if(n.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:xb,text:RegExp.$1},n=n.substr(RegExp.$1.length);else if(n.match(/^(([-+]?[0-9]+(\\.[0-9]*)?|[-+]?\\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:ru,text:`${parseFloat(RegExp.$1)}`},n=n.substr(RegExp.$1.length);else return[];return t[t.length]={type:V1,text:""},t}function mh(n,t){return n.type===t}function Ou(n){const t=[],e=kb(n);let i="BOD",r=0,s=e[r];for(;!mh(s,V1);){let a=0;const o=[];if(i==="BOD")if(s.text==="M"||s.text==="m")r++,a=wl[s.text],i=s.text;else return Ou("M0,0"+n);else mh(s,ru)?a=wl[i]:(r++,a=wl[s.text],i=s.text);if(r+a<e.length){for(let l=r;l<r+a;l++){const c=e[l];if(mh(c,ru))o[o.length]=+c.text;else throw new Error("Param not a number: "+i+","+c.text)}if(typeof wl[i]=="number"){const l={key:i,data:o};t.push(l),r+=a,s=e[r],i==="M"&&(i="L"),i==="m"&&(i="l")}else throw new Error("Bad segment: "+i)}else throw new Error("Path data ended short")}return t}function Z1(n){let t=0,e=0,i=0,r=0;const s=[];for(const{key:a,data:o}of n)switch(a){case"M":s.push({key:"M",data:[...o]}),[t,e]=o,[i,r]=o;break;case"m":t+=o[0],e+=o[1],s.push({key:"M",data:[t,e]}),i=t,r=e;break;case"L":s.push({key:"L",data:[...o]}),[t,e]=o;break;case"l":t+=o[0],e+=o[1],s.push({key:"L",data:[t,e]});break;case"C":s.push({key:"C",data:[...o]}),t=o[4],e=o[5];break;case"c":{const l=o.map((c,h)=>h%2?c+e:c+t);s.push({key:"C",data:l}),t=l[4],e=l[5];break}case"Q":s.push({key:"Q",data:[...o]}),t=o[2],e=o[3];break;case"q":{const l=o.map((c,h)=>h%2?c+e:c+t);s.push({key:"Q",data:l}),t=l[2],e=l[3];break}case"A":s.push({key:"A",data:[...o]}),t=o[5],e=o[6];break;case"a":t+=o[5],e+=o[6],s.push({key:"A",data:[o[0],o[1],o[2],o[3],o[4],t,e]});break;case"H":s.push({key:"H",data:[...o]}),t=o[0];break;case"h":t+=o[0],s.push({key:"H",data:[t]});break;case"V":s.push({key:"V",data:[...o]}),e=o[0];break;case"v":e+=o[0],s.push({key:"V",data:[e]});break;case"S":s.push({key:"S",data:[...o]}),t=o[2],e=o[3];break;case"s":{const l=o.map((c,h)=>h%2?c+e:c+t);s.push({key:"S",data:l}),t=l[2],e=l[3];break}case"T":s.push({key:"T",data:[...o]}),t=o[0],e=o[1];break;case"t":t+=o[0],e+=o[1],s.push({key:"T",data:[t,e]});break;case"Z":case"z":s.push({key:"Z",data:[]}),t=i,e=r;break}return s}function K1(n){const t=[];let e="",i=0,r=0,s=0,a=0,o=0,l=0;for(const{key:c,data:h}of n){switch(c){case"M":t.push({key:"M",data:[...h]}),[i,r]=h,[s,a]=h;break;case"C":t.push({key:"C",data:[...h]}),i=h[4],r=h[5],o=h[2],l=h[3];break;case"L":t.push({key:"L",data:[...h]}),[i,r]=h;break;case"H":i=h[0],t.push({key:"L",data:[i,r]});break;case"V":r=h[0],t.push({key:"L",data:[i,r]});break;case"S":{let f=0,d=0;e==="C"||e==="S"?(f=i+(i-o),d=r+(r-l)):(f=i,d=r),t.push({key:"C",data:[f,d,...h]}),o=h[0],l=h[1],i=h[2],r=h[3];break}case"T":{const[f,d]=h;let u=0,y=0;e==="Q"||e==="T"?(u=i+(i-o),y=r+(r-l)):(u=i,y=r);const g=i+2*(u-i)/3,w=r+2*(y-r)/3,m=f+2*(u-f)/3,x=d+2*(y-d)/3;t.push({key:"C",data:[g,w,m,x,f,d]}),o=u,l=y,i=f,r=d;break}case"Q":{const[f,d,u,y]=h,g=i+2*(f-i)/3,w=r+2*(d-r)/3,m=u+2*(f-u)/3,x=y+2*(d-y)/3;t.push({key:"C",data:[g,w,m,x,u,y]}),o=f,l=d,i=u,r=y;break}case"A":{const f=Math.abs(h[0]),d=Math.abs(h[1]),u=h[2],y=h[3],g=h[4],w=h[5],m=h[6];f===0||d===0?(t.push({key:"C",data:[i,r,w,m,w,m]}),i=w,r=m):(i!==w||r!==m)&&(Q1(i,r,w,m,f,d,u,y,g).forEach(function(_){t.push({key:"C",data:_})}),i=w,r=m);break}case"Z":t.push({key:"Z",data:[]}),i=s,r=a;break}e=c}return t}function _b(n){return Math.PI*n/180}function la(n,t,e){const i=n*Math.cos(e)-t*Math.sin(e),r=n*Math.sin(e)+t*Math.cos(e);return[i,r]}function Q1(n,t,e,i,r,s,a,o,l,c){const h=_b(a);let f=[],d=0,u=0,y=0,g=0;if(c)[d,u,y,g]=c;else{[n,t]=la(n,t,-h),[e,i]=la(e,i,-h);const M=(n-e)/2,$=(t-i)/2;let S=M*M/(r*r)+$*$/(s*s);S>1&&(S=Math.sqrt(S),r=S*r,s=S*s);const J=o===l?-1:1,mt=r*r,ot=s*s,ft=mt*ot-mt*$*$-ot*M*M,ct=mt*$*$+ot*M*M,Bt=J*Math.sqrt(Math.abs(ft/ct));y=Bt*r*$/s+(n+e)/2,g=Bt*-s*M/r+(t+i)/2,d=Math.asin(parseFloat(((t-g)/s).toFixed(9))),u=Math.asin(parseFloat(((i-g)/s).toFixed(9))),n<y&&(d=Math.PI-d),e<y&&(u=Math.PI-u),d<0&&(d=Math.PI*2+d),u<0&&(u=Math.PI*2+u),l&&d>u&&(d=d-Math.PI*2),!l&&u>d&&(u=u-Math.PI*2)}let w=u-d;if(Math.abs(w)>Math.PI*120/180){const M=u,$=e,S=i;l&&u>d?u=d+Math.PI*120/180*1:u=d+Math.PI*120/180*-1,e=y+r*Math.cos(u),i=g+s*Math.sin(u),f=Q1(e,i,$,S,r,s,a,0,l,[u,M,y,g])}w=u-d;const m=Math.cos(d),x=Math.sin(d),_=Math.cos(u),L=Math.sin(u),T=Math.tan(w/4),q=4/3*r*T,U=4/3*s*T,B=[n,t],O=[n+q*x,t-U*m],X=[e+q*L,i-U*_],R=[e,i];if(O[0]=2*B[0]-O[0],O[1]=2*B[1]-O[1],c)return[O,X,R].concat(f);{f=[O,X,R].concat(f);const M=[];for(let $=0;$<f.length;$+=3){const S=la(f[$][0],f[$][1],h),J=la(f[$+1][0],f[$+1][1],h),mt=la(f[$+2][0],f[$+2][1],h);M.push([S[0],S[1],J[0],J[1],mt[0],mt[1]])}return M}}const Sb={randOffset:Nb,randOffsetWithRange:Pb,ellipse:Lb,doubleLineOps:Ib};function J1(n,t,e,i,r){return{type:"path",ops:_s(n,t,e,i,r)}}function $l(n,t,e){const i=(n||[]).length;if(i>2){const r=[];for(let s=0;s<i-1;s++)r.push(..._s(n[s][0],n[s][1],n[s+1][0],n[s+1][1],e));return t&&r.push(..._s(n[i-1][0],n[i-1][1],n[0][0],n[0][1],e)),{type:"path",ops:r}}else if(i===2)return J1(n[0][0],n[0][1],n[1][0],n[1][1],e);return{type:"path",ops:[]}}function Ab(n,t){return $l(n,!0,t)}function Cb(n,t,e,i,r){const s=[[n,t],[n+e,t],[n+e,t+i],[n,t+i]];return Ab(s,r)}function Jf(n,t){if(n.length){const i=typeof n[0][0]=="number"?[n]:n,r=vl(i[0],1*(1+t.roughness*.2),t),s=t.disableMultiStroke?[]:vl(i[0],1.5*(1+t.roughness*.22),nd(t));for(let a=1;a<i.length;a++){const o=i[a];if(o.length){const l=vl(o,1*(1+t.roughness*.2),t),c=t.disableMultiStroke?[]:vl(o,1.5*(1+t.roughness*.22),nd(t));for(const h of l)h.op!=="move"&&r.push(h);for(const h of c)h.op!=="move"&&s.push(h)}}return{type:"path",ops:r.concat(s)}}return{type:"path",ops:[]}}function Lb(n,t,e,i,r){const s=t2(e,i,r);return iu(n,t,r,s).opset}function t2(n,t,e){const i=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(n/2,2)+Math.pow(t/2,2))/2)),r=Math.ceil(Math.max(e.curveStepCount,e.curveStepCount/Math.sqrt(200)*i)),s=Math.PI*2/r;let a=Math.abs(n/2),o=Math.abs(t/2);const l=1-e.curveFitting;return a+=We(a*l,e),o+=We(o*l,e),{increment:s,rx:a,ry:o}}function iu(n,t,e,i){const[r,s]=rd(i.increment,n,t,i.rx,i.ry,1,i.increment*cc(.1,cc(.4,1,e),e),e);let a=hc(r,null,e);if(!e.disableMultiStroke&&e.roughness!==0){const[o]=rd(i.increment,n,t,i.rx,i.ry,1.5,0,e),l=hc(o,null,e);a=a.concat(l)}return{estimatedPoints:s,opset:{type:"path",ops:a}}}function td(n,t,e,i,r,s,a,o,l){const c=n,h=t;let f=Math.abs(e/2),d=Math.abs(i/2);f+=We(f*.01,l),d+=We(d*.01,l);let u=r,y=s;for(;u<0;)u+=Math.PI*2,y+=Math.PI*2;y-u>Math.PI*2&&(u=0,y=Math.PI*2);const g=Math.PI*2/l.curveStepCount,w=Math.min(g/2,(y-u)/2),m=id(w,c,h,f,d,u,y,1,l);if(!l.disableMultiStroke){const x=id(w,c,h,f,d,u,y,1.5,l);m.push(...x)}return a&&(o?m.push(..._s(c,h,c+f*Math.cos(u),h+d*Math.sin(u),l),..._s(c,h,c+f*Math.cos(y),h+d*Math.sin(y),l)):m.push({op:"lineTo",data:[c,h]},{op:"lineTo",data:[c+f*Math.cos(u),h+d*Math.sin(u)]})),{type:"path",ops:m}}function ed(n,t){const e=K1(Z1(Ou(n))),i=[];let r=[0,0],s=[0,0];for(const{key:a,data:o}of e)switch(a){case"M":{s=[o[0],o[1]],r=[o[0],o[1]];break}case"L":i.push(..._s(s[0],s[1],o[0],o[1],t)),s=[o[0],o[1]];break;case"C":{const[l,c,h,f,d,u]=o;i.push(...Ob(l,c,h,f,d,u,s,t)),s=[d,u];break}case"Z":i.push(..._s(s[0],s[1],r[0],r[1],t)),s=[r[0],r[1]];break}return{type:"path",ops:i}}function bh(n,t){const e=[];for(const i of n)if(i.length){const r=t.maxRandomnessOffset||0,s=i.length;if(s>2){e.push({op:"move",data:[i[0][0]+We(r,t),i[0][1]+We(r,t)]});for(let a=1;a<s;a++)e.push({op:"lineTo",data:[i[a][0]+We(r,t),i[a][1]+We(r,t)]})}}return{type:"fillPath",ops:e}}function go(n,t){return bb(t,Sb).fillPolygons(n,t)}function Mb(n,t,e,i,r,s,a){const o=n,l=t;let c=Math.abs(e/2),h=Math.abs(i/2);c+=We(c*.01,a),h+=We(h*.01,a);let f=r,d=s;for(;f<0;)f+=Math.PI*2,d+=Math.PI*2;d-f>Math.PI*2&&(f=0,d=Math.PI*2);const u=(d-f)/a.curveStepCount,y=[];for(let g=f;g<=d;g=g+u)y.push([o+c*Math.cos(g),l+h*Math.sin(g)]);return y.push([o+c*Math.cos(d),l+h*Math.sin(d)]),y.push([o,l]),go([y],a)}function Nb(n,t){return We(n,t)}function Pb(n,t,e){return cc(n,t,e)}function Ib(n,t,e,i,r){return _s(n,t,e,i,r,!0)}function nd(n){const t=Object.assign({},n);return t.randomizer=void 0,n.seed&&(t.seed=n.seed+1),t}function e2(n){return n.randomizer||(n.randomizer=new vb(n.seed||0)),n.randomizer.next()}function cc(n,t,e,i=1){return e.roughness*i*(e2(e)*(t-n)+n)}function We(n,t,e=1){return cc(-n,n,t,e)}function _s(n,t,e,i,r,s=!1){const a=s?r.disableMultiStrokeFill:r.disableMultiStroke,o=su(n,t,e,i,r,!0,!1);if(a)return o;const l=su(n,t,e,i,r,!0,!0);return o.concat(l)}function su(n,t,e,i,r,s,a){const o=Math.pow(n-e,2)+Math.pow(t-i,2),l=Math.sqrt(o);let c=1;l<200?c=1:l>500?c=.4:c=-.0016668*l+1.233334;let h=r.maxRandomnessOffset||0;h*h*100>o&&(h=l/10);const f=h/2,d=.2+e2(r)*.2;let u=r.bowing*r.maxRandomnessOffset*(i-t)/200,y=r.bowing*r.maxRandomnessOffset*(n-e)/200;u=We(u,r,c),y=We(y,r,c);const g=[],w=()=>We(f,r,c),m=()=>We(h,r,c),x=r.preserveVertices;return a?g.push({op:"move",data:[n+(x?0:w()),t+(x?0:w())]}):g.push({op:"move",data:[n+(x?0:We(h,r,c)),t+(x?0:We(h,r,c))]}),a?g.push({op:"bcurveTo",data:[u+n+(e-n)*d+w(),y+t+(i-t)*d+w(),u+n+2*(e-n)*d+w(),y+t+2*(i-t)*d+w(),e+(x?0:w()),i+(x?0:w())]}):g.push({op:"bcurveTo",data:[u+n+(e-n)*d+m(),y+t+(i-t)*d+m(),u+n+2*(e-n)*d+m(),y+t+2*(i-t)*d+m(),e+(x?0:m()),i+(x?0:m())]}),g}function vl(n,t,e){if(!n.length)return[];const i=[];i.push([n[0][0]+We(t,e),n[0][1]+We(t,e)]),i.push([n[0][0]+We(t,e),n[0][1]+We(t,e)]);for(let r=1;r<n.length;r++)i.push([n[r][0]+We(t,e),n[r][1]+We(t,e)]),r===n.length-1&&i.push([n[r][0]+We(t,e),n[r][1]+We(t,e)]);return hc(i,null,e)}function hc(n,t,e){const i=n.length,r=[];if(i>3){const s=[],a=1-e.curveTightness;r.push({op:"move",data:[n[1][0],n[1][1]]});for(let o=1;o+2<i;o++){const l=n[o];s[0]=[l[0],l[1]],s[1]=[l[0]+(a*n[o+1][0]-a*n[o-1][0])/6,l[1]+(a*n[o+1][1]-a*n[o-1][1])/6],s[2]=[n[o+1][0]+(a*n[o][0]-a*n[o+2][0])/6,n[o+1][1]+(a*n[o][1]-a*n[o+2][1])/6],s[3]=[n[o+1][0],n[o+1][1]],r.push({op:"bcurveTo",data:[s[1][0],s[1][1],s[2][0],s[2][1],s[3][0],s[3][1]]})}}else i===3?(r.push({op:"move",data:[n[1][0],n[1][1]]}),r.push({op:"bcurveTo",data:[n[1][0],n[1][1],n[2][0],n[2][1],n[2][0],n[2][1]]})):i===2&&r.push(...su(n[0][0],n[0][1],n[1][0],n[1][1],e,!0,!0));return r}function rd(n,t,e,i,r,s,a,o){const l=o.roughness===0,c=[],h=[];if(l){n=n/4,h.push([t+i*Math.cos(-n),e+r*Math.sin(-n)]);for(let f=0;f<=Math.PI*2;f=f+n){const d=[t+i*Math.cos(f),e+r*Math.sin(f)];c.push(d),h.push(d)}h.push([t+i*Math.cos(0),e+r*Math.sin(0)]),h.push([t+i*Math.cos(n),e+r*Math.sin(n)])}else{const f=We(.5,o)-Math.PI/2;h.push([We(s,o)+t+.9*i*Math.cos(f-n),We(s,o)+e+.9*r*Math.sin(f-n)]);const d=Math.PI*2+f-.01;for(let u=f;u<d;u=u+n){const y=[We(s,o)+t+i*Math.cos(u),We(s,o)+e+r*Math.sin(u)];c.push(y),h.push(y)}h.push([We(s,o)+t+i*Math.cos(f+Math.PI*2+a*.5),We(s,o)+e+r*Math.sin(f+Math.PI*2+a*.5)]),h.push([We(s,o)+t+.98*i*Math.cos(f+a),We(s,o)+e+.98*r*Math.sin(f+a)]),h.push([We(s,o)+t+.9*i*Math.cos(f+a*.5),We(s,o)+e+.9*r*Math.sin(f+a*.5)])}return[h,c]}function id(n,t,e,i,r,s,a,o,l){const c=s+We(.1,l),h=[];h.push([We(o,l)+t+.9*i*Math.cos(c-n),We(o,l)+e+.9*r*Math.sin(c-n)]);for(let f=c;f<=a;f=f+n)h.push([We(o,l)+t+i*Math.cos(f),We(o,l)+e+r*Math.sin(f)]);return h.push([t+i*Math.cos(a),e+r*Math.sin(a)]),h.push([t+i*Math.cos(a),e+r*Math.sin(a)]),hc(h,null,l)}function Ob(n,t,e,i,r,s,a,o){const l=[],c=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.3];let h=[0,0];const f=o.disableMultiStroke?1:2,d=o.preserveVertices;for(let u=0;u<f;u++)u===0?l.push({op:"move",data:[a[0],a[1]]}):l.push({op:"move",data:[a[0]+(d?0:We(c[0],o)),a[1]+(d?0:We(c[0],o))]}),h=d?[r,s]:[r+We(c[u],o),s+We(c[u],o)],l.push({op:"bcurveTo",data:[n+We(c[u],o),t+We(c[u],o),e+We(c[u],o),i+We(c[u],o),h[0],h[1]]});return l}function ca(n){return[...n]}function sd(n,t=0){const e=n.length;if(e<3)throw new Error("A curve must have at least three points.");const i=[];if(e===3)i.push(ca(n[0]),ca(n[1]),ca(n[2]),ca(n[2]));else{const r=[];r.push(n[0],n[0]);for(let o=1;o<n.length;o++)r.push(n[o]),o===n.length-1&&r.push(n[o]);const s=[],a=1-t;i.push(ca(r[0]));for(let o=1;o+2<r.length;o++){const l=r[o];s[0]=[l[0],l[1]],s[1]=[l[0]+(a*r[o+1][0]-a*r[o-1][0])/6,l[1]+(a*r[o+1][1]-a*r[o-1][1])/6],s[2]=[r[o+1][0]+(a*r[o][0]-a*r[o+2][0])/6,r[o+1][1]+(a*r[o][1]-a*r[o+2][1])/6],s[3]=[r[o+1][0],r[o+1][1]],i.push(s[1],s[2],s[3])}}return i}function Rb(n,t){return Math.sqrt(zl(n,t))}function zl(n,t){return Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)}function Tb(n,t,e){const i=zl(t,e);if(i===0)return zl(n,t);let r=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/i;return r=Math.max(0,Math.min(1,r)),zl(n,js(t,e,r))}function js(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e]}function Bb(n,t){const e=n[t+0],i=n[t+1],r=n[t+2],s=n[t+3];let a=3*i[0]-2*e[0]-s[0];a*=a;let o=3*i[1]-2*e[1]-s[1];o*=o;let l=3*r[0]-2*s[0]-e[0];l*=l;let c=3*r[1]-2*s[1]-e[1];return c*=c,a<l&&(a=l),o<c&&(o=c),a+o}function ou(n,t,e,i){const r=i||[];if(Bb(n,t)<e){const s=n[t+0];r.length?Rb(r[r.length-1],s)>1&&r.push(s):r.push(s),r.push(n[t+3])}else{const a=n[t+0],o=n[t+1],l=n[t+2],c=n[t+3],h=js(a,o,.5),f=js(o,l,.5),d=js(l,c,.5),u=js(h,f,.5),y=js(f,d,.5),g=js(u,y,.5);ou([a,h,u,g],0,e,r),ou([g,y,d,c],0,e,r)}return r}function Eb(n,t){return uc(n,0,n.length,t)}function uc(n,t,e,i,r){const s=r||[],a=n[t],o=n[e-1];let l=0,c=1;for(let h=t+1;h<e-1;++h){const f=Tb(n[h],a,o);f>l&&(l=f,c=h)}return Math.sqrt(l)>i?(uc(n,t,c+1,i,s),uc(n,c,e,i,s)):(s.length||s.push(a),s.push(o)),s}function au(n,t=.15,e){const i=[],r=(n.length-1)/3;for(let s=0;s<r;s++){const a=s*3;ou(n,a,t,i)}return e&&e>0?uc(i,0,i.length,e):i}function Db(n,t,e){const i=Ou(n),r=K1(Z1(i)),s=[];let a=[],o=[0,0],l=[];const c=()=>{l.length>=4&&a.push(...au(l,t)),l=[]},h=()=>{c(),a.length&&(s.push(a),a=[])};for(const{key:d,data:u}of r)switch(d){case"M":h(),o=[u[0],u[1]],a.push(o);break;case"L":c(),a.push([u[0],u[1]]);break;case"C":if(!l.length){const y=a.length?a[a.length-1]:o;l.push([y[0],y[1]])}l.push([u[0],u[1]]),l.push([u[2],u[3]]),l.push([u[4],u[5]]);break;case"Z":c(),a.push([o[0],o[1]]);break}if(h(),!e)return s;const f=[];for(const d of s){const u=Eb(d,e);u.length&&f.push(u)}return f}const Zr="none";class fc{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return wb()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,i){return{shape:t,sets:e||[],options:i||this.defaultOptions}}line(t,e,i,r,s){const a=this._o(s);return this._d("line",[J1(t,e,i,r,a)],a)}rectangle(t,e,i,r,s){const a=this._o(s),o=[],l=Cb(t,e,i,r,a);if(a.fill){const c=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]];a.fillStyle==="solid"?o.push(bh([c],a)):o.push(go([c],a))}return a.stroke!==Zr&&o.push(l),this._d("rectangle",o,a)}ellipse(t,e,i,r,s){const a=this._o(s),o=[],l=t2(i,r,a),c=iu(t,e,a,l);if(a.fill)if(a.fillStyle==="solid"){const h=iu(t,e,a,l).opset;h.type="fillPath",o.push(h)}else o.push(go([c.estimatedPoints],a));return a.stroke!==Zr&&o.push(c.opset),this._d("ellipse",o,a)}circle(t,e,i,r){const s=this.ellipse(t,e,i,i,r);return s.shape="circle",s}linearPath(t,e){const i=this._o(e);return this._d("linearPath",[$l(t,!1,i)],i)}arc(t,e,i,r,s,a,o=!1,l){const c=this._o(l),h=[],f=td(t,e,i,r,s,a,o,!0,c);if(o&&c.fill)if(c.fillStyle==="solid"){const d=Object.assign({},c);d.disableMultiStroke=!0;const u=td(t,e,i,r,s,a,!0,!1,d);u.type="fillPath",h.push(u)}else h.push(Mb(t,e,i,r,s,a,c));return c.stroke!==Zr&&h.push(f),this._d("arc",h,c)}curve(t,e){const i=this._o(e),r=[],s=Jf(t,i);if(i.fill&&i.fill!==Zr)if(i.fillStyle==="solid"){const a=Jf(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));r.push({type:"fillPath",ops:this._mergedShape(a.ops)})}else{const a=[],o=t;if(o.length){const c=typeof o[0][0]=="number"?[o]:o;for(const h of c)h.length<3?a.push(...h):h.length===3?a.push(...au(sd([h[0],h[0],h[1],h[2]]),10,(1+i.roughness)/2)):a.push(...au(sd(h),10,(1+i.roughness)/2))}a.length&&r.push(go([a],i))}return i.stroke!==Zr&&r.push(s),this._d("curve",r,i)}polygon(t,e){const i=this._o(e),r=[],s=$l(t,!0,i);return i.fill&&(i.fillStyle==="solid"?r.push(bh([t],i)):r.push(go([t],i))),i.stroke!==Zr&&r.push(s),this._d("polygon",r,i)}path(t,e){const i=this._o(e),r=[];if(!t)return this._d("path",r,i);t=(t||"").replace(/\\n/g," ").replace(/(-\\s)/g,"-").replace("/(ss)/g"," ");const s=i.fill&&i.fill!=="transparent"&&i.fill!==Zr,a=i.stroke!==Zr,o=!!(i.simplification&&i.simplification<1),l=o?4-4*(i.simplification||1):(1+i.roughness)/2,c=Db(t,1,l),h=ed(t,i);if(s)if(i.fillStyle==="solid")if(c.length===1){const f=ed(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));r.push({type:"fillPath",ops:this._mergedShape(f.ops)})}else r.push(bh(c,i));else r.push(go(c,i));return a&&(o?c.forEach(f=>{r.push($l(f,!1,i))}):r.push(h)),this._d("path",r,i)}opsToPath(t,e){let i="";for(const r of t.ops){const s=typeof e=="number"&&e>=0?r.data.map(a=>+a.toFixed(e)):r.data;switch(r.op){case"move":i+=`M${s[0]} ${s[1]} `;break;case"bcurveTo":i+=`C${s[0]} ${s[1]}, ${s[2]} ${s[3]}, ${s[4]} ${s[5]} `;break;case"lineTo":i+=`L${s[0]} ${s[1]} `;break}}return i.trim()}toPaths(t){const e=t.sets||[],i=t.options||this.defaultOptions,r=[];for(const s of e){let a=null;switch(s.type){case"path":a={d:this.opsToPath(s),stroke:i.stroke,strokeWidth:i.strokeWidth,fill:Zr};break;case"fillPath":a={d:this.opsToPath(s),stroke:Zr,strokeWidth:0,fill:i.fill||Zr};break;case"fillSketch":a=this.fillSketch(s,i);break}a&&r.push(a)}return r}fillSketch(t,e){let i=e.fillWeight;return i<0&&(i=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||Zr,strokeWidth:i,fill:Zr}}_mergedShape(t){return t.filter((e,i)=>i===0?!0:e.op!=="move")}}class Fb{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new fc(e)}draw(t){const e=t.sets||[],i=t.options||this.getDefaultOptions(),r=this.ctx,s=t.options.fixedDecimalPlaceDigits;for(const a of e)switch(a.type){case"path":r.save(),r.strokeStyle=i.stroke==="none"?"transparent":i.stroke,r.lineWidth=i.strokeWidth,i.strokeLineDash&&r.setLineDash(i.strokeLineDash),i.strokeLineDashOffset&&(r.lineDashOffset=i.strokeLineDashOffset),this._drawToContext(r,a,s),r.restore();break;case"fillPath":{r.save(),r.fillStyle=i.fill||"";const o=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(r,a,s,o),r.restore();break}case"fillSketch":this.fillSketch(r,a,i);break}}fillSketch(t,e,i){let r=i.fillWeight;r<0&&(r=i.strokeWidth/2),t.save(),i.fillLineDash&&t.setLineDash(i.fillLineDash),i.fillLineDashOffset&&(t.lineDashOffset=i.fillLineDashOffset),t.strokeStyle=i.fill||"",t.lineWidth=r,this._drawToContext(t,e,i.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,i,r="nonzero"){t.beginPath();for(const s of e.ops){const a=typeof i=="number"&&i>=0?s.data.map(o=>+o.toFixed(i)):s.data;switch(s.op){case"move":t.moveTo(a[0],a[1]);break;case"bcurveTo":t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"lineTo":t.lineTo(a[0],a[1]);break}}e.type==="fillPath"?t.fill(r):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,i,r,s){const a=this.gen.line(t,e,i,r,s);return this.draw(a),a}rectangle(t,e,i,r,s){const a=this.gen.rectangle(t,e,i,r,s);return this.draw(a),a}ellipse(t,e,i,r,s){const a=this.gen.ellipse(t,e,i,r,s);return this.draw(a),a}circle(t,e,i,r){const s=this.gen.circle(t,e,i,r);return this.draw(s),s}linearPath(t,e){const i=this.gen.linearPath(t,e);return this.draw(i),i}polygon(t,e){const i=this.gen.polygon(t,e);return this.draw(i),i}arc(t,e,i,r,s,a,o=!1,l){const c=this.gen.arc(t,e,i,r,s,a,o,l);return this.draw(c),c}curve(t,e){const i=this.gen.curve(t,e);return this.draw(i),i}path(t,e){const i=this.gen.path(t,e);return this.draw(i),i}}const xl="http://www.w3.org/2000/svg";class $b{constructor(t,e){this.svg=t,this.gen=new fc(e)}draw(t){const e=t.sets||[],i=t.options||this.getDefaultOptions(),r=this.svg.ownerDocument||window.document,s=r.createElementNS(xl,"g"),a=t.options.fixedDecimalPlaceDigits;for(const o of e){let l=null;switch(o.type){case"path":{l=r.createElementNS(xl,"path"),l.setAttribute("d",this.opsToPath(o,a)),l.setAttribute("stroke",i.stroke),l.setAttribute("stroke-width",i.strokeWidth+""),l.setAttribute("fill","none"),i.strokeLineDash&&l.setAttribute("stroke-dasharray",i.strokeLineDash.join(" ").trim()),i.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${i.strokeLineDashOffset}`);break}case"fillPath":{l=r.createElementNS(xl,"path"),l.setAttribute("d",this.opsToPath(o,a)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",i.fill||""),(t.shape==="curve"||t.shape==="polygon")&&l.setAttribute("fill-rule","evenodd");break}case"fillSketch":{l=this.fillSketch(r,o,i);break}}l&&s.appendChild(l)}return s}fillSketch(t,e,i){let r=i.fillWeight;r<0&&(r=i.strokeWidth/2);const s=t.createElementNS(xl,"path");return s.setAttribute("d",this.opsToPath(e,i.fixedDecimalPlaceDigits)),s.setAttribute("stroke",i.fill||""),s.setAttribute("stroke-width",r+""),s.setAttribute("fill","none"),i.fillLineDash&&s.setAttribute("stroke-dasharray",i.fillLineDash.join(" ").trim()),i.fillLineDashOffset&&s.setAttribute("stroke-dashoffset",`${i.fillLineDashOffset}`),s}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,i,r,s){const a=this.gen.line(t,e,i,r,s);return this.draw(a)}rectangle(t,e,i,r,s){const a=this.gen.rectangle(t,e,i,r,s);return this.draw(a)}ellipse(t,e,i,r,s){const a=this.gen.ellipse(t,e,i,r,s);return this.draw(a)}circle(t,e,i,r){const s=this.gen.circle(t,e,i,r);return this.draw(s)}linearPath(t,e){const i=this.gen.linearPath(t,e);return this.draw(i)}polygon(t,e){const i=this.gen.polygon(t,e);return this.draw(i)}arc(t,e,i,r,s,a,o=!1,l){const c=this.gen.arc(t,e,i,r,s,a,o,l);return this.draw(c)}curve(t,e){const i=this.gen.curve(t,e);return this.draw(i)}path(t,e){const i=this.gen.path(t,e);return this.draw(i)}}const n2={canvas(n,t){return new Fb(n,t)},svg(n,t){return new $b(n,t)},generator(n){return new fc(n)},newSeed(){return fc.newSeed()}};function An(n){"@babel/helpers - typeof";return An=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},An(n)}var vi=Uint8Array,ti=Uint16Array,Ru=Int32Array,Tu=new vi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bu=new vi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),od=new vi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r2=function(n,t){for(var e=new ti(31),i=0;i<31;++i)e[i]=t+=1<<n[i-1];for(var r=new Ru(e[30]),i=1;i<30;++i)for(var s=e[i];s<e[i+1];++s)r[s]=s-e[i]<<5|i;return{b:e,r}},i2=r2(Tu,2),zb=i2.b,lu=i2.r;zb[28]=258,lu[258]=28;var jb=r2(Bu,0),ad=jb.r,cu=new ti(32768);for(var $n=0;$n<32768;++$n){var ws=($n&43690)>>1|($n&21845)<<1;ws=(ws&52428)>>2|(ws&13107)<<2,ws=(ws&61680)>>4|(ws&3855)<<4,cu[$n]=((ws&65280)>>8|(ws&255)<<8)>>1}var ma=(function(n,t,e){for(var i=n.length,r=0,s=new ti(t);r<i;++r)n[r]&&++s[n[r]-1];var a=new ti(t);for(r=1;r<t;++r)a[r]=a[r-1]+s[r-1]<<1;var o;if(e){o=new ti(1<<t);var l=15-t;for(r=0;r<i;++r)if(n[r])for(var c=r<<4|n[r],h=t-n[r],f=a[n[r]-1]++<<h,d=f|(1<<h)-1;f<=d;++f)o[cu[f]>>l]=c}else for(o=new ti(i),r=0;r<i;++r)n[r]&&(o[r]=cu[a[n[r]-1]++]>>15-n[r]);return o}),Ys=new vi(288);for(var $n=0;$n<144;++$n)Ys[$n]=8;for(var $n=144;$n<256;++$n)Ys[$n]=9;for(var $n=256;$n<280;++$n)Ys[$n]=7;for(var $n=280;$n<288;++$n)Ys[$n]=8;var dc=new vi(32);for(var $n=0;$n<32;++$n)dc[$n]=5;var Ub=ma(Ys,9,0),Wb=ma(dc,5,0),s2=function(n){return(n+7)/8|0},qb=function(n,t,e){return(e==null||e>n.length)&&(e=n.length),new vi(n.subarray(t,e))},Zi=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>8},ha=function(n,t,e){e<<=t&7;var i=t/8|0;n[i]|=e,n[i+1]|=e>>8,n[i+2]|=e>>16},wh=function(n,t){for(var e=[],i=0;i<n.length;++i)n[i]&&e.push({s:i,f:n[i]});var r=e.length,s=e.slice();if(!r)return{t:a2,l:0};if(r==1){var a=new vi(e[0].s+1);return a[e[0].s]=1,{t:a,l:1}}e.sort(function(T,q){return T.f-q.f}),e.push({s:-1,f:25001});var o=e[0],l=e[1],c=0,h=1,f=2;for(e[0]={s:-1,f:o.f+l.f,l:o,r:l};h!=r-1;)o=e[e[c].f<e[f].f?c++:f++],l=e[c!=h&&e[c].f<e[f].f?c++:f++],e[h++]={s:-1,f:o.f+l.f,l:o,r:l};for(var d=s[0].s,i=1;i<r;++i)s[i].s>d&&(d=s[i].s);var u=new ti(d+1),y=hu(e[h-1],u,0);if(y>t){var i=0,g=0,w=y-t,m=1<<w;for(s.sort(function(q,U){return u[U.s]-u[q.s]||q.f-U.f});i<r;++i){var x=s[i].s;if(u[x]>t)g+=m-(1<<y-u[x]),u[x]=t;else break}for(g>>=w;g>0;){var _=s[i].s;u[_]<t?g-=1<<t-u[_]++-1:++i}for(;i>=0&&g;--i){var L=s[i].s;u[L]==t&&(--u[L],++g)}y=t}return{t:new vi(u),l:y}},hu=function(n,t,e){return n.s==-1?Math.max(hu(n.l,t,e+1),hu(n.r,t,e+1)):t[n.s]=e},ld=function(n){for(var t=n.length;t&&!n[--t];);for(var e=new ti(++t),i=0,r=n[0],s=1,a=function(l){e[i++]=l},o=1;o<=t;++o)if(n[o]==r&&o!=t)++s;else{if(!r&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(r),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(r);s=1,r=n[o]}return{c:e.subarray(0,i),n:t}},ua=function(n,t){for(var e=0,i=0;i<t.length;++i)e+=n[i]*t[i];return e},o2=function(n,t,e){var i=e.length,r=s2(t+2);n[r]=i&255,n[r+1]=i>>8,n[r+2]=n[r]^255,n[r+3]=n[r+1]^255;for(var s=0;s<i;++s)n[r+s+4]=e[s];return(r+4+i)*8},cd=function(n,t,e,i,r,s,a,o,l,c,h){Zi(t,h++,e),++r[256];for(var f=wh(r,15),d=f.t,u=f.l,y=wh(s,15),g=y.t,w=y.l,m=ld(d),x=m.c,_=m.n,L=ld(g),T=L.c,q=L.n,U=new ti(19),B=0;B<x.length;++B)++U[x[B]&31];for(var B=0;B<T.length;++B)++U[T[B]&31];for(var O=wh(U,7),X=O.t,R=O.l,M=19;M>4&&!X[od[M-1]];--M);var $=c+5<<3,S=ua(r,Ys)+ua(s,dc)+a,J=ua(r,d)+ua(s,g)+a+14+3*M+ua(U,X)+2*U[16]+3*U[17]+7*U[18];if(l>=0&&$<=S&&$<=J)return o2(t,h,n.subarray(l,l+c));var mt,ot,ft,ct;if(Zi(t,h,1+(J<S)),h+=2,J<S){mt=ma(d,u,0),ot=d,ft=ma(g,w,0),ct=g;var Bt=ma(X,R,0);Zi(t,h,_-257),Zi(t,h+5,q-1),Zi(t,h+10,M-4),h+=14;for(var B=0;B<M;++B)Zi(t,h+3*B,X[od[B]]);h+=3*M;for(var at=[x,T],P=0;P<2;++P)for(var Y=at[P],B=0;B<Y.length;++B){var K=Y[B]&31;Zi(t,h,Bt[K]),h+=X[K],K>15&&(Zi(t,h,Y[B]>>5&127),h+=Y[B]>>12)}}else mt=Ub,ot=Ys,ft=Wb,ct=dc;for(var B=0;B<o;++B){var et=i[B];if(et>255){var K=et>>18&31;ha(t,h,mt[K+257]),h+=ot[K+257],K>7&&(Zi(t,h,et>>23&31),h+=Tu[K]);var gt=et&31;ha(t,h,ft[gt]),h+=ct[gt],gt>3&&(ha(t,h,et>>5&8191),h+=Bu[gt])}else ha(t,h,mt[et]),h+=ot[et]}return ha(t,h,mt[256]),h+ot[256]},Xb=new Ru([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),a2=new vi(0),Gb=function(n,t,e,i,r,s){var a=s.z||n.length,o=new vi(i+a+5*(1+Math.ceil(a/7e3))+r),l=o.subarray(i,o.length-r),c=s.l,h=(s.r||0)&7;if(t){h&&(l[0]=s.r>>3);for(var f=Xb[t-1],d=f>>13,u=f&8191,y=(1<<e)-1,g=s.p||new ti(32768),w=s.h||new ti(y+1),m=Math.ceil(e/3),x=2*m,_=function(I){return(n[I]^n[I+1]<<m^n[I+2]<<x)&y},L=new Ru(25e3),T=new ti(288),q=new ti(32),U=0,B=0,O=s.i||0,X=0,R=s.w||0,M=0;O+2<a;++O){var $=_(O),S=O&32767,J=w[$];if(g[S]=J,w[$]=S,R<=O){var mt=a-O;if((U>7e3||X>24576)&&(mt>423||!c)){h=cd(n,l,0,L,T,q,B,X,M,O-M,h),X=U=B=0,M=O;for(var ot=0;ot<286;++ot)T[ot]=0;for(var ot=0;ot<30;++ot)q[ot]=0}var ft=2,ct=0,Bt=u,at=S-J&32767;if(mt>2&&$==_(O-at))for(var P=Math.min(d,mt)-1,Y=Math.min(32767,O),K=Math.min(258,mt);at<=Y&&--Bt&&S!=J;){if(n[O+ft]==n[O+ft-at]){for(var et=0;et<K&&n[O+et]==n[O+et-at];++et);if(et>ft){if(ft=et,ct=at,et>P)break;for(var gt=Math.min(at,et-2),kt=0,ot=0;ot<gt;++ot){var _t=O-at+ot&32767,Pt=g[_t],jt=_t-Pt&32767;jt>kt&&(kt=jt,J=_t)}}}S=J,J=g[S],at+=S-J&32767}if(ct){L[X++]=268435456|lu[ft]<<18|ad[ct];var Zt=lu[ft]&31,pe=ad[ct]&31;B+=Tu[Zt]+Bu[pe],++T[257+Zt],++q[pe],R=O+ft,++U}else L[X++]=n[O],++T[n[O]]}}for(O=Math.max(O,R);O<a;++O)L[X++]=n[O],++T[n[O]];h=cd(n,l,c,L,T,q,B,X,M,O-M,h),c||(s.r=h&7|l[h/8|0]<<3,h-=7,s.h=w,s.p=g,s.i=O,s.w=R)}else{for(var O=s.w||0;O<a+c;O+=65535){var he=O+65535;he>=a&&(l[h/8|0]=c,he=a),h=o2(l,h+1,n.subarray(O,he))}s.i=a}return qb(o,0,i+s2(h)+r)},l2=function(){var n=1,t=0;return{p:function(e){for(var i=n,r=t,s=e.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)r+=i+=e[a];i=(i&65535)+15*(i>>16),r=(r&65535)+15*(r>>16)}n=i,t=r},d:function(){return n%=65521,t%=65521,(n&255)<<24|(n&65280)<<8|(t&255)<<8|t>>8}}},Hb=function(n,t,e,i,r){if(!r&&(r={l:1},t.dictionary)){var s=t.dictionary.subarray(-32768),a=new vi(s.length+n.length);a.set(s),a.set(n,s.length),n=a,r.w=s.length}return Gb(n,t.level==null?6:t.level,t.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):20:12+t.mem,e,i,r)},c2=function(n,t,e){for(;e;++t)n[t]=e,e>>>=8},Yb=function(n,t){var e=t.level,i=e==0?0:e<6?1:e==9?3:2;if(n[0]=120,n[1]=i<<6|(t.dictionary&&32),n[1]|=31-(n[0]<<8|n[1])%31,t.dictionary){var r=l2();r.p(t.dictionary),c2(n,2,r.d())}};function uu(n,t){t||(t={});var e=l2();e.p(n);var i=Hb(n,t,t.dictionary?6:2,4);return Yb(i,t),c2(i,i.length-4,e.d()),i}var Vb=typeof TextDecoder<"u"&&new TextDecoder,Zb=0;try{Vb.decode(a2,{stream:!0}),Zb=1}catch{}function Kb(n){if(Array.isArray(n))return n}function Qb(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var i,r,s,a,o=[],l=!0,c=!1;try{if(s=(e=e.call(n)).next,t!==0)for(;!(l=(i=s.call(e)).done)&&(o.push(i.value),o.length!==t);l=!0);}catch(h){c=!0,r=h}finally{try{if(!l&&e.return!=null&&(a=e.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}function hd(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,i=Array(t);e<t;e++)i[e]=n[e];return i}function Jb(n,t){if(n){if(typeof n=="string")return hd(n,t);var e={}.toString.call(n).slice(8,-1);return e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set"?Array.from(n):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?hd(n,t):void 0}}function tw(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ud(n,t){return Kb(n)||Qb(n,t)||Jb(n,t)||tw()}function fd(n,t="utf8"){return new TextDecoder(t).decode(n)}const ew=new TextEncoder;function nw(n){return ew.encode(n)}const rw=1024*8,iw=(()=>{const n=new Uint8Array(4),t=new Uint32Array(n.buffer);return!((t[0]=1)&n[0])})(),vh={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Eu{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=rw,e={}){let i=!1;typeof t=="number"?t=new ArrayBuffer(t):(i=!0,this.lastWrittenByte=t.byteLength);const r=e.offset?e.offset>>>0:0,s=t.byteLength-r;let a=r;(ArrayBuffer.isView(t)||t instanceof Eu)&&(t.byteLength!==t.buffer.byteLength&&(a=t.byteOffset+r),t=t.buffer),i?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const i=(this.offset+t)*2,r=new Uint8Array(i);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=i,this.byteLength=i,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const i=vh[e].BYTES_PER_ELEMENT*t,r=this.byteOffset+this.offset,s=this.buffer.slice(r,r+i);if(this.littleEndian===iw&&e!=="uint8"&&e!=="int8"){const o=new Uint8Array(this.buffer.slice(r,r+i));o.reverse();const l=new vh[e](o.buffer);return this.offset+=i,l.reverse(),l}const a=new vh[e](s);return this.offset+=i,a}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let i=0;i<t;i++)e+=this.readChar();return e}readUtf8(t=1){return fd(this.readBytes(t))}decodeText(t=1,e="utf8"){return fd(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(nw(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Io(n){let t=n.length;for(;--t>=0;)n[t]=0}const sw=3,ow=258,h2=29,aw=256,lw=aw+1+h2,u2=30,cw=512,hw=new Array((lw+2)*2);Io(hw);const uw=new Array(u2*2);Io(uw);const fw=new Array(cw);Io(fw);const dw=new Array(ow-sw+1);Io(dw);const pw=new Array(h2);Io(pw);const gw=new Array(u2);Io(gw);const yw=(n,t,e,i)=>{let r=n&65535|0,s=n>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do r=r+t[i++]|0,s=s+r|0;while(--a);r%=65521,s%=65521}return r|s<<16|0};var fu=yw;const mw=()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var i=0;i<8;i++)n=n&1?3988292384^n>>>1:n>>>1;t[e]=n}return t},bw=new Uint32Array(mw()),ww=(n,t,e,i)=>{const r=bw,s=i+e;n^=-1;for(let a=i;a<s;a++)n=n>>>8^r[(n^t[a])&255];return n^-1};var Ci=ww,du={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},f2={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const vw=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var xw=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)vw(e,i)&&(n[i]=e[i])}}return n},kw=n=>{let t=0;for(let i=0,r=n.length;i<r;i++)t+=n[i].length;const e=new Uint8Array(t);for(let i=0,r=0,s=n.length;i<s;i++){let a=n[i];e.set(a,r),r+=a.length}return e},d2={assign:xw,flattenChunks:kw};let p2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{p2=!1}const Sa=new Uint8Array(256);for(let n=0;n<256;n++)Sa[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Sa[254]=Sa[254]=1;var _w=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,i,r,s,a=n.length,o=0;for(r=0;r<a;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<a&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(o),s=0,r=0;s<o;r++)e=n.charCodeAt(r),(e&64512)===55296&&r+1<a&&(i=n.charCodeAt(r+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),r++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|e&63):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|e&63):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|e&63);return t};const Sw=(n,t)=>{if(t<65534&&n.subarray&&p2)return String.fromCharCode.apply(null,n.length===t?n:n.subarray(0,t));let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(n[i]);return e};var Aw=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let i,r;const s=new Array(e*2);for(r=0,i=0;i<e;){let a=n[i++];if(a<128){s[r++]=a;continue}let o=Sa[a];if(o>4){s[r++]=65533,i+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&i<e;)a=a<<6|n[i++]&63,o--;if(o>1){s[r++]=65533;continue}a<65536?s[r++]=a:(a-=65536,s[r++]=55296|a>>10&1023,s[r++]=56320|a&1023)}return Sw(s,r)},Cw=(n,t)=>{t=t||n.length,t>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(n[e]&192)===128;)e--;return e<0||e===0?t:e+Sa[n[e]]>t?e:t},pu={string2buf:_w,buf2string:Aw,utf8border:Cw};function Lw(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Mw=Lw;const kl=16209,Nw=16191;var Pw=function(t,e){let i,r,s,a,o,l,c,h,f,d,u,y,g,w,m,x,_,L,T,q,U,B,O,X;const R=t.state;i=t.next_in,O=t.input,r=i+(t.avail_in-5),s=t.next_out,X=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),l=R.dmax,c=R.wsize,h=R.whave,f=R.wnext,d=R.window,u=R.hold,y=R.bits,g=R.lencode,w=R.distcode,m=(1<<R.lenbits)-1,x=(1<<R.distbits)-1;t:do{y<15&&(u+=O[i++]<<y,y+=8,u+=O[i++]<<y,y+=8),_=g[u&m];e:for(;;){if(L=_>>>24,u>>>=L,y-=L,L=_>>>16&255,L===0)X[s++]=_&65535;else if(L&16){T=_&65535,L&=15,L&&(y<L&&(u+=O[i++]<<y,y+=8),T+=u&(1<<L)-1,u>>>=L,y-=L),y<15&&(u+=O[i++]<<y,y+=8,u+=O[i++]<<y,y+=8),_=w[u&x];n:for(;;){if(L=_>>>24,u>>>=L,y-=L,L=_>>>16&255,L&16){if(q=_&65535,L&=15,y<L&&(u+=O[i++]<<y,y+=8,y<L&&(u+=O[i++]<<y,y+=8)),q+=u&(1<<L)-1,q>l){t.msg="invalid distance too far back",R.mode=kl;break t}if(u>>>=L,y-=L,L=s-a,q>L){if(L=q-L,L>h&&R.sane){t.msg="invalid distance too far back",R.mode=kl;break t}if(U=0,B=d,f===0){if(U+=c-L,L<T){T-=L;do X[s++]=d[U++];while(--L);U=s-q,B=X}}else if(f<L){if(U+=c+f-L,L-=f,L<T){T-=L;do X[s++]=d[U++];while(--L);if(U=0,f<T){L=f,T-=L;do X[s++]=d[U++];while(--L);U=s-q,B=X}}}else if(U+=f-L,L<T){T-=L;do X[s++]=d[U++];while(--L);U=s-q,B=X}for(;T>2;)X[s++]=B[U++],X[s++]=B[U++],X[s++]=B[U++],T-=3;T&&(X[s++]=B[U++],T>1&&(X[s++]=B[U++]))}else{U=s-q;do X[s++]=X[U++],X[s++]=X[U++],X[s++]=X[U++],T-=3;while(T>2);T&&(X[s++]=X[U++],T>1&&(X[s++]=X[U++]))}}else if((L&64)===0){_=w[(_&65535)+(u&(1<<L)-1)];continue n}else{t.msg="invalid distance code",R.mode=kl;break t}break}}else if((L&64)===0){_=g[(_&65535)+(u&(1<<L)-1)];continue e}else if(L&32){R.mode=Nw;break t}else{t.msg="invalid literal/length code",R.mode=kl;break t}break}}while(i<r&&s<o);T=y>>3,i-=T,y-=T<<3,u&=(1<<y)-1,t.next_in=i,t.next_out=s,t.avail_in=i<r?5+(r-i):5-(i-r),t.avail_out=s<o?257+(o-s):257-(s-o),R.hold=u,R.bits=y};const ho=15,dd=852,pd=592,gd=0,xh=1,yd=2,Iw=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ow=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Rw=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tw=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Bw=(n,t,e,i,r,s,a,o)=>{const l=o.bits;let c=0,h=0,f=0,d=0,u=0,y=0,g=0,w=0,m=0,x=0,_,L,T,q,U,B=null,O;const X=new Uint16Array(ho+1),R=new Uint16Array(ho+1);let M=null,$,S,J;for(c=0;c<=ho;c++)X[c]=0;for(h=0;h<i;h++)X[t[e+h]]++;for(u=l,d=ho;d>=1&&X[d]===0;d--);if(u>d&&(u=d),d===0)return r[s++]=1<<24|64<<16|0,r[s++]=1<<24|64<<16|0,o.bits=1,0;for(f=1;f<d&&X[f]===0;f++);for(u<f&&(u=f),w=1,c=1;c<=ho;c++)if(w<<=1,w-=X[c],w<0)return-1;if(w>0&&(n===gd||d!==1))return-1;for(R[1]=0,c=1;c<ho;c++)R[c+1]=R[c]+X[c];for(h=0;h<i;h++)t[e+h]!==0&&(a[R[t[e+h]]++]=h);if(n===gd?(B=M=a,O=20):n===xh?(B=Iw,M=Ow,O=257):(B=Rw,M=Tw,O=0),x=0,h=0,c=f,U=s,y=u,g=0,T=-1,m=1<<u,q=m-1,n===xh&&m>dd||n===yd&&m>pd)return 1;for(;;){$=c-g,a[h]+1<O?(S=0,J=a[h]):a[h]>=O?(S=M[a[h]-O],J=B[a[h]-O]):(S=96,J=0),_=1<<c-g,L=1<<y,f=L;do L-=_,r[U+(x>>g)+L]=$<<24|S<<16|J|0;while(L!==0);for(_=1<<c-1;x&_;)_>>=1;if(_!==0?(x&=_-1,x+=_):x=0,h++,--X[c]===0){if(c===d)break;c=t[e+a[h]]}if(c>u&&(x&q)!==T){for(g===0&&(g=u),U+=f,y=c-g,w=1<<y;y+g<d&&(w-=X[y+g],!(w<=0));)y++,w<<=1;if(m+=1<<y,n===xh&&m>dd||n===yd&&m>pd)return 1;T=x&q,r[T]=u<<24|y<<16|U-s|0}}return x!==0&&(r[U+x]=c-g<<24|64<<16|0),o.bits=u,0};var ba=Bw;const Ew=0,g2=1,y2=2,{Z_FINISH:md,Z_BLOCK:Dw,Z_TREES:_l,Z_OK:Vs,Z_STREAM_END:Fw,Z_NEED_DICT:$w,Z_STREAM_ERROR:oi,Z_DATA_ERROR:m2,Z_MEM_ERROR:b2,Z_BUF_ERROR:zw,Z_DEFLATED:bd}=f2,_c=16180,wd=16181,vd=16182,xd=16183,kd=16184,_d=16185,Sd=16186,Ad=16187,Cd=16188,Ld=16189,pc=16190,Ki=16191,kh=16192,Md=16193,_h=16194,Nd=16195,Pd=16196,Id=16197,Od=16198,Sl=16199,Al=16200,Rd=16201,Td=16202,Bd=16203,Ed=16204,Dd=16205,Sh=16206,Fd=16207,$d=16208,zn=16209,w2=16210,v2=16211,jw=852,Uw=592,Ww=15,qw=Ww,zd=n=>(n>>>24&255)+(n>>>8&65280)+((n&65280)<<8)+((n&255)<<24);function Xw(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ks=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<_c||t.mode>v2?1:0},x2=n=>{if(Ks(n))return oi;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=t.wrap&1),t.mode=_c,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(jw),t.distcode=t.distdyn=new Int32Array(Uw),t.sane=1,t.back=-1,Vs},k2=n=>{if(Ks(n))return oi;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,x2(n)},_2=(n,t)=>{let e;if(Ks(n))return oi;const i=n.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?oi:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,k2(n))},S2=(n,t)=>{if(!n)return oi;const e=new Xw;n.state=e,e.strm=n,e.window=null,e.mode=_c;const i=_2(n,t);return i!==Vs&&(n.state=null),i},Gw=n=>S2(n,qw);let jd=!0,Ah,Ch;const Hw=n=>{if(jd){Ah=new Int32Array(512),Ch=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(ba(g2,n.lens,0,288,Ah,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;ba(y2,n.lens,0,32,Ch,0,n.work,{bits:5}),jd=!1}n.lencode=Ah,n.lenbits=9,n.distcode=Ch,n.distbits=5},A2=(n,t,e,i)=>{let r;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(t.subarray(e-i,e-i+r),s.wnext),i-=r,i?(s.window.set(t.subarray(e-i,e),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0},Yw=(n,t)=>{let e,i,r,s,a,o,l,c,h,f,d,u,y,g,w=0,m,x,_,L,T,q,U,B;const O=new Uint8Array(4);let X,R;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ks(n)||!n.output||!n.input&&n.avail_in!==0)return oi;e=n.state,e.mode===Ki&&(e.mode=kh),a=n.next_out,r=n.output,l=n.avail_out,s=n.next_in,i=n.input,o=n.avail_in,c=e.hold,h=e.bits,f=o,d=l,B=Vs;t:for(;;)switch(e.mode){case _c:if(e.wrap===0){e.mode=kh;break}for(;h<16;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(e.wrap&2&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=c&255,O[1]=c>>>8&255,e.check=Ci(e.check,O,2,0),c=0,h=0,e.mode=wd;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((c&255)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=zn;break}if((c&15)!==bd){n.msg="unknown compression method",e.mode=zn;break}if(c>>>=4,h-=4,U=(c&15)+8,e.wbits===0&&(e.wbits=U),U>15||U>e.wbits){n.msg="invalid window size",e.mode=zn;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=c&512?Ld:Ki,c=0,h=0;break;case wd:for(;h<16;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(e.flags=c,(e.flags&255)!==bd){n.msg="unknown compression method",e.mode=zn;break}if(e.flags&57344){n.msg="unknown header flags set",e.mode=zn;break}e.head&&(e.head.text=c>>8&1),e.flags&512&&e.wrap&4&&(O[0]=c&255,O[1]=c>>>8&255,e.check=Ci(e.check,O,2,0)),c=0,h=0,e.mode=vd;case vd:for(;h<32;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.head&&(e.head.time=c),e.flags&512&&e.wrap&4&&(O[0]=c&255,O[1]=c>>>8&255,O[2]=c>>>16&255,O[3]=c>>>24&255,e.check=Ci(e.check,O,4,0)),c=0,h=0,e.mode=xd;case xd:for(;h<16;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.head&&(e.head.xflags=c&255,e.head.os=c>>8),e.flags&512&&e.wrap&4&&(O[0]=c&255,O[1]=c>>>8&255,e.check=Ci(e.check,O,2,0)),c=0,h=0,e.mode=kd;case kd:if(e.flags&1024){for(;h<16;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.length=c,e.head&&(e.head.extra_len=c),e.flags&512&&e.wrap&4&&(O[0]=c&255,O[1]=c>>>8&255,e.check=Ci(e.check,O,2,0)),c=0,h=0}else e.head&&(e.head.extra=null);e.mode=_d;case _d:if(e.flags&1024&&(u=e.length,u>o&&(u=o),u&&(e.head&&(U=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(s,s+u),U)),e.flags&512&&e.wrap&4&&(e.check=Ci(e.check,i,u,s)),o-=u,s+=u,e.length-=u),e.length))break t;e.length=0,e.mode=Sd;case Sd:if(e.flags&2048){if(o===0)break t;u=0;do U=i[s+u++],e.head&&U&&e.length<65536&&(e.head.name+=String.fromCharCode(U));while(U&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Ci(e.check,i,u,s)),o-=u,s+=u,U)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=Ad;case Ad:if(e.flags&4096){if(o===0)break t;u=0;do U=i[s+u++],e.head&&U&&e.length<65536&&(e.head.comment+=String.fromCharCode(U));while(U&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Ci(e.check,i,u,s)),o-=u,s+=u,U)break t}else e.head&&(e.head.comment=null);e.mode=Cd;case Cd:if(e.flags&512){for(;h<16;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(e.wrap&4&&c!==(e.check&65535)){n.msg="header crc mismatch",e.mode=zn;break}c=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=Ki;break;case Ld:for(;h<32;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}n.adler=e.check=zd(c),c=0,h=0,e.mode=pc;case pc:if(e.havedict===0)return n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=h,$w;n.adler=e.check=1,e.mode=Ki;case Ki:if(t===Dw||t===_l)break t;case kh:if(e.last){c>>>=h&7,h-=h&7,e.mode=Sh;break}for(;h<3;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}switch(e.last=c&1,c>>>=1,h-=1,c&3){case 0:e.mode=Md;break;case 1:if(Hw(e),e.mode=Sl,t===_l){c>>>=2,h-=2;break t}break;case 2:e.mode=Pd;break;case 3:n.msg="invalid block type",e.mode=zn}c>>>=2,h-=2;break;case Md:for(c>>>=h&7,h-=h&7;h<32;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if((c&65535)!==(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=zn;break}if(e.length=c&65535,c=0,h=0,e.mode=_h,t===_l)break t;case _h:e.mode=Nd;case Nd:if(u=e.length,u){if(u>o&&(u=o),u>l&&(u=l),u===0)break t;r.set(i.subarray(s,s+u),a),o-=u,s+=u,l-=u,a+=u,e.length-=u;break}e.mode=Ki;break;case Pd:for(;h<14;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(e.nlen=(c&31)+257,c>>>=5,h-=5,e.ndist=(c&31)+1,c>>>=5,h-=5,e.ncode=(c&15)+4,c>>>=4,h-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=zn;break}e.have=0,e.mode=Id;case Id:for(;e.have<e.ncode;){for(;h<3;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.lens[M[e.have++]]=c&7,c>>>=3,h-=3}for(;e.have<19;)e.lens[M[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,X={bits:e.lenbits},B=ba(Ew,e.lens,0,19,e.lencode,0,e.work,X),e.lenbits=X.bits,B){n.msg="invalid code lengths set",e.mode=zn;break}e.have=0,e.mode=Od;case Od:for(;e.have<e.nlen+e.ndist;){for(;w=e.lencode[c&(1<<e.lenbits)-1],m=w>>>24,x=w>>>16&255,_=w&65535,!(m<=h);){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(_<16)c>>>=m,h-=m,e.lens[e.have++]=_;else{if(_===16){for(R=m+2;h<R;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(c>>>=m,h-=m,e.have===0){n.msg="invalid bit length repeat",e.mode=zn;break}U=e.lens[e.have-1],u=3+(c&3),c>>>=2,h-=2}else if(_===17){for(R=m+3;h<R;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}c>>>=m,h-=m,U=0,u=3+(c&7),c>>>=3,h-=3}else{for(R=m+7;h<R;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}c>>>=m,h-=m,U=0,u=11+(c&127),c>>>=7,h-=7}if(e.have+u>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=zn;break}for(;u--;)e.lens[e.have++]=U}}if(e.mode===zn)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=zn;break}if(e.lenbits=9,X={bits:e.lenbits},B=ba(g2,e.lens,0,e.nlen,e.lencode,0,e.work,X),e.lenbits=X.bits,B){n.msg="invalid literal/lengths set",e.mode=zn;break}if(e.distbits=6,e.distcode=e.distdyn,X={bits:e.distbits},B=ba(y2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,X),e.distbits=X.bits,B){n.msg="invalid distances set",e.mode=zn;break}if(e.mode=Sl,t===_l)break t;case Sl:e.mode=Al;case Al:if(o>=6&&l>=258){n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=h,Pw(n,d),a=n.next_out,r=n.output,l=n.avail_out,s=n.next_in,i=n.input,o=n.avail_in,c=e.hold,h=e.bits,e.mode===Ki&&(e.back=-1);break}for(e.back=0;w=e.lencode[c&(1<<e.lenbits)-1],m=w>>>24,x=w>>>16&255,_=w&65535,!(m<=h);){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(x&&(x&240)===0){for(L=m,T=x,q=_;w=e.lencode[q+((c&(1<<L+T)-1)>>L)],m=w>>>24,x=w>>>16&255,_=w&65535,!(L+m<=h);){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}c>>>=L,h-=L,e.back+=L}if(c>>>=m,h-=m,e.back+=m,e.length=_,x===0){e.mode=Dd;break}if(x&32){e.back=-1,e.mode=Ki;break}if(x&64){n.msg="invalid literal/length code",e.mode=zn;break}e.extra=x&15,e.mode=Rd;case Rd:if(e.extra){for(R=e.extra;h<R;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Td;case Td:for(;w=e.distcode[c&(1<<e.distbits)-1],m=w>>>24,x=w>>>16&255,_=w&65535,!(m<=h);){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if((x&240)===0){for(L=m,T=x,q=_;w=e.distcode[q+((c&(1<<L+T)-1)>>L)],m=w>>>24,x=w>>>16&255,_=w&65535,!(L+m<=h);){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}c>>>=L,h-=L,e.back+=L}if(c>>>=m,h-=m,e.back+=m,x&64){n.msg="invalid distance code",e.mode=zn;break}e.offset=_,e.extra=x&15,e.mode=Bd;case Bd:if(e.extra){for(R=e.extra;h<R;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=zn;break}e.mode=Ed;case Ed:if(l===0)break t;if(u=d-l,e.offset>u){if(u=e.offset-u,u>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=zn;break}u>e.wnext?(u-=e.wnext,y=e.wsize-u):y=e.wnext-u,u>e.length&&(u=e.length),g=e.window}else g=r,y=a-e.offset,u=e.length;u>l&&(u=l),l-=u,e.length-=u;do r[a++]=g[y++];while(--u);e.length===0&&(e.mode=Al);break;case Dd:if(l===0)break t;r[a++]=e.length,l--,e.mode=Al;break;case Sh:if(e.wrap){for(;h<32;){if(o===0)break t;o--,c|=i[s++]<<h,h+=8}if(d-=l,n.total_out+=d,e.total+=d,e.wrap&4&&d&&(n.adler=e.check=e.flags?Ci(e.check,r,d,a-d):fu(e.check,r,d,a-d)),d=l,e.wrap&4&&(e.flags?c:zd(c))!==e.check){n.msg="incorrect data check",e.mode=zn;break}c=0,h=0}e.mode=Fd;case Fd:if(e.wrap&&e.flags){for(;h<32;){if(o===0)break t;o--,c+=i[s++]<<h,h+=8}if(e.wrap&4&&c!==(e.total&4294967295)){n.msg="incorrect length check",e.mode=zn;break}c=0,h=0}e.mode=$d;case $d:B=Fw;break t;case zn:B=m2;break t;case w2:return b2;case v2:default:return oi}return n.next_out=a,n.avail_out=l,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=h,(e.wsize||d!==n.avail_out&&e.mode<zn&&(e.mode<Sh||t!==md))&&A2(n,n.output,n.next_out,d-n.avail_out),f-=n.avail_in,d-=n.avail_out,n.total_in+=f,n.total_out+=d,e.total+=d,e.wrap&4&&d&&(n.adler=e.check=e.flags?Ci(e.check,r,d,n.next_out-d):fu(e.check,r,d,n.next_out-d)),n.data_type=e.bits+(e.last?64:0)+(e.mode===Ki?128:0)+(e.mode===Sl||e.mode===_h?256:0),(f===0&&d===0||t===md)&&B===Vs&&(B=zw),B},Vw=n=>{if(Ks(n))return oi;let t=n.state;return t.window&&(t.window=null),n.state=null,Vs},Zw=(n,t)=>{if(Ks(n))return oi;const e=n.state;return(e.wrap&2)===0?oi:(e.head=t,t.done=!1,Vs)},Kw=(n,t)=>{const e=t.length;let i,r,s;return Ks(n)||(i=n.state,i.wrap!==0&&i.mode!==pc)?oi:i.mode===pc&&(r=1,r=fu(r,t,e,0),r!==i.check)?m2:(s=A2(n,t,e,e),s?(i.mode=w2,b2):(i.havedict=1,Vs))};var Qw=k2,Jw=_2,tv=x2,ev=Gw,nv=S2,rv=Yw,iv=Vw,sv=Zw,ov=Kw,av="pako inflate (from Nodeca project)",ts={inflateReset:Qw,inflateReset2:Jw,inflateResetKeep:tv,inflateInit:ev,inflateInit2:nv,inflate:rv,inflateEnd:iv,inflateGetHeader:sv,inflateSetDictionary:ov,inflateInfo:av};function lv(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var cv=lv;const C2=Object.prototype.toString,{Z_NO_FLUSH:hv,Z_FINISH:uv,Z_OK:Aa,Z_STREAM_END:Lh,Z_NEED_DICT:Mh,Z_STREAM_ERROR:fv,Z_DATA_ERROR:Ud,Z_MEM_ERROR:dv}=f2;function Da(n){this.options=d2.assign({chunkSize:1024*64,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(n&&n.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Mw,this.strm.avail_out=0;let e=ts.inflateInit2(this.strm,t.windowBits);if(e!==Aa)throw new Error(du[e]);if(this.header=new cv,ts.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=pu.string2buf(t.dictionary):C2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=ts.inflateSetDictionary(this.strm,t.dictionary),e!==Aa)))throw new Error(du[e])}Da.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(t===~~t?a=t:a=t===!0?uv:hv,C2.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),s=ts.inflate(e,a),s===Mh&&r&&(s=ts.inflateSetDictionary(e,r),s===Aa?s=ts.inflate(e,a):s===Ud&&(s=Mh));e.avail_in>0&&s===Lh&&e.state.wrap>0&&n[e.next_in]!==0;)ts.inflateReset(e),s=ts.inflate(e,a);switch(s){case fv:case Ud:case Mh:case dv:return this.onEnd(s),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||s===Lh))if(this.options.to==="string"){let l=pu.utf8border(e.output,e.next_out),c=e.next_out-l,h=pu.buf2string(e.output,l);e.next_out=c,e.avail_out=i-c,c&&e.output.set(e.output.subarray(l,l+c),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(s===Aa&&o===0)){if(s===Lh)return s=ts.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Da.prototype.onData=function(n){this.chunks.push(n)};Da.prototype.onEnd=function(n){n===Aa&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d2.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};function pv(n,t){const e=new Da(t);if(e.push(n),e.err)throw e.msg||du[e.err];return e.result}var gv=Da,yv=pv,mv={Inflate:gv,inflate:yv};const{Inflate:bv,inflate:wv}=mv;var Wd=bv,vv=wv;const L2=[];for(let n=0;n<256;n++){let t=n;for(let e=0;e<8;e++)t&1?t=3988292384^t>>>1:t=t>>>1;L2[n]=t}const qd=4294967295;function xv(n,t,e){let i=n;for(let r=0;r<e;r++)i=L2[(i^t[r])&255]^i>>>8;return i}function kv(n,t){return(xv(qd,n,t)^qd)>>>0}function Xd(n,t,e){const i=n.readUint32(),r=kv(new Uint8Array(n.buffer,n.byteOffset+n.offset-t-4,t),t);if(r!==i)throw new Error(`CRC mismatch for chunk ${e}. Expected ${i}, found ${r}`)}function M2(n,t,e){for(let i=0;i<e;i++)t[i]=n[i]}function N2(n,t,e,i){let r=0;for(;r<i;r++)t[r]=n[r];for(;r<e;r++)t[r]=n[r]+t[r-i]&255}function P2(n,t,e,i){let r=0;if(e.length===0)for(;r<i;r++)t[r]=n[r];else for(;r<i;r++)t[r]=n[r]+e[r]&255}function I2(n,t,e,i,r){let s=0;if(e.length===0){for(;s<r;s++)t[s]=n[s];for(;s<i;s++)t[s]=n[s]+(t[s-r]>>1)&255}else{for(;s<r;s++)t[s]=n[s]+(e[s]>>1)&255;for(;s<i;s++)t[s]=n[s]+(t[s-r]+e[s]>>1)&255}}function O2(n,t,e,i,r){let s=0;if(e.length===0){for(;s<r;s++)t[s]=n[s];for(;s<i;s++)t[s]=n[s]+t[s-r]&255}else{for(;s<r;s++)t[s]=n[s]+e[s]&255;for(;s<i;s++)t[s]=n[s]+_v(t[s-r],e[s],e[s-r])&255}}function _v(n,t,e){const i=n+t-e,r=Math.abs(i-n),s=Math.abs(i-t),a=Math.abs(i-e);return r<=s&&r<=a?n:s<=a?t:e}function Sv(n,t,e,i,r,s){switch(n){case 0:M2(t,e,r);break;case 1:N2(t,e,r,s);break;case 2:P2(t,e,i,r);break;case 3:I2(t,e,i,r,s);break;case 4:O2(t,e,i,r,s);break;default:throw new Error(`Unsupported filter: ${n}`)}}const Av=new Uint16Array([255]),Cv=new Uint8Array(Av.buffer),Lv=Cv[0]===255;function Mv(n){const{data:t,width:e,height:i,channels:r,depth:s}=n,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(s/8)*r,l=new Uint8Array(i*e*o);let c=0;for(let h=0;h<7;h++){const f=a[h],d=Math.ceil((e-f.x)/f.xStep),u=Math.ceil((i-f.y)/f.yStep);if(d<=0||u<=0)continue;const y=d*o,g=new Uint8Array(y);for(let w=0;w<u;w++){const m=t[c++],x=t.subarray(c,c+y);c+=y;const _=new Uint8Array(y);Sv(m,x,_,g,y,o),g.set(_);for(let L=0;L<d;L++){const T=f.x+L*f.xStep,q=f.y+w*f.yStep;if(!(T>=e||q>=i))for(let U=0;U<o;U++)l[(q*e+T)*o+U]=_[L*o+U]}}}if(s===16){const h=new Uint16Array(l.buffer);if(Lv)for(let f=0;f<h.length;f++)h[f]=Nv(h[f]);return h}else return l}function Nv(n){return(n&255)<<8|n>>8&255}const Pv=new Uint16Array([255]),Iv=new Uint8Array(Pv.buffer),Ov=Iv[0]===255,Rv=new Uint8Array(0);function Gd(n){const{data:t,width:e,height:i,channels:r,depth:s}=n,a=Math.ceil(s/8)*r,o=Math.ceil(s/8*r*e),l=new Uint8Array(i*o);let c=Rv,h=0,f,d;for(let u=0;u<i;u++){switch(f=t.subarray(h+1,h+1+o),d=l.subarray(u*o,(u+1)*o),t[h]){case 0:M2(f,d,o);break;case 1:N2(f,d,o,a);break;case 2:P2(f,d,c,o);break;case 3:I2(f,d,c,o,a);break;case 4:O2(f,d,c,o,a);break;default:throw new Error(`Unsupported filter: ${t[h]}`)}c=d,h+=o+1}if(s===16){const u=new Uint16Array(l.buffer);if(Ov)for(let y=0;y<u.length;y++)u[y]=Tv(u[y]);return u}else return l}function Tv(n){return(n&255)<<8|n>>8&255}const jl=Uint8Array.of(137,80,78,71,13,10,26,10);function Hd(n){if(!Bv(n.readBytes(jl.length)))throw new Error("wrong PNG signature")}function Bv(n){if(n.length<jl.length)return!1;for(let t=0;t<jl.length;t++)if(n[t]!==jl[t])return!1;return!0}const Ev="tEXt",Dv=0,R2=new TextDecoder("latin1");function Fv(n){if(zv(n),n.length===0||n.length>79)throw new Error("keyword length must be between 1 and 79")}const $v=/^[\\u0000-\\u00FF]*$/;function zv(n){if(!$v.test(n))throw new Error("invalid latin1 text")}function jv(n,t,e){const i=T2(t);n[i]=Uv(t,e-i.length-1)}function T2(n){for(n.mark();n.readByte()!==Dv;);const t=n.offset;n.reset();const e=R2.decode(n.readBytes(t-n.offset-1));return n.skip(1),Fv(e),e}function Uv(n,t){return R2.decode(n.readBytes(t))}const Kr={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},Nh={UNKNOWN:-1,DEFLATE:0},Yd={UNKNOWN:-1,ADAPTIVE:0},Ph={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Cl={NONE:0,BACKGROUND:1,PREVIOUS:2},Ih={SOURCE:0,OVER:1};class Wv extends Eu{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(t,e={}){super(t);const{checkCrc:i=!1}=e;this._checkCrc=i,this._inflator=new Wd,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=Nh.UNKNOWN,this._filterMethod=Yd.UNKNOWN,this._interlaceMethod=Ph.UNKNOWN,this._colorType=Kr.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Hd(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeChunk(t,e)}return this.decodeImage(),this._png}decodeApng(){for(Hd(this);!this._end;){const t=this.readUint32(),e=this.readChars(4);this.decodeApngChunk(t,e)}return this.decodeApngImage(),this._apng}decodeChunk(t,e){const i=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case Ev:jv(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t);break}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?Xd(this,t+4,e):this.skip(4)}decodeApngChunk(t,e){const i=this.offset;switch(e!=="fdAT"&&e!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),e){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(t);break;default:this.decodeChunk(t,e),this.offset=i+t;break}if(this.offset-i!==t)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?Xd(this,t+4,e):this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=qv(this.readUint8());const e=this.readUint8();this._colorType=e;let i;switch(e){case Kr.GREYSCALE:i=1;break;case Kr.TRUECOLOUR:i=3;break;case Kr.INDEXED_COLOUR:i=1;break;case Kr.GREYSCALE_ALPHA:i=2;break;case Kr.TRUECOLOUR_ALPHA:i=4;break;case Kr.UNKNOWN:default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==Nh.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const t={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(t)}decodePLTE(t){if(t%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);const e=t/3;this._hasPalette=!0;const i=[];this._palette=i;for(let r=0;r<e;r++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._writingDataChunks=!0;const e=t,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodeFDAT(t){this._writingDataChunks=!0;let e=t,i=this.offset+this.byteOffset;if(i+=4,e-=4,this._inflator.push(new Uint8Array(this.buffer,i,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodetRNS(t){switch(this._colorType){case Kr.GREYSCALE:case Kr.TRUECOLOUR:{if(t%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break}case Kr.INDEXED_COLOUR:{if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const i=this.readByte();this._palette[e].push(i)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}case Kr.UNKNOWN:case Kr.GREYSCALE_ALPHA:case Kr.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){const e=T2(this),i=this.readUint8();if(i!==Nh.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const r=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:vv(r)}}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),i=this.readByte();this._png.resolution={x:t,y:e,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let t=0;t<this._numberOfFrames;t++){const e={sequenceNumber:this._frames[t].sequenceNumber,delayNumber:this._frames[t].delayNumber,delayDenominator:this._frames[t].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(t);if(i){if(i.data=Gd({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),t===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)e.data=i.data;else{const r=this._apng.frames.at(t-1);this.disposeFrame(i,r,e),this.addFrameDataToCanvas(e,i)}this._apng.frames.push(e)}}return this._apng}disposeFrame(t,e,i){switch(t.disposeOp){case Cl.NONE:break;case Cl.BACKGROUND:for(let r=0;r<this._png.height;r++)for(let s=0;s<this._png.width;s++){const a=(r*t.width+s)*this._png.channels;for(let o=0;o<this._png.channels;o++)i.data[a+o]=0}break;case Cl.PREVIOUS:i.data.set(e.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(t,e){const i=1<<this._png.depth,r=(s,a)=>{const o=((s+e.yOffset)*this._png.width+e.xOffset+a)*this._png.channels,l=(s*e.width+a)*this._png.channels;return{index:o,frameIndex:l}};switch(e.blendOp){case Ih.SOURCE:for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++){const{index:o,frameIndex:l}=r(s,a);for(let c=0;c<this._png.channels;c++)t.data[o+c]=e.data[l+c]}break;case Ih.OVER:for(let s=0;s<e.height;s++)for(let a=0;a<e.width;a++){const{index:o,frameIndex:l}=r(s,a);for(let c=0;c<this._png.channels;c++){const h=e.data[l+this._png.channels-1]/i,f=c%(this._png.channels-1)===0?1:e.data[l+c],d=Math.floor(h*f+(1-h)*t.data[o+c]);t.data[o+c]+=d}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const t=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==Yd.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===Ph.NO_INTERLACE)this._png.data=Gd({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===Ph.ADAM7)this._png.data=Mv({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const t=this._inflator.result,e=this._frames.at(-1);e?e.data=t:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Cl.NONE,blendOp:Ih.SOURCE,data:t}),this._inflator=new Wd,this._writingDataChunks=!1}}function qv(n){if(n!==1&&n!==2&&n!==4&&n!==8&&n!==16)throw new Error(`invalid bit depth: ${n}`);return n}var Vd;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.METRE=1]="METRE"})(Vd||(Vd={}));function Xv(n,t){return new Wv(n,t).decode()}var Ye=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function Oh(){Ye.console&&typeof Ye.console.log=="function"&&Ye.console.log.apply(Ye.console,arguments)}var Pn={log:Oh,warn:function(n){Ye.console&&(typeof Ye.console.warn=="function"?Ye.console.warn.apply(Ye.console,arguments):Oh.call(null,arguments))},error:function(n){Ye.console&&(typeof Ye.console.error=="function"?Ye.console.error.apply(Ye.console,arguments):Oh(n))}};function Rh(n,t,e){var i=new XMLHttpRequest;i.open("GET",n),i.responseType="blob",i.onload=function(){Us(i.response,t,e)},i.onerror=function(){Pn.error("could not download file")},i.send()}function Zd(n){var t=new XMLHttpRequest;t.open("HEAD",n,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Ll(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(t)}}var Us=Ye.saveAs||((typeof window>"u"?"undefined":An(window))!=="object"||window!==Ye?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(n,t,e){var i=Ye.URL||Ye.webkitURL,r=document.createElement("a");t=t||n.name||"download",r.download=t,r.rel="noopener",typeof n=="string"?(r.href=n,r.origin!==location.origin?Zd(r.href)?Rh(n,t,e):Ll(r,r.target="_blank"):Ll(r)):(r.href=i.createObjectURL(n),setTimeout(function(){i.revokeObjectURL(r.href)},4e4),setTimeout(function(){Ll(r)},0))}:"msSaveOrOpenBlob"in navigator?function(n,t,e){if(t=t||n.name||"download",typeof n=="string")if(Zd(n))Rh(n,t,e);else{var i=document.createElement("a");i.href=n,i.target="_blank",setTimeout(function(){Ll(i)})}else navigator.msSaveOrOpenBlob((function(r,s){return s===void 0?s={autoBom:!1}:An(s)!=="object"&&(Pn.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(r.type)?new Blob(["\\uFEFF",r],{type:r.type}):r})(n,e),t)}:function(n,t,e,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof n=="string")return Rh(n,t,e);var r=n.type==="application/octet-stream",s=/constructor/i.test(Ye.HTMLElement)||Ye.safari,a=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((a||r&&s)&&(typeof FileReader>"u"?"undefined":An(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var h=o.result;h=a?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=h:location=h,i=null},o.readAsDataURL(n)}else{var l=Ye.URL||Ye.webkitURL,c=l.createObjectURL(n);i?i.location=c:location.href=c,i=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});function B2(n){var t;n=n||"",this.ok=!1,n.charAt(0)=="#"&&(n=n.substr(1,6)),n={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[n=(n=n.replace(/ /g,"")).toLowerCase()]||n;for(var e=[{re:/^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\\w{2})(\\w{2})(\\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\\w{1})(\\w{1})(\\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],i=0;i<e.length;i++){var r=e[i].re,s=e[i].process,a=r.exec(n);a&&(t=s(a),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),l=this.g.toString(16),c=this.b.toString(16);return o.length==1&&(o="0"+o),l.length==1&&(l="0"+l),c.length==1&&(c="0"+c),"#"+o+l+c}}var Ul=Ye.atob.bind(Ye),Kd=Ye.btoa.bind(Ye);function Th(n,t){var e=n[0],i=n[1],r=n[2],s=n[3];e=xr(e,i,r,s,t[0],7,-680876936),s=xr(s,e,i,r,t[1],12,-389564586),r=xr(r,s,e,i,t[2],17,606105819),i=xr(i,r,s,e,t[3],22,-1044525330),e=xr(e,i,r,s,t[4],7,-176418897),s=xr(s,e,i,r,t[5],12,1200080426),r=xr(r,s,e,i,t[6],17,-1473231341),i=xr(i,r,s,e,t[7],22,-45705983),e=xr(e,i,r,s,t[8],7,1770035416),s=xr(s,e,i,r,t[9],12,-1958414417),r=xr(r,s,e,i,t[10],17,-42063),i=xr(i,r,s,e,t[11],22,-1990404162),e=xr(e,i,r,s,t[12],7,1804603682),s=xr(s,e,i,r,t[13],12,-40341101),r=xr(r,s,e,i,t[14],17,-1502002290),e=kr(e,i=xr(i,r,s,e,t[15],22,1236535329),r,s,t[1],5,-165796510),s=kr(s,e,i,r,t[6],9,-1069501632),r=kr(r,s,e,i,t[11],14,643717713),i=kr(i,r,s,e,t[0],20,-373897302),e=kr(e,i,r,s,t[5],5,-701558691),s=kr(s,e,i,r,t[10],9,38016083),r=kr(r,s,e,i,t[15],14,-660478335),i=kr(i,r,s,e,t[4],20,-405537848),e=kr(e,i,r,s,t[9],5,568446438),s=kr(s,e,i,r,t[14],9,-1019803690),r=kr(r,s,e,i,t[3],14,-187363961),i=kr(i,r,s,e,t[8],20,1163531501),e=kr(e,i,r,s,t[13],5,-1444681467),s=kr(s,e,i,r,t[2],9,-51403784),r=kr(r,s,e,i,t[7],14,1735328473),e=_r(e,i=kr(i,r,s,e,t[12],20,-1926607734),r,s,t[5],4,-378558),s=_r(s,e,i,r,t[8],11,-2022574463),r=_r(r,s,e,i,t[11],16,1839030562),i=_r(i,r,s,e,t[14],23,-35309556),e=_r(e,i,r,s,t[1],4,-1530992060),s=_r(s,e,i,r,t[4],11,1272893353),r=_r(r,s,e,i,t[7],16,-155497632),i=_r(i,r,s,e,t[10],23,-1094730640),e=_r(e,i,r,s,t[13],4,681279174),s=_r(s,e,i,r,t[0],11,-358537222),r=_r(r,s,e,i,t[3],16,-722521979),i=_r(i,r,s,e,t[6],23,76029189),e=_r(e,i,r,s,t[9],4,-640364487),s=_r(s,e,i,r,t[12],11,-421815835),r=_r(r,s,e,i,t[15],16,530742520),e=Sr(e,i=_r(i,r,s,e,t[2],23,-995338651),r,s,t[0],6,-198630844),s=Sr(s,e,i,r,t[7],10,1126891415),r=Sr(r,s,e,i,t[14],15,-1416354905),i=Sr(i,r,s,e,t[5],21,-57434055),e=Sr(e,i,r,s,t[12],6,1700485571),s=Sr(s,e,i,r,t[3],10,-1894986606),r=Sr(r,s,e,i,t[10],15,-1051523),i=Sr(i,r,s,e,t[1],21,-2054922799),e=Sr(e,i,r,s,t[8],6,1873313359),s=Sr(s,e,i,r,t[15],10,-30611744),r=Sr(r,s,e,i,t[6],15,-1560198380),i=Sr(i,r,s,e,t[13],21,1309151649),e=Sr(e,i,r,s,t[4],6,-145523070),s=Sr(s,e,i,r,t[11],10,-1120210379),r=Sr(r,s,e,i,t[2],15,718787259),i=Sr(i,r,s,e,t[9],21,-343485551),n[0]=xs(e,n[0]),n[1]=xs(i,n[1]),n[2]=xs(r,n[2]),n[3]=xs(s,n[3])}function Sc(n,t,e,i,r,s){return t=xs(xs(t,n),xs(i,s)),xs(t<<r|t>>>32-r,e)}function xr(n,t,e,i,r,s,a){return Sc(t&e|~t&i,n,t,r,s,a)}function kr(n,t,e,i,r,s,a){return Sc(t&i|e&~i,n,t,r,s,a)}function _r(n,t,e,i,r,s,a){return Sc(t^e^i,n,t,r,s,a)}function Sr(n,t,e,i,r,s,a){return Sc(e^(t|~i),n,t,r,s,a)}function E2(n){var t,e=n.length,i=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=n.length;t+=64)Th(i,Gv(n.substring(t-64,t)));n=n.substring(t-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<n.length;t++)r[t>>2]|=n.charCodeAt(t)<<(t%4<<3);if(r[t>>2]|=128<<(t%4<<3),t>55)for(Th(i,r),t=0;t<16;t++)r[t]=0;return r[14]=8*e,Th(i,r),i}function Gv(n){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=n.charCodeAt(t)+(n.charCodeAt(t+1)<<8)+(n.charCodeAt(t+2)<<16)+(n.charCodeAt(t+3)<<24);return e}var Qd="0123456789abcdef".split("");function Hv(n){for(var t="",e=0;e<4;e++)t+=Qd[n>>8*e+4&15]+Qd[n>>8*e&15];return t}function Yv(n){return String.fromCharCode(255&n,(65280&n)>>8,(16711680&n)>>16,(4278190080&n)>>24)}function gu(n){return E2(n).map(Yv).join("")}var Vv=(function(n){for(var t=0;t<n.length;t++)n[t]=Hv(n[t]);return n.join("")})(E2("hello"))!="5d41402abc4b2a76b9719d911017c592";function xs(n,t){if(Vv){var e=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(e>>16)<<16|65535&e}return n+t&4294967295}function yu(n,t){var e,i,r,s;if(n!==e){for(var a=(r=n,s=1+(256/n.length|0),new Array(s+1).join(r)),o=[],l=0;l<256;l++)o[l]=l;var c=0;for(l=0;l<256;l++){var h=o[l];c=(c+h+a.charCodeAt(l))%256,o[l]=o[c],o[c]=h}e=n,i=o}else o=i;var f=t.length,d=0,u=0,y="";for(l=0;l<f;l++)u=(u+(h=o[d=(d+1)%256]))%256,o[d]=o[u],o[u]=h,a=o[(o[d]+o[u])%256],y+=String.fromCharCode(t.charCodeAt(l)^a);return y}var Jd={print:4,modify:8,copy:16,"annot-forms":32};function yo(n,t,e,i){this.v=1,this.r=2;var r=192;n.forEach(function(o){if(Jd.perm!==void 0)throw new Error("Invalid permission: "+o);r+=Jd[o]}),this.padding="(N^NuAd\\0NV\\b..\\0h>/\\fdSiz";var s=(t+this.padding).substr(0,32),a=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^r)),this.encryptionKey=gu(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=yu(this.encryptionKey,this.padding)}function mo(n){if(/[^\\u0000-\\u00ff]/.test(n))throw new Error("Invalid PDF Name Object: "+n+", Only accept ASCII characters.");for(var t="",e=n.length,i=0;i<e;i++){var r=n.charCodeAt(i);t+=r<33||r===35||r===37||r===40||r===41||r===47||r===60||r===62||r===91||r===93||r===123||r===125||r>126?"#"+("0"+r.toString(16)).slice(-2):n[i]}return t}function tp(n){if(An(n)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,i,r){if(r=r||!1,typeof e!="string"||typeof i!="function"||typeof r!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var s=Math.random().toString(35);return t[e][s]=[i,!!r],s},this.unsubscribe=function(e){for(var i in t)if(t[i][e])return delete t[i][e],Object.keys(t[i]).length===0&&delete t[i],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var i=Array.prototype.slice.call(arguments,1),r=[];for(var s in t[e]){var a=t[e][s];try{a[0].apply(n,i)}catch(o){Ye.console&&Pn.error("jsPDF PubSub Error",o.message,o)}a[1]&&r.push(s)}r.length&&r.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function gc(n){if(!(this instanceof gc))return new gc(n);var t="opacity,stroke-opacity".split(",");for(var e in n)n.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=n[e]);this.id="",this.objectNumber=-1}function D2(n,t){this.gState=n,this.matrix=t,this.id="",this.objectNumber=-1}function Ws(n,t,e,i,r){if(!(this instanceof Ws))return new Ws(n,t,e,i,r);this.type=n==="axial"?2:3,this.coords=t,this.colors=e,D2.call(this,i,r)}function vo(n,t,e,i,r){if(!(this instanceof vo))return new vo(n,t,e,i,r);this.boundingBox=n,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,D2.call(this,i,r)}function De(n){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],r=arguments[2],s=arguments[3],a=[],o=1,l=16,c="S",h=null;An(n=n||{})==="object"&&(e=n.orientation,i=n.unit||i,r=n.format||r,s=n.compress||n.compressPdf||s,(h=n.encryption||null)!==null&&(h.userPassword=h.userPassword||"",h.ownerPassword=h.ownerPassword||"",h.userPermissions=h.userPermissions||[]),o=typeof n.userUnit=="number"?Math.abs(n.userUnit):1,n.precision!==void 0&&(t=n.precision),n.floatPrecision!==void 0&&(l=n.floatPrecision),c=n.defaultPathOperation||"S"),a=n.filters||(s===!0?["FlateEncode"]:a),i=i||"mm",e=(""+(e||"P")).toLowerCase();var f=n.putOnlyUsedFonts||!1,d={},u={internal:{},__private__:{}};u.__private__.PubSub=tp;var y="1.3",g=u.__private__.getPdfVersion=function(){return y};u.__private__.setPdfVersion=function(k){y=k};var w={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};u.__private__.getPageFormats=function(){return w};var m=u.__private__.getPageFormat=function(k){return w[k]};r=r||"a4";var x="compat",_="advanced",L=x;function T(){this.saveGraphicsState(),D(new lt(ze,0,0,-ze,0,Ns()*ze).toString()+" cm"),this.setFontSize(this.getFontSize()/ze),c="n",L=_}function q(){this.restoreGraphicsState(),c="S",L=x}var U=u.__private__.combineFontStyleAndFontWeight=function(k,E){if(k=="bold"&&E=="normal"||k=="bold"&&E==400||k=="normal"&&E=="italic"||k=="bold"&&E=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return E&&(k=E==400||E==="normal"?k==="italic"?"italic":"normal":E!=700&&E!=="bold"||k!=="normal"?(E==700?"bold":E)+""+k:"bold"),k};u.advancedAPI=function(k){var E=L===x;return E&&T.call(this),typeof k!="function"||(k(this),E&&q.call(this)),this},u.compatAPI=function(k){var E=L===_;return E&&q.call(this),typeof k!="function"||(k(this),E&&T.call(this)),this},u.isAdvancedAPI=function(){return L===_};var B,O=function(k){if(L!==_)throw new Error(k+" is only available in \'advanced\' API mode. You need to call advancedAPI() first.")},X=u.roundToPrecision=u.__private__.roundToPrecision=function(k,E){var st=t||E;if(isNaN(k)||isNaN(st))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return k.toFixed(st).replace(/0+$/,"")};B=u.hpf=u.__private__.hpf=typeof l=="number"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return X(k,l)}:l==="smart"?function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return X(k,k>-1&&k<1?16:5)}:function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.hpf");return X(k,16)};var R=u.f2=u.__private__.f2=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f2");return X(k,2)},M=u.__private__.f3=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.f3");return X(k,3)},$=u.scale=u.__private__.scale=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.scale");return L===x?k*ze:L===_?k:void 0},S=function(k){return $((function(E){return L===x?Ns()-E:L===_?E:void 0})(k))};u.__private__.setPrecision=u.setPrecision=function(k){typeof parseInt(k,10)=="number"&&(t=parseInt(k,10))};var J,mt="00000000000000000000000000000000",ot=u.__private__.getFileId=function(){return mt},ft=u.__private__.setFileId=function(k){return mt=k!==void 0&&/^[a-fA-F0-9]{32}$/.test(k)?k.toUpperCase():mt.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),h!==null&&(rn=new yo(h.userPermissions,h.userPassword,h.ownerPassword,mt)),mt};u.setFileId=function(k){return ft(k),this},u.getFileId=function(){return ot()};var ct=u.__private__.convertDateToPDFDate=function(k){var E=k.getTimezoneOffset(),st=E<0?"+":"-",ut=Math.floor(Math.abs(E/60)),St=Math.abs(E%60),Ht=[st,K(ut),"\'",K(St),"\'"].join("");return["D:",k.getFullYear(),K(k.getMonth()+1),K(k.getDate()),K(k.getHours()),K(k.getMinutes()),K(k.getSeconds()),Ht].join("")},Bt=u.__private__.convertPDFDateToDate=function(k){var E=parseInt(k.substr(2,4),10),st=parseInt(k.substr(6,2),10)-1,ut=parseInt(k.substr(8,2),10),St=parseInt(k.substr(10,2),10),Ht=parseInt(k.substr(12,2),10),Qt=parseInt(k.substr(14,2),10);return new Date(E,st,ut,St,Ht,Qt,0)},at=u.__private__.setCreationDate=function(k){var E;if(k===void 0&&(k=new Date),k instanceof Date)E=ct(k);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\\+0[0-9]|\\+1[0-4]|-0[0-9]|-1[0-1])\'(0[0-9]|[1-5][0-9])\'?$/.test(k))throw new Error("Invalid argument passed to jsPDF.setCreationDate");E=k}return J=E},P=u.__private__.getCreationDate=function(k){var E=J;return k==="jsDate"&&(E=Bt(J)),E};u.setCreationDate=function(k){return at(k),this},u.getCreationDate=function(k){return P(k)};var Y,K=u.__private__.padd2=function(k){return("0"+parseInt(k)).slice(-2)},et=u.__private__.padd2Hex=function(k){return("00"+(k=k.toString())).substr(k.length)},gt=0,kt=[],_t=[],Pt=0,jt=[],Zt=[],pe=!1,he=_t;u.__private__.setCustomOutputDestination=function(k){pe=!0,he=k};var I=function(k){pe||(he=k)};u.__private__.resetCustomOutputDestination=function(){pe=!1,he=_t};var D=u.__private__.out=function(k){return k=k.toString(),Pt+=k.length+1,he.push(k),he},pt=u.__private__.write=function(k){return D(arguments.length===1?k.toString():Array.prototype.join.call(arguments," "))},tt=u.__private__.getArrayBuffer=function(k){for(var E=k.length,st=new ArrayBuffer(E),ut=new Uint8Array(st);E--;)ut[E]=k.charCodeAt(E);return st},H=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];u.__private__.getStandardFonts=function(){return H};var nt=n.fontSize||16;u.__private__.setFontSize=u.setFontSize=function(k){return nt=L===_?k/ze:k,this};var Ct,It=u.__private__.getFontSize=u.getFontSize=function(){return L===x?nt:nt*ze},dt=n.R2L||!1;u.__private__.setR2L=u.setR2L=function(k){return dt=k,this},u.__private__.getR2L=u.getR2L=function(){return dt};var Et,ee=u.__private__.setZoomMode=function(k){if(/^(?:\\d+\\.\\d*|\\d*\\.\\d+|\\d+)%$/.test(k))Ct=k;else if(isNaN(k)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(k)===-1)throw new Error(\'zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "\'+k+\'" is not recognized.\');Ct=k}else Ct=parseInt(k,10)};u.__private__.getZoomMode=function(){return Ct};var Gt,re=u.__private__.setPageMode=function(k){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(k)==-1)throw new Error(\'Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "\'+k+\'" is not recognized.\');Et=k};u.__private__.getPageMode=function(){return Et};var ke=u.__private__.setLayoutMode=function(k){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(k)==-1)throw new Error(\'Layout mode must be one of continuous, single, twoleft, tworight. "\'+k+\'" is not recognized.\');Gt=k};u.__private__.getLayoutMode=function(){return Gt},u.__private__.setDisplayMode=u.setDisplayMode=function(k,E,st){return ee(k),ke(E),re(st),this};var me={title:"",subject:"",author:"",keywords:"",creator:""};u.__private__.getDocumentProperty=function(k){if(Object.keys(me).indexOf(k)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return me[k]},u.__private__.getDocumentProperties=function(){return me},u.__private__.setDocumentProperties=u.setProperties=u.setDocumentProperties=function(k){for(var E in me)me.hasOwnProperty(E)&&k[E]&&(me[E]=k[E]);return this},u.__private__.setDocumentProperty=function(k,E){if(Object.keys(me).indexOf(k)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return me[k]=E};var be,ze,ve,an,Ie,qe={},Xe={},cn=[],Te={},mn={},$e={},Ge={},vn=null,He=0,Ee=[],dn=new tp(u),Ii=n.hotfixes||[],ur={},v={},Z=[],lt=function k(E,st,ut,St,Ht,Qt){if(!(this instanceof k))return new k(E,st,ut,St,Ht,Qt);isNaN(E)&&(E=1),isNaN(st)&&(st=0),isNaN(ut)&&(ut=0),isNaN(St)&&(St=1),isNaN(Ht)&&(Ht=0),isNaN(Qt)&&(Qt=0),this._matrix=[E,st,ut,St,Ht,Qt]};Object.defineProperty(lt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(lt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(lt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(lt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(lt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(lt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(lt.prototype,"a",{get:function(){return this._matrix[0]},set:function(k){this._matrix[0]=k}}),Object.defineProperty(lt.prototype,"b",{get:function(){return this._matrix[1]},set:function(k){this._matrix[1]=k}}),Object.defineProperty(lt.prototype,"c",{get:function(){return this._matrix[2]},set:function(k){this._matrix[2]=k}}),Object.defineProperty(lt.prototype,"d",{get:function(){return this._matrix[3]},set:function(k){this._matrix[3]=k}}),Object.defineProperty(lt.prototype,"e",{get:function(){return this._matrix[4]},set:function(k){this._matrix[4]=k}}),Object.defineProperty(lt.prototype,"f",{get:function(){return this._matrix[5]},set:function(k){this._matrix[5]=k}}),Object.defineProperty(lt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(lt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(lt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(lt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),lt.prototype.join=function(k){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(B).join(k)},lt.prototype.multiply=function(k){var E=k.sx*this.sx+k.shy*this.shx,st=k.sx*this.shy+k.shy*this.sy,ut=k.shx*this.sx+k.sy*this.shx,St=k.shx*this.shy+k.sy*this.sy,Ht=k.tx*this.sx+k.ty*this.shx+this.tx,Qt=k.tx*this.shy+k.ty*this.sy+this.ty;return new lt(E,st,ut,St,Ht,Qt)},lt.prototype.decompose=function(){var k=this.sx,E=this.shy,st=this.shx,ut=this.sy,St=this.tx,Ht=this.ty,Qt=Math.sqrt(k*k+E*E),Le=(k/=Qt)*st+(E/=Qt)*ut;st-=k*Le,ut-=E*Le;var Oe=Math.sqrt(st*st+ut*ut);return Le/=Oe,k*(ut/=Oe)<E*(st/=Oe)&&(k=-k,E=-E,Le=-Le,Qt=-Qt),{scale:new lt(Qt,0,0,Oe,0,0),translate:new lt(1,0,0,1,St,Ht),rotate:new lt(k,E,-E,k,0,0),skew:new lt(1,0,Le,1,0,0)}},lt.prototype.toString=function(k){return this.join(" ")},lt.prototype.inversed=function(){var k=this.sx,E=this.shy,st=this.shx,ut=this.sy,St=this.tx,Ht=this.ty,Qt=1/(k*ut-E*st),Le=ut*Qt,Oe=-E*Qt,Ve=-st*Qt,en=k*Qt;return new lt(Le,Oe,Ve,en,-Le*St-Ve*Ht,-Oe*St-en*Ht)},lt.prototype.applyToPoint=function(k){var E=k.x*this.sx+k.y*this.shx+this.tx,st=k.x*this.shy+k.y*this.sy+this.ty;return new $i(E,st)},lt.prototype.applyToRectangle=function(k){var E=this.applyToPoint(k),st=this.applyToPoint(new $i(k.x+k.w,k.y+k.h));return new Do(E.x,E.y,st.x-E.x,st.y-E.y)},lt.prototype.clone=function(){var k=this.sx,E=this.shy,st=this.shx,ut=this.sy,St=this.tx,Ht=this.ty;return new lt(k,E,st,ut,St,Ht)},u.Matrix=lt;var ht=u.matrixMult=function(k,E){return E.multiply(k)},Nt=new lt(1,0,0,1,0,0);u.unitMatrix=u.identityMatrix=Nt;var vt=function(k,E){if(!mn[k]){var st=(E instanceof Ws?"Sh":"P")+(Object.keys(Te).length+1).toString(10);E.id=st,mn[k]=st,Te[st]=E,dn.publish("addPattern",E)}};u.ShadingPattern=Ws,u.TilingPattern=vo,u.addShadingPattern=function(k,E){return O("addShadingPattern()"),vt(k,E),this},u.beginTilingPattern=function(k){O("beginTilingPattern()"),Fo(k.boundingBox[0],k.boundingBox[1],k.boundingBox[2]-k.boundingBox[0],k.boundingBox[3]-k.boundingBox[1],k.matrix)},u.endTilingPattern=function(k,E){O("endTilingPattern()"),E.stream=Zt[Y].join(`\n`),vt(k,E),dn.publish("endTilingPattern",E),Z.pop().restore()};var z,Lt=u.__private__.newObject=function(){var k=Ut();return wt(k,!0),k},Ut=u.__private__.newObjectDeferred=function(){return gt++,kt[gt]=function(){return Pt},gt},wt=function(k,E){return E=typeof E=="boolean"&&E,kt[k]=Pt,E&&D(k+" 0 obj"),k},Ot=u.__private__.newAdditionalObject=function(){var k={objId:Ut(),content:""};return jt.push(k),k},zt=Ut(),Dt=Ut(),At=u.__private__.decodeColorString=function(k){var E=k.split(" ");if(E.length!==2||E[1]!=="g"&&E[1]!=="G")E.length!==5||E[4]!=="k"&&E[4]!=="K"||(E=[(1-E[0])*(1-E[3]),(1-E[1])*(1-E[3]),(1-E[2])*(1-E[3]),"r"]);else{var st=parseFloat(E[0]);E=[st,st,st,"r"]}for(var ut="#",St=0;St<3;St++)ut+=("0"+Math.floor(255*parseFloat(E[St])).toString(16)).slice(-2);return ut},Ft=u.__private__.encodeColorString=function(k){var E;typeof k=="string"&&(k={ch1:k});var st=k.ch1,ut=k.ch2,St=k.ch3,Ht=k.ch4,Qt=k.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof st=="string"&&st.charAt(0)!=="#"){var Le=new B2(st);if(Le.ok)st=Le.toHex();else if(!/^\\d*\\.?\\d*$/.test(st))throw new Error(\'Invalid color "\'+st+\'" passed to jsPDF.encodeColorString.\')}if(typeof st=="string"&&/^#[0-9A-Fa-f]{3}$/.test(st)&&(st="#"+st[1]+st[1]+st[2]+st[2]+st[3]+st[3]),typeof st=="string"&&/^#[0-9A-Fa-f]{6}$/.test(st)){var Oe=parseInt(st.substr(1),16);st=Oe>>16&255,ut=Oe>>8&255,St=255&Oe}if(ut===void 0||Ht===void 0&&st===ut&&ut===St)E=typeof st=="string"?st+" "+Qt[0]:k.precision===2?R(st/255)+" "+Qt[0]:M(st/255)+" "+Qt[0];else if(Ht===void 0||An(Ht)==="object"){if(Ht&&!isNaN(Ht.a)&&Ht.a===0)return["1.","1.","1.",Qt[1]].join(" ");E=typeof st=="string"?[st,ut,St,Qt[1]].join(" "):k.precision===2?[R(st/255),R(ut/255),R(St/255),Qt[1]].join(" "):[M(st/255),M(ut/255),M(St/255),Qt[1]].join(" ")}else E=typeof st=="string"?[st,ut,St,Ht,Qt[2]].join(" "):k.precision===2?[R(st),R(ut),R(St),R(Ht),Qt[2]].join(" "):[M(st),M(ut),M(St),M(Ht),Qt[2]].join(" ");return E},se=u.__private__.getFilters=function(){return a},te=u.__private__.putStream=function(k){var E=(k=k||{}).data||"",st=k.filters||se(),ut=k.alreadyAppliedFilters||[],St=k.addLength1||!1,Ht=E.length,Qt=k.objectId,Le=function(ir){return ir};if(h!==null&&Qt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");h!==null&&(Le=rn.encryptor(Qt,0));var Oe={};st===!0&&(st=["FlateEncode"]);var Ve=k.additionalKeyValues||[],en=(Oe=De.API.processDataByFilters!==void 0?De.API.processDataByFilters(E,st):{data:E,reverseChain:[]}).reverseChain+(Array.isArray(ut)?ut.join(" "):ut.toString());if(Oe.data.length!==0&&(Ve.push({key:"Length",value:Oe.data.length}),St===!0&&Ve.push({key:"Length1",value:Ht})),en.length!=0)if(en.split("/").length-1==1)Ve.push({key:"Filter",value:en});else{Ve.push({key:"Filter",value:"["+en+"]"});for(var pn=0;pn<Ve.length;pn+=1)if(Ve[pn].key==="DecodeParms"){for(var jn=[],er=0;er<Oe.reverseChain.split("/").length-1;er+=1)jn.push("null");jn.push(Ve[pn].value),Ve[pn].value="["+jn.join(" ")+"]"}}D("<<");for(var On=0;On<Ve.length;On++)D("/"+Ve[On].key+" "+Ve[On].value);D(">>"),Oe.data.length!==0&&(D("stream"),D(Le(Oe.data)),D("endstream"))},ae=u.__private__.putPage=function(k){var E=k.number,st=k.data,ut=k.objId,St=k.contentsObjId;wt(ut,!0),D("<</Type /Page"),D("/Parent "+k.rootDictionaryObjId+" 0 R"),D("/Resources "+k.resourceDictionaryObjId+" 0 R"),D("/MediaBox ["+parseFloat(B(k.mediaBox.bottomLeftX))+" "+parseFloat(B(k.mediaBox.bottomLeftY))+" "+B(k.mediaBox.topRightX)+" "+B(k.mediaBox.topRightY)+"]"),k.cropBox!==null&&D("/CropBox ["+B(k.cropBox.bottomLeftX)+" "+B(k.cropBox.bottomLeftY)+" "+B(k.cropBox.topRightX)+" "+B(k.cropBox.topRightY)+"]"),k.bleedBox!==null&&D("/BleedBox ["+B(k.bleedBox.bottomLeftX)+" "+B(k.bleedBox.bottomLeftY)+" "+B(k.bleedBox.topRightX)+" "+B(k.bleedBox.topRightY)+"]"),k.trimBox!==null&&D("/TrimBox ["+B(k.trimBox.bottomLeftX)+" "+B(k.trimBox.bottomLeftY)+" "+B(k.trimBox.topRightX)+" "+B(k.trimBox.topRightY)+"]"),k.artBox!==null&&D("/ArtBox ["+B(k.artBox.bottomLeftX)+" "+B(k.artBox.bottomLeftY)+" "+B(k.artBox.topRightX)+" "+B(k.artBox.topRightY)+"]"),typeof k.userUnit=="number"&&k.userUnit!==1&&D("/UserUnit "+k.userUnit),dn.publish("putPage",{objId:ut,pageContext:Ee[E],pageNumber:E,page:st}),D("/Contents "+St+" 0 R"),D(">>"),D("endobj");var Ht=st.join(`\n`);return L===_&&(Ht+=`\nQ`),wt(St,!0),te({data:Ht,filters:se(),objectId:St}),D("endobj"),ut},$t=u.__private__.putPages=function(){var k,E,st=[];for(k=1;k<=He;k++)Ee[k].objId=Ut(),Ee[k].contentsObjId=Ut();for(k=1;k<=He;k++)st.push(ae({number:k,data:Zt[k],objId:Ee[k].objId,contentsObjId:Ee[k].contentsObjId,mediaBox:Ee[k].mediaBox,cropBox:Ee[k].cropBox,bleedBox:Ee[k].bleedBox,trimBox:Ee[k].trimBox,artBox:Ee[k].artBox,userUnit:Ee[k].userUnit,rootDictionaryObjId:zt,resourceDictionaryObjId:Dt}));wt(zt,!0),D("<</Type /Pages");var ut="/Kids [";for(E=0;E<He;E++)ut+=st[E]+" 0 R ";D(ut+"]"),D("/Count "+He),D(">>"),D("endobj"),dn.publish("postPutPages")},le=function(k){dn.publish("putFont",{font:k,out:D,newObject:Lt,putStream:te}),k.isAlreadyPutted!==!0&&(k.objectNumber=Lt(),D("<<"),D("/Type /Font"),D("/BaseFont /"+mo(k.postScriptName)),D("/Subtype /Type1"),typeof k.encoding=="string"&&D("/Encoding /"+k.encoding),D("/FirstChar 32"),D("/LastChar 255"),D(">>"),D("endobj"))},Pe=function(k){k.objectNumber=Lt();var E=[];E.push({key:"Type",value:"/XObject"}),E.push({key:"Subtype",value:"/Form"}),E.push({key:"BBox",value:"["+[B(k.x),B(k.y),B(k.x+k.width),B(k.y+k.height)].join(" ")+"]"}),E.push({key:"Matrix",value:"["+k.matrix.toString()+"]"});var st=k.pages[1].join(`\n`);te({data:st,additionalKeyValues:E,objectId:k.objectNumber}),D("endobj")},Fe=function(k,E){E||(E=21);var st=Lt(),ut=(function(Qt,Le){var Oe,Ve=[],en=1/(Le-1);for(Oe=0;Oe<1;Oe+=en)Ve.push(Oe);if(Ve.push(1),Qt[0].offset!=0){var pn={offset:0,color:Qt[0].color};Qt.unshift(pn)}if(Qt[Qt.length-1].offset!=1){var jn={offset:1,color:Qt[Qt.length-1].color};Qt.push(jn)}for(var er="",On=0,ir=0;ir<Ve.length;ir++){for(Oe=Ve[ir];Oe>Qt[On+1].offset;)On++;var nr=Qt[On].offset,gr=(Oe-nr)/(Qt[On+1].offset-nr),Ui=Qt[On].color,fi=Qt[On+1].color;er+=et(Math.round((1-gr)*Ui[0]+gr*fi[0]).toString(16))+et(Math.round((1-gr)*Ui[1]+gr*fi[1]).toString(16))+et(Math.round((1-gr)*Ui[2]+gr*fi[2]).toString(16))}return er.trim()})(k.colors,E),St=[];St.push({key:"FunctionType",value:"0"}),St.push({key:"Domain",value:"[0.0 1.0]"}),St.push({key:"Size",value:"["+E+"]"}),St.push({key:"BitsPerSample",value:"8"}),St.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),St.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),te({data:ut,additionalKeyValues:St,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:st}),D("endobj"),k.objectNumber=Lt(),D("<< /ShadingType "+k.type),D("/ColorSpace /DeviceRGB");var Ht="/Coords ["+B(parseFloat(k.coords[0]))+" "+B(parseFloat(k.coords[1]))+" ";k.type===2?Ht+=B(parseFloat(k.coords[2]))+" "+B(parseFloat(k.coords[3])):Ht+=B(parseFloat(k.coords[2]))+" "+B(parseFloat(k.coords[3]))+" "+B(parseFloat(k.coords[4]))+" "+B(parseFloat(k.coords[5])),D(Ht+="]"),k.matrix&&D("/Matrix ["+k.matrix.toString()+"]"),D("/Function "+st+" 0 R"),D("/Extend [true true]"),D(">>"),D("endobj")},Yt=function(k,E){var st=Ut(),ut=Lt();E.push({resourcesOid:st,objectOid:ut}),k.objectNumber=ut;var St=[];St.push({key:"Type",value:"/Pattern"}),St.push({key:"PatternType",value:"1"}),St.push({key:"PaintType",value:"1"}),St.push({key:"TilingType",value:"1"}),St.push({key:"BBox",value:"["+k.boundingBox.map(B).join(" ")+"]"}),St.push({key:"XStep",value:B(k.xStep)}),St.push({key:"YStep",value:B(k.yStep)}),St.push({key:"Resources",value:st+" 0 R"}),k.matrix&&St.push({key:"Matrix",value:"["+k.matrix.toString()+"]"}),te({data:k.stream,additionalKeyValues:St,objectId:k.objectNumber}),D("endobj")},we=function(k){for(var E in k.objectNumber=Lt(),D("<<"),k)switch(E){case"opacity":D("/ca "+R(k[E]));break;case"stroke-opacity":D("/CA "+R(k[E]))}D(">>"),D("endobj")},yt=function(k){wt(k.resourcesOid,!0),D("<<"),D("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var E in D("/Font <<"),qe)qe.hasOwnProperty(E)&&(f===!1||f===!0&&d.hasOwnProperty(E))&&D("/"+E+" "+qe[E].objectNumber+" 0 R");D(">>")})(),(function(){if(Object.keys(Te).length>0){for(var E in D("/Shading <<"),Te)Te.hasOwnProperty(E)&&Te[E]instanceof Ws&&Te[E].objectNumber>=0&&D("/"+E+" "+Te[E].objectNumber+" 0 R");dn.publish("putShadingPatternDict"),D(">>")}})(),(function(E){if(Object.keys(Te).length>0){for(var st in D("/Pattern <<"),Te)Te.hasOwnProperty(st)&&Te[st]instanceof u.TilingPattern&&Te[st].objectNumber>=0&&Te[st].objectNumber<E&&D("/"+st+" "+Te[st].objectNumber+" 0 R");dn.publish("putTilingPatternDict"),D(">>")}})(k.objectOid),(function(){if(Object.keys($e).length>0){var E;for(E in D("/ExtGState <<"),$e)$e.hasOwnProperty(E)&&$e[E].objectNumber>=0&&D("/"+E+" "+$e[E].objectNumber+" 0 R");dn.publish("putGStateDict"),D(">>")}})(),(function(){for(var E in D("/XObject <<"),ur)ur.hasOwnProperty(E)&&ur[E].objectNumber>=0&&D("/"+E+" "+ur[E].objectNumber+" 0 R");dn.publish("putXobjectDict"),D(">>")})(),D(">>"),D("endobj")},Wt=function(k){Xe[k.fontName]=Xe[k.fontName]||{},Xe[k.fontName][k.fontStyle]=k.id},Q=function(k,E,st,ut,St){var Ht={id:"F"+(Object.keys(qe).length+1).toString(10),postScriptName:k,fontName:E,fontStyle:st,encoding:ut,isStandardFont:St||!1,metadata:{}};return dn.publish("addFont",{font:Ht,instance:this}),qe[Ht.id]=Ht,Wt(Ht),Ht.id},ue=u.__private__.pdfEscape=u.pdfEscape=function(k,E){return(function(st,ut){var St,Ht,Qt,Le,Oe,Ve,en,pn,jn;if(Qt=(ut=ut||{}).sourceEncoding||"Unicode",Oe=ut.outputEncoding,(ut.autoencode||Oe)&&qe[be].metadata&&qe[be].metadata[Qt]&&qe[be].metadata[Qt].encoding&&(Le=qe[be].metadata[Qt].encoding,!Oe&&qe[be].encoding&&(Oe=qe[be].encoding),!Oe&&Le.codePages&&(Oe=Le.codePages[0]),typeof Oe=="string"&&(Oe=Le[Oe]),Oe)){for(en=!1,Ve=[],St=0,Ht=st.length;St<Ht;St++)(pn=Oe[st.charCodeAt(St)])?Ve.push(String.fromCharCode(pn)):Ve.push(st[St]),Ve[St].charCodeAt(0)>>8&&(en=!0);st=Ve.join("")}for(St=st.length;en===void 0&&St!==0;)st.charCodeAt(St-1)>>8&&(en=!0),St--;if(!en)return st;for(Ve=ut.noBOM?[]:[254,255],St=0,Ht=st.length;St<Ht;St++){if((jn=(pn=st.charCodeAt(St))>>8)>>8)throw new Error("Character at position "+St+" of string \'"+st+"\' exceeds 16bits. Cannot be encoded into UCS-2 BE");Ve.push(jn),Ve.push(pn-(jn<<8))}return String.fromCharCode.apply(void 0,Ve)})(k,E).replace(/\\\\/g,"\\\\\\\\").replace(/\\(/g,"\\\\(").replace(/\\)/g,"\\\\)")},fe=u.__private__.beginPage=function(k){Zt[++He]=[],Ee[He]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(k[0]),topRightY:Number(k[1])}},Qe(He),I(Zt[Y])},xe=function(k,E){var st,ut,St;switch(e=E||e,typeof k=="string"&&(st=m(k.toLowerCase()),Array.isArray(st)&&(ut=st[0],St=st[1])),Array.isArray(k)&&(ut=k[0]*ze,St=k[1]*ze),isNaN(ut)&&(ut=r[0],St=r[1]),(ut>14400||St>14400)&&(Pn.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),ut=Math.min(14400,ut),St=Math.min(14400,St)),r=[ut,St],e.substr(0,1)){case"l":St>ut&&(r=[St,ut]);break;case"p":ut>St&&(r=[St,ut])}fe(r),Ke(Ro),D(Js),Bo!==0&&D(Bo+" J"),Eo!==0&&D(Eo+" j"),dn.publish("addPage",{pageNumber:He})},Ze=function(k){k>0&&k<=He&&(Zt.splice(k,1),Ee.splice(k,1),He--,Y>He&&(Y=He),this.setPage(Y))},Qe=function(k){k>0&&k<=He&&(Y=k)},ie=u.__private__.getNumberOfPages=u.getNumberOfPages=function(){return Zt.length-1},Se=function(k,E,st){var ut,St=void 0;return st=st||{},k=k!==void 0?k:qe[be].fontName,E=E!==void 0?E:qe[be].fontStyle,ut=k.toLowerCase(),Xe[ut]!==void 0&&Xe[ut][E]!==void 0?St=Xe[ut][E]:Xe[k]!==void 0&&Xe[k][E]!==void 0?St=Xe[k][E]:st.disableWarning===!1&&Pn.warn("Unable to look up font label for font \'"+k+"\', \'"+E+"\'. Refer to getFontList() for available fonts."),St||st.noFallback||(St=Xe.times[E])==null&&(St=Xe.times.normal),St},Ae=u.__private__.putInfo=function(){var k=Lt(),E=function(ut){return ut};for(var st in h!==null&&(E=rn.encryptor(k,0)),D("<<"),D("/Producer ("+ue(E("jsPDF "+De.version))+")"),me)me.hasOwnProperty(st)&&me[st]&&D("/"+st.substr(0,1).toUpperCase()+st.substr(1)+" ("+ue(E(me[st]))+")");D("/CreationDate ("+ue(E(J))+")"),D(">>"),D("endobj")},je=u.__private__.putCatalog=function(k){var E=(k=k||{}).rootDictionaryObjId||zt;switch(Lt(),D("<<"),D("/Type /Catalog"),D("/Pages "+E+" 0 R"),Ct||(Ct="fullwidth"),Ct){case"fullwidth":D("/OpenAction [3 0 R /FitH null]");break;case"fullheight":D("/OpenAction [3 0 R /FitV null]");break;case"fullpage":D("/OpenAction [3 0 R /Fit]");break;case"original":D("/OpenAction [3 0 R /XYZ null null 1]");break;default:var st=""+Ct;st.substr(st.length-1)==="%"&&(Ct=parseInt(Ct)/100),typeof Ct=="number"&&D("/OpenAction [3 0 R /XYZ null null "+R(Ct)+"]")}switch(Gt||(Gt="continuous"),Gt){case"continuous":D("/PageLayout /OneColumn");break;case"single":D("/PageLayout /SinglePage");break;case"two":case"twoleft":D("/PageLayout /TwoColumnLeft");break;case"tworight":D("/PageLayout /TwoColumnRight")}Et&&D("/PageMode /"+Et),dn.publish("putCatalog"),D(">>"),D("endobj")},xn=u.__private__.putTrailer=function(){D("trailer"),D("<<"),D("/Size "+(gt+1)),D("/Root "+gt+" 0 R"),D("/Info "+(gt-1)+" 0 R"),h!==null&&D("/Encrypt "+rn.oid+" 0 R"),D("/ID [ <"+mt+"> <"+mt+"> ]"),D(">>")},ge=u.__private__.putHeader=function(){D("%PDF-"+y),D("%")},Cn=u.__private__.putXRef=function(){var k="0000000000";D("xref"),D("0 "+(gt+1)),D("0000000000 65535 f ");for(var E=1;E<=gt;E++)typeof kt[E]=="function"?D((k+kt[E]()).slice(-10)+" 00000 n "):kt[E]!==void 0?D((k+kt[E]).slice(-10)+" 00000 n "):D("0000000000 00000 n ")},hn=u.__private__.buildDocument=function(){var k;gt=0,Pt=0,_t=[],kt=[],jt=[],zt=Ut(),Dt=Ut(),I(_t),dn.publish("buildDocument"),ge(),$t(),(function(){dn.publish("putAdditionalObjects");for(var st=0;st<jt.length;st++){var ut=jt[st];wt(ut.objId,!0),D(ut.content),D("endobj")}dn.publish("postPutAdditionalObjects")})(),k=[],(function(){for(var st in qe)qe.hasOwnProperty(st)&&(f===!1||f===!0&&d.hasOwnProperty(st))&&le(qe[st])})(),(function(){var st;for(st in $e)$e.hasOwnProperty(st)&&we($e[st])})(),(function(){for(var st in ur)ur.hasOwnProperty(st)&&Pe(ur[st])})(),(function(st){var ut;for(ut in Te)Te.hasOwnProperty(ut)&&(Te[ut]instanceof Ws?Fe(Te[ut]):Te[ut]instanceof vo&&Yt(Te[ut],st))})(k),dn.publish("putResources"),k.forEach(yt),yt({resourcesOid:Dt,objectOid:Number.MAX_SAFE_INTEGER}),dn.publish("postPutResources"),h!==null&&(rn.oid=Lt(),D("<<"),D("/Filter /Standard"),D("/V "+rn.v),D("/R "+rn.r),D("/U <"+rn.toHexString(rn.U)+">"),D("/O <"+rn.toHexString(rn.O)+">"),D("/P "+rn.P),D(">>"),D("endobj")),Ae(),je();var E=Pt;return Cn(),xn(),D("startxref"),D(""+E),D("%%EOF"),I(Zt[Y]),_t.join(`\n`)},ln=u.__private__.getBlob=function(k){return new Blob([tt(k)],{type:"application/pdf"})},nn=u.output=u.__private__.output=(z=function(k,E){switch(typeof(E=E||{})=="string"?E={filename:E}:E.filename=E.filename||"generated.pdf",k){case void 0:return hn();case"save":u.save(E.filename);break;case"arraybuffer":return tt(hn());case"blob":return ln(hn());case"bloburi":case"bloburl":if(Ye.URL!==void 0&&typeof Ye.URL.createObjectURL=="function")return Ye.URL&&Ye.URL.createObjectURL(ln(hn()))||void 0;Pn.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var st="",ut=hn();try{st=Kd(ut)}catch{st=Kd(unescape(encodeURIComponent(ut)))}return"data:application/pdf;filename="+E.filename+";base64,"+st;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Ye)==="[object Window]"){var St="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Ht=\' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"\';E.pdfObjectUrl&&(St=E.pdfObjectUrl,Ht="");var Qt=\'<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="\'+St+\'"\'+Ht+\'><\\/script><script >PDFObject.embed("\'+this.output("dataurlstring")+\'", \'+JSON.stringify(E)+");<\\/script></body></html>",Le=Ye.open();return Le!==null&&Le.document.write(Qt),Le}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Ye)==="[object Window]"){var Oe=\'<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="\'+(E.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+E.filename+\'" width="500px" height="400px" /></body></html>\',Ve=Ye.open();if(Ve!==null){Ve.document.write(Oe);var en=this;Ve.document.documentElement.querySelector("#pdfViewer").onload=function(){Ve.document.title=E.filename,Ve.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(en.output("bloburl"))}}return Ve}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Ye)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var pn=\'<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="\'+this.output("datauristring",E)+\'"></iframe></body></html>\',jn=Ye.open();if(jn!==null&&(jn.document.write(pn),jn.document.title=E.filename),jn||typeof safari>"u")return jn;break;case"datauri":case"dataurl":return Ye.document.location.href=this.output("datauristring",E);default:return null}},z.foo=function(){try{return z.apply(this,arguments)}catch(st){var k=st.stack||"";~k.indexOf(" at ")&&(k=k.split(" at ")[1]);var E="Error in function "+k.split(`\n`)[0].split("<")[0]+": "+st.message;if(!Ye.console)throw new Error(E);Ye.console.error(E,st),Ye.alert&&alert(E)}},z.foo.bar=z,z.foo),bn=function(k){return Array.isArray(Ii)===!0&&Ii.indexOf(k)>-1};switch(i){case"pt":ze=1;break;case"mm":ze=72/25.4;break;case"cm":ze=72/2.54;break;case"in":ze=72;break;case"px":ze=bn("px_scaling")==1?.75:96/72;break;case"pc":case"em":ze=12;break;case"ex":ze=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);ze=i}var rn=null;at(),ft();var In=u.__private__.getPageInfo=u.getPageInfo=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ee[k].objId,pageNumber:k,pageContext:Ee[k]}},dr=u.__private__.getPageInfoByObjId=function(k){if(isNaN(k)||k%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var E in Ee)if(Ee[E].objId===k)break;return In(E)},Oi=u.__private__.getCurrentPageInfo=u.getCurrentPageInfo=function(){return{objId:Ee[Y].objId,pageNumber:Y,pageContext:Ee[Y]}};u.addPage=function(){return xe.apply(this,arguments),this},u.setPage=function(){return Qe.apply(this,arguments),I.call(this,Zt[Y]),this},u.insertPage=function(k){return this.addPage(),this.movePage(Y,k),this},u.movePage=function(k,E){var st,ut;if(k>E){st=Zt[k],ut=Ee[k];for(var St=k;St>E;St--)Zt[St]=Zt[St-1],Ee[St]=Ee[St-1];Zt[E]=st,Ee[E]=ut,this.setPage(E)}else if(k<E){st=Zt[k],ut=Ee[k];for(var Ht=k;Ht<E;Ht++)Zt[Ht]=Zt[Ht+1],Ee[Ht]=Ee[Ht+1];Zt[E]=st,Ee[E]=ut,this.setPage(E)}return this},u.deletePage=function(){return Ze.apply(this,arguments),this},u.__private__.text=u.text=function(k,E,st,ut,St){var Ht,Qt,Le,Oe,Ve,en,pn,jn,er,On=(ut=ut||{}).scope||this;if(typeof k=="number"&&typeof E=="number"&&(typeof st=="string"||Array.isArray(st))){var ir=st;st=E,E=k,k=ir}if(arguments[3]instanceof lt==0?(Le=arguments[4],Oe=arguments[5],An(pn=arguments[3])==="object"&&pn!==null||(typeof Le=="string"&&(Oe=Le,Le=null),typeof pn=="string"&&(Oe=pn,pn=null),typeof pn=="number"&&(Le=pn,pn=null),ut={flags:pn,angle:Le,align:Oe})):(O("The transform parameter of text() with a Matrix value"),er=St),isNaN(E)||isNaN(st)||k==null)throw new Error("Invalid arguments passed to jsPDF.text");if(k.length===0)return On;var nr,gr="",Ui=typeof ut.lineHeightFactor=="number"?ut.lineHeightFactor:Cs,fi=On.internal.scaleFactor;function Wi(wn){return wn=wn.split("	").join(Array(ut.TabLen||9).join(" ")),ue(wn,pn)}function zo(wn){for(var Mn,Yn=wn.concat(),sr=[],Gi=Yn.length;Gi--;)typeof(Mn=Yn.shift())=="string"?sr.push(Mn):Array.isArray(wn)&&(Mn.length===1||Mn[1]===void 0&&Mn[2]===void 0)?sr.push(Mn[0]):sr.push([Mn[0],Mn[1],Mn[2]]);return sr}function eo(wn,Mn){var Yn;if(typeof wn=="string")Yn=Mn(wn)[0];else if(Array.isArray(wn)){for(var sr,Gi,Zo=wn.concat(),io=[],Ga=Zo.length;Ga--;)typeof(sr=Zo.shift())=="string"?io.push(Mn(sr)[0]):Array.isArray(sr)&&typeof sr[0]=="string"&&(Gi=Mn(sr[0],sr[1],sr[2]),io.push([Gi[0],Gi[1],Gi[2]]));Yn=io}return Yn}var is=!1,Ps=!0;if(typeof k=="string")is=!0;else if(Array.isArray(k)){var Is=k.concat();Qt=[];for(var ss,yr=Is.length;yr--;)(typeof(ss=Is.shift())!="string"||Array.isArray(ss)&&typeof ss[0]!="string")&&(Ps=!1);is=Ps}if(is===!1)throw new Error(\'Type of text must be string or Array. "\'+k+\'" is not recognized.\');typeof k=="string"&&(k=k.match(/[\\r?\\n]/)?k.split(/\\r\\n|\\r|\\n/g):[k]);var Os=nt/On.internal.scaleFactor,Rs=Os*(Ui-1);switch(ut.baseline){case"bottom":st-=Rs;break;case"top":st+=Os-Rs;break;case"hanging":st+=Os-2*Rs;break;case"middle":st+=Os/2-Rs}if((en=ut.maxWidth||0)>0&&(typeof k=="string"?k=On.splitTextToSize(k,en):Object.prototype.toString.call(k)==="[object Array]"&&(k=k.reduce(function(wn,Mn){return wn.concat(On.splitTextToSize(Mn,en))},[]))),Ht={text:k,x:E,y:st,options:ut,mutex:{pdfEscape:ue,activeFontKey:be,fonts:qe,activeFontSize:nt}},dn.publish("preProcessText",Ht),k=Ht.text,Le=(ut=Ht.options).angle,er instanceof lt==0&&Le&&typeof Le=="number"){Le*=Math.PI/180,ut.rotationDirection===0&&(Le=-Le),L===_&&(Le=-Le);var jo=Math.cos(Le),Uo=Math.sin(Le);er=new lt(jo,Uo,-Uo,jo,0,0)}else Le&&Le instanceof lt&&(er=Le);L!==_||er||(er=Nt),(Ve=ut.charSpace||Fi)!==void 0&&(gr+=B($(Ve))+` Tc\n`,this.setCharSpace(this.getCharSpace()||0)),(jn=ut.horizontalScale)!==void 0&&(gr+=B(100*jn)+` Tz\n`),ut.lang;var Mr=-1,qi=ut.renderingMode!==void 0?ut.renderingMode:ut.stroke,no=On.internal.getCurrentPageInfo().pageContext;switch(qi){case 0:case!1:case"fill":Mr=0;break;case 1:case!0:case"stroke":Mr=1;break;case 2:case"fillThenStroke":Mr=2;break;case 3:case"invisible":Mr=3;break;case 4:case"fillAndAddForClipping":Mr=4;break;case 5:case"strokeAndAddPathForClipping":Mr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Mr=6;break;case 7:case"addToPathForClipping":Mr=7}var qa=no.usedRenderingMode!==void 0?no.usedRenderingMode:-1;Mr!==-1?gr+=Mr+` Tr\n`:qa!==-1&&(gr+=`0 Tr\n`),Mr!==-1&&(no.usedRenderingMode=Mr),Oe=ut.align||"left";var ei,Ts=nt*Ui,Wo=On.internal.pageSize.getWidth(),qo=qe[be];Ve=ut.charSpace||Fi,en=ut.maxWidth||0,pn=Object.assign({autoencode:!0,noBOM:!0},ut.flags);var os=[],Bs=function(wn){return On.getStringUnitWidth(wn,{font:qo,charSpace:Ve,fontSize:nt,doKerning:!1})*nt/fi};if(Object.prototype.toString.call(k)==="[object Array]"){var jr;Qt=zo(k),Oe!=="left"&&(ei=Qt.map(Bs));var Ur,as=0;if(Oe==="right"){E-=ei[0],k=[],yr=Qt.length;for(var Xi=0;Xi<yr;Xi++)Xi===0?(Ur=Ei(E),jr=Di(st)):(Ur=$(as-ei[Xi]),jr=-Ts),k.push([Qt[Xi],Ur,jr]),as=ei[Xi]}else if(Oe==="center"){E-=ei[0]/2,k=[],yr=Qt.length;for(var ls=0;ls<yr;ls++)ls===0?(Ur=Ei(E),jr=Di(st)):(Ur=$((as-ei[ls])/2),jr=-Ts),k.push([Qt[ls],Ur,jr]),as=ei[ls]}else if(Oe==="left"){k=[],yr=Qt.length;for(var Xo=0;Xo<yr;Xo++)k.push(Qt[Xo])}else if(Oe==="justify"&&qo.encoding==="Identity-H"){k=[],yr=Qt.length,en=en!==0?en:Wo;for(var ro=0,Hn=0;Hn<yr;Hn++)if(jr=Hn===0?Di(st):-Ts,Ur=Hn===0?Ei(E):ro,Hn<yr-1){var Xa=$((en-ei[Hn])/(Qt[Hn].split(" ").length-1)),_i=Qt[Hn].split(" ");k.push([_i[0]+" ",Ur,jr]),ro=0;for(var Si=1;Si<_i.length;Si++){var Go=(Bs(_i[Si-1]+" "+_i[Si])-Bs(_i[Si]))*fi+Xa;Si==_i.length-1?k.push([_i[Si],Go,0]):k.push([_i[Si]+" ",Go,0]),ro-=Go}}else k.push([Qt[Hn],Ur,jr]);k.push(["",ro,0])}else{if(Oe!=="justify")throw new Error(\'Unrecognized alignment option, use "left", "center", "right" or "justify".\');for(k=[],yr=Qt.length,en=en!==0?en:Wo,Hn=0;Hn<yr;Hn++){jr=Hn===0?Di(st):-Ts,Ur=Hn===0?Ei(E):0;var Ho=Qt[Hn].split(" ").length-1,Yo=Ho>0?(en-ei[Hn])/Ho:0;Hn<yr-1?os.push(B($(Yo))):os.push(0),k.push([Qt[Hn],Ur,jr])}}}(typeof ut.R2L=="boolean"?ut.R2L:dt)===!0&&(k=eo(k,function(wn,Mn,Yn){return[wn.split("").reverse().join(""),Mn,Yn]})),Ht={text:k,x:E,y:st,options:ut,mutex:{pdfEscape:ue,activeFontKey:be,fonts:qe,activeFontSize:nt}},dn.publish("postProcessText",Ht),k=Ht.text,nr=Ht.mutex.isHex||!1;var Vo=qe[be].encoding;Vo!=="WinAnsiEncoding"&&Vo!=="StandardEncoding"||(k=eo(k,function(wn,Mn,Yn){return[Wi(wn),Mn,Yn]})),Qt=zo(k),k=[];for(var cs,hs,us,Es=Array.isArray(Qt[0])?1:0,fs="",Ds=function(wn,Mn,Yn){var sr="";return Yn instanceof lt?(Yn=typeof ut.angle=="number"?ht(Yn,new lt(1,0,0,1,wn,Mn)):ht(new lt(1,0,0,1,wn,Mn),Yn),L===_&&(Yn=ht(new lt(1,0,0,-1,0,0),Yn)),sr=Yn.join(" ")+` Tm\n`):sr=B(wn)+" "+B(Mn)+` Td\n`,sr},ni=0;ni<Qt.length;ni++){switch(fs="",Es){case 1:us=(nr?"<":"(")+Qt[ni][0]+(nr?">":")"),cs=parseFloat(Qt[ni][1]),hs=parseFloat(Qt[ni][2]);break;case 0:us=(nr?"<":"(")+Qt[ni]+(nr?">":")"),cs=Ei(E),hs=Di(st)}os!==void 0&&os[ni]!==void 0&&(fs=os[ni]+` Tw\n`),ni===0?k.push(fs+Ds(cs,hs,er)+us):Es===0?k.push(fs+us):Es===1&&k.push(fs+Ds(cs,hs,er)+us)}k=Es===0?k.join(` Tj\nT* `):k.join(` Tj\n`),k+=` Tj\n`;var Ai=`BT\n/`;return Ai+=be+" "+nt+` Tf\n`,Ai+=B(nt*Ui)+` TL\n`,Ai+=Ls+`\n`,Ai+=gr,Ai+=k,D(Ai+="ET"),d[be]=!0,On};var pr=u.__private__.clip=u.clip=function(k){return D(k==="evenodd"?"W*":"W"),this};u.clipEvenOdd=function(){return pr("evenodd")},u.__private__.discardPath=u.discardPath=function(){return D("n"),this};var Lr=u.__private__.isValidStyle=function(k){var E=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(k)!==-1&&(E=!0),E};u.__private__.setDefaultPathOperation=u.setDefaultPathOperation=function(k){return Lr(k)&&(c=k),this};var Ri=u.__private__.getStyle=u.getStyle=function(k){var E=c;switch(k){case"D":case"S":E="S";break;case"F":E="f";break;case"FD":case"DF":E="B";break;case"f":case"f*":case"B":case"B*":E=k}return E},Ti=u.close=function(){return D("h"),this};u.stroke=function(){return D("S"),this},u.fill=function(k){return hi("f",k),this},u.fillEvenOdd=function(k){return hi("f*",k),this},u.fillStroke=function(k){return hi("B",k),this},u.fillStrokeEvenOdd=function(k){return hi("B*",k),this};var hi=function(k,E){An(E)==="object"?Ac(E,k):D(k)},Bi=function(k){k===null||L===_&&k===void 0||(k=Ri(k),D(k))};function rs(k,E,st,ut,St){var Ht=new vo(E||this.boundingBox,st||this.xStep,ut||this.yStep,this.gState,St||this.matrix);Ht.stream=this.stream;var Qt=k+"$$"+this.cloneIndex+++"$$";return vt(Qt,Ht),Ht}var Ac=function(k,E){var st=mn[k.key],ut=Te[st];if(ut instanceof Ws)D("q"),D(Cc(E)),ut.gState&&u.setGState(ut.gState),D(k.matrix.toString()+" cm"),D("/"+st+" sh"),D("Q");else if(ut instanceof vo){var St=new lt(1,0,0,-1,0,Ns());k.matrix&&(St=St.multiply(k.matrix||Nt),st=rs.call(ut,k.key,k.boundingBox,k.xStep,k.yStep,St).id),D("q"),D("/Pattern cs"),D("/"+st+" scn"),ut.gState&&u.setGState(ut.gState),D(E),D("Q")}},Cc=function(k){switch(k){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Oo=u.moveTo=function(k,E){return D(B($(k))+" "+B(S(E))+" m"),this},Fa=u.lineTo=function(k,E){return D(B($(k))+" "+B(S(E))+" l"),this},ui=u.curveTo=function(k,E,st,ut,St,Ht){return D([B($(k)),B(S(E)),B($(st)),B(S(ut)),B($(St)),B(S(Ht)),"c"].join(" ")),this};u.__private__.line=u.line=function(k,E,st,ut,St){if(isNaN(k)||isNaN(E)||isNaN(st)||isNaN(ut)||!Lr(St))throw new Error("Invalid arguments passed to jsPDF.line");return L===x?this.lines([[st-k,ut-E]],k,E,[1,1],St||"S"):this.lines([[st-k,ut-E]],k,E,[1,1]).stroke()},u.__private__.lines=u.lines=function(k,E,st,ut,St,Ht){var Qt,Le,Oe,Ve,en,pn,jn,er,On,ir,nr,gr;if(typeof k=="number"&&(gr=st,st=E,E=k,k=gr),ut=ut||[1,1],Ht=Ht||!1,isNaN(E)||isNaN(st)||!Array.isArray(k)||!Array.isArray(ut)||!Lr(St)||typeof Ht!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Oo(E,st),Qt=ut[0],Le=ut[1],Ve=k.length,ir=E,nr=st,Oe=0;Oe<Ve;Oe++)(en=k[Oe]).length===2?(ir=en[0]*Qt+ir,nr=en[1]*Le+nr,Fa(ir,nr)):(pn=en[0]*Qt+ir,jn=en[1]*Le+nr,er=en[2]*Qt+ir,On=en[3]*Le+nr,ir=en[4]*Qt+ir,nr=en[5]*Le+nr,ui(pn,jn,er,On,ir,nr));return Ht&&Ti(),Bi(St),this},u.path=function(k){for(var E=0;E<k.length;E++){var st=k[E],ut=st.c;switch(st.op){case"m":Oo(ut[0],ut[1]);break;case"l":Fa(ut[0],ut[1]);break;case"c":ui.apply(this,ut);break;case"h":Ti()}}return this},u.__private__.rect=u.rect=function(k,E,st,ut,St){if(isNaN(k)||isNaN(E)||isNaN(st)||isNaN(ut)||!Lr(St))throw new Error("Invalid arguments passed to jsPDF.rect");return L===x&&(ut=-ut),D([B($(k)),B(S(E)),B($(st)),B($(ut)),"re"].join(" ")),Bi(St),this},u.__private__.triangle=u.triangle=function(k,E,st,ut,St,Ht,Qt){if(isNaN(k)||isNaN(E)||isNaN(st)||isNaN(ut)||isNaN(St)||isNaN(Ht)||!Lr(Qt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[st-k,ut-E],[St-st,Ht-ut],[k-St,E-Ht]],k,E,[1,1],Qt,!0),this},u.__private__.roundedRect=u.roundedRect=function(k,E,st,ut,St,Ht,Qt){if(isNaN(k)||isNaN(E)||isNaN(st)||isNaN(ut)||isNaN(St)||isNaN(Ht)||!Lr(Qt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Le=4/3*(Math.SQRT2-1);return St=Math.min(St,.5*st),Ht=Math.min(Ht,.5*ut),this.lines([[st-2*St,0],[St*Le,0,St,Ht-Ht*Le,St,Ht],[0,ut-2*Ht],[0,Ht*Le,-St*Le,Ht,-St,Ht],[2*St-st,0],[-St*Le,0,-St,-Ht*Le,-St,-Ht],[0,2*Ht-ut],[0,-Ht*Le,St*Le,-Ht,St,-Ht]],k+St,E,[1,1],Qt,!0),this},u.__private__.ellipse=u.ellipse=function(k,E,st,ut,St){if(isNaN(k)||isNaN(E)||isNaN(st)||isNaN(ut)||!Lr(St))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Ht=4/3*(Math.SQRT2-1)*st,Qt=4/3*(Math.SQRT2-1)*ut;return Oo(k+st,E),ui(k+st,E-Qt,k+Ht,E-ut,k,E-ut),ui(k-Ht,E-ut,k-st,E-Qt,k-st,E),ui(k-st,E+Qt,k-Ht,E+ut,k,E+ut),ui(k+Ht,E+ut,k+st,E+Qt,k+st,E),Bi(St),this},u.__private__.circle=u.circle=function(k,E,st,ut){if(isNaN(k)||isNaN(E)||isNaN(st)||!Lr(ut))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(k,E,st,st,ut)},u.setFont=function(k,E,st){return st&&(E=U(E,st)),be=Se(k,E,{disableWarning:!1}),this};var Lc=u.__private__.getFont=u.getFont=function(){return qe[Se.apply(u,arguments)]};u.__private__.getFontList=u.getFontList=function(){var k,E,st={};for(k in Xe)if(Xe.hasOwnProperty(k))for(E in st[k]=[],Xe[k])Xe[k].hasOwnProperty(E)&&st[k].push(E);return st},u.addFont=function(k,E,st,ut,St){var Ht=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Ht.indexOf(arguments[3])!==-1?St=arguments[3]:arguments[3]&&Ht.indexOf(arguments[3])==-1&&(st=U(st,ut)),Q.call(this,k,E,st,St=St||"Identity-H")};var Cs,Ro=n.lineWidth||.200025,Mc=u.__private__.getLineWidth=u.getLineWidth=function(){return Ro},Ke=u.__private__.setLineWidth=u.setLineWidth=function(k){return Ro=k,D(B($(k))+" w"),this};u.__private__.setLineDash=De.API.setLineDash=De.API.setLineDashPattern=function(k,E){if(k=k||[],E=E||0,isNaN(E)||!Array.isArray(k))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return k=k.map(function(st){return B($(st))}).join(" "),E=B($(E)),D("["+k+"] "+E+" d"),this};var Nc=u.__private__.getLineHeight=u.getLineHeight=function(){return nt*Cs};u.__private__.getLineHeight=u.getLineHeight=function(){return nt*Cs};var Pc=u.__private__.setLineHeightFactor=u.setLineHeightFactor=function(k){return typeof(k=k||1.15)=="number"&&(Cs=k),this},Ic=u.__private__.getLineHeightFactor=u.getLineHeightFactor=function(){return Cs};Pc(n.lineHeight);var Ei=u.__private__.getHorizontalCoordinate=function(k){return $(k)},Di=u.__private__.getVerticalCoordinate=function(k){return L===_?k:Ee[Y].mediaBox.topRightY-Ee[Y].mediaBox.bottomLeftY-$(k)},Oc=u.__private__.getHorizontalCoordinateString=u.getHorizontalCoordinateString=function(k){return B(Ei(k))},Rc=u.__private__.getVerticalCoordinateString=u.getVerticalCoordinateString=function(k){return B(Di(k))},Js=n.strokeColor||"0 G";u.__private__.getStrokeColor=u.getDrawColor=function(){return At(Js)},u.__private__.setStrokeColor=u.setDrawColor=function(k,E,st,ut){return Js=Ft({ch1:k,ch2:E,ch3:st,ch4:ut,pdfColorType:"draw",precision:2}),D(Js),this};var To=n.fillColor||"0 g";u.__private__.getFillColor=u.getFillColor=function(){return At(To)},u.__private__.setFillColor=u.setFillColor=function(k,E,st,ut){return To=Ft({ch1:k,ch2:E,ch3:st,ch4:ut,pdfColorType:"fill",precision:2}),D(To),this};var Ls=n.textColor||"0 g",Tc=u.__private__.getTextColor=u.getTextColor=function(){return At(Ls)};u.__private__.setTextColor=u.setTextColor=function(k,E,st,ut){return Ls=Ft({ch1:k,ch2:E,ch3:st,ch4:ut,pdfColorType:"text",precision:3}),this};var Fi=n.charSpace,Bc=u.__private__.getCharSpace=u.getCharSpace=function(){return parseFloat(Fi||0)};u.__private__.setCharSpace=u.setCharSpace=function(k){if(isNaN(k))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Fi=k,this};var Bo=0;u.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},u.__private__.setLineCap=u.setLineCap=function(k){var E=u.CapJoinStyles[k];if(E===void 0)throw new Error("Line cap style of \'"+k+"\' is not recognized. See or extend .CapJoinStyles property for valid styles");return Bo=E,D(E+" J"),this};var Eo=0;u.__private__.setLineJoin=u.setLineJoin=function(k){var E=u.CapJoinStyles[k];if(E===void 0)throw new Error("Line join style of \'"+k+"\' is not recognized. See or extend .CapJoinStyles property for valid styles");return Eo=E,D(E+" j"),this},u.__private__.setLineMiterLimit=u.__private__.setMiterLimit=u.setLineMiterLimit=u.setMiterLimit=function(k){if(k=k||0,isNaN(k))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return D(B($(k))+" M"),this},u.GState=gc,u.setGState=function(k){(k=typeof k=="string"?$e[Ge[k]]:$a(null,k)).equals(vn)||(D("/"+k.id+" gs"),vn=k)};var $a=function(k,E){if(!k||!Ge[k]){var st=!1;for(var ut in $e)if($e.hasOwnProperty(ut)&&$e[ut].equals(E)){st=!0;break}if(st)E=$e[ut];else{var St="GS"+(Object.keys($e).length+1).toString(10);$e[St]=E,E.id=St}return k&&(Ge[k]=E.id),dn.publish("addGState",E),E}};u.addGState=function(k,E){return $a(k,E),this},u.saveGraphicsState=function(){return D("q"),cn.push({key:be,size:nt,color:Ls}),this},u.restoreGraphicsState=function(){D("Q");var k=cn.pop();return be=k.key,nt=k.size,Ls=k.color,vn=null,this},u.setCurrentTransformationMatrix=function(k){return D(k.toString()+" cm"),this},u.comment=function(k){return D("#"+k),this};var $i=function(k,E){var st=k||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return st},set:function(Ht){isNaN(Ht)||(st=parseFloat(Ht))}});var ut=E||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return ut},set:function(Ht){isNaN(Ht)||(ut=parseFloat(Ht))}});var St="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return St},set:function(Ht){St=Ht.toString()}}),this},Do=function(k,E,st,ut){$i.call(this,k,E),this.type="rect";var St=st||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return St},set:function(Qt){isNaN(Qt)||(St=parseFloat(Qt))}});var Ht=ut||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Ht},set:function(Qt){isNaN(Qt)||(Ht=parseFloat(Qt))}}),this},to=function(){this.page=He,this.currentPage=Y,this.pages=Zt.slice(0),this.pagesContext=Ee.slice(0),this.x=ve,this.y=an,this.matrix=Ie,this.width=$o(Y),this.height=ja(Y),this.outputDestination=he,this.id="",this.objectNumber=-1};to.prototype.restore=function(){He=this.page,Y=this.currentPage,Ee=this.pagesContext,Zt=this.pages,ve=this.x,an=this.y,Ie=this.matrix,za(Y,this.width),zi(Y,this.height),he=this.outputDestination};var Fo=function(k,E,st,ut,St){Z.push(new to),He=Y=0,Zt=[],ve=k,an=E,Ie=St,fe([st,ut])};for(var Ms in u.beginFormObject=function(k,E,st,ut,St){return Fo(k,E,st,ut,St),this},u.endFormObject=function(k){return(function(E){if(v[E])Z.pop().restore();else{var st=new to,ut="Xo"+(Object.keys(ur).length+1).toString(10);st.id=ut,v[E]=ut,ur[ut]=st,dn.publish("addFormObject",st),Z.pop().restore()}})(k),this},u.doFormObject=function(k,E){var st=ur[v[k]];return D("q"),D(E.toString()+" cm"),D("/"+st.id+" Do"),D("Q"),this},u.getFormObject=function(k){var E=ur[v[k]];return{x:E.x,y:E.y,width:E.width,height:E.height,matrix:E.matrix}},u.save=function(k,E){return k=k||"generated.pdf",(E=E||{}).returnPromise=E.returnPromise||!1,E.returnPromise===!1?(Us(ln(hn()),k),typeof Us.unload=="function"&&Ye.setTimeout&&setTimeout(Us.unload,911),this):new Promise(function(st,ut){try{var St=Us(ln(hn()),k);typeof Us.unload=="function"&&Ye.setTimeout&&setTimeout(Us.unload,911),st(St)}catch(Ht){ut(Ht.message)}})},De.API)De.API.hasOwnProperty(Ms)&&(Ms==="events"&&De.API.events.length?(function(k,E){var st,ut,St;for(St=E.length-1;St!==-1;St--)st=E[St][0],ut=E[St][1],k.subscribe.apply(k,[st].concat(typeof ut=="function"?[ut]:ut))})(dn,De.API.events):u[Ms]=De.API[Ms]);function $o(k){return Ee[k].mediaBox.topRightX-Ee[k].mediaBox.bottomLeftX}function za(k,E){Ee[k].mediaBox.topRightX=E+Ee[k].mediaBox.bottomLeftX}function ja(k){return Ee[k].mediaBox.topRightY-Ee[k].mediaBox.bottomLeftY}function zi(k,E){Ee[k].mediaBox.topRightY=E+Ee[k].mediaBox.bottomLeftY}var ji=u.getPageWidth=function(k){return $o(k=k||Y)/ze},Ua=u.setPageWidth=function(k,E){za(k,E*ze)},Ns=u.getPageHeight=function(k){return ja(k=k||Y)/ze},Wa=u.setPageHeight=function(k,E){zi(k,E*ze)};return u.internal={pdfEscape:ue,getStyle:Ri,getFont:Lc,getFontSize:It,getCharSpace:Bc,getTextColor:Tc,getLineHeight:Nc,getLineHeightFactor:Ic,getLineWidth:Mc,write:pt,getHorizontalCoordinate:Ei,getVerticalCoordinate:Di,getCoordinateString:Oc,getVerticalCoordinateString:Rc,collections:{},newObject:Lt,newAdditionalObject:Ot,newObjectDeferred:Ut,newObjectDeferredBegin:wt,getFilters:se,putStream:te,events:dn,scaleFactor:ze,pageSize:{getWidth:function(){return ji(Y)},setWidth:function(k){Ua(Y,k)},getHeight:function(){return Ns(Y)},setHeight:function(k){Wa(Y,k)}},encryptionOptions:h,encryption:rn,getEncryptor:function(k){return h!==null?rn.encryptor(k,0):function(E){return E}},output:nn,getNumberOfPages:ie,get pages(){return Zt},out:D,f2:R,f3:M,getPageInfo:In,getPageInfoByObjId:dr,getCurrentPageInfo:Oi,getPDFVersion:g,Point:$i,Rectangle:Do,Matrix:lt,hasHotfix:bn},Object.defineProperty(u.internal.pageSize,"width",{get:function(){return ji(Y)},set:function(k){Ua(Y,k)},enumerable:!0,configurable:!0}),Object.defineProperty(u.internal.pageSize,"height",{get:function(){return Ns(Y)},set:function(k){Wa(Y,k)},enumerable:!0,configurable:!0}),(function(k){for(var E=0,st=H.length;E<st;E++){var ut=Q.call(this,k[E][0],k[E][1],k[E][2],H[E][3],!0);f===!1&&(d[ut]=!0);var St=k[E][0].split("-");Wt({id:ut,fontName:St[0],fontStyle:St[1]||""})}dn.publish("addFonts",{fonts:qe,dictionary:Xe})}).call(u,H),be="F1",xe(r,e),dn.publish("initialized"),u}yo.prototype.lsbFirstWord=function(n){return String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255)},yo.prototype.toHexString=function(n){return n.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},yo.prototype.hexToBytes=function(n){for(var t=[],e=0;e<n.length;e+=2)t.push(String.fromCharCode(parseInt(n.substr(e,2),16)));return t.join("")},yo.prototype.processOwnerPassword=function(n,t){return yu(gu(t).substr(0,5),n)},yo.prototype.encryptor=function(n,t){var e=gu(this.encryptionKey+String.fromCharCode(255&n,n>>8&255,n>>16&255,255&t,t>>8&255)).substr(0,10);return function(i){return yu(e,i)}},gc.prototype.equals=function(n){var t,e="id,objectNumber,equals";if(!n||An(n)!==An(this))return!1;var i=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!n.hasOwnProperty(t)||this[t]!==n[t])return!1;i++}for(t in n)n.hasOwnProperty(t)&&e.indexOf(t)<0&&i--;return i===0},De.API={events:[]},De.version="4.0.0";var Xn=De.API,Du=1,Qs=function(n){return n.replace(/\\\\/g,"\\\\\\\\").replace(/\\(/g,"\\\\(").replace(/\\)/g,"\\\\)")},uo=function(n){return n.replace(/\\\\\\\\/g,"\\\\").replace(/\\\\\\(/g,"(").replace(/\\\\\\)/g,")")},Je=function(n){return n.toFixed(2)},vs=function(n){return n.toFixed(5)};Xn.__acroform__={};var zr=function(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n},ep=function(n){return n*Du},Li=function(n){var t=new $2,e=Ce.internal.getHeight(n)||0,i=Ce.internal.getWidth(n)||0;return t.BBox=[0,0,Number(Je(i)),Number(Je(e))],t},Zv=Xn.__acroform__.setBit=function(n,t){if(n=n||0,t=t||0,isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return n|1<<t},Kv=Xn.__acroform__.clearBit=function(n,t){if(n=n||0,t=t||0,isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return n&~(1<<t)},Qv=Xn.__acroform__.getBit=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return n&1<<t?1:0},Qn=Xn.__acroform__.getBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Qv(n,t-1)},Jn=Xn.__acroform__.setBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Zv(n,t-1)},tr=Xn.__acroform__.clearBitForPdf=function(n,t){if(isNaN(n)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Kv(n,t-1)},Jv=Xn.__acroform__.calculateCoordinates=function(n,t){var e=t.internal.getHorizontalCoordinate,i=t.internal.getVerticalCoordinate,r=n[0],s=n[1],a=n[2],o=n[3],l={};return l.lowerLeft_X=e(r)||0,l.lowerLeft_Y=i(s+o)||0,l.upperRight_X=e(r+a)||0,l.upperRight_Y=i(s)||0,[Number(Je(l.lowerLeft_X)),Number(Je(l.lowerLeft_Y)),Number(Je(l.upperRight_X)),Number(Je(l.upperRight_Y))]},tx=function(n){if(n.appearanceStreamContent)return n.appearanceStreamContent;if(n.V||n.DV){var t=[],e=n._V||n.DV,i=mu(n,e),r=n.scope.internal.getFont(n.fontName,n.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(n.scope.__private__.encodeColorString(n.color)),t.push("/"+r+" "+Je(i.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(i.text),t.push("ET"),t.push("Q"),t.push("EMC");var s=Li(n);return s.scope=n.scope,s.stream=t.join(`\n`),s}},mu=function(n,t){var e=n.fontSize===0?n.maxFontSize:n.fontSize,i={text:"",fontSize:""},r=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");r=n.multiline?r.map(function(R){return R.split(`\n`)}):r.map(function(R){return[R]});var s=e,a=Ce.internal.getHeight(n)||0;a=a<0?-a:a;var o=Ce.internal.getWidth(n)||0;o=o<0?-o:o;var l=function(R,M,$){if(R+1<r.length){var S=M+" "+r[R+1][0];return Ml(S,n,$).width<=o-4}return!1};s++;t:for(;s>0;){t="",s--;var c,h,f=Ml("3",n,s).height,d=n.multiline?a-s:(a-f)/2,u=d+=2,y=0,g=0,w=0;if(s<=0){t=`(...) Tj\n`,t+="% Width of Text: "+Ml(t,n,s=12).width+", FieldWidth:"+o+`\n`;break}for(var m="",x=0,_=0;_<r.length;_++)if(r.hasOwnProperty(_)){var L=!1;if(r[_].length!==1&&w!==r[_].length-1){if((f+2)*(x+2)+2>a)continue t;m+=r[_][w],L=!0,g=_,_--}else{m=(m+=r[_][w]+" ").substr(m.length-1)==" "?m.substr(0,m.length-1):m;var T=parseInt(_),q=l(T,m,s),U=_>=r.length-1;if(q&&!U){m+=" ",w=0;continue}if(q||U){if(U)g=T;else if(n.multiline&&(f+2)*(x+2)+2>a)continue t}else{if(!n.multiline||(f+2)*(x+2)+2>a)continue t;g=T}}for(var B="",O=y;O<=g;O++){var X=r[O];if(n.multiline){if(O===g){B+=X[w]+" ",w=(w+1)%X.length;continue}if(O===y){B+=X[X.length-1]+" ";continue}}B+=X[0]+" "}switch(B=B.substr(B.length-1)==" "?B.substr(0,B.length-1):B,h=Ml(B,n,s).width,n.textAlign){case"right":c=o-h-2;break;case"center":c=(o-h)/2;break;default:c=2}t+=Je(c)+" "+Je(u)+` Td\n`,t+="("+Qs(B)+`) Tj\n`,t+=-Je(c)+` 0 Td\n`,u=-(s+2),h=0,y=L?g:g+1,x++,m=""}break}return i.text=t,i.fontSize=s,i},Ml=function(n,t,e){var i=t.scope.internal.getFont(t.fontName,t.fontStyle),r=t.scope.getStringUnitWidth(n,{font:i,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:r}},ex={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},nx=function(n,t){var e={type:"reference",object:n};t.internal.getPageInfo(n.page).pageContext.annotations.find(function(i){return i.type===e.type&&i.object===e.object})===void 0&&t.internal.getPageInfo(n.page).pageContext.annotations.push(e)},rx=function(n,t){if(t.scope=n,n.internal!==void 0&&(n.internal.acroformPlugin===void 0||n.internal.acroformPlugin.isInitialized===!1)){if(xi.FieldNum=0,n.internal.acroformPlugin=JSON.parse(JSON.stringify(ex)),n.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Du=n.internal.scaleFactor,n.internal.acroformPlugin.acroFormDictionaryRoot=new z2,n.internal.acroformPlugin.acroFormDictionaryRoot.scope=n,n.internal.acroformPlugin.acroFormDictionaryRoot._eventID=n.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(n)}),n.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var r in i)if(i.hasOwnProperty(r)){var s=i[r];s.objId=void 0,s.hasAnnotation&&nx(s,e)}})(n)}),n.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(n)}),n.internal.events.subscribe("postPutPages",function(e){(function(i,r){var s=!i;for(var a in i||(r.internal.newObjectDeferredBegin(r.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),r.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||r.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(a)){var o=i[a],l=[],c=o.Rect;if(o.Rect&&(o.Rect=Jv(o.Rect,r)),r.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Ce.createDefaultAppearanceStream(o),An(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(l=o.getKeyValueListForStream()),o.Rect=c,o.hasAppearanceStream&&!o.appearanceStreamContent){var h=tx(o);l.push({key:"AP",value:"<</N "+h+">>"}),r.internal.acroformPlugin.xForms.push(h)}if(o.appearanceStreamContent){var f="";for(var d in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(d)){var u=o.appearanceStreamContent[d];if(f+="/"+d+" ",f+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var a in u)if(u.hasOwnProperty(a)){var y=u[a];typeof y=="function"&&(y=y.call(r,o)),f+="/"+a+" "+y+" ",r.internal.acroformPlugin.xForms.indexOf(y)>=0||r.internal.acroformPlugin.xForms.push(y)}}else typeof(y=u)=="function"&&(y=y.call(r,o)),f+="/"+a+" "+y,r.internal.acroformPlugin.xForms.indexOf(y)>=0||r.internal.acroformPlugin.xForms.push(y);f+=">>"}l.push({key:"AP",value:`<<\n`+f+">>"})}r.internal.putStream({additionalKeyValues:l,objectId:o.objId}),r.internal.out("endobj")}s&&(function(g,w){for(var m in g)if(g.hasOwnProperty(m)){var x=m,_=g[m];w.internal.newObjectDeferredBegin(_.objId,!0),An(_)==="object"&&typeof _.putStream=="function"&&_.putStream(),delete g[x]}})(r.internal.acroformPlugin.xForms,r)})(e,n)}),n.internal.acroformPlugin.isInitialized=!0}},F2=Xn.__acroform__.arrayToPdfArray=function(n,t,e){var i=function(a){return a};if(Array.isArray(n)){for(var r="[",s=0;s<n.length;s++)switch(s!==0&&(r+=" "),An(n[s])){case"boolean":case"number":case"object":r+=n[s].toString();break;case"string":n[s].substr(0,1)!=="/"?(t!==void 0&&e&&(i=e.internal.getEncryptor(t)),r+="("+Qs(i(n[s].toString()))+")"):r+=n[s].toString()}return r+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},Bh=function(n,t,e){var i=function(r){return r};return t!==void 0&&e&&(i=e.internal.getEncryptor(t)),(n=n||"").toString(),"("+Qs(i(n))+")"},Ni=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(n){this._objId=n}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Ni.prototype.toString=function(){return this.objId+" 0 R"},Ni.prototype.putStream=function(){var n=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:n,objectId:this.objId}),this.scope.internal.out("endobj")},Ni.prototype.getKeyValueListForStream=function(){var n=[],t=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var i=t[e],r=this[i];r&&(Array.isArray(r)?n.push({key:i,value:F2(r,this.objId,this.scope)}):r instanceof Ni?(r.scope=this.scope,n.push({key:i,value:r.objId+" 0 R"})):typeof r!="function"&&n.push({key:i,value:r}))}return n};var $2=function(){Ni.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var n,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){n=e.trim()},get:function(){return n||null}})};zr($2,Ni);var z2=function(){Ni.call(this);var n,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(n){var e=function(i){return i};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+Qs(e(n))+")"}},set:function(e){n=e}})};zr(z2,Ni);var xi=function n(){Ni.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(m){if(isNaN(m))throw new Error(\'Invalid value "\'+m+\'" for attribute F supplied.\');t=m}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Qn(t,3)},set:function(m){m?this.F=Jn(t,3):this.F=tr(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(m){if(isNaN(m))throw new Error(\'Invalid value "\'+m+\'" for attribute Ff supplied.\');e=m}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(m){i=m!==void 0?m:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(m){i[0]=m}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(m){i[1]=m}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(m){i[2]=m}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(m){i[3]=m}});var r="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return r},set:function(m){switch(m){case"/Btn":case"/Tx":case"/Ch":case"/Sig":r=m;break;default:throw new Error(\'Invalid value "\'+m+\'" for attribute FT supplied.\')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof yc)return;s="FieldObject"+n.FieldNum++}var m=function(x){return x};return this.scope&&(m=this.scope.internal.getEncryptor(this.objId)),"("+Qs(m(s))+")"},set:function(m){s=m.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(m){s=m}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(m){a=m}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(m){o=m}});var l=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return l},set:function(m){l=m}});var c=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return c===void 0?50/Du:c},set:function(m){c=m}});var h="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return h},set:function(m){h=m}});var f="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!f||this instanceof yc||this instanceof Gs))return Bh(f,this.objId,this.scope)},set:function(m){m=m.toString(),f=m}});var d=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(d)return this instanceof fr==0?Bh(d,this.objId,this.scope):d},set:function(m){m=m.toString(),d=this instanceof fr==0?m.substr(0,1)==="("?uo(m.substr(1,m.length-2)):uo(m):m}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof fr==1?uo(d.substr(1,d.length-1)):d},set:function(m){m=m.toString(),d=this instanceof fr==1?"/"+m:m}});var u=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(u)return u},set:function(m){this.V=m}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(u)return this instanceof fr==0?Bh(u,this.objId,this.scope):u},set:function(m){m=m.toString(),u=this instanceof fr==0?m.substr(0,1)==="("?uo(m.substr(1,m.length-2)):uo(m):m}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof fr==1?uo(u.substr(1,u.length-1)):u},set:function(m){m=m.toString(),u=this instanceof fr==1?"/"+m:m}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var y,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(m){m=!!m,g=m}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(y)return y},set:function(m){y=m}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,1)},set:function(m){m?this.Ff=Jn(this.Ff,1):this.Ff=tr(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,2)},set:function(m){m?this.Ff=Jn(this.Ff,2):this.Ff=tr(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,3)},set:function(m){m?this.Ff=Jn(this.Ff,3):this.Ff=tr(this.Ff,3)}});var w=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(w!==null)return w},set:function(m){if([0,1,2].indexOf(m)===-1)throw new Error(\'Invalid value "\'+m+\'" for attribute Q supplied.\');w=m}}),Object.defineProperty(this,"textAlign",{get:function(){var m;switch(w){case 0:default:m="left";break;case 1:m="center";break;case 2:m="right"}return m},configurable:!0,enumerable:!0,set:function(m){switch(m){case"right":case 2:w=2;break;case"center":case 1:w=1;break;default:w=0}}})};zr(xi,Ni);var _o=function(){xi.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var n=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return n},set:function(e){n=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return F2(t,this.objId,this.scope)},set:function(e){var i,r;r=[],typeof(i=e)=="string"&&(r=(function(s,a,o){o||(o=1);for(var l,c=[];l=a.exec(s);)c.push(l[o]);return c})(i,/\\((.*?)\\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,i){for(i=i||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,18)},set:function(e){e?this.Ff=Jn(this.Ff,18):this.Ff=tr(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Jn(this.Ff,19):this.Ff=tr(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,20)},set:function(e){e?(this.Ff=Jn(this.Ff,20),t.sort()):this.Ff=tr(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,22)},set:function(e){e?this.Ff=Jn(this.Ff,22):this.Ff=tr(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,23)},set:function(e){e?this.Ff=Jn(this.Ff,23):this.Ff=tr(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,27)},set:function(e){e?this.Ff=Jn(this.Ff,27):this.Ff=tr(this.Ff,27)}}),this.hasAppearanceStream=!1};zr(_o,xi);var So=function(){_o.call(this),this.fontName="helvetica",this.combo=!1};zr(So,_o);var Ao=function(){So.call(this),this.combo=!0};zr(Ao,So);var Wl=function(){Ao.call(this),this.edit=!0};zr(Wl,Ao);var fr=function(){xi.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,15)},set:function(e){e?this.Ff=Jn(this.Ff,15):this.Ff=tr(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,16)},set:function(e){e?this.Ff=Jn(this.Ff,16):this.Ff=tr(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,17)},set:function(e){e?this.Ff=Jn(this.Ff,17):this.Ff=tr(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,26)},set:function(e){e?this.Ff=Jn(this.Ff,26):this.Ff=tr(this.Ff,26)}});var n,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var i,r=[];for(i in r.push("<<"),t)r.push("/"+i+" ("+Qs(e(t[i]))+")");return r.push(">>"),r.join(`\n`)}},set:function(e){An(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}})};zr(fr,xi);var ql=function(){fr.call(this),this.pushButton=!0};zr(ql,fr);var Co=function(){fr.call(this),this.radio=!0,this.pushButton=!1;var n=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t!==void 0?t:[]}})};zr(Co,fr);var yc=function(){var n,t;xi.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return n},set:function(r){n=r}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(r){t=r}});var e,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var r=function(o){return o};this.scope&&(r=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),i)a.push("/"+s+" ("+Qs(r(i[s]))+")");return a.push(">>"),a.join(`\n`)},set:function(r){An(r)==="object"&&(i=r)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(r){typeof r=="string"&&(i.CA=r)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(r){e=r}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(r){e="/"+r}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ce.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};zr(yc,xi),Co.prototype.setAppearance=function(n){if(!("createAppearanceStream"in n)||!("getCA"in n))throw new Error("Couldn\'t assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=n.createAppearanceStream(e.optionName),e.caption=n.getCA()}},Co.prototype.createOption=function(n){var t=new yc;return t.Parent=this,t.optionName=n,this.Kids.push(t),ix.call(this.scope,t),t};var Xl=function(){fr.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ce.CheckBox.createAppearanceStream()};zr(Xl,fr);var Gs=function(){xi.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,13)},set:function(t){t?this.Ff=Jn(this.Ff,13):this.Ff=tr(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,21)},set:function(t){t?this.Ff=Jn(this.Ff,21):this.Ff=tr(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,23)},set:function(t){t?this.Ff=Jn(this.Ff,23):this.Ff=tr(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,24)},set:function(t){t?this.Ff=Jn(this.Ff,24):this.Ff=tr(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,25)},set:function(t){t?this.Ff=Jn(this.Ff,25):this.Ff=tr(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,26)},set:function(t){t?this.Ff=Jn(this.Ff,26):this.Ff=tr(this.Ff,26)}});var n=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return n},set:function(t){n=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return n},set:function(t){Number.isInteger(t)&&(n=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};zr(Gs,xi);var Gl=function(){Gs.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Qn(this.Ff,14)},set:function(n){n?this.Ff=Jn(this.Ff,14):this.Ff=tr(this.Ff,14)}}),this.password=!0};zr(Gl,Gs);var Ce={CheckBox:{createAppearanceStream:function(){return{N:{On:Ce.CheckBox.YesNormal},D:{On:Ce.CheckBox.YesPushDown,Off:Ce.CheckBox.OffPushDown}}},YesPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=[],i=n.scope.internal.getFont(n.fontName,n.fontStyle).id,r=n.scope.__private__.encodeColorString(n.color),s=mu(n,n.caption);return e.push("0.749023 g"),e.push("0 0 "+Je(Ce.internal.getWidth(n))+" "+Je(Ce.internal.getHeight(n))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+i+" "+Je(s.fontSize)+" Tf "+r),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`\n`),t},YesNormal:function(n){var t=Li(n);t.scope=n.scope;var e=n.scope.internal.getFont(n.fontName,n.fontStyle).id,i=n.scope.__private__.encodeColorString(n.color),r=[],s=Ce.internal.getHeight(n),a=Ce.internal.getWidth(n),o=mu(n,n.caption);return r.push("1 g"),r.push("0 0 "+Je(a)+" "+Je(s)+" re"),r.push("f"),r.push("q"),r.push("0 0 1 rg"),r.push("0 0 "+Je(a-1)+" "+Je(s-1)+" re"),r.push("W"),r.push("n"),r.push("0 g"),r.push("BT"),r.push("/"+e+" "+Je(o.fontSize)+" Tf "+i),r.push(o.text),r.push("ET"),r.push("Q"),t.stream=r.join(`\n`),t},OffPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Je(Ce.internal.getWidth(n))+" "+Je(Ce.internal.getHeight(n))+" re"),e.push("f"),t.stream=e.join(`\n`),t}},RadioButton:{Circle:{createAppearanceStream:function(n){var t={D:{Off:Ce.RadioButton.Circle.OffPushDown},N:{}};return t.N[n]=Ce.RadioButton.Circle.YesNormal,t.D[n]=Ce.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(n){var t=Li(n);t.scope=n.scope;var e=[],i=Ce.internal.getWidth(n)<=Ce.internal.getHeight(n)?Ce.internal.getWidth(n)/4:Ce.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=Ce.internal.Bezier_C,s=Number((i*r).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+vs(Ce.internal.getWidth(n)/2)+" "+vs(Ce.internal.getHeight(n)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),e.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),e.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),e.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`\n`),t},YesPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=[],i=Ce.internal.getWidth(n)<=Ce.internal.getHeight(n)?Ce.internal.getWidth(n)/4:Ce.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),s=Number((r*Ce.internal.Bezier_C).toFixed(5)),a=Number((i*Ce.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+vs(Ce.internal.getWidth(n)/2)+" "+vs(Ce.internal.getHeight(n)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),e.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),e.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),e.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+vs(Ce.internal.getWidth(n)/2)+" "+vs(Ce.internal.getHeight(n)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`\n`),t},OffPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=[],i=Ce.internal.getWidth(n)<=Ce.internal.getHeight(n)?Ce.internal.getWidth(n)/4:Ce.internal.getHeight(n)/4;i=Number((.9*i).toFixed(5));var r=Number((2*i).toFixed(5)),s=Number((r*Ce.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+vs(Ce.internal.getWidth(n)/2)+" "+vs(Ce.internal.getHeight(n)/2)+" cm"),e.push(r+" 0 m"),e.push(r+" "+s+" "+s+" "+r+" 0 "+r+" c"),e.push("-"+s+" "+r+" -"+r+" "+s+" -"+r+" 0 c"),e.push("-"+r+" -"+s+" -"+s+" -"+r+" 0 -"+r+" c"),e.push(s+" -"+r+" "+r+" -"+s+" "+r+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`\n`),t}},Cross:{createAppearanceStream:function(n){var t={D:{Off:Ce.RadioButton.Cross.OffPushDown},N:{}};return t.N[n]=Ce.RadioButton.Cross.YesNormal,t.D[n]=Ce.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(n){var t=Li(n);t.scope=n.scope;var e=[],i=Ce.internal.calculateCross(n);return e.push("q"),e.push("1 1 "+Je(Ce.internal.getWidth(n)-2)+" "+Je(Ce.internal.getHeight(n)-2)+" re"),e.push("W"),e.push("n"),e.push(Je(i.x1.x)+" "+Je(i.x1.y)+" m"),e.push(Je(i.x2.x)+" "+Je(i.x2.y)+" l"),e.push(Je(i.x4.x)+" "+Je(i.x4.y)+" m"),e.push(Je(i.x3.x)+" "+Je(i.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`\n`),t},YesPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=Ce.internal.calculateCross(n),i=[];return i.push("0.749023 g"),i.push("0 0 "+Je(Ce.internal.getWidth(n))+" "+Je(Ce.internal.getHeight(n))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+Je(Ce.internal.getWidth(n)-2)+" "+Je(Ce.internal.getHeight(n)-2)+" re"),i.push("W"),i.push("n"),i.push(Je(e.x1.x)+" "+Je(e.x1.y)+" m"),i.push(Je(e.x2.x)+" "+Je(e.x2.y)+" l"),i.push(Je(e.x4.x)+" "+Je(e.x4.y)+" m"),i.push(Je(e.x3.x)+" "+Je(e.x3.y)+" l"),i.push("s"),i.push("Q"),t.stream=i.join(`\n`),t},OffPushDown:function(n){var t=Li(n);t.scope=n.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Je(Ce.internal.getWidth(n))+" "+Je(Ce.internal.getHeight(n))+" re"),e.push("f"),t.stream=e.join(`\n`),t}}},createDefaultAppearanceStream:function(n){var t=n.scope.internal.getFont(n.fontName,n.fontStyle).id,e=n.scope.__private__.encodeColorString(n.color);return"/"+t+" "+n.fontSize+" Tf "+e}};Ce.internal={Bezier_C:.551915024494,calculateCross:function(n){var t=Ce.internal.getWidth(n),e=Ce.internal.getHeight(n),i=Math.min(t,e);return{x1:{x:(t-i)/2,y:(e-i)/2+i},x2:{x:(t-i)/2+i,y:(e-i)/2},x3:{x:(t-i)/2,y:(e-i)/2},x4:{x:(t-i)/2+i,y:(e-i)/2+i}}}},Ce.internal.getWidth=function(n){var t=0;return An(n)==="object"&&(t=ep(n.Rect[2])),t},Ce.internal.getHeight=function(n){var t=0;return An(n)==="object"&&(t=ep(n.Rect[3])),t};var ix=Xn.addField=function(n){if(rx(this,n),!(n instanceof xi))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=n).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),n.page=n.scope.internal.getCurrentPageInfo().pageNumber,this};Xn.AcroFormChoiceField=_o,Xn.AcroFormListBox=So,Xn.AcroFormComboBox=Ao,Xn.AcroFormEditBox=Wl,Xn.AcroFormButton=fr,Xn.AcroFormPushButton=ql,Xn.AcroFormRadioButton=Co,Xn.AcroFormCheckBox=Xl,Xn.AcroFormTextField=Gs,Xn.AcroFormPasswordField=Gl,Xn.AcroFormAppearance=Ce,Xn.AcroForm={ChoiceField:_o,ListBox:So,ComboBox:Ao,EditBox:Wl,Button:fr,PushButton:ql,RadioButton:Co,CheckBox:Xl,TextField:Gs,PasswordField:Gl,Appearance:Ce},De.AcroForm={ChoiceField:_o,ListBox:So,ComboBox:Ao,EditBox:Wl,Button:fr,PushButton:ql,RadioButton:Co,CheckBox:Xl,TextField:Gs,PasswordField:Gl,Appearance:Ce};De.AcroForm;function j2(n){return n.reduce(function(t,e,i){return t[e]=i,t},{})}(function(n){var t="addImage_";n.__addimage__={};var e="UNKNOWN",i={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=n.__addimage__.getImageFileTypeByImageData=function(R,M){var $,S,J,mt,ot,ft=e;if((M=M||e)==="RGBA"||R.data!==void 0&&R.data instanceof Uint8ClampedArray&&"height"in R&&"width"in R)return"RGBA";if(q(R))for(ot in i)for(J=i[ot],$=0;$<J.length;$+=1){for(mt=!0,S=0;S<J[$].length;S+=1)if(J[$][S]!==void 0&&J[$][S]!==R[S]){mt=!1;break}if(mt===!0){ft=ot;break}}else for(ot in i)for(J=i[ot],$=0;$<J.length;$+=1){for(mt=!0,S=0;S<J[$].length;S+=1)if(J[$][S]!==void 0&&J[$][S]!==R.charCodeAt(S)){mt=!1;break}if(mt===!0){ft=ot;break}}return ft===e&&M!==e&&(ft=M),ft},s=function R(M){for(var $=this.internal.write,S=this.internal.putStream,J=(0,this.internal.getFilters)();J.indexOf("FlateEncode")!==-1;)J.splice(J.indexOf("FlateEncode"),1);M.objectId=this.internal.newObject();var mt=[];if(mt.push({key:"Type",value:"/XObject"}),mt.push({key:"Subtype",value:"/Image"}),mt.push({key:"Width",value:M.width}),mt.push({key:"Height",value:M.height}),M.colorSpace===m.INDEXED?mt.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(M.palette.length/3-1)+" "+("sMask"in M&&M.sMask!==void 0?M.objectId+2:M.objectId+1)+" 0 R]"}):(mt.push({key:"ColorSpace",value:"/"+M.colorSpace}),M.colorSpace===m.DEVICE_CMYK&&mt.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),mt.push({key:"BitsPerComponent",value:M.bitsPerComponent}),"decodeParameters"in M&&M.decodeParameters!==void 0&&mt.push({key:"DecodeParms",value:"<<"+M.decodeParameters+">>"}),"transparency"in M&&Array.isArray(M.transparency)&&M.transparency.length>0){for(var ot="",ft=0,ct=M.transparency.length;ft<ct;ft++)ot+=M.transparency[ft]+" "+M.transparency[ft]+" ";mt.push({key:"Mask",value:"["+ot+"]"})}M.sMask!==void 0&&mt.push({key:"SMask",value:M.objectId+1+" 0 R"});var Bt=M.filter!==void 0?["/"+M.filter]:void 0;if(S({data:M.data,additionalKeyValues:mt,alreadyAppliedFilters:Bt,objectId:M.objectId}),$("endobj"),"sMask"in M&&M.sMask!==void 0){var at,P=(at=M.sMaskBitsPerComponent)!==null&&at!==void 0?at:M.bitsPerComponent,Y={width:M.width,height:M.height,colorSpace:"DeviceGray",bitsPerComponent:P,data:M.sMask};"filter"in M&&(Y.decodeParameters="/Predictor ".concat(M.predictor," /Colors 1 /BitsPerComponent ").concat(P," /Columns ").concat(M.width),Y.filter=M.filter),R.call(this,Y)}if(M.colorSpace===m.INDEXED){var K=this.internal.newObject();S({data:B(new Uint8Array(M.palette)),objectId:K}),$("endobj")}},a=function(){var R=this.internal.collections[t+"images"];for(var M in R)s.call(this,R[M])},o=function(){var R,M=this.internal.collections[t+"images"],$=this.internal.write;for(var S in M)$("/I"+(R=M[S]).index,R.objectId,"0","R")},l=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var R=this.internal.collections[t+"images"];return l.call(this),R},h=function(){return Object.keys(this.internal.collections[t+"images"]).length},f=function(R){return typeof n["process"+R.toUpperCase()]=="function"},d=function(R){return An(R)==="object"&&R.nodeType===1},u=function(R,M){if(R.nodeName==="IMG"&&R.hasAttribute("src")){var $=""+R.getAttribute("src");if($.indexOf("data:image/")===0)return Ul(unescape($).split("base64,").pop());var S=n.loadFile($,!0);if(S!==void 0)return S}if(R.nodeName==="CANVAS"){if(R.width===0||R.height===0)throw new Error("Given canvas must have data. Canvas width: "+R.width+", height: "+R.height);var J;switch(M){case"PNG":J="image/png";break;case"WEBP":J="image/webp";break;default:J="image/jpeg"}return Ul(R.toDataURL(J,1).split("base64,").pop())}},y=function(R){var M=this.internal.collections[t+"images"];if(M){for(var $ in M)if(R===M[$].alias)return M[$]}},g=function(R,M,$){return R||M||(R=-96,M=-96),R<0&&(R=-1*$.width*72/R/this.internal.scaleFactor),M<0&&(M=-1*$.height*72/M/this.internal.scaleFactor),R===0&&(R=M*$.width/$.height),M===0&&(M=R*$.height/$.width),[R,M]},w=function(R,M,$,S,J,mt){var ot=g.call(this,$,S,J),ft=this.internal.getCoordinateString,ct=this.internal.getVerticalCoordinateString,Bt=c.call(this);if($=ot[0],S=ot[1],Bt[J.index]=J,mt){mt*=Math.PI/180;var at=Math.cos(mt),P=Math.sin(mt),Y=function(et){return et.toFixed(4)},K=[Y(at),Y(P),Y(-1*P),Y(at),0,0,"cm"]}this.internal.write("q"),mt?(this.internal.write([1,"0","0",1,ft(R),ct(M+S),"cm"].join(" ")),this.internal.write(K.join(" ")),this.internal.write([ft($),"0","0",ft(S),"0","0","cm"].join(" "))):this.internal.write([ft($),"0","0",ft(S),ft(R),ct(M+S),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+J.index+" Do"),this.internal.write("Q")},m=n.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};n.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var x=n.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},_=n.__addimage__.sHashCode=function(R){var M,$,S=0;if(typeof R=="string")for($=R.length,M=0;M<$;M++)S=(S<<5)-S+R.charCodeAt(M),S|=0;else if(q(R))for($=R.byteLength/2,M=0;M<$;M++)S=(S<<5)-S+R[M],S|=0;return S},L=n.__addimage__.validateStringAsBase64=function(R){(R=R||"").toString().trim();var M=!0;return R.length===0&&(M=!1),R.length%4!=0&&(M=!1),/^[A-Za-z0-9+/]+$/.test(R.substr(0,R.length-2))===!1&&(M=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(R.substr(-2))===!1&&(M=!1),M},T=n.__addimage__.extractImageFromDataUrl=function(R){if(R==null||!(R=R.trim()).startsWith("data:"))return null;var M=R.indexOf(",");return M<0?null:R.substring(0,M).trim().endsWith("base64")?R.substring(M+1):null};n.__addimage__.isArrayBuffer=function(R){return R instanceof ArrayBuffer};var q=n.__addimage__.isArrayBufferView=function(R){return R instanceof Int8Array||R instanceof Uint8Array||R instanceof Uint8ClampedArray||R instanceof Int16Array||R instanceof Uint16Array||R instanceof Int32Array||R instanceof Uint32Array||R instanceof Float32Array||R instanceof Float64Array},U=n.__addimage__.binaryStringToUint8Array=function(R){for(var M=R.length,$=new Uint8Array(M),S=0;S<M;S++)$[S]=R.charCodeAt(S);return $},B=n.__addimage__.arrayBufferToBinaryString=function(R){for(var M="",$=q(R)?R:new Uint8Array(R),S=0;S<$.length;S+=8192)M+=String.fromCharCode.apply(null,$.subarray(S,S+8192));return M};n.addImage=function(){var R,M,$,S,J,mt,ot,ft,ct;if(typeof arguments[1]=="number"?(M=e,$=arguments[1],S=arguments[2],J=arguments[3],mt=arguments[4],ot=arguments[5],ft=arguments[6],ct=arguments[7]):(M=arguments[1],$=arguments[2],S=arguments[3],J=arguments[4],mt=arguments[5],ot=arguments[6],ft=arguments[7],ct=arguments[8]),An(R=arguments[0])==="object"&&!d(R)&&"imageData"in R){var Bt=R;R=Bt.imageData,M=Bt.format||M||e,$=Bt.x||$||0,S=Bt.y||S||0,J=Bt.w||Bt.width||J,mt=Bt.h||Bt.height||mt,ot=Bt.alias||ot,ft=Bt.compression||ft,ct=Bt.rotation||Bt.angle||ct}var at=this.internal.getFilters();if(ft===void 0&&at.indexOf("FlateEncode")!==-1&&(ft="SLOW"),isNaN($)||isNaN(S))throw new Error("Invalid coordinates passed to jsPDF.addImage");l.call(this);var P=O.call(this,R,M,ot,ft);return w.call(this,$,S,J,mt,P,ct),this};var O=function(R,M,$,S){var J,mt,ot;if(typeof R=="string"&&r(R)===e){R=unescape(R);var ft=X(R,!1);(ft!==""||(ft=n.loadFile(R,!0))!==void 0)&&(R=ft)}if(d(R)&&(R=u(R,M)),M=r(R,M),!f(M))throw new Error("addImage does not support files of type \'"+M+"\', please ensure that a plugin for \'"+M+"\' support is added.");if(((ot=$)==null||ot.length===0)&&($=(function(ct){return typeof ct=="string"||q(ct)?_(ct):q(ct.data)?_(ct.data):null})(R)),(J=y.call(this,$))||(R instanceof Uint8Array||M==="RGBA"||(mt=R,R=U(R)),J=this["process"+M.toUpperCase()](R,h.call(this),$,(function(ct){return ct&&typeof ct=="string"&&(ct=ct.toUpperCase()),ct in n.image_compression?ct:x.NONE})(S),mt)),!J)throw new Error("An unknown error occurred whilst processing the image.");return J},X=n.__addimage__.convertBase64ToBinaryString=function(R,M){M=typeof M!="boolean"||M;var $,S="";if(typeof R=="string"){var J;$=(J=T(R))!==null&&J!==void 0?J:R;try{S=Ul($)}catch(mt){if(M)throw L($)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+mt.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return S};n.getImageProperties=function(R){var M,$,S="";if(d(R)&&(R=u(R)),typeof R=="string"&&r(R)===e&&((S=X(R,!1))===""&&(S=n.loadFile(R)||""),R=S),$=r(R),!f($))throw new Error("addImage does not support files of type \'"+$+"\', please ensure that a plugin for \'"+$+"\' support is added.");if(R instanceof Uint8Array||(R=U(R)),!(M=this["process"+$.toUpperCase()](R)))throw new Error("An unknown error occurred whilst processing the image");return M.fileType=$,M}})(De.API),(function(n){var t=function(e){if(e!==void 0&&e!="")return!0};De.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),n.events.push(["putPage",function(e){for(var i,r,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,l=this.internal.getPageInfoByObjId(e.objId),c=e.pageContext.annotations,h=!1,f=0;f<c.length&&!h;f++)switch((i=c[f]).type){case"link":(t(i.options.url)||t(i.options.pageNumber))&&(h=!0);break;case"reference":case"text":case"freetext":h=!0}if(h!=0){this.internal.write("/Annots [");for(var d=0;d<c.length;d++){i=c[d];var u=this.internal.pdfEscape,y=this.internal.getEncryptor(e.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),w=this.internal.newAdditionalObject(),m=this.internal.getEncryptor(g.objId),x=i.title||"Note";s="<</Type /Annot /Subtype /Text "+(r="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y)+"] ")+"/Contents ("+u(m(i.contents))+")",s+=" /Popup "+w.objId+" 0 R",s+=" /P "+l.objId+" 0 R",s+=" /T ("+u(m(x))+") >>",g.content=s;var _=g.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+a(i.bounds.x+30)+" "+o(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w+30)+" "+o(i.bounds.y)+"] ")+" /Parent "+_,i.open&&(s+=" /Open true"),s+=" >>",w.content=s,this.internal.write(g.objId,"0 R",w.objId,"0 R");break;case"freetext":r="/Rect ["+a(i.bounds.x)+" "+o(i.bounds.y)+" "+a(i.bounds.x+i.bounds.w)+" "+o(i.bounds.y+i.bounds.h)+"] ";var L=i.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+u(y(i.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+L+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(i.options.name){var T=this.annotations._nameMap[i.options.name];i.options.pageNumber=T.page,i.options.top=T.y}else i.options.top||(i.options.top=0);if(r="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",s="",i.options.url)s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+u(y(i.options.url))+") >>";else if(i.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,s+=" /FitV "+i.options.left+"]";break;default:var q=o(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),s+=" /XYZ "+i.options.left+" "+q+" "+i.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),n.createAnnotation=function(e){var i=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":i.pageContext.annotations.push(e)}},n.link=function(e,i,r,s,a){var o=this.internal.getCurrentPageInfo(),l=this.internal.getCoordinateString,c=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:l(e),y:c(i),w:l(e+r),h:c(i+s)},options:a,type:"link"})},n.textWithLink=function(e,i,r,s){var a,o,l=this.getTextWidth(e),c=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var h=this.splitTextToSize(e,o).length;a=Math.ceil(c*h)}else o=l,a=c;return this.text(e,i,r,s),r+=.2*c,s.align==="center"&&(i-=l/2),s.align==="right"&&(i-=l),this.link(i,r-c,o,a,s),l},n.getTextWidth=function(e){var i=this.internal.getFontSize();return this.getStringUnitWidth(e)*i/this.internal.scaleFactor}})(De.API),(function(n){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},r=[1570,1571,1573,1575];n.__arabicParser__={};var s=n.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},a=n.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\\u0600-\\u06FF\\u0750-\\u077F\\u08A0-\\u08FF\\uFB50-\\uFDFF\\uFE70-\\uFEFF]+$/.test(g)},o=n.__arabicParser__.isArabicEndLetter=function(g){return a(g)&&s(g)&&t[g.charCodeAt(0)].length<=2},l=n.__arabicParser__.isArabicAlfLetter=function(g){return a(g)&&r.indexOf(g.charCodeAt(0))>=0};n.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return a(g)&&s(g)&&t[g.charCodeAt(0)].length>=1};var c=n.__arabicParser__.arabicLetterHasFinalForm=function(g){return a(g)&&s(g)&&t[g.charCodeAt(0)].length>=2};n.__arabicParser__.arabicLetterHasInitialForm=function(g){return a(g)&&s(g)&&t[g.charCodeAt(0)].length>=3};var h=n.__arabicParser__.arabicLetterHasMedialForm=function(g){return a(g)&&s(g)&&t[g.charCodeAt(0)].length==4},f=n.__arabicParser__.resolveLigatures=function(g){var w=0,m=e,x="",_=0;for(w=0;w<g.length;w+=1)m[g.charCodeAt(w)]!==void 0?(_++,typeof(m=m[g.charCodeAt(w)])=="number"&&(x+=String.fromCharCode(m),m=e,_=0),w===g.length-1&&(m=e,x+=g.charAt(w-(_-1)),w-=_-1,_=0)):(m=e,x+=g.charAt(w-_),w-=_,_=0);return x};n.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&i[g.charCodeAt(0)]!==void 0};var d=n.__arabicParser__.getCorrectForm=function(g,w,m){return a(g)?s(g)===!1?-1:!c(g)||!a(w)&&!a(m)||!a(m)&&o(w)||o(g)&&!a(w)||o(g)&&l(w)||o(g)&&o(w)?0:h(g)&&a(w)&&!o(w)&&a(m)&&c(m)?3:o(g)||!a(m)?1:2:-1},u=function(g){var w=0,m=0,x=0,_="",L="",T="",q=(g=g||"").split("\\\\s+"),U=[];for(w=0;w<q.length;w+=1){for(U.push(""),m=0;m<q[w].length;m+=1)_=q[w][m],L=q[w][m-1],T=q[w][m+1],a(_)?(x=d(_,L,T),U[w]+=x!==-1?String.fromCharCode(t[_.charCodeAt(0)][x]):_):U[w]+=_;U[w]=f(U[w])}return U.join(" ")},y=n.__arabicParser__.processArabic=n.processArabic=function(){var g,w=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,m=[];if(Array.isArray(w)){var x=0;for(m=[],x=0;x<w.length;x+=1)Array.isArray(w[x])?m.push([u(w[x][0]),w[x][1],w[x][2]]):m.push([u(w[x])]);g=m}else g=u(w);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};n.events.push(["preProcessText",y])})(De.API),De.API.autoPrint=function(n){var t;return(n=n||{}).variant=n.variant||"non-conform",n.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},(function(n){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var r=300;Object.defineProperty(this,"height",{get:function(){return r},set:function(o){r=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=r+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,i){var r;if((e=e||"2d")!=="2d")return null;for(r in i)this.pdf.context2d.hasOwnProperty(r)&&(this.pdf.context2d[r]=i[r]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},n.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])})(De.API),(function(n){var t={left:0,top:0,bottom:0,right:0},e=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),r.call(this))},r=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var l=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return l},set:function(g){l=g}});var c=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var h=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var f=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return f},set:function(g){f=g}});var d=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return d},set:function(g){d=g}});var u=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var y=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return y},set:function(g){y=g}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},n.setHeaderFunction=function(l){return i.call(this),this.internal.__cell__.headerFunction=typeof l=="function"?l:void 0,this},n.getTextDimensions=function(l,c){i.call(this);var h=(c=c||{}).fontSize||this.getFontSize(),f=c.font||this.getFont(),d=c.scaleFactor||this.internal.scaleFactor,u=0,y=0,g=0,w=this;if(!Array.isArray(l)&&typeof l!="string"){if(typeof l!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");l=String(l)}var m=c.maxWidth;m>0?typeof l=="string"?l=this.splitTextToSize(l,m):Object.prototype.toString.call(l)==="[object Array]"&&(l=l.reduce(function(_,L){return _.concat(w.splitTextToSize(L,m))},[])):l=Array.isArray(l)?l:[l];for(var x=0;x<l.length;x++)u<(g=this.getStringUnitWidth(l[x],{font:f})*h)&&(u=g);return u!==0&&(y=l.length),{w:u/=d,h:Math.max((y*h*this.getLineHeightFactor()-h*(this.getLineHeightFactor()-1))/d,0)}},n.cellAddPage=function(){i.call(this),this.addPage();var l=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new s(l.left,l.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=n.cell=function(){var l;l=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),i.call(this);var c=this.internal.__cell__.lastCell,h=this.internal.__cell__.padding,f=this.internal.__cell__.margins||t,d=this.internal.__cell__.tableHeaderRow,u=this.internal.__cell__.printHeaders;return c.lineNumber!==void 0&&(c.lineNumber===l.lineNumber?(l.x=(c.x||0)+(c.width||0),l.y=c.y||0):c.y+c.height+l.height+f.bottom>this.getPageHeight()?(this.cellAddPage(),l.y=f.top,u&&d&&(this.printHeaderRow(l.lineNumber,!0),l.y+=d[0].height)):l.y=c.y+c.height||l.y),l.text[0]!==void 0&&(this.rect(l.x,l.y,l.width,l.height,e===!0?"FD":void 0),l.align==="right"?this.text(l.text,l.x+l.width-h,l.y+h,{align:"right",baseline:"top"}):l.align==="center"?this.text(l.text,l.x+l.width/2,l.y+h,{align:"center",baseline:"top",maxWidth:l.width-h-h}):this.text(l.text,l.x+h,l.y+h,{align:"left",baseline:"top",maxWidth:l.width-h-h})),this.internal.__cell__.lastCell=l,this};n.table=function(l,c,h,f,d){if(i.call(this),!h)throw new Error("No data for PDF table.");var u,y,g,w,m=[],x=[],_=[],L={},T={},q=[],U=[],B=(d=d||{}).autoSize||!1,O=d.printHeaders!==!1,X=d.css&&d.css["font-size"]!==void 0?16*d.css["font-size"]:d.fontSize||12,R=d.margins||Object.assign({width:this.getPageWidth()},t),M=typeof d.padding=="number"?d.padding:3,$=d.headerBackgroundColor||"#c8c8c8",S=d.headerTextColor||"#000";if(r.call(this),this.internal.__cell__.printHeaders=O,this.internal.__cell__.margins=R,this.internal.__cell__.table_font_size=X,this.internal.__cell__.padding=M,this.internal.__cell__.headerBackgroundColor=$,this.internal.__cell__.headerTextColor=S,this.setFontSize(X),f==null)x=m=Object.keys(h[0]),_=m.map(function(){return"left"});else if(Array.isArray(f)&&An(f[0])==="object")for(m=f.map(function(Bt){return Bt.name}),x=f.map(function(Bt){return Bt.prompt||Bt.name||""}),_=f.map(function(Bt){return Bt.align||"left"}),u=0;u<f.length;u+=1)T[f[u].name]=.7499990551181103*f[u].width;else Array.isArray(f)&&typeof f[0]=="string"&&(x=m=f,_=m.map(function(){return"left"}));if(B||Array.isArray(f)&&typeof f[0]=="string")for(u=0;u<m.length;u+=1){for(L[w=m[u]]=h.map(function(Bt){return Bt[w]}),this.setFont(void 0,"bold"),q.push(this.getTextDimensions(x[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),y=L[w],this.setFont(void 0,"normal"),g=0;g<y.length;g+=1)q.push(this.getTextDimensions(y[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);T[w]=Math.max.apply(null,q)+M+M,q=[]}if(O){var J={};for(u=0;u<m.length;u+=1)J[m[u]]={},J[m[u]].text=x[u],J[m[u]].align=_[u];var mt=o.call(this,J,T);U=m.map(function(Bt){return new s(l,c,T[Bt],mt,J[Bt].text,void 0,J[Bt].align)}),this.setTableHeaderRow(U),this.printHeaderRow(1,!1)}var ot=f.reduce(function(Bt,at){return Bt[at.name]=at.align,Bt},{});for(u=0;u<h.length;u+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:u,data:h[u]},this);var ft=o.call(this,h[u],T);for(g=0;g<m.length;g+=1){var ct=h[u][m[g]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:u,col:g,data:ct},this),a.call(this,new s(l,c,T[m[g]],ft,ct,u+2,ot[m[g]]))}}return this.internal.__cell__.table_x=l,this.internal.__cell__.table_y=c,this};var o=function(l,c){var h=this.internal.__cell__.padding,f=this.internal.__cell__.table_font_size,d=this.internal.scaleFactor;return Object.keys(l).map(function(u){var y=l[u];return this.splitTextToSize(y.hasOwnProperty("text")?y.text:y,c[u]-h-h)},this).map(function(u){return this.getLineHeightFactor()*u.length*f/d+h+h},this).reduce(function(u,y){return Math.max(u,y)},0)};n.setTableHeaderRow=function(l){i.call(this),this.internal.__cell__.tableHeaderRow=l},n.printHeaderRow=function(l,c){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var h;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var f=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(f[0],f[1],f[2],f[3],void 0,-1)}this.setFont(void 0,"bold");for(var d=[],u=0;u<this.internal.__cell__.tableHeaderRow.length;u+=1){h=this.internal.__cell__.tableHeaderRow[u].clone(),c&&(h.y=this.internal.__cell__.margins.top||0,d.push(h)),h.lineNumber=l;var y=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,h),this.setTextColor(y)}d.length>0&&this.setTableHeaderRow(d),this.setFont(void 0,"normal"),e=!1}})(De.API);var U2={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},W2=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],bu=j2(W2),q2=[100,200,300,400,500,600,700,800,900],sx=j2(q2);function Eh(n){var t=n.family.replace(/"|\'/g,"").toLowerCase(),e=(function(s){return U2[s=s||"normal"]?s:"normal"})(n.style),i=(function(s){return s?typeof s=="number"?s>=100&&s<=900&&s%100==0?s:400:/^\\d00$/.test(s)?parseInt(s):s==="bold"?700:400:400})(n.weight),r=(function(s){return typeof bu[s=s||"normal"]=="number"?s:"normal"})(n.stretch);return{family:t,style:e,weight:i,stretch:r,src:n.src||[],ref:n.ref||{name:t,style:[r,e,i].join(" ")}}}function np(n,t,e,i){var r;for(r=e;r>=0&&r<t.length;r+=i)if(n[t[r]])return n[t[r]];for(r=e;r>=0&&r<t.length;r-=i)if(n[t[r]])return n[t[r]]}var ox={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},rp={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function ip(n){return[n.stretch,n.style,n.weight,n.family].join(" ")}function sp(n){return n.trimLeft()}function ax(n,t){for(var e=0;e<n.length;){if(n.charAt(e)===t)return[n.substring(0,e),n.substring(e+1)];e+=1}return null}function lx(n){var t=n.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],n.substring(t[0].length)]}var Nl,op,ap,fo,Pl,lp,cp,hp,Dh=["times"];function up(n,t,e,i,r){var s=4,a=dp;switch(r){case De.API.image_compression.FAST:s=1,a=fp;break;case De.API.image_compression.MEDIUM:s=6,a=pp;break;case De.API.image_compression.SLOW:s=9,a=gp}n=(function(l,c,h,f){for(var d,u=l.length/c,y=new Uint8Array(l.length+u),g=[cx,fp,dp,pp,gp],w=0;w<u;w+=1){var m=w*c,x=l.subarray(m,m+c);if(f)y.set(f(x,h,d),m+w);else{for(var _=g.length,L=[],T=0;T<_;T+=1)L[T]=g[T](x,h,d);var q=ux(L.concat());y.set(L[q],m+w)}d=x}return y})(n,t,Math.ceil(e*i/8),a);var o=uu(n,{level:s});return De.API.__addimage__.arrayBufferToBinaryString(o)}function cx(n){var t=Array.apply([],n);return t.unshift(0),t}function fp(n,t){var e=n.length,i=[];i[0]=1;for(var r=0;r<e;r+=1){var s=n[r-t]||0;i[r+1]=n[r]-s+256&255}return i}function dp(n,t,e){var i=n.length,r=[];r[0]=2;for(var s=0;s<i;s+=1){var a=e&&e[s]||0;r[s+1]=n[s]-a+256&255}return r}function pp(n,t,e){var i=n.length,r=[];r[0]=3;for(var s=0;s<i;s+=1){var a=n[s-t]||0,o=e&&e[s]||0;r[s+1]=n[s]+256-(a+o>>>1)&255}return r}function gp(n,t,e){var i=n.length,r=[];r[0]=4;for(var s=0;s<i;s+=1){var a=hx(n[s-t]||0,e&&e[s]||0,e&&e[s-t]||0);r[s+1]=n[s]-a+256&255}return r}function hx(n,t,e){if(n===t&&t===e)return n;var i=Math.abs(t-e),r=Math.abs(n-e),s=Math.abs(n+t-e-e);return i<=r&&i<=s?n:r<=s?t:e}function ux(n){var t=n.map(function(e){return e.reduce(function(i,r){return i+Math.abs(r)},0)});return t.indexOf(Math.min.apply(null,t))}function Fh(n,t,e){var i=t*e,r=Math.floor(i/8),s=16-(i-8*r+e),a=(1<<e)-1;return X2(n,r)>>s&a}function yp(n,t,e,i){var r=e*i,s=Math.floor(r/8),a=16-(r-8*s+i),o=(1<<i)-1,l=(t&o)<<a;(function(c,h,f){if(h+1<c.byteLength)c.setUint16(h,f,!1);else{var d=f>>8&255;c.setUint8(h,d)}})(n,s,X2(n,s)&~(o<<a)&65535|l)}function X2(n,t){return t+1<n.byteLength?n.getUint16(t,!1):n.getUint8(t)<<8}function fx(n){var t=0;if(n[t++]!==71||n[t++]!==73||n[t++]!==70||n[t++]!==56||(n[t++]+1&253)!=56||n[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=n[t++]|n[t++]<<8,i=n[t++]|n[t++]<<8,r=n[t++],s=r>>7,a=1<<1+(7&r);n[t++],n[t++];var o=null,l=null;s&&(o=t,l=a,t+=3*a);var c=!0,h=[],f=0,d=null,u=0,y=null;for(this.width=e,this.height=i;c&&t<n.length;)switch(n[t++]){case 33:switch(n[t++]){case 255:if(n[t]!==11||n[t+1]==78&&n[t+2]==69&&n[t+3]==84&&n[t+4]==83&&n[t+5]==67&&n[t+6]==65&&n[t+7]==80&&n[t+8]==69&&n[t+9]==50&&n[t+10]==46&&n[t+11]==48&&n[t+12]==3&&n[t+13]==1&&n[t+16]==0)t+=14,y=n[t++]|n[t++]<<8,t++;else for(t+=12;;){if(!((R=n[t++])>=0))throw Error("Invalid block size");if(R===0)break;t+=R}break;case 249:if(n[t++]!==4||n[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=n[t++];f=n[t++]|n[t++]<<8,d=n[t++],1&g||(d=null),u=g>>2&7,t++;break;case 254:for(;;){if(!((R=n[t++])>=0))throw Error("Invalid block size");if(R===0)break;t+=R}break;default:throw new Error("Unknown graphic control label: 0x"+n[t-1].toString(16))}break;case 44:var w=n[t++]|n[t++]<<8,m=n[t++]|n[t++]<<8,x=n[t++]|n[t++]<<8,_=n[t++]|n[t++]<<8,L=n[t++],T=L>>6&1,q=1<<1+(7&L),U=o,B=l,O=!1;L>>7&&(O=!0,U=t,B=q,t+=3*q);var X=t;for(t++;;){var R;if(!((R=n[t++])>=0))throw Error("Invalid block size");if(R===0)break;t+=R}h.push({x:w,y:m,width:x,height:_,has_local_palette:O,palette_offset:U,palette_size:B,data_offset:X,data_length:t-X,transparent_index:d,interlaced:!!T,delay:f,disposal:u});break;case 59:c=!1;break;default:throw new Error("Unknown gif block: 0x"+n[t-1].toString(16))}this.numFrames=function(){return h.length},this.loopCount=function(){return y},this.frameInfo=function(M){if(M<0||M>=h.length)throw new Error("Frame index out of range.");return h[M]},this.decodeAndBlitFrameBGRA=function(M,$){var S=this.frameInfo(M),J=S.width*S.height,mt=new Uint8Array(J);mp(n,S.data_offset,mt,J);var ot=S.palette_offset,ft=S.transparent_index;ft===null&&(ft=256);var ct=S.width,Bt=e-ct,at=ct,P=4*(S.y*e+S.x),Y=4*((S.y+S.height)*e+S.x),K=P,et=4*Bt;S.interlaced===!0&&(et+=4*e*7);for(var gt=8,kt=0,_t=mt.length;kt<_t;++kt){var Pt=mt[kt];if(at===0&&(at=ct,(K+=et)>=Y&&(et=4*Bt+4*e*(gt-1),K=P+(ct+Bt)*(gt<<1),gt>>=1)),Pt===ft)K+=4;else{var jt=n[ot+3*Pt],Zt=n[ot+3*Pt+1],pe=n[ot+3*Pt+2];$[K++]=pe,$[K++]=Zt,$[K++]=jt,$[K++]=255}--at}},this.decodeAndBlitFrameRGBA=function(M,$){var S=this.frameInfo(M),J=S.width*S.height,mt=new Uint8Array(J);mp(n,S.data_offset,mt,J);var ot=S.palette_offset,ft=S.transparent_index;ft===null&&(ft=256);var ct=S.width,Bt=e-ct,at=ct,P=4*(S.y*e+S.x),Y=4*((S.y+S.height)*e+S.x),K=P,et=4*Bt;S.interlaced===!0&&(et+=4*e*7);for(var gt=8,kt=0,_t=mt.length;kt<_t;++kt){var Pt=mt[kt];if(at===0&&(at=ct,(K+=et)>=Y&&(et=4*Bt+4*e*(gt-1),K=P+(ct+Bt)*(gt<<1),gt>>=1)),Pt===ft)K+=4;else{var jt=n[ot+3*Pt],Zt=n[ot+3*Pt+1],pe=n[ot+3*Pt+2];$[K++]=jt,$[K++]=Zt,$[K++]=pe,$[K++]=255}--at}}}function mp(n,t,e,i){for(var r=n[t++],s=1<<r,a=s+1,o=a+1,l=r+1,c=(1<<l)-1,h=0,f=0,d=0,u=n[t++],y=new Int32Array(4096),g=null;;){for(;h<16&&u!==0;)f|=n[t++]<<h,h+=8,u===1?u=n[t++]:--u;if(h<l)break;var w=f&c;if(f>>=l,h-=l,w!==s){if(w===a)break;for(var m=w<o?w:g,x=0,_=m;_>s;)_=y[_]>>8,++x;var L=_;if(d+x+(m!==w?1:0)>i)return void Pn.log("Warning, gif stream longer than expected.");e[d++]=L;var T=d+=x;for(m!==w&&(e[d++]=L),_=m;x--;)_=y[_],e[--T]=255&_,_>>=8;g!==null&&o<4096&&(y[o++]=g<<8|L,o>=c+1&&l<12&&(++l,c=c<<1|1)),g=w}else o=a+1,c=(1<<(l=r+1))-1,g=null}return d!==i&&Pn.log("Warning, gif stream shorter than expected."),e}function $h(n){var t,e,i,r,s,a=Math.floor,o=new Array(64),l=new Array(64),c=new Array(64),h=new Array(64),f=new Array(65535),d=new Array(65535),u=new Array(64),y=new Array(64),g=[],w=0,m=7,x=new Array(64),_=new Array(64),L=new Array(64),T=new Array(256),q=new Array(2048),U=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],B=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],X=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],R=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],M=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],J=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function mt(P,Y){for(var K=0,et=0,gt=new Array,kt=1;kt<=16;kt++){for(var _t=1;_t<=P[kt];_t++)gt[Y[et]]=[],gt[Y[et]][0]=K,gt[Y[et]][1]=kt,et++,K++;K*=2}return gt}function ot(P){for(var Y=P[0],K=P[1]-1;K>=0;)Y&1<<K&&(w|=1<<m),K--,--m<0&&(w==255?(ft(255),ft(0)):ft(w),m=7,w=0)}function ft(P){g.push(P)}function ct(P){ft(P>>8&255),ft(255&P)}function Bt(P,Y,K,et,gt){for(var kt,_t=gt[0],Pt=gt[240],jt=(function(nt,Ct){var It,dt,Et,ee,Gt,re,ke,me,be,ze,ve=0;for(be=0;be<8;++be){It=nt[ve],dt=nt[ve+1],Et=nt[ve+2],ee=nt[ve+3],Gt=nt[ve+4],re=nt[ve+5],ke=nt[ve+6];var an=It+(me=nt[ve+7]),Ie=It-me,qe=dt+ke,Xe=dt-ke,cn=Et+re,Te=Et-re,mn=ee+Gt,$e=ee-Gt,Ge=an+mn,vn=an-mn,He=qe+cn,Ee=qe-cn;nt[ve]=Ge+He,nt[ve+4]=Ge-He;var dn=.707106781*(Ee+vn);nt[ve+2]=vn+dn,nt[ve+6]=vn-dn;var Ii=.382683433*((Ge=$e+Te)-(Ee=Xe+Ie)),ur=.5411961*Ge+Ii,v=1.306562965*Ee+Ii,Z=.707106781*(He=Te+Xe),lt=Ie+Z,ht=Ie-Z;nt[ve+5]=ht+ur,nt[ve+3]=ht-ur,nt[ve+1]=lt+v,nt[ve+7]=lt-v,ve+=8}for(ve=0,be=0;be<8;++be){It=nt[ve],dt=nt[ve+8],Et=nt[ve+16],ee=nt[ve+24],Gt=nt[ve+32],re=nt[ve+40],ke=nt[ve+48];var Nt=It+(me=nt[ve+56]),vt=It-me,z=dt+ke,Lt=dt-ke,Ut=Et+re,wt=Et-re,Ot=ee+Gt,zt=ee-Gt,Dt=Nt+Ot,At=Nt-Ot,Ft=z+Ut,se=z-Ut;nt[ve]=Dt+Ft,nt[ve+32]=Dt-Ft;var te=.707106781*(se+At);nt[ve+16]=At+te,nt[ve+48]=At-te;var ae=.382683433*((Dt=zt+wt)-(se=Lt+vt)),$t=.5411961*Dt+ae,le=1.306562965*se+ae,Pe=.707106781*(Ft=wt+Lt),Fe=vt+Pe,Yt=vt-Pe;nt[ve+40]=Yt+$t,nt[ve+24]=Yt-$t,nt[ve+8]=Fe+le,nt[ve+56]=Fe-le,ve++}for(be=0;be<64;++be)ze=nt[be]*Ct[be],u[be]=ze>0?ze+.5|0:ze-.5|0;return u})(P,Y),Zt=0;Zt<64;++Zt)y[U[Zt]]=jt[Zt];var pe=y[0]-K;K=y[0],pe==0?ot(et[0]):(ot(et[d[kt=32767+pe]]),ot(f[kt]));for(var he=63;he>0&&y[he]==0;)he--;if(he==0)return ot(_t),K;for(var I,D=1;D<=he;){for(var pt=D;y[D]==0&&D<=he;)++D;var tt=D-pt;if(tt>=16){I=tt>>4;for(var H=1;H<=I;++H)ot(Pt);tt&=15}kt=32767+y[D],ot(gt[(tt<<4)+d[kt]]),ot(f[kt]),D++}return he!=63&&ot(_t),K}function at(P){P=Math.min(Math.max(P,1),100),s!=P&&((function(Y){for(var K=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],et=0;et<64;et++){var gt=a((K[et]*Y+50)/100);gt=Math.min(Math.max(gt,1),255),o[U[et]]=gt}for(var kt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],_t=0;_t<64;_t++){var Pt=a((kt[_t]*Y+50)/100);Pt=Math.min(Math.max(Pt,1),255),l[U[_t]]=Pt}for(var jt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Zt=0,pe=0;pe<8;pe++)for(var he=0;he<8;he++)c[Zt]=1/(o[U[Zt]]*jt[pe]*jt[he]*8),h[Zt]=1/(l[U[Zt]]*jt[pe]*jt[he]*8),Zt++})(P<50?Math.floor(5e3/P):Math.floor(200-2*P)),s=P)}this.encode=function(P,Y){Y&&at(Y),g=new Array,w=0,m=7,ct(65496),ct(65504),ct(16),ft(74),ft(70),ft(73),ft(70),ft(0),ft(1),ft(1),ft(0),ct(1),ct(1),ft(0),ft(0),(function(){ct(65499),ct(132),ft(0);for(var dt=0;dt<64;dt++)ft(o[dt]);ft(1);for(var Et=0;Et<64;Et++)ft(l[Et])})(),(function(dt,Et){ct(65472),ct(17),ft(8),ct(Et),ct(dt),ft(3),ft(1),ft(17),ft(0),ft(2),ft(17),ft(1),ft(3),ft(17),ft(1)})(P.width,P.height),(function(){ct(65476),ct(418),ft(0);for(var dt=0;dt<16;dt++)ft(B[dt+1]);for(var Et=0;Et<=11;Et++)ft(O[Et]);ft(16);for(var ee=0;ee<16;ee++)ft(X[ee+1]);for(var Gt=0;Gt<=161;Gt++)ft(R[Gt]);ft(1);for(var re=0;re<16;re++)ft(M[re+1]);for(var ke=0;ke<=11;ke++)ft($[ke]);ft(17);for(var me=0;me<16;me++)ft(S[me+1]);for(var be=0;be<=161;be++)ft(J[be])})(),ct(65498),ct(12),ft(3),ft(1),ft(0),ft(2),ft(17),ft(3),ft(17),ft(0),ft(63),ft(0);var K=0,et=0,gt=0;w=0,m=7,this.encode.displayName="_encode_";for(var kt,_t,Pt,jt,Zt,pe,he,I,D,pt=P.data,tt=P.width,H=P.height,nt=4*tt,Ct=0;Ct<H;){for(kt=0;kt<nt;){for(Zt=nt*Ct+kt,he=-1,I=0,D=0;D<64;D++)pe=Zt+(I=D>>3)*nt+(he=4*(7&D)),Ct+I>=H&&(pe-=nt*(Ct+1+I-H)),kt+he>=nt&&(pe-=kt+he-nt+4),_t=pt[pe++],Pt=pt[pe++],jt=pt[pe++],x[D]=(q[_t]+q[Pt+256|0]+q[jt+512|0]>>16)-128,_[D]=(q[_t+768|0]+q[Pt+1024|0]+q[jt+1280|0]>>16)-128,L[D]=(q[_t+1280|0]+q[Pt+1536|0]+q[jt+1792|0]>>16)-128;K=Bt(x,c,K,t,i),et=Bt(_,h,et,e,r),gt=Bt(L,h,gt,e,r),kt+=32}Ct+=8}if(m>=0){var It=[];It[1]=m+1,It[0]=(1<<m+1)-1,ot(It)}return ct(65497),new Uint8Array(g)},n=n||50,(function(){for(var P=String.fromCharCode,Y=0;Y<256;Y++)T[Y]=P(Y)})(),t=mt(B,O),e=mt(M,$),i=mt(X,R),r=mt(S,J),(function(){for(var P=1,Y=2,K=1;K<=15;K++){for(var et=P;et<Y;et++)d[32767+et]=K,f[32767+et]=[],f[32767+et][1]=K,f[32767+et][0]=et;for(var gt=-(Y-1);gt<=-P;gt++)d[32767+gt]=K,f[32767+gt]=[],f[32767+gt][1]=K,f[32767+gt][0]=Y-1+gt;P<<=1,Y<<=1}})(),(function(){for(var P=0;P<256;P++)q[P]=19595*P,q[P+256|0]=38470*P,q[P+512|0]=7471*P+32768,q[P+768|0]=-11059*P,q[P+1024|0]=-21709*P,q[P+1280|0]=32768*P+8421375,q[P+1536|0]=-27439*P,q[P+1792|0]=-5329*P})(),at(n)}function yi(n,t){if(this.pos=0,this.buffer=n,this.datav=new DataView(n.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function bp(n){function t(O){if(!O)throw Error("assert :P")}function e(O,X,R){for(var M=0;4>M;M++)if(O[X+M]!=R.charCodeAt(M))return!0;return!1}function i(O,X,R,M,$){for(var S=0;S<$;S++)O[X+S]=R[M+S]}function r(O,X,R,M){for(var $=0;$<M;$++)O[X+$]=R}function s(O){return new Int32Array(O)}function a(O,X){for(var R=[],M=0;M<O;M++)R.push(new X);return R}function o(O,X){var R=[];return(function M($,S,J){for(var mt=J[S],ot=0;ot<mt&&($.push(J.length>S+1?[]:new X),!(J.length<S+1));ot++)M($[ot],S+1,J)})(R,0,O),R}var l=function(){var O=this;function X(p,b){for(var A=1<<b-1>>>0;p&A;)A>>>=1;return A?(p&A-1)+A:p}function R(p,b,A,N,F){t(!(N%A));do p[b+(N-=A)]=F;while(0<N)}function M(p,b,A,N,F){if(t(2328>=F),512>=F)var j=s(512);else if((j=s(F))==null)return 0;return(function(W,G,V,rt,bt,Tt){var it,xt,Mt=G,qt=1<<V,Rt=s(16),Xt=s(16);for(t(bt!=0),t(rt!=null),t(W!=null),t(0<V),xt=0;xt<bt;++xt){if(15<rt[xt])return 0;++Rt[rt[xt]]}if(Rt[0]==bt)return 0;for(Xt[1]=0,it=1;15>it;++it){if(Rt[it]>1<<it)return 0;Xt[it+1]=Xt[it]+Rt[it]}for(xt=0;xt<bt;++xt)it=rt[xt],0<rt[xt]&&(Tt[Xt[it]++]=xt);if(Xt[15]==1)return(rt=new $).g=0,rt.value=Tt[0],R(W,Mt,1,qt,rt),qt;var Vt,oe=-1,Jt=qt-1,Be=0,_e=1,sn=1,Me=1<<V;for(xt=0,it=1,bt=2;it<=V;++it,bt<<=1){if(_e+=sn<<=1,0>(sn-=Rt[it]))return 0;for(;0<Rt[it];--Rt[it])(rt=new $).g=it,rt.value=Tt[xt++],R(W,Mt+Be,bt,Me,rt),Be=X(Be,it)}for(it=V+1,bt=2;15>=it;++it,bt<<=1){if(_e+=sn<<=1,0>(sn-=Rt[it]))return 0;for(;0<Rt[it];--Rt[it]){if(rt=new $,(Be&Jt)!=oe){for(Mt+=Me,Vt=1<<(oe=it)-V;15>oe&&!(0>=(Vt-=Rt[oe]));)++oe,Vt<<=1;qt+=Me=1<<(Vt=oe-V),W[G+(oe=Be&Jt)].g=Vt+V,W[G+oe].value=Mt-G-oe}rt.g=it-V,rt.value=Tt[xt++],R(W,Mt+(Be>>V),bt,Me,rt),Be=X(Be,it)}}return _e!=2*Xt[15]-1?0:qt})(p,b,A,N,F,j)}function $(){this.value=this.g=0}function S(){this.value=this.g=0}function J(){this.G=a(5,$),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(Bs,S)}function mt(p,b,A,N){t(p!=null),t(b!=null),t(2147483648>N),p.Ca=254,p.I=0,p.b=-8,p.Ka=0,p.oa=b,p.pa=A,p.Jd=b,p.Yc=A+N,p.Zc=4<=N?A+N-4+1:A,_t(p)}function ot(p,b){for(var A=0;0<b--;)A|=jt(p,128)<<b;return A}function ft(p,b){var A=ot(p,b);return Pt(p)?-A:A}function ct(p,b,A,N){var F,j=0;for(t(p!=null),t(b!=null),t(4294967288>N),p.Sb=N,p.Ra=0,p.u=0,p.h=0,4<N&&(N=4),F=0;F<N;++F)j+=b[A+F]<<8*F;p.Ra=j,p.bb=N,p.oa=b,p.pa=A}function Bt(p){for(;8<=p.u&&p.bb<p.Sb;)p.Ra>>>=8,p.Ra+=p.oa[p.pa+p.bb]<<as-8>>>0,++p.bb,p.u-=8;et(p)&&(p.h=1,p.u=0)}function at(p,b){if(t(0<=b),!p.h&&b<=Ur){var A=K(p)&jr[b];return p.u+=b,Bt(p),A}return p.h=1,p.u=0}function P(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Y(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function K(p){return p.Ra>>>(p.u&as-1)>>>0}function et(p){return t(p.bb<=p.Sb),p.h||p.bb==p.Sb&&p.u>as}function gt(p,b){p.u=b,p.h=et(p)}function kt(p){p.u>=Xi&&(t(p.u>=Xi),Bt(p))}function _t(p){t(p!=null&&p.oa!=null),p.pa<p.Zc?(p.I=(p.oa[p.pa++]|p.I<<8)>>>0,p.b+=8):(t(p!=null&&p.oa!=null),p.pa<p.Yc?(p.b+=8,p.I=p.oa[p.pa++]|p.I<<8):p.Ka?p.b=0:(p.I<<=8,p.b+=8,p.Ka=1))}function Pt(p){return ot(p,1)}function jt(p,b){var A=p.Ca;0>p.b&&_t(p);var N=p.b,F=A*b>>>8,j=(p.I>>>N>F)+0;for(j?(A-=F,p.I-=F+1<<N>>>0):A=F+1,N=A,F=0;256<=N;)F+=8,N>>=8;return N=7^F+ls[N],p.b-=N,p.Ca=(A<<N)-1,j}function Zt(p,b,A){p[b+0]=A>>24&255,p[b+1]=A>>16&255,p[b+2]=A>>8&255,p[b+3]=255&A}function pe(p,b){return p[b+0]|p[b+1]<<8}function he(p,b){return pe(p,b)|p[b+2]<<16}function I(p,b){return pe(p,b)|pe(p,b+2)<<16}function D(p,b){var A=1<<b;return t(p!=null),t(0<b),p.X=s(A),p.X==null?0:(p.Mb=32-b,p.Xa=b,1)}function pt(p,b){t(p!=null),t(b!=null),t(p.Xa==b.Xa),i(b.X,0,p.X,0,1<<b.Xa)}function tt(){this.X=[],this.Xa=this.Mb=0}function H(p,b,A,N){t(A!=null),t(N!=null);var F=A[0],j=N[0];return F==0&&(F=(p*j+b/2)/b),j==0&&(j=(b*F+p/2)/p),0>=F||0>=j?0:(A[0]=F,N[0]=j,1)}function nt(p,b){return p+(1<<b)-1>>>b}function Ct(p,b){return((4278255360&p)+(4278255360&b)>>>0&4278255360)+((16711935&p)+(16711935&b)>>>0&16711935)>>>0}function It(p,b){O[b]=function(A,N,F,j,W,G,V){var rt;for(rt=0;rt<W;++rt){var bt=O[p](G[V+rt-1],F,j+rt);G[V+rt]=Ct(A[N+rt],bt)}}}function dt(){this.ud=this.hd=this.jd=0}function Et(p,b){return((4278124286&(p^b))>>>1)+(p&b)>>>0}function ee(p){return 0<=p&&256>p?p:0>p?0:255<p?255:void 0}function Gt(p,b){return ee(p+(p-b+.5>>1))}function re(p,b,A){return Math.abs(b-A)-Math.abs(p-A)}function ke(p,b,A,N,F,j,W){for(N=j[W-1],A=0;A<F;++A)j[W+A]=N=Ct(p[b+A],N)}function me(p,b,A,N,F){var j;for(j=0;j<A;++j){var W=p[b+j],G=W>>8&255,V=16711935&(V=(V=16711935&W)+((G<<16)+G));N[F+j]=(4278255360&W)+V>>>0}}function be(p,b){b.jd=255&p,b.hd=p>>8&255,b.ud=p>>16&255}function ze(p,b,A,N,F,j){var W;for(W=0;W<N;++W){var G=b[A+W],V=G>>>8,rt=G,bt=255&(bt=(bt=G>>>16)+((p.jd<<24>>24)*(V<<24>>24)>>>5));rt=255&(rt=(rt+=(p.hd<<24>>24)*(V<<24>>24)>>>5)+((p.ud<<24>>24)*(bt<<24>>24)>>>5)),F[j+W]=(4278255360&G)+(bt<<16)+rt}}function ve(p,b,A,N,F){O[b]=function(j,W,G,V,rt,bt,Tt,it,xt){for(V=Tt;V<it;++V)for(Tt=0;Tt<xt;++Tt)rt[bt++]=F(G[N(j[W++])])},O[p]=function(j,W,G,V,rt,bt,Tt){var it=8>>j.b,xt=j.Ea,Mt=j.K[0],qt=j.w;if(8>it)for(j=(1<<j.b)-1,qt=(1<<it)-1;W<G;++W){var Rt,Xt=0;for(Rt=0;Rt<xt;++Rt)Rt&j||(Xt=N(V[rt++])),bt[Tt++]=F(Mt[Xt&qt]),Xt>>=it}else O["VP8LMapColor"+A](V,rt,Mt,qt,bt,Tt,W,G,xt)}}function an(p,b,A,N,F){for(A=b+A;b<A;){var j=p[b++];N[F++]=j>>16&255,N[F++]=j>>8&255,N[F++]=255&j}}function Ie(p,b,A,N,F){for(A=b+A;b<A;){var j=p[b++];N[F++]=j>>16&255,N[F++]=j>>8&255,N[F++]=255&j,N[F++]=j>>24&255}}function qe(p,b,A,N,F){for(A=b+A;b<A;){var j=(W=p[b++])>>16&240|W>>12&15,W=240&W|W>>28&15;N[F++]=j,N[F++]=W}}function Xe(p,b,A,N,F){for(A=b+A;b<A;){var j=(W=p[b++])>>16&248|W>>13&7,W=W>>5&224|W>>3&31;N[F++]=j,N[F++]=W}}function cn(p,b,A,N,F){for(A=b+A;b<A;){var j=p[b++];N[F++]=255&j,N[F++]=j>>8&255,N[F++]=j>>16&255}}function Te(p,b,A,N,F,j){if(j==0)for(A=b+A;b<A;)Zt(N,((j=p[b++])[0]>>24|j[1]>>8&65280|j[2]<<8&16711680|j[3]<<24)>>>0),F+=32;else i(N,F,p,b,A)}function mn(p,b){O[b][0]=O[p+"0"],O[b][1]=O[p+"1"],O[b][2]=O[p+"2"],O[b][3]=O[p+"3"],O[b][4]=O[p+"4"],O[b][5]=O[p+"5"],O[b][6]=O[p+"6"],O[b][7]=O[p+"7"],O[b][8]=O[p+"8"],O[b][9]=O[p+"9"],O[b][10]=O[p+"10"],O[b][11]=O[p+"11"],O[b][12]=O[p+"12"],O[b][13]=O[p+"13"],O[b][14]=O[p+"0"],O[b][15]=O[p+"0"]}function $e(p){return p==Fc||p==$c||p==Qa||p==zc}function Ge(){this.eb=[],this.size=this.A=this.fb=0}function vn(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function He(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ge,this.f.kb=new vn,this.sd=null}function Ee(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function dn(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Ii(p){return alert("todo:WebPSamplerProcessPlane"),p.T}function ur(p,b){var A=p.T,N=b.ba.f.RGBA,F=N.eb,j=N.fb+p.ka*N.A,W=ii[b.ba.S],G=p.y,V=p.O,rt=p.f,bt=p.N,Tt=p.ea,it=p.W,xt=b.cc,Mt=b.dc,qt=b.Mc,Rt=b.Nc,Xt=p.ka,Vt=p.ka+p.T,oe=p.U,Jt=oe+1>>1;for(Xt==0?W(G,V,null,null,rt,bt,Tt,it,rt,bt,Tt,it,F,j,null,null,oe):(W(b.ec,b.fc,G,V,xt,Mt,qt,Rt,rt,bt,Tt,it,F,j-N.A,F,j,oe),++A);Xt+2<Vt;Xt+=2)xt=rt,Mt=bt,qt=Tt,Rt=it,bt+=p.Rc,it+=p.Rc,j+=2*N.A,W(G,(V+=2*p.fa)-p.fa,G,V,xt,Mt,qt,Rt,rt,bt,Tt,it,F,j-N.A,F,j,oe);return V+=p.fa,p.j+Vt<p.o?(i(b.ec,b.fc,G,V,oe),i(b.cc,b.dc,rt,bt,Jt),i(b.Mc,b.Nc,Tt,it,Jt),A--):1&Vt||W(G,V,null,null,rt,bt,Tt,it,rt,bt,Tt,it,F,j+N.A,null,null,oe),A}function v(p,b,A){var N=p.F,F=[p.J];if(N!=null){var j=p.U,W=b.ba.S,G=W==Ka||W==Qa;b=b.ba.f.RGBA;var V=[0],rt=p.ka;V[0]=p.T,p.Kb&&(rt==0?--V[0]:(--rt,F[0]-=p.width),p.j+p.ka+p.T==p.o&&(V[0]=p.o-p.j-rt));var bt=b.eb;rt=b.fb+rt*b.A,p=Xu(N,F[0],p.width,j,V,bt,rt+(G?0:3),b.A),t(A==V),p&&$e(W)&&Ko(bt,rt,G,j,V,b.A)}return 0}function Z(p){var b=p.ma,A=b.ba.S,N=11>A,F=A==Va||A==Za||A==Ka||A==Dc||A==12||$e(A);if(b.memory=null,b.Ib=null,b.Jb=null,b.Nd=null,!Wo(b.Oa,p,F?11:12))return 0;if(F&&$e(A)&&zo(),p.da)alert("todo:use_scaling");else{if(N){if(b.Ib=Ii,p.Kb){if(A=p.U+1>>1,b.memory=s(p.U+2*A),b.memory==null)return 0;b.ec=b.memory,b.fc=0,b.cc=b.ec,b.dc=b.fc+p.U,b.Mc=b.cc,b.Nc=b.dc+A,b.Ib=ur,zo()}}else alert("todo:EmitYUV");F&&(b.Jb=v,N&&fi())}if(N&&!lf){for(p=0;256>p;++p)fg[p]=89858*(p-128)+tl>>Ja,gg[p]=-22014*(p-128)+tl,pg[p]=-45773*(p-128),dg[p]=113618*(p-128)+tl>>Ja;for(p=Jo;p<Wc;++p)b=76283*(p-16)+tl>>Ja,yg[p-Jo]=Ae(b,255),mg[p-Jo]=Ae(b+8>>4,15);lf=1}return 1}function lt(p){var b=p.ma,A=p.U,N=p.T;return t(!(1&p.ka)),0>=A||0>=N?0:(A=b.Ib(p,b),b.Jb!=null&&b.Jb(p,b,A),b.Dc+=A,1)}function ht(p){p.ma.memory=null}function Nt(p,b,A,N){return at(p,8)!=47?0:(b[0]=at(p,14)+1,A[0]=at(p,14)+1,N[0]=at(p,1),at(p,3)!=0?0:!p.h)}function vt(p,b){if(4>p)return p+1;var A=p-2>>1;return(2+(1&p)<<A)+at(b,A)+1}function z(p,b){return 120<b?b-120:1<=(A=((A=Q2[b-1])>>4)*p+(8-(15&A)))?A:1;var A}function Lt(p,b,A){var N=K(A),F=p[b+=255&N].g-8;return 0<F&&(gt(A,A.u+8),N=K(A),b+=p[b].value,b+=N&(1<<F)-1),gt(A,A.u+p[b].g),p[b].value}function Ut(p,b,A){return A.g+=p.g,A.value+=p.value<<b>>>0,t(8>=A.g),p.g}function wt(p,b,A){var N=p.xc;return t((b=N==0?0:p.vc[p.md*(A>>N)+(b>>N)])<p.Wb),p.Ya[b]}function Ot(p,b,A,N){var F=p.ab,j=p.c*b,W=p.C;b=W+b;var G=A,V=N;for(N=p.Ta,A=p.Ua;0<F--;){var rt=p.gc[F],bt=W,Tt=b,it=G,xt=V,Mt=(V=N,G=A,rt.Ea);switch(t(bt<Tt),t(Tt<=rt.nc),rt.hc){case 2:Hn(it,xt,(Tt-bt)*Mt,V,G);break;case 0:var qt=bt,Rt=Tt,Xt=V,Vt=G,oe=(Me=rt).Ea;qt==0&&(Xo(it,xt,null,null,1,Xt,Vt),ke(it,xt+1,0,0,oe-1,Xt,Vt+1),xt+=oe,Vt+=oe,++qt);for(var Jt=1<<Me.b,Be=Jt-1,_e=nt(oe,Me.b),sn=Me.K,Me=Me.w+(qt>>Me.b)*_e;qt<Rt;){var un=sn,or=Me,on=1;for(ro(it,xt,Xt,Vt-oe,1,Xt,Vt);on<oe;){var Ne=(on&~Be)+Jt;Ne>oe&&(Ne=oe),(0,Ho[un[or++]>>8&15])(it,xt+ +on,Xt,Vt+on-oe,Ne-on,Xt,Vt+on),on=Ne}xt+=oe,Vt+=oe,++qt&Be||(Me+=_e)}Tt!=rt.nc&&i(V,G-Mt,V,G+(Tt-bt-1)*Mt,Mt);break;case 1:for(Mt=it,Rt=xt,oe=(it=rt.Ea)-(Vt=it&~(Xt=(xt=1<<rt.b)-1)),qt=nt(it,rt.b),Jt=rt.K,rt=rt.w+(bt>>rt.b)*qt;bt<Tt;){for(Be=Jt,_e=rt,sn=new dt,Me=Rt+Vt,un=Rt+it;Rt<Me;)be(Be[_e++],sn),Yo(sn,Mt,Rt,xt,V,G),Rt+=xt,G+=xt;Rt<un&&(be(Be[_e++],sn),Yo(sn,Mt,Rt,oe,V,G),Rt+=oe,G+=oe),++bt&Xt||(rt+=qt)}break;case 3:if(it==V&&xt==G&&0<rt.b){for(Rt=V,it=Mt=G+(Tt-bt)*Mt-(Vt=(Tt-bt)*nt(rt.Ea,rt.b)),xt=V,Xt=G,qt=[],Vt=(oe=Vt)-1;0<=Vt;--Vt)qt[Vt]=xt[Xt+Vt];for(Vt=oe-1;0<=Vt;--Vt)Rt[it+Vt]=qt[Vt];Xa(rt,bt,Tt,V,Mt,V,G)}else Xa(rt,bt,Tt,it,xt,V,G)}G=N,V=A}V!=A&&i(N,A,G,V,j)}function zt(p,b){var A=p.V,N=p.Ba+p.c*p.C,F=b-p.C;if(t(b<=p.l.o),t(16>=F),0<F){var j=p.l,W=p.Ta,G=p.Ua,V=j.width;if(Ot(p,F,A,N),F=G=[G],t((A=p.C)<(N=b)),t(j.v<j.va),N>j.o&&(N=j.o),A<j.j){var rt=j.j-A;A=j.j,F[0]+=rt*V}if(A>=N?A=0:(F[0]+=4*j.v,j.ka=A-j.j,j.U=j.va-j.v,j.T=N-A,A=1),A){if(G=G[0],11>(A=p.ca).S){var bt=A.f.RGBA,Tt=(N=A.S,F=j.U,j=j.T,rt=bt.eb,bt.A),it=j;for(bt=bt.fb+p.Ma*bt.A;0<it--;){var xt=W,Mt=G,qt=F,Rt=rt,Xt=bt;switch(N){case Ya:Vo(xt,Mt,qt,Rt,Xt);break;case Va:cs(xt,Mt,qt,Rt,Xt);break;case Fc:cs(xt,Mt,qt,Rt,Xt),Ko(Rt,Xt,0,qt,1,0);break;case Qu:Es(xt,Mt,qt,Rt,Xt);break;case Za:Te(xt,Mt,qt,Rt,Xt,1);break;case $c:Te(xt,Mt,qt,Rt,Xt,1),Ko(Rt,Xt,0,qt,1,0);break;case Ka:Te(xt,Mt,qt,Rt,Xt,0);break;case Qa:Te(xt,Mt,qt,Rt,Xt,0),Ko(Rt,Xt,1,qt,1,0);break;case Dc:hs(xt,Mt,qt,Rt,Xt);break;case zc:hs(xt,Mt,qt,Rt,Xt),qu(Rt,Xt,qt,1,0);break;case Ju:us(xt,Mt,qt,Rt,Xt);break;default:t(0)}G+=V,bt+=Tt}p.Ma+=j}else alert("todo:EmitRescaledRowsYUVA");t(p.Ma<=A.height)}}p.C=b,t(p.C<=p.i)}function Dt(p){var b;if(0<p.ua)return 0;for(b=0;b<p.Wb;++b){var A=p.Ya[b].G,N=p.Ya[b].H;if(0<A[1][N[1]+0].g||0<A[2][N[2]+0].g||0<A[3][N[3]+0].g)return 0}return 1}function At(p,b,A,N,F,j){if(p.Z!=0){var W=p.qd,G=p.rd;for(t(ps[p.Z]!=null);b<A;++b)ps[p.Z](W,G,N,F,N,F,j),W=N,G=F,F+=j;p.qd=W,p.rd=G}}function Ft(p,b){var A=p.l.ma,N=A.Z==0||A.Z==1?p.l.j:p.C;if(N=p.C<N?N:p.C,t(b<=p.l.o),b>N){var F=p.l.width,j=A.ca,W=A.tb+F*N,G=p.V,V=p.Ba+p.c*N,rt=p.gc;t(p.ab==1),t(rt[0].hc==3),Si(rt[0],N,b,G,V,j,W),At(A,N,b,j,W,F)}p.C=p.Ma=b}function se(p,b,A,N,F,j,W){var G=p.$/N,V=p.$%N,rt=p.m,bt=p.s,Tt=A+p.$,it=Tt;F=A+N*F;var xt=A+N*j,Mt=280+bt.ua,qt=p.Pb?G:16777216,Rt=0<bt.ua?bt.Wa:null,Xt=bt.wc,Vt=Tt<xt?wt(bt,V,G):null;t(p.C<j),t(xt<=F);var oe=!1;t:for(;;){for(;oe||Tt<xt;){var Jt=0;if(G>=qt){var Be=Tt-A;t((qt=p).Pb),qt.wd=qt.m,qt.xd=Be,0<qt.s.ua&&pt(qt.s.Wa,qt.s.vb),qt=G+tg}if(V&Xt||(Vt=wt(bt,V,G)),t(Vt!=null),Vt.Qb&&(b[Tt]=Vt.qb,oe=!0),!oe)if(kt(rt),Vt.jc){Jt=rt,Be=b;var _e=Tt,sn=Vt.pd[K(Jt)&Bs-1];t(Vt.jc),256>sn.g?(gt(Jt,Jt.u+sn.g),Be[_e]=sn.value,Jt=0):(gt(Jt,Jt.u+sn.g-256),t(256<=sn.value),Jt=sn.value),Jt==0&&(oe=!0)}else Jt=Lt(Vt.G[0],Vt.H[0],rt);if(rt.h)break;if(oe||256>Jt){if(!oe)if(Vt.nd)b[Tt]=(Vt.qb|Jt<<8)>>>0;else{if(kt(rt),oe=Lt(Vt.G[1],Vt.H[1],rt),kt(rt),Be=Lt(Vt.G[2],Vt.H[2],rt),_e=Lt(Vt.G[3],Vt.H[3],rt),rt.h)break;b[Tt]=(_e<<24|oe<<16|Jt<<8|Be)>>>0}if(oe=!1,++Tt,++V>=N&&(V=0,++G,W!=null&&G<=j&&!(G%16)&&W(p,G),Rt!=null))for(;it<Tt;)Jt=b[it++],Rt.X[(506832829*Jt&4294967295)>>>Rt.Mb]=Jt}else if(280>Jt){if(Jt=vt(Jt-256,rt),Be=Lt(Vt.G[4],Vt.H[4],rt),kt(rt),Be=z(N,Be=vt(Be,rt)),rt.h)break;if(Tt-A<Be||F-Tt<Jt)break t;for(_e=0;_e<Jt;++_e)b[Tt+_e]=b[Tt+_e-Be];for(Tt+=Jt,V+=Jt;V>=N;)V-=N,++G,W!=null&&G<=j&&!(G%16)&&W(p,G);if(t(Tt<=F),V&Xt&&(Vt=wt(bt,V,G)),Rt!=null)for(;it<Tt;)Jt=b[it++],Rt.X[(506832829*Jt&4294967295)>>>Rt.Mb]=Jt}else{if(!(Jt<Mt))break t;for(oe=Jt-280,t(Rt!=null);it<Tt;)Jt=b[it++],Rt.X[(506832829*Jt&4294967295)>>>Rt.Mb]=Jt;Jt=Tt,t(!(oe>>>(Be=Rt).Xa)),b[Jt]=Be.X[oe],oe=!0}oe||t(rt.h==et(rt))}if(p.Pb&&rt.h&&Tt<F)t(p.m.h),p.a=5,p.m=p.wd,p.$=p.xd,0<p.s.ua&&pt(p.s.vb,p.s.Wa);else{if(rt.h)break t;W?.(p,G>j?j:G),p.a=0,p.$=Tt-A}return 1}return p.a=3,0}function te(p){t(p!=null),p.vc=null,p.yc=null,p.Ya=null;var b=p.Wa;b!=null&&(b.X=null),p.vb=null,t(p!=null)}function ae(){var p=new Ve;return p==null?null:(p.a=0,p.xb=nf,mn("Predictor","VP8LPredictors"),mn("Predictor","VP8LPredictors_C"),mn("PredictorAdd","VP8LPredictorsAdd"),mn("PredictorAdd","VP8LPredictorsAdd_C"),Hn=me,Yo=ze,Vo=an,cs=Ie,hs=qe,us=Xe,Es=cn,O.VP8LMapColor32b=_i,O.VP8LMapColor8b=Go,p)}function $t(p,b,A,N,F){var j=1,W=[p],G=[b],V=N.m,rt=N.s,bt=null,Tt=0;t:for(;;){if(A)for(;j&&at(V,1);){var it=W,xt=G,Mt=N,qt=1,Rt=Mt.m,Xt=Mt.gc[Mt.ab],Vt=at(Rt,2);if(Mt.Oc&1<<Vt)j=0;else{switch(Mt.Oc|=1<<Vt,Xt.hc=Vt,Xt.Ea=it[0],Xt.nc=xt[0],Xt.K=[null],++Mt.ab,t(4>=Mt.ab),Vt){case 0:case 1:Xt.b=at(Rt,3)+2,qt=$t(nt(Xt.Ea,Xt.b),nt(Xt.nc,Xt.b),0,Mt,Xt.K),Xt.K=Xt.K[0];break;case 3:var oe,Jt=at(Rt,8)+1,Be=16<Jt?0:4<Jt?1:2<Jt?2:3;if(it[0]=nt(Xt.Ea,Be),Xt.b=Be,oe=qt=$t(Jt,1,0,Mt,Xt.K)){var _e,sn=Jt,Me=Xt,un=1<<(8>>Me.b),or=s(un);if(or==null)oe=0;else{var on=Me.K[0],Ne=Me.w;for(or[0]=Me.K[0][0],_e=1;_e<1*sn;++_e)or[_e]=Ct(on[Ne+_e],or[_e-1]);for(;_e<4*un;++_e)or[_e]=0;Me.K[0]=null,Me.K[0]=or,oe=1}}qt=oe;break;case 2:break;default:t(0)}j=qt}}if(W=W[0],G=G[0],j&&at(V,1)&&!(j=1<=(Tt=at(V,4))&&11>=Tt)){N.a=3;break t}var ye;if(ye=j)e:{var Vn,tn,fn,Bn=N,mr=W,Nr=G,Un=Tt,vr=A,Pr=Bn.m,ar=Bn.s,gn=[null],kn=1,Wn=0,_n=J2[Un];n:for(;;){if(vr&&at(Pr,1)){var br=at(Pr,3)+2,pi=nt(mr,br),Zn=nt(Nr,br),Rr=pi*Zn;if(!$t(pi,Zn,0,Bn,gn))break n;for(gn=gn[0],ar.xc=br,Vn=0;Vn<Rr;++Vn){var Nn=gn[Vn]>>8&65535;gn[Vn]=Nn,Nn>=kn&&(kn=Nn+1)}}if(Pr.h)break n;for(tn=0;5>tn;++tn){var lr=tf[tn];!tn&&0<Un&&(lr+=1<<Un),Wn<lr&&(Wn=lr)}var qr=a(kn*_n,$),Ir=kn,Xr=a(Ir,J);if(Xr==null)var Gr=null;else t(65536>=Ir),Gr=Xr;var Tr=s(Wn);if(Gr==null||Tr==null||qr==null){Bn.a=1;break n}var Hr=qr;for(Vn=fn=0;Vn<kn;++Vn){var Rn=Gr[Vn],Yr=Rn.G,gi=Rn.H,Fs=0,Yi=1,wr=0;for(tn=0;5>tn;++tn){lr=tf[tn],Yr[tn]=Hr,gi[tn]=fn,!tn&&0<Un&&(lr+=1<<Un);i:{var nl,qc=lr,rl=Bn,ta=Tr,vg=Hr,xg=fn,Xc=0,gs=rl.m,kg=at(gs,1);if(r(ta,0,0,qc),kg){var _g=at(gs,1)+1,Sg=at(gs,1),uf=at(gs,Sg==0?1:8);ta[uf]=1,_g==2&&(ta[uf=at(gs,8)]=1);var il=1}else{var ff=s(19),df=at(gs,4)+4;if(19<df){rl.a=3;var sl=0;break i}for(nl=0;nl<df;++nl)ff[K2[nl]]=at(gs,3);var Gc=void 0,ea=void 0,pf=rl,Ag=ff,ol=qc,gf=ta,Hc=0,ys=pf.m,yf=8,mf=a(128,$);r:for(;M(mf,0,7,Ag,19);){if(at(ys,1)){var Cg=2+2*at(ys,3);if((Gc=2+at(ys,Cg))>ol)break r}else Gc=ol;for(ea=0;ea<ol&&Gc--;){kt(ys);var bf=mf[0+(127&K(ys))];gt(ys,ys.u+bf.g);var so=bf.value;if(16>so)gf[ea++]=so,so!=0&&(yf=so);else{var Lg=so==16,wf=so-16,Mg=V2[wf],vf=at(ys,Y2[wf])+Mg;if(ea+vf>ol)break r;for(var Ng=Lg?yf:0;0<vf--;)gf[ea++]=Ng}}Hc=1;break r}Hc||(pf.a=3),il=Hc}(il=il&&!gs.h)&&(Xc=M(vg,xg,8,ta,qc)),il&&Xc!=0?sl=Xc:(rl.a=3,sl=0)}if(sl==0)break n;if(Yi&&Z2[tn]==1&&(Yi=Hr[fn].g==0),Fs+=Hr[fn].g,fn+=sl,3>=tn){var na,Yc=Tr[0];for(na=1;na<lr;++na)Tr[na]>Yc&&(Yc=Tr[na]);wr+=Yc}}if(Rn.nd=Yi,Rn.Qb=0,Yi&&(Rn.qb=(Yr[3][gi[3]+0].value<<24|Yr[1][gi[1]+0].value<<16|Yr[2][gi[2]+0].value)>>>0,Fs==0&&256>Yr[0][gi[0]+0].value&&(Rn.Qb=1,Rn.qb+=Yr[0][gi[0]+0].value<<8)),Rn.jc=!Rn.Qb&&6>wr,Rn.jc){var al,Vi=Rn;for(al=0;al<Bs;++al){var ms=al,bs=Vi.pd[ms],ll=Vi.G[0][Vi.H[0]+ms];256<=ll.value?(bs.g=ll.g+256,bs.value=ll.value):(bs.g=0,bs.value=0,ms>>=Ut(ll,8,bs),ms>>=Ut(Vi.G[1][Vi.H[1]+ms],16,bs),ms>>=Ut(Vi.G[2][Vi.H[2]+ms],0,bs),Ut(Vi.G[3][Vi.H[3]+ms],24,bs))}}}ar.vc=gn,ar.Wb=kn,ar.Ya=Gr,ar.yc=qr,ye=1;break e}ye=0}if(!(j=ye)){N.a=3;break t}if(0<Tt){if(rt.ua=1<<Tt,!D(rt.Wa,Tt)){N.a=1,j=0;break t}}else rt.ua=0;var Vc=N,xf=W,Pg=G,Zc=Vc.s,Kc=Zc.xc;if(Vc.c=xf,Vc.i=Pg,Zc.md=nt(xf,Kc),Zc.wc=Kc==0?-1:(1<<Kc)-1,A){N.xb=ag;break t}if((bt=s(W*G))==null){N.a=1,j=0;break t}j=(j=se(N,bt,0,W,G,G,null))&&!V.h;break t}return j?(F!=null?F[0]=bt:(t(bt==null),t(A)),N.$=0,A||te(rt)):te(rt),j}function le(p,b){var A=p.c*p.i,N=A+b+16*b;return t(p.c<=b),p.V=s(N),p.V==null?(p.Ta=null,p.Ua=0,p.a=1,0):(p.Ta=p.V,p.Ua=p.Ba+A+b,1)}function Pe(p,b){var A=p.C,N=b-A,F=p.V,j=p.Ba+p.c*A;for(t(b<=p.l.o);0<N;){var W=16<N?16:N,G=p.l.ma,V=p.l.width,rt=V*W,bt=G.ca,Tt=G.tb+V*A,it=p.Ta,xt=p.Ua;Ot(p,W,F,j),Gu(it,xt,bt,Tt,rt),At(G,A,A+W,bt,Tt,V),N-=W,F+=W*p.c,A+=W}t(A==b),p.C=p.Ma=b}function Fe(){this.ub=this.yd=this.td=this.Rb=0}function Yt(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function we(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function yt(){this.Yb=(function(){var p=[];return(function b(A,N,F){for(var j=F[N],W=0;W<j&&(A.push(F.length>N+1?[]:0),!(F.length<N+1));W++)b(A[W],N+1,F)})(p,0,[3,11]),p})()}function Wt(){this.jb=s(3),this.Wc=o([4,8],yt),this.Xc=o([4,17],yt)}function Q(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function ue(){this.ld=this.La=this.dd=this.tc=0}function fe(){this.Na=this.la=0}function xe(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Ze(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Qe(){this.uc=this.M=this.Nb=0,this.wa=Array(new ue),this.Y=0,this.ya=Array(new Ze),this.aa=0,this.l=new je}function ie(){this.y=s(16),this.f=s(8),this.ea=s(8)}function Se(){this.cb=this.a=0,this.sc="",this.m=new P,this.Od=new Fe,this.Kc=new Yt,this.ed=new Q,this.Qa=new we,this.Ic=this.$c=this.Aa=0,this.D=new Qe,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,P),this.ia=0,this.pb=a(4,xe),this.Pa=new Wt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new ie),this.Hd=0,this.rb=Array(new fe),this.sb=0,this.wa=Array(new ue),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Ze),this.L=this.aa=0,this.gd=o([4,2],ue),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Ae(p,b){return 0>p?0:p>b?b:p}function je(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function xn(){var p=new Se;return p!=null&&(p.a=0,p.sc="OK",p.cb=0,p.Xb=0,Qo||(Qo=ln)),p}function ge(p,b,A){return p.a==0&&(p.a=b,p.sc=A,p.cb=0),0}function Cn(p,b,A){return 3<=A&&p[b+0]==157&&p[b+1]==1&&p[b+2]==42}function hn(p,b){if(p==null)return 0;if(p.a=0,p.sc="OK",b==null)return ge(p,2,"null VP8Io passed to VP8GetHeaders()");var A=b.data,N=b.w,F=b.ha;if(4>F)return ge(p,7,"Truncated header.");var j=A[N+0]|A[N+1]<<8|A[N+2]<<16,W=p.Od;if(W.Rb=!(1&j),W.td=j>>1&7,W.yd=j>>4&1,W.ub=j>>5,3<W.td)return ge(p,3,"Incorrect keyframe parameters.");if(!W.yd)return ge(p,4,"Frame not displayable.");N+=3,F-=3;var G=p.Kc;if(W.Rb){if(7>F)return ge(p,7,"cannot parse picture header");if(!Cn(A,N,F))return ge(p,3,"Bad code word");G.c=16383&(A[N+4]<<8|A[N+3]),G.Td=A[N+4]>>6,G.i=16383&(A[N+6]<<8|A[N+5]),G.Ud=A[N+6]>>6,N+=7,F-=7,p.za=G.c+15>>4,p.Ub=G.i+15>>4,b.width=G.c,b.height=G.i,b.Da=0,b.j=0,b.v=0,b.va=b.width,b.o=b.height,b.da=0,b.ib=b.width,b.hb=b.height,b.U=b.width,b.T=b.height,r((j=p.Pa).jb,0,255,j.jb.length),t((j=p.Qa)!=null),j.Cb=0,j.Bb=0,j.Fb=1,r(j.Zb,0,0,j.Zb.length),r(j.Lb,0,0,j.Lb)}if(W.ub>F)return ge(p,7,"bad partition length");mt(j=p.m,A,N,W.ub),N+=W.ub,F-=W.ub,W.Rb&&(G.Ld=Pt(j),G.Kd=Pt(j)),G=p.Qa;var V,rt=p.Pa;if(t(j!=null),t(G!=null),G.Cb=Pt(j),G.Cb){if(G.Bb=Pt(j),Pt(j)){for(G.Fb=Pt(j),V=0;4>V;++V)G.Zb[V]=Pt(j)?ft(j,7):0;for(V=0;4>V;++V)G.Lb[V]=Pt(j)?ft(j,6):0}if(G.Bb)for(V=0;3>V;++V)rt.jb[V]=Pt(j)?ot(j,8):255}else G.Bb=0;if(j.Ka)return ge(p,3,"cannot parse segment header");if((G=p.ed).zd=Pt(j),G.Tb=ot(j,6),G.wb=ot(j,3),G.Pc=Pt(j),G.Pc&&Pt(j)){for(rt=0;4>rt;++rt)Pt(j)&&(G.vd[rt]=ft(j,6));for(rt=0;4>rt;++rt)Pt(j)&&(G.od[rt]=ft(j,6))}if(p.L=G.Tb==0?0:G.zd?1:2,j.Ka)return ge(p,3,"cannot parse filter header");var bt=F;if(F=V=N,N=V+bt,G=bt,p.Xb=(1<<ot(p.m,2))-1,bt<3*(rt=p.Xb))A=7;else{for(V+=3*rt,G-=3*rt,bt=0;bt<rt;++bt){var Tt=A[F+0]|A[F+1]<<8|A[F+2]<<16;Tt>G&&(Tt=G),mt(p.Jc[+bt],A,V,Tt),V+=Tt,G-=Tt,F+=3}mt(p.Jc[+rt],A,V,G),A=V<N?0:5}if(A!=0)return ge(p,A,"cannot parse partitions");for(A=ot(V=p.m,7),F=Pt(V)?ft(V,4):0,N=Pt(V)?ft(V,4):0,G=Pt(V)?ft(V,4):0,rt=Pt(V)?ft(V,4):0,V=Pt(V)?ft(V,4):0,bt=p.Qa,Tt=0;4>Tt;++Tt){if(bt.Cb){var it=bt.Zb[Tt];bt.Fb||(it+=A)}else{if(0<Tt){p.pb[Tt]=p.pb[0];continue}it=A}var xt=p.pb[Tt];xt.Sc[0]=jc[Ae(it+F,127)],xt.Sc[1]=Uc[Ae(it+0,127)],xt.Eb[0]=2*jc[Ae(it+N,127)],xt.Eb[1]=101581*Uc[Ae(it+G,127)]>>16,8>xt.Eb[1]&&(xt.Eb[1]=8),xt.Qc[0]=jc[Ae(it+rt,117)],xt.Qc[1]=Uc[Ae(it+V,127)],xt.lc=it+V}if(!W.Rb)return ge(p,4,"Not a key frame.");for(Pt(j),W=p.Pa,A=0;4>A;++A){for(F=0;8>F;++F)for(N=0;3>N;++N)for(G=0;11>G;++G)rt=jt(j,sg[A][F][N][G])?ot(j,8):rg[A][F][N][G],W.Wc[A][F].Yb[N][G]=rt;for(F=0;17>F;++F)W.Xc[A][F]=W.Wc[A][og[F]]}return p.kc=Pt(j),p.kc&&(p.Bd=ot(j,8)),p.cb=1}function ln(p,b,A,N,F,j,W){var G=b[F].Yb[A];for(A=0;16>F;++F){if(!jt(p,G[A+0]))return F;for(;!jt(p,G[A+1]);)if(G=b[++F].Yb[0],A=0,F==16)return 16;var V=b[F+1].Yb;if(jt(p,G[A+2])){var rt=p,bt=0;if(jt(rt,(it=G)[(Tt=A)+3]))if(jt(rt,it[Tt+6])){for(G=0,Tt=2*(bt=jt(rt,it[Tt+8]))+(it=jt(rt,it[Tt+9+bt])),bt=0,it=eg[Tt];it[G];++G)bt+=bt+jt(rt,it[G]);bt+=3+(8<<Tt)}else jt(rt,it[Tt+7])?(bt=7+2*jt(rt,165),bt+=jt(rt,145)):bt=5+jt(rt,159);else bt=jt(rt,it[Tt+4])?3+jt(rt,it[Tt+5]):2;G=V[2]}else bt=1,G=V[1];V=W+ng[F],0>(rt=p).b&&_t(rt);var Tt,it=rt.b,xt=(Tt=rt.Ca>>1)-(rt.I>>it)>>31;--rt.b,rt.Ca+=xt,rt.Ca|=1,rt.I-=(Tt+1&xt)<<it,j[V]=((bt^xt)-xt)*N[(0<F)+0]}return 16}function nn(p){var b=p.rb[p.sb-1];b.la=0,b.Na=0,r(p.zc,0,0,p.zc.length),p.ja=0}function bn(p,b,A,N,F){F=p[b+A+32*N]+(F>>3),p[b+A+32*N]=-256&F?0>F?0:255:F}function rn(p,b,A,N,F,j){bn(p,b,0,A,N+F),bn(p,b,1,A,N+j),bn(p,b,2,A,N-j),bn(p,b,3,A,N-F)}function In(p){return(20091*p>>16)+p}function dr(p,b,A,N){var F,j=0,W=s(16);for(F=0;4>F;++F){var G=p[b+0]+p[b+8],V=p[b+0]-p[b+8],rt=(35468*p[b+4]>>16)-In(p[b+12]),bt=In(p[b+4])+(35468*p[b+12]>>16);W[j+0]=G+bt,W[j+1]=V+rt,W[j+2]=V-rt,W[j+3]=G-bt,j+=4,b++}for(F=j=0;4>F;++F)G=(p=W[j+0]+4)+W[j+8],V=p-W[j+8],rt=(35468*W[j+4]>>16)-In(W[j+12]),bn(A,N,0,0,G+(bt=In(W[j+4])+(35468*W[j+12]>>16))),bn(A,N,1,0,V+rt),bn(A,N,2,0,V-rt),bn(A,N,3,0,G-bt),j++,N+=32}function Oi(p,b,A,N){var F=p[b+0]+4,j=35468*p[b+4]>>16,W=In(p[b+4]),G=35468*p[b+1]>>16;rn(A,N,0,F+W,p=In(p[b+1]),G),rn(A,N,1,F+j,p,G),rn(A,N,2,F-j,p,G),rn(A,N,3,F-W,p,G)}function pr(p,b,A,N,F){dr(p,b,A,N),F&&dr(p,b+16,A,N+4)}function Lr(p,b,A,N){Ds(p,b+0,A,N,1),Ds(p,b+32,A,N+128,1)}function Ri(p,b,A,N){var F;for(p=p[b+0]+4,F=0;4>F;++F)for(b=0;4>b;++b)bn(A,N,b,F,p)}function Ti(p,b,A,N){p[b+0]&&wn(p,b+0,A,N),p[b+16]&&wn(p,b+16,A,N+4),p[b+32]&&wn(p,b+32,A,N+128),p[b+48]&&wn(p,b+48,A,N+128+4)}function hi(p,b,A,N){var F,j=s(16);for(F=0;4>F;++F){var W=p[b+0+F]+p[b+12+F],G=p[b+4+F]+p[b+8+F],V=p[b+4+F]-p[b+8+F],rt=p[b+0+F]-p[b+12+F];j[0+F]=W+G,j[8+F]=W-G,j[4+F]=rt+V,j[12+F]=rt-V}for(F=0;4>F;++F)W=(p=j[0+4*F]+3)+j[3+4*F],G=j[1+4*F]+j[2+4*F],V=j[1+4*F]-j[2+4*F],rt=p-j[3+4*F],A[N+0]=W+G>>3,A[N+16]=rt+V>>3,A[N+32]=W-G>>3,A[N+48]=rt-V>>3,N+=64}function Bi(p,b,A){var N,F=b-32,j=Wr,W=255-p[F-1];for(N=0;N<A;++N){var G,V=j,rt=W+p[b-1];for(G=0;G<A;++G)p[b+G]=V[rt+p[F+G]];b+=32}}function rs(p,b){Bi(p,b,4)}function Ac(p,b){Bi(p,b,8)}function Cc(p,b){Bi(p,b,16)}function Oo(p,b){var A;for(A=0;16>A;++A)i(p,b+32*A,p,b-32,16)}function Fa(p,b){var A;for(A=16;0<A;--A)r(p,b,p[b-1],16),b+=32}function ui(p,b,A){var N;for(N=0;16>N;++N)r(b,A+32*N,p,16)}function Lc(p,b){var A,N=16;for(A=0;16>A;++A)N+=p[b-1+32*A]+p[b+A-32];ui(N>>5,p,b)}function Cs(p,b){var A,N=8;for(A=0;16>A;++A)N+=p[b-1+32*A];ui(N>>4,p,b)}function Ro(p,b){var A,N=8;for(A=0;16>A;++A)N+=p[b+A-32];ui(N>>4,p,b)}function Mc(p,b){ui(128,p,b)}function Ke(p,b,A){return p+2*b+A+2>>2}function Nc(p,b){var A,N=b-32;for(N=new Uint8Array([Ke(p[N-1],p[N+0],p[N+1]),Ke(p[N+0],p[N+1],p[N+2]),Ke(p[N+1],p[N+2],p[N+3]),Ke(p[N+2],p[N+3],p[N+4])]),A=0;4>A;++A)i(p,b+32*A,N,0,N.length)}function Pc(p,b){var A=p[b-1],N=p[b-1+32],F=p[b-1+64],j=p[b-1+96];Zt(p,b+0,16843009*Ke(p[b-1-32],A,N)),Zt(p,b+32,16843009*Ke(A,N,F)),Zt(p,b+64,16843009*Ke(N,F,j)),Zt(p,b+96,16843009*Ke(F,j,j))}function Ic(p,b){var A,N=4;for(A=0;4>A;++A)N+=p[b+A-32]+p[b-1+32*A];for(N>>=3,A=0;4>A;++A)r(p,b+32*A,N,4)}function Ei(p,b){var A=p[b-1+0],N=p[b-1+32],F=p[b-1+64],j=p[b-1-32],W=p[b+0-32],G=p[b+1-32],V=p[b+2-32],rt=p[b+3-32];p[b+0+96]=Ke(N,F,p[b-1+96]),p[b+1+96]=p[b+0+64]=Ke(A,N,F),p[b+2+96]=p[b+1+64]=p[b+0+32]=Ke(j,A,N),p[b+3+96]=p[b+2+64]=p[b+1+32]=p[b+0+0]=Ke(W,j,A),p[b+3+64]=p[b+2+32]=p[b+1+0]=Ke(G,W,j),p[b+3+32]=p[b+2+0]=Ke(V,G,W),p[b+3+0]=Ke(rt,V,G)}function Di(p,b){var A=p[b+1-32],N=p[b+2-32],F=p[b+3-32],j=p[b+4-32],W=p[b+5-32],G=p[b+6-32],V=p[b+7-32];p[b+0+0]=Ke(p[b+0-32],A,N),p[b+1+0]=p[b+0+32]=Ke(A,N,F),p[b+2+0]=p[b+1+32]=p[b+0+64]=Ke(N,F,j),p[b+3+0]=p[b+2+32]=p[b+1+64]=p[b+0+96]=Ke(F,j,W),p[b+3+32]=p[b+2+64]=p[b+1+96]=Ke(j,W,G),p[b+3+64]=p[b+2+96]=Ke(W,G,V),p[b+3+96]=Ke(G,V,V)}function Oc(p,b){var A=p[b-1+0],N=p[b-1+32],F=p[b-1+64],j=p[b-1-32],W=p[b+0-32],G=p[b+1-32],V=p[b+2-32],rt=p[b+3-32];p[b+0+0]=p[b+1+64]=j+W+1>>1,p[b+1+0]=p[b+2+64]=W+G+1>>1,p[b+2+0]=p[b+3+64]=G+V+1>>1,p[b+3+0]=V+rt+1>>1,p[b+0+96]=Ke(F,N,A),p[b+0+64]=Ke(N,A,j),p[b+0+32]=p[b+1+96]=Ke(A,j,W),p[b+1+32]=p[b+2+96]=Ke(j,W,G),p[b+2+32]=p[b+3+96]=Ke(W,G,V),p[b+3+32]=Ke(G,V,rt)}function Rc(p,b){var A=p[b+0-32],N=p[b+1-32],F=p[b+2-32],j=p[b+3-32],W=p[b+4-32],G=p[b+5-32],V=p[b+6-32],rt=p[b+7-32];p[b+0+0]=A+N+1>>1,p[b+1+0]=p[b+0+64]=N+F+1>>1,p[b+2+0]=p[b+1+64]=F+j+1>>1,p[b+3+0]=p[b+2+64]=j+W+1>>1,p[b+0+32]=Ke(A,N,F),p[b+1+32]=p[b+0+96]=Ke(N,F,j),p[b+2+32]=p[b+1+96]=Ke(F,j,W),p[b+3+32]=p[b+2+96]=Ke(j,W,G),p[b+3+64]=Ke(W,G,V),p[b+3+96]=Ke(G,V,rt)}function Js(p,b){var A=p[b-1+0],N=p[b-1+32],F=p[b-1+64],j=p[b-1+96];p[b+0+0]=A+N+1>>1,p[b+2+0]=p[b+0+32]=N+F+1>>1,p[b+2+32]=p[b+0+64]=F+j+1>>1,p[b+1+0]=Ke(A,N,F),p[b+3+0]=p[b+1+32]=Ke(N,F,j),p[b+3+32]=p[b+1+64]=Ke(F,j,j),p[b+3+64]=p[b+2+64]=p[b+0+96]=p[b+1+96]=p[b+2+96]=p[b+3+96]=j}function To(p,b){var A=p[b-1+0],N=p[b-1+32],F=p[b-1+64],j=p[b-1+96],W=p[b-1-32],G=p[b+0-32],V=p[b+1-32],rt=p[b+2-32];p[b+0+0]=p[b+2+32]=A+W+1>>1,p[b+0+32]=p[b+2+64]=N+A+1>>1,p[b+0+64]=p[b+2+96]=F+N+1>>1,p[b+0+96]=j+F+1>>1,p[b+3+0]=Ke(G,V,rt),p[b+2+0]=Ke(W,G,V),p[b+1+0]=p[b+3+32]=Ke(A,W,G),p[b+1+32]=p[b+3+64]=Ke(N,A,W),p[b+1+64]=p[b+3+96]=Ke(F,N,A),p[b+1+96]=Ke(j,F,N)}function Ls(p,b){var A;for(A=0;8>A;++A)i(p,b+32*A,p,b-32,8)}function Tc(p,b){var A;for(A=0;8>A;++A)r(p,b,p[b-1],8),b+=32}function Fi(p,b,A){var N;for(N=0;8>N;++N)r(b,A+32*N,p,8)}function Bc(p,b){var A,N=8;for(A=0;8>A;++A)N+=p[b+A-32]+p[b-1+32*A];Fi(N>>4,p,b)}function Bo(p,b){var A,N=4;for(A=0;8>A;++A)N+=p[b+A-32];Fi(N>>3,p,b)}function Eo(p,b){var A,N=4;for(A=0;8>A;++A)N+=p[b-1+32*A];Fi(N>>3,p,b)}function $a(p,b){Fi(128,p,b)}function $i(p,b,A){var N=p[b-A],F=p[b+0],j=3*(F-N)+Ec[1020+p[b-2*A]-p[b+A]],W=Ha[112+(j+4>>3)];p[b-A]=Wr[255+N+Ha[112+(j+3>>3)]],p[b+0]=Wr[255+F-W]}function Do(p,b,A,N){var F=p[b+0],j=p[b+A];return ri[255+p[b-2*A]-p[b-A]]>N||ri[255+j-F]>N}function to(p,b,A,N){return 4*ri[255+p[b-A]-p[b+0]]+ri[255+p[b-2*A]-p[b+A]]<=N}function Fo(p,b,A,N,F){var j=p[b-3*A],W=p[b-2*A],G=p[b-A],V=p[b+0],rt=p[b+A],bt=p[b+2*A],Tt=p[b+3*A];return 4*ri[255+G-V]+ri[255+W-rt]>N?0:ri[255+p[b-4*A]-j]<=F&&ri[255+j-W]<=F&&ri[255+W-G]<=F&&ri[255+Tt-bt]<=F&&ri[255+bt-rt]<=F&&ri[255+rt-V]<=F}function Ms(p,b,A,N){var F=2*N+1;for(N=0;16>N;++N)to(p,b+N,A,F)&&$i(p,b+N,A)}function $o(p,b,A,N){var F=2*N+1;for(N=0;16>N;++N)to(p,b+N*A,1,F)&&$i(p,b+N*A,1)}function za(p,b,A,N){var F;for(F=3;0<F;--F)Ms(p,b+=4*A,A,N)}function ja(p,b,A,N){var F;for(F=3;0<F;--F)$o(p,b+=4,A,N)}function zi(p,b,A,N,F,j,W,G){for(j=2*j+1;0<F--;){if(Fo(p,b,A,j,W))if(Do(p,b,A,G))$i(p,b,A);else{var V=p,rt=b,bt=A,Tt=V[rt-2*bt],it=V[rt-bt],xt=V[rt+0],Mt=V[rt+bt],qt=V[rt+2*bt],Rt=27*(Vt=Ec[1020+3*(xt-it)+Ec[1020+Tt-Mt]])+63>>7,Xt=18*Vt+63>>7,Vt=9*Vt+63>>7;V[rt-3*bt]=Wr[255+V[rt-3*bt]+Vt],V[rt-2*bt]=Wr[255+Tt+Xt],V[rt-bt]=Wr[255+it+Rt],V[rt+0]=Wr[255+xt-Rt],V[rt+bt]=Wr[255+Mt-Xt],V[rt+2*bt]=Wr[255+qt-Vt]}b+=N}}function ji(p,b,A,N,F,j,W,G){for(j=2*j+1;0<F--;){if(Fo(p,b,A,j,W))if(Do(p,b,A,G))$i(p,b,A);else{var V=p,rt=b,bt=A,Tt=V[rt-bt],it=V[rt+0],xt=V[rt+bt],Mt=Ha[112+(4+(qt=3*(it-Tt))>>3)],qt=Ha[112+(qt+3>>3)],Rt=Mt+1>>1;V[rt-2*bt]=Wr[255+V[rt-2*bt]+Rt],V[rt-bt]=Wr[255+Tt+qt],V[rt+0]=Wr[255+it-Mt],V[rt+bt]=Wr[255+xt-Rt]}b+=N}}function Ua(p,b,A,N,F,j){zi(p,b,A,1,16,N,F,j)}function Ns(p,b,A,N,F,j){zi(p,b,1,A,16,N,F,j)}function Wa(p,b,A,N,F,j){var W;for(W=3;0<W;--W)ji(p,b+=4*A,A,1,16,N,F,j)}function k(p,b,A,N,F,j){var W;for(W=3;0<W;--W)ji(p,b+=4,1,A,16,N,F,j)}function E(p,b,A,N,F,j,W,G){zi(p,b,F,1,8,j,W,G),zi(A,N,F,1,8,j,W,G)}function st(p,b,A,N,F,j,W,G){zi(p,b,1,F,8,j,W,G),zi(A,N,1,F,8,j,W,G)}function ut(p,b,A,N,F,j,W,G){ji(p,b+4*F,F,1,8,j,W,G),ji(A,N+4*F,F,1,8,j,W,G)}function St(p,b,A,N,F,j,W,G){ji(p,b+4,1,F,8,j,W,G),ji(A,N+4,1,F,8,j,W,G)}function Ht(){this.ba=new He,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new dn,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Qt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Le(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Oe(){this.ua=0,this.Wa=new tt,this.vb=new tt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new J,this.yc=new $}function Ve(){this.xb=this.a=0,this.l=new je,this.ca=new He,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Y,this.Pb=0,this.wd=new Y,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Oe,this.ab=0,this.gc=a(4,Le),this.Oc=0}function en(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new je,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function pn(p,b,A,N,F,j,W){for(p=p==null?0:p[b+0],b=0;b<W;++b)F[j+b]=p+A[N+b]&255,p=F[j+b]}function jn(p,b,A,N,F,j,W){var G;if(p==null)pn(null,null,A,N,F,j,W);else for(G=0;G<W;++G)F[j+G]=p[b+G]+A[N+G]&255}function er(p,b,A,N,F,j,W){if(p==null)pn(null,null,A,N,F,j,W);else{var G,V=p[b+0],rt=V,bt=V;for(G=0;G<W;++G)rt=bt+(V=p[b+G])-rt,bt=A[N+G]+(-256&rt?0>rt?0:255:rt)&255,rt=V,F[j+G]=bt}}function On(p,b,A,N){var F=b.width,j=b.o;if(t(p!=null&&b!=null),0>A||0>=N||A+N>j)return null;if(!p.Cc){if(p.ga==null){var W;if(p.ga=new en,(W=p.ga==null)||(W=b.width*b.o,t(p.Gb.length==0),p.Gb=s(W),p.Uc=0,p.Gb==null?W=0:(p.mb=p.Gb,p.nb=p.Uc,p.rc=null,W=1),W=!W),!W){W=p.ga;var G=p.Fa,V=p.P,rt=p.qc,bt=p.mb,Tt=p.nb,it=V+1,xt=rt-1,Mt=W.l;if(t(G!=null&&bt!=null&&b!=null),ps[0]=null,ps[1]=pn,ps[2]=jn,ps[3]=er,W.ca=bt,W.tb=Tt,W.c=b.width,W.i=b.height,t(0<W.c&&0<W.i),1>=rt)b=0;else if(W.$a=3&G[V+0],W.Z=G[V+0]>>2&3,W.Lc=G[V+0]>>4&3,V=G[V+0]>>6&3,0>W.$a||1<W.$a||4<=W.Z||1<W.Lc||V)b=0;else if(Mt.put=lt,Mt.ac=Z,Mt.bc=ht,Mt.ma=W,Mt.width=b.width,Mt.height=b.height,Mt.Da=b.Da,Mt.v=b.v,Mt.va=b.va,Mt.j=b.j,Mt.o=b.o,W.$a)t:{t(W.$a==1),b=ae();e:for(;;){if(b==null){b=0;break t}if(t(W!=null),W.mc=b,b.c=W.c,b.i=W.i,b.l=W.l,b.l.ma=W,b.l.width=W.c,b.l.height=W.i,b.a=0,ct(b.m,G,it,xt),!$t(W.c,W.i,1,b,null)||(b.ab==1&&b.gc[0].hc==3&&Dt(b.s)?(W.ic=1,G=b.c*b.i,b.Ta=null,b.Ua=0,b.V=s(G),b.Ba=0,b.V==null?(b.a=1,b=0):b=1):(W.ic=0,b=le(b,W.c)),!b))break e;b=1;break t}W.mc=null,b=0}else b=xt>=W.c*W.i;W=!b}if(W)return null;p.ga.Lc!=1?p.Ga=0:N=j-A}t(p.ga!=null),t(A+N<=j);t:{if(b=(G=p.ga).c,j=G.l.o,G.$a==0){if(it=p.rc,xt=p.Vc,Mt=p.Fa,V=p.P+1+A*b,rt=p.mb,bt=p.nb+A*b,t(V<=p.P+p.qc),G.Z!=0)for(t(ps[G.Z]!=null),W=0;W<N;++W)ps[G.Z](it,xt,Mt,V,rt,bt,b),it=rt,xt=bt,bt+=b,V+=b;else for(W=0;W<N;++W)i(rt,bt,Mt,V,b),it=rt,xt=bt,bt+=b,V+=b;p.rc=it,p.Vc=xt}else{if(t(G.mc!=null),b=A+N,t((W=G.mc)!=null),t(b<=W.i),W.C>=b)b=1;else if(G.ic||fi(),G.ic){G=W.V,it=W.Ba,xt=W.c;var qt=W.i,Rt=(Mt=1,V=W.$/xt,rt=W.$%xt,bt=W.m,Tt=W.s,W.$),Xt=xt*qt,Vt=xt*b,oe=Tt.wc,Jt=Rt<Vt?wt(Tt,rt,V):null;t(Rt<=Xt),t(b<=qt),t(Dt(Tt));e:for(;;){for(;!bt.h&&Rt<Vt;){if(rt&oe||(Jt=wt(Tt,rt,V)),t(Jt!=null),kt(bt),256>(qt=Lt(Jt.G[0],Jt.H[0],bt)))G[it+Rt]=qt,++Rt,++rt>=xt&&(rt=0,++V<=b&&!(V%16)&&Ft(W,V));else{if(!(280>qt)){Mt=0;break e}qt=vt(qt-256,bt);var Be,_e=Lt(Jt.G[4],Jt.H[4],bt);if(kt(bt),!(Rt>=(_e=z(xt,_e=vt(_e,bt)))&&Xt-Rt>=qt)){Mt=0;break e}for(Be=0;Be<qt;++Be)G[it+Rt+Be]=G[it+Rt+Be-_e];for(Rt+=qt,rt+=qt;rt>=xt;)rt-=xt,++V<=b&&!(V%16)&&Ft(W,V);Rt<Vt&&rt&oe&&(Jt=wt(Tt,rt,V))}t(bt.h==et(bt))}Ft(W,V>b?b:V);break e}!Mt||bt.h&&Rt<Xt?(Mt=0,W.a=bt.h?5:3):W.$=Rt,b=Mt}else b=se(W,W.V,W.Ba,W.c,W.i,b,Pe);if(!b){N=0;break t}}A+N>=j&&(p.Cc=1),N=1}if(!N)return null;if(p.Cc&&((N=p.ga)!=null&&(N.mc=null),p.ga=null,0<p.Ga))return alert("todo:WebPDequantizeLevels"),null}return p.nb+A*F}function ir(p,b,A,N,F,j){for(;0<F--;){var W,G=p,V=b+(A?1:0),rt=p,bt=b+(A?0:3);for(W=0;W<N;++W){var Tt=rt[bt+4*W];Tt!=255&&(Tt*=32897,G[V+4*W+0]=G[V+4*W+0]*Tt>>23,G[V+4*W+1]=G[V+4*W+1]*Tt>>23,G[V+4*W+2]=G[V+4*W+2]*Tt>>23)}b+=j}}function nr(p,b,A,N,F){for(;0<N--;){var j;for(j=0;j<A;++j){var W=p[b+2*j+0],G=15&(rt=p[b+2*j+1]),V=4369*G,rt=(240&rt|rt>>4)*V>>16;p[b+2*j+0]=(240&W|W>>4)*V>>16&240|(15&W|W<<4)*V>>16>>4&15,p[b+2*j+1]=240&rt|G}b+=F}}function gr(p,b,A,N,F,j,W,G){var V,rt,bt=255;for(rt=0;rt<F;++rt){for(V=0;V<N;++V){var Tt=p[b+V];j[W+4*V]=Tt,bt&=Tt}b+=A,W+=G}return bt!=255}function Ui(p,b,A,N,F){var j;for(j=0;j<F;++j)A[N+j]=p[b+j]>>8}function fi(){Ko=ir,qu=nr,Xu=gr,Gu=Ui}function Wi(p,b,A){O[p]=function(N,F,j,W,G,V,rt,bt,Tt,it,xt,Mt,qt,Rt,Xt,Vt,oe){var Jt,Be=oe-1>>1,_e=G[V+0]|rt[bt+0]<<16,sn=Tt[it+0]|xt[Mt+0]<<16;t(N!=null);var Me=3*_e+sn+131074>>2;for(b(N[F+0],255&Me,Me>>16,qt,Rt),j!=null&&(Me=3*sn+_e+131074>>2,b(j[W+0],255&Me,Me>>16,Xt,Vt)),Jt=1;Jt<=Be;++Jt){var un=G[V+Jt]|rt[bt+Jt]<<16,or=Tt[it+Jt]|xt[Mt+Jt]<<16,on=_e+un+sn+or+524296,Ne=on+2*(un+sn)>>3;Me=Ne+_e>>1,_e=(on=on+2*(_e+or)>>3)+un>>1,b(N[F+2*Jt-1],255&Me,Me>>16,qt,Rt+(2*Jt-1)*A),b(N[F+2*Jt-0],255&_e,_e>>16,qt,Rt+(2*Jt-0)*A),j!=null&&(Me=on+sn>>1,_e=Ne+or>>1,b(j[W+2*Jt-1],255&Me,Me>>16,Xt,Vt+(2*Jt-1)*A),b(j[W+2*Jt+0],255&_e,_e>>16,Xt,Vt+(2*Jt+0)*A)),_e=un,sn=or}1&oe||(Me=3*_e+sn+131074>>2,b(N[F+oe-1],255&Me,Me>>16,qt,Rt+(oe-1)*A),j!=null&&(Me=3*sn+_e+131074>>2,b(j[W+oe-1],255&Me,Me>>16,Xt,Vt+(oe-1)*A)))}}function zo(){ii[Ya]=lg,ii[Va]=rf,ii[Qu]=cg,ii[Za]=sf,ii[Ka]=of,ii[Dc]=af,ii[Ju]=hg,ii[Fc]=rf,ii[$c]=sf,ii[Qa]=of,ii[zc]=af}function eo(p){return p&-16384?0>p?0:255:p>>ug}function is(p,b){return eo((19077*p>>8)+(26149*b>>8)-14234)}function Ps(p,b,A){return eo((19077*p>>8)-(6419*b>>8)-(13320*A>>8)+8708)}function Is(p,b){return eo((19077*p>>8)+(33050*b>>8)-17685)}function ss(p,b,A,N,F){N[F+0]=is(p,A),N[F+1]=Ps(p,b,A),N[F+2]=Is(p,b)}function yr(p,b,A,N,F){N[F+0]=Is(p,b),N[F+1]=Ps(p,b,A),N[F+2]=is(p,A)}function Os(p,b,A,N,F){var j=Ps(p,b,A);b=j<<3&224|Is(p,b)>>3,N[F+0]=248&is(p,A)|j>>5,N[F+1]=b}function Rs(p,b,A,N,F){var j=240&Is(p,b)|15;N[F+0]=240&is(p,A)|Ps(p,b,A)>>4,N[F+1]=j}function jo(p,b,A,N,F){N[F+0]=255,ss(p,b,A,N,F+1)}function Uo(p,b,A,N,F){yr(p,b,A,N,F),N[F+3]=255}function Mr(p,b,A,N,F){ss(p,b,A,N,F),N[F+3]=255}function qi(p,b,A){O[p]=function(N,F,j,W,G,V,rt,bt,Tt){for(var it=bt+(-2&Tt)*A;bt!=it;)b(N[F+0],j[W+0],G[V+0],rt,bt),b(N[F+1],j[W+0],G[V+0],rt,bt+A),F+=2,++W,++V,bt+=2*A;1&Tt&&b(N[F+0],j[W+0],G[V+0],rt,bt)}}function no(p,b,A){return A==0?p==0?b==0?6:5:b==0?4:0:A}function qa(p,b,A,N,F){switch(p>>>30){case 3:Ds(b,A,N,F,0);break;case 2:ni(b,A,N,F);break;case 1:wn(b,A,N,F)}}function ei(p,b){var A,N,F=b.M,j=b.Nb,W=p.oc,G=p.pc+40,V=p.oc,rt=p.pc+584,bt=p.oc,Tt=p.pc+600;for(A=0;16>A;++A)W[G+32*A-1]=129;for(A=0;8>A;++A)V[rt+32*A-1]=129,bt[Tt+32*A-1]=129;for(0<F?W[G-1-32]=V[rt-1-32]=bt[Tt-1-32]=129:(r(W,G-32-1,127,21),r(V,rt-32-1,127,9),r(bt,Tt-32-1,127,9)),N=0;N<p.za;++N){var it=b.ya[b.aa+N];if(0<N){for(A=-1;16>A;++A)i(W,G+32*A-4,W,G+32*A+12,4);for(A=-1;8>A;++A)i(V,rt+32*A-4,V,rt+32*A+4,4),i(bt,Tt+32*A-4,bt,Tt+32*A+4,4)}var xt=p.Gd,Mt=p.Hd+N,qt=it.ad,Rt=it.Hc;if(0<F&&(i(W,G-32,xt[Mt].y,0,16),i(V,rt-32,xt[Mt].f,0,8),i(bt,Tt-32,xt[Mt].ea,0,8)),it.Za){var Xt=W,Vt=G-32+16;for(0<F&&(N>=p.za-1?r(Xt,Vt,xt[Mt].y[15],4):i(Xt,Vt,xt[Mt+1].y,0,4)),A=0;4>A;A++)Xt[Vt+128+A]=Xt[Vt+256+A]=Xt[Vt+384+A]=Xt[Vt+0+A];for(A=0;16>A;++A,Rt<<=2)Xt=W,Vt=G+cf[A],di[it.Ob[A]](Xt,Vt),qa(Rt,qt,16*+A,Xt,Vt)}else if(Xt=no(N,F,it.Ob[0]),ds[Xt](W,G),Rt!=0)for(A=0;16>A;++A,Rt<<=2)qa(Rt,qt,16*+A,W,G+cf[A]);for(A=it.Gc,Xt=no(N,F,it.Dd),Hi[Xt](V,rt),Hi[Xt](bt,Tt),Rt=qt,Xt=V,Vt=rt,255&(it=0|A)&&(170&it?Ai(Rt,256,Xt,Vt):Mn(Rt,256,Xt,Vt)),it=bt,Rt=Tt,255&(A>>=8)&&(170&A?Ai(qt,320,it,Rt):Mn(qt,320,it,Rt)),F<p.Ub-1&&(i(xt[Mt].y,0,W,G+480,16),i(xt[Mt].f,0,V,rt+224,8),i(xt[Mt].ea,0,bt,Tt+224,8)),A=8*j*p.B,xt=p.sa,Mt=p.ta+16*N+16*j*p.R,qt=p.qa,it=p.ra+8*N+A,Rt=p.Ha,Xt=p.Ia+8*N+A,A=0;16>A;++A)i(xt,Mt+A*p.R,W,G+32*A,16);for(A=0;8>A;++A)i(qt,it+A*p.B,V,rt+32*A,8),i(Rt,Xt+A*p.B,bt,Tt+32*A,8)}}function Ts(p,b,A,N,F,j,W,G,V){var rt=[0],bt=[0],Tt=0,it=V!=null?V.kd:0,xt=V??new Qt;if(p==null||12>A)return 7;xt.data=p,xt.w=b,xt.ha=A,b=[b],A=[A],xt.gb=[xt.gb];t:{var Mt=b,qt=A,Rt=xt.gb;if(t(p!=null),t(qt!=null),t(Rt!=null),Rt[0]=0,12<=qt[0]&&!e(p,Mt[0],"RIFF")){if(e(p,Mt[0]+8,"WEBP")){Rt=3;break t}var Xt=I(p,Mt[0]+4);if(12>Xt||4294967286<Xt){Rt=3;break t}if(it&&Xt>qt[0]-8){Rt=7;break t}Rt[0]=Xt,Mt[0]+=12,qt[0]-=12}Rt=0}if(Rt!=0)return Rt;for(Xt=0<xt.gb[0],A=A[0];;){t:{var Vt=p;qt=b,Rt=A;var oe=rt,Jt=bt,Be=Mt=[0];if((Me=Tt=[Tt])[0]=0,8>Rt[0])Rt=7;else{if(!e(Vt,qt[0],"VP8X")){if(I(Vt,qt[0]+4)!=10){Rt=3;break t}if(18>Rt[0]){Rt=7;break t}var _e=I(Vt,qt[0]+8),sn=1+he(Vt,qt[0]+12);if(2147483648<=sn*(Vt=1+he(Vt,qt[0]+15))){Rt=3;break t}Be!=null&&(Be[0]=_e),oe!=null&&(oe[0]=sn),Jt!=null&&(Jt[0]=Vt),qt[0]+=18,Rt[0]-=18,Me[0]=1}Rt=0}}if(Tt=Tt[0],Mt=Mt[0],Rt!=0)return Rt;if(qt=!!(2&Mt),!Xt&&Tt)return 3;if(j!=null&&(j[0]=!!(16&Mt)),W!=null&&(W[0]=qt),G!=null&&(G[0]=0),W=rt[0],Mt=bt[0],Tt&&qt&&V==null){Rt=0;break}if(4>A){Rt=7;break}if(Xt&&Tt||!Xt&&!Tt&&!e(p,b[0],"ALPH")){A=[A],xt.na=[xt.na],xt.P=[xt.P],xt.Sa=[xt.Sa];t:{_e=p,Rt=b,Xt=A;var Me=xt.gb;oe=xt.na,Jt=xt.P,Be=xt.Sa,sn=22,t(_e!=null),t(Xt!=null),Vt=Rt[0];var un=Xt[0];for(t(oe!=null),t(Be!=null),oe[0]=null,Jt[0]=null,Be[0]=0;;){if(Rt[0]=Vt,Xt[0]=un,8>un){Rt=7;break t}var or=I(_e,Vt+4);if(4294967286<or){Rt=3;break t}var on=8+or+1&-2;if(sn+=on,0<Me&&sn>Me){Rt=3;break t}if(!e(_e,Vt,"VP8 ")||!e(_e,Vt,"VP8L")){Rt=0;break t}if(un[0]<on){Rt=7;break t}e(_e,Vt,"ALPH")||(oe[0]=_e,Jt[0]=Vt+8,Be[0]=or),Vt+=on,un-=on}}if(A=A[0],xt.na=xt.na[0],xt.P=xt.P[0],xt.Sa=xt.Sa[0],Rt!=0)break}A=[A],xt.Ja=[xt.Ja],xt.xa=[xt.xa];t:if(Me=p,Rt=b,Xt=A,oe=xt.gb[0],Jt=xt.Ja,Be=xt.xa,_e=Rt[0],Vt=!e(Me,_e,"VP8 "),sn=!e(Me,_e,"VP8L"),t(Me!=null),t(Xt!=null),t(Jt!=null),t(Be!=null),8>Xt[0])Rt=7;else{if(Vt||sn){if(Me=I(Me,_e+4),12<=oe&&Me>oe-12){Rt=3;break t}if(it&&Me>Xt[0]-8){Rt=7;break t}Jt[0]=Me,Rt[0]+=8,Xt[0]-=8,Be[0]=sn}else Be[0]=5<=Xt[0]&&Me[_e+0]==47&&!(Me[_e+4]>>5),Jt[0]=Xt[0];Rt=0}if(A=A[0],xt.Ja=xt.Ja[0],xt.xa=xt.xa[0],b=b[0],Rt!=0)break;if(4294967286<xt.Ja)return 3;if(G==null||qt||(G[0]=xt.xa?2:1),W=[W],Mt=[Mt],xt.xa){if(5>A){Rt=7;break}G=W,it=Mt,qt=j,p==null||5>A?p=0:5<=A&&p[b+0]==47&&!(p[b+4]>>5)?(Xt=[0],Me=[0],oe=[0],ct(Jt=new Y,p,b,A),Nt(Jt,Xt,Me,oe)?(G!=null&&(G[0]=Xt[0]),it!=null&&(it[0]=Me[0]),qt!=null&&(qt[0]=oe[0]),p=1):p=0):p=0}else{if(10>A){Rt=7;break}G=Mt,p==null||10>A||!Cn(p,b+3,A-3)?p=0:(it=p[b+0]|p[b+1]<<8|p[b+2]<<16,qt=16383&(p[b+7]<<8|p[b+6]),p=16383&(p[b+9]<<8|p[b+8]),1&it||3<(it>>1&7)||!(it>>4&1)||it>>5>=xt.Ja||!qt||!p?p=0:(W&&(W[0]=qt),G&&(G[0]=p),p=1))}if(!p||(W=W[0],Mt=Mt[0],Tt&&(rt[0]!=W||bt[0]!=Mt)))return 3;V!=null&&(V[0]=xt,V.offset=b-V.w,t(4294967286>b-V.w),t(V.offset==V.ha-A));break}return Rt==0||Rt==7&&Tt&&V==null?(j!=null&&(j[0]|=xt.na!=null&&0<xt.na.length),N!=null&&(N[0]=W),F!=null&&(F[0]=Mt),0):Rt}function Wo(p,b,A){var N=b.width,F=b.height,j=0,W=0,G=N,V=F;if(b.Da=p!=null&&0<p.Da,b.Da&&(G=p.cd,V=p.bd,j=p.v,W=p.j,11>A||(j&=-2,W&=-2),0>j||0>W||0>=G||0>=V||j+G>N||W+V>F))return 0;if(b.v=j,b.j=W,b.va=j+G,b.o=W+V,b.U=G,b.T=V,b.da=p!=null&&0<p.da,b.da){if(!H(G,V,A=[p.ib],j=[p.hb]))return 0;b.ib=A[0],b.hb=j[0]}return b.ob=p!=null&&p.ob,b.Kb=p==null||!p.Sd,b.da&&(b.ob=b.ib<3*N/4&&b.hb<3*F/4,b.Kb=0),1}function qo(p){if(p==null)return 2;if(11>p.S){var b=p.f.RGBA;b.fb+=(p.height-1)*b.A,b.A=-b.A}else b=p.f.kb,p=p.height,b.O+=(p-1)*b.fa,b.fa=-b.fa,b.N+=(p-1>>1)*b.Ab,b.Ab=-b.Ab,b.W+=(p-1>>1)*b.Db,b.Db=-b.Db,b.F!=null&&(b.J+=(p-1)*b.lb,b.lb=-b.lb);return 0}function os(p,b,A,N){if(N==null||0>=p||0>=b)return 2;if(A!=null){if(A.Da){var F=A.cd,j=A.bd,W=-2&A.v,G=-2&A.j;if(0>W||0>G||0>=F||0>=j||W+F>p||G+j>b)return 2;p=F,b=j}if(A.da){if(!H(p,b,F=[A.ib],j=[A.hb]))return 2;p=F[0],b=j[0]}}N.width=p,N.height=b;t:{var V=N.width,rt=N.height;if(p=N.S,0>=V||0>=rt||!(p>=Ya&&13>p))p=2;else{if(0>=N.Rd&&N.sd==null){W=j=F=b=0;var bt=(G=V*hf[p])*rt;if(11>p||(j=(rt+1)/2*(b=(V+1)/2),p==12&&(W=(F=V)*rt)),(rt=s(bt+2*j+W))==null){p=1;break t}N.sd=rt,11>p?((V=N.f.RGBA).eb=rt,V.fb=0,V.A=G,V.size=bt):((V=N.f.kb).y=rt,V.O=0,V.fa=G,V.Fd=bt,V.f=rt,V.N=0+bt,V.Ab=b,V.Cd=j,V.ea=rt,V.W=0+bt+j,V.Db=b,V.Ed=j,p==12&&(V.F=rt,V.J=0+bt+2*j),V.Tc=W,V.lb=F)}if(b=1,F=N.S,j=N.width,W=N.height,F>=Ya&&13>F)if(11>F)p=N.f.RGBA,b&=(G=Math.abs(p.A))*(W-1)+j<=p.size,b&=G>=j*hf[F],b&=p.eb!=null;else{p=N.f.kb,G=(j+1)/2,bt=(W+1)/2,V=Math.abs(p.fa),rt=Math.abs(p.Ab);var Tt=Math.abs(p.Db),it=Math.abs(p.lb),xt=it*(W-1)+j;b&=V*(W-1)+j<=p.Fd,b&=rt*(bt-1)+G<=p.Cd,b=(b&=Tt*(bt-1)+G<=p.Ed)&V>=j&rt>=G&Tt>=G,b&=p.y!=null,b&=p.f!=null,b&=p.ea!=null,F==12&&(b&=it>=j,b&=xt<=p.Tc,b&=p.F!=null)}else b=0;p=b?0:2}}return p!=0||A!=null&&A.fd&&(p=qo(N)),p}var Bs=64,jr=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Ur=24,as=32,Xi=8,ls=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];It("Predictor0","PredictorAdd0"),O.Predictor0=function(){return 4278190080},O.Predictor1=function(p){return p},O.Predictor2=function(p,b,A){return b[A+0]},O.Predictor3=function(p,b,A){return b[A+1]},O.Predictor4=function(p,b,A){return b[A-1]},O.Predictor5=function(p,b,A){return Et(Et(p,b[A+1]),b[A+0])},O.Predictor6=function(p,b,A){return Et(p,b[A-1])},O.Predictor7=function(p,b,A){return Et(p,b[A+0])},O.Predictor8=function(p,b,A){return Et(b[A-1],b[A+0])},O.Predictor9=function(p,b,A){return Et(b[A+0],b[A+1])},O.Predictor10=function(p,b,A){return Et(Et(p,b[A-1]),Et(b[A+0],b[A+1]))},O.Predictor11=function(p,b,A){var N=b[A+0];return 0>=re(N>>24&255,p>>24&255,(b=b[A-1])>>24&255)+re(N>>16&255,p>>16&255,b>>16&255)+re(N>>8&255,p>>8&255,b>>8&255)+re(255&N,255&p,255&b)?N:p},O.Predictor12=function(p,b,A){var N=b[A+0];return(ee((p>>24&255)+(N>>24&255)-((b=b[A-1])>>24&255))<<24|ee((p>>16&255)+(N>>16&255)-(b>>16&255))<<16|ee((p>>8&255)+(N>>8&255)-(b>>8&255))<<8|ee((255&p)+(255&N)-(255&b)))>>>0},O.Predictor13=function(p,b,A){var N=b[A-1];return(Gt((p=Et(p,b[A+0]))>>24&255,N>>24&255)<<24|Gt(p>>16&255,N>>16&255)<<16|Gt(p>>8&255,N>>8&255)<<8|Gt(255&p,255&N))>>>0};var Xo=O.PredictorAdd0;O.PredictorAdd1=ke,It("Predictor2","PredictorAdd2"),It("Predictor3","PredictorAdd3"),It("Predictor4","PredictorAdd4"),It("Predictor5","PredictorAdd5"),It("Predictor6","PredictorAdd6"),It("Predictor7","PredictorAdd7"),It("Predictor8","PredictorAdd8"),It("Predictor9","PredictorAdd9"),It("Predictor10","PredictorAdd10"),It("Predictor11","PredictorAdd11"),It("Predictor12","PredictorAdd12"),It("Predictor13","PredictorAdd13");var ro=O.PredictorAdd2;ve("ColorIndexInverseTransform","MapARGB","32b",function(p){return p>>8&255},function(p){return p}),ve("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(p){return p},function(p){return p>>8&255});var Hn,Xa=O.ColorIndexInverseTransform,_i=O.MapARGB,Si=O.VP8LColorIndexInverseTransformAlpha,Go=O.MapAlpha,Ho=O.VP8LPredictorsAdd=[];Ho.length=16,(O.VP8LPredictors=[]).length=16,(O.VP8LPredictorsAdd_C=[]).length=16,(O.VP8LPredictors_C=[]).length=16;var Yo,Vo,cs,hs,us,Es,fs,Ds,ni,Ai,wn,Mn,Yn,sr,Gi,Zo,io,Ga,Fu,$u,zu,ju,Uu,Wu,Ko,qu,Xu,Gu,Hu=s(511),Yu=s(2041),Vu=s(225),Zu=s(767),Ku=0,Ec=Yu,Ha=Vu,Wr=Zu,ri=Hu,Ya=0,Va=1,Qu=2,Za=3,Ka=4,Dc=5,Ju=6,Fc=7,$c=8,Qa=9,zc=10,Y2=[2,3,7],V2=[3,3,11],tf=[280,256,256,256,40],Z2=[0,1,1,1,0],K2=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Q2=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],J2=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],tg=8,jc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Uc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Qo=null,eg=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ng=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],ef=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],rg=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ig=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],sg=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],og=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ds=[],di=[],Hi=[],ag=1,nf=2,ps=[],ii=[];Wi("UpsampleRgbLinePair",ss,3),Wi("UpsampleBgrLinePair",yr,3),Wi("UpsampleRgbaLinePair",Mr,4),Wi("UpsampleBgraLinePair",Uo,4),Wi("UpsampleArgbLinePair",jo,4),Wi("UpsampleRgba4444LinePair",Rs,2),Wi("UpsampleRgb565LinePair",Os,2);var lg=O.UpsampleRgbLinePair,cg=O.UpsampleBgrLinePair,rf=O.UpsampleRgbaLinePair,sf=O.UpsampleBgraLinePair,of=O.UpsampleArgbLinePair,af=O.UpsampleRgba4444LinePair,hg=O.UpsampleRgb565LinePair,Ja=16,tl=1<<Ja-1,Jo=-227,Wc=482,ug=6,lf=0,fg=s(256),dg=s(256),pg=s(256),gg=s(256),yg=s(Wc-Jo),mg=s(Wc-Jo);qi("YuvToRgbRow",ss,3),qi("YuvToBgrRow",yr,3),qi("YuvToRgbaRow",Mr,4),qi("YuvToBgraRow",Uo,4),qi("YuvToArgbRow",jo,4),qi("YuvToRgba4444Row",Rs,2),qi("YuvToRgb565Row",Os,2);var cf=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],el=[0,2,8],bg=[8,7,6,4,4,2,2,2,1,1,1,1],wg=1;this.WebPDecodeRGBA=function(p,b,A,N,F){var j=Va,W=new Ht,G=new He;W.ba=G,G.S=j,G.width=[G.width],G.height=[G.height];var V=G.width,rt=G.height,bt=new Ee;if(bt==null||p==null)var Tt=2;else t(bt!=null),Tt=Ts(p,b,A,bt.width,bt.height,bt.Pd,bt.Qd,bt.format,null);if(Tt!=0?V=0:(V!=null&&(V[0]=bt.width[0]),rt!=null&&(rt[0]=bt.height[0]),V=1),V){G.width=G.width[0],G.height=G.height[0],N!=null&&(N[0]=G.width),F!=null&&(F[0]=G.height);t:{if(N=new je,(F=new Qt).data=p,F.w=b,F.ha=A,F.kd=1,b=[0],t(F!=null),((p=Ts(F.data,F.w,F.ha,null,null,null,b,null,F))==0||p==7)&&b[0]&&(p=4),(b=p)==0){if(t(W!=null),N.data=F.data,N.w=F.w+F.offset,N.ha=F.ha-F.offset,N.put=lt,N.ac=Z,N.bc=ht,N.ma=W,F.xa){if((p=ae())==null){W=1;break t}if((function(it,xt){var Mt=[0],qt=[0],Rt=[0];e:for(;;){if(it==null)return 0;if(xt==null)return it.a=2,0;if(it.l=xt,it.a=0,ct(it.m,xt.data,xt.w,xt.ha),!Nt(it.m,Mt,qt,Rt)){it.a=3;break e}if(it.xb=nf,xt.width=Mt[0],xt.height=qt[0],!$t(Mt[0],qt[0],1,it,null))break e;return 1}return t(it.a!=0),0})(p,N)){if(N=(b=os(N.width,N.height,W.Oa,W.ba))==0){e:{N=p;n:for(;;){if(N==null){N=0;break e}if(t(N.s.yc!=null),t(N.s.Ya!=null),t(0<N.s.Wb),t((A=N.l)!=null),t((F=A.ma)!=null),N.xb!=0){if(N.ca=F.ba,N.tb=F.tb,t(N.ca!=null),!Wo(F.Oa,A,Za)){N.a=2;break n}if(!le(N,A.width)||A.da)break n;if((A.da||$e(N.ca.S))&&fi(),11>N.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),N.ca.f.kb.F!=null&&fi()),N.Pb&&0<N.s.ua&&N.s.vb.X==null&&!D(N.s.vb,N.s.Wa.Xa)){N.a=1;break n}N.xb=0}if(!se(N,N.V,N.Ba,N.c,N.i,A.o,zt))break n;F.Dc=N.Ma,N=1;break e}t(N.a!=0),N=0}N=!N}N&&(b=p.a)}else b=p.a}else{if((p=new xn)==null){W=1;break t}if(p.Fa=F.na,p.P=F.P,p.qc=F.Sa,hn(p,N)){if((b=os(N.width,N.height,W.Oa,W.ba))==0){if(p.Aa=0,A=W.Oa,t((F=p)!=null),A!=null){if(0<(V=0>(V=A.Md)?0:100<V?255:255*V/100)){for(rt=bt=0;4>rt;++rt)12>(Tt=F.pb[rt]).lc&&(Tt.ia=V*bg[0>Tt.lc?0:Tt.lc]>>3),bt|=Tt.ia;bt&&(alert("todo:VP8InitRandom"),F.ia=1)}F.Ga=A.Id,100<F.Ga?F.Ga=100:0>F.Ga&&(F.Ga=0)}(function(it,xt){if(it==null)return 0;if(xt==null)return ge(it,2,"NULL VP8Io parameter in VP8Decode().");if(!it.cb&&!hn(it,xt))return 0;if(t(it.cb),xt.ac==null||xt.ac(xt)){xt.ob&&(it.L=0);var Mt=el[it.L];if(it.L==2?(it.yb=0,it.zb=0):(it.yb=xt.v-Mt>>4,it.zb=xt.j-Mt>>4,0>it.yb&&(it.yb=0),0>it.zb&&(it.zb=0)),it.Va=xt.o+15+Mt>>4,it.Hb=xt.va+15+Mt>>4,it.Hb>it.za&&(it.Hb=it.za),it.Va>it.Ub&&(it.Va=it.Ub),0<it.L){var qt=it.ed;for(Mt=0;4>Mt;++Mt){var Rt;if(it.Qa.Cb){var Xt=it.Qa.Lb[Mt];it.Qa.Fb||(Xt+=qt.Tb)}else Xt=qt.Tb;for(Rt=0;1>=Rt;++Rt){var Vt=it.gd[Mt][Rt],oe=Xt;if(qt.Pc&&(oe+=qt.vd[0],Rt&&(oe+=qt.od[0])),0<(oe=0>oe?0:63<oe?63:oe)){var Jt=oe;0<qt.wb&&(Jt=4<qt.wb?Jt>>2:Jt>>1)>9-qt.wb&&(Jt=9-qt.wb),1>Jt&&(Jt=1),Vt.dd=Jt,Vt.tc=2*oe+Jt,Vt.ld=40<=oe?2:15<=oe?1:0}else Vt.tc=0;Vt.La=Rt}}}Mt=0}else ge(it,6,"Frame setup failed"),Mt=it.a;if(Mt=Mt==0){if(Mt){it.$c=0,0<it.Aa||(it.Ic=wg);e:{Mt=it.Ic,qt=4*(Jt=it.za);var Be=32*Jt,_e=Jt+1,sn=0<it.L?Jt*(0<it.Aa?2:1):0,Me=(it.Aa==2?2:1)*Jt;if((Vt=qt+832+(Rt=3*(16*Mt+el[it.L])/2*Be)+(Xt=it.Fa!=null&&0<it.Fa.length?it.Kc.c*it.Kc.i:0))!=Vt)Mt=0;else{if(Vt>it.Vb){if(it.Vb=0,it.Ec=s(Vt),it.Fc=0,it.Ec==null){Mt=ge(it,1,"no memory during frame initialization.");break e}it.Vb=Vt}Vt=it.Ec,oe=it.Fc,it.Ac=Vt,it.Bc=oe,oe+=qt,it.Gd=a(Be,ie),it.Hd=0,it.rb=a(_e+1,fe),it.sb=1,it.wa=sn?a(sn,ue):null,it.Y=0,it.D.Nb=0,it.D.wa=it.wa,it.D.Y=it.Y,0<it.Aa&&(it.D.Y+=Jt),t(!0),it.oc=Vt,it.pc=oe,oe+=832,it.ya=a(Me,Ze),it.aa=0,it.D.ya=it.ya,it.D.aa=it.aa,it.Aa==2&&(it.D.aa+=Jt),it.R=16*Jt,it.B=8*Jt,Jt=(Be=el[it.L])*it.R,Be=Be/2*it.B,it.sa=Vt,it.ta=oe+Jt,it.qa=it.sa,it.ra=it.ta+16*Mt*it.R+Be,it.Ha=it.qa,it.Ia=it.ra+8*Mt*it.B+Be,it.$c=0,oe+=Rt,it.mb=Xt?Vt:null,it.nb=Xt?oe:null,t(oe+Xt<=it.Fc+it.Vb),nn(it),r(it.Ac,it.Bc,0,qt),Mt=1}}if(Mt){if(xt.ka=0,xt.y=it.sa,xt.O=it.ta,xt.f=it.qa,xt.N=it.ra,xt.ea=it.Ha,xt.Vd=it.Ia,xt.fa=it.R,xt.Rc=it.B,xt.F=null,xt.J=0,!Ku){for(Mt=-255;255>=Mt;++Mt)Hu[255+Mt]=0>Mt?-Mt:Mt;for(Mt=-1020;1020>=Mt;++Mt)Yu[1020+Mt]=-128>Mt?-128:127<Mt?127:Mt;for(Mt=-112;112>=Mt;++Mt)Vu[112+Mt]=-16>Mt?-16:15<Mt?15:Mt;for(Mt=-255;510>=Mt;++Mt)Zu[255+Mt]=0>Mt?0:255<Mt?255:Mt;Ku=1}fs=hi,Ds=pr,Ai=Lr,wn=Ri,Mn=Ti,ni=Oi,Yn=Ua,sr=Ns,Gi=E,Zo=st,io=Wa,Ga=k,Fu=ut,$u=St,zu=Ms,ju=$o,Uu=za,Wu=ja,di[0]=Ic,di[1]=rs,di[2]=Nc,di[3]=Pc,di[4]=Ei,di[5]=Oc,di[6]=Di,di[7]=Rc,di[8]=To,di[9]=Js,ds[0]=Lc,ds[1]=Cc,ds[2]=Oo,ds[3]=Fa,ds[4]=Cs,ds[5]=Ro,ds[6]=Mc,Hi[0]=Bc,Hi[1]=Ac,Hi[2]=Ls,Hi[3]=Tc,Hi[4]=Eo,Hi[5]=Bo,Hi[6]=$a,Mt=1}else Mt=0}Mt&&(Mt=(function(un,or){for(un.M=0;un.M<un.Va;++un.M){var on,Ne=un.Jc[un.M&un.Xb],ye=un.m,Vn=un;for(on=0;on<Vn.za;++on){var tn=ye,fn=Vn,Bn=fn.Ac,mr=fn.Bc+4*on,Nr=fn.zc,Un=fn.ya[fn.aa+on];if(fn.Qa.Bb?Un.$b=jt(tn,fn.Pa.jb[0])?2+jt(tn,fn.Pa.jb[2]):jt(tn,fn.Pa.jb[1]):Un.$b=0,fn.kc&&(Un.Ad=jt(tn,fn.Bd)),Un.Za=!jt(tn,145)+0,Un.Za){var vr=Un.Ob,Pr=0;for(fn=0;4>fn;++fn){var ar,gn=Nr[0+fn];for(ar=0;4>ar;++ar){gn=ig[Bn[mr+ar]][gn];for(var kn=ef[jt(tn,gn[0])];0<kn;)kn=ef[2*kn+jt(tn,gn[kn])];gn=-kn,Bn[mr+ar]=gn}i(vr,Pr,Bn,mr,4),Pr+=4,Nr[0+fn]=gn}}else gn=jt(tn,156)?jt(tn,128)?1:3:jt(tn,163)?2:0,Un.Ob[0]=gn,r(Bn,mr,gn,4),r(Nr,0,gn,4);Un.Dd=jt(tn,142)?jt(tn,114)?jt(tn,183)?1:3:2:0}if(Vn.m.Ka)return ge(un,7,"Premature end-of-partition0 encountered.");for(;un.ja<un.za;++un.ja){if(Vn=Ne,tn=(ye=un).rb[ye.sb-1],Bn=ye.rb[ye.sb+ye.ja],on=ye.ya[ye.aa+ye.ja],mr=ye.kc?on.Ad:0)tn.la=Bn.la=0,on.Za||(tn.Na=Bn.Na=0),on.Hc=0,on.Gc=0,on.ia=0;else{var Wn,_n;if(tn=Bn,Bn=Vn,mr=ye.Pa.Xc,Nr=ye.ya[ye.aa+ye.ja],Un=ye.pb[Nr.$b],fn=Nr.ad,vr=0,Pr=ye.rb[ye.sb-1],gn=ar=0,r(fn,vr,0,384),Nr.Za)var br=0,pi=mr[3];else{kn=s(16);var Zn=tn.Na+Pr.Na;if(Zn=Qo(Bn,mr[1],Zn,Un.Eb,0,kn,0),tn.Na=Pr.Na=(0<Zn)+0,1<Zn)fs(kn,0,fn,vr);else{var Rr=kn[0]+3>>3;for(kn=0;256>kn;kn+=16)fn[vr+kn]=Rr}br=1,pi=mr[0]}var Nn=15&tn.la,lr=15&Pr.la;for(kn=0;4>kn;++kn){var qr=1&lr;for(Rr=_n=0;4>Rr;++Rr)Nn=Nn>>1|(qr=(Zn=Qo(Bn,pi,Zn=qr+(1&Nn),Un.Sc,br,fn,vr))>br)<<7,_n=_n<<2|(3<Zn?3:1<Zn?2:fn[vr+0]!=0),vr+=16;Nn>>=4,lr=lr>>1|qr<<7,ar=(ar<<8|_n)>>>0}for(pi=Nn,br=lr>>4,Wn=0;4>Wn;Wn+=2){for(_n=0,Nn=tn.la>>4+Wn,lr=Pr.la>>4+Wn,kn=0;2>kn;++kn){for(qr=1&lr,Rr=0;2>Rr;++Rr)Zn=qr+(1&Nn),Nn=Nn>>1|(qr=0<(Zn=Qo(Bn,mr[2],Zn,Un.Qc,0,fn,vr)))<<3,_n=_n<<2|(3<Zn?3:1<Zn?2:fn[vr+0]!=0),vr+=16;Nn>>=2,lr=lr>>1|qr<<5}gn|=_n<<4*Wn,pi|=Nn<<4<<Wn,br|=(240&lr)<<Wn}tn.la=pi,Pr.la=br,Nr.Hc=ar,Nr.Gc=gn,Nr.ia=43690&gn?0:Un.ia,mr=!(ar|gn)}if(0<ye.L&&(ye.wa[ye.Y+ye.ja]=ye.gd[on.$b][on.Za],ye.wa[ye.Y+ye.ja].La|=!mr),Vn.Ka)return ge(un,7,"Premature end-of-file encountered.")}if(nn(un),ye=or,Vn=1,on=(Ne=un).D,tn=0<Ne.L&&Ne.M>=Ne.zb&&Ne.M<=Ne.Va,Ne.Aa==0)e:{if(on.M=Ne.M,on.uc=tn,ei(Ne,on),Vn=1,on=(_n=Ne.D).Nb,tn=(gn=el[Ne.L])*Ne.R,Bn=gn/2*Ne.B,kn=16*on*Ne.R,Rr=8*on*Ne.B,mr=Ne.sa,Nr=Ne.ta-tn+kn,Un=Ne.qa,fn=Ne.ra-Bn+Rr,vr=Ne.Ha,Pr=Ne.Ia-Bn+Rr,lr=(Nn=_n.M)==0,ar=Nn>=Ne.Va-1,Ne.Aa==2&&ei(Ne,_n),_n.uc)for(qr=(Zn=Ne).D.M,t(Zn.D.uc),_n=Zn.yb;_n<Zn.Hb;++_n){br=_n,pi=qr;var Ir=(Xr=(wr=Zn).D).Nb;Wn=wr.R;var Xr=Xr.wa[Xr.Y+br],Gr=wr.sa,Tr=wr.ta+16*Ir*Wn+16*br,Hr=Xr.dd,Rn=Xr.tc;if(Rn!=0)if(t(3<=Rn),wr.L==1)0<br&&ju(Gr,Tr,Wn,Rn+4),Xr.La&&Wu(Gr,Tr,Wn,Rn),0<pi&&zu(Gr,Tr,Wn,Rn+4),Xr.La&&Uu(Gr,Tr,Wn,Rn);else{var Yr=wr.B,gi=wr.qa,Fs=wr.ra+8*Ir*Yr+8*br,Yi=wr.Ha,wr=wr.Ia+8*Ir*Yr+8*br;Ir=Xr.ld,0<br&&(sr(Gr,Tr,Wn,Rn+4,Hr,Ir),Zo(gi,Fs,Yi,wr,Yr,Rn+4,Hr,Ir)),Xr.La&&(Ga(Gr,Tr,Wn,Rn,Hr,Ir),$u(gi,Fs,Yi,wr,Yr,Rn,Hr,Ir)),0<pi&&(Yn(Gr,Tr,Wn,Rn+4,Hr,Ir),Gi(gi,Fs,Yi,wr,Yr,Rn+4,Hr,Ir)),Xr.La&&(io(Gr,Tr,Wn,Rn,Hr,Ir),Fu(gi,Fs,Yi,wr,Yr,Rn,Hr,Ir))}}if(Ne.ia&&alert("todo:DitherRow"),ye.put!=null){if(_n=16*Nn,Nn=16*(Nn+1),lr?(ye.y=Ne.sa,ye.O=Ne.ta+kn,ye.f=Ne.qa,ye.N=Ne.ra+Rr,ye.ea=Ne.Ha,ye.W=Ne.Ia+Rr):(_n-=gn,ye.y=mr,ye.O=Nr,ye.f=Un,ye.N=fn,ye.ea=vr,ye.W=Pr),ar||(Nn-=gn),Nn>ye.o&&(Nn=ye.o),ye.F=null,ye.J=null,Ne.Fa!=null&&0<Ne.Fa.length&&_n<Nn&&(ye.J=On(Ne,ye,_n,Nn-_n),ye.F=Ne.mb,ye.F==null&&ye.F.length==0)){Vn=ge(Ne,3,"Could not decode alpha data.");break e}_n<ye.j&&(gn=ye.j-_n,_n=ye.j,t(!(1&gn)),ye.O+=Ne.R*gn,ye.N+=Ne.B*(gn>>1),ye.W+=Ne.B*(gn>>1),ye.F!=null&&(ye.J+=ye.width*gn)),_n<Nn&&(ye.O+=ye.v,ye.N+=ye.v>>1,ye.W+=ye.v>>1,ye.F!=null&&(ye.J+=ye.v),ye.ka=_n-ye.j,ye.U=ye.va-ye.v,ye.T=Nn-_n,Vn=ye.put(ye))}on+1!=Ne.Ic||ar||(i(Ne.sa,Ne.ta-tn,mr,Nr+16*Ne.R,tn),i(Ne.qa,Ne.ra-Bn,Un,fn+8*Ne.B,Bn),i(Ne.Ha,Ne.Ia-Bn,vr,Pr+8*Ne.B,Bn))}if(!Vn)return ge(un,6,"Output aborted.")}return 1})(it,xt)),xt.bc!=null&&xt.bc(xt),Mt&=1}return Mt?(it.cb=0,Mt):0})(p,N)||(b=p.a)}}else b=p.a}b==0&&W.Oa!=null&&W.Oa.fd&&(b=qo(W.ba))}W=b}j=W!=0?null:11>j?G.f.RGBA.eb:G.f.kb.y}else j=null;return j};var hf=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function c(O,X){for(var R="",M=0;M<4;M++)R+=String.fromCharCode(O[X++]);return R}function h(O,X){return O[X+0]|O[X+1]<<8}function f(O,X){return(O[X+0]|O[X+1]<<8|O[X+2]<<16)>>>0}function d(O,X){return(O[X+0]|O[X+1]<<8|O[X+2]<<16|O[X+3]<<24)>>>0}new l;var u=[0],y=[0],g=[],w=new l,m=n,x=(function(O,X){var R={},M=0,$=!1,S=0,J=0;if(R.frames=[],!(function(P,Y){for(var K=0;K<4;K++)if(P[Y+K]!="RIFF".charCodeAt(K))return!0;return!1})(O,X)){for(d(O,X+=4),X+=8;X<O.length;){var mt=c(O,X),ot=d(O,X+=4);X+=4;var ft=ot+(1&ot);switch(mt){case"VP8 ":case"VP8L":R.frames[M]===void 0&&(R.frames[M]={}),(at=R.frames[M]).src_off=$?J:X-8,at.src_size=S+ot+8,M++,$&&($=!1,S=0,J=0);break;case"VP8X":(at=R.header={}).feature_flags=O[X];var ct=X+4;at.canvas_width=1+f(O,ct),ct+=3,at.canvas_height=1+f(O,ct),ct+=3;break;case"ALPH":$=!0,S=ft+8,J=X-8;break;case"ANIM":(at=R.header).bgcolor=d(O,X),ct=X+4,at.loop_count=h(O,ct),ct+=2;break;case"ANMF":var Bt,at;(at=R.frames[M]={}).offset_x=2*f(O,X),X+=3,at.offset_y=2*f(O,X),X+=3,at.width=1+f(O,X),X+=3,at.height=1+f(O,X),X+=3,at.duration=f(O,X),X+=3,Bt=O[X++],at.dispose=1&Bt,at.blend=Bt>>1&1}mt!="ANMF"&&(X+=ft)}return R}})(m,0);x.response=m,x.rgbaoutput=!0,x.dataurl=!1;var _=x.header?x.header:null,L=x.frames?x.frames:null;if(_){_.loop_counter=_.loop_count,u=[_.canvas_height],y=[_.canvas_width];for(var T=0;T<L.length&&L[T].blend!=0;T++);}var q=L[0],U=w.WebPDecodeRGBA(m,q.src_off,q.src_size,y,u);q.rgba=U,q.imgwidth=y[0],q.imgheight=u[0];for(var B=0;B<y[0]*u[0]*4;B++)g[B]=U[B];return this.width=y,this.height=u,this.data=g,this}(function(n){var t,e,i,r,s,a,o,l,c,h=function(P){return P=P||{},this.isStrokeTransparent=P.isStrokeTransparent||!1,this.strokeOpacity=P.strokeOpacity||1,this.strokeStyle=P.strokeStyle||"#000000",this.fillStyle=P.fillStyle||"#000000",this.isFillTransparent=P.isFillTransparent||!1,this.fillOpacity=P.fillOpacity||1,this.font=P.font||"10px sans-serif",this.textBaseline=P.textBaseline||"alphabetic",this.textAlign=P.textAlign||"left",this.lineWidth=P.lineWidth||1,this.lineJoin=P.lineJoin||"miter",this.lineCap=P.lineCap||"butt",this.path=P.path||[],this.transform=P.transform!==void 0?P.transform.clone():new l,this.globalCompositeOperation=P.globalCompositeOperation||"normal",this.globalAlpha=P.globalAlpha||1,this.clip_path=P.clip_path||[],this.currentPoint=P.currentPoint||new a,this.miterLimit=P.miterLimit||10,this.lastPoint=P.lastPoint||new a,this.lineDashOffset=P.lineDashOffset||0,this.lineDash=P.lineDash||[],this.margin=P.margin||[0,0,0,0],this.prevPageLastElemOffset=P.prevPageLastElemOffset||0,this.ignoreClearRect=typeof P.ignoreClearRect!="boolean"||P.ignoreClearRect,this};n.events.push(["initialized",function(){this.context2d=new f(this),t=this.internal.f2,e=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,r=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,l=this.internal.Matrix,c=new h}]);var f=function(P){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Y=P;Object.defineProperty(this,"pdf",{get:function(){return Y}});var K=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return K},set:function(D){K=!!D}});var et=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return et},set:function(D){et=!!D}});var gt=0;Object.defineProperty(this,"posX",{get:function(){return gt},set:function(D){isNaN(D)||(gt=D)}});var kt=0;Object.defineProperty(this,"posY",{get:function(){return kt},set:function(D){isNaN(D)||(kt=D)}}),Object.defineProperty(this,"margin",{get:function(){return c.margin},set:function(D){var pt;typeof D=="number"?pt=[D,D,D,D]:((pt=new Array(4))[0]=D[0],pt[1]=D.length>=2?D[1]:pt[0],pt[2]=D.length>=3?D[2]:pt[0],pt[3]=D.length>=4?D[3]:pt[1]),c.margin=pt}});var _t=!1;Object.defineProperty(this,"autoPaging",{get:function(){return _t},set:function(D){_t=D}});var Pt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Pt},set:function(D){Pt=D}});var jt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return jt},set:function(D){jt=D}}),Object.defineProperty(this,"ctx",{get:function(){return c},set:function(D){D instanceof h&&(c=D)}}),Object.defineProperty(this,"path",{get:function(){return c.path},set:function(D){c.path=D}});var Zt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Zt},set:function(D){Zt=D}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(D){var pt;pt=d(D),this.ctx.fillStyle=pt.style,this.ctx.isFillTransparent=pt.a===0,this.ctx.fillOpacity=pt.a,this.pdf.setFillColor(pt.r,pt.g,pt.b,{a:pt.a}),this.pdf.setTextColor(pt.r,pt.g,pt.b,{a:pt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(D){var pt=d(D);this.ctx.strokeStyle=pt.style,this.ctx.isStrokeTransparent=pt.a===0,this.ctx.strokeOpacity=pt.a,pt.a===0?this.pdf.setDrawColor(255,255,255):(pt.a,this.pdf.setDrawColor(pt.r,pt.g,pt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(D){["butt","round","square"].indexOf(D)!==-1&&(this.ctx.lineCap=D,this.pdf.setLineCap(D))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(D){isNaN(D)||(this.ctx.lineWidth=D,this.pdf.setLineWidth(D))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(D){["bevel","round","miter"].indexOf(D)!==-1&&(this.ctx.lineJoin=D,this.pdf.setLineJoin(D))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(D){isNaN(D)||(this.ctx.miterLimit=D,this.pdf.setMiterLimit(D))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(D){this.ctx.textBaseline=D}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(D){["right","end","center","left","start"].indexOf(D)!==-1&&(this.ctx.textAlign=D)}});var pe=null,he=null,I=null;Object.defineProperty(this,"fontFaces",{get:function(){return I},set:function(D){pe=null,he=null,I=D}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(D){var pt;if(this.ctx.font=D,(pt=/^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-_,\\"\\\'\\sa-z0-9]+?)\\s*$/i.exec(D))!==null){var tt=pt[1];pt[2];var H=pt[3],nt=pt[4];pt[5];var Ct=pt[6],It=/^([.\\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(nt)[2];nt=Math.floor(It==="px"?parseFloat(nt)*this.pdf.internal.scaleFactor:It==="em"?parseFloat(nt)*this.pdf.getFontSize():parseFloat(nt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(nt);var dt=(function(ve){var an,Ie,qe=[],Xe=ve.trim();if(Xe==="")return Dh;if(Xe in rp)return[rp[Xe]];for(;Xe!=="";){switch(Ie=null,an=(Xe=sp(Xe)).charAt(0)){case\'"\':case"\'":Ie=ax(Xe.substring(1),an);break;default:Ie=lx(Xe)}if(Ie===null||(qe.push(Ie[0]),(Xe=sp(Ie[1]))!==""&&Xe.charAt(0)!==","))return Dh;Xe=Xe.replace(/^,/,"")}return qe})(Ct);if(this.fontFaces){var Et=(function(ve,an){var Ie=ve.getFontList(),qe=JSON.stringify(Ie);if(pe===null||he!==qe){var Xe=(function(cn){var Te=[];return Object.keys(cn).forEach(function(mn){cn[mn].forEach(function($e){var Ge=null;switch($e){case"bold":Ge={family:mn,weight:"bold"};break;case"italic":Ge={family:mn,style:"italic"};break;case"bolditalic":Ge={family:mn,weight:"bold",style:"italic"};break;case"":case"normal":Ge={family:mn}}Ge!==null&&(Ge.ref={name:mn,style:$e},Te.push(Ge))})}),Te})(Ie);pe=(function(cn){for(var Te={},mn=0;mn<cn.length;++mn){var $e=Eh(cn[mn]),Ge=$e.family,vn=$e.stretch,He=$e.style,Ee=$e.weight;Te[Ge]=Te[Ge]||{},Te[Ge][vn]=Te[Ge][vn]||{},Te[Ge][vn][He]=Te[Ge][vn][He]||{},Te[Ge][vn][He][Ee]=$e}return Te})(Xe.concat(an)),he=qe}return pe})(this.pdf,this.fontFaces),ee=dt.map(function(ve){return{family:ve,stretch:"normal",weight:H,style:tt}}),Gt=(function(ve,an,Ie){for(var qe=(Ie=Ie||{}).defaultFontFamily||"times",Xe=Object.assign({},ox,Ie.genericFontFamilies||{}),cn=null,Te=null,mn=0;mn<an.length;++mn)if(Xe[(cn=Eh(an[mn])).family]&&(cn.family=Xe[cn.family]),ve.hasOwnProperty(cn.family)){Te=ve[cn.family];break}if(!(Te=Te||ve[qe]))throw new Error("Could not find a font-family for the rule \'"+ip(cn)+"\' and default family \'"+qe+"\'.");if(Te=(function($e,Ge){if(Ge[$e])return Ge[$e];var vn=bu[$e],He=vn<=bu.normal?-1:1,Ee=np(Ge,W2,vn,He);if(!Ee)throw new Error("Could not find a matching font-stretch value for "+$e);return Ee})(cn.stretch,Te),Te=(function($e,Ge){if(Ge[$e])return Ge[$e];for(var vn=U2[$e],He=0;He<vn.length;++He)if(Ge[vn[He]])return Ge[vn[He]];throw new Error("Could not find a matching font-style for "+$e)})(cn.style,Te),!(Te=(function($e,Ge){if(Ge[$e])return Ge[$e];if($e===400&&Ge[500])return Ge[500];if($e===500&&Ge[400])return Ge[400];var vn=sx[$e],He=np(Ge,q2,vn,$e<400?-1:1);if(!He)throw new Error("Could not find a matching font-weight for value "+$e);return He})(cn.weight,Te)))throw new Error("Failed to resolve a font for the rule \'"+ip(cn)+"\'.");return Te})(Et,ee);this.pdf.setFont(Gt.ref.name,Gt.ref.style)}else{var re="";(H==="bold"||parseInt(H,10)>=700||tt==="bold")&&(re="bold"),tt==="italic"&&(re+="italic"),re.length===0&&(re="normal");for(var ke="",me={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},be=0;be<dt.length;be++){if(this.pdf.internal.getFont(dt[be],re,{noFallback:!0,disableWarning:!0})!==void 0){ke=dt[be];break}if(re==="bolditalic"&&this.pdf.internal.getFont(dt[be],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ke=dt[be],re="bold";else if(this.pdf.internal.getFont(dt[be],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ke=dt[be],re="normal";break}}if(ke===""){for(var ze=0;ze<dt.length;ze++)if(me[dt[ze]]){ke=me[dt[ze]];break}}ke=ke===""?"Times":ke,this.pdf.setFont(ke,re)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(D){this.ctx.globalCompositeOperation=D}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(D){this.ctx.globalAlpha=D}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(D){this.ctx.lineDashOffset=D,at.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(D){this.ctx.lineDash=D,at.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(D){this.ctx.ignoreClearRect=!!D}})};f.prototype.setLineDash=function(P){this.lineDash=P},f.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},f.prototype.fill=function(){L.call(this,"fill",!1)},f.prototype.stroke=function(){L.call(this,"stroke",!1)},f.prototype.beginPath=function(){this.path=[{type:"begin"}]},f.prototype.moveTo=function(P,Y){if(isNaN(P)||isNaN(Y))throw Pn.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var K=this.ctx.transform.applyToPoint(new a(P,Y));this.path.push({type:"mt",x:K.x,y:K.y}),this.ctx.lastPoint=new a(P,Y)},f.prototype.closePath=function(){var P=new a(0,0),Y=0;for(Y=this.path.length-1;Y!==-1;Y--)if(this.path[Y].type==="begin"&&An(this.path[Y+1])==="object"&&typeof this.path[Y+1].x=="number"){P=new a(this.path[Y+1].x,this.path[Y+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(P.x,P.y)},f.prototype.lineTo=function(P,Y){if(isNaN(P)||isNaN(Y))throw Pn.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var K=this.ctx.transform.applyToPoint(new a(P,Y));this.path.push({type:"lt",x:K.x,y:K.y}),this.ctx.lastPoint=new a(K.x,K.y)},f.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),L.call(this,null,!0)},f.prototype.quadraticCurveTo=function(P,Y,K,et){if(isNaN(K)||isNaN(et)||isNaN(P)||isNaN(Y))throw Pn.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var gt=this.ctx.transform.applyToPoint(new a(K,et)),kt=this.ctx.transform.applyToPoint(new a(P,Y));this.path.push({type:"qct",x1:kt.x,y1:kt.y,x:gt.x,y:gt.y}),this.ctx.lastPoint=new a(gt.x,gt.y)},f.prototype.bezierCurveTo=function(P,Y,K,et,gt,kt){if(isNaN(gt)||isNaN(kt)||isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et))throw Pn.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var _t=this.ctx.transform.applyToPoint(new a(gt,kt)),Pt=this.ctx.transform.applyToPoint(new a(P,Y)),jt=this.ctx.transform.applyToPoint(new a(K,et));this.path.push({type:"bct",x1:Pt.x,y1:Pt.y,x2:jt.x,y2:jt.y,x:_t.x,y:_t.y}),this.ctx.lastPoint=new a(_t.x,_t.y)},f.prototype.arc=function(P,Y,K,et,gt,kt){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et)||isNaN(gt))throw Pn.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(kt=!!kt,!this.ctx.transform.isIdentity){var _t=this.ctx.transform.applyToPoint(new a(P,Y));P=_t.x,Y=_t.y;var Pt=this.ctx.transform.applyToPoint(new a(0,K)),jt=this.ctx.transform.applyToPoint(new a(0,0));K=Math.sqrt(Math.pow(Pt.x-jt.x,2)+Math.pow(Pt.y-jt.y,2))}Math.abs(gt-et)>=2*Math.PI&&(et=0,gt=2*Math.PI),this.path.push({type:"arc",x:P,y:Y,radius:K,startAngle:et,endAngle:gt,counterclockwise:kt})},f.prototype.arcTo=function(P,Y,K,et,gt){throw new Error("arcTo not implemented.")},f.prototype.rect=function(P,Y,K,et){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et))throw Pn.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(P,Y),this.lineTo(P+K,Y),this.lineTo(P+K,Y+et),this.lineTo(P,Y+et),this.lineTo(P,Y),this.lineTo(P+K,Y),this.lineTo(P,Y)},f.prototype.fillRect=function(P,Y,K,et){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et))throw Pn.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!u.call(this)){var gt={};this.lineCap!=="butt"&&(gt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(gt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(P,Y,K,et),this.fill(),gt.hasOwnProperty("lineCap")&&(this.lineCap=gt.lineCap),gt.hasOwnProperty("lineJoin")&&(this.lineJoin=gt.lineJoin)}},f.prototype.strokeRect=function(P,Y,K,et){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et))throw Pn.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");y.call(this)||(this.beginPath(),this.rect(P,Y,K,et),this.stroke())},f.prototype.clearRect=function(P,Y,K,et){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et))throw Pn.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(P,Y,K,et))},f.prototype.save=function(P){P=typeof P!="boolean"||P;for(var Y=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("q");if(this.pdf.setPage(Y),P){this.ctx.fontSize=this.pdf.internal.getFontSize();var et=new h(this.ctx);this.ctxStack.push(this.ctx),this.ctx=et}},f.prototype.restore=function(P){P=typeof P!="boolean"||P;for(var Y=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("Q");this.pdf.setPage(Y),P&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},f.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var d=function(P){var Y,K,et,gt;if(P.isCanvasGradient===!0&&(P=P.getColor()),!P)return{r:0,g:0,b:0,a:0,style:P};if(/transparent|rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*0+\\s*\\)/.test(P))Y=0,K=0,et=0,gt=0;else{var kt=/rgb\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/.exec(P);if(kt!==null)Y=parseInt(kt[1]),K=parseInt(kt[2]),et=parseInt(kt[3]),gt=1;else if((kt=/rgba\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*([\\d.]+)\\s*\\)/.exec(P))!==null)Y=parseInt(kt[1]),K=parseInt(kt[2]),et=parseInt(kt[3]),gt=parseFloat(kt[4]);else{if(gt=1,typeof P=="string"&&P.charAt(0)!=="#"){var _t=new B2(P);P=_t.ok?_t.toHex():"#000000"}P.length===4?(Y=P.substring(1,2),Y+=Y,K=P.substring(2,3),K+=K,et=P.substring(3,4),et+=et):(Y=P.substring(1,3),K=P.substring(3,5),et=P.substring(5,7)),Y=parseInt(Y,16),K=parseInt(K,16),et=parseInt(et,16)}}return{r:Y,g:K,b:et,a:gt,style:P}},u=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},y=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};f.prototype.fillText=function(P,Y,K,et){if(isNaN(Y)||isNaN(K)||typeof P!="string")throw Pn.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(et=isNaN(et)?void 0:et,!u.call(this)){var gt=ft(this.ctx.transform.rotation),kt=this.ctx.transform.scaleX;M.call(this,{text:P,x:Y,y:K,scale:kt,angle:gt,align:this.textAlign,maxWidth:et})}},f.prototype.strokeText=function(P,Y,K,et){if(isNaN(Y)||isNaN(K)||typeof P!="string")throw Pn.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!y.call(this)){et=isNaN(et)?void 0:et;var gt=ft(this.ctx.transform.rotation),kt=this.ctx.transform.scaleX;M.call(this,{text:P,x:Y,y:K,scale:kt,renderingMode:"stroke",angle:gt,align:this.textAlign,maxWidth:et})}},f.prototype.measureText=function(P){if(typeof P!="string")throw Pn.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Y=this.pdf,K=this.pdf.internal.scaleFactor,et=Y.internal.getFontSize(),gt=Y.getStringUnitWidth(P)*et/Y.internal.scaleFactor;return new function(kt){var _t=(kt=kt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return _t}}),this}({width:gt*=Math.round(96*K/72*1e4)/1e4})},f.prototype.scale=function(P,Y){if(isNaN(P)||isNaN(Y))throw Pn.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var K=new l(P,0,0,Y,0,0);this.ctx.transform=this.ctx.transform.multiply(K)},f.prototype.rotate=function(P){if(isNaN(P))throw Pn.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Y=new l(Math.cos(P),Math.sin(P),-Math.sin(P),Math.cos(P),0,0);this.ctx.transform=this.ctx.transform.multiply(Y)},f.prototype.translate=function(P,Y){if(isNaN(P)||isNaN(Y))throw Pn.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var K=new l(1,0,0,1,P,Y);this.ctx.transform=this.ctx.transform.multiply(K)},f.prototype.transform=function(P,Y,K,et,gt,kt){if(isNaN(P)||isNaN(Y)||isNaN(K)||isNaN(et)||isNaN(gt)||isNaN(kt))throw Pn.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var _t=new l(P,Y,K,et,gt,kt);this.ctx.transform=this.ctx.transform.multiply(_t)},f.prototype.setTransform=function(P,Y,K,et,gt,kt){P=isNaN(P)?1:P,Y=isNaN(Y)?0:Y,K=isNaN(K)?0:K,et=isNaN(et)?1:et,gt=isNaN(gt)?0:gt,kt=isNaN(kt)?0:kt,this.ctx.transform=new l(P,Y,K,et,gt,kt)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};f.prototype.drawImage=function(P,Y,K,et,gt,kt,_t,Pt,jt){var Zt=this.pdf.getImageProperties(P),pe=1,he=1,I=1,D=1;et!==void 0&&Pt!==void 0&&(I=Pt/et,D=jt/gt,pe=Zt.width/et*Pt/et,he=Zt.height/gt*jt/gt),kt===void 0&&(kt=Y,_t=K,Y=0,K=0),et!==void 0&&Pt===void 0&&(Pt=et,jt=gt),et===void 0&&Pt===void 0&&(Pt=Zt.width,jt=Zt.height);var pt=this.ctx.transform.decompose(),tt=ft(pt.rotate.shx),H=new l,nt=(H=(H=(H=H.multiply(pt.translate)).multiply(pt.skew)).multiply(pt.scale)).applyToRectangle(new o(kt-Y*I,_t-K*D,et*pe,gt*he));if(this.autoPaging){for(var Ct,It=w.call(this,nt),dt=[],Et=0;Et<It.length;Et+=1)dt.indexOf(It[Et])===-1&&dt.push(It[Et]);_(dt);for(var ee=dt[0],Gt=dt[dt.length-1],re=ee;re<Gt+1;re++){this.pdf.setPage(re);var ke=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],me=re===1?this.posY+this.margin[0]:this.margin[0],be=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ze=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ve=re===1?0:be+(re-2)*ze;if(this.ctx.clip_path.length!==0){var an=this.path;Ct=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(Ct,this.posX+this.margin[3],-ve+me+this.ctx.prevPageLastElemOffset),T.call(this,"fill",!0),this.path=an}var Ie=JSON.parse(JSON.stringify(nt));Ie=x([Ie],this.posX+this.margin[3],-ve+me+this.ctx.prevPageLastElemOffset)[0];var qe=(re>ee||re<Gt)&&g.call(this);qe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ke,ze,null).clip().discardPath()),this.pdf.addImage(P,"JPEG",Ie.x,Ie.y,Ie.w,Ie.h,null,null,tt),qe&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(P,"JPEG",nt.x,nt.y,nt.w,nt.h,null,null,tt)};var w=function(P,Y,K){var et=[];Y=Y||this.pdf.internal.pageSize.width,K=K||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var gt=this.posY+this.ctx.prevPageLastElemOffset;switch(P.type){default:case"mt":case"lt":et.push(Math.floor((P.y+gt)/K)+1);break;case"arc":et.push(Math.floor((P.y+gt-P.radius)/K)+1),et.push(Math.floor((P.y+gt+P.radius)/K)+1);break;case"qct":var kt=ct(this.ctx.lastPoint.x,this.ctx.lastPoint.y,P.x1,P.y1,P.x,P.y);et.push(Math.floor((kt.y+gt)/K)+1),et.push(Math.floor((kt.y+kt.h+gt)/K)+1);break;case"bct":var _t=Bt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,P.x1,P.y1,P.x2,P.y2,P.x,P.y);et.push(Math.floor((_t.y+gt)/K)+1),et.push(Math.floor((_t.y+_t.h+gt)/K)+1);break;case"rect":et.push(Math.floor((P.y+gt)/K)+1),et.push(Math.floor((P.y+P.h+gt)/K)+1)}for(var Pt=0;Pt<et.length;Pt+=1)for(;this.pdf.internal.getNumberOfPages()<et[Pt];)m.call(this);return et},m=function(){var P=this.fillStyle,Y=this.strokeStyle,K=this.font,et=this.lineCap,gt=this.lineWidth,kt=this.lineJoin;this.pdf.addPage(),this.fillStyle=P,this.strokeStyle=Y,this.font=K,this.lineCap=et,this.lineWidth=gt,this.lineJoin=kt},x=function(P,Y,K){for(var et=0;et<P.length;et++)switch(P[et].type){case"bct":P[et].x2+=Y,P[et].y2+=K;case"qct":P[et].x1+=Y,P[et].y1+=K;default:P[et].x+=Y,P[et].y+=K}return P},_=function(P){return P.sort(function(Y,K){return Y-K})},L=function(P,Y){var K=this.fillStyle,et=this.strokeStyle,gt=this.lineCap,kt=this.lineWidth,_t=Math.abs(kt*this.ctx.transform.scaleX),Pt=this.lineJoin;if(this.autoPaging){for(var jt,Zt,pe=JSON.parse(JSON.stringify(this.path)),he=JSON.parse(JSON.stringify(this.path)),I=[],D=0;D<he.length;D++)if(he[D].x!==void 0)for(var pt=w.call(this,he[D]),tt=0;tt<pt.length;tt+=1)I.indexOf(pt[tt])===-1&&I.push(pt[tt]);for(var H=0;H<I.length;H++)for(;this.pdf.internal.getNumberOfPages()<I[H];)m.call(this);_(I);for(var nt=I[0],Ct=I[I.length-1],It=nt;It<Ct+1;It++){this.pdf.setPage(It),this.fillStyle=K,this.strokeStyle=et,this.lineCap=gt,this.lineWidth=_t,this.lineJoin=Pt;var dt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Et=It===1?this.posY+this.margin[0]:this.margin[0],ee=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Gt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],re=It===1?0:ee+(It-2)*Gt;if(this.ctx.clip_path.length!==0){var ke=this.path;jt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(jt,this.posX+this.margin[3],-re+Et+this.ctx.prevPageLastElemOffset),T.call(this,P,!0),this.path=ke}if(Zt=JSON.parse(JSON.stringify(pe)),this.path=x(Zt,this.posX+this.margin[3],-re+Et+this.ctx.prevPageLastElemOffset),Y===!1||It===0){var me=(It>nt||It<Ct)&&g.call(this);me&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],dt,Gt,null).clip().discardPath()),T.call(this,P,Y),me&&this.pdf.restoreGraphicsState()}this.lineWidth=kt}this.path=pe}else this.lineWidth=_t,T.call(this,P,Y),this.lineWidth=kt},T=function(P,Y){if((P!=="stroke"||Y||!y.call(this))&&(P==="stroke"||Y||!u.call(this))){for(var K,et,gt=[],kt=this.path,_t=0;_t<kt.length;_t++){var Pt=kt[_t];switch(Pt.type){case"begin":gt.push({begin:!0});break;case"close":gt.push({close:!0});break;case"mt":gt.push({start:Pt,deltas:[],abs:[]});break;case"lt":var jt=gt.length;if(kt[_t-1]&&!isNaN(kt[_t-1].x)&&(K=[Pt.x-kt[_t-1].x,Pt.y-kt[_t-1].y],jt>0)){for(;jt>=0;jt--)if(gt[jt-1].close!==!0&&gt[jt-1].begin!==!0){gt[jt-1].deltas.push(K),gt[jt-1].abs.push(Pt);break}}break;case"bct":K=[Pt.x1-kt[_t-1].x,Pt.y1-kt[_t-1].y,Pt.x2-kt[_t-1].x,Pt.y2-kt[_t-1].y,Pt.x-kt[_t-1].x,Pt.y-kt[_t-1].y],gt[gt.length-1].deltas.push(K);break;case"qct":var Zt=kt[_t-1].x+2/3*(Pt.x1-kt[_t-1].x),pe=kt[_t-1].y+2/3*(Pt.y1-kt[_t-1].y),he=Pt.x+2/3*(Pt.x1-Pt.x),I=Pt.y+2/3*(Pt.y1-Pt.y),D=Pt.x,pt=Pt.y;K=[Zt-kt[_t-1].x,pe-kt[_t-1].y,he-kt[_t-1].x,I-kt[_t-1].y,D-kt[_t-1].x,pt-kt[_t-1].y],gt[gt.length-1].deltas.push(K);break;case"arc":gt.push({deltas:[],abs:[],arc:!0}),Array.isArray(gt[gt.length-1].abs)&&gt[gt.length-1].abs.push(Pt)}}et=Y?null:P==="stroke"?"stroke":"fill";for(var tt=!1,H=0;H<gt.length;H++)if(gt[H].arc)for(var nt=gt[H].abs,Ct=0;Ct<nt.length;Ct++){var It=nt[Ct];It.type==="arc"?B.call(this,It.x,It.y,It.radius,It.startAngle,It.endAngle,It.counterclockwise,void 0,Y,!tt):$.call(this,It.x,It.y),tt=!0}else if(gt[H].close===!0)this.pdf.internal.out("h"),tt=!1;else if(gt[H].begin!==!0){var dt=gt[H].start.x,Et=gt[H].start.y;S.call(this,gt[H].deltas,dt,Et),tt=!0}et&&O.call(this,et),Y&&X.call(this)}},q=function(P){var Y=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,K=Y*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return P-K;case"top":return P+Y-K;case"hanging":return P+Y-2*K;case"middle":return P+Y/2-K;default:return P}},U=function(P){return P+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};f.prototype.createLinearGradient=function(){var P=function(){};return P.colorStops=[],P.addColorStop=function(Y,K){this.colorStops.push([Y,K])},P.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},P.isCanvasGradient=!0,P},f.prototype.createPattern=function(){return this.createLinearGradient()},f.prototype.createRadialGradient=function(){return this.createLinearGradient()};var B=function(P,Y,K,et,gt,kt,_t,Pt,jt){for(var Zt=mt.call(this,K,et,gt,kt),pe=0;pe<Zt.length;pe++){var he=Zt[pe];pe===0&&(jt?R.call(this,he.x1+P,he.y1+Y):$.call(this,he.x1+P,he.y1+Y)),J.call(this,P,Y,he.x2,he.y2,he.x3,he.y3,he.x4,he.y4)}Pt?X.call(this):O.call(this,_t)},O=function(P){switch(P){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},X=function(){this.pdf.clip(),this.pdf.discardPath()},R=function(P,Y){this.pdf.internal.out(e(P)+" "+i(Y)+" m")},M=function(P){var Y;switch(P.align){case"right":case"end":Y="right";break;case"center":Y="center";break;default:Y="left"}var K,et,gt,kt=this.pdf.getTextDimensions(P.text),_t=q.call(this,P.y),Pt=U.call(this,_t)-kt.h,jt=this.ctx.transform.applyToPoint(new a(P.x,_t));if(this.autoPaging){var Zt=this.ctx.transform.decompose(),pe=new l;pe=(pe=(pe=pe.multiply(Zt.translate)).multiply(Zt.skew)).multiply(Zt.scale);for(var he=this.ctx.transform.applyToRectangle(new o(P.x,_t,kt.w,kt.h)),I=pe.applyToRectangle(new o(P.x,Pt,kt.w,kt.h)),D=w.call(this,I),pt=[],tt=0;tt<D.length;tt+=1)pt.indexOf(D[tt])===-1&&pt.push(D[tt]);_(pt);for(var H=pt[0],nt=pt[pt.length-1],Ct=H;Ct<nt+1;Ct++){this.pdf.setPage(Ct);var It=Ct===1?this.posY+this.margin[0]:this.margin[0],dt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Et=this.pdf.internal.pageSize.height-this.margin[2],ee=Et-this.margin[0],Gt=this.pdf.internal.pageSize.width-this.margin[1],re=Gt-this.margin[3],ke=Ct===1?0:dt+(Ct-2)*ee;if(this.ctx.clip_path.length!==0){var me=this.path;K=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=x(K,this.posX+this.margin[3],-1*ke+It),T.call(this,"fill",!0),this.path=me}var be=x([JSON.parse(JSON.stringify(I))],this.posX+this.margin[3],-ke+It+this.ctx.prevPageLastElemOffset)[0];P.scale>=.01&&(et=this.pdf.internal.getFontSize(),this.pdf.setFontSize(et*P.scale),gt=this.lineWidth,this.lineWidth=gt*P.scale);var ze=this.autoPaging!=="text";if(ze||be.y+be.h<=Et){if(ze||be.y>=It&&be.x<=Gt){var ve=ze?P.text:this.pdf.splitTextToSize(P.text,P.maxWidth||Gt-be.x)[0],an=x([JSON.parse(JSON.stringify(he))],this.posX+this.margin[3],-ke+It+this.ctx.prevPageLastElemOffset)[0],Ie=ze&&(Ct>H||Ct<nt)&&g.call(this);Ie&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],re,ee,null).clip().discardPath()),this.pdf.text(ve,an.x,an.y,{angle:P.angle,align:Y,renderingMode:P.renderingMode}),Ie&&this.pdf.restoreGraphicsState()}}else be.y<Et&&(this.ctx.prevPageLastElemOffset+=Et-be.y);P.scale>=.01&&(this.pdf.setFontSize(et),this.lineWidth=gt)}}else P.scale>=.01&&(et=this.pdf.internal.getFontSize(),this.pdf.setFontSize(et*P.scale),gt=this.lineWidth,this.lineWidth=gt*P.scale),this.pdf.text(P.text,jt.x+this.posX,jt.y+this.posY,{angle:P.angle,align:Y,renderingMode:P.renderingMode,maxWidth:P.maxWidth}),P.scale>=.01&&(this.pdf.setFontSize(et),this.lineWidth=gt)},$=function(P,Y,K,et){K=K||0,et=et||0,this.pdf.internal.out(e(P+K)+" "+i(Y+et)+" l")},S=function(P,Y,K){return this.pdf.lines(P,Y,K,null,null)},J=function(P,Y,K,et,gt,kt,_t,Pt){this.pdf.internal.out([t(r(K+P)),t(s(et+Y)),t(r(gt+P)),t(s(kt+Y)),t(r(_t+P)),t(s(Pt+Y)),"c"].join(" "))},mt=function(P,Y,K,et){for(var gt=2*Math.PI,kt=Math.PI/2;Y>K;)Y-=gt;var _t=Math.abs(K-Y);_t<gt&&et&&(_t=gt-_t);for(var Pt=[],jt=et?-1:1,Zt=Y;_t>1e-5;){var pe=Zt+jt*Math.min(_t,kt);Pt.push(ot.call(this,P,Zt,pe)),_t-=Math.abs(pe-Zt),Zt=pe}return Pt},ot=function(P,Y,K){var et=(K-Y)/2,gt=P*Math.cos(et),kt=P*Math.sin(et),_t=gt,Pt=-kt,jt=_t*_t+Pt*Pt,Zt=jt+_t*gt+Pt*kt,pe=4/3*(Math.sqrt(2*jt*Zt)-Zt)/(_t*kt-Pt*gt),he=_t-pe*Pt,I=Pt+pe*_t,D=he,pt=-I,tt=et+Y,H=Math.cos(tt),nt=Math.sin(tt);return{x1:P*Math.cos(Y),y1:P*Math.sin(Y),x2:he*H-I*nt,y2:he*nt+I*H,x3:D*H-pt*nt,y3:D*nt+pt*H,x4:P*Math.cos(K),y4:P*Math.sin(K)}},ft=function(P){return 180*P/Math.PI},ct=function(P,Y,K,et,gt,kt){var _t=P+.5*(K-P),Pt=Y+.5*(et-Y),jt=gt+.5*(K-gt),Zt=kt+.5*(et-kt),pe=Math.min(P,gt,_t,jt),he=Math.max(P,gt,_t,jt),I=Math.min(Y,kt,Pt,Zt),D=Math.max(Y,kt,Pt,Zt);return new o(pe,I,he-pe,D-I)},Bt=function(P,Y,K,et,gt,kt,_t,Pt){var jt,Zt,pe,he,I,D,pt,tt,H,nt,Ct,It,dt,Et,ee=K-P,Gt=et-Y,re=gt-K,ke=kt-et,me=_t-gt,be=Pt-kt;for(Zt=0;Zt<41;Zt++)H=(pt=(pe=P+(jt=Zt/40)*ee)+jt*((I=K+jt*re)-pe))+jt*(I+jt*(gt+jt*me-I)-pt),nt=(tt=(he=Y+jt*Gt)+jt*((D=et+jt*ke)-he))+jt*(D+jt*(kt+jt*be-D)-tt),Zt==0?(Ct=H,It=nt,dt=H,Et=nt):(Ct=Math.min(Ct,H),It=Math.min(It,nt),dt=Math.max(dt,H),Et=Math.max(Et,nt));return new o(Math.round(Ct),Math.round(It),Math.round(dt-Ct),Math.round(Et-It))},at=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var P,Y,K=(P=this.ctx.lineDash,Y=this.ctx.lineDashOffset,JSON.stringify({lineDash:P,lineDashOffset:Y}));this.prevLineDash!==K&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=K)}}})(De.API),(function(n){var t=function(a){var o,l,c,h,f,d,u,y,g,w;for(l=[],c=0,h=(a+=o="\\0\\0\\0\\0".slice(a.length%4||4)).length;h>c;c+=4)(f=(a.charCodeAt(c)<<24)+(a.charCodeAt(c+1)<<16)+(a.charCodeAt(c+2)<<8)+a.charCodeAt(c+3))!==0?(d=(f=((f=((f=((f=(f-(w=f%85))/85)-(g=f%85))/85)-(y=f%85))/85)-(u=f%85))/85)%85,l.push(d+33,u+33,y+33,g+33,w+33)):l.push(122);return(function(m,x){for(var _=x;_>0;_--)m.pop()})(l,o.length),String.fromCharCode.apply(String,l)+"~>"},e=function(a){var o,l,c,h,f,d=String,u="length",y=255,g="charCodeAt",w="slice",m="replace";for(a[w](-2),a=a[w](0,-2)[m](/\\s/g,"")[m]("z","!!!!!"),c=[],h=0,f=(a+=o="uuuuu"[w](a[u]%5||5))[u];f>h;h+=5)l=52200625*(a[g](h)-33)+614125*(a[g](h+1)-33)+7225*(a[g](h+2)-33)+85*(a[g](h+3)-33)+(a[g](h+4)-33),c.push(y&l>>24,y&l>>16,y&l>>8,y&l);return(function(x,_){for(var L=_;L>0;L--)x.pop()})(c,o[u]),d.fromCharCode.apply(d,c)},i=function(a){return a.split("").map(function(o){return("0"+o.charCodeAt().toString(16)).slice(-2)}).join("")+">"},r=function(a){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((a=a.replace(/\\s/g,"")).indexOf(">")!==-1&&(a=a.substr(0,a.indexOf(">"))),a.length%2&&(a+="0"),o.test(a)===!1)return"";for(var l="",c=0;c<a.length;c+=2)l+=String.fromCharCode("0x"+(a[c]+a[c+1]));return l},s=function(a){for(var o=new Uint8Array(a.length),l=a.length;l--;)o[l]=a.charCodeAt(l);return(o=uu(o)).reduce(function(c,h){return c+String.fromCharCode(h)},"")};n.processDataByFilters=function(a,o){var l=0,c=a||"",h=[];for(typeof(o=o||[])=="string"&&(o=[o]),l=0;l<o.length;l+=1)switch(o[l]){case"ASCII85Decode":case"/ASCII85Decode":c=e(c),h.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":c=t(c),h.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":c=r(c),h.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":c=i(c),h.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":c=s(c),h.push("/FlateDecode");break;default:throw new Error(\'The filter: "\'+o[l]+\'" is not implemented\')}return{data:c,reverseChain:h.reverse().join(" ")}}})(De.API),(function(n){n.loadFile=function(t,e,i){return(function(r,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=(function(l,c,h){var f=new XMLHttpRequest,d=0,u=function(y){var g=y.length,w=[],m=String.fromCharCode;for(d=0;d<g;d+=1)w.push(m(255&y.charCodeAt(d)));return w.join("")};if(f.open("GET",l,!c),f.overrideMimeType("text/plain; charset=x-user-defined"),c===!1&&(f.onload=function(){f.status===200?h(u(this.responseText)):h(void 0)}),f.send(null),c&&f.status===200)return u(f.responseText)})(r,s,a)}catch{}return o})(t,e,i)},n.allowFsRead=void 0,n.loadImageFile=n.loadFile})(De.API),(function(n){function t(){return(Ye.html2canvas?Promise.resolve(Ye.html2canvas):Tl(()=>import("./html2canvas.esm.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function e(){return(Ye.DOMPurify?Promise.resolve(Ye.DOMPurify):Tl(()=>import("./purify.es.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var i=function(o){var l=An(o);return l==="undefined"?"undefined":l==="string"||o instanceof String?"string":l==="number"||o instanceof Number?"number":l==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":l==="object"?"object":"unknown"},r=function(o,l){var c=document.createElement(o);for(var h in l.className&&(c.className=l.className),l.innerHTML&&l.dompurify&&(c.innerHTML=l.dompurify.sanitize(l.innerHTML)),l.style)c.style[h]=l.style[h];return c},s=function o(l,c){for(var h=l.nodeType===3?document.createTextNode(l.nodeValue):l.cloneNode(!1),f=l.firstChild;f;f=f.nextSibling)c!==!0&&f.nodeType===1&&f.nodeName==="SCRIPT"||h.appendChild(o(f,c));return l.nodeType===1&&(l.nodeName==="CANVAS"?(h.width=l.width,h.height=l.height,h.getContext("2d").drawImage(l,0,0)):l.nodeName!=="TEXTAREA"&&l.nodeName!=="SELECT"||(h.value=l.value),h.addEventListener("load",function(){h.scrollTop=l.scrollTop,h.scrollLeft=l.scrollLeft},!0)),h},a=function o(l){var c=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),h=o.convert(Promise.resolve(),c);return(h=h.setProgress(1,o,1,[o])).set(l)};(a.prototype=Object.create(Promise.prototype)).constructor=a,a.convert=function(o,l){return o.__proto__=l||a.prototype,o},a.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},a.prototype.from=function(o,l){return this.then(function(){switch(l=l||(function(c){switch(i(c)){case"string":return"string";case"element":return c.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(o),l){case"string":return this.then(e).then(function(c){return this.set({src:r("div",{innerHTML:o,dompurify:c})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},a.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},a.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},l=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);l.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=r("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=r("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(l),this.prop.container.firstChild.appendChild(r("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},a.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(t).then(function(l){var c=Object.assign({},this.opt.html2canvas);return delete c.onrendered,l(this.prop.container,c)}).then(function(l){(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},a.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(t).then(function(l){var c=this.opt.jsPDF,h=this.opt.fontFaces,f=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,d=Object.assign({async:!0,allowTaint:!0,scale:f,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete d.onrendered,c.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,c.context2d.posX=this.opt.x,c.context2d.posY=this.opt.y,c.context2d.margin=this.opt.margin,c.context2d.fontFaces=h,h)for(var u=0;u<h.length;++u){var y=h[u],g=y.src.find(function(w){return w.format==="truetype"});g&&c.addFont(g.url,y.ref.name,y.ref.style)}return d.windowHeight=d.windowHeight||0,d.windowHeight=d.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):d.windowHeight,c.context2d.save(!0),l(this.prop.container,d)}).then(function(l){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(l),this.prop.canvas=l,document.body.removeChild(this.prop.overlay)})},a.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},a.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},a.prototype.output=function(o,l,c){return(c=c||"pdf").toLowerCase()==="img"||c.toLowerCase()==="image"?this.outputImg(o,l):this.outputPdf(o,l)},a.prototype.outputPdf=function(o,l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,l)})},a.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw\'Image output type "\'+o+\'" is not supported.\'}})},a.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},a.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},a.prototype.set=function(o){if(i(o)!=="object")return this;var l=Object.keys(o||{}).map(function(c){if(c in a.template.prop)return function(){this.prop[c]=o[c]};switch(c){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[c]=o[c]}}},this);return this.then(function(){return this.thenList(l)})},a.prototype.get=function(o,l){return this.then(function(){var c=o in a.template.prop?this.prop[o]:this.opt[o];return l?l(c):c})},a.prototype.setMargin=function(o){return this.then(function(){switch(i(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},a.prototype.setPageSize=function(o){function l(c,h){return Math.floor(c*h/72*96)}return this.then(function(){(o=o||De.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:l(o.inner.width,o.k),height:l(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},a.prototype.setProgress=function(o,l,c,h){return o!=null&&(this.progress.val=o),l!=null&&(this.progress.state=l),c!=null&&(this.progress.n=c),h!=null&&(this.progress.stack=h),this.progress.ratio=this.progress.val/this.progress.state,this},a.prototype.updateProgress=function(o,l,c,h){return this.setProgress(o?this.progress.val+o:null,l||null,c?this.progress.n+c:null,h?this.progress.stack.concat(h):null)},a.prototype.then=function(o,l){var c=this;return this.thenCore(o,l,function(h,f){return c.updateProgress(null,null,1,[h]),Promise.prototype.then.call(this,function(d){return c.updateProgress(null,h),d}).then(h,f).then(function(d){return c.updateProgress(1),d})})},a.prototype.thenCore=function(o,l,c){c=c||Promise.prototype.then;var h=this;o&&(o=o.bind(h)),l&&(l=l.bind(h));var f=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?h:a.convert(Object.assign({},h),Promise.prototype),d=c.call(f,o,l);return a.convert(d,h.__proto__)},a.prototype.thenExternal=function(o,l){return Promise.prototype.then.call(this,o,l)},a.prototype.thenList=function(o){var l=this;return o.forEach(function(c){l=l.thenCore(c)}),l},a.prototype.catch=function(o){o&&(o=o.bind(this));var l=Promise.prototype.catch.call(this,o);return a.convert(l,this)},a.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},a.prototype.error=function(o){return this.then(function(){throw new Error(o)})},a.prototype.using=a.prototype.set,a.prototype.saveAs=a.prototype.save,a.prototype.export=a.prototype.output,a.prototype.run=a.prototype.then,De.getPageSize=function(o,l,c){if(An(o)==="object"){var h=o;o=h.orientation,l=h.unit||l,c=h.format||c}l=l||"mm",c=c||"a4",o=(""+(o||"P")).toLowerCase();var f,d=(""+c).toLowerCase(),u={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(l){case"pt":f=1;break;case"mm":f=72/25.4;break;case"cm":f=72/2.54;break;case"in":f=72;break;case"px":f=.75;break;case"pc":case"em":f=12;break;case"ex":f=6;break;default:throw"Invalid unit: "+l}var y,g=0,w=0;if(u.hasOwnProperty(d))g=u[d][1]/f,w=u[d][0]/f;else try{g=c[1],w=c[0]}catch{throw new Error("Invalid format: "+c)}if(o==="p"||o==="portrait")o="p",w>g&&(y=w,w=g,g=y);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",g>w&&(y=w,w=g,g=y)}return{width:w,height:g,unit:l,k:f,orientation:o}},n.html=function(o,l){(l=l||{}).callback=l.callback||function(){},l.html2canvas=l.html2canvas||{},l.html2canvas.canvas=l.html2canvas.canvas||this.canvas,l.jsPDF=l.jsPDF||this,l.fontFaces=l.fontFaces?l.fontFaces.map(Eh):null;var c=new a(l);return l.worker?c:c.from(o).doCallback()}})(De.API),De.API.addJS=function(n){return ap=n,this.internal.events.subscribe("postPutResources",function(){Nl=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Nl+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),op=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+ap+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Nl!==void 0&&op!==void 0&&this.internal.out("/Names <</JavaScript "+Nl+" 0 R>>")}),this},(function(n){var t;n.events.push(["postPutResources",function(){var e=this,i=/^(\\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\\r\\n/),s=0;s<r.length;s++){var a=r[s],o=i.exec(a);if(o!=null){var l=o[1];e.internal.newObjectDeferredBegin(l,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var c=this.internal.pages.length,h=[];for(s=0;s<c;s++){var f=e.internal.newObject();h.push(f);var d=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+d.objId+" 0 R /XYZ null null null]>> endobj")}var u=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<h.length;s++)e.internal.write("(page_"+(s+1)+")"+h[s]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+u+" 0 R"),e.internal.write(">>","endobj")}}]),n.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),n.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(i,r,s){var a={title:r,options:s,children:[]};return i==null&&(i=this.root),i.children.push(a),a},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(i){i.id=e.internal.newObjectDeferred();for(var r=0;r<i.children.length;r++)this.genIds_r(i.children[r])},e.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},e.outline.renderItems=function(i){for(var r=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<i.children.length;s++){var a=i.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(i)),s>0&&this.line("/Prev "+this.makeRef(i.children[s-1])),s<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var l=e.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+l.objId+" 0 R /XYZ 0 "+r(0)+" 0]")}this.objEnd()}for(var c=0;c<i.children.length;c++)this.renderItems(i.children[c])},e.outline.line=function(i){this.ctx.val+=i+`\\r\n`},e.outline.makeRef=function(i){return i.id+" 0 R"},e.outline.makeString=function(i){return"("+e.internal.pdfEscape(i)+")"},e.outline.objStart=function(i){this.ctx.val+=`\\r\n`+i.id+` 0 obj\\r\n<<\\r\n`},e.outline.objEnd=function(){this.ctx.val+=`>> \\r\nendobj\\r\n`},e.outline.count_r=function(i,r){for(var s=0;s<r.children.length;s++)i.count++,this.count_r(i,r.children[s]);return i.count}}])})(De.API),(function(n){var t=[192,193,194,195,196,197,198,199];n.processJPEG=function(e,i,r,s,a,o){var l,c=this.decode.DCT_DECODE,h=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,l=(function(f){for(var d,u=256*f.charCodeAt(4)+f.charCodeAt(5),y=f.length,g={width:0,height:0,numcomponents:1},w=4;w<y;w+=2){if(w+=u,t.indexOf(f.charCodeAt(w+1))!==-1){d=256*f.charCodeAt(w+5)+f.charCodeAt(w+6),g={width:256*f.charCodeAt(w+7)+f.charCodeAt(w+8),height:d,numcomponents:f.charCodeAt(w+9)};break}u=256*f.charCodeAt(w+2)+f.charCodeAt(w+3)}return g})(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),l.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}h={data:e,width:l.width,height:l.height,colorSpace:o,bitsPerComponent:8,filter:c,index:i,alias:r}}return h}})(De.API),De.API.processPNG=function(n,t,e,i){if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){var r,s=Xv(n,{checkCrc:!0}),a=s.width,o=s.height,l=s.channels,c=s.palette,h=s.depth;r=c&&l===1?(function(B){for(var O=B.width,X=B.height,R=B.data,M=B.palette,$=B.depth,S=!1,J=[],mt=[],ot=void 0,ft=!1,ct=0,Bt=0;Bt<M.length;Bt++){var at=ud(M[Bt],4),P=at[0],Y=at[1],K=at[2],et=at[3];J.push(P,Y,K),et!=null&&(et===0?(ct++,mt.length<1&&mt.push(Bt)):et<255&&(ft=!0))}if(ft||ct>1){S=!0,mt=void 0;var gt=O*X;ot=new Uint8Array(gt);for(var kt=new DataView(R.buffer),_t=0;_t<gt;_t++){var Pt=Fh(kt,_t,$),jt=ud(M[Pt],4)[3];ot[_t]=jt}}else ct===0&&(mt=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:S?8:void 0,colorBytes:R,alphaBytes:ot,needSMask:S,palette:J,mask:mt}})(s):l===2||l===4?(function(B){for(var O=B.data,X=B.width,R=B.height,M=B.channels,$=B.depth,S=M===2?"DeviceGray":"DeviceRGB",J=M-1,mt=X*R,ot=J,ft=mt*ot,ct=1*mt,Bt=Math.ceil(ft*$/8),at=Math.ceil(ct*$/8),P=new Uint8Array(Bt),Y=new Uint8Array(at),K=new DataView(O.buffer),et=new DataView(P.buffer),gt=new DataView(Y.buffer),kt=!1,_t=0;_t<mt;_t++){for(var Pt=_t*M,jt=0;jt<ot;jt++)yp(et,Fh(K,Pt+jt,$),_t*ot+jt,$);var Zt=Fh(K,Pt+ot,$);Zt<(1<<$)-1&&(kt=!0),yp(gt,Zt,1*_t,$)}return{colorSpace:S,colorsPerPixel:J,sMaskBitsPerComponent:kt?$:void 0,colorBytes:P,alphaBytes:Y,needSMask:kt}})(s):(function(B){var O=B.data,X=B.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:X,colorsPerPixel:X==="DeviceGray"?1:3,colorBytes:O instanceof Uint16Array?(function(R){for(var M=R.length,$=new Uint8Array(2*M),S=new DataView($.buffer,$.byteOffset,$.byteLength),J=0;J<M;J++)S.setUint16(2*J,R[J],!1);return $})(O):O,needSMask:!1}})(s);var f,d,u,y=r,g=y.colorSpace,w=y.colorsPerPixel,m=y.sMaskBitsPerComponent,x=y.colorBytes,_=y.alphaBytes,L=y.needSMask,T=y.palette,q=y.mask,U=null;return i!==De.API.image_compression.NONE&&typeof uu=="function"?(U=(function(B){var O;switch(B){case De.API.image_compression.FAST:O=11;break;case De.API.image_compression.MEDIUM:O=13;break;case De.API.image_compression.SLOW:O=14;break;default:O=12}return O})(i),f=this.decode.FLATE_DECODE,d="/Predictor ".concat(U," /Colors ").concat(w," /BitsPerComponent ").concat(h," /Columns ").concat(a),n=up(x,Math.ceil(a*w*h/8),w,h,i),L&&(u=up(_,Math.ceil(a*m/8),1,m,i))):(f=void 0,d=void 0,n=x,L&&(u=_)),(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(u&&this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u))&&(u=this.__addimage__.arrayBufferToBinaryString(u)),{alias:e,data:n,index:t,filter:f,decodeParameters:d,transparency:q,palette:T,sMask:u,predictor:U,width:a,height:o,bitsPerComponent:h,sMaskBitsPerComponent:m,colorSpace:g}}},(function(n){n.processGIF89A=function(t,e,i,r){var s=new fx(t),a=s.width,o=s.height,l=[];s.decodeAndBlitFrameRGBA(0,l);var c={data:l,width:a,height:o},h=new $h(100).encode(c,100);return n.processJPEG.call(this,h,e,i,r)},n.processGIF87A=n.processGIF89A})(De.API),yi.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var n=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(n);for(var t=0;t<n;t++){var e=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:r,green:i,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},yi.prototype.parseBGR=function(){this.pos=this.offset;try{var n="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[n]()}catch(e){Pn.log("bit decode error:"+e)}},yi.prototype.bit1=function(){var n,t=Math.ceil(this.width/8),e=t%4;for(n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,r=0;r<t;r++)for(var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+8*r*4,o=0;o<8&&8*r+o<this.width;o++){var l=this.palette[s>>7-o&1];this.data[a+4*o]=l.blue,this.data[a+4*o+1]=l.green,this.data[a+4*o+2]=l.red,this.data[a+4*o+3]=255}e!==0&&(this.pos+=4-e)}},yi.prototype.bit4=function(){for(var n=Math.ceil(this.width/2),t=n%4,e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,r=0;r<n;r++){var s=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+2*r*4,o=s>>4,l=15&s,c=this.palette[o];if(this.data[a]=c.blue,this.data[a+1]=c.green,this.data[a+2]=c.red,this.data[a+3]=255,2*r+1>=this.width)break;c=this.palette[l],this.data[a+4]=c.blue,this.data[a+4+1]=c.green,this.data[a+4+2]=c.red,this.data[a+4+3]=255}t!==0&&(this.pos+=4-t)}},yi.prototype.bit8=function(){for(var n=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var r=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*i;if(r<this.palette.length){var a=this.palette[r];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}n!==0&&(this.pos+=4-n)}},yi.prototype.bit15=function(){for(var n=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var i=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&t)/t*255|0,o=(s>>5&t)/t*255|0,l=(s>>10&t)/t*255|0,c=s>>15?255:0,h=i*this.width*4+4*r;this.data[h]=l,this.data[h+1]=o,this.data[h+2]=a,this.data[h+3]=c}this.pos+=n}},yi.prototype.bit16=function(){for(var n=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,l=(a>>5&e)/e*255|0,c=(a>>11)/t*255|0,h=r*this.width*4+4*s;this.data[h]=c,this.data[h+1]=l,this.data[h+2]=o,this.data[h+3]=255}this.pos+=n}},yi.prototype.bit24=function(){for(var n=this.height-1;n>=0;n--){for(var t=this.bottom_up?n:this.height-1-n,e=0;e<this.width;e++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=t*this.width*4+4*e;this.data[a]=s,this.data[a+1]=r,this.data[a+2]=i,this.data[a+3]=255}this.pos+=this.width%4}},yi.prototype.bit32=function(){for(var n=this.height-1;n>=0;n--)for(var t=this.bottom_up?n:this.height-1-n,e=0;e<this.width;e++){var i=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=s,this.data[o+1]=r,this.data[o+2]=i,this.data[o+3]=a}},yi.prototype.getData=function(){return this.data},(function(n){n.processBMP=function(t,e,i,r){var s=new yi(t,!1),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new $h(100).encode(l,100);return n.processJPEG.call(this,c,e,i,r)}})(De.API),bp.prototype.getData=function(){return this.data},(function(n){n.processWEBP=function(t,e,i,r){var s=new bp(t),a=s.width,o=s.height,l={data:s.getData(),width:a,height:o},c=new $h(100).encode(l,100);return n.processJPEG.call(this,c,e,i,r)}})(De.API),De.API.processRGBA=function(n,t,e){for(var i=n.data,r=i.length,s=new Uint8Array(r/4*3),a=new Uint8Array(r/4),o=0,l=0,c=0;c<r;c+=4){var h=i[c],f=i[c+1],d=i[c+2],u=i[c+3];s[o++]=h,s[o++]=f,s[o++]=d,a[l++]=u}var y=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:y,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:n.width,height:n.height}},De.API.setLanguage=function(n){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[n]!==void 0&&(this.internal.languageSettings.languageCode=n,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},fo=De.API,Pl=fo.getCharWidthsArray=function(n,t){var e,i,r=(t=t||{}).font||this.internal.getFont(),s=t.fontSize||this.internal.getFontSize(),a=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:r.metadata.Unicode.widths,l=o.fof?o.fof:1,c=t.kerning?t.kerning:r.metadata.Unicode.kerning,h=c.fof?c.fof:1,f=t.doKerning!==!1,d=0,u=n.length,y=0,g=o[0]||l,w=[];for(e=0;e<u;e++)i=n.charCodeAt(e),typeof r.metadata.widthOfString=="function"?w.push((r.metadata.widthOfGlyph(r.metadata.characterToGlyph(i))+a*(1e3/s)||0)/1e3):(d=f&&An(c[i])==="object"&&!isNaN(parseInt(c[i][y],10))?c[i][y]/h:0,w.push((o[i]||g)/l+d)),y=i;return w},lp=fo.getStringUnitWidth=function(n,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),i=t.font||this.internal.getFont(),r=t.charSpace||this.internal.getCharSpace();return fo.processArabic&&(n=fo.processArabic(n)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(n,e,r)/e:Pl.apply(this,arguments).reduce(function(s,a){return s+a},0)},cp=function(n,t,e,i){for(var r=[],s=0,a=n.length,o=0;s!==a&&o+t[s]<e;)o+=t[s],s++;r.push(n.slice(0,s));var l=s;for(o=0;s!==a;)o+t[s]>i&&(r.push(n.slice(l,s)),o=0,l=s),o+=t[s],s++;return l!==s&&r.push(n.slice(l,s)),r},hp=function(n,t,e){e||(e={});var i,r,s,a,o,l,c,h=[],f=[h],d=e.textIndent||0,u=0,y=0,g=n.split(" "),w=Pl.apply(this,[" ",e])[0];if(l=e.lineIndent===-1?g[0].length+2:e.lineIndent||0){var m=Array(l).join(" "),x=[];g.map(function(L){(L=L.split(/\\s*\\n/)).length>1?x=x.concat(L.map(function(T,q){return(q&&T.length?`\n`:"")+T})):x.push(L[0])}),g=x,l=lp.apply(this,[m,e])}for(s=0,a=g.length;s<a;s++){var _=0;if(i=g[s],l&&i[0]==`\n`&&(i=i.substr(1),_=1),d+u+(y=(r=Pl.apply(this,[i,e])).reduce(function(L,T){return L+T},0))>t||_){if(y>t){for(o=cp.apply(this,[i,r,t-(d+u),t]),h.push(o.shift()),h=[o.pop()];o.length;)f.push([o.shift()]);y=r.slice(i.length-(h[0]?h[0].length:0)).reduce(function(L,T){return L+T},0)}else h=[i];f.push(h),d=y+l,u=w}else h.push(i),d+=u+y,u=w}return c=l?function(L,T){return(T?m:"")+L.join(" ")}:function(L){return L.join(" ")},f.map(c)},fo.splitTextToSize=function(n,t,e){var i,r=(e=e||{}).fontSize||this.internal.getFontSize(),s=(function(h){if(h.widths&&h.kerning)return{widths:h.widths,kerning:h.kerning};var f=this.internal.getFont(h.fontName,h.fontStyle),d="Unicode";return f.metadata[d]?{widths:f.metadata[d].widths||{0:1},kerning:f.metadata[d].kerning||{}}:{font:f.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);i=Array.isArray(n)?n:String(n).split(/\\r?\\n/);var a=1*this.internal.scaleFactor*t/r;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/r:0,s.lineIndent=e.lineIndent;var o,l,c=[];for(o=0,l=i.length;o<l;o++)c=c.concat(hp.apply(this,[i[o],a,s]));return c},(function(n){n.__fontmetrics__=n.__fontmetrics__||{};for(var t="0123456789abcdef",e="klmnopqrstuvwxyz",i={},r={},s=0;s<16;s++)i[e[s]]=t[s],r[t[s]]=e[s];var a=function(d){return"0x"+parseInt(d,10).toString(16)},o=n.__fontmetrics__.compress=function(d){var u,y,g,w,m=["{"];for(var x in d){if(u=d[x],isNaN(parseInt(x,10))?y="\'"+x+"\'":(x=parseInt(x,10),y=(y=a(x).slice(2)).slice(0,-1)+r[y.slice(-1)]),typeof u=="number")u<0?(g=a(u).slice(3),w="-"):(g=a(u).slice(2),w=""),g=w+g.slice(0,-1)+r[g.slice(-1)];else{if(An(u)!=="object")throw new Error("Don\'t know what to do with value type "+An(u)+".");g=o(u)}m.push(y+g)}return m.push("}"),m.join("")},l=n.__fontmetrics__.uncompress=function(d){if(typeof d!="string")throw new Error("Invalid argument passed to uncompress.");for(var u,y,g,w,m={},x=1,_=m,L=[],T="",q="",U=d.length-1,B=1;B<U;B+=1)(w=d[B])=="\'"?u?(g=u.join(""),u=void 0):u=[]:u?u.push(w):w=="{"?(L.push([_,g]),_={},g=void 0):w=="}"?((y=L.pop())[0][y[1]]=_,g=void 0,_=y[0]):w=="-"?x=-1:g===void 0?i.hasOwnProperty(w)?(T+=i[w],g=parseInt(T,16)*x,x=1,T=""):T+=w:i.hasOwnProperty(w)?(q+=i[w],_[g]=parseInt(q,16)*x,x=1,g=void 0,q=""):q+=w;return m},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:l("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},h={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},f={Unicode:{"Courier-Oblique":l("{\'widths\'{k3w\'fof\'6o}\'kerning\'{\'fof\'-6o}}"),"Times-BoldItalic":l("{\'widths\'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t\'fof\'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}\'kerning\'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}\'fof\'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":l("{\'widths\'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u\'fof\'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}\'kerning\'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}\'fof\'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:l("{\'widths\'{k3w\'fof\'6o}\'kerning\'{\'fof\'-6o}}"),"Courier-BoldOblique":l("{\'widths\'{k3w\'fof\'6o}\'kerning\'{\'fof\'-6o}}"),"Times-Bold":l("{\'widths\'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t\'fof\'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}\'kerning\'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}\'fof\'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:l("{\'widths\'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r\'fof\'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}\'kerning\'{\'fof\'-6o}}"),Helvetica:l("{\'widths\'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u\'fof\'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}\'kerning\'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}\'fof\'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":l("{\'widths\'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u\'fof\'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}\'kerning\'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}\'fof\'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:l("{\'widths\'{k4u2k1w\'fof\'6o}\'kerning\'{\'fof\'-6o}}"),"Courier-Bold":l("{\'widths\'{k3w\'fof\'6o}\'kerning\'{\'fof\'-6o}}"),"Times-Italic":l("{\'widths\'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n\'fof\'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}\'kerning\'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}\'fof\'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":l("{\'widths\'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s\'fof\'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}\'kerning\'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}\'fof\'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":l("{\'widths\'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u\'fof\'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}\'kerning\'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}\'fof\'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};n.events.push(["addFont",function(d){var u=d.font,y=f.Unicode[u.postScriptName];y&&(u.metadata.Unicode={},u.metadata.Unicode.widths=y.widths,u.metadata.Unicode.kerning=y.kerning);var g=h.Unicode[u.postScriptName];g&&(u.metadata.Unicode.encoding=g,u.encoding=g.codePages[0])}])})(De.API),(function(n){var t=function(e){for(var i=e.length,r=new Uint8Array(i),s=0;s<i;s++)r[s]=e.charCodeAt(s);return r};n.API.events.push(["addFont",function(e){var i=void 0,r=e.font,s=e.instance;if(!r.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont(\'"+r.postScriptName+"\').");if(typeof(i=s.existsFileInVFS(r.postScriptName)===!1?s.loadFile(r.postScriptName):s.getFileFromVFS(r.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont(\'"+r.postScriptName+"\').");(function(a,o){o=/^\\x00\\x01\\x00\\x00/.test(o)?t(o):t(Ul(o)),a.metadata=n.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(r,i)}}])})(De),De.API.addSvgAsImage=function(n,t,e,i,r,s,a,o){if(isNaN(t)||isNaN(e))throw Pn.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(r))throw Pn.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=i,l.height=r;var c=l.getContext("2d");c.fillStyle="#fff",c.fillRect(0,0,l.width,l.height);var h={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},f=this;return(Ye.canvg?Promise.resolve(Ye.canvg):Tl(()=>import("./index.es.js"),[])).catch(function(d){return Promise.reject(new Error("Could not load canvg: "+d))}).then(function(d){return d.default?d.default:d}).then(function(d){return d.fromString(c,n,h)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(d){return d.render(h)}).then(function(){f.addImage(l.toDataURL("image/jpeg",1),t,e,i,r,a,o)})},De.API.putTotalPages=function(n){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(n,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(n,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var r=0;r<this.internal.pages[i].length;r++)this.internal.pages[i][r]=this.internal.pages[i][r].replace(t,e);return this},De.API.viewerPreferences=function(n,t){var e;n=n||{},t=t||!1;var i,r,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),l=[],c=0,h=0,f=0;function d(y,g){var w,m=!1;for(w=0;w<y.length;w+=1)y[w]===g&&(m=!0);return m}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,n==="reset"||t===!0){var u=o.length;for(f=0;f<u;f+=1)e[o[f]].value=e[o[f]].defaultValue,e[o[f]].explicitSet=!1}if(An(n)==="object"){for(r in n)if(s=n[r],d(o,r)&&s!==void 0){if(e[r].type==="boolean"&&typeof s=="boolean")e[r].value=s;else if(e[r].type==="name"&&d(e[r].valueSet,s))e[r].value=s;else if(e[r].type==="integer"&&Number.isInteger(s))e[r].value=s;else if(e[r].type==="array"){for(c=0;c<s.length;c+=1)if(i=!0,s[c].length===1&&typeof s[c][0]=="number")l.push(String(s[c]-1));else if(s[c].length>1){for(h=0;h<s[c].length;h+=1)typeof s[c][h]!="number"&&(i=!1);i===!0&&l.push([s[c][0]-1,s[c][1]-1].join(" "))}e[r].value="["+l.join(" ")+"]"}else e[r].value=e[r].defaultValue;e[r].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var y,g=[];for(y in e)e[y].explicitSet===!0&&(e[y].type==="name"?g.push("/"+y+" /"+e[y].value):g.push("/"+y+" "+e[y].value));g.length!==0&&this.internal.write(`/ViewerPreferences\n<<\n`+g.join(`\n`)+`\n>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},(function(n){var t=function(){var i=\'<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="\'+this.internal.__metadata__.namespaceuri+\'"><jspdf:metadata>\',r=unescape(encodeURIComponent(\'<x:xmpmeta xmlns:x="adobe:ns:meta/">\')),s=unescape(encodeURIComponent(i)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),l=unescape(encodeURIComponent("</x:xmpmeta>")),c=s.length+a.length+o.length+r.length+l.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+c+" >>"),this.internal.write("stream"),this.internal.write(r+s+a+o+l),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};n.addMetadata=function(i,r){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}})(De.API),(function(n){var t=n.API,e=t.pdfEscape16=function(s,a){for(var o,l=a.metadata.Unicode.widths,c=["","0","00","000","0000"],h=[""],f=0,d=s.length;f<d;++f){if(o=a.metadata.characterToGlyph(s.charCodeAt(f)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(f),l.indexOf(o)==-1&&(l.push(o),l.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return h.join("");o=o.toString(16),h.push(c[4-o.length],o)}return h.join("")},i=function(s){var a,o,l,c,h,f,d;for(h=`/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange`,l=[],f=0,d=(o=Object.keys(s).sort(function(u,y){return u-y})).length;f<d;f++)a=o[f],l.length>=100&&(h+=`\n`+l.length+` beginbfchar\n`+l.join(`\n`)+`\nendbfchar`,l=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(c=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),l.push("<"+a+"><"+c+">"));return l.length&&(h+=`\n`+l.length+` beginbfchar\n`+l.join(`\n`)+`\nendbfchar\n`),h+`endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend`};t.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,c=a.newObject,h=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="Identity-H"){for(var f=o.metadata.Unicode.widths,d=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),u="",y=0;y<d.length;y++)u+=String.fromCharCode(d[y]);var g=c();h({data:u,addLength1:!0,objectId:g}),l("endobj");var w=c();h({data:i(o.metadata.toUnicode),addLength1:!0,objectId:w}),l("endobj");var m=c();l("<<"),l("/Type /FontDescriptor"),l("/FontName /"+mo(o.fontName)),l("/FontFile2 "+g+" 0 R"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/Flags "+o.metadata.flags),l("/StemV "+o.metadata.stemV),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l(">>"),l("endobj");var x=c();l("<<"),l("/Type /Font"),l("/BaseFont /"+mo(o.fontName)),l("/FontDescriptor "+m+" 0 R"),l("/W "+n.API.PDFObject.convert(f)),l("/CIDToGIDMap /Identity"),l("/DW 1000"),l("/Subtype /CIDFontType2"),l("/CIDSystemInfo"),l("<<"),l("/Supplement 0"),l("/Registry (Adobe)"),l("/Ordering ("+o.encoding+")"),l(">>"),l(">>"),l("endobj"),o.objectNumber=c(),l("<<"),l("/Type /Font"),l("/Subtype /Type0"),l("/ToUnicode "+w+" 0 R"),l("/BaseFont /"+mo(o.fontName)),l("/Encoding /"+o.encoding),l("/DescendantFonts ["+x+" 0 R]"),l(">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]),t.events.push(["putFont",function(s){(function(a){var o=a.font,l=a.out,c=a.newObject,h=a.putStream;if(o.metadata instanceof n.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var f=o.metadata.rawData,d="",u=0;u<f.length;u++)d+=String.fromCharCode(f[u]);var y=c();h({data:d,addLength1:!0,objectId:y}),l("endobj");var g=c();h({data:i(o.metadata.toUnicode),addLength1:!0,objectId:g}),l("endobj");var w=c();l("<<"),l("/Descent "+o.metadata.decender),l("/CapHeight "+o.metadata.capHeight),l("/StemV "+o.metadata.stemV),l("/Type /FontDescriptor"),l("/FontFile2 "+y+" 0 R"),l("/Flags 96"),l("/FontBBox "+n.API.PDFObject.convert(o.metadata.bbox)),l("/FontName /"+mo(o.fontName)),l("/ItalicAngle "+o.metadata.italicAngle),l("/Ascent "+o.metadata.ascender),l(">>"),l("endobj"),o.objectNumber=c();for(var m=0;m<o.metadata.hmtx.widths.length;m++)o.metadata.hmtx.widths[m]=parseInt(o.metadata.hmtx.widths[m]*(1e3/o.metadata.head.unitsPerEm));l("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+mo(o.fontName)+"/FontDescriptor "+w+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+n.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),l("endobj"),o.isAlreadyPutted=!0}})(s)}]);var r=function(s){var a,o=s.text||"",l=s.x,c=s.y,h=s.options||{},f=s.mutex||{},d=f.pdfEscape,u=f.activeFontKey,y=f.fonts,g=u,w="",m=0,x="",_=y[g].encoding;if(y[g].encoding!=="Identity-H")return{text:o,x:l,y:c,options:h,mutex:f};for(x=o,g=u,Array.isArray(o)&&(x=o[0]),m=0;m<x.length;m+=1)y[g].metadata.hasOwnProperty("cmap")&&(a=y[g].metadata.cmap.unicode.codeMap[x[m].charCodeAt(0)]),a||x[m].charCodeAt(0)<256&&y[g].metadata.hasOwnProperty("Unicode")?w+=x[m]:w+="";var L="";return parseInt(g.slice(1))<14||_==="WinAnsiEncoding"?L=d(w,g).split("").map(function(T){return T.charCodeAt(0).toString(16)}).join(""):_==="Identity-H"&&(L=e(w,y[g])),f.isHex=!0,{text:L,x:l,y:c,options:h,mutex:f}};t.events.push(["postProcessText",function(s){var a=s.text||"",o=[],l={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var c=0;for(c=0;c<a.length;c+=1)Array.isArray(a[c])&&a[c].length===3?o.push([r(Object.assign({},l,{text:a[c][0]})).text,a[c][1],a[c][2]]):o.push(r(Object.assign({},l,{text:a[c]})).text);s.text=o}else s.text=r(Object.assign({},l,{text:a})).text}])})(De),(function(n){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};n.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},n.addFileToVFS=function(e,i){return t.call(this),this.internal.vFS[e]=i,this},n.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}})(De.API),(function(n){n.__bidiEngine__=n.prototype.__bidiEngine__=function(i){var r,s,a,o,l,c,h,f=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],y={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},w=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),x=!1,_=0;this.__bidiEngine__={};var L=function(R){var M=R.charCodeAt(),$=M>>8,S=g[$];return S!==void 0?f[256*S+(255&M)]:$===252||$===253?"AL":m.test($)?"L":$===8?"R":"N"},T=function(R){for(var M,$=0;$<R.length;$++){if((M=L(R.charAt($)))==="L")return!1;if(M==="R")return!0}return!1},q=function(R,M,$,S){var J,mt,ot,ft,ct=M[S];switch(ct){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":x=!1;break;case"N":case"AN":break;case"EN":x&&(ct="AN");break;case"AL":x=!0,ct="R";break;case"WS":case"BN":ct="N";break;case"CS":S<1||S+1>=M.length||(J=$[S-1])!=="EN"&&J!=="AN"||(mt=M[S+1])!=="EN"&&mt!=="AN"?ct="N":x&&(mt="AN"),ct=mt===J?mt:"N";break;case"ES":ct=(J=S>0?$[S-1]:"B")==="EN"&&S+1<M.length&&M[S+1]==="EN"?"EN":"N";break;case"ET":if(S>0&&$[S-1]==="EN"){ct="EN";break}if(x){ct="N";break}for(ot=S+1,ft=M.length;ot<ft&&M[ot]==="ET";)ot++;ct=ot<ft&&M[ot]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(ft=M.length,ot=S+1;ot<ft&&M[ot]==="NSM";)ot++;if(ot<ft){var Bt=R[S],at=Bt>=1425&&Bt<=2303||Bt===64286;if(J=M[ot],at&&(J==="R"||J==="AL")){ct="R";break}}}ct=S<1||(J=M[S-1])==="B"?"N":$[S-1];break;case"B":x=!1,r=!0,ct=_;break;case"S":s=!0,ct="N"}return ct},U=function(R,M,$){var S=R.split("");return $&&B(S,$,{hiLevel:_}),S.reverse(),M&&M.reverse(),S.join("")},B=function(R,M,$){var S,J,mt,ot,ft,ct=-1,Bt=R.length,at=0,P=[],Y=_?u:d,K=[];for(x=!1,r=!1,s=!1,J=0;J<Bt;J++)K[J]=L(R[J]);for(mt=0;mt<Bt;mt++){if(ft=at,P[mt]=q(R,K,P,mt),S=240&(at=Y[ft][y[P[mt]]]),at&=15,M[mt]=ot=Y[at][5],S>0)if(S===16){for(J=ct;J<mt;J++)M[J]=1;ct=-1}else ct=-1;if(Y[at][6])ct===-1&&(ct=mt);else if(ct>-1){for(J=ct;J<mt;J++)M[J]=ot;ct=-1}K[mt]==="B"&&(M[mt]=0),$.hiLevel|=ot}s&&(function(et,gt,kt){for(var _t=0;_t<kt;_t++)if(et[_t]==="S"){gt[_t]=_;for(var Pt=_t-1;Pt>=0&&et[Pt]==="WS";Pt--)gt[Pt]=_}})(K,M,Bt)},O=function(R,M,$,S,J){if(!(J.hiLevel<R)){if(R===1&&_===1&&!r)return M.reverse(),void($&&$.reverse());for(var mt,ot,ft,ct,Bt=M.length,at=0;at<Bt;){if(S[at]>=R){for(ft=at+1;ft<Bt&&S[ft]>=R;)ft++;for(ct=at,ot=ft-1;ct<ot;ct++,ot--)mt=M[ct],M[ct]=M[ot],M[ot]=mt,$&&(mt=$[ct],$[ct]=$[ot],$[ot]=mt);at=ft}at++}}},X=function(R,M,$){var S=R.split(""),J={hiLevel:_};return $||($=[]),B(S,$,J),(function(mt,ot,ft){if(ft.hiLevel!==0&&h)for(var ct,Bt=0;Bt<mt.length;Bt++)ot[Bt]===1&&(ct=w.indexOf(mt[Bt]))>=0&&(mt[Bt]=w[ct+1])})(S,$,J),O(2,S,M,$,J),O(1,S,M,$,J),S.join("")};return this.__bidiEngine__.doBidiReorder=function(R,M,$){if((function(J,mt){if(mt)for(var ot=0;ot<J.length;ot++)mt[ot]=ot;o===void 0&&(o=T(J)),c===void 0&&(c=T(J))})(R,M),a||!l||c)if(a&&l&&o^c)_=o?1:0,R=U(R,M,$);else if(!a&&l&&c)_=o?1:0,R=X(R,M,$),R=U(R,M);else if(!a||o||l||c){if(a&&!l&&o^c)R=U(R,M),o?(_=0,R=X(R,M,$)):(_=1,R=X(R,M,$),R=U(R,M));else if(a&&o&&!l&&c)_=1,R=X(R,M,$),R=U(R,M);else if(!a&&!l&&o^c){var S=h;o?(_=1,R=X(R,M,$),_=0,h=!1,R=X(R,M,$),h=S):(_=0,R=X(R,M,$),R=U(R,M),_=1,h=!1,R=X(R,M,$),h=S,R=U(R,M))}}else _=0,R=X(R,M,$);else _=o?1:0,R=X(R,M,$);return R},this.__bidiEngine__.setOptions=function(R){R&&(a=R.isInputVisual,l=R.isOutputVisual,o=R.isInputRtl,c=R.isOutputRtl,h=R.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new n.__bidiEngine__({isInputVisual:!0});n.API.events.push(["postProcessText",function(i){var r=i.text;i.x,i.y;var s=i.options||{};i.mutex,s.lang;var a=[];if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(r)==="[object Array]"){var o=0;for(a=[],o=0;o<r.length;o+=1)Object.prototype.toString.call(r[o])==="[object Array]"?a.push([e.doBidiReorder(r[o][0]),r[o][1],r[o][2]]):a.push([e.doBidiReorder(r[o])]);i.text=a}else i.text=e.doBidiReorder(r);e.setOptions({isInputVisual:!0})}])})(De),De.API.TTFFont=(function(){function n(t){var e;if(this.rawData=t,e=this.contents=new Ss(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new Lx(this),this.registerTTF()}return n.open=function(t){return new n(t)},n.prototype.parse=function(){return this.directory=new dx(this.contents),this.head=new gx(this),this.name=new vx(this),this.cmap=new G2(this),this.toUnicode={},this.hhea=new yx(this),this.maxp=new xx(this),this.hmtx=new kx(this),this.post=new bx(this),this.os2=new mx(this),this.loca=new Cx(this),this.glyf=new _x(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},n.prototype.registerTTF=function(){var t,e,i,r,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,l,c;for(c=[],a=0,o=(l=this.bbox).length;a<o;a++)t=l[a],c.push(Math.round(t*this.scaleFactor));return c}).call(this),this.stemV=0,this.post.exists?(i=255&(r=this.post.italic_angle),32768&(e=r>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},n.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},n.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},n.prototype.widthOfString=function(t,e,i){var r,s,a,o;for(a=0,s=0,o=(t=""+t).length;0<=o?s<o:s>o;s=0<=o?++s:--s)r=t.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(r))+i*(1e3/e)||0;return a*(e/1e3)},n.prototype.lineHeight=function(t,e){var i;return e==null&&(e=!1),i=e?this.lineGap:0,(this.ascender+i-this.decender)/1e3*t},n})();var ki,Ss=(function(){function n(t){this.data=t??[],this.pos=0,this.length=this.data.length}return n.prototype.readByte=function(){return this.data[this.pos++]},n.prototype.writeByte=function(t){return this.data[this.pos++]=t},n.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},n.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},n.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},n.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},n.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},n.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},n.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},n.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},n.prototype.readString=function(t){var e,i;for(i=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)i[e]=String.fromCharCode(this.readByte());return i.join("")},n.prototype.writeString=function(t){var e,i,r;for(r=[],e=0,i=t.length;0<=i?e<i:e>i;e=0<=i?++e:--e)r.push(this.writeByte(t.charCodeAt(e)));return r},n.prototype.readShort=function(){return this.readInt16()},n.prototype.writeShort=function(t){return this.writeInt16(t)},n.prototype.readLongLong=function(){var t,e,i,r,s,a,o,l;return t=this.readByte(),e=this.readByte(),i=this.readByte(),r=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),l=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^i)+4294967296*(255^r)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^l)+1):72057594037927940*t+281474976710656*e+1099511627776*i+4294967296*r+16777216*s+65536*a+256*o+l},n.prototype.writeLongLong=function(t){var e,i;return e=Math.floor(t/4294967296),i=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},n.prototype.readInt=function(){return this.readInt32()},n.prototype.writeInt=function(t){return this.writeInt32(t)},n.prototype.read=function(t){var e,i;for(e=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)e.push(this.readByte());return e},n.prototype.write=function(t){var e,i,r,s;for(s=[],i=0,r=t.length;i<r;i++)e=t[i],s.push(this.writeByte(e));return s},n})(),dx=(function(){var n;function t(e){var i,r,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},r=0,s=this.tableCount;0<=s?r<s:r>s;r=0<=s?++r:--r)i={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[i.tag]=i}return t.prototype.encode=function(e){var i,r,s,a,o,l,c,h,f,d,u,y,g;for(g in u=Object.keys(e).length,l=Math.log(2),f=16*Math.floor(Math.log(u)/l),a=Math.floor(f/l),h=16*u-f,(r=new Ss).writeInt(this.scalarType),r.writeShort(u),r.writeShort(f),r.writeShort(a),r.writeShort(h),s=16*u,c=r.pos+s,o=null,y=[],e)for(d=e[g],r.writeString(g),r.writeInt(n(d)),r.writeInt(c),r.writeInt(d.length),y=y.concat(d),g==="head"&&(o=c),c+=d.length;c%4;)y.push(0),c++;return r.write(y),i=2981146554-n(r.data),r.pos=o+8,r.writeUInt32(i),r.data},n=function(e){var i,r,s,a;for(e=H2.call(e);e.length%4;)e.push(0);for(s=new Ss(e),r=0,i=0,a=e.length;i<a;i=i+=4)r+=s.readUInt32();return 4294967295&r},t})(),px={}.hasOwnProperty,Pi=function(n,t){for(var e in t)px.call(t,e)&&(n[e]=t[e]);function i(){this.constructor=n}return i.prototype=t.prototype,n.prototype=new i,n.__super__=t.prototype,n};ki=(function(){function n(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return n.prototype.parse=function(){},n.prototype.encode=function(){},n.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},n})();var gx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="head",n.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},n.prototype.encode=function(t){var e;return(e=new Ss).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},n})(),wp=(function(){function n(t,e){var i,r,s,a,o,l,c,h,f,d,u,y,g,w,m,x,_;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),f=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(l=0;l<256;++l)this.codeMap[l]=t.readByte();break;case 4:for(u=t.readUInt16(),d=u/2,t.pos+=6,s=(function(){var L,T;for(T=[],l=L=0;0<=d?L<d:L>d;l=0<=d?++L:--L)T.push(t.readUInt16());return T})(),t.pos+=2,g=(function(){var L,T;for(T=[],l=L=0;0<=d?L<d:L>d;l=0<=d?++L:--L)T.push(t.readUInt16());return T})(),c=(function(){var L,T;for(T=[],l=L=0;0<=d?L<d:L>d;l=0<=d?++L:--L)T.push(t.readUInt16());return T})(),h=(function(){var L,T;for(T=[],l=L=0;0<=d?L<d:L>d;l=0<=d?++L:--L)T.push(t.readUInt16());return T})(),r=(this.length-t.pos+this.offset)/2,o=(function(){var L,T;for(T=[],l=L=0;0<=r?L<r:L>r;l=0<=r?++L:--L)T.push(t.readUInt16());return T})(),l=m=0,_=s.length;m<_;l=++m)for(w=s[l],i=x=y=g[l];y<=w?x<=w:x>=w;i=y<=w?++x:--x)h[l]===0?a=i+c[l]:(a=o[h[l]/2+(i-y)-(d-l)]||0)!==0&&(a+=c[l]),this.codeMap[i]=65535&a}t.pos=f}return n.encode=function(t,e){var i,r,s,a,o,l,c,h,f,d,u,y,g,w,m,x,_,L,T,q,U,B,O,X,R,M,$,S,J,mt,ot,ft,ct,Bt,at,P,Y,K,et,gt,kt,_t,Pt,jt,Zt,pe;switch(S=new Ss,a=Object.keys(t).sort(function(he,I){return he-I}),e){case"macroman":for(g=0,w=(function(){var he=[];for(y=0;y<256;++y)he.push(0);return he})(),x={0:0},s={},J=0,ct=a.length;J<ct;J++)x[Pt=t[r=a[J]]]==null&&(x[Pt]=++g),s[r]={old:t[r],new:x[t[r]]},w[r]=x[t[r]];return S.writeUInt16(1),S.writeUInt16(0),S.writeUInt32(12),S.writeUInt16(0),S.writeUInt16(262),S.writeUInt16(0),S.write(w),{charMap:s,subtable:S.data,maxGlyphID:g+1};case"unicode":for(M=[],f=[],_=0,x={},i={},m=c=null,mt=0,Bt=a.length;mt<Bt;mt++)x[T=t[r=a[mt]]]==null&&(x[T]=++_),i[r]={old:T,new:x[T]},o=x[T]-r,m!=null&&o===c||(m&&f.push(m),M.push(r),c=o),m=r;for(m&&f.push(m),f.push(65535),M.push(65535),X=2*(O=M.length),B=2*Math.pow(Math.log(O)/Math.LN2,2),d=Math.log(B/2)/Math.LN2,U=2*O-B,l=[],q=[],u=[],y=ot=0,at=M.length;ot<at;y=++ot){if(R=M[y],h=f[y],R===65535){l.push(0),q.push(0);break}if(R-($=i[R].new)>=32768)for(l.push(0),q.push(2*(u.length+O-y)),r=ft=R;R<=h?ft<=h:ft>=h;r=R<=h?++ft:--ft)u.push(i[r].new);else l.push($-R),q.push(0)}for(S.writeUInt16(3),S.writeUInt16(1),S.writeUInt32(12),S.writeUInt16(4),S.writeUInt16(16+8*O+2*u.length),S.writeUInt16(0),S.writeUInt16(X),S.writeUInt16(B),S.writeUInt16(d),S.writeUInt16(U),kt=0,P=f.length;kt<P;kt++)r=f[kt],S.writeUInt16(r);for(S.writeUInt16(0),_t=0,Y=M.length;_t<Y;_t++)r=M[_t],S.writeUInt16(r);for(jt=0,K=l.length;jt<K;jt++)o=l[jt],S.writeUInt16(o);for(Zt=0,et=q.length;Zt<et;Zt++)L=q[Zt],S.writeUInt16(L);for(pe=0,gt=u.length;pe<gt;pe++)g=u[pe],S.writeUInt16(g);return{charMap:i,subtable:S.data,maxGlyphID:_+1}}},n})(),G2=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="cmap",n.prototype.parse=function(t){var e,i,r;for(t.pos=this.offset,this.version=t.readUInt16(),r=t.readUInt16(),this.tables=[],this.unicode=null,i=0;0<=r?i<r:i>r;i=0<=r?++i:--i)e=new wp(t,this.offset),this.tables.push(e),e.isUnicode&&this.unicode==null&&(this.unicode=e);return!0},n.encode=function(t,e){var i,r;return e==null&&(e="macroman"),i=wp.encode(t,e),(r=new Ss).writeUInt16(0),r.writeUInt16(1),i.table=r.data.concat(i.subtable),i},n})(),yx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="hhea",n.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},n})(),mx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="OS/2",n.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=(function(){var e,i;for(i=[],e=0;e<10;++e)i.push(t.readByte());return i})(),this.charRange=(function(){var e,i;for(i=[],e=0;e<4;++e)i.push(t.readInt());return i})(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=(function(){var e,i;for(i=[],e=0;e<2;e=++e)i.push(t.readInt());return i})(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},n})(),bx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="post",n.prototype.parse=function(t){var e,i,r;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(i=t.readUInt16(),this.glyphNameIndex=[],s=0;0<=i?s<i:s>i;s=0<=i?++s:--s)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],r=[];t.pos<this.offset+this.length;)e=t.readByte(),r.push(this.names.push(t.readString(e)));return r;case 151552:return i=t.readUInt16(),this.offsets=t.read(i);case 262144:return this.map=(function(){var a,o,l;for(l=[],s=a=0,o=this.file.maxp.numGlyphs;0<=o?a<o:a>o;s=0<=o?++a:--a)l.push(t.readUInt32());return l}).call(this)}},n})(),wx=function(n,t){this.raw=n,this.length=n.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},vx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="name",n.prototype.parse=function(t){var e,i,r,s,a,o,l,c,h,f,d;for(t.pos=this.offset,t.readShort(),e=t.readShort(),o=t.readShort(),i=[],s=0;0<=e?s<e:s>e;s=0<=e?++s:--s)i.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+o+t.readShort()});for(l={},s=h=0,f=i.length;h<f;s=++h)r=i[s],t.pos=r.offset,c=t.readString(r.length),a=new wx(c,r),l[d=r.nameID]==null&&(l[d]=[]),l[r.nameID].push(a);this.strings=l,this.copyright=l[0],this.fontFamily=l[1],this.fontSubfamily=l[2],this.uniqueSubfamily=l[3],this.fontName=l[4],this.version=l[5];try{this.postscriptName=l[6][0].raw.replace(/[\\x00-\\x19\\x80-\\xff]/g,"")}catch{this.postscriptName=l[4][0].raw.replace(/[\\x00-\\x19\\x80-\\xff]/g,"")}return this.trademark=l[7],this.manufacturer=l[8],this.designer=l[9],this.description=l[10],this.vendorUrl=l[11],this.designerUrl=l[12],this.license=l[13],this.licenseUrl=l[14],this.preferredFamily=l[15],this.preferredSubfamily=l[17],this.compatibleFull=l[18],this.sampleText=l[19]},n})(),xx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="maxp",n.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},n})(),kx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="hmtx",n.prototype.parse=function(t){var e,i,r,s,a,o,l;for(t.pos=this.offset,this.metrics=[],e=0,o=this.file.hhea.numberOfMetrics;0<=o?e<o:e>o;e=0<=o?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var c,h;for(h=[],e=c=0;0<=r?c<r:c>r;e=0<=r?++c:--c)h.push(t.readInt16());return h})(),this.widths=(function(){var c,h,f,d;for(d=[],c=0,h=(f=this.metrics).length;c<h;c++)s=f[c],d.push(s.advance);return d}).call(this),i=this.widths[this.widths.length-1],l=[],e=a=0;0<=r?a<r:a>r;e=0<=r?++a:--a)l.push(this.widths.push(i));return l},n.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},n})(),H2=[].slice,_x=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="glyf",n.prototype.parse=function(){return this.cache={}},n.prototype.glyphFor=function(t){var e,i,r,s,a,o,l,c,h,f;return t in this.cache?this.cache[t]:(s=this.file.loca,e=this.file.contents,i=s.indexOf(t),(r=s.lengthOf(t))===0?this.cache[t]=null:(e.pos=this.offset+i,a=(o=new Ss(e.read(r))).readShort(),c=o.readShort(),f=o.readShort(),l=o.readShort(),h=o.readShort(),this.cache[t]=a===-1?new Ax(o,c,f,l,h):new Sx(o,a,c,f,l,h),this.cache[t]))},n.prototype.encode=function(t,e,i){var r,s,a,o,l;for(a=[],s=[],o=0,l=e.length;o<l;o++)r=t[e[o]],s.push(a.length),r&&(a=a.concat(r.encode(i)));return s.push(a.length),{table:a,offsets:s}},n})(),Sx=(function(){function n(t,e,i,r,s,a){this.raw=t,this.numberOfContours=e,this.xMin=i,this.yMin=r,this.xMax=s,this.yMax=a,this.compound=!1}return n.prototype.encode=function(){return this.raw.data},n})(),Ax=(function(){function n(t,e,i,r,s){var a,o;for(this.raw=t,this.xMin=e,this.yMin=i,this.xMax=r,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return n.prototype.encode=function(){var t,e,i;for(e=new Ss(H2.call(this.raw.data)),t=0,i=this.glyphIDs.length;t<i;++t)e.pos=this.glyphOffsets[t];return e.data},n})(),Cx=(function(){function n(){return n.__super__.constructor.apply(this,arguments)}return Pi(n,ki),n.prototype.tag="loca",n.prototype.parse=function(t){var e,i;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=e===0?(function(){var r,s;for(s=[],i=0,r=this.length;i<r;i+=2)s.push(2*t.readUInt16());return s}).call(this):(function(){var r,s;for(s=[],i=0,r=this.length;i<r;i+=4)s.push(t.readUInt32());return s}).call(this)},n.prototype.indexOf=function(t){return this.offsets[t]},n.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},n.prototype.encode=function(t,e){for(var i=new Uint32Array(this.offsets.length),r=0,s=0,a=0;a<i.length;++a)if(i[a]=r,s<e.length&&e[s]==a){++s,i[a]=r;var o=this.offsets[a],l=this.offsets[a+1]-o;l>0&&(r+=l)}for(var c=new Array(4*i.length),h=0;h<i.length;++h)c[4*h+3]=255&i[h],c[4*h+2]=(65280&i[h])>>8,c[4*h+1]=(16711680&i[h])>>16,c[4*h]=(4278190080&i[h])>>24;return c},n})(),Lx=(function(){function n(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return n.prototype.generateCmap=function(){var t,e,i,r,s;for(e in r=this.font.cmap.tables[0].codeMap,t={},s=this.subset)i=s[e],t[e]=r[i];return t},n.prototype.glyphsFor=function(t){var e,i,r,s,a,o,l;for(r={},a=0,o=t.length;a<o;a++)r[s=t[a]]=this.font.glyf.glyphFor(s);for(s in e=[],r)(i=r[s])!=null&&i.compound&&e.push.apply(e,i.glyphIDs);if(e.length>0)for(s in l=this.glyphsFor(e))i=l[s],r[s]=i;return r},n.prototype.encode=function(t,e){var i,r,s,a,o,l,c,h,f,d,u,y,g,w,m;for(r in i=G2.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(t),u={0:0},m=i.charMap)u[(l=m[r]).old]=l.new;for(y in d=i.maxGlyphID,a)y in u||(u[y]=d++);return h=(function(x){var _,L;for(_ in L={},x)L[x[_]]=_;return L})(u),f=Object.keys(h).sort(function(x,_){return x-_}),g=(function(){var x,_,L;for(L=[],x=0,_=f.length;x<_;x++)o=f[x],L.push(h[o]);return L})(),s=this.font.glyf.encode(a,g,u),c=this.font.loca.encode(s.offsets,g),w={cmap:this.font.cmap.raw(),glyf:s.table,loca:c,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(w["OS/2"]=this.font.os2.raw()),this.font.directory.encode(w)},n})();De.API.PDFObject=(function(){var n;function t(){}return n=function(e,i){return(Array(i+1).join("0")+e).slice(-i)},t.convert=function(e){var i,r,s,a;if(Array.isArray(e))return"["+(function(){var o,l,c;for(c=[],o=0,l=e.length;o<l;o++)i=e[o],c.push(t.convert(i));return c})().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e?.isString)return"("+e+")";if(e instanceof Date)return"(D:"+n(e.getUTCFullYear(),4)+n(e.getUTCMonth(),2)+n(e.getUTCDate(),2)+n(e.getUTCHours(),2)+n(e.getUTCMinutes(),2)+n(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(r in s=["<<"],e)a=e[r],s.push("/"+r+" "+t.convert(a));return s.push(">>"),s.join(`\n`)}return""+e},t})();var Il=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function M3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ol(n){throw new Error(\'Could not dynamically require "\'+n+\'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.\')}var zh={exports:{}};var vp;function Mx(){return vp||(vp=1,(function(n,t){(function(e){n.exports=e()})(function(){return(function e(i,r,s){function a(c,h){if(!r[c]){if(!i[c]){var f=typeof Ol=="function"&&Ol;if(!h&&f)return f(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module \'"+c+"\'");throw d.code="MODULE_NOT_FOUND",d}var u=r[c]={exports:{}};i[c][0].call(u.exports,function(y){var g=i[c][1][y];return a(g||y)},u,u.exports,e,i,r,s)}return r[c].exports}for(var o=typeof Ol=="function"&&Ol,l=0;l<s.length;l++)a(s[l]);return a})({1:[function(e,i,r){var s=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(l){for(var c,h,f,d,u,y,g,w=[],m=0,x=l.length,_=x,L=s.getTypeOf(l)!=="string";m<l.length;)_=x-m,f=L?(c=l[m++],h=m<x?l[m++]:0,m<x?l[m++]:0):(c=l.charCodeAt(m++),h=m<x?l.charCodeAt(m++):0,m<x?l.charCodeAt(m++):0),d=c>>2,u=(3&c)<<4|h>>4,y=1<_?(15&h)<<2|f>>6:64,g=2<_?63&f:64,w.push(o.charAt(d)+o.charAt(u)+o.charAt(y)+o.charAt(g));return w.join("")},r.decode=function(l){var c,h,f,d,u,y,g=0,w=0,m="data:";if(l.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var x,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&_--,l.charAt(l.length-2)===o.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=a.uint8array?new Uint8Array(0|_):new Array(0|_);g<l.length;)c=o.indexOf(l.charAt(g++))<<2|(d=o.indexOf(l.charAt(g++)))>>4,h=(15&d)<<4|(u=o.indexOf(l.charAt(g++)))>>2,f=(3&u)<<6|(y=o.indexOf(l.charAt(g++))),x[w++]=c,u!==64&&(x[w++]=h),y!==64&&(x[w++]=f);return x}},{"./support":30,"./utils":32}],2:[function(e,i,r){var s=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,f,d,u,y){this.compressedSize=h,this.uncompressedSize=f,this.crc32=d,this.compression=u,this.compressedContent=y}c.prototype={getContentWorker:function(){var h=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return h.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,f,d){return h.pipe(new o).pipe(new l("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,r){var s=e("./stream/GenericWorker");r.STORE={magic:"\\0\\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,r){var s=e("./utils"),a=(function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l})();i.exports=function(o,l){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?(function(c,h,f,d){var u=a,y=d+f;c^=-1;for(var g=d;g<y;g++)c=c>>>8^u[255&(c^h[g])];return-1^c})(0|l,o,o.length,0):(function(c,h,f,d){var u=a,y=d+f;c^=-1;for(var g=d;g<y;g++)c=c>>>8^u[255&(c^h.charCodeAt(g))];return-1^c})(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(e,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,i,r){var s=null;s=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:s}},{lie:37}],7:[function(e,i,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),l=e("./stream/GenericWorker"),c=s?"uint8array":"array";function h(f,d){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}r.magic="\\b\\0",o.inherits(h,l),h.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,f.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},r.compressWorker=function(f){return new h("Deflate",f)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,r){function s(u,y){var g,w="";for(g=0;g<y;g++)w+=String.fromCharCode(255&u),u>>>=8;return w}function a(u,y,g,w,m,x){var _,L,T=u.file,q=u.compression,U=x!==c.utf8encode,B=o.transformTo("string",x(T.name)),O=o.transformTo("string",c.utf8encode(T.name)),X=T.comment,R=o.transformTo("string",x(X)),M=o.transformTo("string",c.utf8encode(X)),$=O.length!==T.name.length,S=M.length!==X.length,J="",mt="",ot="",ft=T.dir,ct=T.date,Bt={crc32:0,compressedSize:0,uncompressedSize:0};y&&!g||(Bt.crc32=u.crc32,Bt.compressedSize=u.compressedSize,Bt.uncompressedSize=u.uncompressedSize);var at=0;y&&(at|=8),U||!$&&!S||(at|=2048);var P=0,Y=0;ft&&(P|=16),m==="UNIX"?(Y=798,P|=(function(et,gt){var kt=et;return et||(kt=gt?16893:33204),(65535&kt)<<16})(T.unixPermissions,ft)):(Y=20,P|=(function(et){return 63&(et||0)})(T.dosPermissions)),_=ct.getUTCHours(),_<<=6,_|=ct.getUTCMinutes(),_<<=5,_|=ct.getUTCSeconds()/2,L=ct.getUTCFullYear()-1980,L<<=4,L|=ct.getUTCMonth()+1,L<<=5,L|=ct.getUTCDate(),$&&(mt=s(1,1)+s(h(B),4)+O,J+="up"+s(mt.length,2)+mt),S&&(ot=s(1,1)+s(h(R),4)+M,J+="uc"+s(ot.length,2)+ot);var K="";return K+=`\n\\0`,K+=s(at,2),K+=q.magic,K+=s(_,2),K+=s(L,2),K+=s(Bt.crc32,4),K+=s(Bt.compressedSize,4),K+=s(Bt.uncompressedSize,4),K+=s(B.length,2),K+=s(J.length,2),{fileRecord:f.LOCAL_FILE_HEADER+K+B+J,dirRecord:f.CENTRAL_FILE_HEADER+s(Y,2)+K+s(R.length,2)+"\\0\\0\\0\\0"+s(P,4)+s(w,4)+B+J+R}}var o=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),f=e("../signature");function d(u,y,g,w){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=g,this.encodeFileName=w,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(u){var y=u.meta.percent||0,g=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:g?(y+100*(g-w-1))/g:100}}))},d.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var y=this.streamFiles&&!u.file.dir;if(y){var g=a(u,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(u){this.accumulate=!1;var y=this.streamFiles&&!u.file.dir,g=a(u,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),y)this.push({data:(function(w){return f.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)})(u),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var u=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var g=this.bytesWritten-u,w=(function(m,x,_,L,T){var q=o.transformTo("string",T(L));return f.CENTRAL_DIRECTORY_END+"\\0\\0\\0\\0"+s(m,2)+s(m,2)+s(x,4)+s(_,4)+s(q.length,2)+q})(this.dirRecords.length,g,u,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(u){this._sources.push(u);var y=this;return u.on("data",function(g){y.processChunk(g)}),u.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),u.on("error",function(g){y.error(g)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(u){var y=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var g=0;g<y.length;g++)try{y[g].error(u)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,y=0;y<u.length;y++)u[y].lock()},i.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,r){var s=e("../compressions"),a=e("./ZipFileWorker");r.generateWorker=function(o,l,c){var h=new a(l.streamFiles,c,l.platform,l.encodeFileName),f=0;try{o.forEach(function(d,u){f++;var y=(function(x,_){var L=x||_,T=s[L];if(!T)throw new Error(L+" is not a valid compression method !");return T})(u.options.compression,l.compression),g=u.options.compressionOptions||l.compressionOptions||{},w=u.dir,m=u.date;u._compressWorker(y,g).withStreamInfo("file",{name:d,dir:w,date:m,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=f}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,r){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(a,o){return new s().loadAsync(a,o)},s.external=e("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,r){var s=e("./utils"),a=e("./external"),o=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function f(d){return new a.Promise(function(u,y){var g=d.decompressed.getContentWorker().pipe(new c);g.on("error",function(w){y(w)}).on("end",function(){g.streamInfo.crc32!==d.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}i.exports=function(d,u){var y=this;return u=s.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?a.Promise.reject(new Error("JSZip can\'t accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,u.optimizedBinaryString,u.base64).then(function(g){var w=new l(u);return w.load(g),w}).then(function(g){var w=[a.Promise.resolve(g)],m=g.files;if(u.checkCRC32)for(var x=0;x<m.length;x++)w.push(f(m[x]));return a.Promise.all(w)}).then(function(g){for(var w=g.shift(),m=w.files,x=0;x<m.length;x++){var _=m[x],L=_.fileNameStr,T=s.resolve(_.fileNameStr);y.file(T,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:u.createFolders}),_.dir||(y.file(T).unsafeOriginalName=L)}return w.zipComment.length&&(y.comment=w.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,r){var s=e("../utils"),a=e("../stream/GenericWorker");function o(l,c){a.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}s.inherits(o,a),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,r){var s=e("readable-stream").Readable;function a(o,l,c){s.call(this,l),this._helper=o;var h=this;o.on("data",function(f,d){h.push(f)||h._helper.pause(),c&&c(d)}).on("error",function(f){h.emit("error",f)}).on("end",function(){h.push(null)})}e("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},i.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,i,r){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error(\'The "data" argument must not be a number\');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,i,r){function s(T,q,U){var B,O=o.getTypeOf(q),X=o.extend(U||{},h);X.date=X.date||new Date,X.compression!==null&&(X.compression=X.compression.toUpperCase()),typeof X.unixPermissions=="string"&&(X.unixPermissions=parseInt(X.unixPermissions,8)),X.unixPermissions&&16384&X.unixPermissions&&(X.dir=!0),X.dosPermissions&&16&X.dosPermissions&&(X.dir=!0),X.dir&&(T=m(T)),X.createFolders&&(B=w(T))&&x.call(this,B,!0);var R=O==="string"&&X.binary===!1&&X.base64===!1;U&&U.binary!==void 0||(X.binary=!R),(q instanceof f&&q.uncompressedSize===0||X.dir||!q||q.length===0)&&(X.base64=!1,X.binary=!0,q="",X.compression="STORE",O="string");var M=null;M=q instanceof f||q instanceof l?q:y.isNode&&y.isStream(q)?new g(T,q):o.prepareContent(T,q,X.binary,X.optimizedBinaryString,X.base64);var $=new d(T,M,X);this.files[T]=$}var a=e("./utf8"),o=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),f=e("./compressedObject"),d=e("./zipObject"),u=e("./generate"),y=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),w=function(T){T.slice(-1)==="/"&&(T=T.substring(0,T.length-1));var q=T.lastIndexOf("/");return 0<q?T.substring(0,q):""},m=function(T){return T.slice(-1)!=="/"&&(T+="/"),T},x=function(T,q){return q=q!==void 0?q:h.createFolders,T=m(T),this.files[T]||s.call(this,T,null,{dir:!0,createFolders:q}),this.files[T]};function _(T){return Object.prototype.toString.call(T)==="[object RegExp]"}var L={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(T){var q,U,B;for(q in this.files)B=this.files[q],(U=q.slice(this.root.length,q.length))&&q.slice(0,this.root.length)===this.root&&T(U,B)},filter:function(T){var q=[];return this.forEach(function(U,B){T(U,B)&&q.push(B)}),q},file:function(T,q,U){if(arguments.length!==1)return T=this.root+T,s.call(this,T,q,U),this;if(_(T)){var B=T;return this.filter(function(X,R){return!R.dir&&B.test(X)})}var O=this.files[this.root+T];return O&&!O.dir?O:null},folder:function(T){if(!T)return this;if(_(T))return this.filter(function(O,X){return X.dir&&T.test(O)});var q=this.root+T,U=x.call(this,q),B=this.clone();return B.root=U.name,B},remove:function(T){T=this.root+T;var q=this.files[T];if(q||(T.slice(-1)!=="/"&&(T+="/"),q=this.files[T]),q&&!q.dir)delete this.files[T];else for(var U=this.filter(function(O,X){return X.name.slice(0,T.length)===T}),B=0;B<U.length;B++)delete this.files[U[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(T){var q,U={};try{if((U=o.extend(T||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=U.type.toLowerCase(),U.compression=U.compression.toUpperCase(),U.type==="binarystring"&&(U.type="string"),!U.type)throw new Error("No output type specified.");o.checkSupport(U.type),U.platform!=="darwin"&&U.platform!=="freebsd"&&U.platform!=="linux"&&U.platform!=="sunos"||(U.platform="UNIX"),U.platform==="win32"&&(U.platform="DOS");var B=U.comment||this.comment||"";q=u.generateWorker(this,U,B)}catch(O){(q=new l("error")).error(O)}return new c(q,U.type||"string",U.mimeType)},generateAsync:function(T,q){return this.generateInternalStream(T).accumulate(q)},generateNodeStream:function(T,q){return(T=T||{}).type||(T.type="nodebuffer"),this.generateInternalStream(T).toNodejsStream(q)}};i.exports=L},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,r){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,r){var s=e("./DataReader");function a(o){s.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),f=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===f)return d-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),f=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&h===d[2]&&f===d[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,i,r){var s=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=a},{"../utils":32}],19:[function(e,i,r){var s=e("./Uint8ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,r){var s=e("./DataReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,i,r){var s=e("./ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,r){var s=e("../utils"),a=e("../support"),o=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");i.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||a.uint8array?d==="nodebuffer"?new c(f):a.uint8array?new h(s.transformTo("uint8array",f)):new o(s.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\\x07\\b"},{}],24:[function(e,i,r){var s=e("./GenericWorker"),a=e("../utils");function o(l){s.call(this,"ConvertWorker to "+l),this.destType=l}a.inherits(o,s),o.prototype.processChunk=function(l){this.push({data:a.transformTo(this.destType,l.data),meta:l.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,r){var s=e("./GenericWorker"),a=e("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,s),o.prototype.processChunk=function(l){this.streamInfo.crc32=a(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,r){var s=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}s.inherits(o,a),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}a.prototype.processChunk.call(this,l)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,r){var s=e("../utils"),a=e("./GenericWorker");function o(l){a.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=s.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}s.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,r){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var l=0;l<this._listeners[a].length;l++)this._listeners[a][l].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream \'"+this+"\' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(l){o.processChunk(l)}),a.on("end",function(){o.end()}),a.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream \'"+this+"\' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},i.exports=s},{}],29:[function(e,i,r){var s=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),f=null;if(c.nodestream)try{f=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(y,g){return new h.Promise(function(w,m){var x=[],_=y._internalType,L=y._outputType,T=y._mimeType;y.on("data",function(q,U){x.push(q),g&&g(U)}).on("error",function(q){x=[],m(q)}).on("end",function(){try{var q=(function(U,B,O){switch(U){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),O);case"base64":return l.encode(B);default:return s.transformTo(U,B)}})(L,(function(U,B){var O,X=0,R=null,M=0;for(O=0;O<B.length;O++)M+=B[O].length;switch(U){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(R=new Uint8Array(M),O=0;O<B.length;O++)R.set(B[O],X),X+=B[O].length;return R;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type \'"+U+"\'")}})(_,x),T);w(q)}catch(U){m(U)}x=[]}).resume()})}function u(y,g,w){var m=g;switch(g){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=g,this._mimeType=w,s.checkSupport(m),this._worker=y.pipe(new a(m)),y.lock()}catch(x){this._worker=new o("error"),this._worker.error(x)}}u.prototype={accumulate:function(y){return d(this,y)},on:function(y,g){var w=this;return y==="data"?this._worker.on(y,function(m){g.call(w,m.data,m.meta)}):this._worker.on(y,function(){s.delay(g,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},y)}},i.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var s=new ArrayBuffer(0);try{r.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,r){for(var s=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}r.utf8encode=function(u){return a.nodebuffer?o.newBufferFrom(u,"utf-8"):(function(y){var g,w,m,x,_,L=y.length,T=0;for(x=0;x<L;x++)(64512&(w=y.charCodeAt(x)))==55296&&x+1<L&&(64512&(m=y.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(m-56320),x++),T+=w<128?1:w<2048?2:w<65536?3:4;for(g=a.uint8array?new Uint8Array(T):new Array(T),x=_=0;_<T;x++)(64512&(w=y.charCodeAt(x)))==55296&&x+1<L&&(64512&(m=y.charCodeAt(x+1)))==56320&&(w=65536+(w-55296<<10)+(m-56320),x++),w<128?g[_++]=w:(w<2048?g[_++]=192|w>>>6:(w<65536?g[_++]=224|w>>>12:(g[_++]=240|w>>>18,g[_++]=128|w>>>12&63),g[_++]=128|w>>>6&63),g[_++]=128|63&w);return g})(u)},r.utf8decode=function(u){return a.nodebuffer?s.transformTo("nodebuffer",u).toString("utf-8"):(function(y){var g,w,m,x,_=y.length,L=new Array(2*_);for(g=w=0;g<_;)if((m=y[g++])<128)L[w++]=m;else if(4<(x=c[m]))L[w++]=65533,g+=x-1;else{for(m&=x===2?31:x===3?15:7;1<x&&g<_;)m=m<<6|63&y[g++],x--;1<x?L[w++]=65533:m<65536?L[w++]=m:(m-=65536,L[w++]=55296|m>>10&1023,L[w++]=56320|1023&m)}return L.length!==w&&(L.subarray?L=L.subarray(0,w):L.length=w),s.applyFromCharCode(L)})(u=s.transformTo(a.uint8array?"uint8array":"array",u))},s.inherits(f,l),f.prototype.processChunk=function(u){var y=s.transformTo(a.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var g=y;(y=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),y.set(g,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var w=(function(x,_){var L;for((_=_||x.length)>x.length&&(_=x.length),L=_-1;0<=L&&(192&x[L])==128;)L--;return L<0||L===0?_:L+c[x[L]]>_?L:_})(y),m=y;w!==y.length&&(a.uint8array?(m=y.subarray(0,w),this.leftOver=y.subarray(w,y.length)):(m=y.slice(0,w),this.leftOver=y.slice(w,y.length))),this.push({data:r.utf8decode(m),meta:u.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=f,s.inherits(d,l),d.prototype.processChunk=function(u){this.push({data:r.utf8encode(u.data),meta:u.meta})},r.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,r){var s=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),l=e("./external");function c(g){return g}function h(g,w){for(var m=0;m<g.length;++m)w[m]=255&g.charCodeAt(m);return w}e("setimmediate"),r.newBlob=function(g,w){r.checkSupport("blob");try{return new Blob([g],{type:w})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(g),m.getBlob(w)}catch{throw new Error("Bug : can\'t construct the Blob.")}}};var f={stringifyByChunk:function(g,w,m){var x=[],_=0,L=g.length;if(L<=m)return String.fromCharCode.apply(null,g);for(;_<L;)w==="array"||w==="nodebuffer"?x.push(String.fromCharCode.apply(null,g.slice(_,Math.min(_+m,L)))):x.push(String.fromCharCode.apply(null,g.subarray(_,Math.min(_+m,L)))),_+=m;return x.join("")},stringifyByChar:function(g){for(var w="",m=0;m<g.length;m++)w+=String.fromCharCode(g[m]);return w},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function d(g){var w=65536,m=r.getTypeOf(g),x=!0;if(m==="uint8array"?x=f.applyCanBeUsed.uint8array:m==="nodebuffer"&&(x=f.applyCanBeUsed.nodebuffer),x)for(;1<w;)try{return f.stringifyByChunk(g,m,w)}catch{w=Math.floor(w/2)}return f.stringifyByChar(g)}function u(g,w){for(var m=0;m<g.length;m++)w[m]=g[m];return w}r.applyFromCharCode=d;var y={};y.string={string:c,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return y.string.uint8array(g).buffer},uint8array:function(g){return h(g,new Uint8Array(g.length))},nodebuffer:function(g){return h(g,o.allocBuffer(g.length))}},y.array={string:d,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},y.arraybuffer={string:function(g){return d(new Uint8Array(g))},array:function(g){return u(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},y.uint8array={string:d,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return o.newBufferFrom(g)}},y.nodebuffer={string:d,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return y.nodebuffer.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:c},r.transformTo=function(g,w){if(w=w||"",!g)return w;r.checkSupport(g);var m=r.getTypeOf(w);return y[m][g](w)},r.resolve=function(g){for(var w=g.split("/"),m=[],x=0;x<w.length;x++){var _=w[x];_==="."||_===""&&x!==0&&x!==w.length-1||(_===".."?m.pop():m.push(_))}return m.join("/")},r.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(g){var w,m,x="";for(m=0;m<(g||"").length;m++)x+="\\\\x"+((w=g.charCodeAt(m))<16?"0":"")+w.toString(16).toUpperCase();return x},r.delay=function(g,w,m){setImmediate(function(){g.apply(m||null,w||[])})},r.inherits=function(g,w){function m(){}m.prototype=w.prototype,g.prototype=new m},r.extend=function(){var g,w,m={};for(g=0;g<arguments.length;g++)for(w in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],w)&&m[w]===void 0&&(m[w]=arguments[g][w]);return m},r.prepareContent=function(g,w,m,x,_){return l.Promise.resolve(w).then(function(L){return s.blob&&(L instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(L))!==-1)&&typeof FileReader<"u"?new l.Promise(function(T,q){var U=new FileReader;U.onload=function(B){T(B.target.result)},U.onerror=function(B){q(B.target.error)},U.readAsArrayBuffer(L)}):L}).then(function(L){var T=r.getTypeOf(L);return T?(T==="arraybuffer"?L=r.transformTo("uint8array",L):T==="string"&&(_?L=a.decode(L):m&&x!==!0&&(L=(function(q){return h(q,s.uint8array?new Uint8Array(q.length):new Array(q.length))})(L))),L):l.Promise.reject(new Error("Can\'t read the data of \'"+g+"\'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,r){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(f){this.files=[],this.loadOptions=f}h.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(d)+", expected "+a.pretty(f)+")")}},isSignature:function(f,d){var u=this.reader.index;this.reader.setIndex(f);var y=this.reader.readString(4)===d;return this.reader.setIndex(u),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",u=a.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,u,y=this.zip64EndOfCentralSize-44;0<y;)f=this.reader.readInt(2),d=this.reader.readInt(4),u=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can\'t find end of central directory"):new Error("Can\'t find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can\'t find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can\'t find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var y=d-u;if(0<y)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,r){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),f=e("./support");function d(u,y){this.options=u,this.loadOptions=y}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var y,g;if(u.skip(22),this.fileNameLength=u.readInt(2),g=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn\'t get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(w){for(var m in h)if(Object.prototype.hasOwnProperty.call(h,m)&&h[m].magic===w)return h[m];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,y,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var y=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(y),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var y,g,w,m=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<m;)y=u.readInt(2),g=u.readInt(2),w=u.readData(g),this.extraFields[y]={id:y,length:g,value:w};u.setIndex(m)},handleUTF8:function(){var u=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var g=a.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var m=a.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var y=s(u.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:c.utf8decode(y.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var y=s(u.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:c.utf8decode(y.readData(u.length-5))}return null}},i.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,r){function s(y,g,w){this.name=y,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=g,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");s.prototype={internalStream:function(y){var g=null,w="string";try{if(!y)throw new Error("No output type specified.");var m=(w=y.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),g=this._decompressWorker();var x=!this._dataBinary;x&&!m&&(g=g.pipe(new l.Utf8EncodeWorker)),!x&&m&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(_){(g=new h("error")).error(_)}return new a(g,w,"")},async:function(y,g){return this.internalStream(y).accumulate(g)},nodeStream:function(y,g){return this.internalStream(y||"nodebuffer").toNodejsStream(g)},_compressWorker:function(y,g){if(this._data instanceof c&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(w,y,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<f.length;u++)s.prototype[f[u]]=d;i.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,r){(function(s){var a,o,l=s.MutationObserver||s.WebKitMutationObserver;if(l){var c=0,h=new l(y),f=s.document.createTextNode("");h.observe(f,{characterData:!0}),a=function(){f.data=c=++c%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){y(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(y,0)};else{var d=new s.MessageChannel;d.port1.onmessage=y,a=function(){d.port2.postMessage(0)}}var u=[];function y(){var g,w;o=!0;for(var m=u.length;m;){for(w=u,u=[],g=-1;++g<m;)w[g]();m=u.length}o=!1}i.exports=function(g){u.push(g)!==1||o||a()}}).call(this,typeof Il<"u"?Il:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,r){var s=e("immediate");function a(){}var o={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function f(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,m!==a&&g(this,m)}function d(m,x,_){this.promise=m,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function u(m,x,_){s(function(){var L;try{L=x(_)}catch(T){return o.reject(m,T)}L===m?o.reject(m,new TypeError("Cannot resolve promise with itself")):o.resolve(m,L)})}function y(m){var x=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof x=="function")return function(){x.apply(m,arguments)}}function g(m,x){var _=!1;function L(U){_||(_=!0,o.reject(m,U))}function T(U){_||(_=!0,o.resolve(m,U))}var q=w(function(){x(T,L)});q.status==="error"&&L(q.value)}function w(m,x){var _={};try{_.value=m(x),_.status="success"}catch(L){_.status="error",_.value=L}return _}(i.exports=f).prototype.finally=function(m){if(typeof m!="function")return this;var x=this.constructor;return this.then(function(_){return x.resolve(m()).then(function(){return _})},function(_){return x.resolve(m()).then(function(){throw _})})},f.prototype.catch=function(m){return this.then(null,m)},f.prototype.then=function(m,x){if(typeof m!="function"&&this.state===c||typeof x!="function"&&this.state===l)return this;var _=new this.constructor(a);return this.state!==h?u(_,this.state===c?m:x,this.outcome):this.queue.push(new d(_,m,x)),_},d.prototype.callFulfilled=function(m){o.resolve(this.promise,m)},d.prototype.otherCallFulfilled=function(m){u(this.promise,this.onFulfilled,m)},d.prototype.callRejected=function(m){o.reject(this.promise,m)},d.prototype.otherCallRejected=function(m){u(this.promise,this.onRejected,m)},o.resolve=function(m,x){var _=w(y,x);if(_.status==="error")return o.reject(m,_.value);var L=_.value;if(L)g(m,L);else{m.state=c,m.outcome=x;for(var T=-1,q=m.queue.length;++T<q;)m.queue[T].callFulfilled(x)}return m},o.reject=function(m,x){m.state=l,m.outcome=x;for(var _=-1,L=m.queue.length;++_<L;)m.queue[_].callRejected(x);return m},f.resolve=function(m){return m instanceof this?m:o.resolve(new this(a),m)},f.reject=function(m){var x=new this(a);return o.reject(x,m)},f.all=function(m){var x=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=m.length,L=!1;if(!_)return this.resolve([]);for(var T=new Array(_),q=0,U=-1,B=new this(a);++U<_;)O(m[U],U);return B;function O(X,R){x.resolve(X).then(function(M){T[R]=M,++q!==_||L||(L=!0,o.resolve(B,T))},function(M){L||(L=!0,o.reject(B,M))})}},f.race=function(m){var x=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=m.length,L=!1;if(!_)return this.resolve([]);for(var T=-1,q=new this(a);++T<_;)U=m[T],x.resolve(U).then(function(B){L||(L=!0,o.resolve(q,B))},function(B){L||(L=!0,o.reject(q,B))});var U;return q}},{immediate:36}],38:[function(e,i,r){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,r){var s=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,f=0,d=-1,u=0,y=8;function g(m){if(!(this instanceof g))return new g(m);this.options=a.assign({level:d,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},m||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(_!==f)throw new Error(l[_]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var L;if(L=typeof x.dictionary=="string"?o.string2buf(x.dictionary):h.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(_=s.deflateSetDictionary(this.strm,L))!==f)throw new Error(l[_]);this._dict_set=!0}}function w(m,x){var _=new g(x);if(_.push(m,!0),_.err)throw _.msg||l[_.err];return _.result}g.prototype.push=function(m,x){var _,L,T=this.strm,q=this.options.chunkSize;if(this.ended)return!1;L=x===~~x?x:x===!0?4:0,typeof m=="string"?T.input=o.string2buf(m):h.call(m)==="[object ArrayBuffer]"?T.input=new Uint8Array(m):T.input=m,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new a.Buf8(q),T.next_out=0,T.avail_out=q),(_=s.deflate(T,L))!==1&&_!==f)return this.onEnd(_),!(this.ended=!0);T.avail_out!==0&&(T.avail_in!==0||L!==4&&L!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(T.output,T.next_out))):this.onData(a.shrinkBuf(T.output,T.next_out)))}while((0<T.avail_in||T.avail_out===0)&&_!==1);return L===4?(_=s.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===f):L!==2||(this.onEnd(f),!(T.avail_out=0))},g.prototype.onData=function(m){this.chunks.push(m)},g.prototype.onEnd=function(m){m===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},r.Deflate=g,r.deflate=w,r.deflateRaw=function(m,x){return(x=x||{}).raw=!0,w(m,x)},r.gzip=function(m,x){return(x=x||{}).gzip=!0,w(m,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,r){var s=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),f=e("./zlib/gzheader"),d=Object.prototype.toString;function u(g){if(!(this instanceof u))return new u(g);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},g||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||g&&g.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var m=s.inflateInit2(this.strm,w.windowBits);if(m!==l.Z_OK)throw new Error(c[m]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function y(g,w){var m=new u(w);if(m.push(g,!0),m.err)throw m.msg||c[m.err];return m.result}u.prototype.push=function(g,w){var m,x,_,L,T,q,U=this.strm,B=this.options.chunkSize,O=this.options.dictionary,X=!1;if(this.ended)return!1;x=w===~~w?w:w===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?U.input=o.binstring2buf(g):d.call(g)==="[object ArrayBuffer]"?U.input=new Uint8Array(g):U.input=g,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new a.Buf8(B),U.next_out=0,U.avail_out=B),(m=s.inflate(U,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&O&&(q=typeof O=="string"?o.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,m=s.inflateSetDictionary(this.strm,q)),m===l.Z_BUF_ERROR&&X===!0&&(m=l.Z_OK,X=!1),m!==l.Z_STREAM_END&&m!==l.Z_OK)return this.onEnd(m),!(this.ended=!0);U.next_out&&(U.avail_out!==0&&m!==l.Z_STREAM_END&&(U.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=o.utf8border(U.output,U.next_out),L=U.next_out-_,T=o.buf2string(U.output,_),U.next_out=L,U.avail_out=B-L,L&&a.arraySet(U.output,U.output,_,L,0),this.onData(T)):this.onData(a.shrinkBuf(U.output,U.next_out)))),U.avail_in===0&&U.avail_out===0&&(X=!0)}while((0<U.avail_in||U.avail_out===0)&&m!==l.Z_STREAM_END);return m===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(m=s.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(U.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},r.Inflate=u,r.inflate=y,r.inflateRaw=function(g,w){return(w=w||{}).raw=!0,y(g,w)},r.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])}}return l},r.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var a={arraySet:function(l,c,h,f,d){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+f),d);else for(var u=0;u<f;u++)l[d+u]=c[h+u]},flattenChunks:function(l){var c,h,f,d,u,y;for(c=f=0,h=l.length;c<h;c++)f+=l[c].length;for(y=new Uint8Array(f),c=d=0,h=l.length;c<h;c++)u=l[c],y.set(u,d),d+=u.length;return y}},o={arraySet:function(l,c,h,f,d){for(var u=0;u<f;u++)l[d+u]=c[h+u]},flattenChunks:function(l){return[].concat.apply([],l)}};r.setTyped=function(l){l?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(s)},{}],42:[function(e,i,r){var s=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new s.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(f,d){if(d<65537&&(f.subarray&&o||!f.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var u="",y=0;y<d;y++)u+=String.fromCharCode(f[y]);return u}l[254]=l[254]=1,r.string2buf=function(f){var d,u,y,g,w,m=f.length,x=0;for(g=0;g<m;g++)(64512&(u=f.charCodeAt(g)))==55296&&g+1<m&&(64512&(y=f.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),g++),x+=u<128?1:u<2048?2:u<65536?3:4;for(d=new s.Buf8(x),g=w=0;w<x;g++)(64512&(u=f.charCodeAt(g)))==55296&&g+1<m&&(64512&(y=f.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),g++),u<128?d[w++]=u:(u<2048?d[w++]=192|u>>>6:(u<65536?d[w++]=224|u>>>12:(d[w++]=240|u>>>18,d[w++]=128|u>>>12&63),d[w++]=128|u>>>6&63),d[w++]=128|63&u);return d},r.buf2binstring=function(f){return h(f,f.length)},r.binstring2buf=function(f){for(var d=new s.Buf8(f.length),u=0,y=d.length;u<y;u++)d[u]=f.charCodeAt(u);return d},r.buf2string=function(f,d){var u,y,g,w,m=d||f.length,x=new Array(2*m);for(u=y=0;u<m;)if((g=f[u++])<128)x[y++]=g;else if(4<(w=l[g]))x[y++]=65533,u+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&u<m;)g=g<<6|63&f[u++],w--;1<w?x[y++]=65533:g<65536?x[y++]=g:(g-=65536,x[y++]=55296|g>>10&1023,x[y++]=56320|1023&g)}return h(x,y)},r.utf8border=function(f,d){var u;for((d=d||f.length)>f.length&&(d=f.length),u=d-1;0<=u&&(192&f[u])==128;)u--;return u<0||u===0?d:u+l[f[u]]>d?u:d}},{"./common":41}],43:[function(e,i,r){i.exports=function(s,a,o,l){for(var c=65535&s|0,h=s>>>16&65535|0,f=0;o!==0;){for(o-=f=2e3<o?2e3:o;h=h+(c=c+a[l++]|0)|0,--f;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,r){var s=(function(){for(var a,o=[],l=0;l<256;l++){a=l;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;o[l]=a}return o})();i.exports=function(a,o,l,c){var h=s,f=c+l;a^=-1;for(var d=c;d<f;d++)a=a>>>8^h[255&(a^o[d])];return-1^a}},{}],46:[function(e,i,r){var s,a=e("../utils/common"),o=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),f=0,d=4,u=0,y=-2,g=-1,w=4,m=2,x=8,_=9,L=286,T=30,q=19,U=2*L+1,B=15,O=3,X=258,R=X+O+1,M=42,$=113,S=1,J=2,mt=3,ot=4;function ft(I,D){return I.msg=h[D],D}function ct(I){return(I<<1)-(4<I?9:0)}function Bt(I){for(var D=I.length;0<=--D;)I[D]=0}function at(I){var D=I.state,pt=D.pending;pt>I.avail_out&&(pt=I.avail_out),pt!==0&&(a.arraySet(I.output,D.pending_buf,D.pending_out,pt,I.next_out),I.next_out+=pt,D.pending_out+=pt,I.total_out+=pt,I.avail_out-=pt,D.pending-=pt,D.pending===0&&(D.pending_out=0))}function P(I,D){o._tr_flush_block(I,0<=I.block_start?I.block_start:-1,I.strstart-I.block_start,D),I.block_start=I.strstart,at(I.strm)}function Y(I,D){I.pending_buf[I.pending++]=D}function K(I,D){I.pending_buf[I.pending++]=D>>>8&255,I.pending_buf[I.pending++]=255&D}function et(I,D){var pt,tt,H=I.max_chain_length,nt=I.strstart,Ct=I.prev_length,It=I.nice_match,dt=I.strstart>I.w_size-R?I.strstart-(I.w_size-R):0,Et=I.window,ee=I.w_mask,Gt=I.prev,re=I.strstart+X,ke=Et[nt+Ct-1],me=Et[nt+Ct];I.prev_length>=I.good_match&&(H>>=2),It>I.lookahead&&(It=I.lookahead);do if(Et[(pt=D)+Ct]===me&&Et[pt+Ct-1]===ke&&Et[pt]===Et[nt]&&Et[++pt]===Et[nt+1]){nt+=2,pt++;do;while(Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&Et[++nt]===Et[++pt]&&nt<re);if(tt=X-(re-nt),nt=re-X,Ct<tt){if(I.match_start=D,It<=(Ct=tt))break;ke=Et[nt+Ct-1],me=Et[nt+Ct]}}while((D=Gt[D&ee])>dt&&--H!=0);return Ct<=I.lookahead?Ct:I.lookahead}function gt(I){var D,pt,tt,H,nt,Ct,It,dt,Et,ee,Gt=I.w_size;do{if(H=I.window_size-I.lookahead-I.strstart,I.strstart>=Gt+(Gt-R)){for(a.arraySet(I.window,I.window,Gt,Gt,0),I.match_start-=Gt,I.strstart-=Gt,I.block_start-=Gt,D=pt=I.hash_size;tt=I.head[--D],I.head[D]=Gt<=tt?tt-Gt:0,--pt;);for(D=pt=Gt;tt=I.prev[--D],I.prev[D]=Gt<=tt?tt-Gt:0,--pt;);H+=Gt}if(I.strm.avail_in===0)break;if(Ct=I.strm,It=I.window,dt=I.strstart+I.lookahead,Et=H,ee=void 0,ee=Ct.avail_in,Et<ee&&(ee=Et),pt=ee===0?0:(Ct.avail_in-=ee,a.arraySet(It,Ct.input,Ct.next_in,ee,dt),Ct.state.wrap===1?Ct.adler=l(Ct.adler,It,ee,dt):Ct.state.wrap===2&&(Ct.adler=c(Ct.adler,It,ee,dt)),Ct.next_in+=ee,Ct.total_in+=ee,ee),I.lookahead+=pt,I.lookahead+I.insert>=O)for(nt=I.strstart-I.insert,I.ins_h=I.window[nt],I.ins_h=(I.ins_h<<I.hash_shift^I.window[nt+1])&I.hash_mask;I.insert&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[nt+O-1])&I.hash_mask,I.prev[nt&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=nt,nt++,I.insert--,!(I.lookahead+I.insert<O)););}while(I.lookahead<R&&I.strm.avail_in!==0)}function kt(I,D){for(var pt,tt;;){if(I.lookahead<R){if(gt(I),I.lookahead<R&&D===f)return S;if(I.lookahead===0)break}if(pt=0,I.lookahead>=O&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+O-1])&I.hash_mask,pt=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),pt!==0&&I.strstart-pt<=I.w_size-R&&(I.match_length=et(I,pt)),I.match_length>=O)if(tt=o._tr_tally(I,I.strstart-I.match_start,I.match_length-O),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=O){for(I.match_length--;I.strstart++,I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+O-1])&I.hash_mask,pt=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart,--I.match_length!=0;);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+1])&I.hash_mask;else tt=o._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(tt&&(P(I,!1),I.strm.avail_out===0))return S}return I.insert=I.strstart<O-1?I.strstart:O-1,D===d?(P(I,!0),I.strm.avail_out===0?mt:ot):I.last_lit&&(P(I,!1),I.strm.avail_out===0)?S:J}function _t(I,D){for(var pt,tt,H;;){if(I.lookahead<R){if(gt(I),I.lookahead<R&&D===f)return S;if(I.lookahead===0)break}if(pt=0,I.lookahead>=O&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+O-1])&I.hash_mask,pt=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=O-1,pt!==0&&I.prev_length<I.max_lazy_match&&I.strstart-pt<=I.w_size-R&&(I.match_length=et(I,pt),I.match_length<=5&&(I.strategy===1||I.match_length===O&&4096<I.strstart-I.match_start)&&(I.match_length=O-1)),I.prev_length>=O&&I.match_length<=I.prev_length){for(H=I.strstart+I.lookahead-O,tt=o._tr_tally(I,I.strstart-1-I.prev_match,I.prev_length-O),I.lookahead-=I.prev_length-1,I.prev_length-=2;++I.strstart<=H&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+O-1])&I.hash_mask,pt=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),--I.prev_length!=0;);if(I.match_available=0,I.match_length=O-1,I.strstart++,tt&&(P(I,!1),I.strm.avail_out===0))return S}else if(I.match_available){if((tt=o._tr_tally(I,0,I.window[I.strstart-1]))&&P(I,!1),I.strstart++,I.lookahead--,I.strm.avail_out===0)return S}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(tt=o._tr_tally(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<O-1?I.strstart:O-1,D===d?(P(I,!0),I.strm.avail_out===0?mt:ot):I.last_lit&&(P(I,!1),I.strm.avail_out===0)?S:J}function Pt(I,D,pt,tt,H){this.good_length=I,this.max_lazy=D,this.nice_length=pt,this.max_chain=tt,this.func=H}function jt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*U),this.dyn_dtree=new a.Buf16(2*(2*T+1)),this.bl_tree=new a.Buf16(2*(2*q+1)),Bt(this.dyn_ltree),Bt(this.dyn_dtree),Bt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(B+1),this.heap=new a.Buf16(2*L+1),Bt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*L+1),Bt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(I){var D;return I&&I.state?(I.total_in=I.total_out=0,I.data_type=m,(D=I.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?M:$,I.adler=D.wrap===2?0:1,D.last_flush=f,o._tr_init(D),u):ft(I,y)}function pe(I){var D=Zt(I);return D===u&&(function(pt){pt.window_size=2*pt.w_size,Bt(pt.head),pt.max_lazy_match=s[pt.level].max_lazy,pt.good_match=s[pt.level].good_length,pt.nice_match=s[pt.level].nice_length,pt.max_chain_length=s[pt.level].max_chain,pt.strstart=0,pt.block_start=0,pt.lookahead=0,pt.insert=0,pt.match_length=pt.prev_length=O-1,pt.match_available=0,pt.ins_h=0})(I.state),D}function he(I,D,pt,tt,H,nt){if(!I)return y;var Ct=1;if(D===g&&(D=6),tt<0?(Ct=0,tt=-tt):15<tt&&(Ct=2,tt-=16),H<1||_<H||pt!==x||tt<8||15<tt||D<0||9<D||nt<0||w<nt)return ft(I,y);tt===8&&(tt=9);var It=new jt;return(I.state=It).strm=I,It.wrap=Ct,It.gzhead=null,It.w_bits=tt,It.w_size=1<<It.w_bits,It.w_mask=It.w_size-1,It.hash_bits=H+7,It.hash_size=1<<It.hash_bits,It.hash_mask=It.hash_size-1,It.hash_shift=~~((It.hash_bits+O-1)/O),It.window=new a.Buf8(2*It.w_size),It.head=new a.Buf16(It.hash_size),It.prev=new a.Buf16(It.w_size),It.lit_bufsize=1<<H+6,It.pending_buf_size=4*It.lit_bufsize,It.pending_buf=new a.Buf8(It.pending_buf_size),It.d_buf=1*It.lit_bufsize,It.l_buf=3*It.lit_bufsize,It.level=D,It.strategy=nt,It.method=pt,pe(I)}s=[new Pt(0,0,0,0,function(I,D){var pt=65535;for(pt>I.pending_buf_size-5&&(pt=I.pending_buf_size-5);;){if(I.lookahead<=1){if(gt(I),I.lookahead===0&&D===f)return S;if(I.lookahead===0)break}I.strstart+=I.lookahead,I.lookahead=0;var tt=I.block_start+pt;if((I.strstart===0||I.strstart>=tt)&&(I.lookahead=I.strstart-tt,I.strstart=tt,P(I,!1),I.strm.avail_out===0)||I.strstart-I.block_start>=I.w_size-R&&(P(I,!1),I.strm.avail_out===0))return S}return I.insert=0,D===d?(P(I,!0),I.strm.avail_out===0?mt:ot):(I.strstart>I.block_start&&(P(I,!1),I.strm.avail_out),S)}),new Pt(4,4,8,4,kt),new Pt(4,5,16,8,kt),new Pt(4,6,32,32,kt),new Pt(4,4,16,16,_t),new Pt(8,16,32,32,_t),new Pt(8,16,128,128,_t),new Pt(8,32,128,256,_t),new Pt(32,128,258,1024,_t),new Pt(32,258,258,4096,_t)],r.deflateInit=function(I,D){return he(I,D,x,15,8,0)},r.deflateInit2=he,r.deflateReset=pe,r.deflateResetKeep=Zt,r.deflateSetHeader=function(I,D){return I&&I.state?I.state.wrap!==2?y:(I.state.gzhead=D,u):y},r.deflate=function(I,D){var pt,tt,H,nt;if(!I||!I.state||5<D||D<0)return I?ft(I,y):y;if(tt=I.state,!I.output||!I.input&&I.avail_in!==0||tt.status===666&&D!==d)return ft(I,I.avail_out===0?-5:y);if(tt.strm=I,pt=tt.last_flush,tt.last_flush=D,tt.status===M)if(tt.wrap===2)I.adler=0,Y(tt,31),Y(tt,139),Y(tt,8),tt.gzhead?(Y(tt,(tt.gzhead.text?1:0)+(tt.gzhead.hcrc?2:0)+(tt.gzhead.extra?4:0)+(tt.gzhead.name?8:0)+(tt.gzhead.comment?16:0)),Y(tt,255&tt.gzhead.time),Y(tt,tt.gzhead.time>>8&255),Y(tt,tt.gzhead.time>>16&255),Y(tt,tt.gzhead.time>>24&255),Y(tt,tt.level===9?2:2<=tt.strategy||tt.level<2?4:0),Y(tt,255&tt.gzhead.os),tt.gzhead.extra&&tt.gzhead.extra.length&&(Y(tt,255&tt.gzhead.extra.length),Y(tt,tt.gzhead.extra.length>>8&255)),tt.gzhead.hcrc&&(I.adler=c(I.adler,tt.pending_buf,tt.pending,0)),tt.gzindex=0,tt.status=69):(Y(tt,0),Y(tt,0),Y(tt,0),Y(tt,0),Y(tt,0),Y(tt,tt.level===9?2:2<=tt.strategy||tt.level<2?4:0),Y(tt,3),tt.status=$);else{var Ct=x+(tt.w_bits-8<<4)<<8;Ct|=(2<=tt.strategy||tt.level<2?0:tt.level<6?1:tt.level===6?2:3)<<6,tt.strstart!==0&&(Ct|=32),Ct+=31-Ct%31,tt.status=$,K(tt,Ct),tt.strstart!==0&&(K(tt,I.adler>>>16),K(tt,65535&I.adler)),I.adler=1}if(tt.status===69)if(tt.gzhead.extra){for(H=tt.pending;tt.gzindex<(65535&tt.gzhead.extra.length)&&(tt.pending!==tt.pending_buf_size||(tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),at(I),H=tt.pending,tt.pending!==tt.pending_buf_size));)Y(tt,255&tt.gzhead.extra[tt.gzindex]),tt.gzindex++;tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),tt.gzindex===tt.gzhead.extra.length&&(tt.gzindex=0,tt.status=73)}else tt.status=73;if(tt.status===73)if(tt.gzhead.name){H=tt.pending;do{if(tt.pending===tt.pending_buf_size&&(tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),at(I),H=tt.pending,tt.pending===tt.pending_buf_size)){nt=1;break}nt=tt.gzindex<tt.gzhead.name.length?255&tt.gzhead.name.charCodeAt(tt.gzindex++):0,Y(tt,nt)}while(nt!==0);tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),nt===0&&(tt.gzindex=0,tt.status=91)}else tt.status=91;if(tt.status===91)if(tt.gzhead.comment){H=tt.pending;do{if(tt.pending===tt.pending_buf_size&&(tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),at(I),H=tt.pending,tt.pending===tt.pending_buf_size)){nt=1;break}nt=tt.gzindex<tt.gzhead.comment.length?255&tt.gzhead.comment.charCodeAt(tt.gzindex++):0,Y(tt,nt)}while(nt!==0);tt.gzhead.hcrc&&tt.pending>H&&(I.adler=c(I.adler,tt.pending_buf,tt.pending-H,H)),nt===0&&(tt.status=103)}else tt.status=103;if(tt.status===103&&(tt.gzhead.hcrc?(tt.pending+2>tt.pending_buf_size&&at(I),tt.pending+2<=tt.pending_buf_size&&(Y(tt,255&I.adler),Y(tt,I.adler>>8&255),I.adler=0,tt.status=$)):tt.status=$),tt.pending!==0){if(at(I),I.avail_out===0)return tt.last_flush=-1,u}else if(I.avail_in===0&&ct(D)<=ct(pt)&&D!==d)return ft(I,-5);if(tt.status===666&&I.avail_in!==0)return ft(I,-5);if(I.avail_in!==0||tt.lookahead!==0||D!==f&&tt.status!==666){var It=tt.strategy===2?(function(dt,Et){for(var ee;;){if(dt.lookahead===0&&(gt(dt),dt.lookahead===0)){if(Et===f)return S;break}if(dt.match_length=0,ee=o._tr_tally(dt,0,dt.window[dt.strstart]),dt.lookahead--,dt.strstart++,ee&&(P(dt,!1),dt.strm.avail_out===0))return S}return dt.insert=0,Et===d?(P(dt,!0),dt.strm.avail_out===0?mt:ot):dt.last_lit&&(P(dt,!1),dt.strm.avail_out===0)?S:J})(tt,D):tt.strategy===3?(function(dt,Et){for(var ee,Gt,re,ke,me=dt.window;;){if(dt.lookahead<=X){if(gt(dt),dt.lookahead<=X&&Et===f)return S;if(dt.lookahead===0)break}if(dt.match_length=0,dt.lookahead>=O&&0<dt.strstart&&(Gt=me[re=dt.strstart-1])===me[++re]&&Gt===me[++re]&&Gt===me[++re]){ke=dt.strstart+X;do;while(Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&Gt===me[++re]&&re<ke);dt.match_length=X-(ke-re),dt.match_length>dt.lookahead&&(dt.match_length=dt.lookahead)}if(dt.match_length>=O?(ee=o._tr_tally(dt,1,dt.match_length-O),dt.lookahead-=dt.match_length,dt.strstart+=dt.match_length,dt.match_length=0):(ee=o._tr_tally(dt,0,dt.window[dt.strstart]),dt.lookahead--,dt.strstart++),ee&&(P(dt,!1),dt.strm.avail_out===0))return S}return dt.insert=0,Et===d?(P(dt,!0),dt.strm.avail_out===0?mt:ot):dt.last_lit&&(P(dt,!1),dt.strm.avail_out===0)?S:J})(tt,D):s[tt.level].func(tt,D);if(It!==mt&&It!==ot||(tt.status=666),It===S||It===mt)return I.avail_out===0&&(tt.last_flush=-1),u;if(It===J&&(D===1?o._tr_align(tt):D!==5&&(o._tr_stored_block(tt,0,0,!1),D===3&&(Bt(tt.head),tt.lookahead===0&&(tt.strstart=0,tt.block_start=0,tt.insert=0))),at(I),I.avail_out===0))return tt.last_flush=-1,u}return D!==d?u:tt.wrap<=0?1:(tt.wrap===2?(Y(tt,255&I.adler),Y(tt,I.adler>>8&255),Y(tt,I.adler>>16&255),Y(tt,I.adler>>24&255),Y(tt,255&I.total_in),Y(tt,I.total_in>>8&255),Y(tt,I.total_in>>16&255),Y(tt,I.total_in>>24&255)):(K(tt,I.adler>>>16),K(tt,65535&I.adler)),at(I),0<tt.wrap&&(tt.wrap=-tt.wrap),tt.pending!==0?u:1)},r.deflateEnd=function(I){var D;return I&&I.state?(D=I.state.status)!==M&&D!==69&&D!==73&&D!==91&&D!==103&&D!==$&&D!==666?ft(I,y):(I.state=null,D===$?ft(I,-3):u):y},r.deflateSetDictionary=function(I,D){var pt,tt,H,nt,Ct,It,dt,Et,ee=D.length;if(!I||!I.state||(nt=(pt=I.state).wrap)===2||nt===1&&pt.status!==M||pt.lookahead)return y;for(nt===1&&(I.adler=l(I.adler,D,ee,0)),pt.wrap=0,ee>=pt.w_size&&(nt===0&&(Bt(pt.head),pt.strstart=0,pt.block_start=0,pt.insert=0),Et=new a.Buf8(pt.w_size),a.arraySet(Et,D,ee-pt.w_size,pt.w_size,0),D=Et,ee=pt.w_size),Ct=I.avail_in,It=I.next_in,dt=I.input,I.avail_in=ee,I.next_in=0,I.input=D,gt(pt);pt.lookahead>=O;){for(tt=pt.strstart,H=pt.lookahead-(O-1);pt.ins_h=(pt.ins_h<<pt.hash_shift^pt.window[tt+O-1])&pt.hash_mask,pt.prev[tt&pt.w_mask]=pt.head[pt.ins_h],pt.head[pt.ins_h]=tt,tt++,--H;);pt.strstart=tt,pt.lookahead=O-1,gt(pt)}return pt.strstart+=pt.lookahead,pt.block_start=pt.strstart,pt.insert=pt.lookahead,pt.lookahead=0,pt.match_length=pt.prev_length=O-1,pt.match_available=0,I.next_in=It,I.input=dt,I.avail_in=Ct,pt.wrap=nt,u},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,r){i.exports=function(s,a){var o,l,c,h,f,d,u,y,g,w,m,x,_,L,T,q,U,B,O,X,R,M,$,S,J;o=s.state,l=s.next_in,S=s.input,c=l+(s.avail_in-5),h=s.next_out,J=s.output,f=h-(a-s.avail_out),d=h+(s.avail_out-257),u=o.dmax,y=o.wsize,g=o.whave,w=o.wnext,m=o.window,x=o.hold,_=o.bits,L=o.lencode,T=o.distcode,q=(1<<o.lenbits)-1,U=(1<<o.distbits)-1;t:do{_<15&&(x+=S[l++]<<_,_+=8,x+=S[l++]<<_,_+=8),B=L[x&q];e:for(;;){if(x>>>=O=B>>>24,_-=O,(O=B>>>16&255)===0)J[h++]=65535&B;else{if(!(16&O)){if((64&O)==0){B=L[(65535&B)+(x&(1<<O)-1)];continue e}if(32&O){o.mode=12;break t}s.msg="invalid literal/length code",o.mode=30;break t}X=65535&B,(O&=15)&&(_<O&&(x+=S[l++]<<_,_+=8),X+=x&(1<<O)-1,x>>>=O,_-=O),_<15&&(x+=S[l++]<<_,_+=8,x+=S[l++]<<_,_+=8),B=T[x&U];n:for(;;){if(x>>>=O=B>>>24,_-=O,!(16&(O=B>>>16&255))){if((64&O)==0){B=T[(65535&B)+(x&(1<<O)-1)];continue n}s.msg="invalid distance code",o.mode=30;break t}if(R=65535&B,_<(O&=15)&&(x+=S[l++]<<_,(_+=8)<O&&(x+=S[l++]<<_,_+=8)),u<(R+=x&(1<<O)-1)){s.msg="invalid distance too far back",o.mode=30;break t}if(x>>>=O,_-=O,(O=h-f)<R){if(g<(O=R-O)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break t}if($=m,(M=0)===w){if(M+=y-O,O<X){for(X-=O;J[h++]=m[M++],--O;);M=h-R,$=J}}else if(w<O){if(M+=y+w-O,(O-=w)<X){for(X-=O;J[h++]=m[M++],--O;);if(M=0,w<X){for(X-=O=w;J[h++]=m[M++],--O;);M=h-R,$=J}}}else if(M+=w-O,O<X){for(X-=O;J[h++]=m[M++],--O;);M=h-R,$=J}for(;2<X;)J[h++]=$[M++],J[h++]=$[M++],J[h++]=$[M++],X-=3;X&&(J[h++]=$[M++],1<X&&(J[h++]=$[M++]))}else{for(M=h-R;J[h++]=J[M++],J[h++]=J[M++],J[h++]=J[M++],2<(X-=3););X&&(J[h++]=J[M++],1<X&&(J[h++]=J[M++]))}break}}break}}while(l<c&&h<d);l-=X=_>>3,x&=(1<<(_-=X<<3))-1,s.next_in=l,s.next_out=h,s.avail_in=l<c?c-l+5:5-(l-c),s.avail_out=h<d?d-h+257:257-(h-d),o.hold=x,o.bits=_}},{}],49:[function(e,i,r){var s=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,f=2,d=0,u=-2,y=1,g=852,w=592;function m(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(M){var $;return M&&M.state?($=M.state,M.total_in=M.total_out=$.total=0,M.msg="",$.wrap&&(M.adler=1&$.wrap),$.mode=y,$.last=0,$.havedict=0,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new s.Buf32(g),$.distcode=$.distdyn=new s.Buf32(w),$.sane=1,$.back=-1,d):u}function L(M){var $;return M&&M.state?(($=M.state).wsize=0,$.whave=0,$.wnext=0,_(M)):u}function T(M,$){var S,J;return M&&M.state?(J=M.state,$<0?(S=0,$=-$):(S=1+($>>4),$<48&&($&=15)),$&&($<8||15<$)?u:(J.window!==null&&J.wbits!==$&&(J.window=null),J.wrap=S,J.wbits=$,L(M))):u}function q(M,$){var S,J;return M?(J=new x,(M.state=J).window=null,(S=T(M,$))!==d&&(M.state=null),S):u}var U,B,O=!0;function X(M){if(O){var $;for(U=new s.Buf32(512),B=new s.Buf32(32),$=0;$<144;)M.lens[$++]=8;for(;$<256;)M.lens[$++]=9;for(;$<280;)M.lens[$++]=7;for(;$<288;)M.lens[$++]=8;for(c(h,M.lens,0,288,U,0,M.work,{bits:9}),$=0;$<32;)M.lens[$++]=5;c(f,M.lens,0,32,B,0,M.work,{bits:5}),O=!1}M.lencode=U,M.lenbits=9,M.distcode=B,M.distbits=5}function R(M,$,S,J){var mt,ot=M.state;return ot.window===null&&(ot.wsize=1<<ot.wbits,ot.wnext=0,ot.whave=0,ot.window=new s.Buf8(ot.wsize)),J>=ot.wsize?(s.arraySet(ot.window,$,S-ot.wsize,ot.wsize,0),ot.wnext=0,ot.whave=ot.wsize):(J<(mt=ot.wsize-ot.wnext)&&(mt=J),s.arraySet(ot.window,$,S-J,mt,ot.wnext),(J-=mt)?(s.arraySet(ot.window,$,S-J,J,0),ot.wnext=J,ot.whave=ot.wsize):(ot.wnext+=mt,ot.wnext===ot.wsize&&(ot.wnext=0),ot.whave<ot.wsize&&(ot.whave+=mt))),0}r.inflateReset=L,r.inflateReset2=T,r.inflateResetKeep=_,r.inflateInit=function(M){return q(M,15)},r.inflateInit2=q,r.inflate=function(M,$){var S,J,mt,ot,ft,ct,Bt,at,P,Y,K,et,gt,kt,_t,Pt,jt,Zt,pe,he,I,D,pt,tt,H=0,nt=new s.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return u;(S=M.state).mode===12&&(S.mode=13),ft=M.next_out,mt=M.output,Bt=M.avail_out,ot=M.next_in,J=M.input,ct=M.avail_in,at=S.hold,P=S.bits,Y=ct,K=Bt,D=d;t:for(;;)switch(S.mode){case y:if(S.wrap===0){S.mode=13;break}for(;P<16;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(2&S.wrap&&at===35615){nt[S.check=0]=255&at,nt[1]=at>>>8&255,S.check=o(S.check,nt,2,0),P=at=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&at)<<8)+(at>>8))%31){M.msg="incorrect header check",S.mode=30;break}if((15&at)!=8){M.msg="unknown compression method",S.mode=30;break}if(P-=4,I=8+(15&(at>>>=4)),S.wbits===0)S.wbits=I;else if(I>S.wbits){M.msg="invalid window size",S.mode=30;break}S.dmax=1<<I,M.adler=S.check=1,S.mode=512&at?10:12,P=at=0;break;case 2:for(;P<16;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(S.flags=at,(255&S.flags)!=8){M.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){M.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=at>>8&1),512&S.flags&&(nt[0]=255&at,nt[1]=at>>>8&255,S.check=o(S.check,nt,2,0)),P=at=0,S.mode=3;case 3:for(;P<32;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.head&&(S.head.time=at),512&S.flags&&(nt[0]=255&at,nt[1]=at>>>8&255,nt[2]=at>>>16&255,nt[3]=at>>>24&255,S.check=o(S.check,nt,4,0)),P=at=0,S.mode=4;case 4:for(;P<16;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.head&&(S.head.xflags=255&at,S.head.os=at>>8),512&S.flags&&(nt[0]=255&at,nt[1]=at>>>8&255,S.check=o(S.check,nt,2,0)),P=at=0,S.mode=5;case 5:if(1024&S.flags){for(;P<16;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.length=at,S.head&&(S.head.extra_len=at),512&S.flags&&(nt[0]=255&at,nt[1]=at>>>8&255,S.check=o(S.check,nt,2,0)),P=at=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(ct<(et=S.length)&&(et=ct),et&&(S.head&&(I=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),s.arraySet(S.head.extra,J,ot,et,I)),512&S.flags&&(S.check=o(S.check,J,et,ot)),ct-=et,ot+=et,S.length-=et),S.length))break t;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(ct===0)break t;for(et=0;I=J[ot+et++],S.head&&I&&S.length<65536&&(S.head.name+=String.fromCharCode(I)),I&&et<ct;);if(512&S.flags&&(S.check=o(S.check,J,et,ot)),ct-=et,ot+=et,I)break t}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(ct===0)break t;for(et=0;I=J[ot+et++],S.head&&I&&S.length<65536&&(S.head.comment+=String.fromCharCode(I)),I&&et<ct;);if(512&S.flags&&(S.check=o(S.check,J,et,ot)),ct-=et,ot+=et,I)break t}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;P<16;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(at!==(65535&S.check)){M.msg="header crc mismatch",S.mode=30;break}P=at=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),M.adler=S.check=0,S.mode=12;break;case 10:for(;P<32;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}M.adler=S.check=m(at),P=at=0,S.mode=11;case 11:if(S.havedict===0)return M.next_out=ft,M.avail_out=Bt,M.next_in=ot,M.avail_in=ct,S.hold=at,S.bits=P,2;M.adler=S.check=1,S.mode=12;case 12:if($===5||$===6)break t;case 13:if(S.last){at>>>=7&P,P-=7&P,S.mode=27;break}for(;P<3;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}switch(S.last=1&at,P-=1,3&(at>>>=1)){case 0:S.mode=14;break;case 1:if(X(S),S.mode=20,$!==6)break;at>>>=2,P-=2;break t;case 2:S.mode=17;break;case 3:M.msg="invalid block type",S.mode=30}at>>>=2,P-=2;break;case 14:for(at>>>=7&P,P-=7&P;P<32;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if((65535&at)!=(at>>>16^65535)){M.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&at,P=at=0,S.mode=15,$===6)break t;case 15:S.mode=16;case 16:if(et=S.length){if(ct<et&&(et=ct),Bt<et&&(et=Bt),et===0)break t;s.arraySet(mt,J,ot,et,ft),ct-=et,ot+=et,Bt-=et,ft+=et,S.length-=et;break}S.mode=12;break;case 17:for(;P<14;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(S.nlen=257+(31&at),at>>>=5,P-=5,S.ndist=1+(31&at),at>>>=5,P-=5,S.ncode=4+(15&at),at>>>=4,P-=4,286<S.nlen||30<S.ndist){M.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;P<3;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.lens[Ct[S.have++]]=7&at,at>>>=3,P-=3}for(;S.have<19;)S.lens[Ct[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,pt={bits:S.lenbits},D=c(0,S.lens,0,19,S.lencode,0,S.work,pt),S.lenbits=pt.bits,D){M.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;Pt=(H=S.lencode[at&(1<<S.lenbits)-1])>>>16&255,jt=65535&H,!((_t=H>>>24)<=P);){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(jt<16)at>>>=_t,P-=_t,S.lens[S.have++]=jt;else{if(jt===16){for(tt=_t+2;P<tt;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(at>>>=_t,P-=_t,S.have===0){M.msg="invalid bit length repeat",S.mode=30;break}I=S.lens[S.have-1],et=3+(3&at),at>>>=2,P-=2}else if(jt===17){for(tt=_t+3;P<tt;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}P-=_t,I=0,et=3+(7&(at>>>=_t)),at>>>=3,P-=3}else{for(tt=_t+7;P<tt;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}P-=_t,I=0,et=11+(127&(at>>>=_t)),at>>>=7,P-=7}if(S.have+et>S.nlen+S.ndist){M.msg="invalid bit length repeat",S.mode=30;break}for(;et--;)S.lens[S.have++]=I}}if(S.mode===30)break;if(S.lens[256]===0){M.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,pt={bits:S.lenbits},D=c(h,S.lens,0,S.nlen,S.lencode,0,S.work,pt),S.lenbits=pt.bits,D){M.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,pt={bits:S.distbits},D=c(f,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,pt),S.distbits=pt.bits,D){M.msg="invalid distances set",S.mode=30;break}if(S.mode=20,$===6)break t;case 20:S.mode=21;case 21:if(6<=ct&&258<=Bt){M.next_out=ft,M.avail_out=Bt,M.next_in=ot,M.avail_in=ct,S.hold=at,S.bits=P,l(M,K),ft=M.next_out,mt=M.output,Bt=M.avail_out,ot=M.next_in,J=M.input,ct=M.avail_in,at=S.hold,P=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;Pt=(H=S.lencode[at&(1<<S.lenbits)-1])>>>16&255,jt=65535&H,!((_t=H>>>24)<=P);){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(Pt&&(240&Pt)==0){for(Zt=_t,pe=Pt,he=jt;Pt=(H=S.lencode[he+((at&(1<<Zt+pe)-1)>>Zt)])>>>16&255,jt=65535&H,!(Zt+(_t=H>>>24)<=P);){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}at>>>=Zt,P-=Zt,S.back+=Zt}if(at>>>=_t,P-=_t,S.back+=_t,S.length=jt,Pt===0){S.mode=26;break}if(32&Pt){S.back=-1,S.mode=12;break}if(64&Pt){M.msg="invalid literal/length code",S.mode=30;break}S.extra=15&Pt,S.mode=22;case 22:if(S.extra){for(tt=S.extra;P<tt;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.length+=at&(1<<S.extra)-1,at>>>=S.extra,P-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;Pt=(H=S.distcode[at&(1<<S.distbits)-1])>>>16&255,jt=65535&H,!((_t=H>>>24)<=P);){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if((240&Pt)==0){for(Zt=_t,pe=Pt,he=jt;Pt=(H=S.distcode[he+((at&(1<<Zt+pe)-1)>>Zt)])>>>16&255,jt=65535&H,!(Zt+(_t=H>>>24)<=P);){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}at>>>=Zt,P-=Zt,S.back+=Zt}if(at>>>=_t,P-=_t,S.back+=_t,64&Pt){M.msg="invalid distance code",S.mode=30;break}S.offset=jt,S.extra=15&Pt,S.mode=24;case 24:if(S.extra){for(tt=S.extra;P<tt;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}S.offset+=at&(1<<S.extra)-1,at>>>=S.extra,P-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){M.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(Bt===0)break t;if(et=K-Bt,S.offset>et){if((et=S.offset-et)>S.whave&&S.sane){M.msg="invalid distance too far back",S.mode=30;break}gt=et>S.wnext?(et-=S.wnext,S.wsize-et):S.wnext-et,et>S.length&&(et=S.length),kt=S.window}else kt=mt,gt=ft-S.offset,et=S.length;for(Bt<et&&(et=Bt),Bt-=et,S.length-=et;mt[ft++]=kt[gt++],--et;);S.length===0&&(S.mode=21);break;case 26:if(Bt===0)break t;mt[ft++]=S.length,Bt--,S.mode=21;break;case 27:if(S.wrap){for(;P<32;){if(ct===0)break t;ct--,at|=J[ot++]<<P,P+=8}if(K-=Bt,M.total_out+=K,S.total+=K,K&&(M.adler=S.check=S.flags?o(S.check,mt,K,ft-K):a(S.check,mt,K,ft-K)),K=Bt,(S.flags?at:m(at))!==S.check){M.msg="incorrect data check",S.mode=30;break}P=at=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;P<32;){if(ct===0)break t;ct--,at+=J[ot++]<<P,P+=8}if(at!==(4294967295&S.total)){M.msg="incorrect length check",S.mode=30;break}P=at=0}S.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;default:return u}return M.next_out=ft,M.avail_out=Bt,M.next_in=ot,M.avail_in=ct,S.hold=at,S.bits=P,(S.wsize||K!==M.avail_out&&S.mode<30&&(S.mode<27||$!==4))&&R(M,M.output,M.next_out,K-M.avail_out)?(S.mode=31,-4):(Y-=M.avail_in,K-=M.avail_out,M.total_in+=Y,M.total_out+=K,S.total+=K,S.wrap&&K&&(M.adler=S.check=S.flags?o(S.check,mt,K,M.next_out-K):a(S.check,mt,K,M.next_out-K)),M.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(Y==0&&K===0||$===4)&&D===d&&(D=-5),D)},r.inflateEnd=function(M){if(!M||!M.state)return u;var $=M.state;return $.window&&($.window=null),M.state=null,d},r.inflateGetHeader=function(M,$){var S;return M&&M.state?(2&(S=M.state).wrap)==0?u:((S.head=$).done=!1,d):u},r.inflateSetDictionary=function(M,$){var S,J=$.length;return M&&M.state?(S=M.state).wrap!==0&&S.mode!==11?u:S.mode===11&&a(1,$,J,0)!==S.check?-3:R(M,$,J,J)?(S.mode=31,-4):(S.havedict=1,d):u},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,r){var s=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(h,f,d,u,y,g,w,m){var x,_,L,T,q,U,B,O,X,R=m.bits,M=0,$=0,S=0,J=0,mt=0,ot=0,ft=0,ct=0,Bt=0,at=0,P=null,Y=0,K=new s.Buf16(16),et=new s.Buf16(16),gt=null,kt=0;for(M=0;M<=15;M++)K[M]=0;for($=0;$<u;$++)K[f[d+$]]++;for(mt=R,J=15;1<=J&&K[J]===0;J--);if(J<mt&&(mt=J),J===0)return y[g++]=20971520,y[g++]=20971520,m.bits=1,0;for(S=1;S<J&&K[S]===0;S++);for(mt<S&&(mt=S),M=ct=1;M<=15;M++)if(ct<<=1,(ct-=K[M])<0)return-1;if(0<ct&&(h===0||J!==1))return-1;for(et[1]=0,M=1;M<15;M++)et[M+1]=et[M]+K[M];for($=0;$<u;$++)f[d+$]!==0&&(w[et[f[d+$]]++]=$);if(U=h===0?(P=gt=w,19):h===1?(P=a,Y-=257,gt=o,kt-=257,256):(P=l,gt=c,-1),M=S,q=g,ft=$=at=0,L=-1,T=(Bt=1<<(ot=mt))-1,h===1&&852<Bt||h===2&&592<Bt)return 1;for(;;){for(B=M-ft,X=w[$]<U?(O=0,w[$]):w[$]>U?(O=gt[kt+w[$]],P[Y+w[$]]):(O=96,0),x=1<<M-ft,S=_=1<<ot;y[q+(at>>ft)+(_-=x)]=B<<24|O<<16|X|0,_!==0;);for(x=1<<M-1;at&x;)x>>=1;if(x!==0?(at&=x-1,at+=x):at=0,$++,--K[M]==0){if(M===J)break;M=f[d+w[$]]}if(mt<M&&(at&T)!==L){for(ft===0&&(ft=mt),q+=S,ct=1<<(ot=M-ft);ot+ft<J&&!((ct-=K[ot+ft])<=0);)ot++,ct<<=1;if(Bt+=1<<ot,h===1&&852<Bt||h===2&&592<Bt)return 1;y[L=at&T]=mt<<24|ot<<16|q-g|0}}return at!==0&&(y[q+at]=M-ft<<24|64<<16|0),m.bits=mt,0}},{"../utils/common":41}],51:[function(e,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,r){var s=e("../utils/common"),a=0,o=1;function l(H){for(var nt=H.length;0<=--nt;)H[nt]=0}var c=0,h=29,f=256,d=f+1+h,u=30,y=19,g=2*d+1,w=15,m=16,x=7,_=256,L=16,T=17,q=18,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],R=new Array(2*(d+2));l(R);var M=new Array(2*u);l(M);var $=new Array(512);l($);var S=new Array(256);l(S);var J=new Array(h);l(J);var mt,ot,ft,ct=new Array(u);function Bt(H,nt,Ct,It,dt){this.static_tree=H,this.extra_bits=nt,this.extra_base=Ct,this.elems=It,this.max_length=dt,this.has_stree=H&&H.length}function at(H,nt){this.dyn_tree=H,this.max_code=0,this.stat_desc=nt}function P(H){return H<256?$[H]:$[256+(H>>>7)]}function Y(H,nt){H.pending_buf[H.pending++]=255&nt,H.pending_buf[H.pending++]=nt>>>8&255}function K(H,nt,Ct){H.bi_valid>m-Ct?(H.bi_buf|=nt<<H.bi_valid&65535,Y(H,H.bi_buf),H.bi_buf=nt>>m-H.bi_valid,H.bi_valid+=Ct-m):(H.bi_buf|=nt<<H.bi_valid&65535,H.bi_valid+=Ct)}function et(H,nt,Ct){K(H,Ct[2*nt],Ct[2*nt+1])}function gt(H,nt){for(var Ct=0;Ct|=1&H,H>>>=1,Ct<<=1,0<--nt;);return Ct>>>1}function kt(H,nt,Ct){var It,dt,Et=new Array(w+1),ee=0;for(It=1;It<=w;It++)Et[It]=ee=ee+Ct[It-1]<<1;for(dt=0;dt<=nt;dt++){var Gt=H[2*dt+1];Gt!==0&&(H[2*dt]=gt(Et[Gt]++,Gt))}}function _t(H){var nt;for(nt=0;nt<d;nt++)H.dyn_ltree[2*nt]=0;for(nt=0;nt<u;nt++)H.dyn_dtree[2*nt]=0;for(nt=0;nt<y;nt++)H.bl_tree[2*nt]=0;H.dyn_ltree[2*_]=1,H.opt_len=H.static_len=0,H.last_lit=H.matches=0}function Pt(H){8<H.bi_valid?Y(H,H.bi_buf):0<H.bi_valid&&(H.pending_buf[H.pending++]=H.bi_buf),H.bi_buf=0,H.bi_valid=0}function jt(H,nt,Ct,It){var dt=2*nt,Et=2*Ct;return H[dt]<H[Et]||H[dt]===H[Et]&&It[nt]<=It[Ct]}function Zt(H,nt,Ct){for(var It=H.heap[Ct],dt=Ct<<1;dt<=H.heap_len&&(dt<H.heap_len&&jt(nt,H.heap[dt+1],H.heap[dt],H.depth)&&dt++,!jt(nt,It,H.heap[dt],H.depth));)H.heap[Ct]=H.heap[dt],Ct=dt,dt<<=1;H.heap[Ct]=It}function pe(H,nt,Ct){var It,dt,Et,ee,Gt=0;if(H.last_lit!==0)for(;It=H.pending_buf[H.d_buf+2*Gt]<<8|H.pending_buf[H.d_buf+2*Gt+1],dt=H.pending_buf[H.l_buf+Gt],Gt++,It===0?et(H,dt,nt):(et(H,(Et=S[dt])+f+1,nt),(ee=U[Et])!==0&&K(H,dt-=J[Et],ee),et(H,Et=P(--It),Ct),(ee=B[Et])!==0&&K(H,It-=ct[Et],ee)),Gt<H.last_lit;);et(H,_,nt)}function he(H,nt){var Ct,It,dt,Et=nt.dyn_tree,ee=nt.stat_desc.static_tree,Gt=nt.stat_desc.has_stree,re=nt.stat_desc.elems,ke=-1;for(H.heap_len=0,H.heap_max=g,Ct=0;Ct<re;Ct++)Et[2*Ct]!==0?(H.heap[++H.heap_len]=ke=Ct,H.depth[Ct]=0):Et[2*Ct+1]=0;for(;H.heap_len<2;)Et[2*(dt=H.heap[++H.heap_len]=ke<2?++ke:0)]=1,H.depth[dt]=0,H.opt_len--,Gt&&(H.static_len-=ee[2*dt+1]);for(nt.max_code=ke,Ct=H.heap_len>>1;1<=Ct;Ct--)Zt(H,Et,Ct);for(dt=re;Ct=H.heap[1],H.heap[1]=H.heap[H.heap_len--],Zt(H,Et,1),It=H.heap[1],H.heap[--H.heap_max]=Ct,H.heap[--H.heap_max]=It,Et[2*dt]=Et[2*Ct]+Et[2*It],H.depth[dt]=(H.depth[Ct]>=H.depth[It]?H.depth[Ct]:H.depth[It])+1,Et[2*Ct+1]=Et[2*It+1]=dt,H.heap[1]=dt++,Zt(H,Et,1),2<=H.heap_len;);H.heap[--H.heap_max]=H.heap[1],(function(me,be){var ze,ve,an,Ie,qe,Xe,cn=be.dyn_tree,Te=be.max_code,mn=be.stat_desc.static_tree,$e=be.stat_desc.has_stree,Ge=be.stat_desc.extra_bits,vn=be.stat_desc.extra_base,He=be.stat_desc.max_length,Ee=0;for(Ie=0;Ie<=w;Ie++)me.bl_count[Ie]=0;for(cn[2*me.heap[me.heap_max]+1]=0,ze=me.heap_max+1;ze<g;ze++)He<(Ie=cn[2*cn[2*(ve=me.heap[ze])+1]+1]+1)&&(Ie=He,Ee++),cn[2*ve+1]=Ie,Te<ve||(me.bl_count[Ie]++,qe=0,vn<=ve&&(qe=Ge[ve-vn]),Xe=cn[2*ve],me.opt_len+=Xe*(Ie+qe),$e&&(me.static_len+=Xe*(mn[2*ve+1]+qe)));if(Ee!==0){do{for(Ie=He-1;me.bl_count[Ie]===0;)Ie--;me.bl_count[Ie]--,me.bl_count[Ie+1]+=2,me.bl_count[He]--,Ee-=2}while(0<Ee);for(Ie=He;Ie!==0;Ie--)for(ve=me.bl_count[Ie];ve!==0;)Te<(an=me.heap[--ze])||(cn[2*an+1]!==Ie&&(me.opt_len+=(Ie-cn[2*an+1])*cn[2*an],cn[2*an+1]=Ie),ve--)}})(H,nt),kt(Et,ke,H.bl_count)}function I(H,nt,Ct){var It,dt,Et=-1,ee=nt[1],Gt=0,re=7,ke=4;for(ee===0&&(re=138,ke=3),nt[2*(Ct+1)+1]=65535,It=0;It<=Ct;It++)dt=ee,ee=nt[2*(It+1)+1],++Gt<re&&dt===ee||(Gt<ke?H.bl_tree[2*dt]+=Gt:dt!==0?(dt!==Et&&H.bl_tree[2*dt]++,H.bl_tree[2*L]++):Gt<=10?H.bl_tree[2*T]++:H.bl_tree[2*q]++,Et=dt,ke=(Gt=0)===ee?(re=138,3):dt===ee?(re=6,3):(re=7,4))}function D(H,nt,Ct){var It,dt,Et=-1,ee=nt[1],Gt=0,re=7,ke=4;for(ee===0&&(re=138,ke=3),It=0;It<=Ct;It++)if(dt=ee,ee=nt[2*(It+1)+1],!(++Gt<re&&dt===ee)){if(Gt<ke)for(;et(H,dt,H.bl_tree),--Gt!=0;);else dt!==0?(dt!==Et&&(et(H,dt,H.bl_tree),Gt--),et(H,L,H.bl_tree),K(H,Gt-3,2)):Gt<=10?(et(H,T,H.bl_tree),K(H,Gt-3,3)):(et(H,q,H.bl_tree),K(H,Gt-11,7));Et=dt,ke=(Gt=0)===ee?(re=138,3):dt===ee?(re=6,3):(re=7,4)}}l(ct);var pt=!1;function tt(H,nt,Ct,It){K(H,(c<<1)+(It?1:0),3),(function(dt,Et,ee,Gt){Pt(dt),Y(dt,ee),Y(dt,~ee),s.arraySet(dt.pending_buf,dt.window,Et,ee,dt.pending),dt.pending+=ee})(H,nt,Ct)}r._tr_init=function(H){pt||((function(){var nt,Ct,It,dt,Et,ee=new Array(w+1);for(dt=It=0;dt<h-1;dt++)for(J[dt]=It,nt=0;nt<1<<U[dt];nt++)S[It++]=dt;for(S[It-1]=dt,dt=Et=0;dt<16;dt++)for(ct[dt]=Et,nt=0;nt<1<<B[dt];nt++)$[Et++]=dt;for(Et>>=7;dt<u;dt++)for(ct[dt]=Et<<7,nt=0;nt<1<<B[dt]-7;nt++)$[256+Et++]=dt;for(Ct=0;Ct<=w;Ct++)ee[Ct]=0;for(nt=0;nt<=143;)R[2*nt+1]=8,nt++,ee[8]++;for(;nt<=255;)R[2*nt+1]=9,nt++,ee[9]++;for(;nt<=279;)R[2*nt+1]=7,nt++,ee[7]++;for(;nt<=287;)R[2*nt+1]=8,nt++,ee[8]++;for(kt(R,d+1,ee),nt=0;nt<u;nt++)M[2*nt+1]=5,M[2*nt]=gt(nt,5);mt=new Bt(R,U,f+1,d,w),ot=new Bt(M,B,0,u,w),ft=new Bt(new Array(0),O,0,y,x)})(),pt=!0),H.l_desc=new at(H.dyn_ltree,mt),H.d_desc=new at(H.dyn_dtree,ot),H.bl_desc=new at(H.bl_tree,ft),H.bi_buf=0,H.bi_valid=0,_t(H)},r._tr_stored_block=tt,r._tr_flush_block=function(H,nt,Ct,It){var dt,Et,ee=0;0<H.level?(H.strm.data_type===2&&(H.strm.data_type=(function(Gt){var re,ke=4093624447;for(re=0;re<=31;re++,ke>>>=1)if(1&ke&&Gt.dyn_ltree[2*re]!==0)return a;if(Gt.dyn_ltree[18]!==0||Gt.dyn_ltree[20]!==0||Gt.dyn_ltree[26]!==0)return o;for(re=32;re<f;re++)if(Gt.dyn_ltree[2*re]!==0)return o;return a})(H)),he(H,H.l_desc),he(H,H.d_desc),ee=(function(Gt){var re;for(I(Gt,Gt.dyn_ltree,Gt.l_desc.max_code),I(Gt,Gt.dyn_dtree,Gt.d_desc.max_code),he(Gt,Gt.bl_desc),re=y-1;3<=re&&Gt.bl_tree[2*X[re]+1]===0;re--);return Gt.opt_len+=3*(re+1)+5+5+4,re})(H),dt=H.opt_len+3+7>>>3,(Et=H.static_len+3+7>>>3)<=dt&&(dt=Et)):dt=Et=Ct+5,Ct+4<=dt&&nt!==-1?tt(H,nt,Ct,It):H.strategy===4||Et===dt?(K(H,2+(It?1:0),3),pe(H,R,M)):(K(H,4+(It?1:0),3),(function(Gt,re,ke,me){var be;for(K(Gt,re-257,5),K(Gt,ke-1,5),K(Gt,me-4,4),be=0;be<me;be++)K(Gt,Gt.bl_tree[2*X[be]+1],3);D(Gt,Gt.dyn_ltree,re-1),D(Gt,Gt.dyn_dtree,ke-1)})(H,H.l_desc.max_code+1,H.d_desc.max_code+1,ee+1),pe(H,H.dyn_ltree,H.dyn_dtree)),_t(H),It&&Pt(H)},r._tr_tally=function(H,nt,Ct){return H.pending_buf[H.d_buf+2*H.last_lit]=nt>>>8&255,H.pending_buf[H.d_buf+2*H.last_lit+1]=255&nt,H.pending_buf[H.l_buf+H.last_lit]=255&Ct,H.last_lit++,nt===0?H.dyn_ltree[2*Ct]++:(H.matches++,nt--,H.dyn_ltree[2*(S[Ct]+f+1)]++,H.dyn_dtree[2*P(nt)]++),H.last_lit===H.lit_bufsize-1},r._tr_align=function(H){K(H,2,3),et(H,_,R),(function(nt){nt.bi_valid===16?(Y(nt,nt.bi_buf),nt.bi_buf=0,nt.bi_valid=0):8<=nt.bi_valid&&(nt.pending_buf[nt.pending++]=255&nt.bi_buf,nt.bi_buf>>=8,nt.bi_valid-=8)})(H)}},{"../utils/common":41}],53:[function(e,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,r){(function(s){(function(a,o){if(!a.setImmediate){var l,c,h,f,d=1,u={},y=!1,g=a.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(a);w=w&&w.setTimeout?w:a,l={}.toString.call(a.process)==="[object process]"?function(L){process.nextTick(function(){x(L)})}:(function(){if(a.postMessage&&!a.importScripts){var L=!0,T=a.onmessage;return a.onmessage=function(){L=!1},a.postMessage("","*"),a.onmessage=T,L}})()?(f="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",_,!1):a.attachEvent("onmessage",_),function(L){a.postMessage(f+L,"*")}):a.MessageChannel?((h=new MessageChannel).port1.onmessage=function(L){x(L.data)},function(L){h.port2.postMessage(L)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(L){var T=g.createElement("script");T.onreadystatechange=function(){x(L),T.onreadystatechange=null,c.removeChild(T),T=null},c.appendChild(T)}):function(L){setTimeout(x,0,L)},w.setImmediate=function(L){typeof L!="function"&&(L=new Function(""+L));for(var T=new Array(arguments.length-1),q=0;q<T.length;q++)T[q]=arguments[q+1];var U={callback:L,args:T};return u[d]=U,l(d),d++},w.clearImmediate=m}function m(L){delete u[L]}function x(L){if(y)setTimeout(x,0,L);else{var T=u[L];if(T){y=!0;try{(function(q){var U=q.callback,B=q.args;switch(B.length){case 0:U();break;case 1:U(B[0]);break;case 2:U(B[0],B[1]);break;case 3:U(B[0],B[1],B[2]);break;default:U.apply(o,B)}})(T)}finally{m(L),y=!1}}}}function _(L){L.source===a&&typeof L.data=="string"&&L.data.indexOf(f)===0&&x(+L.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Il<"u"?Il:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(zh)),zh.exports}Mx();var xp;(function(n){n.left="left",n.center="center",n.right="right",n.justify="justify"})(xp||(xp={}));var kp;(function(n){n.b="b",n.ctr="ctr",n.t="t"})(kp||(kp={}));var _p;(function(n){n.arraybuffer="arraybuffer",n.base64="base64",n.binarystring="binarystring",n.blob="blob",n.nodebuffer="nodebuffer",n.uint8array="uint8array"})(_p||(_p={}));var Sp;(function(n){n.area="area",n.bar="bar",n.bar3d="bar3D",n.bubble="bubble",n.bubble3d="bubble3D",n.doughnut="doughnut",n.line="line",n.pie="pie",n.radar="radar",n.scatter="scatter"})(Sp||(Sp={}));var Ap;(function(n){n.accentBorderCallout1="accentBorderCallout1",n.accentBorderCallout2="accentBorderCallout2",n.accentBorderCallout3="accentBorderCallout3",n.accentCallout1="accentCallout1",n.accentCallout2="accentCallout2",n.accentCallout3="accentCallout3",n.actionButtonBackPrevious="actionButtonBackPrevious",n.actionButtonBeginning="actionButtonBeginning",n.actionButtonBlank="actionButtonBlank",n.actionButtonDocument="actionButtonDocument",n.actionButtonEnd="actionButtonEnd",n.actionButtonForwardNext="actionButtonForwardNext",n.actionButtonHelp="actionButtonHelp",n.actionButtonHome="actionButtonHome",n.actionButtonInformation="actionButtonInformation",n.actionButtonMovie="actionButtonMovie",n.actionButtonReturn="actionButtonReturn",n.actionButtonSound="actionButtonSound",n.arc="arc",n.bentArrow="bentArrow",n.bentUpArrow="bentUpArrow",n.bevel="bevel",n.blockArc="blockArc",n.borderCallout1="borderCallout1",n.borderCallout2="borderCallout2",n.borderCallout3="borderCallout3",n.bracePair="bracePair",n.bracketPair="bracketPair",n.callout1="callout1",n.callout2="callout2",n.callout3="callout3",n.can="can",n.chartPlus="chartPlus",n.chartStar="chartStar",n.chartX="chartX",n.chevron="chevron",n.chord="chord",n.circularArrow="circularArrow",n.cloud="cloud",n.cloudCallout="cloudCallout",n.corner="corner",n.cornerTabs="cornerTabs",n.cube="cube",n.curvedDownArrow="curvedDownArrow",n.curvedLeftArrow="curvedLeftArrow",n.curvedRightArrow="curvedRightArrow",n.curvedUpArrow="curvedUpArrow",n.custGeom="custGeom",n.decagon="decagon",n.diagStripe="diagStripe",n.diamond="diamond",n.dodecagon="dodecagon",n.donut="donut",n.doubleWave="doubleWave",n.downArrow="downArrow",n.downArrowCallout="downArrowCallout",n.ellipse="ellipse",n.ellipseRibbon="ellipseRibbon",n.ellipseRibbon2="ellipseRibbon2",n.flowChartAlternateProcess="flowChartAlternateProcess",n.flowChartCollate="flowChartCollate",n.flowChartConnector="flowChartConnector",n.flowChartDecision="flowChartDecision",n.flowChartDelay="flowChartDelay",n.flowChartDisplay="flowChartDisplay",n.flowChartDocument="flowChartDocument",n.flowChartExtract="flowChartExtract",n.flowChartInputOutput="flowChartInputOutput",n.flowChartInternalStorage="flowChartInternalStorage",n.flowChartMagneticDisk="flowChartMagneticDisk",n.flowChartMagneticDrum="flowChartMagneticDrum",n.flowChartMagneticTape="flowChartMagneticTape",n.flowChartManualInput="flowChartManualInput",n.flowChartManualOperation="flowChartManualOperation",n.flowChartMerge="flowChartMerge",n.flowChartMultidocument="flowChartMultidocument",n.flowChartOfflineStorage="flowChartOfflineStorage",n.flowChartOffpageConnector="flowChartOffpageConnector",n.flowChartOnlineStorage="flowChartOnlineStorage",n.flowChartOr="flowChartOr",n.flowChartPredefinedProcess="flowChartPredefinedProcess",n.flowChartPreparation="flowChartPreparation",n.flowChartProcess="flowChartProcess",n.flowChartPunchedCard="flowChartPunchedCard",n.flowChartPunchedTape="flowChartPunchedTape",n.flowChartSort="flowChartSort",n.flowChartSummingJunction="flowChartSummingJunction",n.flowChartTerminator="flowChartTerminator",n.folderCorner="folderCorner",n.frame="frame",n.funnel="funnel",n.gear6="gear6",n.gear9="gear9",n.halfFrame="halfFrame",n.heart="heart",n.heptagon="heptagon",n.hexagon="hexagon",n.homePlate="homePlate",n.horizontalScroll="horizontalScroll",n.irregularSeal1="irregularSeal1",n.irregularSeal2="irregularSeal2",n.leftArrow="leftArrow",n.leftArrowCallout="leftArrowCallout",n.leftBrace="leftBrace",n.leftBracket="leftBracket",n.leftCircularArrow="leftCircularArrow",n.leftRightArrow="leftRightArrow",n.leftRightArrowCallout="leftRightArrowCallout",n.leftRightCircularArrow="leftRightCircularArrow",n.leftRightRibbon="leftRightRibbon",n.leftRightUpArrow="leftRightUpArrow",n.leftUpArrow="leftUpArrow",n.lightningBolt="lightningBolt",n.line="line",n.lineInv="lineInv",n.mathDivide="mathDivide",n.mathEqual="mathEqual",n.mathMinus="mathMinus",n.mathMultiply="mathMultiply",n.mathNotEqual="mathNotEqual",n.mathPlus="mathPlus",n.moon="moon",n.noSmoking="noSmoking",n.nonIsoscelesTrapezoid="nonIsoscelesTrapezoid",n.notchedRightArrow="notchedRightArrow",n.octagon="octagon",n.parallelogram="parallelogram",n.pentagon="pentagon",n.pie="pie",n.pieWedge="pieWedge",n.plaque="plaque",n.plaqueTabs="plaqueTabs",n.plus="plus",n.quadArrow="quadArrow",n.quadArrowCallout="quadArrowCallout",n.rect="rect",n.ribbon="ribbon",n.ribbon2="ribbon2",n.rightArrow="rightArrow",n.rightArrowCallout="rightArrowCallout",n.rightBrace="rightBrace",n.rightBracket="rightBracket",n.round1Rect="round1Rect",n.round2DiagRect="round2DiagRect",n.round2SameRect="round2SameRect",n.roundRect="roundRect",n.rtTriangle="rtTriangle",n.smileyFace="smileyFace",n.snip1Rect="snip1Rect",n.snip2DiagRect="snip2DiagRect",n.snip2SameRect="snip2SameRect",n.snipRoundRect="snipRoundRect",n.squareTabs="squareTabs",n.star10="star10",n.star12="star12",n.star16="star16",n.star24="star24",n.star32="star32",n.star4="star4",n.star5="star5",n.star6="star6",n.star7="star7",n.star8="star8",n.stripedRightArrow="stripedRightArrow",n.sun="sun",n.swooshArrow="swooshArrow",n.teardrop="teardrop",n.trapezoid="trapezoid",n.triangle="triangle",n.upArrow="upArrow",n.upArrowCallout="upArrowCallout",n.upDownArrow="upDownArrow",n.upDownArrowCallout="upDownArrowCallout",n.uturnArrow="uturnArrow",n.verticalScroll="verticalScroll",n.wave="wave",n.wedgeEllipseCallout="wedgeEllipseCallout",n.wedgeRectCallout="wedgeRectCallout",n.wedgeRoundRectCallout="wedgeRoundRectCallout"})(Ap||(Ap={}));var Cp;(function(n){n.text1="tx1",n.text2="tx2",n.background1="bg1",n.background2="bg2",n.accent1="accent1",n.accent2="accent2",n.accent3="accent3",n.accent4="accent4",n.accent5="accent5",n.accent6="accent6"})(Cp||(Cp={}));var Lp;(function(n){n.left="left",n.center="center",n.right="right",n.justify="justify"})(Lp||(Lp={}));var Mp;(function(n){n.top="top",n.middle="middle",n.bottom="bottom"})(Mp||(Mp={}));var Np;(function(n){n.ACTION_BUTTON_BACK_OR_PREVIOUS="actionButtonBackPrevious",n.ACTION_BUTTON_BEGINNING="actionButtonBeginning",n.ACTION_BUTTON_CUSTOM="actionButtonBlank",n.ACTION_BUTTON_DOCUMENT="actionButtonDocument",n.ACTION_BUTTON_END="actionButtonEnd",n.ACTION_BUTTON_FORWARD_OR_NEXT="actionButtonForwardNext",n.ACTION_BUTTON_HELP="actionButtonHelp",n.ACTION_BUTTON_HOME="actionButtonHome",n.ACTION_BUTTON_INFORMATION="actionButtonInformation",n.ACTION_BUTTON_MOVIE="actionButtonMovie",n.ACTION_BUTTON_RETURN="actionButtonReturn",n.ACTION_BUTTON_SOUND="actionButtonSound",n.ARC="arc",n.BALLOON="wedgeRoundRectCallout",n.BENT_ARROW="bentArrow",n.BENT_UP_ARROW="bentUpArrow",n.BEVEL="bevel",n.BLOCK_ARC="blockArc",n.CAN="can",n.CHART_PLUS="chartPlus",n.CHART_STAR="chartStar",n.CHART_X="chartX",n.CHEVRON="chevron",n.CHORD="chord",n.CIRCULAR_ARROW="circularArrow",n.CLOUD="cloud",n.CLOUD_CALLOUT="cloudCallout",n.CORNER="corner",n.CORNER_TABS="cornerTabs",n.CROSS="plus",n.CUBE="cube",n.CURVED_DOWN_ARROW="curvedDownArrow",n.CURVED_DOWN_RIBBON="ellipseRibbon",n.CURVED_LEFT_ARROW="curvedLeftArrow",n.CURVED_RIGHT_ARROW="curvedRightArrow",n.CURVED_UP_ARROW="curvedUpArrow",n.CURVED_UP_RIBBON="ellipseRibbon2",n.CUSTOM_GEOMETRY="custGeom",n.DECAGON="decagon",n.DIAGONAL_STRIPE="diagStripe",n.DIAMOND="diamond",n.DODECAGON="dodecagon",n.DONUT="donut",n.DOUBLE_BRACE="bracePair",n.DOUBLE_BRACKET="bracketPair",n.DOUBLE_WAVE="doubleWave",n.DOWN_ARROW="downArrow",n.DOWN_ARROW_CALLOUT="downArrowCallout",n.DOWN_RIBBON="ribbon",n.EXPLOSION1="irregularSeal1",n.EXPLOSION2="irregularSeal2",n.FLOWCHART_ALTERNATE_PROCESS="flowChartAlternateProcess",n.FLOWCHART_CARD="flowChartPunchedCard",n.FLOWCHART_COLLATE="flowChartCollate",n.FLOWCHART_CONNECTOR="flowChartConnector",n.FLOWCHART_DATA="flowChartInputOutput",n.FLOWCHART_DECISION="flowChartDecision",n.FLOWCHART_DELAY="flowChartDelay",n.FLOWCHART_DIRECT_ACCESS_STORAGE="flowChartMagneticDrum",n.FLOWCHART_DISPLAY="flowChartDisplay",n.FLOWCHART_DOCUMENT="flowChartDocument",n.FLOWCHART_EXTRACT="flowChartExtract",n.FLOWCHART_INTERNAL_STORAGE="flowChartInternalStorage",n.FLOWCHART_MAGNETIC_DISK="flowChartMagneticDisk",n.FLOWCHART_MANUAL_INPUT="flowChartManualInput",n.FLOWCHART_MANUAL_OPERATION="flowChartManualOperation",n.FLOWCHART_MERGE="flowChartMerge",n.FLOWCHART_MULTIDOCUMENT="flowChartMultidocument",n.FLOWCHART_OFFLINE_STORAGE="flowChartOfflineStorage",n.FLOWCHART_OFFPAGE_CONNECTOR="flowChartOffpageConnector",n.FLOWCHART_OR="flowChartOr",n.FLOWCHART_PREDEFINED_PROCESS="flowChartPredefinedProcess",n.FLOWCHART_PREPARATION="flowChartPreparation",n.FLOWCHART_PROCESS="flowChartProcess",n.FLOWCHART_PUNCHED_TAPE="flowChartPunchedTape",n.FLOWCHART_SEQUENTIAL_ACCESS_STORAGE="flowChartMagneticTape",n.FLOWCHART_SORT="flowChartSort",n.FLOWCHART_STORED_DATA="flowChartOnlineStorage",n.FLOWCHART_SUMMING_JUNCTION="flowChartSummingJunction",n.FLOWCHART_TERMINATOR="flowChartTerminator",n.FOLDED_CORNER="folderCorner",n.FRAME="frame",n.FUNNEL="funnel",n.GEAR_6="gear6",n.GEAR_9="gear9",n.HALF_FRAME="halfFrame",n.HEART="heart",n.HEPTAGON="heptagon",n.HEXAGON="hexagon",n.HORIZONTAL_SCROLL="horizontalScroll",n.ISOSCELES_TRIANGLE="triangle",n.LEFT_ARROW="leftArrow",n.LEFT_ARROW_CALLOUT="leftArrowCallout",n.LEFT_BRACE="leftBrace",n.LEFT_BRACKET="leftBracket",n.LEFT_CIRCULAR_ARROW="leftCircularArrow",n.LEFT_RIGHT_ARROW="leftRightArrow",n.LEFT_RIGHT_ARROW_CALLOUT="leftRightArrowCallout",n.LEFT_RIGHT_CIRCULAR_ARROW="leftRightCircularArrow",n.LEFT_RIGHT_RIBBON="leftRightRibbon",n.LEFT_RIGHT_UP_ARROW="leftRightUpArrow",n.LEFT_UP_ARROW="leftUpArrow",n.LIGHTNING_BOLT="lightningBolt",n.LINE_CALLOUT_1="borderCallout1",n.LINE_CALLOUT_1_ACCENT_BAR="accentCallout1",n.LINE_CALLOUT_1_BORDER_AND_ACCENT_BAR="accentBorderCallout1",n.LINE_CALLOUT_1_NO_BORDER="callout1",n.LINE_CALLOUT_2="borderCallout2",n.LINE_CALLOUT_2_ACCENT_BAR="accentCallout2",n.LINE_CALLOUT_2_BORDER_AND_ACCENT_BAR="accentBorderCallout2",n.LINE_CALLOUT_2_NO_BORDER="callout2",n.LINE_CALLOUT_3="borderCallout3",n.LINE_CALLOUT_3_ACCENT_BAR="accentCallout3",n.LINE_CALLOUT_3_BORDER_AND_ACCENT_BAR="accentBorderCallout3",n.LINE_CALLOUT_3_NO_BORDER="callout3",n.LINE_CALLOUT_4="borderCallout4",n.LINE_CALLOUT_4_ACCENT_BAR="accentCallout3=4",n.LINE_CALLOUT_4_BORDER_AND_ACCENT_BAR="accentBorderCallout4",n.LINE_CALLOUT_4_NO_BORDER="callout4",n.LINE="line",n.LINE_INVERSE="lineInv",n.MATH_DIVIDE="mathDivide",n.MATH_EQUAL="mathEqual",n.MATH_MINUS="mathMinus",n.MATH_MULTIPLY="mathMultiply",n.MATH_NOT_EQUAL="mathNotEqual",n.MATH_PLUS="mathPlus",n.MOON="moon",n.NON_ISOSCELES_TRAPEZOID="nonIsoscelesTrapezoid",n.NOTCHED_RIGHT_ARROW="notchedRightArrow",n.NO_SYMBOL="noSmoking",n.OCTAGON="octagon",n.OVAL="ellipse",n.OVAL_CALLOUT="wedgeEllipseCallout",n.PARALLELOGRAM="parallelogram",n.PENTAGON="homePlate",n.PIE="pie",n.PIE_WEDGE="pieWedge",n.PLAQUE="plaque",n.PLAQUE_TABS="plaqueTabs",n.QUAD_ARROW="quadArrow",n.QUAD_ARROW_CALLOUT="quadArrowCallout",n.RECTANGLE="rect",n.RECTANGULAR_CALLOUT="wedgeRectCallout",n.REGULAR_PENTAGON="pentagon",n.RIGHT_ARROW="rightArrow",n.RIGHT_ARROW_CALLOUT="rightArrowCallout",n.RIGHT_BRACE="rightBrace",n.RIGHT_BRACKET="rightBracket",n.RIGHT_TRIANGLE="rtTriangle",n.ROUNDED_RECTANGLE="roundRect",n.ROUNDED_RECTANGULAR_CALLOUT="wedgeRoundRectCallout",n.ROUND_1_RECTANGLE="round1Rect",n.ROUND_2_DIAG_RECTANGLE="round2DiagRect",n.ROUND_2_SAME_RECTANGLE="round2SameRect",n.SMILEY_FACE="smileyFace",n.SNIP_1_RECTANGLE="snip1Rect",n.SNIP_2_DIAG_RECTANGLE="snip2DiagRect",n.SNIP_2_SAME_RECTANGLE="snip2SameRect",n.SNIP_ROUND_RECTANGLE="snipRoundRect",n.SQUARE_TABS="squareTabs",n.STAR_10_POINT="star10",n.STAR_12_POINT="star12",n.STAR_16_POINT="star16",n.STAR_24_POINT="star24",n.STAR_32_POINT="star32",n.STAR_4_POINT="star4",n.STAR_5_POINT="star5",n.STAR_6_POINT="star6",n.STAR_7_POINT="star7",n.STAR_8_POINT="star8",n.STRIPED_RIGHT_ARROW="stripedRightArrow",n.SUN="sun",n.SWOOSH_ARROW="swooshArrow",n.TEAR="teardrop",n.TRAPEZOID="trapezoid",n.UP_ARROW="upArrow",n.UP_ARROW_CALLOUT="upArrowCallout",n.UP_DOWN_ARROW="upDownArrow",n.UP_DOWN_ARROW_CALLOUT="upDownArrowCallout",n.UP_RIBBON="ribbon2",n.U_TURN_ARROW="uturnArrow",n.VERTICAL_SCROLL="verticalScroll",n.WAVE="wave"})(Np||(Np={}));var Pp;(function(n){n.AREA="area",n.BAR="bar",n.BAR3D="bar3D",n.BUBBLE="bubble",n.BUBBLE3D="bubble3D",n.DOUGHNUT="doughnut",n.LINE="line",n.PIE="pie",n.RADAR="radar",n.SCATTER="scatter"})(Pp||(Pp={}));var Ip;(function(n){n.TEXT1="tx1",n.TEXT2="tx2",n.BACKGROUND1="bg1",n.BACKGROUND2="bg2",n.ACCENT1="accent1",n.ACCENT2="accent2",n.ACCENT3="accent3",n.ACCENT4="accent4",n.ACCENT5="accent5",n.ACCENT6="accent6"})(Ip||(Ip={}));var Op;(function(n){n.chart="chart",n.image="image",n.line="line",n.rect="rect",n.text="text",n.placeholder="placeholder"})(Op||(Op={}));var Rp;(function(n){n.chart="chart",n.hyperlink="hyperlink",n.image="image",n.media="media",n.online="online",n.placeholder="placeholder",n.table="table",n.tablecell="tablecell",n.text="text",n.notes="notes"})(Rp||(Rp={}));var Tp;(function(n){n.title="title",n.body="body",n.image="pic",n.chart="chart",n.table="tbl",n.media="media"})(Tp||(Tp={}));var Bp;(function(n){n.DEFAULT="&#x2022;",n.CHECK="&#x2713;",n.STAR="&#x2605;",n.TRIANGLE="&#x25B6;"})(Bp||(Bp={}));const Nx=async(n,t,e)=>{let i=C.elements;{if(C.selection.length===0)return;i=i.filter(g=>C.selection.includes(g.id))}if(i.length===0)return;let r=1/0,s=1/0,a=-1/0,o=-1/0;i.forEach(g=>{r=Math.min(r,g.x),s=Math.min(s,g.y),a=Math.max(a,g.x+g.width),o=Math.max(o,g.y+g.height)});const l=20,c=a-r+l*2,h=o-s+l*2,f=document.createElement("canvas");f.width=c*n,f.height=h*n;const d=f.getContext("2d");if(!d)return;d.fillStyle="#ffffff",d.fillRect(0,0,f.width,f.height),d.scale(n,n),d.translate(-r+l,-s+l);const u=n2.canvas(f);i.forEach(g=>{ac(u,d,g)});const y=document.createElement("a");y.download="yappy_drawing.png",y.href=f.toDataURL("image/png"),y.click()},Px=n=>{let t=C.elements;{if(C.selection.length===0)return;t=t.filter(m=>C.selection.includes(m.id))}if(t.length===0)return;let e=1/0,i=1/0,r=-1/0,s=-1/0;t.forEach(m=>{e=Math.min(e,m.x),i=Math.min(i,m.y),r=Math.max(r,m.x+m.width),s=Math.max(s,m.y+m.height)});const a=20,o=r-e+a*2,l=s-i+a*2,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width",`${o}`),c.setAttribute("height",`${l}`),c.setAttribute("viewBox",`0 0 ${o} ${l}`),c.style.backgroundColor="#ffffff";const h=n2.svg(c),f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("transform",`translate(${-e+a}, ${-i+a})`),c.appendChild(f),t.forEach(m=>{let x=null;const _={seed:m.seed,roughness:m.roughness,stroke:m.strokeColor,strokeWidth:m.strokeWidth,fill:m.backgroundColor==="transparent"?void 0:m.backgroundColor,fillStyle:m.fillStyle,strokeLineDash:m.strokeStyle==="dashed"?[10,10]:m.strokeStyle==="dotted"?[5,10]:void 0};if(m.type==="rectangle")x=h.rectangle(m.x,m.y,m.width,m.height,_);else if(m.type==="circle")x=h.ellipse(m.x+m.width/2,m.y+m.height/2,Math.abs(m.width),Math.abs(m.height),_);else if(m.type==="line"||m.type==="arrow"){const L=m.x+m.width,T=m.y+m.height;if(m.type==="arrow"){const q=document.createElementNS("http://www.w3.org/2000/svg","g");q.appendChild(h.line(m.x,m.y,L,T,_));const U=Math.atan2(m.height,m.width),B=15,O={x:L-B*Math.cos(U-Math.PI/6),y:T-B*Math.sin(U-Math.PI/6)},X={x:L-B*Math.cos(U+Math.PI/6),y:T-B*Math.sin(U+Math.PI/6)};q.appendChild(h.line(L,T,O.x,O.y,_)),q.appendChild(h.line(L,T,X.x,X.y,_)),x=q}else x=h.line(m.x,m.y,L,T,_)}else if(m.type==="text"&&m.text){const L=document.createElementNS("http://www.w3.org/2000/svg","text");L.textContent=m.text,L.setAttribute("x",`${m.x}`),L.setAttribute("y",`${m.y+(m.fontSize||20)}`),L.setAttribute("fill",m.strokeColor),L.setAttribute("font-family","sans-serif"),L.setAttribute("font-size",`${m.fontSize||20}px`),x=L}else if((m.type==="fineliner"||m.type==="inkbrush"||m.type==="marker")&&m.points){let L=[];if(m.pointsEncoding==="flat"){const T=m.points;for(let q=0;q<T.length;q+=2)L.push({x:T[q],y:T[q+1]})}else L=m.points;if(L.length>1){const T=L.map(q=>[m.x+q.x,m.y+q.y]);x=h.curve(T,_)}}else if(m.type==="image"&&m.dataURL){const L=document.createElementNS("http://www.w3.org/2000/svg","image");L.setAttribute("href",m.dataURL),L.setAttribute("x",`${m.x}`),L.setAttribute("y",`${m.y}`),L.setAttribute("width",`${m.width}`),L.setAttribute("height",`${m.height}`),x=L}if(x){if(x.setAttribute("opacity",`${(m.opacity??100)/100}`),m.angle){const L=m.x+m.width/2,T=m.y+m.height/2;x.setAttribute("transform",`rotate(${m.angle*(180/Math.PI)}, ${L}, ${T})`)}f.appendChild(x)}});const u=new XMLSerializer().serializeToString(c),y=new Blob([u],{type:"image/svg+xml"}),g=URL.createObjectURL(y),w=document.createElement("a");w.download="yappy_drawing.svg",w.href=g,w.click()};class Ix{mediaRecorder=null;chunks=[];stream=null;canvas;onStopCallback=null;constructor(t){this.canvas=t}start(t="webm"){try{this.stream=this.canvas.captureStream(60);let e="video/webm;codecs=vp9";return t==="mp4"&&(MediaRecorder.isTypeSupported("video/mp4")?e="video/mp4":MediaRecorder.isTypeSupported("video/webm;codecs=h264")&&(e="video/webm;codecs=h264")),MediaRecorder.isTypeSupported(e)||(console.warn(`Mime type ${e} not supported, falling back to default.`),e=""),this.mediaRecorder=new MediaRecorder(this.stream,e?{mimeType:e}:void 0),this.chunks=[],this.mediaRecorder.ondataavailable=i=>{i.data.size>0&&this.chunks.push(i.data)},this.mediaRecorder.onstop=()=>{this.saveFile(),this.onStopCallback&&this.onStopCallback(),this.cleanup()},this.mediaRecorder.start(),!0}catch(e){return console.error("Failed to start recording:",e),!1}}stop(t){this.mediaRecorder&&this.mediaRecorder.state!=="inactive"&&(this.onStopCallback=t||null,this.mediaRecorder.stop())}saveFile(){if(this.chunks.length===0)return;const t=new Blob(this.chunks,{type:this.mediaRecorder?.mimeType||"video/webm"}),e=URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=e;const r=t.type.includes("mp4")?"mp4":"webm",s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);i.download=`yappy-recording-${s}.${r}`,document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(e)},100)}cleanup(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.mediaRecorder=null,this.chunks=[]}}var Ox=Gn("<div class=recording-overlay><div class=recording-indicator><div class=pulse-dot></div><span class=recording-text>REC</span></div><div class=recording-timer></div><button class=stop-btn><span>Stop");const Rx=n=>{const[t,e]=En(0);No(()=>{const r=setInterval(()=>{e(s=>s+1)},1e3);Hs(()=>clearInterval(r))});const i=r=>{const s=Math.floor(r/60),a=r%60;return`${s}:${a.toString().padStart(2,"0")}`};return(()=>{var r=Ox(),s=r.firstChild,a=s.nextSibling,o=a.nextSibling,l=o.firstChild;return yn(a,()=>i(t())),Gp(o,"click",n.onStop,!0),yn(o,Re(t5,{size:16,fill:"white",strokeWidth:0}),l),r})()};Zs(["click"]);var Tx=Gn("<canvas style=display:block;touch-action:none;user-select:none>"),Bx=Gn("<div style=position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0>"),Ex=Gn(\'<div style=position:fixed;bottom:30px;left:50%;transform:translateX(-50%);z-index:100><button style="background-color:white;border:1px solid #e5e7eb;padding:8px 16px;border-radius:9999px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1);cursor:pointer;color:#3b82f6;font-weight:500;font-size:14px;transition:all 0.2s">Scroll back to content\'),Dx=Gn(\'<textarea style="position:absolute;transform:translate(-50%, -50%);background:transparent;border:1px dashed #007acc;outline:none;margin:0;padding:4px;resize:none;overflow:hidden;min-width:50px;min-height:1em">\'),Fx=Gn(\'<div class=path-editor-overlay style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none><svg style=position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999><path fill=none stroke=#3b82f6 stroke-width=2 stroke-dasharray="5 5"></path></svg><div style=position:absolute;top:0;left:0;width:100%;height:100%;z-index:998;pointer-events:all;cursor:crosshair></div><button style="position:absolute;top:20px;left:50%;transform:translateX(-50%);z-index:2000;background:#3b82f6;color:white;padding:8px 16px;border-radius:20px;border:none;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.1);cursor:pointer;pointer-events:all">Done Editing Path\'),$x=Gn(\'<div class=path-control-point style="position:absolute;transform:translate(-50%, -50%);width:10px;height:10px;border:2px solid #3b82f6;border-radius:50%;pointer-events:all;cursor:move;z-index:1000">\');const[zx,jx]=En(null),Ep=(n,t,e,i,r,s,a,o)=>{const l=e.fillStyle||"solid";if(l==="solid"){const c=o?"#121212":"#ffffff";let h=e.backgroundColor||c;h==="transparent"&&(h=c),n.fillStyle=h,n.fillRect(i,r,s,a)}else if(["linear","radial","conic"].includes(l)){const c=e.gradientStops||[],h=e.gradientDirection||0;if(c.length===0){const y=o?"#121212":"#ffffff";let g=e.backgroundColor||y;g==="transparent"&&(g=y),n.fillStyle=g,n.fillRect(i,r,s,a);return}const f=i+s/2,d=r+a/2;let u;if(l==="linear"){const y=h*Math.PI/180,g=Math.sqrt(s*s+a*a)/2,w=Math.cos(y)*g,m=Math.sin(y)*g;u=n.createLinearGradient(f-w,d-m,f+w,d+m)}else{const y=h*Math.PI/180,g=Math.max(s,a)/2,w=g*.4,m=f+Math.cos(y)*w,x=d+Math.sin(y)*w;u=n.createRadialGradient(m,x,0,f,d,g)}c.forEach(y=>u.addColorStop(y.offset,y.color)),n.fillStyle=u,n.fillRect(i,r,s,a)}else if(["hachure","cross-hatch","zigzag","dots","dashed","zigzag-line"].includes(l)){const c=e.backgroundColor||(o?"#121212":"#ffffff");n.fillStyle=c,n.fillRect(i,r,s,a),t.rectangle(i,r,s,a,{fill:e.strokeColor||(o?"#ffffff":"#000000"),fillStyle:l,fillWeight:.5,hachureGap:8,stroke:"transparent",roughness:0})}else if(l==="image"&&e.backgroundImage){const c=H1(e.backgroundImage);if(c){n.save(),n.globalAlpha=e.backgroundOpacity??1;const h=c.width/c.height,f=s/a;let d,u,y,g;h>f?(u=a,d=a*h,y=i-(d-s)/2,g=r):(d=s,u=s/h,y=i,g=r-(u-a)/2),n.drawImage(c,y,g,d,u),n.restore()}else n.fillStyle=o?"#1a1a1a":"#f0f0f0",n.fillRect(i,r,s,a)}},Ux=()=>{mi(()=>{const v=C.selection;if(v.length>0){let Z=null,lt=-1/0;v.forEach(ht=>{const Nt=C.elements.find(vt=>vt.id===ht);if(Nt){const vt=C.layers.find(z=>z.id===Nt.layerId);vt&&vt.order>lt&&(lt=vt.order,Z=vt.id)}}),Z&&Z!==Fr(()=>C.activeLayerId)&&K5(Z)}}),mi(()=>{if(!n)return;const v=n.getContext("2d");v&&C.elements.forEach(Z=>{const lt=Z.type==="line"||Z.type==="arrow";if(Z.isSelected&&Z.autoResize&&Z.containerText&&!lt){Z.fontSize,Z.fontFamily,Z.fontWeight,Z.fontStyle,Z.containerText;const ht=Yf(v,Z,Z.containerText);(Math.abs(ht.width-Z.width)>2||Math.abs(ht.height-Z.height)>2)&&Fr(()=>de(Z.id,{width:ht.width,height:ht.height}))}})}),mi(()=>{if(C.appMode==="presentation")Fn.setForceTicker(!0);else{const v=C.elements.some(Z=>Z.flowAnimation);Fn.setForceTicker(v)}});let n,t=null;mi(()=>{const v=zx();v&&v.start&&(r(v.format||"webm"),jx(null))});const e=()=>{if(!n)return;const v=C.slides[C.activeSlideIndex];if(!v)return;const{width:Z,height:lt}=v.dimensions,{x:ht,y:Nt}=v.spatialPosition;if(Z===0||lt===0)return;const vt=document.createElement("canvas"),z=320,Lt=z*lt/Z;vt.width=z,vt.height=Lt;const Ut=vt.getContext("2d");if(!Ut)return;const wt=z/Z;Ut.save(),Ut.scale(wt,wt),Ut.translate(-ht,-Nt);const Ot=C.theme==="dark",zt=oc.canvas(vt);Ep(Ut,zt,v,ht,Nt,Z,lt,Ot),[...C.layers].sort((Ft,se)=>Ft.order-se.order).forEach(Ft=>{if(!Qi(Ft.id))return;C.elements.filter(te=>te.layerId===Ft.id).forEach(te=>{const ae=Ft?.opacity??1;ac(zt,Ut,te,Ot,ae)})}),Ut.restore();const At=vt.toDataURL("image/jpeg",.6);j5(C.activeSlideIndex,At)};let i;mi(()=>{C.activeSlideIndex,C.elements,window.clearTimeout(i),i=window.setTimeout(()=>{Fr(()=>e())},1e3)});const r=v=>{if(!n){console.error("[DEBUG] Canvas: No canvasRef available");return}t||(console.log("[DEBUG] Canvas: Initializing VideoRecorder"),t=new Ix(n)),console.log("[DEBUG] Canvas: Starting recorder...");const Z=t.start(v);console.log("[DEBUG] Canvas: Recorder start returned:",Z),Z?(Kt("isRecording",!0),Mi("Recording started...","info")):Mi("Failed to start recording","error")},s=()=>{t&&t.stop(()=>{Kt("isRecording",!1),Mi("Recording saved!","success")})};let a=!1,o=null,l=0,c=0;const[h,f]=En(null),[d,u]=En("containerText"),[y,g]=En("");let w,m=!1,x=!1,_=null;const[L,T]=En(null);let q=new Map;const[U,B]=En(null),[O,X]=En([]),[R,M]=En([]);let $=null,S=null,J=0,mt=0,ot=0,ft=0,ct=20,Bt=0;const at=16;let P=[],Y=!1,K=0;const et=8,gt=800,kt=100;let _t=[],Pt=0;const jt=16;let Zt=!1;const pe=()=>{if(!o||_t.length===0)return;const v=C.elements.find(Z=>Z.id===o);if(v&&v.points){const ht={points:[...v.points,..._t]};v.type==="ink"&&(ht.ttl=Date.now()+3e3),de(o,ht,!1),_t=[]}},he=()=>{n&&(n.width=window.innerWidth,n.height=window.innerHeight,C.appMode==="presentation"&&(Yh(),setTimeout(Yh,50)),Ct())},[I,D]=En("default"),[pt,tt]=En(!1),[H,nt]=En({x:0,y:0});function Ct(){if(console.log("[Canvas] draw() called, effectiveTime:",rh()),!n)return;const v=n.getContext("2d");if(!v)return;const Z=rh();window.yappyGlobalTime=Z;const lt=performance.now(),ht=C.appMode==="presentation"||C.isPreviewing;let Nt=C.elements;if(C.docType==="slides"&&C.slides.length>0){const yt=C.slides[C.activeSlideIndex];if(yt){const{x:Wt,y:Q}=yt.spatialPosition,{width:ue,height:fe}=yt.dimensions,xe=200,Ze=new Set(C.layers.filter(Ae=>Ae.isMaster).map(Ae=>Ae.id)),Qe=C.elements.filter(Ae=>{if(Ze.has(Ae.layerId))return!0;const je=Ae.x+Ae.width/2,xn=Ae.y+Ae.height/2;return je>=Wt-xe&&je<=Wt+ue+xe&&xn>=Q-xe&&xn<=Q+fe+xe}),ie=new Set(Qe.map(Ae=>Ae.orbitCenterId).filter(Boolean)),Se=C.elements.filter(Ae=>ie.has(Ae.id));Nt=Qe.length===C.elements.length?C.elements:[...new Set([...Qe,...Se])]}}const vt=th(Nt,Z,ht);v.setTransform(1,0,0,1,0,0),v.clearRect(0,0,n.width,n.height);const z=Date.now();if(P.length>0){let yt=0;for(let Wt=0;Wt<P.length;Wt++)z-P[Wt].timestamp<gt&&(P[yt++]=P[Wt]);P.length=yt}const Lt=C.theme==="dark",Ut=Lt?"#1a1a1b":"#e2e8f0";v.fillStyle=Ut,v.fillRect(0,0,n.width,n.height);const{scale:wt,panX:Ot,panY:zt}=C.viewState;v.save(),v.translate(Ot,zt),v.scale(wt,wt);const Dt=oc.canvas(n);if(C.docType==="slides"){const yt=C.slides[C.activeSlideIndex];if(yt){const{width:Wt,height:Q}=yt.dimensions,{x:ue,y:fe}=yt.spatialPosition;v.save(),v.shadowColor=Lt?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.15)",v.shadowBlur=40,v.shadowOffsetY=10,v.fillStyle="black",v.fillRect(ue,fe,Wt,Q),v.restore(),Ep(v,Dt,yt,ue,fe,Wt,Q,Lt)}}else C.docType==="infinite"&&C.slides.length>1&&C.slides.forEach((yt,Wt)=>{const{width:Q,height:ue}=yt.dimensions,{x:fe,y:xe}=yt.spatialPosition;v.save(),v.strokeStyle=Lt?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",v.lineWidth=2,v.setLineDash([10,5]),v.strokeRect(fe,xe,Q,ue),v.setLineDash([]),v.restore(),v.fillStyle=Lt?"rgba(100,149,237,0.03)":"rgba(70,130,180,0.02)",v.fillRect(fe,xe,Q,ue),v.save();const Ze=`Slide ${Wt+1}`,Qe=Math.max(14,16/wt);v.font=`${Qe}px Inter, sans-serif`,v.fillStyle=Lt?"rgba(100,149,237,0.6)":"rgba(70,130,180,0.5)";const ie=8,Se=v.measureText(Ze),Ae=Qe+ie*2,je=Se.width+ie*2;v.fillStyle=Lt?"rgba(30,30,30,0.8)":"rgba(255,255,255,0.9)",v.fillRect(fe,xe,je,Ae),v.strokeStyle=Lt?"rgba(100,149,237,0.4)":"rgba(70,130,180,0.3)",v.lineWidth=1,v.strokeRect(fe,xe,je,Ae),v.fillStyle=Lt?"rgba(100,149,237,0.8)":"rgba(70,130,180,0.7)",v.fillText(Ze,fe+ie,xe+Qe+ie/2),v.restore()});if(v.restore(),C.canvasTexture!=="none"){const yt=C.canvasTexture;if(v.save(),v.setTransform(1,0,0,1,0,0),yt==="dots"||yt==="grid"||yt==="graph"){const Wt=yt==="graph"?40:20,Q=Wt/4,ue=Lt?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.05)",fe=Lt?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.03)",xe=Lt?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.07)",Ze=Ot%(Wt*wt),Qe=zt%(Wt*wt);if(yt==="dots"){v.fillStyle=ue;for(let ie=Ze;ie<n.width;ie+=Wt*wt)for(let Se=Qe;Se<n.height;Se+=Wt*wt)v.beginPath(),v.arc(ie,Se,1,0,Math.PI*2),v.fill()}else if(yt==="grid"){v.strokeStyle=fe,v.lineWidth=1,v.beginPath();for(let ie=Ze;ie<n.width;ie+=Wt*wt)v.moveTo(ie,0),v.lineTo(ie,n.height);for(let ie=Qe;ie<n.height;ie+=Wt*wt)v.moveTo(0,ie),v.lineTo(n.width,ie);v.stroke()}else if(yt==="graph"){v.strokeStyle=fe,v.lineWidth=.5,v.beginPath();for(let ie=Ot%(Q*wt);ie<n.width;ie+=Q*wt)v.moveTo(ie,0),v.lineTo(ie,n.height);for(let ie=zt%(Q*wt);ie<n.height;ie+=Q*wt)v.moveTo(0,ie),v.lineTo(n.width,ie);v.stroke(),v.strokeStyle=xe,v.lineWidth=1,v.beginPath();for(let ie=Ze;ie<n.width;ie+=Wt*wt)v.moveTo(ie,0),v.lineTo(ie,n.height);for(let ie=Qe;ie<n.height;ie+=Wt*wt)v.moveTo(0,ie),v.lineTo(n.width,ie);v.stroke()}}v.restore()}if(v.save(),v.translate(Ot,zt),v.scale(wt,wt),C.gridSettings.enabled){const yt=C.gridSettings.gridSize;let Wt=C.gridSettings.gridColor;Lt&&Wt==="#e0e0e0"&&(Wt="#333333");const Q=C.gridSettings.gridOpacity,ue=C.gridSettings.style||"lines";v.save(),v.setTransform(1,0,0,1,0,0),v.strokeStyle=Wt,v.fillStyle=Wt,v.globalAlpha=Q,v.lineWidth=1;const fe=Math.floor(-Ot/wt/yt)*yt,xe=Math.ceil((n.width-Ot)/wt/yt)*yt,Ze=Math.floor(-zt/wt/yt)*yt,Qe=Math.ceil((n.height-zt)/wt/yt)*yt;if(ue==="lines"){v.beginPath();for(let ie=fe;ie<=xe;ie+=yt){const Se=ie*wt+Ot;v.moveTo(Se,0),v.lineTo(Se,n.height)}for(let ie=Ze;ie<=Qe;ie+=yt){const Se=ie*wt+zt;v.moveTo(0,Se),v.lineTo(n.width,Se)}v.stroke()}else{!Lt&&ue==="dots"&&(Wt==="#e0e0e0"||Wt==="#fafafa")&&(v.fillStyle="#b0b0b0");for(let Se=fe;Se<=xe;Se+=yt)for(let Ae=Ze;Ae<=Qe;Ae+=yt){const je=Se*wt+Ot,xn=Ae*wt+zt;je>=-3&&je<=n.width+3&&xn>=-3&&xn<=n.height+3&&(v.beginPath(),v.arc(je,xn,3/2,0,Math.PI*2),v.fill())}}v.restore()}const At={minX:-Ot/wt,maxX:(n.width-Ot)/wt,minY:-zt/wt,maxY:(n.height-zt)/wt},Ft=(At.maxX-At.minX)*.1,se=(At.maxY-At.minY)*.1,te=[...C.layers].sort((yt,Wt)=>yt.order-Wt.order);let ae=0;const $t=new Map;for(const yt of C.elements)$t.set(yt.id,yt);if(te.forEach(yt=>{if(!Qi(yt.id))return;if(yt.backgroundColor&&yt.backgroundColor!=="transparent"){v.save(),v.globalAlpha=yt.opacity,v.fillStyle=yt.backgroundColor;const Q=1e6;v.fillRect(-Q,-Q,Q*2,Q*2),v.restore()}const Wt=C.elements.filter(Q=>{if(Q.layerId!==yt.id)return!1;if(Q.id===o||yt.isMaster)return!0;if(po(Q,C.elements,$t))return!1;if(Q.type==="line"||Q.type==="arrow"||Q.type==="bezier"){if(Q.startBinding){const Ze=$t.get(Q.startBinding.elementId);if(Ze&&po(Ze,C.elements,$t))return!1}if(Q.endBinding){const Ze=$t.get(Q.endBinding.elementId);if(Ze&&po(Ze,C.elements,$t))return!1}}const ue=Math.abs(Q.width)*wt,fe=Math.abs(Q.height)*wt;if(ue<1&&fe<1)return!1;const xe=Math.max(Math.abs(Q.width),Math.abs(Q.height))*.5;return!(Q.x+Q.width+xe<At.minX-Ft||Q.x-xe>At.maxX+Ft||Q.y+Q.height+xe<At.minY-se||Q.y-xe>At.maxY+se)});ae+=Wt.length,Wt.forEach(Q=>{const ue=vt.get(Q.id),fe=ue?{...Q,x:ue.x,y:ue.y,angle:ue.angle}:JSON.parse(JSON.stringify(Q)),xe=yt.isMaster;if(xe&&C.docType==="slides"){const ie=C.slides[C.activeSlideIndex];if(ie){const{x:Se,y:Ae}=ie.spatialPosition;fe.x+=Se,fe.y+=Ae}}let Ze=fe.x+fe.width/2,Qe=fe.y+fe.height/2;if(C.docType==="slides"&&!xe){const ie=C.slides[C.activeSlideIndex];if(ie){const{x:Se,y:Ae}=ie.spatialPosition,{width:je,height:xn}=ie.dimensions;if(!(Ze>=Se&&Ze<=Se+je&&Qe>=Ae&&Qe<=Ae+xn))return}}if(fe.type==="text"&&fe.text){if(fe.text.startsWith("=="))fe.text=fe.text.substring(1);else if(fe.text.startsWith("=")){const ie=(C.activeSlideIndex+1).toString(),Se=C.slides.length.toString();fe.text=fe.text.substring(1).replace(/\\$\\{slideNumber\\}/g,ie).replace(/\\$\\{totalSlides\\}/g,Se)}}if(fe.type!=="text"||h()!==fe.id){const ie=yt?.opacity??1;ac(Dt,v,fe,Lt,ie)}if(C.selection.includes(Q.id)){const ie=fe.x,Se=fe.y,Ae=fe.width,je=fe.height,xn=fe.angle,ge=ie+Ae/2,Cn=Se+je/2;v.save(),xn&&(v.translate(ge,Cn),v.rotate(xn),v.translate(-ge,-Cn)),v.strokeStyle="#3b82f6",v.lineWidth=1/wt;const hn=2/wt;if(Q.type!=="line"&&Q.type!=="arrow"&&Q.type!=="bezier"&&Q.type!=="organicBranch")v.strokeRect(ie-hn,Se-hn,Ae+hn*2,je+hn*2);else if(Q.type==="organicBranch"&&Q.points&&Q.points.length>=2&&Q.controlPoints&&Q.controlPoints.length>=2){const nn=Tn(Q.points);if(nn.length>=2){const bn={x:Q.x+nn[0].x,y:Q.y+nn[0].y},rn={x:Q.x+nn[nn.length-1].x,y:Q.y+nn[nn.length-1].y},In=qf(bn,rn,Q.controlPoints[0],Q.controlPoints[1],Q.strokeWidth);v.save(),v.strokeStyle="#3b82f6",v.lineWidth=2/wt,v.beginPath(),v.moveTo(In[0].x,In[0].y);for(let dr=1;dr<In.length;dr++)v.lineTo(In[dr].x,In[dr].y);v.closePath(),v.stroke(),v.restore()}}if(C.selection.length===1){const nn=8/wt;if(v.fillStyle="#ffffff",v.strokeStyle="#3b82f6",v.lineWidth=2/wt,Q.type==="line"||Q.type==="arrow"||Q.type==="bezier"||Q.type==="organicBranch"){let bn=ie,rn=Se,In=ie+Ae,dr=Se+je;if(Q.type==="organicBranch"&&Q.points&&Q.points.length>=2){const pr=Tn(Q.points);pr.length>=2&&(bn=Q.x+pr[0].x,rn=Q.y+pr[0].y,In=Q.x+pr[pr.length-1].x,dr=Q.y+pr[pr.length-1].y)}[{x:bn,y:rn},{x:In,y:dr}].forEach(pr=>{v.beginPath(),v.arc(pr.x,pr.y,nn/1.5,0,Math.PI*2),v.fill(),v.stroke()})}else{[{x:ie-hn,y:Se-hn},{x:ie+Ae+hn,y:Se-hn},{x:ie+Ae+hn,y:Se+je+hn},{x:ie-hn,y:Se+je+hn},{x:ie+Ae/2,y:Se-hn},{x:ie+Ae+hn,y:Se+je/2},{x:ie+Ae/2,y:Se+je+hn},{x:ie-hn,y:Se+je/2}].forEach(In=>{v.fillRect(In.x-nn/2,In.y-nn/2,nn,nn),v.strokeRect(In.x-nn/2,In.y-nn/2,nn,nn)});const rn={x:Q.x+Q.width/2,y:Q.y-hn-20/wt};v.beginPath(),v.moveTo(Q.x+Q.width/2,Q.y-hn),v.lineTo(rn.x,rn.y),v.stroke(),v.beginPath(),v.arc(rn.x,rn.y,nn/2,0,Math.PI*2),v.fill(),v.stroke()}}if(C.elements.some(nn=>nn.parentId===Q.id)&&Q.type!=="line"&&Q.type!=="arrow"){const nn=14/wt,bn=Q.x+Q.width+15/wt,rn=Q.y+Q.height/2;v.beginPath(),v.arc(bn,rn,nn/2,0,Math.PI*2),v.fillStyle=Q.isCollapsed?"#10b981":Lt?"#333":"#fff",v.fill(),v.strokeStyle="#10b981",v.lineWidth=2/wt,v.stroke(),v.beginPath(),v.strokeStyle=Q.isCollapsed?"#fff":"#10b981",v.lineWidth=2/wt,v.moveTo(bn-nn/4,rn),v.lineTo(bn+nn/4,rn),Q.isCollapsed&&(v.moveTo(bn,rn-nn/4),v.lineTo(bn,rn+nn/4)),v.stroke()}v.restore()}if(Q.isCollapsed&&!C.selection.includes(Q.id)){v.save(),Q.angle&&(v.translate(Ze,Qe),v.rotate(Q.angle),v.translate(-Ze,-Qe)),v.shadowBlur=10/wt,v.shadowColor="#10b981",v.strokeStyle="#10b981",v.lineWidth=1/wt;const ie=1/wt;v.strokeRect(Q.x-ie,Q.y-ie,Q.width+ie*2,Q.height+ie*2),v.restore()}if(C.selection.includes(Q.id)&&(Q.type==="isometricCube"||Q.type==="star"||Q.type==="burst"||Q.type==="solidBlock"||Q.type==="perspectiveBlock"||Q.type==="cylinder")){const ie=10/wt;let Se=0,Ae=0;if(Q.type==="isometricCube"){const je=(Q.shapeRatio!==void 0?Q.shapeRatio:25)/100,xn=(Q.sideRatio!==void 0?Q.sideRatio:50)/100,ge=Q.height*je;Ae=Q.y+ge,Se=Q.x+Q.width*xn}else if(Q.type==="solidBlock"||Q.type==="cylinder"){const je=Q.depth!==void 0?Q.depth:50,xn=(Q.viewAngle!==void 0?Q.viewAngle:45)*Math.PI/180,ge=Q.x+Q.width/2,Cn=Q.y+Q.height/2;Se=ge+je*Math.cos(xn),Ae=Cn+je*Math.sin(xn)}else if(Q.type==="perspectiveBlock"){const je=Q.depth!==void 0?Q.depth:50,xn=(Q.viewAngle!==void 0?Q.viewAngle:45)*Math.PI/180,ge=Q.taper!==void 0?Q.taper:0,Cn=(Q.skewX!==void 0?Q.skewX:0)*Q.width,hn=(Q.skewY!==void 0?Q.skewY:0)*Q.height,ln=Q.x+Q.width/2,nn=Q.y+Q.height/2,bn=je*Math.cos(xn)+Cn,rn=je*Math.sin(xn)+hn,In=1-ge,dr=Q.width/2*In,Oi=Q.height/2*In,pr=1-(Q.frontTaper||0),Lr=Q.width/2*pr,Ri=Q.height/2*pr,Ti=(Q.frontSkewX||0)*Q.width,hi=(Q.frontSkewY||0)*Q.height,Bi=[{x:ln+bn,y:nn+rn,type:"depth"},{x:ln+bn-dr,y:nn+rn-Oi,type:"bTL"},{x:ln+bn+dr,y:nn+rn-Oi,type:"bTR"},{x:ln+bn+dr,y:nn+rn+Oi,type:"bBR"},{x:ln+bn-dr,y:nn+rn+Oi,type:"bBL"},{x:ln+Ti-Lr,y:nn+hi-Ri,type:"fTL"},{x:ln+Ti+Lr,y:nn+hi-Ri,type:"fTR"},{x:ln+Ti+Lr,y:nn+hi+Ri,type:"fBR"},{x:ln+Ti-Lr,y:nn+hi+Ri,type:"fBL"}];v.strokeStyle="#ffffff",v.lineWidth=1.5/wt;for(const rs of Bi)rs.type==="depth"?v.fillStyle="#f59e0b":rs.type.startsWith("b")?v.fillStyle="#3b82f6":v.fillStyle="#10b981",v.beginPath(),v.arc(rs.x,rs.y,ie/2,0,Math.PI*2),v.fill(),v.stroke();return}else if(Q.type==="star"||Q.type==="burst"){const je=(Q.shapeRatio!==void 0?Q.shapeRatio:25)/100;Se=Q.x+Q.width/2,Ae=Q.y+Q.height*je}v.fillStyle="#f59e0b",v.strokeStyle="#ffffff",v.lineWidth=1.5/wt,v.beginPath(),v.arc(Se,Ae,ie/2,0,Math.PI*2),v.fill(),v.stroke()}if(C.selection.includes(Q.id)){if((Q.type==="line"||Q.type==="arrow"||Q.type==="bezier"||Q.type==="organicBranch")&&Q.controlPoints&&C.selectedTool==="selection"){const ie=10/wt;if(Q.controlPoints.length===1){const Se=Q.controlPoints[0];let Ae={x:Q.x,y:Q.y},je={x:Q.x+Q.width,y:Q.y+Q.height};if(Q.points&&Q.points.length>=2){const Cn=Tn(Q.points);Cn.length>0&&(Ae={x:Q.x+Cn[0].x,y:Q.y+Cn[0].y},je={x:Q.x+Cn[Cn.length-1].x,y:Q.y+Cn[Cn.length-1].y})}const xn=.25*Ae.x+.5*Se.x+.25*je.x,ge=.25*Ae.y+.5*Se.y+.25*je.y;v.fillStyle="#3b82f6",v.strokeStyle="#ffffff",v.lineWidth=1.5/wt,v.beginPath(),v.arc(xn,ge,ie/2,0,Math.PI*2),v.fill(),v.stroke()}else Q.controlPoints.forEach(Se=>{v.fillStyle="#3b82f6",v.strokeStyle="#ffffff",v.lineWidth=1.5/wt,v.beginPath(),v.arc(Se.x,Se.y,ie/2,0,Math.PI*2),v.fill(),v.stroke()})}if(Q.type!=="line"&&Q.type!=="arrow"&&C.selectedTool==="selection"){const ie=14/wt,Se=32/wt,Ae=Q.x+Q.width/2,je=Q.y+Q.height/2;[{pos:"top",x:Ae,y:Q.y-Se},{pos:"right",x:Q.x+Q.width+Se,y:je},{pos:"bottom",x:Ae,y:Q.y+Q.height+Se},{pos:"left",x:Q.x-Se,y:je}].forEach(ge=>{const Cn=S&&S.elementId===Q.id&&S.handle===`connector-${ge.pos}`,hn=Cn?ie*1.3:ie;v.strokeStyle=Cn?"rgba(16, 185, 129, 0.8)":"rgba(16, 185, 129, 0.4)",v.lineWidth=(Cn?2:1)/wt,v.setLineDash([3/wt,3/wt]),v.beginPath(),ge.pos==="top"?(v.moveTo(ge.x,Q.y),v.lineTo(ge.x,ge.y)):ge.pos==="right"?(v.moveTo(Q.x+Q.width,ge.y),v.lineTo(ge.x,ge.y)):ge.pos==="bottom"?(v.moveTo(ge.x,Q.y+Q.height),v.lineTo(ge.x,ge.y)):ge.pos==="left"&&(v.moveTo(Q.x,ge.y),v.lineTo(ge.x,ge.y)),v.stroke(),v.setLineDash([]),v.shadowColor="rgba(16, 185, 129, 0.5)",v.shadowBlur=(Cn?8:4)/wt,v.fillStyle=Cn?"#059669":"#10b981",v.strokeStyle="#ffffff",v.lineWidth=2/wt,v.beginPath(),v.arc(ge.x,ge.y,hn/2,0,Math.PI*2),v.fill(),v.stroke(),v.shadowBlur=0,v.strokeStyle="#ffffff",v.lineWidth=1.8/wt;const ln=hn*.25;v.beginPath(),ge.pos==="top"?(v.moveTo(ge.x-ln,ge.y+ln/2),v.lineTo(ge.x,ge.y-ln/2),v.lineTo(ge.x+ln,ge.y+ln/2)):ge.pos==="right"?(v.moveTo(ge.x-ln/2,ge.y-ln),v.lineTo(ge.x+ln/2,ge.y),v.lineTo(ge.x-ln/2,ge.y+ln)):ge.pos==="bottom"?(v.moveTo(ge.x-ln,ge.y-ln/2),v.lineTo(ge.x,ge.y+ln/2),v.lineTo(ge.x+ln,ge.y-ln/2)):ge.pos==="left"&&(v.moveTo(ge.x+ln/2,ge.y-ln),v.lineTo(ge.x-ln/2,ge.y),v.lineTo(ge.x+ln/2,ge.y+ln)),v.stroke()})}}})}),C.selection.length>1){const yt=me();if(yt){const Wt=C.viewState.scale,Q=2/Wt,ue=8/Wt;v.save(),v.strokeStyle="#3b82f6",v.lineWidth=1/Wt,v.setLineDash([5/Wt,5/Wt]),v.strokeRect(yt.x-Q,yt.y-Q,yt.width+Q*2,yt.height+Q*2),v.setLineDash([]),v.fillStyle="#ffffff",v.lineWidth=2/Wt,[{x:yt.x-Q,y:yt.y-Q},{x:yt.x+yt.width+Q,y:yt.y-Q},{x:yt.x+yt.width+Q,y:yt.y+yt.height+Q},{x:yt.x-Q,y:yt.y+yt.height+Q},{x:yt.x+yt.width/2,y:yt.y-Q},{x:yt.x+yt.width+Q,y:yt.y+yt.height/2},{x:yt.x+yt.width/2,y:yt.y+yt.height+Q},{x:yt.x-Q,y:yt.y+yt.height/2}].forEach(xe=>{v.fillRect(xe.x-ue/2,xe.y-ue/2,ue,ue),v.strokeRect(xe.x-ue/2,xe.y-ue/2,ue,ue)}),v.restore()}}const le=L();le&&(v.save(),v.fillStyle="rgba(59, 130, 246, 0.2)",v.strokeStyle="#3b82f6",v.lineWidth=1/wt,v.fillRect(le.x,le.y,le.w,le.h),v.strokeRect(le.x,le.y,le.w,le.h),v.restore());const Pe=U();if(Pe){const yt=C.elements.find(Wt=>Wt.id===Pe.elementId);yt&&(v.save(),v.strokeStyle="#f59e0b",v.lineWidth=2/wt,v.strokeRect(yt.x-4/wt,yt.y-4/wt,yt.width+8/wt,yt.height+8/wt),v.fillStyle="#f59e0b",v.beginPath(),v.arc(Pe.px,Pe.py,5/wt,0,Math.PI*2),v.fill(),v.restore())}const Fe=O();Fe.length>0&&(v.save(),v.strokeStyle="#ff00ff",v.setLineDash([5/C.viewState.scale,5/C.viewState.scale]),v.lineWidth=1/C.viewState.scale,Fe.forEach(yt=>{v.beginPath(),yt.type==="vertical"?(v.moveTo(yt.coordinate,-1e5),v.lineTo(yt.coordinate,1e5)):(v.moveTo(-1e5,yt.coordinate),v.lineTo(1e5,yt.coordinate)),v.stroke()}),v.restore());const Yt=R();if(Yt.length>0&&(v.save(),v.strokeStyle="#ff00ff",v.fillStyle="#ff00ff",v.lineWidth=1/C.viewState.scale,v.font=`${Math.floor(10/C.viewState.scale)}px sans-serif`,v.textAlign="center",v.textBaseline="middle",Yt.forEach(yt=>{yt.segments.forEach(Wt=>{if(v.beginPath(),yt.orientation==="horizontal"){v.moveTo(Wt.from,yt.variableCoordinate),v.lineTo(Wt.to,yt.variableCoordinate),v.stroke();const Q=4/C.viewState.scale;v.beginPath(),v.moveTo(Wt.from,yt.variableCoordinate-Q),v.lineTo(Wt.from,yt.variableCoordinate+Q),v.moveTo(Wt.to,yt.variableCoordinate-Q),v.lineTo(Wt.to,yt.variableCoordinate+Q),v.stroke();const ue=(Wt.from+Wt.to)/2,fe=Math.round(yt.gap).toString(),xe=2/C.viewState.scale,Ze=v.measureText(fe).width+xe*4,Qe=12/C.viewState.scale;v.fillStyle="#ff00ff",v.fillRect(ue-Ze/2,yt.variableCoordinate-Qe/2,Ze,Qe),v.fillStyle="white",v.fillText(fe,ue,yt.variableCoordinate),v.fillStyle="#ff00ff"}else{v.beginPath(),v.moveTo(yt.variableCoordinate,Wt.from),v.lineTo(yt.variableCoordinate,Wt.to),v.stroke();const Q=4/C.viewState.scale;v.beginPath(),v.moveTo(yt.variableCoordinate-Q,Wt.from),v.lineTo(yt.variableCoordinate+Q,Wt.from),v.moveTo(yt.variableCoordinate-Q,Wt.to),v.lineTo(yt.variableCoordinate+Q,Wt.to),v.stroke();const ue=(Wt.from+Wt.to)/2,fe=Math.round(yt.gap).toString(),xe=2/C.viewState.scale,Ze=v.measureText(fe).width+xe*4,Qe=12/C.viewState.scale;v.fillStyle="#ff00ff",v.fillRect(yt.variableCoordinate-Ze/2,ue-Qe/2,Ze,Qe),v.fillStyle="white",v.fillText(fe,yt.variableCoordinate,ue),v.fillStyle="#ff00ff"}})}),v.restore()),(C.selectedTool==="line"||C.selectedTool==="arrow")&&a&&o){const yt=C.elements.find(Wt=>Wt.id===o);if(yt&&(yt.type==="line"||yt.type==="arrow")){const Wt=yt.x+yt.width,Q=yt.y+yt.height,ue=50/C.viewState.scale,fe=15/C.viewState.scale;v.save();for(const xe of C.elements){if(xe.id===o||!an(xe)||xe.type==="line"||xe.type==="arrow"||xe.type==="bezier"||xe.layerId!==C.activeLayerId)continue;const Ze=xe.x+xe.width/2,Qe=xe.y+xe.height/2;if(Math.sqrt((Ze-Wt)**2+(Qe-Q)**2)<ue){const Se=Fl(xe);for(const Ae of Se){const je=Ae.x-Wt,xn=Ae.y-Q,Cn=Math.sqrt(je*je+xn*xn)<fe,hn=Cn?6/C.viewState.scale:4/C.viewState.scale;v.beginPath(),v.arc(Ae.x,Ae.y,hn,0,Math.PI*2),Cn?(v.fillStyle="#3b82f6",v.fill()):(v.fillStyle="rgba(59, 130, 246, 0.4)",v.fill(),v.strokeStyle="#3b82f6",v.lineWidth=1/C.viewState.scale,v.stroke())}}}v.restore()}}if(P.length>1){v.save(),v.lineCap="round",v.lineJoin="round",v.shadowBlur=8,v.shadowColor="rgba(255, 50, 50, 0.6)";const yt=4/C.viewState.scale;let Wt=-1;for(let Q=0;Q<P.length-1;Q++){const ue=P[Q],fe=P[Q+1],xe=z-ue.timestamp,Ze=Math.max(0,1-xe/gt);if(Ze<=0)continue;const Qe=Math.ceil(Ze*5);if(Qe!==Wt){Wt!==-1&&v.stroke(),Wt=Qe;const ie=Qe/5;v.beginPath(),v.strokeStyle=`rgba(255, 30, 30, ${ie})`,v.lineWidth=yt*ie,v.moveTo(ue.x,ue.y)}v.lineTo(fe.x,fe.y)}Wt!==-1&&v.stroke(),v.restore()}v.restore();const we=performance.now()-lt;tb.measureFrame(we,C.elements.length,ae)}mi(()=>{rh(),C.appMode,C.isPreviewing,C.theme,C.elements.length,C.elements.forEach(v=>{v.x,v.y,v.width,v.height,v.points&&v.points.length,v.angle,v.opacity,v.strokeColor,v.backgroundColor,v.fillStyle,v.strokeWidth,v.strokeStyle,v.roughness,v.roundness,v.text,v.fontSize,v.fontFamily,v.textAlign,v.fontWeight,v.fontStyle,v.textColor,v.textHighlightEnabled,v.textHighlightColor,v.textHighlightPadding,v.textHighlightRadius,v.startArrowhead,v.endArrowhead,v.containerText,v.labelPosition,v.isCollapsed,v.parentId,v.starPoints,v.polygonSides,v.borderRadius,v.burstPoints,v.tailPosition,v.shapeRatio,v.sideRatio,v.depth,v.viewAngle,v.taper,v.skewX,v.skewY,v.frontTaper,v.frontSkewX,v.frontSkewY,v.drawInnerBorder,v.innerBorderDistance,v.strokeLineJoin,v.renderStyle,v.fillDensity,v.gradientStart,v.gradientEnd,v.gradientDirection,v.gradientStops,v.gradientType,v.shadowEnabled,v.shadowColor,v.shadowBlur,v.shadowOffsetX,v.shadowOffsetY,v.blendMode,v.spinEnabled,v.spinSpeed,v.orbitEnabled,v.orbitCenterId,v.orbitRadius,v.orbitSpeed,v.orbitDirection}),C.slides.forEach(v=>{v.backgroundColor,v.fillStyle,v.gradientStops,v.gradientDirection,v.backgroundImage,v.backgroundOpacity}),C.viewState.scale,C.viewState.panX,C.viewState.panY,C.selection.length,L(),C.layers.length,C.layers.forEach(v=>{v.visible,v.order,v.opacity,v.backgroundColor}),C.gridSettings.enabled,C.gridSettings.gridSize,C.gridSettings.gridColor,C.gridSettings.gridOpacity,C.gridSettings.style,C.canvasBackgroundColor,C.canvasTexture,O(),O(),requestAnimationFrame(Ct)}),mi(()=>{C.elements.forEach(v=>{v.boundElements&&v.boundElements.length>0&&(v.x,v.y,v.width,v.height,Fr(()=>{v.boundElements?.forEach(Z=>Xe(Z.id))}))})});const It=v=>({x:v.clientX,y:v.clientY}),dt=(v,Z)=>{if(!n)return{x:0,y:0};const{scale:lt,panX:ht,panY:Nt}=C.viewState,vt=n.getBoundingClientRect();return{x:(v-vt.left-ht)/lt,y:(Z-vt.top-Nt)/lt}},Et=v=>{v.dataTransfer&&(v.preventDefault(),v.dataTransfer.dropEffect="copy")},ee=async v=>{v.preventDefault(),v.stopPropagation();const Z=v.dataTransfer?.getData("text/plain");if(!Z)return;const lt=Z.startsWith("color(")||Z.startsWith("#")||Z.startsWith("rgba(")||Z.startsWith("rgb(")||Z.startsWith("oklch(")||Z.startsWith("hsl(")||Z.includes("display-p3")||Z.includes("oklch"),ht=Z.startsWith("http")||Z.startsWith("data:image");if(!lt&&!ht)return;const{x:Nt,y:vt}=dt(v.clientX,v.clientY),z=10/C.viewState.scale,Lt=new Map;for(const At of C.elements)Lt.set(At.id,At);const Ut=C.elements.map((At,Ft)=>{const se=C.layers.find(te=>te.id===At.layerId);return{el:At,index:Ft,layerOrder:se?.order??999,layerVisible:Qi(At.layerId)}}).sort((At,Ft)=>At.layerOrder!==Ft.layerOrder?Ft.layerOrder-At.layerOrder:Ft.index-At.index),wt=window.yappyGlobalTime||0,Ot=C.appMode==="presentation"||C.isPreviewing,zt=th(C.elements,wt,Ot);let Dt=null;for(const{el:At,layerVisible:Ft}of Ut){if(!Ft||!an(At))continue;const se=zt.get(At.id),te=se?{...At,x:se.x,y:se.y,angle:se.angle}:At;if(ve(te,Nt,vt,z,Lt)){Dt=At.id;break}}if(Dt)Sn(),lt?de(Dt,{backgroundColor:Z,fillStyle:"solid"}):ht&&de(Dt,{type:"image",dataURL:Z});else if(C.docType==="slides"){const At=C.activeSlideIndex;At!==-1?(Sn(),lt?ul(At,{backgroundColor:Z,fillStyle:"solid"}):ht&&ul(At,{backgroundImage:Z,fillStyle:"image"})):C.slides.length>0&&(Sn(),lt?ul(0,{backgroundColor:Z,fillStyle:"solid"}):ht&&ul(0,{backgroundImage:Z,fillStyle:"image"}))}},Gt=v=>{if(C.appMode==="presentation"&&C.docType==="slides")return;v.preventDefault();const Z=v.deltaMode===1?33:v.deltaMode===2?400:1,lt=v.deltaX*Z,ht=v.deltaY*Z;if(v.ctrlKey||v.metaKey){const vt=1-ht*.001,z=Math.min(Math.max(C.viewState.scale*vt,.1),10),{x:Lt,y:Ut}=It(v),{scale:wt,panX:Ot,panY:zt}=C.viewState,Dt=(Lt-Ot)/wt,At=(Ut-zt)/wt,Ft=Lt-Dt*z,se=Ut-At*z;Or({scale:z,panX:Ft,panY:se})}else v.shiftKey?Or({panX:C.viewState.panX-(ht||lt),panY:C.viewState.panY}):Or({panX:C.viewState.panX-lt,panY:C.viewState.panY-ht})},re=(v,Z,lt,ht,Nt)=>{const vt=Math.cos(Nt),z=Math.sin(Nt);return{x:vt*(v-lt)-z*(Z-ht)+lt,y:z*(v-lt)+vt*(Z-ht)+ht}},ke=(v,Z,lt,ht,Nt)=>re(v,Z,lt,ht,-Nt),me=()=>{if(C.selection.length===0)return null;let v=1/0,Z=1/0,lt=-1/0,ht=-1/0,Nt=!1;return C.elements.forEach(vt=>{C.selection.includes(vt.id)&&(v=Math.min(v,vt.x),Z=Math.min(Z,vt.y),lt=Math.max(lt,vt.x+vt.width),ht=Math.max(ht,vt.y+vt.height),Nt=!0)}),Nt?{x:v,y:Z,width:lt-v,height:ht-Z}:null},be=(v,Z)=>{const{scale:lt}=C.viewState,ht=12/lt,Nt=2/lt;if(C.selection.length>1){const vt=me();if(vt){const z=[{type:"tl",x:vt.x-Nt,y:vt.y-Nt},{type:"tr",x:vt.x+vt.width+Nt,y:vt.y-Nt},{type:"br",x:vt.x+vt.width+Nt,y:vt.y+vt.height+Nt},{type:"bl",x:vt.x-Nt,y:vt.y+vt.height+Nt},{type:"tm",x:vt.x+vt.width/2,y:vt.y-Nt},{type:"rm",x:vt.x+vt.width+Nt,y:vt.y+vt.height/2},{type:"bm",x:vt.x+vt.width/2,y:vt.y+vt.height+Nt},{type:"lm",x:vt.x-Nt,y:vt.y+vt.height/2}];for(const Lt of z)if(Math.abs(v-Lt.x)<=ht/2&&Math.abs(Z-Lt.y)<=ht/2)return{id:"multi",handle:Lt.type}}}for(let vt=C.elements.length-1;vt>=0;vt--){const z=C.elements[vt];if(po(z,C.elements))continue;if(C.elements.some(Ut=>Ut.parentId===z.id)&&z.type!=="line"&&z.type!=="arrow"){const Ut=z.x+z.width/2,wt=z.y+z.height/2,Ot=ke(v,Z,Ut,wt,z.angle||0),zt=14/lt,Dt=z.x+z.width+15/lt,At=z.y+z.height/2;if(Math.sqrt(Math.pow(Ot.x-Dt,2)+Math.pow(Ot.y-At,2))<=zt/2+5/lt)return{id:z.id,handle:"mindmap-toggle"}}}for(let vt=C.elements.length-1;vt>=0;vt--){const z=C.elements[vt];if(!C.selection.includes(z.id)||C.selection.length>1)continue;const Lt=z.x+z.width/2,Ut=z.y+z.height/2,wt=z.angle||0,Ot=ke(v,Z,Lt,Ut,wt);let zt=[{type:"tl",x:z.x-Nt,y:z.y-Nt},{type:"tr",x:z.x+z.width+Nt,y:z.y-Nt},{type:"br",x:z.x+z.width+Nt,y:z.y+z.height+Nt},{type:"bl",x:z.x-Nt,y:z.y+z.height+Nt},{type:"tm",x:z.x+z.width/2,y:z.y-Nt},{type:"rm",x:z.x+z.width+Nt,y:z.y+z.height/2},{type:"bm",x:z.x+z.width/2,y:z.y+z.height+Nt},{type:"lm",x:z.x-Nt,y:z.y+z.height/2}];if(z.type==="line"||z.type==="arrow"||z.type==="organicBranch"){let At=z.x,Ft=z.y,se=z.x+z.width,te=z.y+z.height;if(z.type==="organicBranch"&&z.points&&z.points.length>=2){const ae=Tn(z.points);ae.length>=2&&(At=z.x+ae[0].x,Ft=z.y+ae[0].y,se=z.x+ae[ae.length-1].x,te=z.y+ae[ae.length-1].y)}zt=[{type:"tl",x:At,y:Ft},{type:"br",x:se,y:te}]}for(const At of zt)if(Math.abs(Ot.x-At.x)<=ht/2&&Math.abs(Ot.y-At.y)<=ht/2)return{id:z.id,handle:At.type};const Dt={x:z.x+z.width/2,y:z.y-Nt-20/lt};if(Math.abs(Ot.x-Dt.x)<=ht&&Math.abs(Ot.y-Dt.y)<=ht/2)return{id:z.id,handle:"rotate"};if(z.type==="isometricCube"){const At=(z.shapeRatio!==void 0?z.shapeRatio:25)/100,Ft=(z.sideRatio!==void 0?z.sideRatio:50)/100,se=z.height*At,te=z.y+se,ae=z.x+z.width*Ft;if(Math.abs(Ot.x-ae)<=ht&&Math.abs(Ot.y-te)<=ht)return{id:z.id,handle:"control-1"}}else if(z.type==="solidBlock"||z.type==="cylinder"){const At=z.depth!==void 0?z.depth:50,Ft=(z.viewAngle!==void 0?z.viewAngle:45)*Math.PI/180,se=z.x+z.width/2,te=z.y+z.height/2,ae=se+At*Math.cos(Ft),$t=te+At*Math.sin(Ft);if(Math.abs(Ot.x-ae)<=ht&&Math.abs(Ot.y-$t)<=ht)return{id:z.id,handle:"control-1"}}else if(z.type==="perspectiveBlock"){const At=z.depth!==void 0?z.depth:50,Ft=(z.viewAngle!==void 0?z.viewAngle:45)*Math.PI/180,se=z.taper!==void 0?z.taper:0,te=(z.skewX!==void 0?z.skewX:0)*z.width,ae=(z.skewY!==void 0?z.skewY:0)*z.height,$t=z.x+z.width/2,le=z.y+z.height/2,Pe=At*Math.cos(Ft)+te,Fe=At*Math.sin(Ft)+ae,Yt=1-se,we=z.width/2*Yt,yt=z.height/2*Yt,Wt=1-(z.frontTaper||0),Q=z.width/2*Wt,ue=z.height/2*Wt,fe=(z.frontSkewX||0)*z.width,xe=(z.frontSkewY||0)*z.height,Ze=[{x:$t+Pe,y:le+Fe,handle:"control-1"},{x:$t+Pe-we,y:le+Fe-yt,handle:"control-2"},{x:$t+Pe+we,y:le+Fe-yt,handle:"control-3"},{x:$t+Pe+we,y:le+Fe+yt,handle:"control-4"},{x:$t+Pe-we,y:le+Fe+yt,handle:"control-5"},{x:$t+fe-Q,y:le+xe-ue,handle:"control-6"},{x:$t+fe+Q,y:le+xe-ue,handle:"control-7"},{x:$t+fe+Q,y:le+xe+ue,handle:"control-8"},{x:$t+fe-Q,y:le+xe+ue,handle:"control-9"}];for(const Qe of Ze)if(Math.abs(Ot.x-Qe.x)<=ht&&Math.abs(Ot.y-Qe.y)<=ht)return{id:z.id,handle:Qe.handle}}else if(z.type==="star"||z.type==="burst"){const At=(z.shapeRatio!==void 0?z.shapeRatio:25)/100,Ft=z.x+z.width/2,se=z.y+z.height*At;if(Math.abs(Ot.x-Ft)<=ht&&Math.abs(Ot.y-se)<=ht)return{id:z.id,handle:"control-1"}}if((z.type==="line"||z.type==="arrow"||z.type==="bezier"||z.type==="organicBranch")&&z.controlPoints)if(z.controlPoints.length===1){const At=z.controlPoints[0];let Ft={x:z.x,y:z.y},se={x:z.x+z.width,y:z.y+z.height};if(z.points&&z.points.length>=2){const $t=Tn(z.points);$t.length>0&&(Ft={x:z.x+$t[0].x,y:z.y+$t[0].y},se={x:z.x+$t[$t.length-1].x,y:z.y+$t[$t.length-1].y})}const te=.25*Ft.x+.5*At.x+.25*se.x,ae=.25*Ft.y+.5*At.y+.25*se.y;if(Math.abs(v-te)<=ht/2&&Math.abs(Z-ae)<=ht/2)return{id:z.id,handle:"control-0"}}else for(let At=0;At<z.controlPoints.length;At++){const Ft=z.controlPoints[At];if(Math.abs(v-Ft.x)<=ht/2&&Math.abs(Z-Ft.y)<=ht/2)return{id:z.id,handle:`control-${At}`}}if(z.type!=="line"&&z.type!=="arrow"){const At=14/lt,Ft=32/lt,se=z.x+z.width/2,te=z.y+z.height/2,ae=[{type:"connector-top",x:se,y:z.y-Ft},{type:"connector-right",x:z.x+z.width+Ft,y:te},{type:"connector-bottom",x:se,y:z.y+z.height+Ft},{type:"connector-left",x:z.x-Ft,y:te}];for(const $t of ae)if(Math.sqrt(Math.pow(Ot.x-$t.x,2)+Math.pow(Ot.y-$t.y,2))<=At/2+2/lt)return{id:z.id,handle:$t.type}}}return null},ze=v=>{if(!v.points||v.points.length===0)return null;const Z=Tn(v.points);let lt=1/0,ht=1/0,Nt=-1/0,vt=-1/0;Z.forEach(wt=>{lt=Math.min(lt,wt.x),ht=Math.min(ht,wt.y),Nt=Math.max(Nt,wt.x),vt=Math.max(vt,wt.y)});const z=Nt-lt,Lt=vt-ht,Ut=Z.map(wt=>({x:wt.x-lt,y:wt.y-ht}));return{x:v.x+lt,y:v.y+ht,width:z,height:Lt,points:Ut}},ve=(v,Z,lt,ht,Nt)=>{if(po(v,C.elements,Nt))return!1;const vt=v.x+v.width/2,z=v.y+v.height/2,Lt=ke(Z,lt,vt,z,v.angle||0);let Ut=Math.min(v.x,v.x+v.width),wt=Math.max(v.x,v.x+v.width),Ot=Math.min(v.y,v.y+v.height),zt=Math.max(v.y,v.y+v.height);if(v.type==="solidBlock"){const Dt=v.depth!==void 0?v.depth:50,At=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,Ft=Dt*Math.cos(At),se=Dt*Math.sin(At);Ut=Math.min(Ut,Ut+Ft,wt+Ft),wt=Math.max(wt,Ut+Ft,wt+Ft),Ot=Math.min(Ot,Ot+se,zt+se),zt=Math.max(zt,Ot+se,zt+se)}else if(v.type==="perspectiveBlock"){const Dt=v.depth!==void 0?v.depth:50,At=(v.viewAngle!==void 0?v.viewAngle:45)*Math.PI/180,Ft=(v.skewX||0)*v.width,se=(v.skewY||0)*v.height,te=Dt*Math.cos(At)+Ft,ae=Dt*Math.sin(At)+se,$t=v.taper||0,le=v.width/2*(1-$t),Pe=v.height/2*(1-$t),Fe=v.x+v.width/2,Yt=v.y+v.height/2,we=Fe+te-le,yt=Fe+te+le,Wt=Yt+ae-Pe,Q=Yt+ae+Pe;Ut=Math.min(Ut,we,yt),wt=Math.max(wt,we,yt),Ot=Math.min(Ot,Wt,Q),zt=Math.max(zt,Wt,Q)}if(Lt.x<Ut-ht||Lt.x>wt+ht||Lt.y<Ot-ht||Lt.y>zt+ht)return!1;if(v.type==="rectangle"||v.type==="solidBlock"||v.type==="isometricCube"||v.type==="perspectiveBlock")return!0;if(v.type==="diamond"){const Dt=v.x+v.width/2,At=v.y+v.height/2,Ft=Math.abs(Lt.x-Dt),se=Math.abs(Lt.y-At);return 2*Ft/v.width+2*se/v.height<=1}else{if(v.type==="circle")return Rm(Lt,v.x,v.y,v.width,v.height,ht);if(v.type==="line"||v.type==="arrow"){const Dt=v.x+v.width,At=v.y+v.height;if(v.curveType==="bezier"){const Ft=v.width,se=v.height;let te={x:v.x,y:v.y},ae={x:Dt,y:At};if(v.controlPoints&&v.controlPoints.length>0){const $t={x:v.x,y:v.y},le={x:Dt,y:At};if(v.controlPoints.length===2)return ml(Lt,$t,v.controlPoints[0],v.controlPoints[1],le,ht);{const Pe=v.controlPoints[0],Fe={x:$t.x+2/3*(Pe.x-$t.x),y:$t.y+2/3*(Pe.y-$t.y)},Yt={x:le.x+2/3*(Pe.x-le.x),y:le.y+2/3*(Pe.y-le.y)};return ml(Lt,$t,Fe,Yt,le,ht)}}else return Math.abs(Ft)>Math.abs(se)?(te={x:v.x+Ft/2,y:v.y},ae={x:Dt-Ft/2,y:At},ml(Lt,{x:v.x,y:v.y},te,ae,{x:Dt,y:At},ht)):(te={x:v.x,y:v.y+se/2},ae={x:Dt,y:At-se/2},ml(Lt,{x:v.x,y:v.y},te,ae,{x:Dt,y:At},ht))}else if(v.curveType==="elbow"){const Ft=Tn(v.points);if(Ft&&Ft.length>0){const se={x:Lt.x-v.x,y:Lt.y-v.y};return Dl(se,Ft,ht)}else return Qh(Lt,{x:v.x,y:v.y},{x:Dt,y:At})<=ht}else{if(v.points&&v.points.length>0){const Ft=Tn(v.points);if(Ft.length>1){const se={x:Lt.x-v.x,y:Lt.y-v.y};return Dl(se,Ft,ht)}}return Qh(Lt,{x:v.x,y:v.y},{x:v.x+v.width,y:v.y+v.height})<=ht}}else if(v.type==="fineliner"||v.type==="marker"||v.type==="inkbrush"||v.type==="ink"){const Dt=Tn(v.points);if(Dt.length>0){const At={x:Lt.x-v.x,y:Lt.y-v.y};return Dl(At,Dt,ht+(v.strokeWidth||0)/2)}return!1}else if(v.type==="organicBranch"){const Dt=Tn(v.points),At=v.controlPoints||[];if(Dt.length<2||At.length<2)return!1;const Ft={x:v.x+Dt[0].x,y:v.y+Dt[0].y},se={x:v.x+Dt[Dt.length-1].x,y:v.y+Dt[Dt.length-1].y},te=qf(Ft,se,At[0],At[1],v.strokeWidth);return Pm(Lt,te)}else{if(v.type==="text"||v.type==="image")return!0;if(v.type==="triangle"||v.type==="hexagon"||v.type==="octagon"||v.type==="parallelogram"||v.type==="star"||v.type==="cloud"||v.type==="heart"||v.type==="cross"||v.type==="checkmark"||v.type==="arrowLeft"||v.type==="arrowRight"||v.type==="arrowUp"||v.type==="arrowDown"||v.type==="capsule"||v.type==="stickyNote"||v.type==="callout"||v.type==="burst"||v.type==="speechBubble"||v.type==="ribbon"||v.type==="bracketLeft"||v.type==="bracketRight"||v.type==="database"||v.type==="document"||v.type==="predefinedProcess"||v.type==="internalStorage"||v.type==="server"||v.type==="loadBalancer"||v.type==="firewall"||v.type==="user"||v.type==="messageQueue"||v.type==="lambda"||v.type==="router"||v.type==="browser"||v.type==="trapezoid"||v.type==="rightTriangle"||v.type==="pentagon"||v.type==="septagon"||v.type==="starPerson"||v.type==="scroll"||v.type==="wavyDivider"||v.type==="doubleBanner"||v.type==="lightbulb"||v.type==="signpost"||v.type==="burstBlob"||v.type==="browserWindow"||v.type==="mobilePhone"||v.type==="ghostButton"||v.type==="inputField"||v.type==="polygon"||v.type==="dfdProcess"||v.type==="dfdDataStore"||v.type==="cylinder"||v.type==="stateStart"||v.type==="stateEnd"||v.type==="stateSync"||v.type==="activationBar"||v.type==="externalEntity"||v.type==="umlClass"||v.type==="umlInterface"||v.type==="umlActor"||v.type==="umlUseCase"||v.type==="umlNote"||v.type==="umlPackage"||v.type==="umlComponent"||v.type==="umlState"||v.type==="umlLifeline"||v.type==="umlFragment"||v.type==="umlSignalSend"||v.type==="umlSignalReceive"||v.type==="umlProvidedInterface"||v.type==="umlRequiredInterface")return!0}}return!1},an=v=>v.locked?!1:!$1(v.layerId),Ie=(v,Z,lt)=>{const ht=40/C.viewState.scale,Nt=25/C.viewState.scale;let vt=null;for(const z of C.elements){if(z.id===lt||!an(z)||z.type==="line"||z.type==="arrow"||z.type==="bezier"||z.type==="organicBranch")continue;const Lt=C.layers.find(wt=>wt.id===C.activeLayerId);if(!Lt||z.layerId!==Lt.id)continue;let Ut=!1;if(z.type==="text"||z.type==="image"||z.type==="rectangle")v>=z.x-ht&&v<=z.x+z.width+ht&&Z>=z.y-ht&&Z<=z.y+z.height+ht&&(Ut=!0);else if(z.type==="circle"){const wt=z.x+z.width/2,Ot=z.y+z.height/2,zt=z.width/2+ht,Dt=z.height/2+ht;(v-wt)**2/zt**2+(Z-Ot)**2/Dt**2<=1&&(Ut=!0)}else z.type,v>=z.x-ht&&v<=z.x+z.width+ht&&Z>=z.y-ht&&Z<=z.y+z.height+ht&&(Ut=!0);if(Ut){vt=z;break}}if(vt){const z=Tm(vt,{x:v,y:Z},Nt);if(z)return{element:vt,snapPoint:{x:z.x,y:z.y},position:z.position};const Lt=fh(vt,{x:v,y:Z},5);if(Lt)return{element:vt,snapPoint:Lt,position:"edge"}}return null},qe=(v,Z,lt,ht,Nt)=>{const vt=Z??v.x,z=lt??v.y,Lt=ht??v.x+v.width,Ut=Nt??v.y+v.height;if(v.curveType==="elbow"){const wt=C.elements.find(Dt=>Dt.id===v.startBinding?.elementId),Ot=C.elements.find(Dt=>Dt.id===v.endBinding?.elementId);return Bm({x:vt,y:z},{x:Lt,y:Ut},C.elements,wt,Ot,v.startBinding?.position,v.endBinding?.position).map(Dt=>({x:Dt.x-vt,y:Dt.y-z}))}if(v.points&&v.points.length>=2)return[0,0,Lt-vt,Ut-z]},Xe=v=>{const Z=C.elements.find(wt=>wt.id===v);if(!Z||Z.type!=="line"&&Z.type!=="arrow"&&Z.type!=="organicBranch"&&Z.type!=="bezier")return;let lt=Z.x,ht=Z.y,Nt=Z.x+Z.width,vt=Z.y+Z.height,z=!1;const Lt=Z.startBinding?C.elements.find(wt=>wt.id===Z.startBinding?.elementId):null,Ut=Z.endBinding?C.elements.find(wt=>wt.id===Z.endBinding?.elementId):null;if(Lt&&Ut){const wt=Lt.x+Lt.width/2,Ot=Lt.y+Lt.height/2,zt=Ut.x+Ut.width/2,Dt=Ut.y+Ut.height/2,At=zt-wt,Ft=Dt-Ot,se=Z.startBinding?.position,te=Z.endBinding?.position;let ae,$t;if(Math.abs(At)>Math.abs(Ft)?(ae=At>0?"right":"left",$t=At>0?"left":"right"):(ae=Ft>0?"bottom":"top",$t=Ft>0?"top":"bottom"),se!==ae||te!==$t)return de(Z.id,{startBinding:{...Z.startBinding,position:ae},endBinding:{...Z.endBinding,position:$t}},!1),Xe(v)}if(Z.startBinding){const wt=Lt||C.elements.find(Ot=>Ot.id===Z.startBinding.elementId);if(wt){const Ot=Z.startBinding.position;let zt;if(Ot&&Ot!=="edge"){const At=Fl(wt).find(Ft=>Ft.position===Ot);At&&(zt={x:At.x,y:At.y})}zt||(zt=fh(wt,{x:Nt,y:vt},Z.startBinding.gap)),zt&&(lt=zt.x,ht=zt.y,z=!0)}}if(Z.endBinding){const wt=Ut||C.elements.find(Ot=>Ot.id===Z.endBinding.elementId);if(wt){const Ot=Z.endBinding.position;let zt;if(Ot&&Ot!=="edge"){const At=Fl(wt).find(Ft=>Ft.position===Ot);At&&(zt={x:At.x,y:At.y})}zt||(zt=fh(wt,{x:lt,y:ht},Z.endBinding.gap)),zt&&(Nt=zt.x,vt=zt.y,z=!0)}}if(z){const wt=qe(Z,lt,ht,Nt,vt);if(lt!==Z.x||ht!==Z.y||Nt-lt!==Z.width||vt-ht!==Z.height||JSON.stringify(wt)!==JSON.stringify(Z.points)){const Ot={x:lt,y:ht,width:Nt-lt,height:vt-ht,points:wt};if(Z.controlPoints&&Z.controlPoints.length===2){const Dt=lt-Z.x,At=ht-Z.y,Ft=Nt-(Z.x+Z.width),se=vt-(Z.y+Z.height),te={x:Z.controlPoints[0].x+Dt,y:Z.controlPoints[0].y+At},ae={x:Z.controlPoints[1].x+Ft,y:Z.controlPoints[1].y+se};Ot.controlPoints=[te,ae]}de(Z.id,Ot,!1)}}},cn=v=>{if(C.appMode==="presentation"){const At=C.selectedTool==="selection"||C.selectedTool==="pan";if(C.docType==="slides"){if(At){v.button===0&&D1();return}}else if(v.button===0||v.button===1){m=!0,l=v.clientX,c=v.clientY,v.currentTarget.setPointerCapture(v.pointerId);return}}v.currentTarget.setPointerCapture(v.pointerId);const{x:Z,y:lt}=dt(v.clientX,v.clientY);if(h()){$e();return}if(C.selectedTool==="selection"){const At=be(Z,lt);if(At){if(At.handle==="mindmap-toggle"){Tf(At.id);return}if(At.handle.startsWith("connector-")){const Yt=C.elements.find(we=>we.id===At.id);if(Yt){const we=At.handle.replace("connector-",""),yt=Yt.x+Yt.width/2,Wt=Yt.y+Yt.height/2;let Q,ue;switch(we){case"top":Q=yt,ue=Yt.y;break;case"right":Q=Yt.x+Yt.width,ue=Wt;break;case"bottom":Q=yt,ue=Yt.y+Yt.height;break;case"left":Q=Yt.x,ue=Wt;break;default:Q=yt,ue=Wt}Sn(),a=!0,l=Q,c=ue,l=Q,c=ue,o=bi("arrow"),$={elementId:Yt.id,anchorPosition:we,startX:Q,startY:ue};const fe={...C.defaultElementStyles,id:o,type:"arrow",x:Q,y:ue,width:0,height:0,seed:Math.floor(Math.random()*2**31),layerId:C.activeLayerId,curveType:C.defaultElementStyles.curveType||"straight",startBinding:{elementId:Yt.id,focus:0,gap:5,position:we}};hl(fe);const xe=Yt.boundElements||[];de(Yt.id,{boundElements:[...xe,{id:o,type:"arrow"}]});return}}if(Sn(),m=!0,_=At.handle,l=Z,c=lt,At.id==="multi"){const Yt=me();if(Yt){J=Yt.x,mt=Yt.y,ot=Yt.width,ft=Yt.height,q.clear();const we=new Set(C.selection);C.selection.forEach(yt=>{uh(yt,C.elements).forEach(Wt=>we.add(Wt.id))}),C.elements.forEach(yt=>{we.has(yt.id)&&q.set(yt.id,{x:yt.x,y:yt.y,width:yt.width,height:yt.height,fontSize:yt.fontSize,points:yt.points?[...yt.points]:void 0})})}}else{const Yt=C.elements.find(we=>we.id===At.id);Yt&&(J=Yt.x,mt=Yt.y,ot=Yt.width,ft=Yt.height,ct=Yt.fontSize||20,q.clear(),q.set(Yt.id,{x:Yt.x,y:Yt.y,width:Yt.width,height:Yt.height,fontSize:Yt.fontSize,points:Yt.points?[...Yt.points]:void 0}))}return}let Ft=null;const se=10/C.viewState.scale,te=lb(C.elements,C.layers);for(const{groupId:Yt}of te){const we=C.elements.filter(Wt=>Wt.groupIds&&Wt.groupIds.includes(Yt));if(we.some(Wt=>an(Wt)&&Qi(Wt.layerId))&&ab(Z,lt,Yt,C.elements)){const Wt=we.map(ue=>ue.id),Q=Wt.every(ue=>C.selection.includes(ue));if(v.shiftKey||v.ctrlKey||v.metaKey?Q?Kt("selection",ue=>ue.filter(fe=>!Wt.includes(fe))):Kt("selection",ue=>[...new Set([...ue,...Wt])]):Q||Kt("selection",Wt),C.selection.length>0){Sn(),m=!0,_=null,l=Z,c=lt,q.clear();const ue=new Set(C.selection);C.selection.forEach(fe=>{uh(fe,C.elements).forEach(xe=>ue.add(xe.id))}),C.elements.forEach(fe=>{ue.has(fe.id)&&q.set(fe.id,{x:fe.x,y:fe.y,width:fe.width,height:fe.height,fontSize:fe.fontSize,points:fe.points?[...fe.points]:void 0,controlPoints:fe.controlPoints?fe.controlPoints.map(xe=>({...xe})):void 0})})}return}}const ae=new Map;for(const Yt of C.elements)ae.set(Yt.id,Yt);const $t=C.elements.map((Yt,we)=>{const yt=C.layers.find(Wt=>Wt.id===Yt.layerId);return{el:Yt,index:we,layerOrder:yt?.order??999,layerVisible:Qi(Yt.layerId)}}).sort((Yt,we)=>Yt.layerOrder!==we.layerOrder?we.layerOrder-Yt.layerOrder:we.index-Yt.index),le=window.yappyGlobalTime||0,Pe=C.appMode==="presentation"||C.isPreviewing,Fe=th(C.elements,le,Pe);for(const{el:Yt,layerVisible:we}of $t){if(!we||!an(Yt))continue;const yt=Fe.get(Yt.id),Wt=yt?{...Yt,x:yt.x,y:yt.y,angle:yt.angle}:Yt;if(ve(Wt,Z,lt,se,ae)){Ft=Yt.id;break}}if(Ft){const Yt=C.elements.find(Wt=>Wt.id===Ft);let we=[Ft];if(Yt&&Yt.groupIds&&Yt.groupIds.length>0){const Wt=Yt.groupIds[Yt.groupIds.length-1];we=C.elements.filter(Q=>Q.groupIds&&Q.groupIds.includes(Wt)).map(Q=>Q.id)}const yt=we.every(Wt=>C.selection.includes(Wt));if(v.shiftKey||v.ctrlKey||v.metaKey?yt?Kt("selection",Wt=>Wt.filter(Q=>!we.includes(Q))):Kt("selection",Wt=>[...new Set([...Wt,...we])]):yt||Kt("selection",we),C.selection.length>0){Sn(),m=!0,_=null,l=Z,c=lt,q.clear();const Wt=new Set(C.selection);C.selection.forEach(Q=>{uh(Q,C.elements).forEach(ue=>Wt.add(ue.id))}),C.elements.forEach(Q=>{Wt.has(Q.id)&&q.set(Q.id,{x:Q.x,y:Q.y,width:Q.width,height:Q.height,fontSize:Q.fontSize,points:Q.points?[...Q.points]:void 0,controlPoints:Q.controlPoints?Q.controlPoints.map(ue=>({...ue})):void 0})})}}else{if(C.selection.length>0){const Yt=me();if(Yt){const we=10/C.viewState.scale;if(Z>=Yt.x-we&&Z<=Yt.x+Yt.width+we&&lt>=Yt.y-we&&lt<=Yt.y+Yt.height+we){Sn(),m=!0,_=null,l=Z,c=lt,q.clear(),C.elements.forEach(yt=>{C.selection.includes(yt.id)&&q.set(yt.id,{x:yt.x,y:yt.y,width:yt.width,height:yt.height,fontSize:yt.fontSize,points:yt.points?[...yt.points]:void 0,controlPoints:yt.controlPoints?yt.controlPoints.map(Wt=>({...Wt})):void 0})});return}}}!v.shiftKey&&!v.ctrlKey&&!v.metaKey&&(Kt("selection",[]),If(!1)),x=!0,l=Z,c=lt,T({x:Z,y:lt,w:0,h:0})}return}const ht=C.layers.find(At=>At.id===C.activeLayerId);if(!ht?.visible){Mi("Cannot draw on a hidden layer. Please show the layer first or select a visible layer.","error");return}if(ht?.locked){Mi("Cannot draw on a locked layer. Please unlock the layer first or select an unlocked layer.","error");return}if(C.selectedTool==="text"){const At=bi("text"),Ft={...C.defaultElementStyles,id:At,type:"text",x:Z,y:lt,width:100,height:30,text:"",layerId:C.activeLayerId};hl(Ft),f(At),g(""),setTimeout(()=>w?.focus(),0);return}if(C.selectedTool==="laser"){a=!0,P=[{x:Z,y:lt,timestamp:Date.now()}],K=Date.now();return}if(C.selectedTool==="ink"){a=!0,l=Z,c=lt,o=bi("ink");const At={...C.defaultElementStyles,id:o,type:"ink",x:Z,y:lt,width:0,height:0,strokeColor:"#ef4444",strokeWidth:4,opacity:100,points:[0,0],pointsEncoding:"flat",ttl:Date.now()+3e3,layerId:C.activeLayerId,seed:Math.floor(Math.random()*2**31)};hl(At);return}if(C.selectedTool==="eraser"){a=!0;const At=10/C.viewState.scale,Ft=new Map;for(const se of C.elements)Ft.set(se.id,se);for(let se=C.elements.length-1;se>=0;se--){const te=C.elements[se];an(te)&&Qi(te.layerId)&&ve(te,Z,lt,At,Ft)&&pa([te.id])}return}if(C.selectedTool==="pan"){m=!0,D("grabbing");return}a=!0,_t=[],Pt=0;let Nt=Z,vt=lt;if(C.gridSettings.snapToGrid){const At=ph(Z,lt,C.gridSettings.gridSize);Nt=At.x,vt=At.y}l=Nt,c=vt,o=bi(C.selectedTool);const z=C.selectedTool,Lt=z==="bezier"?"line":z,Ut=z==="bezier"||z==="organicBranch"?"bezier":C.defaultElementStyles.curveType||"straight";let wt,Ot=Nt,zt=vt;if(z==="line"||z==="arrow"||z==="bezier"||z==="organicBranch"){const At=Ie(Nt,vt,o);At&&(wt={elementId:At.element.id,focus:0,gap:5,position:At.position},Ot=At.snapPoint.x,zt=At.snapPoint.y,l=Ot,c=zt)}const Dt={...C.defaultElementStyles,id:o,type:Lt,x:Ot,y:zt,width:0,height:0,seed:Math.floor(Math.random()*2**31)+1,layerId:C.activeLayerId,curveType:Ut,points:z==="fineliner"||z==="inkbrush"||z==="marker"?[0,0]:void 0,pointsEncoding:z==="fineliner"||z==="inkbrush"||z==="marker"?"flat":void 0,startBinding:wt,strokeStyle:["rectangle","circle","diamond","triangle","hexagon","octagon","pentagon","septagon","star","cloud","heart","capsule","stickyNote","callout","speechBubble","database","document","cylinder","isometricCube","solidBlock","perspectiveBlock","umlClass","umlInterface","umlActor","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive"].includes(Lt)?"solid":C.defaultElementStyles.strokeStyle};if(Lt==="stickyNote"&&(Dt.backgroundColor="#fef08a",Dt.fillStyle="solid",Dt.strokeColor="#000000"),hl(Dt),wt){const At=C.elements.find(Ft=>Ft.id===wt.elementId);if(At){const Ft=At.boundElements||[];de(At.id,{boundElements:[...Ft,{id:o,type:Lt}]})}}},Te=v=>{if(C.appMode==="presentation"){const ht=C.selectedTool==="selection"||C.selectedTool==="pan";if(C.docType==="slides"&&ht)return;if(C.docType!=="slides"){if(m){Or({panX:C.viewState.panX+v.movementX,panY:C.viewState.panY+v.movementY});return}}}let{x:Z,y:lt}=dt(v.clientX,v.clientY);if(C.selectedTool==="pan")D(m?"grabbing":"grab");else if(C.selectedTool==="selection"&&!m){const ht=be(Z,lt),Nt=S;ht?ht.handle==="rotate"?D("grab"):ht.handle==="tl"||ht.handle==="br"?D("nwse-resize"):ht.handle==="tr"||ht.handle==="bl"?D("nesw-resize"):ht.handle==="tm"||ht.handle==="bm"?D("ns-resize"):ht.handle==="lm"||ht.handle==="rm"?D("ew-resize"):ht.handle.startsWith("connector-")?(D("crosshair"),S={elementId:ht.id,handle:ht.handle}):S=null:(D("default"),S=null),(Nt&&!S||!Nt&&S||Nt&&S&&(Nt.elementId!==S.elementId||Nt.handle!==S.handle))&&requestAnimationFrame(Ct)}if(C.selectedTool==="pan"){m&&Or({panX:C.viewState.panX+v.movementX,panY:C.viewState.panY+v.movementY});return}if(C.selectedTool==="selection"){if(x){const ht=Z-l,Nt=lt-c;T({x:ht>0?l:l+ht,y:Nt>0?c:c+Nt,w:Math.abs(ht),h:Math.abs(Nt)});return}if(m&&C.selection.length>0){const ht=C.selection[0],Nt=C.elements.find(vt=>vt.id===ht);if(!Nt||_&&!an(Nt))return;if(_){if((Nt.type==="line"||Nt.type==="arrow"||Nt.type==="organicBranch")&&(_==="tl"||_==="br")){const vt=Ie(Z,lt,Nt.id);vt?(B({elementId:vt.element.id,px:vt.snapPoint.x,py:vt.snapPoint.y,position:vt.position}),Z=vt.snapPoint.x,lt=vt.snapPoint.y):B(null)}else B(null);if(_==="rotate"){const vt=Nt.x+Nt.width/2,z=Nt.y+Nt.height/2,Lt=Math.atan2(lt-z,Z-vt);de(ht,{angle:Lt+Math.PI/2})}else{let vt=Z,z=lt;if(C.gridSettings.snapToGrid){const te=ph(Z,lt,C.gridSettings.gridSize);vt=te.x,z=te.y}const Lt=vt-l,Ut=z-c;let wt=J,Ot=mt,zt=ot,Dt=ft;_==="tl"?(wt+=Lt,Ot+=Ut,zt-=Lt,Dt-=Ut):_==="tr"?(Ot+=Ut,zt+=Lt,Dt-=Ut):_==="bl"?(wt+=Lt,zt-=Lt,Dt+=Ut):_==="br"?(zt+=Lt,Dt+=Ut):_==="tm"?(Ot+=Ut,Dt-=Ut):_==="bm"?Dt+=Ut:_==="lm"?(wt+=Lt,zt-=Lt):_==="rm"&&(zt+=Lt);const At=C.selection.length>1,Ft=C.elements.find(te=>te.id===C.selection[0]);let se=v.shiftKey||C.selection.length===1&&Ft?.constrained;if(C.selection.length===1&&Ft?.type==="text"&&(se=!v.shiftKey),se&&ot!==0&&ft!==0){const te=ot/ft;["tm","bm"].includes(_)?(zt=Dt*te,wt=J+ot/2-zt/2):["lm","rm"].includes(_)?(Dt=zt/te,Ot=mt+ft/2-Dt/2):(Math.abs(zt)/te>Math.abs(Dt)?Dt=zt/te:zt=Dt*te,_==="tl"?(wt=J+ot-zt,Ot=mt+ft-Dt):_==="tr"?Ot=mt+ft-Dt:_==="bl"&&(wt=J+ot-zt))}if(_&&_.startsWith("control-")){const te=parseInt(_.replace("control-",""),10),ae=C.elements.find($t=>$t.id===ht);if(ae){let $t=ae.controlPoints?[...ae.controlPoints]:[];for(;$t.length<=te;)$t.push({x:Z,y:lt});if(ae.controlPoints&&ae.controlPoints.length===1&&te===0){let le={x:ae.x,y:ae.y},Pe={x:ae.x+ae.width,y:ae.y+ae.height};if(ae.points&&ae.points.length>=2){const we=Tn(ae.points);we.length>0&&(le={x:ae.x+we[0].x,y:ae.y+we[0].y},Pe={x:ae.x+we[we.length-1].x,y:ae.y+we[we.length-1].y})}const Fe=2*Z-.5*le.x-.5*Pe.x,Yt=2*lt-.5*le.y-.5*Pe.y;$t[0]={x:Fe,y:Yt}}else $t[te]={x:Z,y:lt};de(ae.id,{controlPoints:$t})}if(_&&_.startsWith("control-")){const $t=C.elements.find(le=>le.id===ht);if($t){if($t.type==="isometricCube"&&_==="control-1"){let le=(lt-$t.y)/$t.height;le=Math.max(.1,Math.min(.9,le));const Pe=Math.round(le*100);let Fe=(Z-$t.x)/$t.width;Fe=Math.max(0,Math.min(1,Fe));const Yt=Math.round(Fe*100);de($t.id,{shapeRatio:Pe,sideRatio:Yt},!1)}else if(($t.type==="solidBlock"||$t.type==="cylinder")&&_==="control-1"){const le=$t.x+$t.width/2,Pe=$t.y+$t.height/2,Fe=Z-le,Yt=lt-Pe;let we=Math.sqrt(Fe*Fe+Yt*Yt);we=Math.round(we);let yt=Math.atan2(Yt,Fe),Wt=Math.round(yt*180/Math.PI);Wt<0&&(Wt+=360),de($t.id,{depth:we,viewAngle:Wt},!1)}else if($t.type==="perspectiveBlock"){if(_==="control-1"){const le=$t.x+$t.width/2,Pe=$t.y+$t.height/2,Fe=Z-le-($t.skewX||0)*$t.width,Yt=lt-Pe-($t.skewY||0)*$t.height;let we=Math.sqrt(Fe*Fe+Yt*Yt),yt=Math.atan2(Yt,Fe),Wt=Math.round(yt*180/Math.PI);Wt<0&&(Wt+=360),de($t.id,{depth:Math.round(we),viewAngle:Wt},!1)}else if(_==="control-2"||_==="control-3"||_==="control-4"||_==="control-5"){const le=$t.width/2,Pe=$t.height/2,Fe=$t.x+le,Yt=$t.y+Pe,we=($t.viewAngle||45)*Math.PI/180,yt=$t.depth||50,Wt=Fe+yt*Math.cos(we),Q=Yt+yt*Math.sin(we),ue=Z-Wt,fe=lt-Q,xe=_==="control-3"||_==="control-4"?1:-1,Ze=_==="control-4"||_==="control-5"?1:-1,Qe=Math.sqrt(ue*ue+fe*fe),ie=Math.sqrt(le*le+Pe*Pe),Se=Math.max(0,Math.min(1,1-Qe/ie)),Ae=(ue-xe*le*(1-Se))/$t.width,je=(fe-Ze*Pe*(1-Se))/$t.height;de($t.id,{taper:Se,skewX:Ae,skewY:je},!1)}else if(_==="control-6"||_==="control-7"||_==="control-8"||_==="control-9"){const le=$t.width/2,Pe=$t.height/2,Fe=$t.x+le,Yt=$t.y+Pe,we=Z-Fe,yt=lt-Yt,Wt=_==="control-7"||_==="control-8"?1:-1,Q=_==="control-8"||_==="control-9"?1:-1,ue=Math.sqrt(we*we+yt*yt),fe=Math.sqrt(le*le+Pe*Pe),xe=Math.max(0,Math.min(1,1-ue/fe)),Ze=(we-Wt*le*(1-xe))/$t.width,Qe=(yt-Q*Pe*(1-xe))/$t.height;de($t.id,{frontTaper:xe,frontSkewX:Ze,frontSkewY:Qe},!1)}}else if(($t.type==="star"||$t.type==="burst")&&_==="control-1"){let le=(lt-$t.y)/$t.height;le=Math.max(.1,Math.min(.9,le));const Pe=Math.round(le*100);de($t.id,{shapeRatio:Pe},!1)}else if($t.type==="speechBubble"&&_==="control-1"){let le=(Z-$t.x)/$t.width,Pe=(lt-$t.y)/$t.height;le=Math.max(-.5,Math.min(1.5,le)),Pe=Math.max(-.5,Math.min(1.5,Pe)),de($t.id,{tailX:le,tailY:Pe},!1)}}}}else if(At){const te=ot===0?1:zt/ot,ae=ft===0?1:Dt/ft;C.selection.forEach($t=>{const le=q.get($t);if(!le)return;const Pe=le.x-J,Fe=le.y-mt,Yt={x:wt+Pe*te,y:Ot+Fe*ae,width:le.width*te,height:le.height*ae};if(le.points)if(typeof le.points[0]=="number"){const yt=le.points,Wt=[];for(let Q=0;Q<yt.length;Q+=2)Wt.push(yt[Q]*te,yt[Q+1]*ae);Yt.points=Wt}else Yt.points=le.points.map(yt=>({x:yt.x*te,y:yt.y*ae}));const we=C.elements.find(yt=>yt.id===$t);we&&we.type==="text"&&(Yt.fontSize=Math.max(8,(le.fontSize||20)*ae)),de($t,Yt,!1)})}else{const te=C.selection[0],ae=C.elements.find($t=>$t.id===te);if(ae){const $t={x:wt,y:Ot,width:zt,height:Dt},le=ot===0?1:zt/ot,Pe=ft===0?1:Dt/ft;if(ae.type==="text"&&Pe>0){let Fe=ct*Pe;Fe=Math.max(Fe,8),$t.fontSize=Fe}if((ae.type==="fineliner"||ae.type==="inkbrush"||ae.type==="marker")&&ae.points){const Fe=q.get(te);if(Fe&&Fe.points)if(ae.pointsEncoding==="flat"||Fe.points.length>0&&typeof Fe.points[0]=="number"){const Yt=Fe.points,we=[];for(let yt=0;yt<Yt.length;yt+=2)we.push(Yt[yt]*le,Yt[yt+1]*Pe);$t.points=we}else $t.points=Fe.points.map(Yt=>({x:Yt.x*le,y:Yt.y*Pe,...Yt.p!==void 0?{p:Yt.p}:{}}))}if((ae.type==="line"||ae.type==="arrow"||ae.type==="bezier")&&($t.points=qe(ae,wt,Ot,wt+zt,Ot+Dt)),ae.type==="organicBranch"){$t.points=[0,0,zt,Dt];const Fe=wt,Yt=Ot,we=wt+zt,yt=Ot+Dt,Wt={x:Fe+zt*.5,y:Yt},Q={x:we-zt*.5,y:yt};$t.controlPoints=[Wt,Q]}de(te,$t,!1)}}}}else{let vt=Z-l,z=lt-c;if(C.gridSettings.objectSnapping&&!v.shiftKey){const Ut=performance.now();if(Ut-Bt>=at){const wt=Xm(C.selection,C.elements,vt,z,5/C.viewState.scale);vt=wt.dx,z=wt.dy,X(wt.guides);const Ot=Gm(C.selection,C.elements,vt,z,5/C.viewState.scale);vt=Ot.dx,z=Ot.dy,M(Ot.guides),Bt=Ut}}else X([]),M([]);if(C.gridSettings.snapToGrid&&!v.shiftKey&&O().length===0){const Ut=C.gridSettings.gridSize;vt=Math.round(vt/Ut)*Ut,z=Math.round(z/Ut)*Ut}const Lt=v.altKey;q.forEach((Ut,wt)=>{if(Lt&&!C.selection.includes(wt))return;const Ot=C.elements.find(zt=>zt.id===wt);if(Ot&&an(Ot)){const zt={x:Ut.x+vt,y:Ut.y+z};Ut.controlPoints&&(zt.controlPoints=Ut.controlPoints.map(Dt=>({x:Dt.x+vt,y:Dt.y+z}))),de(wt,zt,!1),Ot.boundElements&&Ot.boundElements.forEach(Dt=>Xe(Dt.id))}})}}}if(C.selectedTool==="laser"){const ht=Date.now();if(ht-K>=et){K=ht;const{x:Nt,y:vt}=dt(v.clientX,v.clientY);P.length>=kt&&P.shift(),P.push({x:Nt,y:vt,timestamp:ht}),Y||(Y=!0,requestAnimationFrame(()=>{Y=!1,Ct()}))}}if(!a||!o){if(a&&C.selectedTool==="eraser"){const ht=10/C.viewState.scale,Nt=new Map;for(const vt of C.elements)Nt.set(vt.id,vt);for(let vt=C.elements.length-1;vt>=0;vt--){const z=C.elements[vt];an(z)&&Qi(z.layerId)&&ve(z,Z,lt,ht,Nt)&&pa([z.id])}}return}if(C.selectedTool==="fineliner"||C.selectedTool==="marker"||C.selectedTool==="inkbrush"||C.selectedTool==="ink"){const{x:ht,y:Nt}=dt(v.clientX,v.clientY),vt=ht-l,z=Nt-c;_t.push(vt,z);const Lt=Date.now();Lt-Pt>=jt?(Pt=Lt,pe()):Zt||(Zt=!0,requestAnimationFrame(()=>{Zt=!1,pe()}))}else{let ht=Z,Nt=lt;if(C.selectedTool==="line"||C.selectedTool==="arrow"||C.selectedTool==="bezier"||C.selectedTool==="organicBranch"||$){if(o){const z=Ie(Z,lt,o);z?(B({elementId:z.element.id,px:z.snapPoint.x,py:z.snapPoint.y,position:z.position}),ht=z.snapPoint.x,Nt=z.snapPoint.y):B(null)}}else B(null);if(!U()&&C.gridSettings.snapToGrid){const z=ph(Z,lt,C.gridSettings.gridSize);ht=z.x,Nt=z.y}const vt={width:ht-l,height:Nt-c};if(C.selectedTool==="organicBranch"){const z=ht-l,Lt=Nt-c;vt.points=[0,0,z,Lt];const Ut={x:l+z*.5,y:c},wt={x:ht-z*.5,y:Nt};vt.controlPoints=[Ut,wt]}de(o,vt)}if(m||a){const vt=v.clientX,z=v.clientY;let Lt=0,Ut=0;vt<50&&(Lt=10),vt>window.innerWidth-50&&(Lt=-10),z<50&&(Ut=10),z>window.innerHeight-50&&(Ut=-10),(Lt!==0||Ut!==0)&&Or({panX:C.viewState.panX+Lt,panY:C.viewState.panY+Ut})}(a||m)&&requestAnimationFrame(Ct)},mn=v=>{if(v.currentTarget.releasePointerCapture(v.pointerId),C.appMode==="presentation"){const Z=C.selectedTool==="selection"||C.selectedTool==="pan";if(C.docType==="slides"&&Z)return;if(C.docType!=="slides"){m=!1;return}}if(C.selectedTool==="pan"){m=!1,D("grab");return}if(C.selectedTool==="laser"){a=!1;const Z=()=>{P.length>0&&(Ct(),requestAnimationFrame(Z))};requestAnimationFrame(Z);return}if($&&a&&o){if(C.elements.find(lt=>lt.id===o)){if(U()){const lt=U(),ht={elementId:lt.elementId,focus:0,gap:5};de(o,{endBinding:ht});const Nt=C.elements.find(vt=>vt.id===lt.elementId);if(Nt){const vt=Nt.boundElements||[];vt.find(z=>z.id===o)||de(Nt.id,{boundElements:[...vt,{id:o,type:"arrow"}]})}}Kt("selection",[o])}a=!1,o=null,$=null,B(null),requestAnimationFrame(Ct);return}if(C.selectedTool==="selection"){if(x){const Z=L();if(Z){const lt=[],ht=Z.x,Nt=Z.y,vt=Z.w,z=Z.h;if(C.elements.forEach(Lt=>{const Ut=Lt.x,wt=Lt.y,Ot=Lt.width,zt=Lt.height,Dt=Math.min(Ut,Ut+Ot),At=Math.max(Ut,Ut+Ot),Ft=Math.min(wt,wt+zt),se=Math.max(wt,wt+zt);ht<At&&ht+vt>Dt&&Nt<se&&Nt+z>Ft&&lt.push(Lt.id)}),v.shiftKey||v.ctrlKey||v.metaKey){const Lt=new Set(C.selection);lt.forEach(Ut=>Lt.add(Ut)),Kt("selection",Array.from(Lt))}else Kt("selection",lt)}x=!1,T(null)}if(m){const Z=U();if(Z&&C.selection.length===1&&_){const lt=C.selection[0],ht=C.elements.find(Nt=>Nt.id===lt);if(ht&&(ht.type==="line"||ht.type==="arrow"||ht.type==="organicBranch")){const Nt=_==="tl",vt={elementId:Z.elementId,focus:0,gap:5,position:Z.position};de(lt,Nt?{startBinding:vt}:{endBinding:vt});const z=C.elements.find(Lt=>Lt.id===Z.elementId);if(z){const Lt=z.boundElements||[];Lt.find(Ut=>Ut.id===lt)||de(z.id,{boundElements:[...Lt,{id:lt,type:ht.type}]})}}}B(null)}m=!1,_=null,q.clear(),X([]);return}if(a&&o){const Z=C.elements.find(lt=>lt.id===o);if(Z){if((Z.type==="line"||Z.type==="arrow"||Z.type==="bezier"||Z.type==="organicBranch")&&U()){const ht=U(),Nt={elementId:ht.elementId,focus:0,gap:5,position:ht.position};de(o,{endBinding:Nt});const vt=C.elements.find(z=>z.id===ht.elementId);if(vt){const z=vt.boundElements||[];de(vt.id,{boundElements:[...z,{id:o,type:Z.type}]})}B(null)}if(["rectangle","circle","diamond","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","browserWindow","mobilePhone","ghostButton","inputField"].includes(Z.type))Z.width<0&&de(o,{x:Z.x+Z.width,width:Math.abs(Z.width)}),Z.height<0&&de(o,{y:Z.y+Z.height,height:Math.abs(Z.height)});else if(Z.type==="fineliner"||Z.type==="inkbrush"||Z.type==="marker"||Z.type==="ink"){pe();const ht=C.elements.find(Nt=>Nt.id===o);if(ht&&ht.points&&ht.points.length>2){const Nt=ze({...ht,points:ht.points});Nt&&de(o,Nt)}}else if(Z.type==="organicBranch"){Z.x,Z.y,Z.width,Z.height;const ht=Math.min(Z.x,Z.x+Z.width),Nt=Math.min(Z.y,Z.y+Z.height),vt=Math.abs(Z.width),z=Math.abs(Z.height),Lt=Z.x-ht,Ut=Z.y-Nt,wt=Z.x+Z.width-ht,Ot=Z.y+Z.height-Nt,zt=wt-Lt,Dt={x:ht+Lt+zt*.5,y:Nt+Ut},At={x:ht+wt-zt*.5,y:Nt+Ot};de(o,{x:ht,y:Nt,width:vt,height:z,points:[Lt,Ut,wt,Ot],controlPoints:[Dt,At]})}["selection","pan","eraser","fineliner","inkbrush","marker","text","block-text","ink"].includes(C.selectedTool)||wo("selection"),$&&(Kt("selection",[o]),wo("selection"))}}a=!1,o=null,$=null},$e=()=>{const v=h();if(!v)return;const Z=C.elements.find(ht=>ht.id===v);if(!Z)return;const lt=y().trim();if(Z.type==="text")if(lt){let ht=0,Nt=0;if(n){const vt=n.getContext("2d");if(vt){const z=Z.fontSize||20;vt.font=`${z}px sans-serif`,ht=vt.measureText(lt).width,Nt=z}}ht=Math.max(ht,10),Nt=Math.max(Nt,10),de(v,{text:lt,width:ht,height:Nt},!0)}else pa([v]);else{const ht=Z.type==="line"||Z.type==="arrow"||Z.type==="organicBranch",Nt=d();if(Z.autoResize&&n&&!ht&&Nt==="containerText"){const vt=n.getContext("2d");if(vt){const z=Yf(vt,Z,lt);de(v,{[Nt]:lt,width:z.width,height:z.height},!0)}else de(v,{[Nt]:lt},!0)}else de(v,{[Nt]:lt},!0)}f(null),g(""),requestAnimationFrame(Ct)},Ge=v=>{if(v.preventDefault(),C.selectedTool!=="selection")return;const{x:Z,y:lt}=dt(v.clientX,v.clientY),ht=10/C.viewState.scale,Nt=new Map;for(const vt of C.elements)Nt.set(vt.id,vt);for(let vt=C.elements.length-1;vt>=0;vt--){const z=C.elements[vt];if(an(z)&&Qi(z.layerId)&&ve(z,Z,lt,ht,Nt)){if(["star","burst","speechBubble","isometricCube","solidBlock","perspectiveBlock"].includes(z.type)){const Ut=be(Z,lt);if(Ut&&Ut.handle.startsWith("control-"))return}if(z.type==="line"||z.type==="arrow"||z.type==="bezier"){const Ut=z.controlPoints?[...z.controlPoints]:[];if(Ut.length>=2)return;Ut.push({x:Z,y:lt}),de(z.id,{controlPoints:Ut,curveType:"bezier"},!0);return}if(["rectangle","circle","diamond","line","arrow","triangle","hexagon","octagon","parallelogram","star","cloud","heart","capsule","stickyNote","callout","burst","speechBubble","ribbon","bracketLeft","bracketRight","database","document","predefinedProcess","internalStorage","server","loadBalancer","firewall","user","messageQueue","lambda","router","browser","trapezoid","rightTriangle","pentagon","septagon","starPerson","scroll","wavyDivider","doubleBanner","lightbulb","signpost","burstBlob","browserWindow","mobilePhone","ghostButton","inputField","dfdProcess","dfdDataStore","isometricCube","solidBlock","perspectiveBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","umlClass","umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlState","umlLifeline","umlFragment","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].includes(z.type)){if(f(z.id),z.type==="umlClass"){const Ut=lt-z.y,wt=n?.getContext("2d");let Ot=30;if(z.containerText&&wt){const Dt=Jr(wt,z,z.containerText,z.width-10);Ot=Math.max(30,Dt.textHeight+20)}let zt=20;if(z.attributesText&&wt){const Dt=Jr(wt,{...z,fontSize:(z.fontSize||20)*.9},z.attributesText,z.width-10);zt=Math.max(20,Dt.textHeight+10)}Ut<Ot?(u("containerText"),g(z.containerText||"")):Ut<Ot+zt?(u("attributesText"),g(z.attributesText||"")):(u("methodsText"),g(z.methodsText||""))}else if(z.type==="umlState"){const Ut=lt-z.y,wt=n?.getContext("2d");let Ot=35;if(z.containerText&&wt){const zt=Jr(wt,z,z.containerText,z.width-20);Ot=Math.max(35,zt.textHeight+15)}Ut<Ot?(u("containerText"),g(z.containerText||"")):(u("attributesText"),g(z.attributesText||""))}else if(z.type==="umlFragment"){const Ut=lt-z.y,wt=Z-z.x,Ot=Math.min(z.width*.3,60),zt=Math.min(z.height*.12,22)+5;wt<Ot&&Ut<zt?(u("containerText"),g(z.containerText||"")):(u("attributesText"),g(z.attributesText||""))}else u("containerText"),g(z.containerText||"");setTimeout(()=>w?.focus(),0);return}break}}},vn=()=>{h()&&$e()},He=()=>{const v=h();return v?C.elements.find(Z=>Z.id===v):null};mi(()=>{h()&&w&&(w.style.height="auto",w.style.height=w.scrollHeight+"px")});const[Ee,dn]=En(!1);mi(()=>{const{scale:v,panX:Z,panY:lt}=C.viewState;if(!n||C.elements.length===0){dn(!1);return}const ht=-Z/v,Nt=-lt/v,vt=n.width/v,z=n.height/v;let Lt=1/0,Ut=1/0,wt=-1/0,Ot=-1/0;C.elements.forEach(Dt=>{const At=Dt.x,Ft=Dt.x+Dt.width,se=Dt.y,te=Dt.y+Dt.height;Lt=Math.min(Lt,At,Ft),wt=Math.max(wt,At,Ft),Ut=Math.min(Ut,se,te),Ot=Math.max(Ot,se,te)});const zt=!(Lt>ht+vt||wt<ht||Ut>Nt+z||Ot<Nt);dn(!zt)});const Ii=()=>{if(C.elements.length===0)return;let v=1/0,Z=1/0,lt=-1/0,ht=-1/0;C.elements.forEach(At=>{const Ft=At.x,se=At.x+At.width,te=At.y,ae=At.y+At.height;v=Math.min(v,Ft,se),lt=Math.max(lt,Ft,se),Z=Math.min(Z,te,ae),ht=Math.max(ht,te,ae)});const Nt=lt-v,vt=ht-Z,z=v+Nt/2,Lt=Z+vt/2,{scale:Ut}=C.viewState,wt=window.innerWidth/2,Ot=window.innerHeight/2,zt=-z*Ut+wt,Dt=-Lt*Ut+Ot;Or({panX:zt,panY:Dt})};No(()=>{qm(()=>{Ct()}),window.addEventListener("resize",he),document.addEventListener("fullscreenchange",he),he(),Hs(()=>{window.removeEventListener("resize",he),document.removeEventListener("fullscreenchange",he)})});const ur=()=>{const v=C.selection.length,Z=v>0,lt=[];if(Z){lt.push({label:"Copy",shortcut:"Ctrl+C",onClick:Y1},{label:"Paste",shortcut:"Ctrl+V",onClick:Gf},{label:"Cut",shortcut:"Ctrl+X",onClick:Vm},{label:"Duplicate",shortcut:"Ctrl+D",onClick:()=>C.selection.forEach(Ot=>H5(Ot))},{separator:!0});const ht=C.selection[0],Nt=C.elements.find(Ot=>Ot.id===ht);if(Nt){const Ot=[];if(v===1&&(Ot.push({label:"Add Child",onClick:()=>B5(ht)}),Nt.parentId&&Ot.push({label:"Add Sibling",onClick:()=>E5(ht)}),Ot.push({separator:!0})),Nt.parentId&&Ot.push({label:"Clear Parent",onClick:()=>sm(ht)}),C.elements.some(At=>At.parentId===ht)&&Ot.push({label:Nt.isCollapsed?"Expand Subtree":"Collapse Subtree",onClick:()=>Tf(ht)}),v===2){const At=C.selection[0],Ft=C.selection[1];Ot.push({label:"Set as Child of Selected",onClick:()=>im(At,Ft)})}const Dt=[{label:"Horizontal (Right)",icon:"",onClick:()=>sa(ht,"horizontal-right")},{label:"Horizontal (Left)",icon:"",onClick:()=>sa(ht,"horizontal-left")},{label:"Vertical (Down)",icon:"",onClick:()=>sa(ht,"vertical-down")},{label:"Vertical (Up)",icon:"",onClick:()=>sa(ht,"vertical-up")},{label:"Radial (Neuron)",icon:"",onClick:()=>sa(ht,"radial")}];Ot.push({separator:!0}),Ot.push({label:"Auto Layout",submenu:Dt,icon:""}),Ot.push({label:"Auto Style Branch",icon:"",onClick:()=>om(ht)}),Ot.length>0&&lt.push({label:"Hierarchy",submenu:Ot})}const vt=C.selection.map(Ot=>C.elements.find(zt=>zt.id===Ot)).filter(Boolean),z=vt.filter(Ot=>{const zt=Ot.type;return zt!=="line"&&zt!=="arrow"&&zt!=="bezier"&&zt!=="organicBranch"&&zt!=="text"&&zt!=="image"}),Lt=vt.filter(Ot=>{const zt=Ot.type;return zt==="line"||zt==="arrow"||zt==="bezier"||zt==="organicBranch"});if(z.length>0){let Ot=Zf(z[0].type);new Set(z.map(Dt=>Dt.type)).size>1&&Ot.push(z[0].type),Ot.length>0&&lt.push({label:z.length>1?`Transform ${z.length} Shapes`:"Transform Shape",submenu:Ot.map(Dt=>({icon:Kf(Dt),tooltip:Qf(Dt),onClick:()=>{Sn(),z.forEach(At=>Vf(At.id,Dt,!1)),requestAnimationFrame(Ct)}})),gridColumns:3})}if(Lt.length>0){let Ot=Zf(Lt[0].type);new Set(Lt.map(Dt=>Dt.type)).size>1&&Ot.push(Lt[0].type),Ot.length>0&&lt.push({label:Lt.length>1?`Transform ${Lt.length} Connectors`:"Transform Connector",submenu:Ot.map(Dt=>({icon:Kf(Dt),tooltip:Qf(Dt),onClick:()=>{Sn(),Lt.forEach(At=>Vf(At.id,Dt,!1)),requestAnimationFrame(Ct)}})),gridColumns:3})}if(Lt.length>0){const zt=Lt[0].curveType||"straight",Dt=rb(zt);new Set(Lt.map(Ft=>Ft.curveType||"straight")).size>1&&Dt.push(zt),Dt.length>0&&lt.push({label:Lt.length>1?"Change All Curve Styles":"Change Curve Style",submenu:Dt.map(Ft=>({icon:ib(Ft),tooltip:sb(Ft),onClick:()=>{Sn(),Lt.forEach(se=>de(se.id,{curveType:Ft},!1)),requestAnimationFrame(Ct)}})),gridColumns:3})}lt.push({separator:!0}),v>1&&lt.push({label:"Group",shortcut:"Ctrl+G",onClick:Y5}),C.selection.some(Ot=>{const zt=C.elements.find(Dt=>Dt.id===Ot);return zt?.groupIds&&zt.groupIds.length>0})&&lt.push({label:"Ungroup",shortcut:"Ctrl+Shift+G",onClick:V5}),lt.push({separator:!0}),lt.push({label:"Export as PNG",onClick:()=>Nx(2)},{label:"Export as SVG",onClick:()=>Px()}),lt.push({separator:!0}),lt.push({label:"Bring to Front",shortcut:"Ctrl+]",onClick:()=>D5(C.selection)},{label:"Send to Back",shortcut:"Ctrl+[",onClick:()=>F5(C.selection)},{label:"Bring Forward",onClick:()=>C.selection.forEach(Ot=>Rf(Ot,"forward"))},{label:"Send Backward",onClick:()=>C.selection.forEach(Ot=>Rf(Ot,"backward"))},{separator:!0}),v===1&&lt.push({label:"Copy Styles",shortcut:"Ctrl+Alt+C",onClick:Km},{label:"Paste Styles",shortcut:"Ctrl+Alt+V",onClick:Qm},{separator:!0});const wt=C.selection.some(Ot=>C.elements.find(zt=>zt.id===Ot)?.locked);lt.push({label:wt?"Unlock":"Lock",shortcut:"Ctrl+Shift+L",onClick:()=>Zm(!wt)},{label:"Flip Horizontal",shortcut:"Shift+H",onClick:()=>Hf("horizontal")},{label:"Flip Vertical",shortcut:"Shift+V",onClick:()=>Hf("vertical")},{separator:!0},{label:"Delete",shortcut:"Delete",onClick:()=>pa(C.selection)},{separator:!0},{label:"Show Properties",onClick:()=>tm(!0)})}else lt.push({label:"Paste",shortcut:"Ctrl+V",onClick:Gf},{separator:!0},{label:"Select all",shortcut:"Ctrl+A",onClick:()=>Kt("selection",C.elements.map(ht=>ht.id))},{label:"Zoom to Fit",shortcut:"Shift+1",onClick:Z5},{separator:!0},{label:"Show Grid",checked:C.gridSettings.enabled,onClick:Q5},{label:"Snap to Grid",checked:C.gridSettings.snapToGrid,onClick:J5},{label:"Smart Snapping",checked:C.gridSettings.objectSnapping,onClick:()=>Kt("gridSettings","objectSnapping",!C.gridSettings.objectSnapping)},{separator:!0},{label:"Zen Mode",shortcut:"Alt+Z",checked:C.zenMode,onClick:nm},{label:"Reset View",onClick:()=>Or({scale:1,panX:0,panY:0})},{separator:!0},{label:"Canvas Settings",onClick:()=>If(!0)});return lt};return[(()=>{var v=Tx();v.$$contextmenu=lt=>{lt.preventDefault(),nt({x:lt.clientX,y:lt.clientY}),tt(!0)},v.addEventListener("drop",ee),v.addEventListener("dragover",Et),v.$$dblclick=Ge,v.$$pointerup=mn,v.$$pointermove=Te,v.$$pointerdown=cn,v.addEventListener("wheel",Gt);var Z=n;return typeof Z=="function"?Lo(Z,v):n=v,Ar(lt=>Ln(v,"cursor",I())),v})(),Re(rr,{get when(){return va(()=>C.canvasTexture!=="none"&&C.canvasTexture!=="grid")()&&C.canvasTexture!=="graph"},get children(){var v=Bx();return Ar(Z=>{var lt=C.theme==="dark"?.1:.4,ht=C.canvasTexture==="paper"?`url("data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\' opactiy=\'0.5\'/%3E%3C/svg%3E")`:C.canvasTexture==="dots"?`radial-gradient(${C.theme==="dark"?"#ffffff":"#000000"} 1px, transparent 1px)`:"none",Nt=C.canvasTexture==="dots"?"20px 20px":"auto";return lt!==Z.e&&Ln(v,"opacity",Z.e=lt),ht!==Z.t&&Ln(v,"background-image",Z.t=ht),Nt!==Z.a&&Ln(v,"background-size",Z.a=Nt),Z},{e:void 0,t:void 0,a:void 0}),v}}),Re(rr,{get when(){return Ee()},get children(){var v=Ex(),Z=v.firstChild;return Z.$$click=Ii,v}}),Re(rr,{get when(){return va(()=>!!h())()&&He()},children:v=>{const Z=He(),lt=T1(Z.id),ht=lt?lt.x:Z.x,Nt=lt?lt.y:Z.y,vt=lt?lt.width:Z.width,z=lt?lt.height:Z.height,{scale:Lt,panX:Ut,panY:wt}=C.viewState;let Ot=(ht+vt/2)*Lt+Ut,zt=(Nt+z/2)*Lt+wt,Dt="center",At=Z.fontSize||20;if(Z.type==="umlClass"){const Ft=d();if(Ft==="attributesText"||Ft==="methodsText"){Dt="left",At=At*.9;const se=n?n.getContext("2d"):null;let te=30;if(Z.containerText&&se){const le=Jr(se,Z,Z.containerText,Z.width-10);te=Math.max(30,le.textHeight+20)}let ae=te,$t=20;if(Z.attributesText&&se){const le=Jr(se,{...Z,fontSize:At},Z.attributesText,Z.width-10);$t=Math.max(20,le.textHeight+10)}if(Ft==="attributesText")zt=(Nt+ae+$t/2)*Lt+wt,Ot=(ht+vt/2)*Lt+Ut;else if(Ft==="methodsText"){const le=ae+$t;zt=(Nt+le+20)*Lt+wt,Ot=(ht+vt/2)*Lt+Ut}}}return(()=>{var Ft=Dx();Ft.$$keydown=te=>{te.key==="Escape"&&(te.preventDefault(),f(null),g(""))},Ft.addEventListener("blur",vn),Ft.$$input=te=>g(te.currentTarget.value);var se=w;return typeof se=="function"?Lo(se,Ft):w=Ft,Ln(Ft,"top",`${zt}px`),Ln(Ft,"left",`${Ot}px`),Ln(Ft,"text-align",Dt),Ar(te=>{var ae=`${At*Lt}px ${Z.fontFamily==="sans-serif"?"Inter, sans-serif":Z.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive"}`,$t=Z.strokeColor;return ae!==te.e&&Ln(Ft,"font",te.e=ae),$t!==te.t&&Ln(Ft,"color",te.t=$t),te},{e:void 0,t:void 0}),Ar(()=>Ft.value=y()),Ft})()}}),Re(rr,{get when(){return pt()},get children(){return Re(G1,{get x(){return H().x},get y(){return H().y},get items(){return ur()},onClose:()=>tt(!1)})}}),Re(rr,{get when(){return C.isRecording},get children(){return Re(Rx,{onStop:s})}}),Re(rr,{get when(){return C.pathEditState.isActive},get children(){return Re(Wx,{get elementId(){return C.pathEditState.elementId},get animationId(){return C.pathEditState.animationId},get scale(){return C.viewState.scale},get panX(){return C.viewState.panX},get panY(){return C.viewState.panY}})}}),Re(rr,{get when(){return C.minimapVisible},get children(){return Re(Ym,{get canvasWidth(){return n?.width||window.innerWidth},get canvasHeight(){return n?.height||window.innerHeight}})}})]},Wx=n=>{const t=si(()=>C.elements.find(r=>r.id===n.elementId)),e=si(()=>{const r=t();if(!r||!n.animationId)return[];const s=r.animations?.find(a=>a.id===n.animationId);return!s||s.type!=="path"?[]:Xs.svgToPoints(s.pathData)}),i=si(()=>{const r=t();if(!r)return`translate(${n.panX}, ${n.panY}) scale(${n.scale})`;const a=r.animations?.find(c=>c.id===n.animationId)?.isRelative??!0,o=a?r.x+r.width/2:0,l=a?r.y+r.height/2:0;return`translate(${n.panX}, ${n.panY}) scale(${n.scale}) translate(${o}, ${l})`});return Re(rr,{get when(){return va(()=>!!t())()&&e().length>0},get children(){var r=Fx(),s=r.firstChild,a=s.firstChild,o=s.nextSibling,l=o.nextSibling;return yn(r,Re(vu,{get each(){return e()},children:(c,h)=>{const f=t(),u=(f.animations?.find(x=>x.id===n.animationId)).isRelative??!0;let y=c.x,g=c.y;if(u){const x=f.x+f.width/2,_=f.y+f.height/2;y=x+c.x,g=_+c.y}const w=y*n.scale+n.panX,m=g*n.scale+n.panY;return(()=>{var x=$x();return x.$$pointerdown=_=>{_.stopPropagation(),_.currentTarget.setPointerCapture(_.pointerId);const L=_.clientX,T=_.clientY,q={...c},U=O=>{const X=(O.clientX-L)/n.scale,R=(O.clientY-T)/n.scale,M=[...e()];M[h()]={...M[h()],x:q.x+X,y:q.y+R};const $=Xs.pointsToSvg(M);Of(n.elementId,n.animationId,{pathData:$})},B=O=>{_.currentTarget.releasePointerCapture(O.pointerId),window.removeEventListener("pointermove",U),window.removeEventListener("pointerup",B),Sn()};window.addEventListener("pointermove",U),window.addEventListener("pointerup",B)},Ln(x,"left",`${w}px`),Ln(x,"top",`${m}px`),Ar(_=>{var L=c.type==="anchor"?"#3b82f6":"#ffffff",T=`Point ${h()}: ${c.type}`;return L!==_.e&&Ln(x,"background",_.e=L),T!==_.t&&qs(x,"title",_.t=T),_},{e:void 0,t:void 0}),x})()}}),s),o.$$pointerdown=c=>{c.stopPropagation();const h=t(),d=(h.animations?.find(_=>_.id===n.animationId)).isRelative??!0,u=(c.clientX-n.panX)/n.scale,y=(c.clientY-n.panY)/n.scale;let g=u,w=y;if(d){const _=h.x+h.width/2,L=h.y+h.height/2;g=u-_,w=y-L}const m=[...e()];m.push({x:g,y:w,type:"anchor"});const x=Xs.pointsToSvg(m);Of(n.elementId,n.animationId,{pathData:x})},l.$$click=()=>z5(!1),Ar(c=>{var h=t()?.animations?.find(d=>d.id===n.animationId)?.pathData||"",f=i();return h!==c.e&&qs(a,"d",c.e=h),f!==c.t&&qs(a,"transform",c.t=f),c},{e:void 0,t:void 0}),r}})};Zs(["pointerdown","pointermove","pointerup","dblclick","contextmenu","click","input","keydown"]);class ne{static adjustColor(t,e){return e&&(t==="#000000"||t==="black"||t==="#000")?"#ffffff":t}static shadeColor(t,e){if(t==="transparent"||t==="none"||!t)return t;let i,r,s;if(t.startsWith("#")){const c=t.slice(1);c.length===3||c.length===4?(i=parseInt(c[0]+c[0],16),r=parseInt(c[1]+c[1],16),s=parseInt(c[2]+c[2],16)):(i=parseInt(c.substring(0,2),16),r=parseInt(c.substring(2,4),16),s=parseInt(c.substring(4,6),16))}else if(t.startsWith("rgb")){const c=t.match(/(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)/);if(c)i=parseInt(c[1]),r=parseInt(c[2]),s=parseInt(c[3]);else return t}else return t;if(isNaN(i)||isNaN(r)||isNaN(s))return t;i=Math.min(255,Math.floor(i*e)),r=Math.min(255,Math.floor(r*e)),s=Math.min(255,Math.floor(s*e));const a=i.toString(16).padStart(2,"0"),o=r.toString(16).padStart(2,"0"),l=s.toString(16).padStart(2,"0");return"#"+a+o+l}static applyTransformations(t,e,i){t.save(),t.globalAlpha=(e.opacity??100)/100*i,e.blendMode&&(t.globalCompositeOperation=e.blendMode==="normal"?"source-over":e.blendMode),e.shadowEnabled?(t.shadowColor=e.shadowColor||"rgba(0,0,0,0.3)",t.shadowBlur=e.shadowBlur||10,t.shadowOffsetX=e.shadowOffsetX||5,t.shadowOffsetY=e.shadowOffsetY||5):t.shadowColor="transparent";let s=e.angle||0,a=e.x,o=e.y;const l=a+e.width/2,c=o+e.height/2;return s&&(t.translate(l,c),t.rotate(s),t.translate(-l,-c)),{cx:l,cy:c}}static restoreTransformations(t){t.restore()}static buildRenderOptions(t,e){const i=this.adjustColor(t.strokeColor,e);let r=t.backgroundColor==="transparent"?void 0:this.adjustColor(t.backgroundColor,e);["linear","radial","conic","dots"].includes(t.fillStyle)&&(r=void 0);const s=t.fillDensity||1,o=Math.max(.5,5/s);return{stroke:i,fill:r,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,hachureAngle:60,hachureGap:o,roughness:t.roughness??1,seed:t.seed||1,disableMultiStroke:t.roughness===0,strokeLineDash:t.strokeStyle==="dashed"?[8,8]:t.strokeStyle==="dotted"?[2,4]:void 0}}static applyComplexFills(t,e,i){const{ctx:r,element:s}=t,a=s.fillStyle,o=["linear","radial","conic"].includes(a)||s.gradientType!=="none"&&s.gradientType!==void 0,l=a==="dots";if(!o&&!l)return;r.save(),r.translate(e,i),o?(r.beginPath(),this.applyGradient(r,s)):l&&(r.beginPath(),this.applyDotsFill(r,s,t.isDarkMode));const c=ya(s);c&&(this.renderGeometry(r,c),r.fill()),r.restore()}static applyGradient(t,e){const i=e.width,r=e.height,s=i/2,a=r/2,o=e.gradientType||e.fillStyle||"linear";let l;if(o==="linear"){const c=(e.gradientDirection||45)*(Math.PI/180),h=Math.sqrt(s**2+a**2),f=-Math.cos(c)*h,d=-Math.sin(c)*h,u=Math.cos(c)*h,y=Math.sin(c)*h;l=t.createLinearGradient(f,d,u,y)}else if(o==="radial"){const c=(e.gradientDirection||0)*(Math.PI/180),h=Math.max(i,r)/2,f=h*.4,d=Math.cos(c)*f,u=Math.sin(c)*f;l=t.createRadialGradient(d,u,0,0,0,h)}else if(o==="conic"){const c=(e.gradientDirection||0)*(Math.PI/180);l=t.createConicGradient(c,0,0)}else l=t.createLinearGradient(-s,-a,s,a);e.gradientStops&&e.gradientStops.length>0?[...e.gradientStops].sort((c,h)=>c.offset-h.offset).forEach(c=>l.addColorStop(c.offset,c.color)):e.gradientStart&&e.gradientEnd&&(l.addColorStop(0,e.gradientStart),l.addColorStop(1,e.gradientEnd)),t.fillStyle=l}static applyDotsFill(t,e,i){const r=e.fillDensity||1,s=i?"#ffffff":"#000000",a=document.createElement("canvas"),o=Math.max(5,20/r);a.width=o,a.height=o;const l=a.getContext("2d");if(l){l.fillStyle=s,l.beginPath(),l.arc(o/2,o/2,e.strokeWidth/2||1,0,Math.PI*2),l.fill();const c=t.createPattern(a,"repeat");c&&(t.fillStyle=c)}}static renderGeometry(t,e){if(e.type==="rect")t.roundRect(e.x,e.y,e.w,e.h,e.r||0);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx,e.ry,0,0,Math.PI*2);else if(e.type==="points"){if(e.points.length>0){t.moveTo(e.points[0].x,e.points[0].y);for(let i=1;i<e.points.length;i++)t.lineTo(e.points[i].x,e.points[i].y);e.isClosed!==!1&&t.closePath()}}else e.type==="path"?t.fill(new Path2D(e.path)):e.type==="multi"&&e.shapes.forEach(i=>this.renderGeometry(t,i))}static renderText(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t;if(s.isEditing)return;const o=s.containerText||s.text;if(!o)return;r.save();let l=s.width-20,c=0;s.type==="doubleBanner"?(l=s.width*.65,c=-(s.height*.1)):s.type==="starPerson"?c=s.height*.15:s.type==="lightbulb"?(l=s.width*.7,c=-(s.height*.1)):s.type==="signpost"?(l=s.width*.8,c=-(s.height*.15)):s.type==="browserWindow"?c=Math.min(s.height*.15,30)/2:s.type==="mobilePhone"&&(c=-(s.height*.05));const h=Jr(r,s,o,l);r.font=xc(s);const f=s.textColor||s.strokeColor,d=this.adjustColor(f,a),u=s.textAlign||"center";r.textAlign=u,r.textBaseline="middle";const y=i-h.textHeight/2+h.lineHeight/2+c,g=s.fontFamily==="hand-drawn"?2:0,w=y+g,m=()=>u==="left"?e-(s.width||l)/2+10:u==="right"?e+(s.width||l)/2-10:e;if(s.textHighlightEnabled){const x=s.textHighlightColor||"rgba(255, 255, 0, 0.4)",_=s.textHighlightPadding??4,L=s.textHighlightRadius??2;r.fillStyle=this.adjustColor(x,a),h.lines.forEach((T,q)=>{const U=w+q*h.lineHeight,B=r.measureText(T).width,O=m(),X=_/2;let R=O-B/2-_;u==="left"?R=O-_:u==="right"&&(R=O-B-_),r.beginPath(),r.roundRect?r.roundRect(R,U-h.lineHeight/2-X,B+_*2,h.lineHeight+X*2,L):r.rect(R,U-h.lineHeight/2-X,B+_*2,h.lineHeight+X*2),r.fill()})}r.fillStyle=d,h.lines.forEach((x,_)=>{const L=w+_*h.lineHeight,T=m();r.fillText(x,T,L,s.width-10)}),r.restore()}}class hr{render(t){const{ctx:e,element:i,layerOpacity:r}=t;if(i.points&&i.points.length>0){this.renderCustomPoints(t);return}const{cx:s,cy:a}=ne.applyTransformations(e,i,r),o=i.drawProgress;o!==void 0&&o>=0&&o<100?this.renderDrawProgress(t,s,a):(ne.applyComplexFills(t,s,a),i.renderStyle==="architectural"?this.renderArchitectural(t,s,a):this.renderSketch(t,s,a)),i.flowAnimation&&this.renderFlowAnimation(t),ne.restoreTransformations(e)}renderDrawProgress(t,e,i){const{ctx:r,element:s,isDarkMode:a,layerOpacity:o}=t,l=(s.drawProgress??0)/100;r.globalAlpha=o;const c=Math.min(1,l/.7),h=Math.max(0,Math.min(1,(l-.65)/.25)),f=Math.max(0,Math.min(1,(l-.85)/.15)),d=this.estimatePathLength(s),u=ne.adjustColor(s.strokeColor,a);if(c>0){r.save(),r.strokeStyle=u,r.lineWidth=s.strokeWidth,r.lineCap="round",r.lineJoin="round";const y=d*c;r.setLineDash([y,d]),r.lineDashOffset=0,r.beginPath(),this.definePath(r,s),r.stroke(),r.restore()}if(h>0){const y=s.backgroundColor;if(y&&y!=="transparent"&&y!=="none"){r.save(),r.globalAlpha*=h;const g=s.fillStyle;["linear","radial","conic","dots"].includes(g)?ne.applyComplexFills(t,e,i):(r.fillStyle=ne.adjustColor(y,a),r.beginPath(),this.definePath(r,s),r.fill()),r.restore()}}f>0&&(r.save(),r.globalAlpha*=f,ne.renderText(t,e,i),r.restore())}estimatePathLength(t){return 2*(Math.abs(t.width)+Math.abs(t.height))}renderCustomPoints(t){const{ctx:e,element:i,isDarkMode:r,layerOpacity:s}=t;console.log("[renderCustomPoints] Rendering custom points:",i.id,i.points?.length),e.save(),e.globalAlpha=s*(i.opacity??1);const a=this.normalizePoints(i.points);if(a.length===0)return;const o=i.x+i.width/2,l=i.y+i.height/2,c=a.map(h=>({x:h.x+o,y:h.y+l}));if(c.length>=3&&console.log("[renderCustomPoints] First 3 absolute points:",[{x:c[0].x,y:c[0].y},{x:c[1].x,y:c[1].y},{x:c[2].x,y:c[2].y}]),console.log("[renderCustomPoints] Element center:",{cx:o,cy:l}),e.save(),e.globalAlpha=s*(i.opacity??1),i.backgroundColor&&i.backgroundColor!=="transparent"&&i.backgroundColor!=="none"){e.fillStyle=ne.adjustColor(i.backgroundColor,r),e.beginPath(),e.moveTo(c[0].x,c[0].y);for(let h=1;h<c.length;h++)e.lineTo(c[h].x,c[h].y);e.closePath(),e.fill()}e.strokeStyle=ne.adjustColor(i.strokeColor,r),e.lineWidth=i.strokeWidth,e.beginPath(),e.moveTo(c[0].x,c[0].y);for(let h=1;h<c.length;h++)e.lineTo(c[h].x,c[h].y);e.closePath(),e.stroke(),e.restore()}normalizePoints(t){if(!t||t.length===0)return[];if(typeof t[0]=="object"&&"x"in t[0])return t;const e=[];for(let i=0;i<t.length-1;i+=2)e.push({x:t[i],y:t[i+1]});return e}renderFlowAnimation(t){const{ctx:e,element:i,isDarkMode:r}=t,s=i.flowSpeed!==void 0?i.flowSpeed:1,a=am(),o=a/20*s;e.save(),e.strokeStyle=ne.adjustColor(i.flowColor||i.strokeColor,r),e.lineWidth=Math.max(1,i.strokeWidth*.8),e.lineCap="round",e.lineJoin="round";const l=i.flowStyle||"dashes";if(l==="dots")e.setLineDash([2,8]);else if(l==="pulse"){const c=Math.sin(a/200)*.5+.5;e.globalAlpha*=c,e.setLineDash([])}else e.setLineDash([8,8]);e.lineDashOffset=-o,e.beginPath(),this.definePath(e,i),e.stroke(),e.restore()}}class qx extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);if(this.drawRectArch(r,s.x,s.y,s.width,s.height,o,s.strokeWidth,l.stroke,l.fill),s.drawInnerBorder){const c=s.innerBorderDistance||5;if(s.width>c*2&&s.height>c*2){const h=Math.max(0,o-c);this.drawRectArch(r,s.x+c,s.y+c,s.width-c*2,s.height-c*2,h,s.strokeWidth,s.innerBorderColor||l.stroke,"none")}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);if(this.drawRectSketch(r,s.x,s.y,s.width,s.height,o,l),s.drawInnerBorder){const c=s.innerBorderDistance||5;if(s.width>c*2&&s.height>c*2){const h=Math.max(0,o-c),f={...l,stroke:s.innerBorderColor||l.stroke,fill:"none"};this.drawRectSketch(r,s.x+c,s.y+c,s.width-c*2,s.height-c*2,h,f)}}ne.renderText(t,e,i)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.15:0}drawRectArch(t,e,i,r,s,a,o,l,c){c&&c!=="transparent"&&c!=="none"&&(t.beginPath(),a>0?t.roundRect(e,i,r,s,a):t.rect(e,i,r,s),t.fillStyle=c,t.fill()),t.beginPath(),a>0?t.roundRect(e,i,r,s,a):t.rect(e,i,r,s),t.strokeStyle=l,t.lineWidth=o,t.stroke()}drawRectSketch(t,e,i,r,s,a,o){if(a>0){const l=this.getRoundedRectPath(e,i,r,s,a);t.path(l,o)}else t.rectangle(e,i,r,s,o)}getRoundedRectPath(t,e,i,r,s){const a=Math.min(Math.abs(i)/2,s),o=Math.min(Math.abs(r)/2,s);return`M ${t+a} ${e} L ${t+i-a} ${e} Q ${t+i} ${e} ${t+i} ${e+o} L ${t+i} ${e+r-o} Q ${t+i} ${e+r} ${t+i-a} ${e+r} L ${t+a} ${e+r} Q ${t} ${e+r} ${t} ${e+r-o} L ${t} ${e+o} Q ${t} ${e} ${t+a} ${e}`}definePath(t,e){const i=this.getRadius(e);i>0?t.roundRect(e.x,e.y,e.width,e.height,i):t.rect(e.x,e.y,e.width,e.height)}}class Xx extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a);if(this.drawCircleArch(r,s.x,s.y,s.width,s.height,s.strokeWidth,o.stroke,o.fill),s.drawInnerBorder){const l=s.innerBorderDistance||5;s.width>l*2&&s.height>l*2&&this.drawCircleArch(r,s.x+l,s.y+l,s.width-l*2,s.height-l*2,s.strokeWidth,s.innerBorderColor||o.stroke,"none")}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a);if(r.ellipse(s.x+s.width/2,s.y+s.height/2,Math.abs(s.width),Math.abs(s.height),o),s.drawInnerBorder){const l=s.innerBorderDistance||5;if(s.width>l*2&&s.height>l*2){const c={...o,stroke:s.innerBorderColor||o.stroke,fill:"none"};r.ellipse(s.x+s.width/2,s.y+s.height/2,Math.abs(s.width)-l*2,Math.abs(s.height)-l*2,c)}}ne.renderText(t,e,i)}drawCircleArch(t,e,i,r,s,a,o,l){const c=e+r/2,h=i+s/2,f=Math.abs(r)/2,d=Math.abs(s)/2;l&&l!=="transparent"&&l!=="none"&&(t.beginPath(),t.ellipse(c,h,f,d,0,0,Math.PI*2),t.fillStyle=l,t.fill()),t.beginPath(),t.ellipse(c,h,f,d,0,0,Math.PI*2),t.strokeStyle=o,t.lineWidth=a,t.stroke()}definePath(t,e){const i=e.x+e.width/2,r=e.y+e.height/2,s=Math.abs(e.width)/2,a=Math.abs(e.height)/2;t.ellipse(i,r,s,a,0,0,Math.PI*2)}estimatePathLength(t){const e=Math.abs(t.width)/2,i=Math.abs(t.height)/2,r=(e-i)**2/((e+i)**2||1);return Math.PI*(e+i)*(1+3*r/(10+Math.sqrt(4-3*r)))}}class Gx extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);if(this.drawDiamondArch(r,s.x,s.y,s.width,s.height,o,s.strokeWidth,l.stroke,l.fill),s.drawInnerBorder){const c=s.innerBorderDistance||5;if(s.width>c*2&&s.height>c*2){const h=Math.max(0,o-c);this.drawDiamondArch(r,s.x+c,s.y+c,s.width-c*2,s.height-c*2,h,s.strokeWidth,s.innerBorderColor||l.stroke,"none")}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);if(o>0){const c=this.getRoundedDiamondPath(s.x,s.y,s.width,s.height,o);r.path(c,l)}else{const c=s.width/2,h=s.height/2,f=[[s.x+c,s.y],[s.x+s.width,s.y+h],[s.x+c,s.y+s.height],[s.x,s.y+h]];r.polygon(f,l)}if(s.drawInnerBorder){const c=s.innerBorderDistance||5;if(s.width>c*2&&s.height>c*2){const h=Math.max(0,o-c),f={...l,stroke:s.innerBorderColor||l.stroke,fill:"none"};if(h>0){const d=this.getRoundedDiamondPath(s.x+c,s.y+c,s.width-c*2,s.height-c*2,h);r.path(d,f)}else{const d=(s.width-c*2)/2,u=(s.height-c*2)/2,y=s.x+c,g=s.y+c,w=s.width-c*2,m=s.height-c*2,x=[[y+d,g],[y+w,g+u],[y+d,g+m],[y,g+u]];r.polygon(x,f)}}}ne.renderText(t,e,i)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.2:0}drawDiamondArch(t,e,i,r,s,a,o,l,c){const h=r/2,f=s/2,d=e+h,u=i+f;if(c&&c!=="transparent"&&c!=="none")if(t.beginPath(),a>0){const y=this.getRoundedDiamondPath(e,i,r,s,a);t.fill(new Path2D(y))}else t.moveTo(d,i),t.lineTo(e+r,u),t.lineTo(d,i+s),t.lineTo(e,u),t.closePath(),t.fillStyle=c,t.fill();if(t.beginPath(),a>0){const y=this.getRoundedDiamondPath(e,i,r,s,a);t.stroke(new Path2D(y))}else t.moveTo(d,i),t.lineTo(e+r,u),t.lineTo(d,i+s),t.lineTo(e,u),t.closePath(),t.strokeStyle=l,t.lineWidth=o,t.stroke()}getRoundedDiamondPath(t,e,i,r,s){const a=i/2,o=r/2,l=t+a,c=e+o,h=Math.hypot(a,o),d=Math.min(s,h/2)/h,u=a*d,y=o*d,g={x:l-u,y:e+y},w={x:l+u,y:e+y},m={x:t+i-u,y:c-y},x={x:t+i-u,y:c+y},_={x:l+u,y:e+r-y},L={x:l-u,y:e+r-y},T={x:t+u,y:c+y},q={x:t+u,y:c-y};return`M ${g.x} ${g.y} Q ${l} ${e} ${w.x} ${w.y} L ${m.x} ${m.y} Q ${t+i} ${c} ${x.x} ${x.y} L ${_.x} ${_.y} Q ${l} ${e+r} ${L.x} ${L.y} L ${T.x} ${T.y} Q ${t} ${c} ${q.x} ${q.y} Z`}definePath(t,e){const i=this.getRadius(e);if(i>0)this.executePath(t,e.x,e.y,e.width,e.height,i);else{const r=e.width/2,s=e.height/2;t.moveTo(e.x+r,e.y),t.lineTo(e.x+e.width,e.y+s),t.lineTo(e.x+r,e.y+e.height),t.lineTo(e.x,e.y+s),t.closePath()}}executePath(t,e,i,r,s,a){const o=r/2,l=s/2,c=e+o,h=i+l,f=Math.hypot(o,l),u=Math.min(a,f/2)/f,y=o*u,g=l*u,w={x:c-y,y:i+g},m={x:c+y,y:i+g},x={x:e+r-y,y:h-g},_={x:e+r-y,y:h+g},L={x:c+y,y:i+s-g},T={x:c-y,y:i+s-g},q={x:e+y,y:h+g},U={x:e+y,y:h-g};t.moveTo(w.x,w.y),t.quadraticCurveTo(c,i,m.x,m.y),t.lineTo(x.x,x.y),t.quadraticCurveTo(e+r,h,_.x,_.y),t.lineTo(L.x,L.y),t.quadraticCurveTo(c,i+s,T.x,T.y),t.lineTo(q.x,q.y),t.quadraticCurveTo(e,h,U.x,U.y),t.closePath()}}class Hx extends hr{renderArchitectural(t,e,i){this.renderCommon(t)}renderSketch(t,e,i){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:i,isDarkMode:r}=t;if(!i.text)return;const s=i.fontSize||20,a=i.fontFamily==="sans-serif"?"Inter, sans-serif":i.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",o=i.fontWeight===!0||i.fontWeight==="bold"?"bold ":"",l=i.fontStyle===!0||i.fontStyle==="italic"?"italic ":"";e.save(),e.font=`${l}${o}${s}px ${a}`;const h=e.measureText(i.text).width,f=i.width&&h&&!i.textHighlightEnabled?i.width/h:1,d=i.textColor||i.strokeColor,u=ne.adjustColor(d,r),y=i.textAlign||"left";if(e.textAlign=y,e.textBaseline="hanging",i.textHighlightEnabled){const g=i.textHighlightColor||"rgba(255, 255, 0, 0.4)",w=i.textHighlightPadding??4,m=i.textHighlightRadius??2;e.fillStyle=ne.adjustColor(g,r);const x=i.text.split(`\n`),_=s*1.2,L=i.fontFamily==="hand-drawn"?-2:0,T=q=>y==="center"?i.x+(i.width||q)/2:y==="right"?i.x+(i.width||q):i.x;x.forEach((q,U)=>{const B=e.measureText(q).width,O=T(B),X=i.y+U*_+L,R=w/2;e.beginPath(),e.roundRect?e.roundRect(O-(y==="center"?B/2:0)-w,X-R,B+w*2,_+R*2,m):e.rect(O-(y==="center"?B/2:0)-w,X-R,B+w*2,_+R*2),e.fill()}),e.fillStyle=u,x.forEach((q,U)=>{const B=e.measureText(q).width,O=T(B),X=i.y+U*_;e.fillText(q,O,X)})}else{e.fillStyle=u;let g=i.x;y==="center"?g=i.x+(i.width||h)/2:y==="right"&&(g=i.x+(i.width||h)),f!==1?(e.translate(g,i.y),e.scale(f,1),e.fillText(i.text,0,0)):e.fillText(i.text,g,i.y)}e.restore()}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Yx extends hr{renderArchitectural(t,e,i){this.renderCommon(t)}renderSketch(t,e,i){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:i}=t;if(!i.dataURL)return;const r=H1(i.dataURL);r?e.drawImage(r,i.x,i.y,i.width,i.height):(e.save(),e.fillStyle="#e5e5e5",e.fillRect(i.x,i.y,i.width,i.height),e.fillStyle="#999",e.font="12px sans-serif",e.fillText("Loading image...",i.x+10,i.y+20),e.restore())}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Vx extends hr{renderArchitectural(t,e,i){const{rc:r,ctx:s,element:a,isDarkMode:o}=t,l=ne.buildRenderOptions(a,o),{mainPoints:c,foldPoints:h}=this.getPoints(a);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(r.polygon(c,{...l,stroke:"none",fill:l.fill}),r.polygon(h,{...l,stroke:"none",fill:l.fill,fillStyle:"solid"})),s.beginPath(),s.moveTo(c[0][0],c[0][1]);for(let d=1;d<c.length;d++)s.lineTo(c[d][0],c[d][1]);s.closePath(),s.strokeStyle=ne.adjustColor(a.strokeColor,o),s.lineWidth=a.strokeWidth,s.stroke(),s.beginPath(),s.moveTo(h[0][0],h[0][1]),s.lineTo(h[1][0],h[1][1]),s.lineTo(h[2][0],h[2][1]),s.stroke(),ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),{mainPoints:l,foldPoints:c}=this.getPoints(s);r.polygon(l,o),r.polygon(c,{...o,fillStyle:"solid"}),ne.renderText(t,e,i)}getPoints(t){const e=Math.min(Math.abs(t.width),Math.abs(t.height))*.15,i=t.x,r=t.y,s=t.width,a=t.height,o=[[i,r],[i+s,r],[i+s,r+a-e],[i+s-e,r+a],[i,r+a]],l=[[i+s,r+a-e],[i+s-e,r+a-e],[i+s-e,r+a]];return{mainPoints:o,foldPoints:l}}definePath(t,e){const{mainPoints:i,foldPoints:r}=this.getPoints(e);t.moveTo(i[0][0],i[0][1]);for(let s=1;s<i.length;s++)t.lineTo(i[s][0],i[s][1]);t.closePath(),t.moveTo(r[0][0],r[0][1]),t.lineTo(r[1][0],r[1][1]),t.lineTo(r[2][0],r[2][1])}}class Zx extends hr{renderArchitectural(t,e,i){const{element:r}=t;if(this.drawPolygon(t,r.x,r.y,r.width,r.height),r.drawInnerBorder){const s=r.innerBorderDistance||5;r.width>s*2&&r.height>s*2&&this.drawPolygon(t,r.x+s,r.y+s,r.width-s*2,r.height-s*2,!0)}ne.renderText(t,e,i)}renderSketch(t,e,i){const{element:r}=t;if(this.drawPolygon(t,r.x,r.y,r.width,r.height),r.drawInnerBorder){const s=r.innerBorderDistance||5;r.width>s*2&&r.height>s*2&&this.drawPolygon(t,r.x+s,r.y+s,r.width-s*2,r.height-s*2,!0)}ne.renderText(t,e,i)}drawPolygon(t,e,i,r,s,a=!1){const{ctx:o,rc:l,element:c,isDarkMode:h}=t,f=this.getPoints(c,e,i,r,s),d=ne.buildRenderOptions(c,h),u=ne.adjustColor(c.strokeColor,h),y=a?{...d,stroke:c.innerBorderColor||u,fill:"none"}:d;if(c.renderStyle==="architectural"){const g=d.fill&&d.fill!=="transparent"&&d.fill!=="none";!a&&g&&c.fillStyle!=="dots"&&l.polygon(f,{...y,stroke:"none",fill:d.fill}),o.beginPath(),o.moveTo(f[0][0],f[0][1]);for(let w=1;w<f.length;w++)o.lineTo(f[w][0],f[w][1]);o.closePath(),o.strokeStyle=a&&c.innerBorderColor||u,o.lineWidth=c.strokeWidth,o.lineJoin=c.strokeLineJoin||"round",o.stroke()}else l.polygon(f,y)}getPoints(t,e,i,r,s){const a=e+r/2,o=i+s/2,l=r/2,c=s/2;switch(t.type){case"triangle":return[[a,i],[e+r,i+s],[e,i+s]];case"hexagon":return this.getRegularPolyPoints(a,o,l,c,6);case"octagon":return this.getRegularPolyPoints(a,o,l,c,8);case"parallelogram":{const h=r*.2;return[[e+h,i],[e+r,i],[e+r-h,i+s],[e,i+s]]}case"trapezoid":{const h=r*.2;return[[e+h,i],[e+r-h,i],[e+r,i+s],[e,i+s]]}case"rightTriangle":return[[e,i],[e,i+s],[e+r,i+s]];case"pentagon":return this.getRegularPolyPoints(a,o,l,c,5);case"septagon":return this.getRegularPolyPoints(a,o,l,c,7);case"polygon":return this.getRegularPolyPoints(a,o,l,c,t.polygonSides||6);default:return[[e,i],[e+r,i],[e+r,i+s],[e,i+s]]}}getRegularPolyPoints(t,e,i,r,s){const a=[];for(let o=0;o<s;o++){const l=2*Math.PI/s*o-Math.PI/2;a.push([t+i*Math.cos(l),e+r*Math.sin(l)])}return a}definePath(t,e){const i=this.getPoints(e,e.x,e.y,e.width,e.height);if(!(i.length<2)){t.moveTo(i[0][0],i[0][1]);for(let r=1;r<i.length;r++)t.lineTo(i[r][0],i[r][1]);t.closePath()}}estimatePathLength(t){const e=this.getPoints(t,t.x,t.y,t.width,t.height);if(e.length<2)return 0;let i=0;for(let r=0;r<e.length;r++){const s=e[(r+1)%e.length],a=s[0]-e[r][0],o=s[1]-e[r][1];i+=Math.sqrt(a*a+o*o)}return i}}class Kx extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.adjustColor(s.strokeColor,a),l=s.backgroundColor==="transparent"?void 0:ne.adjustColor(s.backgroundColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"database":{const u=d*.2,y=this.getDatabasePath(c,h,f,d,u),g=this.getDatabaseTopPath(c,h,f,d,u);l&&(r.fillStyle=l,r.fill(new Path2D(y))),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.stroke(new Path2D(y)),r.stroke(new Path2D(g));break}case"document":{const u=d*.1,y=this.getDocumentPath(c,h,f,d,u);l&&(r.fillStyle=l,r.fill(new Path2D(y))),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.lineJoin="round",r.stroke(new Path2D(y));break}case"predefinedProcess":{const u=f*.1;l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d),r.beginPath(),r.moveTo(c+u,h),r.lineTo(c+u,h+d),r.moveTo(c+f-u,h),r.lineTo(c+f-u,h+d),r.stroke();break}case"internalStorage":{const u=Math.min(f,d)*.15;l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d),r.beginPath(),r.moveTo(c+u,h),r.lineTo(c+u,h+d),r.moveTo(c,h+u),r.lineTo(c+f,h+u),r.stroke();break}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=s.x,c=s.y,h=s.width,f=s.height;switch(s.type){case"database":{const d=f*.2;r.path(this.getDatabasePath(l,c,h,f,d),o),r.path(this.getDatabaseTopPath(l,c,h,f,d),o);break}case"document":{const d=f*.1;r.path(this.getDocumentPath(l,c,h,f,d),o);break}case"predefinedProcess":{const d=h*.1;r.rectangle(l,c,h,f,o),r.line(l+d,c,l+d,c+f,o),r.line(l+h-d,c,l+h-d,c+f,o);break}case"internalStorage":{const d=Math.min(h,f)*.15;r.rectangle(l,c,h,f,o),r.line(l+d,c,l+d,c+f,o),r.line(l,c+d,l+h,c+d,o);break}}ne.renderText(t,e,i)}getDatabasePath(t,e,i,r,s){return`\n            M ${t} ${e+s/2}\n            L ${t} ${e+r-s/2}\n            A ${i/2} ${s/2} 0 0 0 ${t+i} ${e+r-s/2}\n            L ${t+i} ${e+s/2}\n            A ${i/2} ${s/2} 0 0 0 ${t} ${e+s/2}\n            A ${i/2} ${s/2} 0 0 0 ${t+i} ${e+s/2}\n        `}getDatabaseTopPath(t,e,i,r,s){return`\n            M ${t} ${e+s/2}\n            A ${i/2} ${s/2} 0 1 1 ${t+i} ${e+s/2}\n            A ${i/2} ${s/2} 0 1 1 ${t} ${e+s/2}\n        `}getDocumentPath(t,e,i,r,s){return`\n            M ${t} ${e}\n            L ${t+i} ${e}\n            L ${t+i} ${e+r-s}\n            Q ${t+i*.75} ${e+r-s*2} ${t+i*.5} ${e+r-s}\n            T ${t} ${e+r-s}\n            Z\n        `}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Qx extends hr{renderArchitectural(t,e,i){const{ctx:r,rc:s,element:a,isDarkMode:o}=t,l=ne.buildRenderOptions(a,o),c=ne.adjustColor(a.strokeColor,o),h=a.x,f=a.y,d=a.width,u=a.height;switch(a.type){case"starPerson":{const y=Math.min(Math.abs(d),Math.abs(u))*.15,g=h+d/2,w=f+y,m=this.getStarPersonBodyPoints(h,f,d,u,y);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(s.ellipse(g,w,y*2,y*2,{...l,stroke:"none",fill:l.fill}),s.polygon(m,{...l,stroke:"none",fill:l.fill})),r.beginPath(),r.ellipse(g,w,y,y,0,0,Math.PI*2),r.moveTo(m[0][0],m[0][1]);for(let x=1;x<m.length;x++)r.lineTo(m[x][0],m[x][1]);r.strokeStyle=c,r.lineWidth=a.strokeWidth,r.stroke();break}case"lightbulb":{const y=Math.min(d,u/1.5)/2,g=d*.4,w=u*.25,m=f+u-w,x=this.getLightbulbPath(h,f,d,y,g,m);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(r.fillStyle=l.fill,r.fill(new Path2D(x)),r.fillRect(h+d/2-g/2,m,g,w)),r.strokeStyle=c,r.lineWidth=a.strokeWidth,r.stroke(new Path2D(x)),r.strokeRect(h+d/2-g/2,m,g,w);break}case"signpost":{const y=Math.max(4,d*.05),g=u*.3,w=d*.9,m=f+u*.1,x=h+d/2-y/2,_=h+d/2-w/2;l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(r.fillStyle=l.fill,r.fillRect(x,f,y,u),r.fillRect(_,m,w,g)),r.strokeStyle=c,r.lineWidth=a.strokeWidth,r.strokeRect(x,f,y,u),r.strokeRect(_,m,w,g);break}case"burstBlob":{const y=this.getBurstBlobPath(a);l.fill&&l.fill!=="transparent"&&l.fill!=="none"&&(r.fillStyle=l.fill,r.fill(new Path2D(y))),r.strokeStyle=c,r.lineWidth=a.strokeWidth,r.stroke(new Path2D(y)),r.stroke(new Path2D(y));break}case"wavyDivider":{const y=this.getWavyDividerPath(h,f,d,u);r.strokeStyle=c,r.lineWidth=a.strokeWidth,r.stroke(new Path2D(y));break}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=s.x,c=s.y,h=s.width,f=s.height;switch(s.type){case"starPerson":{const d=Math.min(Math.abs(h),Math.abs(f))*.15;r.ellipse(l+h/2,c+d,d*2,d*2,o),r.polygon(this.getStarPersonBodyPoints(l,c,h,f,d),o);break}case"lightbulb":{const d=Math.min(h,f/1.5)/2,u=h*.4,y=f*.25,g=c+f-y;r.path(this.getLightbulbPath(l,c,h,d,u,g),o),r.rectangle(l+h/2-u/2,g,u,y,o);break}case"signpost":{const d=Math.max(4,h*.05),u=f*.3,y=h*.9,g=c+f*.1;r.rectangle(l+h/2-d/2,c,d,f,{...o,fill:"none"}),r.rectangle(l+h/2-y/2,g,y,u,o);break}case"burstBlob":{r.path(this.getBurstBlobPath(s),o);break}case"wavyDivider":{r.path(this.getWavyDividerPath(l,c,h,f),o);break}}ne.renderText(t,e,i)}getStarPersonBodyPoints(t,e,i,r,s){const a=t+i/2;return[[a,e+s*2],[t,e+r*.4],[a,e+r*.5],[t+i,e+r*.4],[a,e+s*2],[t+i*.8,e+r],[a,e+r*.7],[t+i*.2,e+r],[a,e+s*2]]}getLightbulbPath(t,e,i,r,s,a){const o=t+i/2;return`\n            M ${o-s/2} ${a}\n            C ${o-s/2} ${e+r} ${t} ${e+r*1.5} ${t} ${e+r}\n            A ${r} ${r} 0 1 1 ${t+i} ${e+r}\n            C ${t+i} ${e+r*1.5} ${o+s/2} ${e+r} ${o+s/2} ${a}\n            Z\n        `}getWavyDividerPath(t,e,i,r){const s=e+r/2,a=4,o=i/a;let l=`M ${t} ${s}`;for(let c=0;c<a;c++){const h=t+c*o;l+=` Q ${h+o/4} ${s-r/2}, ${h+o/2} ${s}`,l+=` Q ${h+o*.75} ${s+r/2}, ${h+o} ${s}`}return l}getBurstBlobPath(t){const e=t.x,i=t.y,r=t.width,s=t.height,a=e+r/2,o=i+s/2,l=r/2,c=s/2,h=12,f=Math.min(l,c),d=f*.6,u=t.seed||1,y=w=>{let m=w+=1831565813;return m=Math.imul(m^m>>>15,m|1),m^=m+Math.imul(m^m>>>7,m|61),((m^m>>>14)>>>0)/4294967296};let g="";for(let w=0;w<h*2;w++){const m=w%2===0?f:d,x=y(u+w),_=m+(x-.5)*(f*.1),L=Math.PI*w/h,T=a+Math.cos(L)*(r/s)*_,q=o+Math.sin(L)*_;g+=(w===0?"M ":" L ")+T+" "+q}return g+" Z"}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}}class Jx extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.adjustColor(s.strokeColor,a),l=s.backgroundColor==="transparent"?void 0:ne.adjustColor(s.backgroundColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"server":{l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d);const u=d*.05,y=f*.7,g=c+(f-y)/2;r.fillStyle=o;for(let w=0;w<3;w++)r.fillRect(g,h+d-(w+1)*u*2-u,y,u);break}case"loadBalancer":{const u=c+f/2,y=h+d/2;l&&(r.fillStyle=l,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.stroke();const g=f*.3;r.beginPath(),r.moveTo(u-g,y),r.lineTo(u+g,y),r.stroke(),this.drawArchArrowhead(r,u+g,y,0),this.drawArchArrowhead(r,u-g,y,Math.PI);break}case"firewall":{l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d);const u=4,y=3,g=d/u,w=f/y;r.beginPath();for(let m=1;m<u;m++)r.moveTo(c,h+m*g),r.lineTo(c+f,h+m*g);for(let m=0;m<u;m++){const x=m%2===0?0:w/2;for(let _=1;_<y;_++){const L=c+_*w+x;L<c+f&&(r.moveTo(L,h+m*g),r.lineTo(L,h+(m+1)*g))}}r.stroke();break}case"user":{const u=Math.min(f,d)*.25,y=c+f/2;l&&(r.fillStyle=l,r.beginPath(),r.arc(y,h+u,u,0,Math.PI*2),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.beginPath(),r.arc(y,h+u,u,0,Math.PI*2),r.stroke();const g=f*.8;r.beginPath(),r.moveTo(y-g/2,h+d),r.quadraticCurveTo(y,h+u*1.5,y+g/2,h+d),r.stroke();break}case"messageQueue":{l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d);const u=4,y=f/u;r.beginPath();for(let g=1;g<u;g++)r.moveTo(c+g*y,h),r.lineTo(c+g*y,h+d);r.stroke();break}case"lambda":{const u=c+f/2,y=h+d/2,g=f*.4,w=d*.6,m=u-g/2,x=y-w/2,_=`M ${m+g} ${x} L ${m} ${x+w*.6} L ${m+g*.6} ${x+w*.5} L ${m} ${x+w} L ${m+g} ${x+w*.4} L ${m+g*.4} ${x+w*.5} Z`;l&&(r.fillStyle=l,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.stroke(),r.fillStyle=o,r.fill(new Path2D(_));break}case"router":{const u=c+f/2,y=h+d/2;l&&(r.fillStyle=l,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.beginPath(),r.ellipse(u,y,f/2,d/2,0,0,Math.PI*2),r.stroke();const g=Math.min(f,d)*.3;r.beginPath();for(let w=0;w<4;w++){const m=Math.PI/2*w+Math.PI/4;r.moveTo(u,y),r.lineTo(u+g*Math.cos(m),y+g*Math.sin(m))}r.stroke();break}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=ne.adjustColor(s.strokeColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"server":{r.rectangle(c,h,f,d,o);const u=f*.7,y=d*.05,g=c+(f-u)/2;for(let w=0;w<3;w++)r.rectangle(g,h+d-(w+1)*y*2-y,u,y,{...o,fillStyle:"solid",fill:l});break}case"loadBalancer":{const u=c+f/2,y=h+d/2;r.ellipse(u,y,f,d,o);const g=f*.3;r.line(u-g,y,u+g,y,o),this.drawSketchArrowhead(r,u+g,y,0,o),this.drawSketchArrowhead(r,u-g,y,Math.PI,o);break}case"firewall":{r.rectangle(c,h,f,d,o);const u=4,y=3,g=d/u,w=f/y;for(let m=1;m<u;m++)r.line(c,h+m*g,c+f,h+m*g,o);for(let m=0;m<u;m++){const x=m%2===0?0:w/2;for(let _=1;_<y;_++){const L=c+_*w+x;L<c+f&&r.line(L,h+m*g,L,h+(m+1)*g,o)}}break}case"user":{const u=Math.min(f,d)*.25,y=c+f/2;r.circle(y,h+u,u*2,o);const g=f*.8,w=`M ${y-g/2} ${h+d} Q ${y} ${h+u*1.5} ${y+g/2} ${h+d} Z`;r.path(w,o);break}case"messageQueue":{r.rectangle(c,h,f,d,o);const u=4,y=f/u;for(let g=1;g<u;g++)r.line(c+g*y,h,c+g*y,h+d,o);break}case"lambda":{const u=c+f/2,y=h+d/2,g=f*.4,w=d*.6,m=u-g/2,x=y-w/2,_=`M ${m+g} ${x} L ${m} ${x+w*.6} L ${m+g*.6} ${x+w*.5} L ${m} ${x+w} L ${m+g} ${x+w*.4} L ${m+g*.4} ${x+w*.5} Z`;r.ellipse(u,y,f,d,o),r.path(_,{...o,fillStyle:"solid",fill:l});break}case"router":{const u=c+f/2,y=h+d/2;r.ellipse(u,y,f,d,o);const g=Math.min(f,d)*.3;for(let w=0;w<4;w++){const m=Math.PI/2*w+Math.PI/4,x=u+g*Math.cos(m),_=y+g*Math.sin(m);r.line(u,y,x,_,o),this.drawSketchArrowhead(r,x,_,m,o)}break}}ne.renderText(t,e,i)}drawArchArrowhead(t,e,i,r){t.beginPath(),t.moveTo(e-5*Math.cos(r-Math.PI/6),i-5*Math.sin(r-Math.PI/6)),t.lineTo(e,i),t.lineTo(e-5*Math.cos(r+Math.PI/6),i-5*Math.sin(r+Math.PI/6)),t.stroke()}drawSketchArrowhead(t,e,i,r,s){const o={x:e-10*Math.cos(r-Math.PI/6),y:i-10*Math.sin(r-Math.PI/6)},l={x:e-10*Math.cos(r+Math.PI/6),y:i-10*Math.sin(r+Math.PI/6)};t.line(e,i,o.x,o.y,s),t.line(e,i,l.x,l.y,s)}definePath(t,e){e.type==="loadBalancer"||e.type==="router"||e.type==="lambda"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):t.rect(e.x,e.y,e.width,e.height)}}class t3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.adjustColor(s.strokeColor,a),l=s.backgroundColor==="transparent"?void 0:ne.adjustColor(s.backgroundColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"browserWindow":{l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d);const u=Math.min(d*.15,30);r.strokeRect(c,h,f,u);const y=4;for(let g=0;g<3;g++)r.beginPath(),r.arc(c+10+g*15,h+u/2,y,0,Math.PI*2),r.stroke();break}case"mobilePhone":{l&&(r.fillStyle=l,r.roundRect(c,h,f,d,20),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.beginPath(),r.roundRect(c,h,f,d,20),r.stroke();const y=10;r.strokeRect(c+y,h+y+20,f-2*y,d-2*y-40),r.beginPath(),r.arc(c+f/2,h+d-20,10,0,Math.PI*2),r.stroke();break}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=s.x,c=s.y,h=s.width,f=s.height;switch(s.type){case"browserWindow":{r.rectangle(l,c,h,f,o);const d=Math.min(f*.15,30);r.rectangle(l,c,h,d,o);for(let u=0;u<3;u++)r.circle(l+10+u*15,c+d/2,8,o);break}case"mobilePhone":{const u=this.getRoundedRectPath(l,c,h,f,20);r.path(u,o);const y=10;r.rectangle(l+y,c+y+20,h-2*y,f-2*y-40,o),r.circle(l+h/2,c+f-20,20,o);break}}ne.renderText(t,e,i)}getRoundedRectPath(t,e,i,r,s){const a=Math.min(Math.abs(i)/2,s),o=Math.min(Math.abs(r)/2,s);return`M ${t+a} ${e} L ${t+i-a} ${e} Q ${t+i} ${e} ${t+i} ${e+o} L ${t+i} ${e+r-o} Q ${t+i} ${e+r} ${t+i-a} ${e+r} L ${t+a} ${e+r} Q ${t} ${e+r} ${t} ${e+r-o} L ${t} ${e+o} Q ${t} ${e} ${t+a} ${e}`}definePath(t,e){const i=e.x,r=e.y,s=e.width,a=e.height;e.type==="mobilePhone"?t.roundRect(i,r,s,a,20):t.rect(i,r,s,a)}}class e3 extends hr{render(t){const{ctx:e,element:i,layerOpacity:r}=t,{cx:s,cy:a}=ne.applyTransformations(e,i,r),o=i.drawProgress;o!==void 0&&o>=0&&o<100?this.renderDrawProgress(t,s,a):i.renderStyle==="architectural"?this.renderArchitectural(t,s,a):this.renderSketch(t,s,a),ne.restoreTransformations(e)}renderArchitectural(t,e,i){this.renderCommon(t)}renderSketch(t,e,i){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:i,isDarkMode:r}=t,s=ne.adjustColor(i.strokeColor,r);if(i.type==="organicBranch"){const a=Tn(i.points),o=i.controlPoints||[];if(a.length<2||o.length<2)return;const l={x:i.x+a[0].x,y:i.y+a[0].y},c={x:i.x+a[a.length-1].x,y:i.y+a[a.length-1].y},h=o[0],f=o[1];this.drawOrganicBranch(e,l,c,h,f,s,i.strokeWidth,i.text||"",s),this.renderFlow(t,l,c,h,f)}}renderFlow(t,e,i,r,s){const{ctx:a,element:o,isDarkMode:l}=t;if(!o.flowAnimation)return;const c=window.yappyGlobalTime||performance.now(),h=(o.flowSpeed??2)*50,f=c/1e3*h,d=ne.adjustColor(o.flowColor||o.strokeColor,l),u=Math.max(2,o.strokeWidth*1.5),y=100/(o.flowDensity||3);a.save(),a.fillStyle=d,a.shadowBlur=o.flowStyle==="pulse"?u:0,a.shadowColor=d;const g=Math.sqrt((i.x-e.x)**2+(i.y-e.y)**2),w=Math.sqrt((r.x-e.x)**2+(r.y-e.y)**2)+Math.sqrt((s.x-r.x)**2+(s.y-r.y)**2)+Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),m=(g+w)/2,x=Math.ceil(m/5);for(let _=0;_<=x;_++){const L=_/x;if((L*m+f)%y<h/10){const q=this.cubicBezier(e.x,r.x,s.x,i.x,L),U=this.cubicBezier(e.y,r.y,s.y,i.y,L),B=Math.min(1,L+.01),O=this.cubicBezier(e.x,r.x,s.x,i.x,B),X=this.cubicBezier(e.y,r.y,s.y,i.y,B),R=Math.atan2(X-U,O-q);this.drawPulse(a,q,U,u,o.flowStyle,R)}}a.restore()}drawPulse(t,e,i,r,s,a=0){if(t.save(),t.translate(e,i),t.rotate(a),s==="dashes")t.fillRect(-r,-r/2,r*2,r);else if(s==="pulse"){t.beginPath(),t.arc(0,0,r*1.5,0,Math.PI*2);const o=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=o,t.fill()}else t.beginPath(),t.arc(0,0,r,0,Math.PI*2),t.fill();t.restore()}cubicBezier(t,e,i,r,s){const a=1-s;return a*a*a*t+3*a*a*s*e+3*a*s*s*i+s*s*s*r}cubicBezierAngle(t,e,i,r,s){const a=3*(1-s)*(1-s)*(e.x-t.x)+6*(1-s)*s*(i.x-e.x)+3*s*s*(r.x-i.x),o=3*(1-s)*(1-s)*(e.y-t.y)+6*(1-s)*s*(i.y-e.y)+3*s*s*(r.y-i.y);return Math.atan2(o,a)}drawOrganicBranch(t,e,i,r,s,a,o,l,c){const f=[],d=[],u=Math.max(o*8,4),y=Math.max(o*2,2);for(let g=0;g<=20;g++){const w=g/20,m=this.cubicBezier(e.x,r.x,s.x,i.x,w),x=this.cubicBezier(e.y,r.y,s.y,i.y,w),_=this.cubicBezierAngle(e,r,s,i,w),T=(u+(y-u)*w)/2,q=Math.cos(_+Math.PI/2)*T,U=Math.sin(_+Math.PI/2)*T;f.push({x:m+q,y:x+U}),d.push({x:m-q,y:x-U})}t.beginPath(),t.moveTo(f[0].x,f[0].y);for(let g=1;g<f.length;g++)t.lineTo(f[g].x,f[g].y);t.lineTo(d[d.length-1].x,d[d.length-1].y);for(let g=d.length-2;g>=0;g--)t.lineTo(d[g].x,d[g].y);if(t.closePath(),t.fillStyle=a,t.fill(),l){t.save(),t.font="16px sans-serif",t.fillStyle=c,t.textAlign="center",t.textBaseline="middle";const g=this.cubicBezier(e.x,r.x,s.x,i.x,.5),w=this.cubicBezier(e.y,r.y,s.y,i.y,.5),m=this.cubicBezierAngle(e,r,s,i,.5),x=-15;t.translate(g,w);let _=m;(_>Math.PI/2||_<-Math.PI/2)&&(_+=Math.PI),t.rotate(_),t.fillText(l,0,x),t.restore()}}definePath(t,e){if(e.type==="organicBranch"){const i=Tn(e.points),r=e.controlPoints||[];if(i.length<2||r.length<2)return;const s={x:e.x+i[0].x,y:e.y+i[0].y},a={x:e.x+i[i.length-1].x,y:e.y+i[i.length-1].y},o=r[0],l=r[1];t.moveTo(s.x,s.y),t.bezierCurveTo(o.x,o.y,l.x,l.y,a.x,a.y)}}}class n3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.adjustColor(s.strokeColor,a),l=s.backgroundColor==="transparent"?void 0:ne.adjustColor(s.backgroundColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"browser":{l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d);const u=d*.15;r.beginPath(),r.moveTo(c,h+u),r.lineTo(c+f,h+u),r.stroke(),r.fillStyle=o;const y=u*.2;for(let g=0;g<3;g++)r.beginPath(),r.arc(c+u*(.5+g*.6),h+u/2,y,0,Math.PI*2),r.fill();break}case"ghostButton":{const u=Math.min(f,d)*.2;l&&(r.fillStyle=l,r.roundRect(c,h,f,d,u),r.fill()),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.setLineDash([4,4]),r.roundRect(c,h,f,d,u),r.stroke(),r.setLineDash([]);break}case"inputField":{if(l&&(r.fillStyle=l,r.fillRect(c,h,f,d)),r.strokeStyle=o,r.lineWidth=s.strokeWidth,r.strokeRect(c,h,f,d),r.beginPath(),r.moveTo(c+10,h+8),r.lineTo(c+10,h+d-8),r.stroke(),s.containerText){r.save(),r.textAlign="left";const u=c+25,y=Jr(r,s,s.containerText,f-30),g=h+(d-y.textHeight)/2+y.lineHeight/2;r.fillStyle=o,y.lines.forEach((w,m)=>{r.fillText(w,u,g+m*y.lineHeight)}),r.restore();return}break}}ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=ne.adjustColor(s.strokeColor,a),c=s.x,h=s.y,f=s.width,d=s.height;switch(s.type){case"browser":{r.rectangle(c,h,f,d,o);const u=d*.15;r.line(c,h+u,c+f,h+u,o);const y=u*.3;for(let g=0;g<3;g++)r.circle(c+u*(.5+g*.6),h+u/2,y,{...o,fillStyle:"solid",fill:l});break}case"ghostButton":{const u=Math.min(f,d)*.2,y=this.getRoundedRectPath(c,h,f,d,u);r.path(y,{...o,strokeLineDash:[4,4]});break}case"inputField":{r.rectangle(c,h,f,d,o),r.line(c+10,h+8,c+10,h+d-8,o);break}}ne.renderText(t,e,i)}getRoundedRectPath(t,e,i,r,s){const a=Math.min(Math.abs(i)/2,s),o=Math.min(Math.abs(r)/2,s);return`M ${t+a} ${e} L ${t+i-a} ${e} Q ${t+i} ${e} ${t+i} ${e+o} L ${t+i} ${e+r-o} Q ${t+i} ${e+r} ${t+i-a} ${e+r} L ${t+a} ${e+r} Q ${t} ${e+r} ${t} ${e+r-o} L ${t} ${e+o} Q ${t} ${e} ${t+a} ${e}`}definePath(t,e){if(e.type==="ghostButton"){const i=Math.min(e.width,e.height)*.2;t.roundRect(e.x,e.y,e.width,e.height,i)}else t.rect(e.x,e.y,e.width,e.height)}}class r3 extends hr{render(t){const{ctx:e,element:i,layerOpacity:r}=t,{cx:s,cy:a}=ne.applyTransformations(e,i,r),o=i.drawProgress;o!==void 0&&o>=0&&o<100?this.renderDrawProgress(t,s,a):i.renderStyle==="architectural"?this.renderArchitectural(t,s,a):this.renderSketch(t,s,a),ne.restoreTransformations(e)}renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.adjustColor(s.strokeColor,a),l=s.backgroundColor==="transparent"?"#ffffff":ne.adjustColor(s.backgroundColor,a);r.save(),r.strokeStyle=o,r.fillStyle=l,r.lineWidth=s.strokeWidth,r.lineCap="round",r.lineJoin=s.strokeLineJoin||"round",s.strokeStyle==="dashed"?r.setLineDash([8,8]):s.strokeStyle==="dotted"&&r.setLineDash([2,4]),r.beginPath(),this.definePath(r,s),r.stroke(),this.renderFlow(t);const c=Tn(s.points);let h,f;c.length>=2?(h={x:s.x+c[0].x,y:s.y+c[0].y},f={x:s.x+c[c.length-1].x,y:s.y+c[c.length-1].y}):(h={x:s.x,y:s.y},f={x:s.x+s.width,y:s.y+s.height});let d;if(s.curveType==="bezier"){const u=s.controlPoints?.[0]||{x:h.x,y:h.y},y=s.controlPoints?.[1]||u;if(s.startArrowhead){const g=Math.atan2(h.y-u.y,h.x-u.x);this.drawArrowheadArchitectural(r,h.x,h.y,g,s.startArrowhead)}if(s.endArrowhead){const g=Math.atan2(f.y-y.y,f.x-y.x);this.drawArrowheadArchitectural(r,f.x,f.y,g,s.endArrowhead)}}else if(s.curveType==="elbow"&&c.length>=2){const u={x:s.x+c[0].x,y:s.y+c[0].y},y={x:s.x+c[1].x,y:s.y+c[1].y},g=Math.atan2(u.y-y.y,u.x-y.x);s.startArrowhead&&this.drawArrowheadArchitectural(r,u.x,u.y,g,s.startArrowhead);const w={x:s.x+c[c.length-1].x,y:s.y+c[c.length-1].y},m={x:s.x+c[c.length-2].x,y:s.y+c[c.length-2].y},x=Math.atan2(w.y-m.y,w.x-m.x);s.endArrowhead&&this.drawArrowheadArchitectural(r,w.x,w.y,x,s.endArrowhead)}else d=Math.atan2(f.y-h.y,f.x-h.x),s.startArrowhead&&this.drawArrowheadArchitectural(r,h.x,h.y,d+Math.PI,s.startArrowhead),s.endArrowhead&&this.drawArrowheadArchitectural(r,f.x,f.y,d,s.endArrowhead);r.restore()}renderSketch(t,e,i){this.renderCommon(t,e,i),this.renderFlow(t)}renderCommon(t,e,i){const{element:r,isDarkMode:s}=t,a=ne.buildRenderOptions(r,s);r.curveType==="bezier"?this.renderBezier(t,a):r.curveType==="elbow"?this.renderElbow(t,a):this.renderStraight(t,a)}renderBezier(t,e){e={...e,fill:void 0};const{rc:i,element:r}=t,s=r.x+r.width,a=r.y+r.height,o=Tn(r.points);let l={x:r.x,y:r.y},c={x:s,y:a};if(o.length>=2&&(l={x:r.x+o[0].x,y:r.y+o[0].y},c={x:r.x+o[o.length-1].x,y:r.y+o[o.length-1].y}),r.controlPoints&&r.controlPoints.length>0){const h=r.controlPoints[0];if(r.controlPoints.length>1){const f=r.controlPoints[1],d=`M ${l.x} ${l.y} C ${h.x} ${h.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`;i.path(d,e),r.startArrowhead&&this.drawArrowhead(i,l.x,l.y,Math.atan2(l.y-h.y,l.x-h.x),r.startArrowhead,e),r.endArrowhead&&this.drawArrowhead(i,c.x,c.y,Math.atan2(c.y-f.y,c.x-f.x),r.endArrowhead,e)}else{const f=`M ${l.x} ${l.y} Q ${h.x} ${h.y}, ${c.x} ${c.y}`;i.path(f,e),r.startArrowhead&&this.drawArrowhead(i,l.x,l.y,Math.atan2(l.y-h.y,l.x-h.x),r.startArrowhead,e),r.endArrowhead&&this.drawArrowhead(i,c.x,c.y,Math.atan2(c.y-h.y,c.x-h.x),r.endArrowhead,e)}}else{const h=r.width,f=r.height;let d,u;Math.abs(h)>Math.abs(f)?(d={x:l.x+h/2,y:l.y},u={x:c.x-h/2,y:c.y}):(d={x:l.x,y:l.y+f/2},u={x:c.x,y:c.y-f/2});const y=`M ${l.x} ${l.y} C ${d.x} ${d.y}, ${u.x} ${u.y}, ${c.x} ${c.y}`;i.path(y,e),r.startArrowhead&&this.drawArrowhead(i,l.x,l.y,Math.atan2(l.y-d.y,l.x-d.x),r.startArrowhead,e),r.endArrowhead&&this.drawArrowhead(i,c.x,c.y,Math.atan2(c.y-u.y,c.x-u.x),r.endArrowhead,e)}}renderElbow(t,e){e={...e,fill:void 0};const{rc:i,element:r}=t,s=Tn(r.points),a=s&&s.length>0?s.map(l=>[r.x+l.x,r.y+l.y]):[[r.x,r.y],[r.x+r.width,r.y+r.height]];i.linearPath(a,e);const o=a.filter((l,c,h)=>c===0||Math.abs(l[0]-h[c-1][0])>.1||Math.abs(l[1]-h[c-1][1])>.1);if(r.startArrowhead&&o.length>=2){const l=Math.atan2(o[0][1]-o[1][1],o[0][0]-o[1][0]);this.drawArrowhead(i,o[0][0],o[0][1],l,r.startArrowhead,e)}if(r.endArrowhead&&o.length>=2){const l=o.length,c=Math.atan2(o[l-1][1]-o[l-2][1],o[l-1][0]-o[l-2][0]);this.drawArrowhead(i,o[l-1][0],o[l-1][1],c,r.endArrowhead,e)}}renderStraight(t,e){e={...e,fill:void 0};const{rc:i,element:r}=t,s=Tn(r.points);let a,o;s.length>=2?(a={x:r.x+s[0].x,y:r.y+s[0].y},o={x:r.x+s[s.length-1].x,y:r.y+s[s.length-1].y}):(a={x:r.x,y:r.y},o={x:r.x+r.width,y:r.y+r.height}),i.line(a.x,a.y,o.x,o.y,e);const l=Math.atan2(o.y-a.y,o.x-a.x);r.startArrowhead&&this.drawArrowhead(i,a.x,a.y,l+Math.PI,r.startArrowhead,e),r.endArrowhead&&this.drawArrowhead(i,o.x,o.y,l,r.endArrowhead,e)}drawArrowhead(t,e,i,r,s,a){const l={x:e-12*Math.cos(r-Math.PI/6),y:i-12*Math.sin(r-Math.PI/6)},c={x:e-12*Math.cos(r+Math.PI/6),y:i-12*Math.sin(r+Math.PI/6)};if(s==="triangle"||s==="arrow")s==="triangle"?t.polygon([[e,i],[l.x,l.y],[c.x,c.y]],{...a,fill:"#ffffff",fillStyle:"solid"}):(t.line(e,i,l.x,l.y,a),t.line(e,i,c.x,c.y,a));else if(s==="circle"||s==="dot")t.circle(e,i,12,{...a,fill:s==="dot"?a.stroke:"#ffffff",fillStyle:"solid"});else if(s==="diamond"||s==="diamondFilled"){const h={x:e-24*Math.cos(r),y:i-24*Math.sin(r)},f={x:e-12*Math.cos(r),y:i-12*Math.sin(r)},d={x:f.x-12/2*Math.cos(r-Math.PI/2),y:f.y-12/2*Math.sin(r-Math.PI/2)},u={x:f.x-12/2*Math.cos(r+Math.PI/2),y:f.y-12/2*Math.sin(r+Math.PI/2)};t.polygon([[e,i],[d.x,d.y],[h.x,h.y],[u.x,u.y]],{...a,fill:s==="diamondFilled"?a.stroke:"#ffffff",fillStyle:"solid"})}else if(s==="crowsfoot"){const h={x:e-12*Math.cos(r-Math.PI/4),y:i-12*Math.sin(r-Math.PI/4)},f={x:e-12*Math.cos(r+Math.PI/4),y:i-12*Math.sin(r+Math.PI/4)},d={x:e-12*Math.cos(r),y:i-12*Math.sin(r)};t.line(e,i,h.x,h.y,a),t.line(e,i,f.x,f.y,a),t.line(e,i,d.x,d.y,a)}else if(s==="bar"){const h=e+Math.cos(r+Math.PI/2)*12,f=i+Math.sin(r+Math.PI/2)*12,d=e+Math.cos(r-Math.PI/2)*12,u=i+Math.sin(r-Math.PI/2)*12;t.line(h,f,d,u,a)}}drawArrowheadArchitectural(t,e,i,r,s){t.save(),t.translate(e,i),t.rotate(r),t.setLineDash([]),s==="triangle"||s==="arrow"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/6),-12*Math.sin(Math.PI/6)),s==="triangle"?(t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6)),t.closePath(),t.fillStyle="#ffffff",t.fill()):(t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/6),-12*Math.sin(-Math.PI/6))),t.stroke()):s==="circle"||s==="dot"?(t.beginPath(),t.arc(-12/2*Math.cos(0),0,12/2,0,Math.PI*2),s==="dot"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):s==="diamond"||s==="diamondFilled"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12,-12/2),t.lineTo(-24,0),t.lineTo(-12,12/2),t.closePath(),s==="diamondFilled"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):s==="crowsfoot"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-12*Math.cos(Math.PI/4),-12*Math.sin(Math.PI/4)),t.moveTo(0,0),t.lineTo(-12*Math.cos(-Math.PI/4),-12*Math.sin(-Math.PI/4)),t.moveTo(0,0),t.lineTo(-12,0),t.stroke()):s==="bar"&&(t.beginPath(),t.moveTo(0,-12),t.lineTo(0,12),t.stroke()),t.restore()}renderFlow(t){const{ctx:e,element:i,isDarkMode:r}=t;if(!i.flowAnimation)return;const s=window.yappyGlobalTime||performance.now(),a=(i.flowSpeed??2)*50,o=s/1e3*a,l=ne.adjustColor(i.flowColor||i.strokeColor,r),c=Math.max(2,i.strokeWidth*1.5),h=100/(i.flowDensity||3);e.save(),e.fillStyle=l,e.shadowBlur=i.flowStyle==="pulse"?c:0,e.shadowColor=l;const f=Tn(i.points);let d,u;if(f.length>=2?(d={x:i.x+f[0].x,y:i.y+f[0].y},u={x:i.x+f[f.length-1].x,y:i.y+f[f.length-1].y}):(d={x:i.x,y:i.y},u={x:i.x+i.width,y:i.y+i.height}),i.curveType==="bezier"){let y,g;if(i.controlPoints&&i.controlPoints.length>0)y=i.controlPoints[0],g=i.controlPoints.length>1?i.controlPoints[1]:y;else{const L=i.width,T=i.height;Math.abs(L)>Math.abs(T)?(y={x:d.x+L/2,y:d.y},g={x:u.x-L/2,y:u.y}):(y={x:d.x,y:d.y+T/2},g={x:u.x,y:u.y-T/2})}const w=Math.sqrt((u.x-d.x)**2+(u.y-d.y)**2),m=Math.sqrt((y.x-d.x)**2+(y.y-d.y)**2)+Math.sqrt((g.x-y.x)**2+(g.y-y.y)**2)+Math.sqrt((u.x-g.x)**2+(u.y-g.y)**2),x=(w+m)/2,_=Math.ceil(x/5);for(let L=0;L<=_;L++){const T=L/_;if((T*x+o)%h<a/10){const U=yl(d.x,y.x,g.x,u.x,T),B=yl(d.y,y.y,g.y,u.y,T),O=Math.min(1,T+.01),X=yl(d.x,y.x,g.x,u.x,O),R=yl(d.y,y.y,g.y,u.y,O),M=Math.atan2(R-B,X-U);this.drawPulse(e,U,B,c,i.flowStyle,M)}}}else if(i.curveType==="elbow"&&f.length>=2){let y=0;for(let g=0;g<f.length-1;g++){const w={x:i.x+f[g].x,y:i.y+f[g].y},m={x:i.x+f[g+1].x,y:i.y+f[g+1].y},x=Math.sqrt((m.x-w.x)**2+(m.y-w.y)**2),_=Math.atan2(m.y-w.y,m.x-w.x),L=Math.ceil(x/5);for(let T=0;T<=L;T++){const q=T/L;if((y+q*x+o)%h<a/10){const B=w.x+(m.x-w.x)*q,O=w.y+(m.y-w.y)*q;this.drawPulse(e,B,O,c,i.flowStyle,_)}}y+=x}}else{const y=u.x-d.x,g=u.y-d.y,w=Math.sqrt(y*y+g*g),m=Math.atan2(g,y),x=Math.ceil(w/5);for(let _=0;_<=x;_++){const L=_/x;if((L*w+o)%h<a/10){const q=d.x+y*L,U=d.y+g*L;this.drawPulse(e,q,U,c,i.flowStyle,m)}}}e.restore()}drawPulse(t,e,i,r,s,a=0){if(t.save(),t.translate(e,i),t.rotate(a),s==="dashes")t.fillRect(-r,-r/2,r*2,r);else if(s==="pulse"){t.beginPath(),t.arc(0,0,r*1.5,0,Math.PI*2);const o=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=o,t.fill()}else t.beginPath(),t.arc(0,0,r,0,Math.PI*2),t.fill();t.restore()}definePath(t,e){const i=Tn(e.points);let r,s;if(i.length>=2?(r={x:e.x+i[0].x,y:e.y+i[0].y},s={x:e.x+i[i.length-1].x,y:e.y+i[i.length-1].y}):(r={x:e.x,y:e.y},s={x:e.x+e.width,y:e.y+e.height}),e.curveType==="bezier"){const a=e.width,o=e.height;let l,c;e.controlPoints&&e.controlPoints.length>0?(l=e.controlPoints[0],e.controlPoints.length>1?(c=e.controlPoints[1],t.moveTo(r.x,r.y),t.bezierCurveTo(l.x,l.y,c.x,c.y,s.x,s.y)):(t.moveTo(r.x,r.y),t.quadraticCurveTo(l.x,l.y,s.x,s.y))):(Math.abs(a)>Math.abs(o)?(l={x:r.x+a/2,y:r.y},c={x:s.x-a/2,y:s.y}):(l={x:r.x,y:r.y+o/2},c={x:s.x,y:s.y-o/2}),t.moveTo(r.x,r.y),t.bezierCurveTo(l.x,l.y,c.x,c.y,s.x,s.y))}else if(e.curveType==="elbow"){const a=i&&i.length>0?i.map(o=>({x:e.x+o.x,y:e.y+o.y})):[r,s];t.moveTo(a[0].x,a[0].y);for(let o=1;o<a.length;o++)t.lineTo(a[o].x,a[o].y)}else t.moveTo(r.x,r.y),t.lineTo(s.x,s.y)}estimatePathLength(t){const e=Tn(t.points);let i,r;if(e.length>=2?(i={x:t.x+e[0].x,y:t.y+e[0].y},r={x:t.x+e[e.length-1].x,y:t.y+e[e.length-1].y}):(i={x:t.x,y:t.y},r={x:t.x+t.width,y:t.y+t.height}),t.curveType==="bezier"){let s,a;if(t.controlPoints&&t.controlPoints.length>0)s=t.controlPoints[0],a=t.controlPoints.length>1?t.controlPoints[1]:s;else{const c=t.width,h=t.height;Math.abs(c)>Math.abs(h)?(s={x:i.x+c/2,y:i.y},a={x:r.x-c/2,y:r.y}):(s={x:i.x,y:i.y+h/2},a={x:r.x,y:r.y-h/2})}const o=Math.sqrt((r.x-i.x)**2+(r.y-i.y)**2),l=Math.sqrt((s.x-i.x)**2+(s.y-i.y)**2)+Math.sqrt((a.x-s.x)**2+(a.y-s.y)**2)+Math.sqrt((r.x-a.x)**2+(r.y-a.y)**2);return(o+l)/2}else if(t.curveType==="elbow"&&e.length>=2){let s=0;const a=e.map(o=>({x:t.x+o.x,y:t.y+o.y}));for(let o=0;o<a.length-1;o++)s+=Math.sqrt((a[o+1].x-a[o].x)**2+(a[o+1].y-a[o].y)**2);return s}else return Math.sqrt((r.x-i.x)**2+(r.y-i.y)**2)}}class i3 extends hr{render(t){const{ctx:e,element:i,layerOpacity:r}=t,{cx:s,cy:a}=ne.applyTransformations(e,i,r);i.renderStyle==="architectural"?this.renderArchitectural(t,s,a):this.renderSketch(t,s,a),ne.restoreTransformations(e)}renderArchitectural(t,e,i){this.renderCommon(t)}renderSketch(t,e,i){this.renderCommon(t)}renderCommon(t){const{ctx:e,element:i,isDarkMode:r,layerOpacity:s}=t;if(!i.points||i.points.length===0)return;let a=Tn(i.points).map(l=>({x:i.x+l.x,y:i.y+l.y}));i.smoothing&&i.smoothing>0&&(a=this.smoothPoints(a,i.smoothing));const o=ne.adjustColor(i.strokeColor,r);e.save(),e.strokeStyle=o,e.fillStyle=o,i.type==="fineliner"?this.renderFineliner(e,a,i.strokeWidth):i.type==="inkbrush"?this.renderInkbrush(e,a,i.strokeWidth,i.taperAmount,i.velocitySensitivity):i.type==="marker"?this.renderMarker(e,a,i.strokeWidth,i.opacity,s):i.type==="ink"&&this.renderFineliner(e,a,i.strokeWidth),e.restore()}smoothPoints(t,e){if(t.length<3)return t;const i=[t[0]],r=Math.floor(e/2)||1;for(let s=1;s<t.length-1;s++){let a=0,o=0,l=0;for(let c=Math.max(0,s-r);c<=Math.min(t.length-1,s+r);c++)a+=t[c].x,o+=t[c].y,l++;i.push({x:a/l,y:o/l})}return i.push(t[t.length-1]),i}renderFineliner(t,e,i){if(e.length<6){t.beginPath(),t.arc(e[0].x,e[0].y,i/2,0,Math.PI*2),t.fill();return}t.lineWidth=i,t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length-2;s++){const a=(e[s].x+e[s+1].x)/2,o=(e[s].y+e[s+1].y)/2;t.quadraticCurveTo(e[s].x,e[s].y,a,o)}const r=e.length-1;t.quadraticCurveTo(e[r-1].x,e[r-1].y,e[r].x,e[r].y),t.stroke()}renderInkbrush(t,e,i,r=.15,s=.5){if(e.length<2){t.beginPath(),t.arc(e[0].x,e[0].y,i/2,0,Math.PI*2),t.fill();return}const a=[0];for(let g=1;g<e.length;g++){const w=e[g].x-e[g-1].x,m=e[g].y-e[g-1].y;a.push(Math.sqrt(w*w+m*m))}const o=[],l=3;for(let g=0;g<a.length;g++){let w=0,m=0;for(let x=Math.max(0,g-l);x<=Math.min(a.length-1,g+l);x++)w+=a[x],m++;o.push(w/m)}const c=Math.max(...o,1),h=i*(1-s*.7),f=i*(1+s*.5),d=[];for(let g=0;g<e.length;g++){const w=o[g]/c;let m=f-(f-h)*w;const x=Math.min(e.length*r,20);if(x>0&&(g<x&&(m*=g/x*.9+.1),g>e.length-x-1)){const _=e.length-1-g;m*=_/x*.9+.1}d.push(Math.max(m,.5))}t.beginPath();const u=[],y=[];for(let g=0;g<e.length;g++){let w,m;if(g===0){const _=e[1].x-e[0].x,L=e[1].y-e[0].y,T=Math.sqrt(_*_+L*L)||1;w=-L/T,m=_/T}else if(g===e.length-1){const _=e[g].x-e[g-1].x,L=e[g].y-e[g-1].y,T=Math.sqrt(_*_+L*L)||1;w=-L/T,m=_/T}else{const _=e[g].x-e[g-1].x,L=e[g].y-e[g-1].y,T=e[g+1].x-e[g].x,q=e[g+1].y-e[g].y,U=Math.sqrt(_*_+L*L)||1,B=Math.sqrt(T*T+q*q)||1;w=-(L/U+q/B)/2,m=(_/U+T/B)/2;const O=Math.sqrt(w*w+m*m)||1;w/=O,m/=O}const x=d[g]/2;u.push({x:e[g].x+w*x,y:e[g].y+m*x}),y.push({x:e[g].x-w*x,y:e[g].y-m*x})}if(u.length>=2){t.moveTo(u[0].x,u[0].y);for(let w=1;w<u.length-1;w++){const m=(u[w].x+u[w+1].x)/2,x=(u[w].y+u[w+1].y)/2;t.quadraticCurveTo(u[w].x,u[w].y,m,x)}t.lineTo(u[u.length-1].x,u[u.length-1].y);const g=e.length-1;t.arc(e[g].x,e[g].y,d[g]/2,Math.atan2(u[g].y-e[g].y,u[g].x-e[g].x),Math.atan2(y[g].y-e[g].y,y[g].x-e[g].x),!1);for(let w=y.length-2;w>0;w--){const m=(y[w].x+y[w-1].x)/2,x=(y[w].y+y[w-1].y)/2;t.quadraticCurveTo(y[w].x,y[w].y,m,x)}t.lineTo(y[0].x,y[0].y),t.arc(e[0].x,e[0].y,d[0]/2,Math.atan2(y[0].y-e[0].y,y[0].x-e[0].x),Math.atan2(u[0].y-e[0].y,u[0].x-e[0].x),!1)}t.closePath(),t.fill()}renderMarker(t,e,i,r,s){t.globalAlpha=(r??100)/100*s*.5,t.globalCompositeOperation="multiply",this.renderFineliner(t,e,i*4)}definePath(t,e){const i=Tn(e.points).map(s=>({x:e.x+s.x,y:e.y+s.y}));if(i.length<2)return;if(i.length<6){t.moveTo(i[0].x,i[0].y);for(let s=1;s<i.length;s++)t.lineTo(i[s].x,i[s].y);return}t.moveTo(i[0].x,i[0].y);for(let s=1;s<i.length-2;s++){const a=(i[s].x+i[s+1].x)/2,o=(i[s].y+i[s+1].y)/2;t.quadraticCurveTo(i[s].x,i[s].y,a,o)}const r=i.length-1;t.quadraticCurveTo(i[r-1].x,i[r-1].y,i[r].x,i[r].y)}estimatePathLength(t){const e=Tn(t.points);if(e.length<2)return 0;let i=0;for(let r=1;r<e.length;r++){const s=e[r].x-e[r-1].x,a=e[r].y-e[r-1].y;i+=Math.sqrt(s*s+a*a)}return i}}class s3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=ne.adjustColor(s.strokeColor,a),c=s.backgroundColor==="transparent"?void 0:ne.adjustColor(s.backgroundColor,a),h=ya(s);if(!h)return;if(r.save(),r.translate(e,i),["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(s.type)&&h.type==="multi"){const d=o.fill&&o.fill!=="transparent"&&o.fill!=="none";h.shapes.forEach(u=>{d&&c&&(r.fillStyle=u.shade?ne.shadeColor(c,u.shade):c,r.beginPath(),ne.renderGeometry(r,u),r.fill()),r.strokeStyle=l,r.lineWidth=s.strokeWidth,r.lineJoin=s.strokeLineJoin||"round",r.beginPath(),ne.renderGeometry(r,u),r.stroke(),s.drawInnerBorder})}else if(o.fill&&o.fill!=="transparent"&&o.fill!=="none"&&c&&(r.fillStyle=c,r.beginPath(),ne.renderGeometry(r,h),r.fill()),r.strokeStyle=l,r.lineWidth=s.strokeWidth,r.lineJoin=s.strokeLineJoin||"round",r.beginPath(),ne.renderGeometry(r,h),r.stroke(),s.drawInnerBorder){const u=s.innerBorderDistance||5,y=(s.width-u*2)/s.width,g=(s.height-u*2)/s.height;y>0&&g>0&&(r.save(),r.scale(y,g),r.strokeStyle=s.innerBorderColor||l,r.beginPath(),ne.renderGeometry(r,h),r.stroke(),r.restore())}r.restore(),ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,ctx:s,element:a,isDarkMode:o}=t,l=ne.buildRenderOptions(a,o),c=ya(a);if(!c)return;s.save(),s.translate(e,i),this.renderSketchGeometry(r,c,l);const h=["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(a.type);if(a.drawInnerBorder&&!h){const f=a.innerBorderDistance||5,d=(a.width-f*2)/a.width,u=(a.height-f*2)/a.height;if(d>0&&u>0){const y={...l,stroke:a.innerBorderColor||l.stroke,fill:"none"};s.save(),s.scale(d,u),this.renderSketchGeometry(r,c,y),s.restore()}}s.restore(),ne.renderText(t,e,i)}renderSketchGeometry(t,e,i){const r=e.shade&&i.fill&&i.fill!=="transparent"&&i.fill!=="none"?{...i,fill:ne.shadeColor(i.fill,e.shade)}:i;if(e.type==="rect")t.rectangle(e.x,e.y,e.w,e.h,r);else if(e.type==="ellipse")t.ellipse(e.cx,e.cy,e.rx*2,e.ry*2,r);else if(e.type==="points"){const s=e.points.map(a=>[a.x,a.y]);e.isClosed===!1?t.linearPath(s,r):t.polygon(s,r)}else e.type==="path"?t.path(e.path,r):e.type==="multi"&&e.shapes.forEach(s=>this.renderSketchGeometry(t,s,r))}definePath(t,e){const i=ya(e);i&&(t.translate(e.x+e.width/2,e.y+e.height/2),ne.renderGeometry(t,i))}}class o3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a);r.beginPath(),r.rect(s.x,s.y,s.width,s.height),r.fillStyle=o.fill||"transparent",o.fill&&o.fill!=="none"&&r.fill(),r.lineWidth=s.strokeWidth,r.strokeStyle=o.stroke||"#000000",r.stroke();const l=this.calculateLayout(r,s);this.drawDividers(r,s,l,o.stroke||"#000000"),this.renderTexts(t,s,l)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a);r.rectangle(s.x,s.y,s.width,s.height,o);const c=document.createElement("canvas").getContext("2d"),h=this.calculateLayout(c,s);this.drawSketchDividers(r,s,h,o),this.renderTexts(t,s,h)}definePath(t,e){t.rect(e.x,e.y,e.width,e.height)}calculateLayout(t,e){const i=e.containerText||"";let r=30;if(i){const o=Jr(t,e,i,e.width-10);r=Math.max(30,o.textHeight+20)}const s=e.attributesText||"";let a=0;if(s){const o=Jr(t,{...e,fontSize:(e.fontSize||20)*.9},s,e.width-10);a=Math.max(20,o.textHeight+10)}else e.type==="umlClass"&&(a=20);return{headerHeight:r,attrHeight:a,hasAttributes:!!s||e.type==="umlClass",hasMethods:!!e.methodsText||e.type==="umlClass"}}drawDividers(t,e,i,r){t.strokeStyle=r,t.lineWidth=1;const s=e.y+i.headerHeight;if(s<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,s),t.lineTo(e.x+e.width,s),t.stroke()),i.hasAttributes&&i.hasMethods){const a=s+i.attrHeight;a<e.y+e.height&&(t.beginPath(),t.moveTo(e.x,a),t.lineTo(e.x+e.width,a),t.stroke())}}drawSketchDividers(t,e,i,r){const s=e.y+i.headerHeight;if(s<e.y+e.height&&t.line(e.x,s,e.x+e.width,s,r),i.hasAttributes&&i.hasMethods){const a=s+i.attrHeight;a<e.y+e.height&&t.line(e.x,a,e.x+e.width,a,r)}}renderTexts(t,e,i){const{ctx:r,isDarkMode:s}=t;if(e.containerText&&this.renderSectionText(r,e,e.containerText,e.x+e.width/2,e.y+i.headerHeight/2,e.width-10,"center",!0,s),e.attributesText){const a=e.y+i.headerHeight+10,o=(e.fontSize||20)*.9;this.renderSectionText(r,{...e,fontSize:o},e.attributesText,e.x+10,a,e.width-20,"left",!1,s)}if(e.methodsText){const a=e.y+i.headerHeight+i.attrHeight+10,o=(e.fontSize||20)*.9;this.renderSectionText(r,{...e,fontSize:o},e.methodsText,e.x+10,a,e.width-20,"left",!1,s)}}renderSectionText(t,e,i,r,s,a,o,l,c){if(!i)return;t.save(),t.font=xc({...e,fontWeight:l?"bold":e.fontWeight});const h=ne.adjustColor(e.strokeColor||"#000",c);t.fillStyle=h,t.textAlign=o,t.textBaseline=o==="center"?"middle":"top";const f=Jr(t,e,i,a);f.lines.forEach((d,u)=>{const y=s+u*f.lineHeight-(o==="center"?(f.lines.length-1)*f.lineHeight/2:0);t.fillText(d,r,y)}),t.restore()}}class a3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=s.width,c=s.height,h=s.x,f=s.y;if(r.beginPath(),s.type==="umlActor")this.drawActorPath(r,h,f,l,c);else if(s.type==="umlUseCase"||s.type==="umlInterface")r.ellipse(h+l/2,f+c/2,l/2,c/2,0,0,Math.PI*2);else if(s.type==="umlPackage")this.drawPackagePath(r,h,f,l,c);else if(s.type==="umlNote")this.drawNotePath(r,h,f,l,c);else if(s.type==="umlComponent")r.rect(h,f,l,c);else if(s.type==="umlLifeline"){const d=Math.max(30,c*.2);r.rect(h,f,l,d)}else s.type==="umlFragment"&&r.rect(h,f,l,c);if(r.fillStyle=o.fill||"transparent",o.fill&&o.fill!=="none"&&r.fill(),r.lineWidth=s.strokeWidth,r.strokeStyle=o.stroke||"#000000",r.stroke(),s.type==="umlNote"){const d=Math.min(l,c)*.15;r.beginPath(),r.moveTo(h+l-d,f),r.lineTo(h+l-d,f+d),r.lineTo(h+l,f+d),r.stroke()}if(s.type==="umlComponent"){const d=Math.min(16,l*.15),u=Math.min(10,c*.08),y=h-d/2;r.fillStyle=o.fill||"transparent",r.strokeStyle=o.stroke||"#000000",r.beginPath(),r.rect(y,f+c*.25-u/2,d,u),o.fill&&o.fill!=="none"&&r.fill(),r.stroke(),r.beginPath(),r.rect(y,f+c*.55-u/2,d,u),o.fill&&o.fill!=="none"&&r.fill(),r.stroke()}if(s.type==="umlLifeline"){const d=Math.max(30,c*.2);r.save(),r.setLineDash([8,6]),r.beginPath(),r.moveTo(h+l/2,f+d),r.lineTo(h+l/2,f+c),r.stroke(),r.restore()}if(s.type==="umlFragment"){const d=Math.min(l*.3,60),u=Math.min(c*.12,22);r.fillStyle=o.fill||"transparent",r.strokeStyle=o.stroke||"#000000",r.beginPath(),r.moveTo(h,f),r.lineTo(h+d,f),r.lineTo(h+d,f+u),r.lineTo(h+d-5,f+u+5),r.lineTo(h,f+u+5),r.closePath(),o.fill&&o.fill!=="none"&&r.fill(),r.stroke()}if(s.type==="umlLifeline"){const d=Math.max(30,c*.2),u=s.y+d/2;ne.renderText(t,e,u)}else ne.renderText(t,e,i)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=ne.buildRenderOptions(s,a),l=s.width,c=s.height,h=s.x,f=s.y;if(s.type==="umlActor"){const d=l*.15;r.circle(h+l/2,f+d,d*2,o),r.line(h+l/2,f+d*2,h+l/2,f+c*.6,o),r.line(h,f+c*.3,h+l,f+c*.3,o),r.line(h+l/2,f+c*.6,h,f+c,o),r.line(h+l/2,f+c*.6,h+l,f+c,o)}else if(s.type==="umlUseCase"||s.type==="umlInterface")r.ellipse(h+l/2,f+c/2,l,c,o);else if(s.type==="umlPackage"){const d=c*.15,u=l*.4,y=`M ${h} ${f} L ${h+u} ${f} L ${h+u} ${f+d} L ${h+l} ${f+d} L ${h+l} ${f+c} L ${h} ${f+c} Z`;r.path(y,o),r.line(h,f+d,h+u,f+d,o)}else if(s.type==="umlNote"){const d=Math.min(l,c)*.15,u=`M ${h} ${f} L ${h+l-d} ${f} L ${h+l} ${f+d} L ${h+l} ${f+c} L ${h} ${f+c} L ${h} ${f} Z`;r.path(u,o),r.path(`M ${h+l-d} ${f} L ${h+l-d} ${f+d} L ${h+l} ${f+d}`,o)}else if(s.type==="umlComponent"){r.rectangle(h,f,l,c,o);const d=Math.min(16,l*.15),u=Math.min(10,c*.08),y=h-d/2;r.rectangle(y,f+c*.25-u/2,d,u,o),r.rectangle(y,f+c*.55-u/2,d,u,o)}else if(s.type==="umlLifeline"){const d=Math.max(30,c*.2);r.rectangle(h,f,l,d,o);const u={...o,strokeLineDash:[8,6],fill:"none"};r.line(h+l/2,f+d,h+l/2,f+c,u)}else if(s.type==="umlFragment"){r.rectangle(h,f,l,c,o);const d=Math.min(l*.3,60),u=Math.min(c*.12,22),y=`M ${h} ${f} L ${h+d} ${f} L ${h+d} ${f+u} L ${h+d-5} ${f+u+5} L ${h} ${f+u+5} Z`;r.path(y,o)}if(s.type==="umlLifeline"){const d=Math.max(30,c*.2),u=s.y+d/2;ne.renderText(t,e,u)}else ne.renderText(t,e,i)}definePath(t,e){e.type==="umlActor"?this.drawActorPath(t,e.x,e.y,e.width,e.height):e.type==="umlUseCase"||e.type==="umlInterface"?t.ellipse(e.x+e.width/2,e.y+e.height/2,e.width/2,e.height/2,0,0,Math.PI*2):e.type==="umlPackage"?this.drawPackagePath(t,e.x,e.y,e.width,e.height):e.type==="umlNote"?this.drawNotePath(t,e.x,e.y,e.width,e.height):(e.type==="umlComponent"||e.type==="umlLifeline"||e.type==="umlFragment")&&t.rect(e.x,e.y,e.width,e.height)}drawActorPath(t,e,i,r,s){const a=r*.15;t.moveTo(e+r/2+a,i+a),t.arc(e+r/2,i+a,a,0,Math.PI*2),t.moveTo(e+r/2,i+a*2),t.lineTo(e+r/2,i+s*.6),t.moveTo(e,i+s*.3),t.lineTo(e+r,i+s*.3),t.moveTo(e+r/2,i+s*.6),t.lineTo(e,i+s),t.moveTo(e+r/2,i+s*.6),t.lineTo(e+r,i+s)}drawPackagePath(t,e,i,r,s){const a=s*.15,o=r*.4;t.moveTo(e,i),t.lineTo(e+o,i),t.lineTo(e+o,i+a),t.lineTo(e+r,i+a),t.lineTo(e+r,i+s),t.lineTo(e,i+s),t.closePath()}drawNotePath(t,e,i,r,s){const a=Math.min(r,s)*.15;t.moveTo(e,i),t.lineTo(e+r-a,i),t.lineTo(e+r,i+a),t.lineTo(e+r,i+s),t.lineTo(e,i+s),t.closePath()}}class l3 extends hr{renderArchitectural(t,e,i){const{ctx:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);r.beginPath(),o>0?r.roundRect(s.x,s.y,s.width,s.height,o):r.rect(s.x,s.y,s.width,s.height),r.fillStyle=l.fill||"transparent",l.fill&&l.fill!=="none"&&r.fill(),r.lineWidth=s.strokeWidth,r.strokeStyle=l.stroke||"#000000",r.stroke();const c=this.calculateLayout(r,s);this.drawDivider(r,s,c,l.stroke||"#000000",!1),this.renderTexts(t,s,c)}renderSketch(t,e,i){const{rc:r,element:s,isDarkMode:a}=t,o=this.getRadius(s),l=ne.buildRenderOptions(s,a);if(o>0){const f=this.getRoundedRectPath(s.x,s.y,s.width,s.height,o);r.path(f,l)}else r.rectangle(s.x,s.y,s.width,s.height,l);const c=eb(),h=this.calculateLayout(c,s);this.drawDivider(null,s,h,l.stroke||"#000000",!0,r,l),this.renderTexts(t,s,h)}definePath(t,e){const i=this.getRadius(e);i>0?t.roundRect(e.x,e.y,e.width,e.height,i):t.rect(e.x,e.y,e.width,e.height)}getRadius(t){return Math.min(Math.abs(t.width),Math.abs(t.height))*.15}getRoundedRectPath(t,e,i,r,s){const a=Math.min(Math.abs(i)/2,s),o=Math.min(Math.abs(r)/2,s);return`M ${t+a} ${e} L ${t+i-a} ${e} Q ${t+i} ${e} ${t+i} ${e+o} L ${t+i} ${e+r-o} Q ${t+i} ${e+r} ${t+i-a} ${e+r} L ${t+a} ${e+r} Q ${t} ${e+r} ${t} ${e+r-o} L ${t} ${e+o} Q ${t} ${e} ${t+a} ${e}`}calculateLayout(t,e){const i=e.containerText||"";let r=Math.min(e.height,35);if(i){const s=Jr(t,e,i,e.width-20);r=Math.max(r,s.textHeight+15)}return{headerHeight:r}}drawDivider(t,e,i,r,s,a,o){const l=e.y+i.headerHeight;l<e.y+e.height&&(s&&a?a.line(e.x,l,e.x+e.width,l,o):t&&(t.strokeStyle=r,t.lineWidth=1,t.beginPath(),t.moveTo(e.x,l),t.lineTo(e.x+e.width,l),t.stroke()))}renderTexts(t,e,i){const{ctx:r,isDarkMode:s}=t;if(e.containerText&&this.renderSectionText(r,e,e.containerText,e.x+e.width/2,e.y+i.headerHeight/2,e.width-20,"center",!0,s),e.attributesText){const a=e.y+i.headerHeight+5,o=(e.fontSize||20)*.9;this.renderSectionText(r,{...e,fontSize:o},e.attributesText,e.x+10,a,e.width-20,"left",!1,s)}}renderSectionText(t,e,i,r,s,a,o,l,c){if(!i)return;t.save(),t.font=xc({...e,fontWeight:l?"bold":e.fontWeight});const h=ne.adjustColor(e.strokeColor||"#000",c);t.fillStyle=h,t.textAlign=o,t.textBaseline=o==="center"?"middle":"top";const f=Jr(t,e,i,a);f.lines.forEach((d,u)=>{const y=s+u*f.lineHeight-(o==="center"?(f.lines.length-1)*f.lineHeight/2:0);t.fillText(d,r,y)}),t.restore()}}function c3(){console.log("Registering all shapes including specialty..."),qn.register("rectangle",new qx),qn.register("circle",new Xx),qn.register("diamond",new Gx),qn.register("text",new Hx),qn.register("image",new Yx),qn.register("stickyNote",new Vx);const n=new Zx;["triangle","hexagon","octagon","parallelogram","trapezoid","rightTriangle","pentagon","septagon","polygon"].forEach(U=>qn.register(U,n));const e=new Kx;["database","document","predefinedProcess","internalStorage"].forEach(U=>qn.register(U,e));const r=new Qx;["starPerson","lightbulb","signpost","burstBlob","scroll","wavyDivider","doubleBanner"].forEach(U=>qn.register(U,r));const a=new Jx;["server","loadBalancer","firewall","user","messageQueue","lambda","router"].forEach(U=>qn.register(U,a));const l=new t3;["browserWindow","mobilePhone"].forEach(U=>qn.register(U,l));const h=new e3;["organicBranch"].forEach(U=>qn.register(U,h));const d=new n3;["browser","ghostButton","inputField"].forEach(U=>qn.register(U,d));const y=new r3;qn.register("line",y),qn.register("arrow",y),qn.register("bezier",y);const g=new i3;["fineliner","inkbrush","marker","ink"].forEach(U=>qn.register(U,g));const m=new s3;["cloud","heart","star","burst","callout","speechBubble","ribbon","bracketLeft","bracketRight","cross","checkmark","capsule","arrowLeft","arrowRight","arrowUp","arrowDown","dfdProcess","dfdDataStore","isometricCube","solidBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","perspectiveBlock","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].forEach(U=>qn.register(U,m));const _=new o3;qn.register("umlClass",_);const L=new l3;qn.register("umlState",L);const T=new a3;["umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlLifeline","umlFragment"].forEach(U=>qn.register(U,T))}var h3=Gn(\'<div class=presentation-hud style="position:fixed;bottom:40px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:12px;padding:8px 16px;background:rgba(255, 255, 255, 0.8);backdrop-filter:blur(12px);border-radius:100px;box-shadow:0 10px 25px rgba(0, 0, 0, 0.2);z-index:10000;border:1px solid rgba(255, 255, 255, 0.3);transition:opacity 0.3s ease;font-family:Inter, sans-serif"><button style="background:none;border:none;color:#1e293b;cursor:pointer;display:flex;padding:8px;border-radius:50%;transition:background 0.2s"></button><div style=color:#64748b;font-size:13px;font-weight:600;min-width:100px;text-align:center;user-select:none></div><button style="background:none;border:none;color:#1e293b;cursor:pointer;display:flex;padding:8px;border-radius:50%;transition:background 0.2s"></button><div style="width:1px;height:24px;background:rgba(0,0,0,0.1);margin:0 8px"></div><div style=display:flex;align-items:center;gap:4px><button title="Pointer (Advance Slides)"style="border:none;cursor:pointer;display:flex;padding:8px;border-radius:8px;transition:all 0.2s"></button><button title="Laser Pointer"style="border:none;cursor:pointer;display:flex;padding:8px;border-radius:8px;transition:all 0.2s"></button><button title="Ink Highlighter"style="border:none;cursor:pointer;display:flex;padding:8px;border-radius:8px;transition:all 0.2s"></button><button title=Eraser style="border:none;cursor:pointer;display:flex;padding:8px;border-radius:8px;transition:all 0.2s"></button></div><div style="width:1px;height:24px;background:rgba(0,0,0,0.1);margin:0 8px"></div><button title="Exit Presentation"style="background:#f1f5f9;border:none;color:#ef4444;cursor:pointer;display:flex;padding:8px;border-radius:50%;transition:transform 0.2s">\');const u3=()=>{const[n,t]=En(!0);let e;const i=()=>{t(!0),window.clearTimeout(e),e=window.setTimeout(()=>{C.appMode==="presentation"&&t(!1)},3e3)};No(()=>{window.addEventListener("mousemove",i),i()}),Hs(()=>{window.removeEventListener("mousemove",i),window.clearTimeout(e)});const r=si(()=>`Slide ${C.activeSlideIndex+1} of ${C.slides.length}`),s=async()=>{await D1(),i()},a=async()=>{await U5(),i()};return Re(rr,{get when(){return n()},get children(){var o=h3(),l=o.firstChild,c=l.nextSibling,h=c.nextSibling,f=h.nextSibling,d=f.nextSibling,u=d.firstChild,y=u.nextSibling,g=y.nextSibling,w=g.nextSibling,m=d.nextSibling,x=m.nextSibling;return l.addEventListener("mouseleave",_=>_.currentTarget.style.background="none"),l.addEventListener("mouseenter",_=>_.currentTarget.style.background="rgba(0,0,0,0.05)"),l.$$click=a,yn(l,Re(Py,{size:20})),yn(c,r),h.addEventListener("mouseleave",_=>_.currentTarget.style.background="none"),h.addEventListener("mouseenter",_=>_.currentTarget.style.background="rgba(0,0,0,0.05)"),h.$$click=s,yn(h,Re(Ry,{size:20})),u.$$click=()=>wo("selection"),yn(u,Re(Ky,{size:18})),y.$$click=()=>wo("laser"),yn(y,Re(s5,{size:18})),g.$$click=()=>wo("ink"),yn(g,Re(Uy,{size:18})),w.$$click=()=>wo("eraser"),yn(w,Re($y,{size:18})),x.addEventListener("mouseleave",_=>_.currentTarget.style.transform="scale(1)"),x.addEventListener("mouseenter",_=>_.currentTarget.style.transform="scale(1.1)"),x.$$click=()=>rm(),yn(x,Re(ku,{size:18})),Ar(_=>{var L=C.selectedTool==="selection"?"rgba(59, 130, 246, 0.1)":"none",T=C.selectedTool==="selection"?"#3b82f6":"#64748b",q=C.selectedTool==="laser"?"rgba(245, 158, 11, 0.1)":"none",U=C.selectedTool==="laser"?"#f59e0b":"#64748b",B=C.selectedTool==="ink"?"rgba(239, 68, 68, 0.1)":"none",O=C.selectedTool==="ink"?"#ef4444":"#64748b",X=C.selectedTool==="eraser"?"rgba(100, 116, 139, 0.1)":"none",R=C.selectedTool==="eraser"?"#475569":"#64748b";return L!==_.e&&Ln(u,"background",_.e=L),T!==_.t&&Ln(u,"color",_.t=T),q!==_.a&&Ln(y,"background",_.a=q),U!==_.o&&Ln(y,"color",_.o=U),B!==_.i&&Ln(g,"background",_.i=B),O!==_.n&&Ln(g,"color",_.n=O),X!==_.s&&Ln(w,"background",_.s=X),R!==_.h&&Ln(w,"color",_.h=R),_},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0}),o}})};Zs(["click"]);var f3=Gn("<div class=canvas-container>"),d3=Gn("<div class=player-controls>"),p3=Gn("<div class=player-app>");const g3=()=>{const[n,t]=En(!1);return No(()=>{if(c3(),window.__PRESENTATION_DATA__)try{if(W5(window.__PRESENTATION_DATA__),Kt("appMode","presentation"),Kt("showMainToolbar",!1),Kt("showPropertyPanel",!1),Kt("showLayerPanel",!1),Kt("showSlideNavigator",!1),Kt("showSlideToolbar",!0),Kt("readOnly",!1),C.docType==="slides"&&C.slides.length>0){Kt("activeSlideIndex",0);const e=C.slides[0];Kt("viewState",{scale:1,panX:-e.spatialPosition.x,panY:-e.spatialPosition.y});let i=C.activeLayerId;C.layers.length===0?(Kt("layers",[{id:"default",name:"Layer 1",visible:!0,locked:!1,opacity:1,order:0,backgroundColor:"transparent"}]),i="default",Kt("activeLayerId","default")):C.layers.find(r=>r.id===i)||(i=C.layers[0].id,Kt("activeLayerId",i)),Kt("elements",r=>!C.layers.some(s=>s.id===r.layerId),r=>({layerId:i})),Kt("layers",r=>!0,{visible:!0,opacity:1})}t(!0)}catch(e){console.error("Failed to load presentation data:",e),Mi("Failed to load presentation data","error")}else Mi("No presentation data found","error")}),(()=>{var e=p3();return yn(e,Re(rr,{get when(){return n()},get children(){return[(()=>{var i=f3();return yn(i,Re(Ux,{})),i})(),(()=>{var i=d3();return yn(i,Re(u3,{})),i})()]}}),null),yn(e,Re(l5,{}),null),e})()},y3=document.getElementById("root");Kg(()=>Re(g3,{}),y3);export{An as _,ce as a,Il as c,m5 as f,M3 as g,C as s};\n',By=`:root{--font-hand: "Handlee", "Comic Sans MS", cursive;--font-sans: "Inter", system-ui, sans-serif;--font-mono: "Source Code Pro", "Cascadia Code", monospace;font-family:var(--font-sans);line-height:1.5;font-weight:400;--bg-canvas: #ffffff;--bg-panel: #ffffff;--bg-secondary: #f9fafb;--text-primary: #111827;--text-secondary: #6b7280;--border-color: #e5e7eb;--btn-bg: #ffffff;--btn-hover: #f3f4f6;--btn-active: #e5e7eb;--primary-color: #3b82f6;--danger-color: #ef4444;--shadow-sm: 0 1px 2px rgba(0, 0, 0, .05);color-scheme:light dark;color:var(--text-primary);background-color:var(--bg-canvas);font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}[data-theme=dark]{--bg-canvas: #121212;--bg-panel: #1e1e1e;--bg-secondary: #2d2d2d;--text-primary: #e5e7eb;--text-secondary: #9ca3af;--border-color: #404040;--btn-bg: #2d2d2d;--btn-hover: #3d3d3d;--btn-active: #4d4d4d;--primary-color: #60a5fa;--danger-color: #f87171;--shadow-sm: 0 1px 2px rgba(0, 0, 0, .5)}body{margin:0;padding:0;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;background-color:var(--bg-canvas);color:var(--text-primary)}button{border-radius:6px;border:1px solid var(--border-color);padding:8px 12px;font-size:14px;font-weight:500;font-family:inherit;background-color:var(--btn-bg);color:var(--text-primary);cursor:pointer;transition:all .2s;box-shadow:var(--shadow-sm)}button:hover{background-color:var(--btn-hover);border-color:var(--border-color)}button:active{background-color:var(--btn-active);transform:translateY(1px)}button.active{background-color:#3b82f61a;border-color:var(--primary-color);color:var(--primary-color)}input[type=text]{border-radius:6px;border:1px solid var(--border-color);padding:8px 12px;font-family:inherit;font-size:14px;outline:none;background-color:var(--bg-panel);color:var(--text-primary);transition:border-color .2s}input[type=text]:focus{border-color:var(--primary-color);box-shadow:0 0 0 2px #3b82f633}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{margin:0;padding:0;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}button{border-radius:6px;border:1px solid #ccc;padding:8px 12px;font-size:14px;font-weight:500;font-family:inherit;background-color:#fff;cursor:pointer;transition:all .2s;box-shadow:0 1px 2px #0000000d}button:hover{background-color:#f9f9f9;border-color:#bbb}button:active{background-color:#f0f0f0;transform:translateY(1px)}button.active{background-color:#e0efff;border-color:#007acc;color:#007acc}input[type=text]{border-radius:6px;border:1px solid #ccc;padding:8px 12px;font-family:inherit;font-size:14px;outline:none;transition:border-color .2s}input[type=text]:focus{border-color:#007acc;box-shadow:0 0 0 2px #007acc33}h1{font-size:3.2em;line-height:1.1}button{border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:border-color .25s}button:hover{border-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}@media(prefers-color-scheme:light){:root{color:#213547;background-color:#fff}a:hover{color:#747bff}button{background-color:#f9f9f9}}.unselectable{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.minimap-container{position:fixed;bottom:20px;right:20px;z-index:1000;background:var(--bg-panel);border:1px solid var(--border-color);border-radius:8px;box-shadow:0 4px 12px #00000026;padding:8px;-webkit-user-select:none;user-select:none}.minimap-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;padding:0 4px}.minimap-title{font-size:11px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:.5px}.minimap-close{background:transparent;border:none;padding:2px;cursor:pointer;color:var(--text-secondary);display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background-color .2s,color .2s;box-shadow:none}.minimap-close:hover{background-color:var(--btn-hover);color:var(--text-primary)}.minimap-canvas{display:block;border-radius:4px;cursor:pointer;border:1px solid var(--border-color)}.minimap-canvas:active{cursor:grabbing}.floating-settings-btn{transition:all .2s ease}.floating-settings-btn:hover{transform:scale(1.1)}.floating-settings-btn.active{background:#3b82f6!important;color:#fff!important}.toast{position:fixed;bottom:24px;left:50%;transform:translate(-50%);background:var(--bg-panel);color:var(--text-primary);padding:12px 16px;border-radius:8px;box-shadow:0 4px 20px #00000026;display:flex;align-items:center;gap:12px;z-index:2000;-webkit-user-select:none;user-select:none;font-size:14px;font-weight:500;border:1px solid var(--border-color);animation:slideUp .3s cubic-bezier(.16,1,.3,1);min-width:300px;max-width:90vw}.toast-success{border-left:4px solid #10b981}.toast-error{border-left:4px solid #ef4444}.toast-info{border-left:4px solid #3b82f6}.toast-icon{display:flex;align-items:center;justify-content:center}.toast-success .toast-icon{color:#10b981}.toast-error .toast-icon{color:#ef4444}.toast-info .toast-icon{color:#3b82f6}.toast-message{flex:1}.toast-close{background:none;border:none;cursor:pointer;color:var(--text-secondary);padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:background .2s}.toast-close:hover{background:var(--bg-hover);color:var(--text-primary)}@keyframes slideUp{0%{opacity:0;transform:translate(-50%,20px)}to{opacity:1;transform:translate(-50%)}}.toast-loading{border-left:4px solid #f59e0b}.toast-loading .toast-icon{color:#f59e0b}.spin{animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.context-menu{position:fixed;background:var(--bg-panel);border:1px solid var(--border-color);border-radius:8px;box-shadow:0 4px 20px #00000026;padding:4px;min-width:220px;max-height:80vh;overflow-y:auto;overflow-x:visible;z-index:10000;-webkit-user-select:none;user-select:none;font-size:14px}.menu-item-wrapper{position:relative}.context-menu-item{width:100%;display:flex;align-items:center;gap:8px;padding:8px 12px;border:none;background:transparent;color:var(--text-primary);cursor:pointer;border-radius:4px;text-align:left;transition:background .15s;font-size:13px}.context-menu-item:hover:not(.disabled){background:var(--btn-hover)}.context-menu-item.disabled{opacity:.4;cursor:not-allowed}.menu-item-check{width:16px;flex-shrink:0;font-size:12px;color:#3b82f6}.menu-item-label{flex:1}.menu-item-shortcut{font-size:11px;color:var(--text-secondary);opacity:.6;font-family:monospace}.context-menu-separator{height:1px;background:var(--border-color);margin:4px 8px}[data-theme=dark] .context-menu{box-shadow:0 4px 20px #0006}.recording-overlay{position:fixed;top:20px;left:50%;transform:translate(-50%);background:#000000d9;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);padding:8px 16px;border-radius:24px;display:flex;align-items:center;gap:16px;z-index:99999;box-shadow:0 4px 12px #0003;border:1px solid rgba(255,255,255,.1);color:#fff;font-family:Inter,sans-serif;animation:slideDown .3s cubic-bezier(.16,1,.3,1)}@keyframes slideDown{0%{transform:translate(-50%,-20px);opacity:0}to{transform:translate(-50%);opacity:1}}.recording-indicator{display:flex;align-items:center;gap:6px}.pulse-dot{width:10px;height:10px;background-color:#ff3b30;border-radius:50%;animation:pulse 1.5s infinite}@keyframes pulse{0%{transform:scale(.95);box-shadow:0 0 #ff3b30b3}70%{transform:scale(1);box-shadow:0 0 0 6px #ff3b3000}to{transform:scale(.95);box-shadow:0 0 #ff3b3000}}.recording-text{font-weight:700;font-size:12px;letter-spacing:.5px;color:#ff3b30}.recording-timer{font-variant-numeric:tabular-nums;font-size:14px;font-weight:500;min-width:36px}.stop-btn{display:flex;align-items:center;gap:6px;background:#ffffff1a;border:none;padding:6px 12px;border-radius:16px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}.stop-btn:hover{background:#fff3;transform:translateY(-1px)}.stop-btn:active{transform:translateY(0)}.player-app{width:100vw;height:100vh;overflow:hidden;position:relative;background-color:var(--bg-canvas);color:var(--text-primary)}.player-app .canvas-container{width:100%;height:100%}.player-controls{position:fixed;bottom:20px;left:50%;transform:translate(-50%);z-index:1000}.selection-box,.transform-handle,.resize-handle{display:none!important}
`,co=async i=>{try{const n=await(await fetch(i)).blob();return new Promise((r,e)=>{const o=new FileReader;o.onloadend=()=>r(o.result),o.onerror=e,o.readAsDataURL(n)})}catch(t){return console.warn(`Failed to convert ${i} to base64`,t),i}},Dy=async i=>{const t=JSON.parse(JSON.stringify(i));for(const n of t.elements)n.type==="image"&&n.src&&n.src.startsWith("blob:")&&(n.src=await co(n.src));for(const n of t.slides)n.background?.type==="image"&&n.background.url?.startsWith("blob:")&&(n.background.url=await co(n.background.url));return t},zy=async(i,t)=>{const n=await Dy(i),r={isStandalone:!0,generatedAt:new Date().toISOString()},e=`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${n.metadata.name||"Presentation"} - Yappy</title>
    <style>
        /* Reset and Base Styles */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        
        /* Player CSS */
        ${By}
        
        /* Loading Screen */
        #loader {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #1e293b; color: white; display: flex;
            align-items: center; justify-content: center;
            font-family: system-ui, sans-serif; z-index: 9999;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body>
    <div id="loader">Loading Presentation...</div>
    <div id="root"></div>

    <script>
        window.__PRESENTATION_DATA__ = ${JSON.stringify(n)};
        window.__YAPPY_FLAGS__ = ${JSON.stringify(r)};
        
        // Hide loader when app mounts (can be triggered by app)
        window.addEventListener('load', () => {
             // Fallback if app doesn't hide it
             setTimeout(() => {
                 const loader = document.getElementById('loader');
                 if(loader) loader.style.opacity = '0';
                 setTimeout(() => loader?.remove(), 500);
             }, 1000);
        });
    <\/script>
    
    <script type="module">
        ${Oy}
    <\/script>
</body>
</html>`,o=new Blob([e],{type:"text/html"}),l=URL.createObjectURL(o),s=document.createElement("a");s.href=l,s.download=`${t}.html`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)};var Fy=$("<div class=menu-backdrop>"),Wy=$("<input type=file accept=.json,.yappy style=display:none>"),jy=$("<div class=app-title>"),Uy=$("<div class=menu-item><span class=label>Slide Toolbar</span><div class=menu-item-right>"),qy=$("<div class=menu-item><span class=label>Slide Panel</span><div class=menu-item-right>"),Hy=$('<div class=menu-dropdown><button class=menu-item><span class=label>New Infinite Drawing</span></button><button class=menu-item><span class=label>New Presentation</span></button><div class=menu-separator></div><button class=menu-item><span class=label>Load Sketch...</span></button><button class=menu-item><span class=label>Export / Save...</span></button><button class=menu-item><span class=label>Export</span><div class=menu-item-right><span class=shortcut>Ctrl+Shift+E</span></div></button><div class=menu-separator></div><div class=menu-item><span class=label>Properties Panel</span><div class=menu-item-right><span class=shortcut>Alt+Enter</span></div></div><div class=menu-item><span class=label>Layers Panel</span><div class=menu-item-right><span class=shortcut>Alt+L</span></div></div><div class=menu-item><span class=label>Display States</span><div class=menu-item-right></div></div><div class=menu-item><span class=label>Minimap</span><div class=menu-item-right><span class=shortcut>Alt+M</span></div></div><div class=menu-item><span class=label>Action Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><div class=menu-header>View</div><div class=menu-item><span class=label>Drawing Toolbar</span><div class=menu-item-right></div></div><div class=menu-separator></div><button class=menu-item><span class=label>Templates</span></button><div class=menu-separator></div><div style="padding:4px 12px;font-size:12px;color:var(--text-secondary)">Found a bug? <a href=https://github.com/rajeshpillai/yappy/issues target=_blank rel="noopener noreferrer">Report'),Yy=$('<div style=position:fixed;top:12px;left:12px;z-index:10001><div class=menu-container style=position:relative><div class="drag-handle sm"><div class=drag-dots></div></div><button title=Menu></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title=Delete></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Zoom to Fit">'),Xy=$('<div class=menu-dropdown style="position:absolute;top:100%;right:0;margin:8px 0 0 0;padding:4px;width:auto;min-width:180px">'),Gy=$('<div style=position:fixed;top:12px;right:12px;z-index:10000><div class=menu-container><div class="drag-handle sm"><div class=drag-dots></div></div><button class=menu-btn title="Play All Animations"></button><button class=menu-btn></button><button class=menu-btn title="Stop All Animations"></button><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><div style=position:relative><button title="P3 Color Palette"></button></div><div style="width:1px;height:24px;background:var(--border-color);margin:0 4px"></div><button class=menu-btn title="Toggle Theme">');const Vy=_t(()=>Ct(()=>import("./help-dialog-DSBV5Qx-.js"),__vite__mapDeps([4,1,2,5]),import.meta.url)),Qy=_t(()=>Ct(()=>import("./load-export-dialog-BYs88Bjr.js"),__vite__mapDeps([6,1,2,3,7]),import.meta.url)),Zy=_t(()=>Ct(()=>import("./file-open-dialog-ClqvdtWH.js"),__vite__mapDeps([8,1,2,3,9]),import.meta.url)),Jy=_t(()=>Ct(()=>import("./export-dialog-DHqTuauA.js"),__vite__mapDeps([10,1,2,3,11]),import.meta.url)),Ky=_t(()=>Ct(()=>import("./save-dialog-C4iCAfhC.js"),__vite__mapDeps([12,1,2,13]),import.meta.url)),t1=_t(()=>Ct(()=>import("./template-browser-7TWYuBWm.js"),__vite__mapDeps([14,1,2,15]),import.meta.url)),[ze,We]=H("default"),[Xa,Bn]=H(!1),[Ga,Va]=H(!1),[Qa,qt]=H(!1),[Za,Yi]=H(!1);let Xi=()=>{};const Pi=i=>{typeof Xi=="function"&&(Xi(i),Va(!0))},Gi=(i="slides")=>{confirm(`Start new ${i==="slides"?"presentation":"sketch"}? Unsaved changes will be lost.`)&&(wa(i),We("default"))},e1=()=>{const[i,t]=H(!1),[n,r]=H("load");let e;const[o,l]=H("workspace");Xi=l;const[s,a]=H(!1),[c,h]=H(!1);let d;ct(()=>{c()&&d&&Ny(d,()=>()=>h(!1))}),window.triggerImageUpload=()=>e?.click();const u=async W=>{try{nt("Saving...","loading",0),We(W),Xe();const Y={version:4,metadata:{name:W,updatedAt:new Date().toISOString(),docType:b.docType},elements:JSON.parse(JSON.stringify(b.elements)),layers:JSON.parse(JSON.stringify(b.layers)),slides:JSON.parse(JSON.stringify(b.slides)),globalSettings:JSON.parse(JSON.stringify(b.globalSettings)),gridSettings:JSON.parse(JSON.stringify(b.gridSettings)),states:JSON.parse(JSON.stringify(b.states))},lt=W.replace(/\.(json|yappy)$/i,"");if(o()==="workspace"){if(!my.enableWorkspacePersistence){nt("Workspace saving is disabled","error");return}await lo.saveDrawing(W,Y),nt("Drawing saved successfully!","success")}else{const gt=JSON.stringify(Y,null,2);let yt,ut,Et;if(o()==="disk-json")yt=new Blob([gt],{type:"application/json"}),ut=`${lt}.json`,Et="application/json";else{const At=new Blob([gt]).stream().pipeThrough(new CompressionStream("gzip"));yt=await new Response(At).blob(),ut=`${lt}.yappy`,Et="application/gzip"}const Mt=new File([yt],ut,{type:Et});if(navigator.canShare&&navigator.canShare({files:[Mt]}))try{await navigator.share({files:[Mt],title:"Yappy Drawing",text:o()==="disk-json"?"Save your drawing JSON":"Save your compressed drawing"});return}catch(At){At.name!=="AbortError"&&console.error("Share failed:",At)}const et=URL.createObjectURL(yt),wt=document.createElement("a");wt.href=et,wt.download=ut,document.body.appendChild(wt),wt.click(),document.body.removeChild(wt),URL.revokeObjectURL(et)}}catch(Y){console.error("Save failed:",Y),nt(`Failed to save: ${Y instanceof Error?Y.message:String(Y)}`,"error")}},f=async W=>{const Y=W||ze();nt("Loading...","loading",0);try{const lt=await lo.loadDrawing(Y);if(lt){const gt=qi(lt)?lt:Hi(lt);Un(gt),We(Y),nt("Drawing loaded successfully","success")}else nt("Drawing not found","error")}catch(lt){console.error(lt),nt("Failed to load drawing","error")}},g=()=>{b.docType==="slides"?ie():yr()},p=W=>{b.elements.length>0&&!confirm("Loading a template will clear the current canvas. Continue?")||(_a(W.data),a(!1),nt(`Template "${W.metadata.name}" loaded`,"success"))},m=async W=>{const Y=W.target.files?.[0];if(Y){try{nt("Loading file...","loading",0);let lt;if(Y.name.endsWith(".yappy")||Y.type==="application/gzip"||Y.type==="application/x-gzip")try{const Et=new DecompressionStream("gzip"),Mt=Y.stream().pipeThrough(Et);lt=await new Response(Mt).text()}catch(Et){console.warn("Decompression failed, trying as plain text...",Et),lt=await Y.text()}else lt=await Y.text();const gt=JSON.parse(lt),yt=qi(gt)?gt:Hi(gt);Un(yt);const ut=Y.name.replace(/\.(json|yappy)$/i,"");We(ut),nt("File loaded successfully","success")}catch(lt){console.error(lt),nt("Failed to load file. It might be corrupted or invalid format.","error")}t(!1),W.target.value="",W.target.value=""}},y=async()=>{try{nt("Generating HTML...","loading",0),Xe();const W={version:4,metadata:{name:ze(),updatedAt:new Date().toISOString(),docType:b.docType},elements:JSON.parse(JSON.stringify(b.elements)),layers:JSON.parse(JSON.stringify(b.layers)),slides:JSON.parse(JSON.stringify(b.slides)),globalSettings:JSON.parse(JSON.stringify(b.globalSettings)),gridSettings:JSON.parse(JSON.stringify(b.gridSettings)),states:JSON.parse(JSON.stringify(b.states))};await zy(W,ze()),nt("HTML Exported successfully!","success"),qt(!1)}catch(W){console.error(W),nt("Failed to export HTML","error")}},[w,v]=H({x:0,y:0}),[x,k]=H(!1),[S,M]=H({x:0,y:0}),[C,R]=H({x:0,y:0}),[E,O]=H(!1),[z,F]=H({x:0,y:0}),U=W=>{const Y=W.target;if(Y.closest(".menu-container")||Y.classList.contains("app-title")||Y.classList.contains("drag-handle")){if(Y.tagName==="BUTTON"||Y.closest("button"))return;k(!0),M({x:W.clientX-w().x,y:W.clientY-w().y}),W.preventDefault()}},J=W=>{const Y=W.target;if(Y.closest(".menu-container")||Y.classList.contains("drag-handle")){if(Y.tagName==="BUTTON"||Y.closest("button"))return;O(!0),F({x:W.clientX-C().x,y:W.clientY-C().y}),W.preventDefault()}},rt=W=>{x()&&v({x:W.clientX-S().x,y:W.clientY-S().y}),E()&&R({x:W.clientX-z().x,y:W.clientY-z().y})},X=()=>{k(!1),O(!1)};return ye(()=>{window.addEventListener("mousemove",rt),window.addEventListener("mouseup",X),mt(()=>{window.removeEventListener("mousemove",rt),window.removeEventListener("mouseup",X)});const Y=new URLSearchParams(window.location.search).get("id");Y&&(We(Y),f(Y))}),[_(q,{get when(){return i()},get children(){var W=Fy();return W.$$click=()=>t(!1),W}}),(()=>{var W=Wy();W.addEventListener("change",m);var Y=e;return typeof Y=="function"?tt(Y,W):e=W,W})(),_(bo,{fallback:null,get children(){return[_(Zy,{get isOpen(){return Xa()},onClose:()=>Bn(!1),onSelect:W=>{f(W),Bn(!1)}}),_(Jy,{get isOpen(){return b.showExportDialog},onClose:()=>$n(!1)}),_(Ky,{get isOpen(){return Ga()},onClose:()=>Va(!1),onSave:u,get initialFilename(){return ze()}}),_(Vy,{get isOpen(){return Za()},onClose:()=>Yi(!1)}),_(Qy,{get isOpen(){return Qa()},get initialTab(){return n()},onClose:()=>qt(!1),onLoadWorkspace:()=>{qt(!1),Bn(!0)},onLoadDisk:()=>{qt(!1),e?.click()},onSaveWorkspace:()=>{qt(!1),Pi("workspace")},onSaveDisk:()=>{qt(!1),Pi("disk")},onSaveDiskJson:()=>{qt(!1),Pi("disk-json")},onExportImage:()=>{qt(!1),$n(!0)},onExportHtml:y}),_(t1,{get isOpen(){return s()},onClose:()=>a(!1),onSelectTemplate:p})]}}),_(q,{get when(){return!b.zenMode},get children(){var W=jy();return W.$$mousedown=U,I(W,ze),N(Y=>ot(W,"transform",`translate(calc(-50% + ${w().x}px), ${w().y}px)`)),W}}),_(q,{get when(){return!b.zenMode},get children(){return[(()=>{var W=Yy(),Y=W.firstChild,lt=Y.firstChild,gt=lt.nextSibling,yt=gt.nextSibling,ut=yt.nextSibling,Et=ut.nextSibling,Mt=Et.nextSibling;return Y.$$mousedown=U,gt.$$click=()=>t(!i()),I(gt,_(rc,{size:20})),I(Y,_(q,{get when(){return i()},get children(){var et=Hy(),wt=et.firstChild,At=wt.firstChild,Nt=wt.nextSibling,vt=Nt.firstChild,me=Nt.nextSibling,T=me.nextSibling,j=T.firstChild,G=T.nextSibling,K=G.firstChild,at=G.nextSibling,xt=at.firstChild,Ut=at.nextSibling,Qt=Ut.nextSibling,be=Qt.firstChild,Ot=be.nextSibling,di=Ot.firstChild,we=Qt.nextSibling,rn=we.firstChild,$r=rn.nextSibling,Ja=$r.firstChild,on=we.nextSibling,Rr=on.firstChild,Ka=Rr.nextSibling,sn=on.nextSibling,Er=sn.firstChild,Nr=Er.nextSibling,tl=Nr.firstChild,an=sn.nextSibling,Or=an.firstChild,el=Or.nextSibling,Br=an.nextSibling,nl=Br.nextSibling,Re=nl.nextSibling,Dr=Re.firstChild,il=Dr.nextSibling,rl=Re.nextSibling,ln=rl.nextSibling,ol=ln.firstChild,sl=ln.nextSibling;return sl.nextSibling,wt.$$click=()=>{Gi("infinite"),t(!1)},I(wt,_(fi,{size:16}),At),Nt.$$click=()=>{Gi("slides"),t(!1)},I(Nt,_(oc,{size:16}),vt),T.$$click=()=>{r("load"),qt(!0),t(!1)},I(T,_(sc,{size:16}),j),G.$$click=()=>{r("save"),qt(!0),t(!1)},I(G,_(ac,{size:16}),K),at.$$click=()=>{$n(!0),t(!1)},I(at,_(lc,{size:16}),xt),Qt.$$click=()=>{_e(),t(!1)},I(Qt,_(ke,{size:16}),be),I(Ot,_(q,{get when(){return b.showPropertyPanel},get children(){return _(Yt,{size:14,class:"check-icon"})}}),di),we.$$click=()=>{qn(),t(!1)},I(we,_(Zi,{size:16}),rn),I($r,_(q,{get when(){return b.showLayerPanel},get children(){return _(Yt,{size:14,class:"check-icon"})}}),Ja),on.$$click=()=>{ma(),t(!1)},I(on,_(cc,{size:16}),Rr),I(Ka,_(q,{get when(){return b.showStatePanel},get children(){return _(Yt,{size:14,class:"check-icon"})}})),sn.$$click=()=>{ai(),t(!1)},I(sn,_(fi,{size:16}),Er),I(Nr,_(q,{get when(){return b.minimapVisible},get children(){return _(Yt,{size:14,class:"check-icon"})}}),tl),an.$$click=()=>{Ma(),t(!1)},I(an,_(ke,{size:16}),Or),I(el,_(q,{get when(){return b.showUtilityToolbar},get children(){return _(Yt,{size:14,class:"check-icon"})}})),I(et,_(q,{get when(){return b.docType==="slides"},get children(){var Zt=Uy(),Ee=Zt.firstChild,ui=Ee.nextSibling;return Zt.$$click=()=>{Sa(),t(!1)},I(Zt,_(zr,{size:16}),Ee),I(ui,_(q,{get when(){return b.showSlideToolbar},get children(){return _(Yt,{size:14,class:"check-icon"})}})),Zt}}),Br),I(et,_(q,{get when(){return b.docType==="slides"},get children(){var Zt=qy(),Ee=Zt.firstChild,ui=Ee.nextSibling;return Zt.$$click=()=>{kr(),t(!1)},I(Zt,_(ke,{size:16}),Ee),I(ui,_(q,{get when(){return b.showSlideNavigator},get children(){return _(Yt,{size:14,class:"check-icon"})}})),Zt}}),Re),Re.$$click=()=>{Pa(),t(!1)},I(Re,_(ke,{size:16}),Dr),I(il,_(q,{get when(){return b.showMainToolbar},get children(){return _(Yt,{size:14,class:"check-icon"})}})),ln.$$click=()=>{a(!0),t(!1)},I(ln,_(ke,{size:16}),ol),et}}),yt),ut.$$click=()=>oe(b.selection),I(ut,_(hc,{size:18})),Mt.$$click=g,I(Mt,_(fi,{size:18})),N(et=>{var wt=`translate(${w().x}px, ${w().y}px)`,At=`menu-btn ${i()?"active":""}`,Nt=b.selection.length===0;return wt!==et.e&&ot(W,"transform",et.e=wt),At!==et.t&&it(gt,et.t=At),Nt!==et.a&&(ut.disabled=et.a=Nt),et},{e:void 0,t:void 0,a:void 0}),W})(),_(q,{get when(){return b.showUtilityToolbar},get children(){var W=Gy(),Y=W.firstChild,lt=Y.firstChild,gt=lt.nextSibling,yt=gt.nextSibling,ut=yt.nextSibling,Et=ut.nextSibling,Mt=Et.nextSibling,et=Mt.firstChild,wt=Mt.nextSibling,At=wt.nextSibling;Y.$$mousedown=J,gt.$$click=()=>Wn.playAll("programmatic"),I(gt,_(zr,{size:18,get color(){return ae()&&!Ht()?"#9ca3af":"#10b981"},get fill(){return ae()&&!Ht()?"#9ca3af":"#10b981"}})),yt.$$click=()=>Ht()?st.resumeAll():st.pauseAll(),I(yt,_(dc,{size:18,get color(){return!ae()&&!Ht()?"#9ca3af":"#f59e0b"},get fill(){return!ae()&&!Ht()?"#9ca3af":"#f59e0b"}})),ut.$$click=()=>Wn.stopAll(),I(ut,_(Kn,{size:18,color:"#ef4444",fill:"#ef4444"}));var Nt=d;return typeof Nt=="function"?tt(Nt,Mt):d=Mt,et.$$click=()=>h(!c()),I(et,_(uc,{size:18,color:"#f43f5e"})),I(Mt,_(q,{get when(){return c()},get children(){var vt=Xy();return I(vt,_(Ey,{})),vt}}),null),kt(At,"click",xa,!0),I(At,(()=>{var vt=$e(()=>b.theme==="dark");return()=>vt()?_(fc,{size:18}):_(pc,{size:18})})()),N(vt=>{var me=`translate(${C().x}px, ${C().y}px)`,T=ae()&&!Ht(),j=Ht()?"Resume Animations":"Pause Animations",G=!ae()&&!Ht(),K=!ae()&&!Ht(),at=`menu-btn ${c()?"active":""}`;return me!==vt.e&&ot(W,"transform",vt.e=me),T!==vt.t&&(gt.disabled=vt.t=T),j!==vt.a&&L(yt,"title",vt.a=j),G!==vt.o&&(yt.disabled=vt.o=G),K!==vt.i&&(ut.disabled=vt.i=K),at!==vt.n&&it(et,vt.n=at),vt},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),W}})]}})]};ht(["click","mousedown"]);var n1=$('<div class=zoom-container><div class=zoom-group><button class=zoom-btn title="Zoom Out"></button><button class="zoom-btn text-btn"title="Reset Zoom">%</button><button class=zoom-btn title="Zoom In"></button></div><div class=zoom-group style=margin-left:12px><button class=zoom-btn title="Undo (Ctrl+Z)"></button><button class=zoom-btn title="Redo (Ctrl+Y)">');const i1=()=>{const i=()=>{const e=Math.min(b.viewState.scale*1.1,10);n(e)},t=()=>{const e=Math.max(b.viewState.scale*.9,.1);n(e)},n=e=>{const{scale:o,panX:l,panY:s}=b.viewState,a=window.innerWidth/2,c=window.innerHeight/2,h=(a-l)/o,d=(c-s)/o,u=a-h*e,f=c-d*e;St({scale:e,panX:u,panY:f})},r=()=>{St({scale:1})};return(()=>{var e=n1(),o=e.firstChild,l=o.firstChild,s=l.nextSibling,a=s.firstChild,c=s.nextSibling,h=o.nextSibling,d=h.firstChild,u=d.nextSibling;return l.$$click=t,I(l,_(tr,{size:16})),s.$$click=r,I(s,()=>Math.round(b.viewState.scale*100),a),c.$$click=i,I(c,_(gc,{size:16})),kt(d,"click",sr,!0),I(d,_(yc,{size:16})),kt(u,"click",jn,!0),I(u,_(mc,{size:16})),N(f=>{var g=b.undoStackLength===0,p=b.redoStackLength===0;return g!==f.e&&(d.disabled=f.e=g),p!==f.t&&(u.disabled=f.t=p),f},{e:void 0,t:void 0}),e})()};ht(["click"]);class r1{steps=[];currentStepIndex=0;isPlaying=!1;isPaused=!1;activeAnimationIds=[];resolvePromise=null;add(t,n){return n&&n>0&&this.steps.push({type:"delay",delay:n}),this.steps.push({type:"animation",factory:t}),this}parallel(...t){return this.steps.push({type:"parallel",factories:t}),this}delay(t){return this.steps.push({type:"delay",delay:t}),this}call(t){return this.steps.push({type:"callback",callback:t}),this}play(){return this.isPaused?(this.isPaused=!1,this.isPlaying=!0,st.resumeAll(),Promise.resolve()):this.isPlaying?Promise.resolve():(this.isPlaying=!0,this.currentStepIndex=0,new Promise(t=>{this.resolvePromise=t,this.runNextStep()}))}pause(){this.isPlaying&&(this.isPaused=!0,this.isPlaying=!1,st.pauseAll())}stop(){this.isPlaying=!1,this.isPaused=!1,this.currentStepIndex=0;for(const t of this.activeAnimationIds)st.stop(t);this.activeAnimationIds=[],this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null)}reset(){this.stop(),this.currentStepIndex=0}get progress(){return this.steps.length===0?0:this.currentStepIndex/this.steps.length}get playing(){return this.isPlaying}get paused(){return this.isPaused}runNextStep(){if(!this.isPlaying||this.currentStepIndex>=this.steps.length){this.isPlaying=!1,this.resolvePromise&&(this.resolvePromise(),this.resolvePromise=null);return}const t=this.steps[this.currentStepIndex];switch(this.currentStepIndex++,t.type){case"animation":this.runAnimation(t.factory);break;case"parallel":this.runParallel(t.factories);break;case"delay":this.runDelay(t.delay);break;case"callback":t.callback?.(),this.runNextStep();break}}runAnimation(t){const n=t();if(!n){this.runNextStep();return}this.activeAnimationIds.push(n);const r=()=>{const e=st.getState(n);e===null||e==="completed"?(this.activeAnimationIds=this.activeAnimationIds.filter(o=>o!==n),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(r)};requestAnimationFrame(r)}runParallel(t){const n=t.map(e=>e()).filter(e=>e!=="");if(n.length===0){this.runNextStep();return}this.activeAnimationIds.push(...n);const r=()=>{let e=!0;for(const o of n){const l=st.getState(o);l!==null&&l!=="completed"&&(e=!1)}e?(this.activeAnimationIds=this.activeAnimationIds.filter(o=>!n.includes(o)),this.isPlaying&&this.runNextStep()):this.isPlaying&&!this.isPaused&&requestAnimationFrame(r)};requestAnimationFrame(r)}runDelay(t){setTimeout(()=>{this.isPlaying&&!this.isPaused&&this.runNextStep()},t)}}function o1(){return new r1}const s1={get state(){return b},createElement(i,t,n,r,e,o){const l=crypto.randomUUID(),s=b.defaultElementStyles,a={id:l,type:i,x:t,y:n,width:r,height:e,strokeColor:o?.strokeColor??s.strokeColor??"#000000",backgroundColor:o?.backgroundColor??s.backgroundColor??"transparent",fillStyle:o?.fillStyle??s.fillStyle??"solid",strokeWidth:o?.strokeWidth??s.strokeWidth??1,strokeStyle:o?.strokeStyle??s.strokeStyle??"solid",opacity:o?.opacity??s.opacity??100,roughness:o?.roughness??s.roughness??1,angle:o?.angle??0,renderStyle:s.renderStyle??"sketch",seed:o?.seed??Math.floor(Math.random()*2**31),roundness:o?.roundness??s.roundness??null,fontFamily:o?.fontFamily??s.fontFamily??"hand-drawn",fontSize:o?.fontSize??s.fontSize??28,textAlign:o?.textAlign??s.textAlign??"left",verticalAlign:o?.verticalAlign??"middle",startArrowhead:o?.startArrowhead??s.startArrowhead??null,endArrowhead:o?.endArrowhead??s.endArrowhead??"arrow",locked:o?.locked??!1,link:o?.link??null,layerId:o?.layerId??b.activeLayerId,curveType:o?.curveType??"straight",containerText:o?.containerText??"",parentId:o?.parentId??null,isCollapsed:o?.isCollapsed??!1,autoResize:o?.autoResize??!1,constrained:o?.constrained??!1,starPoints:o?.starPoints,polygonSides:o?.polygonSides,burstPoints:o?.burstPoints,borderRadius:o?.borderRadius,shadowEnabled:o?.shadowEnabled??!1,shadowColor:o?.shadowColor,shadowBlur:o?.shadowBlur,shadowOffsetX:o?.shadowOffsetX,shadowOffsetY:o?.shadowOffsetY,gradientStart:o?.gradientStart,gradientEnd:o?.gradientEnd,gradientDirection:o?.gradientDirection,gradientStops:o?.gradientStops,gradientType:o?.gradientType,gradientHandlePositions:o?.gradientHandlePositions,drawInnerBorder:o?.drawInnerBorder,innerBorderColor:o?.innerBorderColor,innerBorderDistance:o?.innerBorderDistance,strokeLineJoin:o?.strokeLineJoin,spinEnabled:o?.spinEnabled,spinSpeed:o?.spinSpeed,orbitEnabled:o?.orbitEnabled,orbitCenterId:o?.orbitCenterId,orbitRadius:o?.orbitRadius,orbitSpeed:o?.orbitSpeed,orbitDirection:o?.orbitDirection,flowAnimation:o?.flowAnimation,flowSpeed:o?.flowSpeed,flowStyle:o?.flowStyle,flowColor:o?.flowColor,flowDensity:o?.flowDensity,textColor:o?.textColor,textHighlightEnabled:o?.textHighlightEnabled??!1,textHighlightColor:o?.textHighlightColor,textHighlightPadding:o?.textHighlightPadding,textHighlightRadius:o?.textHighlightRadius,...o};return(a.type==="line"||a.type==="arrow"||a.type==="bezier")&&(a.curveType==="elbow"||a.curveType==="bezier"||a.type==="bezier")&&(!a.points||a.points.length===0)&&(a.points=[0,0,a.width,a.height]),ge(a),l},createRectangle(i,t,n,r,e){return this.createElement("rectangle",i,t,n,r,e)},createCircle(i,t,n,r,e){return this.createElement("circle",i,t,n,r,e)},createDiamond(i,t,n,r,e){return this.createElement("diamond",i,t,n,r,e)},createTriangle(i,t,n,r,e){return this.createElement("triangle",i,t,n,r,e)},createPolygonalShape(i,t,n,r,e,o){return this.createElement(i,t,n,r,e,o)},createStar(i,t,n,r,e=5,o){return this.createElement("star",i,t,n,r,{...o,starPoints:e})},createBrowserWindow(i,t,n,r,e){return this.createElement("browserWindow",i,t,n,r,e)},createStickyNote(i,t,n,r,e,o){return this.createElement("stickyNote",i,t,n,r,{...o,containerText:e})},createLine(i,t,n,r,e){const o=n-i,l=r-t;return this.createElement("line",i,t,o,l,e)},createArrow(i,t,n,r,e){const o=n-i,l=r-t;return this.createElement("arrow",i,t,o,l,{...e})},createBezier(i,t,n,r,e){const o=n-i,l=r-t;return this.createElement("bezier",i,t,o,l,{...e,curveType:"bezier"})},createOrganicBranch(i,t,n,r,e){const o=n-i,l=r-t;return this.createElement("organicBranch",i,t,o,l,{...e,curveType:"bezier",strokeWidth:e?.strokeWidth??3})},createText(i,t,n,r){const e=crypto.randomUUID(),o=b.defaultElementStyles,l=r?.fontSize??o.fontSize??28,s=n.length*(l*.6),a={id:e,type:"text",x:i,y:t,width:s,height:l*1.5,text:n,strokeColor:r?.strokeColor??o.strokeColor??"#000000",backgroundColor:"transparent",fillStyle:"solid",strokeWidth:1,strokeStyle:"solid",opacity:r?.opacity??100,roughness:0,angle:r?.angle??0,renderStyle:"sketch",seed:Math.floor(Math.random()*2**31),roundness:null,fontFamily:r?.fontFamily??o.fontFamily??"hand-drawn",fontSize:l,textAlign:r?.textAlign??o.textAlign??"left",verticalAlign:r?.verticalAlign??"middle",locked:!1,link:null,layerId:r?.layerId??b.activeLayerId,...r};return ge(a),e},createImage(i,t,n,r,e,o){return this.createElement("image",i,t,r,e,{...o,backgroundColor:"transparent",fillStyle:"solid",dataURL:n,status:"loaded"})},getElement(i){return b.elements.find(t=>t.id===i)},updateElement(i,t){D(i,t,!0)},deleteElement(i){oe([i])},clear(){b.elements.length>0&&(Q(),P("elements",[]),P("selection",[]))},setSelected(i){P("selection",i)},clearSelection(){P("selection",[])},setView(i,t,n){St({scale:i,panX:t,panY:n})},updateGridSettings(i){P("gridSettings",t=>({...t,...i}))},updateDefaultStyles(i){P("defaultElementStyles",t=>({...t,...i}))},async zoomToFit(){yr()},connect(i,t,n){const r=this.getElement(i),e=this.getElement(t);if(!r||!e)return console.error("Source or Target element not found"),null;const o=r.x+r.width/2,l=r.y+r.height/2,s=e.x+e.width/2,a=e.y+e.height/2,c=n?.type??"arrow",h=n?.curveType??"bezier",d=(m,y,w,v,x)=>{const k=x.x+x.width/2,S=x.y+x.height/2,M=x.width/2,C=x.height/2,R=w-m,E=v-y;if(R===0&&E===0)return{x:m,y};const O=Math.atan2(E,R);if(x.type==="diamond"){const X=Math.abs(Math.tan(O)),W=1/(1/M+X/C),Y=(R>0?1:-1)*W,lt=Y*Math.tan(O);return{x:k+Y,y:S+lt}}if(["circle","star","octagon","hexagon"].includes(x.type)){const X=Math.cos(O),W=Math.sin(O);return{x:k+M*X,y:S+C*W}}const z=R>0?k+M:k-M,F=S+Math.tan(O)*(z-k),U=E>0?S+C:S-C,J=k+(U-S)/Math.tan(O);return F>=S-C-1&&F<=S+C+1?{x:z,y:F}:{x:J,y:U}},u=d(o,l,s,a,r),f=d(s,a,o,l,e),g=this.createElement(c,u.x,u.y,f.x-u.x,f.y-u.y,{...n,curveType:h,startBinding:{elementId:i,focus:0,gap:5},endBinding:{elementId:t,focus:0,gap:5},points:[0,0,f.x-u.x,f.y-u.y]}),p=(m,y)=>{const w=m.boundElements||[];w.find(v=>v.id===y)||this.updateElement(m.id,{boundElements:[...w,{id:y,type:c}]})};return p(r,g),p(e,g),g},undo(){sr()},redo(){jn()},groupSelection(){pr()},ungroupSelection(){gr()},duplicate(i){va(i)},toggleTheme(){xa()},addLayer(i){return ka(i)},deleteLayer(i){fh(i)},setActiveLayer(i){mr(i)},mergeLayerDown(i){mh(i)},flattenLayers(){bh()},isolateLayer(i){wh(i)},showAllLayers(){vh()},updateLayer(i,t){ph(i,t)},duplicateLayer(i){gh(i)},reorderLayers(i,t){$i(i,t)},moveElementsToLayer(i,t){xh(i,t)},createLayerGroup(i){Oh(i)},toggleLayerGroupExpansion(i){Bh(i)},isLayerVisible(i){return Vt(i)},isLayerLocked(i){return br(i)},toggleGrid(){wr()},toggleSnapToGrid(){vr()},addDisplayState(i){hh(i)},updateDisplayState(i){dh(i)},deleteDisplayState(i){uh(i)},applyDisplayState(i,t=!0){si(i,t)},toggleStatePanel(i){ma(i)},applyNextState(){ur()},applyPreviousState(){fr()},addChildNode(i){ar(i)},addSiblingNode(i){lr(i)},toggleCollapseSelection(){ua()},toggleCollapse(i){Sr(i)},setParent(i,t){Aa(i,t)},reorderMindmap(i,t){Se(i,t)},applyMindmapStyling(i){Ta(i)},toggleCommandPalette(i){Ca(i)},togglePropertyPanel(i){_e(i)},togglePresentationMode(i){Rn(i)},toggleLayerPanel(i){qn(i)},toggleMinimap(i){ai(i)},toggleZenMode(i){xr(i)},toggleSlideNavigator(i){kr(i)},toggleMainToolbar(i){Pa(i)},toggleUtilityToolbar(i){Ma(i)},toggleSlideToolbar(i){Sa(i)},setSlideToolbarPosition(i,t){Nh(i,t)},addSlide(){ya()},deleteSlide(i){sh(i)},duplicateSlide(i){oh(i)},setActiveSlide(i){Gt(i)},reorderSlides(i,t){ah(i,t)},updateSlideTransition(i,t){lh(i,t)},updateSlideBackground(i,t){ce(i,t)},advancePresentation(){return dr()},retreatPresentation(){return ga()},goToFirstSlide(){return Gt(0)},goToLastSlide(){return Gt(b.slides.length-1)},setDocType(i){ch(i)},loadDocument(i){Un(i)},resetToNewDocument(i="slides"){wa(i)},bringToFront(i){cr(i)},sendToBack(i){hr(i)},moveElementZIndex(i,t){Ii(i,t)},alignSelectedElements(i){Fh(i)},distributeSelectedElements(i){Uh(i)},setCanvasBackgroundColor(i){kh(i)},setCanvasTexture(i){Sh(i)},zoomToFitSlide(){ie()},setSelectedTool(i){Z(i)},moveSelectedElements(i,t){pa(i,t,!0)},loadTemplate(i){_a(i)},animateElement:B,animateElements:_o,createTimeline:o1,fadeIn:$o,fadeOut:Ro,scaleIn:er,bounce:ei,pulse:ni,shakeX:ii,stopElementAnimation:Ao,pauseElementAnimation:To,resumeElementAnimation:Io,easings:he,animationEngine:st,createSpring:Co,copyToClipboard:li,cutToClipboard:_r,pasteFromClipboard:Gn,copyStyle:Ar,pasteStyle:Tr},a1=()=>{window.Yappy=s1,console.log("Yappy API initialized. Use window.Yappy to interact.")};class A{static adjustColor(t,n){return t}static shadeColor(t,n){if(t==="transparent"||t==="none"||!t)return t;let r,e,o;if(t.startsWith("#")){const c=t.slice(1);c.length===3||c.length===4?(r=parseInt(c[0]+c[0],16),e=parseInt(c[1]+c[1],16),o=parseInt(c[2]+c[2],16)):(r=parseInt(c.substring(0,2),16),e=parseInt(c.substring(2,4),16),o=parseInt(c.substring(4,6),16))}else if(t.startsWith("rgb")){const c=t.match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(c)r=parseInt(c[1]),e=parseInt(c[2]),o=parseInt(c[3]);else return t}else return t;if(isNaN(r)||isNaN(e)||isNaN(o))return t;r=Math.min(255,Math.floor(r*n)),e=Math.min(255,Math.floor(e*n)),o=Math.min(255,Math.floor(o*n));const l=r.toString(16).padStart(2,"0"),s=e.toString(16).padStart(2,"0"),a=o.toString(16).padStart(2,"0");return"#"+l+s+a}static applyTransformations(t,n,r){t.save(),t.globalAlpha=(n.opacity??100)/100*r,n.blendMode&&(t.globalCompositeOperation=n.blendMode==="normal"?"source-over":n.blendMode),n.shadowEnabled?(t.shadowColor=n.shadowColor||"rgba(0,0,0,0.3)",t.shadowBlur=n.shadowBlur||10,t.shadowOffsetX=n.shadowOffsetX||5,t.shadowOffsetY=n.shadowOffsetY||5):t.shadowColor="transparent";let o=n.angle||0,l=n.x,s=n.y;const a=l+n.width/2,c=s+n.height/2;return o&&(t.translate(a,c),t.rotate(o),t.translate(-a,-c)),{cx:a,cy:c}}static restoreTransformations(t){t.restore()}static applyStrokeStyle(t,n,r){t.strokeStyle=this.adjustColor(n.strokeColor,r),t.lineWidth=n.strokeWidth,t.lineCap="round",t.lineJoin=n.strokeLineJoin||"round",n.strokeStyle==="dashed"?t.setLineDash([8,8]):n.strokeStyle==="dotted"?t.setLineDash([2,4]):t.setLineDash([])}static buildRenderOptions(t,n){const r=this.adjustColor(t.strokeColor,n);let e=t.backgroundColor==="transparent"?void 0:this.adjustColor(t.backgroundColor,n);["linear","radial","conic","dots"].includes(t.fillStyle)&&(e=void 0);const o=t.fillDensity||1,s=Math.max(.5,5/o);return{stroke:r,fill:e,fillStyle:t.fillStyle,strokeWidth:t.strokeWidth,hachureAngle:60,hachureGap:s,roughness:t.roughness??1,seed:t.seed||1,disableMultiStroke:t.roughness===0,strokeLineDash:t.strokeStyle==="dashed"?[8,8]:t.strokeStyle==="dotted"?[2,4]:void 0}}static applyComplexFills(t,n,r){const{ctx:e,element:o}=t,l=o.fillStyle,s=["linear","radial","conic"].includes(l)||o.gradientType!=="none"&&o.gradientType!==void 0,a=l==="dots";if(!s&&!a)return;e.save(),e.translate(n,r),s?(e.beginPath(),this.applyGradient(e,o)):a&&(e.beginPath(),this.applyDotsFill(e,o,t.isDarkMode));const c=Ft(o);c&&(this.renderGeometry(e,c),e.fill()),e.restore()}static applyGradient(t,n){const r=n.width,e=n.height,o=r/2,l=e/2,s=n.gradientType||n.fillStyle||"linear";let a;if(s==="linear"){const c=(n.gradientDirection||45)*(Math.PI/180),h=Math.sqrt(o**2+l**2),d=-Math.cos(c)*h,u=-Math.sin(c)*h,f=Math.cos(c)*h,g=Math.sin(c)*h;a=t.createLinearGradient(d,u,f,g)}else if(s==="radial"){const c=(n.gradientDirection||0)*(Math.PI/180),h=Math.max(r,e)/2,d=h*.4,u=Math.cos(c)*d,f=Math.sin(c)*d;a=t.createRadialGradient(u,f,0,0,0,h)}else if(s==="conic"){const c=(n.gradientDirection||0)*(Math.PI/180);a=t.createConicGradient(c,0,0)}else a=t.createLinearGradient(-o,-l,o,l);n.gradientStops&&n.gradientStops.length>0?[...n.gradientStops].sort((c,h)=>c.offset-h.offset).forEach(c=>a.addColorStop(c.offset,c.color)):n.gradientStart&&n.gradientEnd&&(a.addColorStop(0,n.gradientStart),a.addColorStop(1,n.gradientEnd)),t.fillStyle=a}static applyDotsFill(t,n,r){const e=n.fillDensity||1,o=n.strokeColor||"#000000",l=document.createElement("canvas"),s=Math.max(5,20/e);l.width=s,l.height=s;const a=l.getContext("2d");if(a){a.fillStyle=o,a.beginPath(),a.arc(s/2,s/2,n.strokeWidth/2||1,0,Math.PI*2),a.fill();const c=t.createPattern(l,"repeat");c&&(t.fillStyle=c)}}static renderGeometry(t,n){if(n.type==="rect")t.roundRect(n.x,n.y,n.w,n.h,n.r||0);else if(n.type==="ellipse")t.ellipse(n.cx,n.cy,n.rx,n.ry,0,0,Math.PI*2);else if(n.type==="points"){if(n.points.length>0){t.moveTo(n.points[0].x,n.points[0].y);for(let r=1;r<n.points.length;r++)t.lineTo(n.points[r].x,n.points[r].y);n.isClosed!==!1&&t.closePath()}}else n.type==="path"?t.fill(new Path2D(n.path)):n.type==="multi"&&n.shapes.forEach(r=>this.renderGeometry(t,r))}static renderText(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t;if(o.isEditing)return;const s=o.containerText||o.text;if(!s)return;e.save();let a=o.width-20,c=0;o.type==="doubleBanner"?(a=o.width*.65,c=-(o.height*.1)):o.type==="starPerson"?c=o.height*.15:o.type==="lightbulb"?(a=o.width*.7,c=-(o.height*.1)):o.type==="signpost"?(a=o.width*.8,c=-(o.height*.15)):o.type==="browserWindow"?c=Math.min(o.height*.15,30)/2:o.type==="mobilePhone"&&(c=-(o.height*.05));const h=Dt(e,o,s,a);e.font=hi(o);const d=o.textColor||o.strokeColor,u=this.adjustColor(d,l),f=o.textAlign||"center";e.textAlign=f,e.textBaseline="middle";const g=r-h.textHeight/2+h.lineHeight/2+c,p=o.fontFamily==="hand-drawn"?2:0,m=g+p,y=()=>f==="left"?n-(o.width||a)/2+10:f==="right"?n+(o.width||a)/2-10:n;if(o.textHighlightEnabled){const w=o.textHighlightColor||"rgba(255, 255, 0, 0.4)",v=o.textHighlightPadding??4,x=o.textHighlightRadius??2;e.fillStyle=this.adjustColor(w,l),h.lines.forEach((k,S)=>{const M=m+S*h.lineHeight,C=e.measureText(k).width,R=y(),E=v/2;let O=R-C/2-v;f==="left"?O=R-v:f==="right"&&(O=R-C-v),e.beginPath(),e.roundRect?e.roundRect(O,M-h.lineHeight/2-E,C+v*2,h.lineHeight+E*2,x):e.rect(O,M-h.lineHeight/2-E,C+v*2,h.lineHeight+E*2),e.fill()})}e.fillStyle=u,h.lines.forEach((w,v)=>{const x=m+v*h.lineHeight,k=y();e.fillText(w,k,x,o.width-10)}),e.restore()}}class bt{render(t){const{ctx:n,element:r,layerOpacity:e}=t;if(r.points&&r.points.length>0){this.renderCustomPoints(t);return}const{cx:o,cy:l}=A.applyTransformations(n,r,e),s=r.drawProgress;s!==void 0&&s>=0&&s<100?this.renderDrawProgress(t,o,l):(A.applyComplexFills(t,o,l),r.renderStyle==="architectural"?this.renderArchitectural(t,o,l):this.renderSketch(t,o,l)),r.flowAnimation&&this.renderFlowAnimation(t),A.restoreTransformations(n)}renderDrawProgress(t,n,r){const{ctx:e,element:o,isDarkMode:l,layerOpacity:s}=t,a=(o.drawProgress??0)/100;e.globalAlpha=s;const c=Math.min(1,a/.7),h=Math.max(0,Math.min(1,(a-.65)/.25)),d=Math.max(0,Math.min(1,(a-.85)/.15)),u=this.estimatePathLength(o),f=A.adjustColor(o.strokeColor,l);if(c>0){e.save(),e.strokeStyle=f,e.lineWidth=o.strokeWidth,e.lineCap="round",e.lineJoin="round";const g=u*c;e.setLineDash([g,u]),e.lineDashOffset=0,e.beginPath(),this.definePath(e,o),e.stroke(),e.restore()}if(h>0){const g=o.backgroundColor;if(g&&g!=="transparent"&&g!=="none"){e.save(),e.globalAlpha*=h;const p=o.fillStyle;["linear","radial","conic","dots"].includes(p)?A.applyComplexFills(t,n,r):(e.fillStyle=A.adjustColor(g,l),e.beginPath(),this.definePath(e,o),e.fill()),e.restore()}}d>0&&(e.save(),e.globalAlpha*=d,A.renderText(t,n,r),e.restore())}estimatePathLength(t){return 2*(Math.abs(t.width)+Math.abs(t.height))}renderCustomPoints(t){const{ctx:n,element:r,isDarkMode:e,layerOpacity:o}=t;console.log("[renderCustomPoints] Rendering custom points:",r.id,r.points?.length),n.save(),n.globalAlpha=o*(r.opacity??1);const l=this.normalizePoints(r.points);if(l.length===0)return;const s=r.x+r.width/2,a=r.y+r.height/2,c=l.map(h=>({x:h.x+s,y:h.y+a}));if(c.length>=3&&console.log("[renderCustomPoints] First 3 absolute points:",[{x:c[0].x,y:c[0].y},{x:c[1].x,y:c[1].y},{x:c[2].x,y:c[2].y}]),console.log("[renderCustomPoints] Element center:",{cx:s,cy:a}),n.save(),n.globalAlpha=o*(r.opacity??1),r.backgroundColor&&r.backgroundColor!=="transparent"&&r.backgroundColor!=="none"){n.fillStyle=A.adjustColor(r.backgroundColor,e),n.beginPath(),n.moveTo(c[0].x,c[0].y);for(let h=1;h<c.length;h++)n.lineTo(c[h].x,c[h].y);n.closePath(),n.fill()}n.strokeStyle=A.adjustColor(r.strokeColor,e),n.lineWidth=r.strokeWidth,n.beginPath(),n.moveTo(c[0].x,c[0].y);for(let h=1;h<c.length;h++)n.lineTo(c[h].x,c[h].y);n.closePath(),n.stroke(),n.restore()}normalizePoints(t){if(!t||t.length===0)return[];if(typeof t[0]=="object"&&"x"in t[0])return t;const n=[];for(let r=0;r<t.length-1;r+=2)n.push({x:t[r],y:t[r+1]});return n}renderFlowAnimation(t){const{ctx:n,element:r,isDarkMode:e}=t,o=r.flowSpeed!==void 0?r.flowSpeed:1,l=Lc(),s=l/20*o;n.save(),n.strokeStyle=A.adjustColor(r.flowColor||r.strokeColor,e),n.lineWidth=Math.max(1,r.strokeWidth*.8),n.lineCap="round",n.lineJoin="round";const a=r.flowStyle||"dashes";if(a==="dots")n.setLineDash([2,8]);else if(a==="pulse"){const c=Math.sin(l/200)*.5+.5;n.globalAlpha*=c,n.setLineDash([])}else n.setLineDash([8,8]);n.lineDashOffset=-s,n.beginPath(),this.definePath(n,r),n.stroke(),n.restore()}}class l1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);if(this.drawRectArch(e,o,l,s,a.fill),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const h=Math.max(0,s-c);this.drawRectArch(e,{...o,x:o.x+c,y:o.y+c,width:o.width-c*2,height:o.height-c*2,strokeColor:o.innerBorderColor||o.strokeColor},l,h,"none")}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);if(this.drawRectSketch(e,o.x,o.y,o.width,o.height,s,a),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const h=Math.max(0,s-c),d={...a,stroke:o.innerBorderColor||a.stroke,fill:"none"};this.drawRectSketch(e,o.x+c,o.y+c,o.width-c*2,o.height-c*2,h,d)}}A.renderText(t,n,r)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.15:0}drawRectArch(t,n,r,e,o){o&&o!=="transparent"&&o!=="none"&&(t.beginPath(),e>0?t.roundRect(n.x,n.y,n.width,n.height,e):t.rect(n.x,n.y,n.width,n.height),t.fillStyle=o,t.fill()),t.beginPath(),e>0?t.roundRect(n.x,n.y,n.width,n.height,e):t.rect(n.x,n.y,n.width,n.height),A.applyStrokeStyle(t,n,r),t.stroke()}drawRectSketch(t,n,r,e,o,l,s){if(l>0){const a=this.getRoundedRectPath(n,r,e,o,l);t.path(a,s)}else t.rectangle(n,r,e,o,s)}getRoundedRectPath(t,n,r,e,o){const l=Math.min(Math.abs(r)/2,o),s=Math.min(Math.abs(e)/2,o);return`M ${t+l} ${n} L ${t+r-l} ${n} Q ${t+r} ${n} ${t+r} ${n+s} L ${t+r} ${n+e-s} Q ${t+r} ${n+e} ${t+r-l} ${n+e} L ${t+l} ${n+e} Q ${t} ${n+e} ${t} ${n+e-s} L ${t} ${n+s} Q ${t} ${n} ${t+l} ${n}`}definePath(t,n){const r=this.getRadius(n);r>0?t.roundRect(n.x,n.y,n.width,n.height,r):t.rect(n.x,n.y,n.width,n.height)}}class c1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l);if(this.drawCircleArch(e,o,l,s.fill),o.drawInnerBorder){const a=o.innerBorderDistance||5;o.width>a*2&&o.height>a*2&&this.drawCircleArch(e,{...o,x:o.x+a,y:o.y+a,width:o.width-a*2,height:o.height-a*2,strokeColor:o.innerBorderColor||o.strokeColor},l,"none")}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l);if(e.ellipse(o.x+o.width/2,o.y+o.height/2,Math.abs(o.width),Math.abs(o.height),s),o.drawInnerBorder){const a=o.innerBorderDistance||5;if(o.width>a*2&&o.height>a*2){const c={...s,stroke:o.innerBorderColor||s.stroke,fill:"none"};e.ellipse(o.x+o.width/2,o.y+o.height/2,Math.abs(o.width)-a*2,Math.abs(o.height)-a*2,c)}}A.renderText(t,n,r)}drawCircleArch(t,n,r,e){const o=n.x+n.width/2,l=n.y+n.height/2,s=Math.abs(n.width)/2,a=Math.abs(n.height)/2;e&&e!=="transparent"&&e!=="none"&&(t.beginPath(),t.ellipse(o,l,s,a,0,0,Math.PI*2),t.fillStyle=e,t.fill()),t.beginPath(),t.ellipse(o,l,s,a,0,0,Math.PI*2),A.applyStrokeStyle(t,n,r),t.stroke()}definePath(t,n){const r=n.x+n.width/2,e=n.y+n.height/2,o=Math.abs(n.width)/2,l=Math.abs(n.height)/2;t.ellipse(r,e,o,l,0,0,Math.PI*2)}estimatePathLength(t){const n=Math.abs(t.width)/2,r=Math.abs(t.height)/2,e=(n-r)**2/((n+r)**2||1);return Math.PI*(n+r)*(1+3*e/(10+Math.sqrt(4-3*e)))}}class h1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);if(this.drawDiamondArch(e,o,l,s,a.fill),o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const h=Math.max(0,s-c);this.drawDiamondArch(e,{...o,x:o.x+c,y:o.y+c,width:o.width-c*2,height:o.height-c*2,strokeColor:o.innerBorderColor||o.strokeColor},l,h,"none")}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);if(s>0){const c=this.getRoundedDiamondPath(o.x,o.y,o.width,o.height,s);e.path(c,a)}else{const c=o.width/2,h=o.height/2,d=[[o.x+c,o.y],[o.x+o.width,o.y+h],[o.x+c,o.y+o.height],[o.x,o.y+h]];e.polygon(d,a)}if(o.drawInnerBorder){const c=o.innerBorderDistance||5;if(o.width>c*2&&o.height>c*2){const h=Math.max(0,s-c),d={...a,stroke:o.innerBorderColor||a.stroke,fill:"none"};if(h>0){const u=this.getRoundedDiamondPath(o.x+c,o.y+c,o.width-c*2,o.height-c*2,h);e.path(u,d)}else{const u=(o.width-c*2)/2,f=(o.height-c*2)/2,g=o.x+c,p=o.y+c,m=o.width-c*2,y=o.height-c*2,w=[[g+u,p],[g+m,p+f],[g+u,p+y],[g,p+f]];e.polygon(w,d)}}}A.renderText(t,n,r)}getRadius(t){return t.borderRadius!==void 0?Math.min(Math.abs(t.width),Math.abs(t.height))*(t.borderRadius/100):t.roundness?Math.min(Math.abs(t.width),Math.abs(t.height))*.2:0}drawDiamondArch(t,n,r,e,o){const l=n.width/2,s=n.height/2,a=n.x+l,c=n.y+s;if(o&&o!=="transparent"&&o!=="none")if(t.beginPath(),e>0){const h=this.getRoundedDiamondPath(n.x,n.y,n.width,n.height,e);t.fill(new Path2D(h))}else t.moveTo(a,n.y),t.lineTo(n.x+n.width,c),t.lineTo(a,n.y+n.height),t.lineTo(n.x,c),t.closePath(),t.fillStyle=o,t.fill();t.beginPath(),e>0?(this.executePath(t,n.x,n.y,n.width,n.height,e),A.applyStrokeStyle(t,n,r),t.stroke()):(t.moveTo(a,n.y),t.lineTo(n.x+n.width,c),t.lineTo(a,n.y+n.height),t.lineTo(n.x,c),t.closePath(),A.applyStrokeStyle(t,n,r),t.stroke())}getRoundedDiamondPath(t,n,r,e,o){const l=r/2,s=e/2,a=t+l,c=n+s,h=Math.hypot(l,s),u=Math.min(o,h/2)/h,f=l*u,g=s*u,p={x:a-f,y:n+g},m={x:a+f,y:n+g},y={x:t+r-f,y:c-g},w={x:t+r-f,y:c+g},v={x:a+f,y:n+e-g},x={x:a-f,y:n+e-g},k={x:t+f,y:c+g},S={x:t+f,y:c-g};return`M ${p.x} ${p.y} Q ${a} ${n} ${m.x} ${m.y} L ${y.x} ${y.y} Q ${t+r} ${c} ${w.x} ${w.y} L ${v.x} ${v.y} Q ${a} ${n+e} ${x.x} ${x.y} L ${k.x} ${k.y} Q ${t} ${c} ${S.x} ${S.y} Z`}definePath(t,n){const r=this.getRadius(n);if(r>0)this.executePath(t,n.x,n.y,n.width,n.height,r);else{const e=n.width/2,o=n.height/2;t.moveTo(n.x+e,n.y),t.lineTo(n.x+n.width,n.y+o),t.lineTo(n.x+e,n.y+n.height),t.lineTo(n.x,n.y+o),t.closePath()}}executePath(t,n,r,e,o,l){const s=e/2,a=o/2,c=n+s,h=r+a,d=Math.hypot(s,a),f=Math.min(l,d/2)/d,g=s*f,p=a*f,m={x:c-g,y:r+p},y={x:c+g,y:r+p},w={x:n+e-g,y:h-p},v={x:n+e-g,y:h+p},x={x:c+g,y:r+o-p},k={x:c-g,y:r+o-p},S={x:n+g,y:h+p},M={x:n+g,y:h-p};t.moveTo(m.x,m.y),t.quadraticCurveTo(c,r,y.x,y.y),t.lineTo(w.x,w.y),t.quadraticCurveTo(n+e,h,v.x,v.y),t.lineTo(x.x,x.y),t.quadraticCurveTo(c,r+o,k.x,k.y),t.lineTo(S.x,S.y),t.quadraticCurveTo(n,h,M.x,M.y),t.closePath()}}class d1 extends bt{renderArchitectural(t,n,r){this.renderCommon(t)}renderSketch(t,n,r){this.renderCommon(t)}renderCommon(t){const{ctx:n,element:r,isDarkMode:e}=t;if(!r.text)return;const o=r.fontSize||20,l=r.fontFamily==="sans-serif"?"Inter, sans-serif":r.fontFamily==="monospace"?"Source Code Pro, monospace":"Handlee, cursive",s=r.fontWeight===!0||r.fontWeight==="bold"?"bold ":"",a=r.fontStyle===!0||r.fontStyle==="italic"?"italic ":"";n.save(),n.font=`${a}${s}${o}px ${l}`;const h=n.measureText(r.text).width,d=r.width&&h&&!r.textHighlightEnabled?r.width/h:1,u=r.textColor||r.strokeColor,f=A.adjustColor(u,e),g=r.textAlign||"left";if(n.textAlign=g,n.textBaseline="hanging",r.textHighlightEnabled){const p=r.textHighlightColor||"rgba(255, 255, 0, 0.4)",m=r.textHighlightPadding??4,y=r.textHighlightRadius??2;n.fillStyle=A.adjustColor(p,e);const w=r.text.split(`
`),v=o*1.2,x=r.fontFamily==="hand-drawn"?-2:0,k=S=>g==="center"?r.x+(r.width||S)/2:g==="right"?r.x+(r.width||S):r.x;w.forEach((S,M)=>{const C=n.measureText(S).width,R=k(C),E=r.y+M*v+x,O=m/2;n.beginPath(),n.roundRect?n.roundRect(R-(g==="center"?C/2:0)-m,E-O,C+m*2,v+O*2,y):n.rect(R-(g==="center"?C/2:0)-m,E-O,C+m*2,v+O*2),n.fill()}),n.fillStyle=f,w.forEach((S,M)=>{const C=n.measureText(S).width,R=k(C),E=r.y+M*v;n.fillText(S,R,E)})}else{n.fillStyle=f;let p=r.x;g==="center"?p=r.x+(r.width||h)/2:g==="right"&&(p=r.x+(r.width||h)),d!==1?(n.translate(p,r.y),n.scale(d,1),n.fillText(r.text,0,0)):n.fillText(r.text,p,r.y)}n.restore()}definePath(t,n){t.rect(n.x,n.y,n.width,n.height)}}class u1 extends bt{renderArchitectural(t,n,r){this.renderCommon(t)}renderSketch(t,n,r){this.renderCommon(t)}renderCommon(t){const{ctx:n,element:r}=t;if(!r.dataURL)return;const e=$a(r.dataURL);e?n.drawImage(e,r.x,r.y,r.width,r.height):(n.save(),n.fillStyle="#e5e5e5",n.fillRect(r.x,r.y,r.width,r.height),n.fillStyle="#999",n.font="12px sans-serif",n.fillText("Loading image...",r.x+10,r.y+20),n.restore())}definePath(t,n){t.rect(n.x,n.y,n.width,n.height)}}class f1 extends bt{renderArchitectural(t,n,r){const{rc:e,ctx:o,element:l,isDarkMode:s}=t,a=A.buildRenderOptions(l,s),{mainPoints:c,foldPoints:h}=this.getPoints(l);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.polygon(c,{...a,stroke:"none",fill:a.fill}),e.polygon(h,{...a,stroke:"none",fill:a.fill,fillStyle:"solid"})),o.beginPath(),o.moveTo(c[0][0],c[0][1]);for(let u=1;u<c.length;u++)o.lineTo(c[u][0],c[u][1]);o.closePath(),A.applyStrokeStyle(o,l,s),o.stroke(),o.beginPath(),o.moveTo(h[0][0],h[0][1]),o.lineTo(h[1][0],h[1][1]),o.lineTo(h[2][0],h[2][1]),A.applyStrokeStyle(o,l,s),o.stroke(),A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),{mainPoints:a,foldPoints:c}=this.getPoints(o);e.polygon(a,s),e.polygon(c,{...s,fillStyle:"solid"}),A.renderText(t,n,r)}getPoints(t){const n=Math.min(Math.abs(t.width),Math.abs(t.height))*.15,r=t.x,e=t.y,o=t.width,l=t.height,s=[[r,e],[r+o,e],[r+o,e+l-n],[r+o-n,e+l],[r,e+l]],a=[[r+o,e+l-n],[r+o-n,e+l-n],[r+o-n,e+l]];return{mainPoints:s,foldPoints:a}}definePath(t,n){const{mainPoints:r,foldPoints:e}=this.getPoints(n);t.moveTo(r[0][0],r[0][1]);for(let o=1;o<r.length;o++)t.lineTo(r[o][0],r[o][1]);t.closePath(),t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.lineTo(e[2][0],e[2][1])}}class p1 extends bt{renderArchitectural(t,n,r){const{element:e}=t;if(this.drawPolygon(t,e.x,e.y,e.width,e.height),e.drawInnerBorder){const o=e.innerBorderDistance||5;e.width>o*2&&e.height>o*2&&this.drawPolygon(t,e.x+o,e.y+o,e.width-o*2,e.height-o*2,!0)}A.renderText(t,n,r)}renderSketch(t,n,r){const{element:e}=t;if(this.drawPolygon(t,e.x,e.y,e.width,e.height),e.drawInnerBorder){const o=e.innerBorderDistance||5;e.width>o*2&&e.height>o*2&&this.drawPolygon(t,e.x+o,e.y+o,e.width-o*2,e.height-o*2,!0)}A.renderText(t,n,r)}drawPolygon(t,n,r,e,o,l=!1){const{ctx:s,rc:a,element:c,isDarkMode:h}=t,d=this.getPoints(c,n,r,e,o),u=A.buildRenderOptions(c,h),f=A.adjustColor(c.strokeColor,h),g=l?{...u,stroke:c.innerBorderColor||f,fill:"none"}:u;if(c.renderStyle==="architectural"){const p=u.fill&&u.fill!=="transparent"&&u.fill!=="none";!l&&p&&c.fillStyle!=="dots"&&a.polygon(d,{...g,stroke:"none",fill:u.fill}),s.beginPath(),s.moveTo(d[0][0],d[0][1]);for(let m=1;m<d.length;m++)s.lineTo(d[m][0],d[m][1]);s.closePath(),s.strokeStyle=l&&c.innerBorderColor||f,s.lineWidth=c.strokeWidth,s.lineJoin=c.strokeLineJoin||"round",s.stroke()}else a.polygon(d,g)}getPoints(t,n,r,e,o){const l=n+e/2,s=r+o/2,a=e/2,c=o/2;switch(t.type){case"triangle":return[[l,r],[n+e,r+o],[n,r+o]];case"hexagon":return this.getRegularPolyPoints(l,s,a,c,6);case"octagon":return this.getRegularPolyPoints(l,s,a,c,8);case"parallelogram":{const h=e*.2;return[[n+h,r],[n+e,r],[n+e-h,r+o],[n,r+o]]}case"trapezoid":{const h=e*.2;return[[n+h,r],[n+e-h,r],[n+e,r+o],[n,r+o]]}case"rightTriangle":return[[n,r],[n,r+o],[n+e,r+o]];case"pentagon":return this.getRegularPolyPoints(l,s,a,c,5);case"septagon":return this.getRegularPolyPoints(l,s,a,c,7);case"polygon":return this.getRegularPolyPoints(l,s,a,c,t.polygonSides||6);default:return[[n,r],[n+e,r],[n+e,r+o],[n,r+o]]}}getRegularPolyPoints(t,n,r,e,o){const l=[];for(let s=0;s<o;s++){const a=2*Math.PI/o*s-Math.PI/2;l.push([t+r*Math.cos(a),n+e*Math.sin(a)])}return l}definePath(t,n){const r=this.getPoints(n,n.x,n.y,n.width,n.height);if(!(r.length<2)){t.moveTo(r[0][0],r[0][1]);for(let e=1;e<r.length;e++)t.lineTo(r[e][0],r[e][1]);t.closePath()}}estimatePathLength(t){const n=this.getPoints(t,t.x,t.y,t.width,t.height);if(n.length<2)return 0;let r=0;for(let e=0;e<n.length;e++){const o=n[(e+1)%n.length],l=o[0]-n[e][0],s=o[1]-n[e][1];r+=Math.sqrt(l*l+s*s)}return r}}class g1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=o.backgroundColor==="transparent"?void 0:A.adjustColor(o.backgroundColor,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"database":{const u=d*.2,f=this.getDatabasePath(a,c,h,d,u),g=this.getDatabaseTopPath(a,c,h,d,u);s&&(e.fillStyle=s,e.fill(new Path2D(f))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(f)),e.stroke(new Path2D(g));break}case"document":{const u=d*.1,f=this.getDocumentPath(a,c,h,d,u);s&&(e.fillStyle=s,e.fill(new Path2D(f))),A.applyStrokeStyle(e,o,l),e.lineJoin="round",e.stroke(new Path2D(f));break}case"predefinedProcess":{const u=h*.1;s&&(e.fillStyle=s,e.fillRect(a,c,h,d)),A.applyStrokeStyle(e,o,l),e.strokeRect(a,c,h,d),e.beginPath(),e.moveTo(a+u,c),e.lineTo(a+u,c+d),e.moveTo(a+h-u,c),e.lineTo(a+h-u,c+d),e.stroke();break}case"internalStorage":{const u=Math.min(h,d)*.15;s&&(e.fillStyle=s,e.fillRect(a,c,h,d)),A.applyStrokeStyle(e,o,l),e.strokeRect(a,c,h,d),e.beginPath(),e.moveTo(a+u,c),e.lineTo(a+u,c+d),e.moveTo(a,c+u),e.lineTo(a+h,c+u),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"database":{const u=d*.2;e.path(this.getDatabasePath(a,c,h,d,u),s),e.path(this.getDatabaseTopPath(a,c,h,d,u),s);break}case"document":{const u=d*.1;e.path(this.getDocumentPath(a,c,h,d,u),s);break}case"predefinedProcess":{const u=h*.1;e.rectangle(a,c,h,d,s),e.line(a+u,c,a+u,c+d,s),e.line(a+h-u,c,a+h-u,c+d,s);break}case"internalStorage":{const u=Math.min(h,d)*.15;e.rectangle(a,c,h,d,s),e.line(a+u,c,a+u,c+d,s),e.line(a,c+u,a+h,c+u,s);break}}A.renderText(t,n,r)}getDatabasePath(t,n,r,e,o){return`
            M ${t} ${n+o/2}
            L ${t} ${n+e-o/2}
            A ${r/2} ${o/2} 0 0 0 ${t+r} ${n+e-o/2}
            L ${t+r} ${n+o/2}
            A ${r/2} ${o/2} 0 0 0 ${t} ${n+o/2}
            A ${r/2} ${o/2} 0 0 0 ${t+r} ${n+o/2}
        `}getDatabaseTopPath(t,n,r,e,o){return`
            M ${t} ${n+o/2}
            A ${r/2} ${o/2} 0 1 1 ${t+r} ${n+o/2}
            A ${r/2} ${o/2} 0 1 1 ${t} ${n+o/2}
        `}getDocumentPath(t,n,r,e,o){return`
            M ${t} ${n}
            L ${t+r} ${n}
            L ${t+r} ${n+e-o}
            Q ${t+r*.75} ${n+e-o*2} ${t+r*.5} ${n+e-o}
            T ${t} ${n+e-o}
            Z
        `}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class y1 extends bt{renderArchitectural(t,n,r){const{ctx:e,rc:o,element:l,isDarkMode:s}=t,a=A.buildRenderOptions(l,s),c=l.x,h=l.y,d=l.width,u=l.height;switch(l.type){case"starPerson":{const f=Math.min(Math.abs(d),Math.abs(u))*.15,g=c+d/2,p=h+f,m=this.getStarPersonBodyPoints(c,h,d,u,f);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(o.ellipse(g,p,f*2,f*2,{...a,stroke:"none",fill:a.fill}),o.polygon(m,{...a,stroke:"none",fill:a.fill})),e.beginPath(),e.ellipse(g,p,f,f,0,0,Math.PI*2),e.moveTo(m[0][0],m[0][1]);for(let y=1;y<m.length;y++)e.lineTo(m[y][0],m[y][1]);A.applyStrokeStyle(e,l,s),e.stroke();break}case"lightbulb":{const f=Math.min(d,u/1.5)/2,g=d*.4,p=u*.25,m=h+u-p,y=this.getLightbulbPath(c,h,d,f,g,m);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(y)),e.fillRect(c+d/2-g/2,m,g,p)),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(y)),e.strokeRect(c+d/2-g/2,m,g,p);break}case"signpost":{const f=Math.max(4,d*.05),g=u*.3,p=d*.9,m=h+u*.1,y=c+d/2-f/2,w=c+d/2-p/2;a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fillRect(y,h,f,u),e.fillRect(w,m,p,g)),A.applyStrokeStyle(e,l,s),e.strokeRect(y,h,f,u),e.strokeRect(w,m,p,g);break}case"burstBlob":{const f=this.getBurstBlobPath(l);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"wavyDivider":{const f=this.getWavyDividerPath(c,h,d,u);A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"scroll":{const f=this.getScrollPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"doubleBanner":{const f=this.getDoubleBannerPolygons(c,h,d,u);for(const g of f){if(a.fill&&a.fill!=="transparent"&&a.fill!=="none"){e.fillStyle=a.fill,e.beginPath(),e.moveTo(g[0][0],g[0][1]);for(let p=1;p<g.length;p++)e.lineTo(g[p][0],g[p][1]);e.closePath(),e.fill()}A.applyStrokeStyle(e,l,s),e.beginPath(),e.moveTo(g[0][0],g[0][1]);for(let p=1;p<g.length;p++)e.lineTo(g[p][0],g[p][1]);e.closePath(),e.stroke()}break}case"trophy":{const f=this.getTrophyPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"clock":{const f=Math.min(d,u)/2,g=c+d/2,p=h+u/2;a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.beginPath(),e.ellipse(g,p,f,f,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,l,s),e.beginPath(),e.ellipse(g,p,f,f,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(g,p),e.lineTo(g,p-f*.55),e.moveTo(g,p),e.lineTo(g+f*.35,p+f*.1),e.stroke(),e.beginPath(),e.arc(g,p,f*.06,0,Math.PI*2),e.fillStyle=A.adjustColor(l.strokeColor||"#000000",s),e.fill();break}case"gear":{const f=this.getGearPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f),"evenodd")),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"target":{const f=Math.min(d,u)/2,g=c+d/2,p=h+u/2,m=3;for(let y=m;y>=1;y--){const w=f*(y/m);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=y%2===1?a.fill:"#ffffff",e.beginPath(),e.ellipse(g,p,w,w,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,l,s),e.beginPath(),e.ellipse(g,p,w,w,0,0,Math.PI*2),e.stroke()}break}case"rocket":{const f=this.getRocketPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"flag":{const f=this.getFlagPath(c,h,d,u),g=Math.max(3,d*.04),p=c+d*.15-g/2;a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f)),e.strokeRect(p,h,g,u);break}case"key":{const f=this.getKeyPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"magnifyingGlass":{const f=this.getMagnifyingGlassPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"book":{const f=this.getBookPath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"megaphone":{const f=this.getMegaphonePath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));break}case"eye":{const f=this.getEyePath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));const g=Math.min(d,u)*.18,p=g*.45,m=c+d/2,y=h+u/2;e.beginPath(),e.ellipse(m,y,g,g,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(m,y,p,0,Math.PI*2),e.fillStyle=A.adjustColor(l.strokeColor||"#000000",s),e.fill();break}case"thoughtBubble":{const f=this.getThoughtBubblePath(c,h,d,u);a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.fill(new Path2D(f))),A.applyStrokeStyle(e,l,s),e.stroke(new Path2D(f));const g=Math.min(d,u)*.05,p=g*.65,m=c+d*.25,y=h+u*.88,w=c+d*.18,v=h+u*.95;a.fill&&a.fill!=="transparent"&&a.fill!=="none"&&(e.fillStyle=a.fill,e.beginPath(),e.arc(m,y,g,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(w,v,p,0,Math.PI*2),e.fill()),e.beginPath(),e.arc(m,y,g,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(w,v,p,0,Math.PI*2),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"starPerson":{const u=Math.min(Math.abs(h),Math.abs(d))*.15;e.ellipse(a+h/2,c+u,u*2,u*2,s),e.polygon(this.getStarPersonBodyPoints(a,c,h,d,u),s);break}case"lightbulb":{const u=Math.min(h,d/1.5)/2,f=h*.4,g=d*.25,p=c+d-g;e.path(this.getLightbulbPath(a,c,h,u,f,p),s),e.rectangle(a+h/2-f/2,p,f,g,s);break}case"signpost":{const u=Math.max(4,h*.05),f=d*.3,g=h*.9,p=c+d*.1;e.rectangle(a+h/2-u/2,c,u,d,{...s,fill:"none"}),e.rectangle(a+h/2-g/2,p,g,f,s);break}case"burstBlob":{e.path(this.getBurstBlobPath(o),s);break}case"wavyDivider":{e.path(this.getWavyDividerPath(a,c,h,d),s);break}case"scroll":{e.path(this.getScrollPath(a,c,h,d),s);break}case"doubleBanner":{const u=this.getDoubleBannerPolygons(a,c,h,d);for(const f of u)e.polygon(f,s);break}case"trophy":{e.path(this.getTrophyPath(a,c,h,d),s);break}case"clock":{const u=Math.min(h,d)/2,f=a+h/2,g=c+d/2;e.circle(f,g,u*2,s),e.line(f,g,f,g-u*.55,{...s,fill:"none"}),e.line(f,g,f+u*.35,g+u*.1,{...s,fill:"none"});break}case"gear":{e.path(this.getGearPath(a,c,h,d),s);break}case"target":{const u=Math.min(h,d)/2,f=a+h/2,g=c+d/2,p=3;for(let m=p;m>=1;m--){const y=u*(m/p),w=m%2===1?s:{...s,fill:"#ffffff"};e.circle(f,g,y*2,w)}break}case"rocket":{e.path(this.getRocketPath(a,c,h,d),s);break}case"flag":{const u=Math.max(3,h*.04),f=a+h*.15-u/2;e.path(this.getFlagPath(a,c,h,d),s),e.rectangle(f,c,u,d,{...s,fill:"none"});break}case"key":{e.path(this.getKeyPath(a,c,h,d),s);break}case"magnifyingGlass":{e.path(this.getMagnifyingGlassPath(a,c,h,d),s);break}case"book":{e.path(this.getBookPath(a,c,h,d),s);break}case"megaphone":{e.path(this.getMegaphonePath(a,c,h,d),s);break}case"eye":{e.path(this.getEyePath(a,c,h,d),s);const u=Math.min(h,d)*.18;e.circle(a+h/2,c+d/2,u*2,s);const f=u*.45,g=A.adjustColor(o.strokeColor||"#000000",l);e.circle(a+h/2,c+d/2,f*2,{...s,fill:g});break}case"thoughtBubble":{e.path(this.getThoughtBubblePath(a,c,h,d),s);const u=Math.min(h,d)*.05,f=u*.65;e.circle(a+h*.25,c+d*.88,u*2,s),e.circle(a+h*.18,c+d*.95,f*2,s);break}}A.renderText(t,n,r)}getStarPersonBodyPoints(t,n,r,e,o){const l=t+r/2;return[[l,n+o*2],[t,n+e*.4],[l,n+e*.5],[t+r,n+e*.4],[l,n+o*2],[t+r*.8,n+e],[l,n+e*.7],[t+r*.2,n+e],[l,n+o*2]]}getLightbulbPath(t,n,r,e,o,l){const s=t+r/2;return`
            M ${s-o/2} ${l}
            C ${s-o/2} ${n+e} ${t} ${n+e*1.5} ${t} ${n+e}
            A ${e} ${e} 0 1 1 ${t+r} ${n+e}
            C ${t+r} ${n+e*1.5} ${s+o/2} ${n+e} ${s+o/2} ${l}
            Z
        `}getWavyDividerPath(t,n,r,e){const o=n+e/2,l=4,s=r/l;let a=`M ${t} ${o}`;for(let c=0;c<l;c++){const h=t+c*s;a+=` Q ${h+s/4} ${o-e/2}, ${h+s/2} ${o}`,a+=` Q ${h+s*.75} ${o+e/2}, ${h+s} ${o}`}return a}getBurstBlobPath(t){const n=t.x,r=t.y,e=t.width,o=t.height,l=n+e/2,s=r+o/2,a=e/2,c=o/2,h=12,d=Math.min(a,c),u=d*.6,f=t.seed||1,g=m=>{let y=m+=1831565813;return y=Math.imul(y^y>>>15,y|1),y^=y+Math.imul(y^y>>>7,y|61),((y^y>>>14)>>>0)/4294967296};let p="";for(let m=0;m<h*2;m++){const y=m%2===0?d:u,w=g(f+m),v=y+(w-.5)*(d*.1),x=Math.PI*m/h,k=l+Math.cos(x)*(e/o)*v,S=s+Math.sin(x)*v;p+=(m===0?"M ":" L ")+k+" "+S}return p+" Z"}getScrollPath(t,n,r,e){const o=e*.15;return`M ${t} ${n+o} L ${t+r} ${n+o} L ${t+r} ${n+e-o} L ${t} ${n+e-o} Z M ${t} ${n+o} C ${t-o} ${n+o} ${t-o} ${n} ${t} ${n} L ${t+r} ${n} C ${t+r+o} ${n} ${t+r+o} ${n+o} ${t+r} ${n+o} M ${t} ${n+e-o} C ${t-o} ${n+e-o} ${t-o} ${n+e} ${t} ${n+e} L ${t+r} ${n+e} C ${t+r+o} ${n+e} ${t+r+o} ${n+e-o} ${t+r} ${n+e-o}`}getDoubleBannerPolygons(t,n,r,e){const o=r*.15,l=e*.25,s=n+e;return[[[t+o,n+l],[t,n+l],[t+o/2,n],[t,s],[t+o,s]],[[t+r-o,n+l],[t+r,n+l],[t+r-o/2,n],[t+r,s],[t+r-o,s]],[[t+o,n],[t+r-o,n],[t+r-o,n+e-l],[t+o,n+e-l]]]}getTrophyPath(t,n,r,e){const o=n,l=n+e*.55,s=l,a=n+e*.8,c=a,h=n+e,d=r*.6,u=t+(r-d)/2,f=u+d,g=r*.1,p=t+r/2-g/2,m=p+g,y=r*.5,w=t+(r-y)/2,v=w+y,x=r*.18;return`M ${u} ${o} L ${f} ${o} L ${f} ${l} L ${u} ${l} Z M ${p} ${s} L ${m} ${s} L ${m} ${a} L ${p} ${a} Z M ${w} ${c} L ${v} ${c} L ${v} ${h} L ${w} ${h} Z M ${u} ${o+(l-o)*.15} C ${u-x} ${o+(l-o)*.15} ${u-x} ${l-(l-o)*.15} ${u} ${l-(l-o)*.15} M ${f} ${o+(l-o)*.15} C ${f+x} ${o+(l-o)*.15} ${f+x} ${l-(l-o)*.15} ${f} ${l-(l-o)*.15}`}getGearPath(t,n,r,e){const o=t+r/2,l=n+e/2,s=Math.min(r,e)/2,a=s*.7,c=s*.25,h=8,d=s-a;let u="";for(let g=0;g<h;g++){const p=Math.PI*2*g/h,m=Math.PI*2*(g+.35)/h,y=Math.PI*2*(g+.5)/h,w=Math.PI*2*(g+.85)/h,v=Math.PI*2*(g+1)/h,x=[o+Math.cos(p)*a,l+Math.sin(p)*a],k=[o+Math.cos(m)*(a+d),l+Math.sin(m)*(a+d)],S=[o+Math.cos(y)*(a+d),l+Math.sin(y)*(a+d)],M=[o+Math.cos(w)*a,l+Math.sin(w)*a],C=[o+Math.cos(v)*a,l+Math.sin(v)*a];u+=g===0?`M ${x[0]} ${x[1]}`:`L ${x[0]} ${x[1]}`,u+=` L ${k[0]} ${k[1]} L ${S[0]} ${S[1]} L ${M[0]} ${M[1]} L ${C[0]} ${C[1]}`}u+=" Z";const f=16;for(let g=0;g<=f;g++){const p=Math.PI*2*g/f,m=o+Math.cos(p)*c,y=l+Math.sin(p)*c;u+=g===0?` M ${m} ${y}`:` L ${m} ${y}`}return u+=" Z",u}getRocketPath(t,n,r,e){const o=r*.5,l=t+(r-o)/2,s=e*.25,a=n+e*.75,c=r*.2,h=e*.25;let d=`M ${l+o/2} ${n}`;return d+=` C ${l+o} ${n+s*.5} ${l+o} ${n+s} ${l+o} ${n+s}`,d+=` L ${l+o} ${a}`,d+=` L ${l} ${a}`,d+=` L ${l} ${n+s}`,d+=` C ${l} ${n+s} ${l} ${n+s*.5} ${l+o/2} ${n}`,d+=" Z",d+=` M ${l} ${a-h*.3}`,d+=` L ${l-c} ${a+h*.5}`,d+=` L ${l} ${a}`,d+=" Z",d+=` M ${l+o} ${a-h*.3}`,d+=` L ${l+o+c} ${a+h*.5}`,d+=` L ${l+o} ${a}`,d+=" Z",d+=` M ${l+o*.2} ${a}`,d+=` L ${l+o/2} ${n+e}`,d+=` L ${l+o*.8} ${a}`,d}getFlagPath(t,n,r,e){const l=t+r*.15,s=t+r,a=n,c=e*.55,h=c*.15;return`M ${l} ${a} C ${l+(s-l)*.33} ${a-h} ${l+(s-l)*.66} ${a+h} ${s} ${a} L ${s} ${a+c} C ${l+(s-l)*.66} ${a+c+h} ${l+(s-l)*.33} ${a+c-h} ${l} ${a+c} Z`}getKeyPath(t,n,r,e){const o=t+r/2,l=r*.35,s=e*.25,a=n+s,c=r*.12,h=a+s*.7,d=n+e,u=o-c/2,f=o+c/2,g=r*.15,p=e*.08,m=d-e*.25,y=d-e*.12;let w=`M ${o-l} ${a}`;return w+=` A ${l} ${s} 0 1 1 ${o+l} ${a}`,w+=` A ${l} ${s} 0 1 1 ${o-l} ${a}`,w+=" Z",w+=` M ${u} ${h} L ${f} ${h} L ${f} ${d} L ${u} ${d} Z`,w+=` M ${f} ${m} L ${f+g} ${m} L ${f+g} ${m+p} L ${f} ${m+p}`,w+=` M ${f} ${y} L ${f+g} ${y} L ${f+g} ${y+p} L ${f} ${y+p}`,w}getMagnifyingGlassPath(t,n,r,e){const o=Math.min(r,e)*.32,l=t+r*.42,s=n+e*.38,a=Math.max(r*.1,4),c=Math.PI/4,h=l+Math.cos(c)*o,d=s+Math.sin(c)*o,u=Math.min(r,e)*.4,f=h+Math.cos(c)*u,g=d+Math.sin(c)*u,p=Math.cos(c+Math.PI/2)*a/2,m=Math.sin(c+Math.PI/2)*a/2;let y=`M ${l-o} ${s}`;return y+=` A ${o} ${o} 0 1 1 ${l+o} ${s}`,y+=` A ${o} ${o} 0 1 1 ${l-o} ${s}`,y+=" Z",y+=` M ${h+p} ${d+m}`,y+=` L ${f+p} ${g+m}`,y+=` L ${f-p} ${g-m}`,y+=` L ${h-p} ${d-m}`,y+=" Z",y}getBookPath(t,n,r,e){const l=t+r/2,s=n+e*.05,a=n+e*.95,c=e*.08;let h=`M ${l} ${s}`;return h+=` C ${l-r*.1} ${s+c} ${t+r*.05} ${s+c} ${t} ${s}`,h+=` L ${t} ${a}`,h+=` C ${t+r*.05} ${a-c} ${l-r*.1} ${a-c} ${l} ${a}`,h+=" Z",h+=` M ${l} ${s}`,h+=` C ${l+r*.1} ${s+c} ${t+r*.95} ${s+c} ${t+r} ${s}`,h+=` L ${t+r} ${a}`,h+=` C ${t+r*.95} ${a-c} ${l+r*.1} ${a-c} ${l} ${a}`,h+=" Z",h+=` M ${l} ${s} L ${l} ${a}`,h}getMegaphonePath(t,n,r,e){const o=t+r*.15,l=t+r,s=n,a=n+e*.75,c=n+e*.25,h=n+e*.5;let d=`M ${o} ${c}`;d+=` L ${l} ${s}`,d+=` L ${l} ${a}`,d+=` L ${o} ${h}`,d+=" Z";const u=r*.12,f=e*.25,g=o-u*.3,p=h;return d+=` M ${g} ${p} L ${g+u} ${p} L ${g+u} ${p+f} L ${g} ${p+f} Z`,d}getEyePath(t,n,r,e){const o=n+e/2,l=r/2,s=e/2;let a=`M ${t} ${o}`;return a+=` C ${t+l*.4} ${o-s*1.3} ${t+l*1.6} ${o-s*1.3} ${t+r} ${o}`,a+=` C ${t+l*1.6} ${o+s*1.3} ${t+l*.4} ${o+s*1.3} ${t} ${o}`,a+=" Z",a}getThoughtBubblePath(t,n,r,e){const o=e*.8,l=t+r/2,s=n+o/2,a=r*.48,c=o*.45,h=8;let d="";for(let u=0;u<h;u++){const f=Math.PI*2*u/h,g=Math.PI*2*(u+1)/h,p=(f+g)/2,m=l+Math.cos(f)*a,y=s+Math.sin(f)*c,w=1.25,v=l+Math.cos(p)*a*w,x=s+Math.sin(p)*c*w,k=l+Math.cos(g)*a,S=s+Math.sin(g)*c;u===0&&(d=`M ${m} ${y}`),d+=` Q ${v} ${x} ${k} ${S}`}return d+=" Z",d}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class m1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.adjustColor(o.strokeColor,l),a=o.backgroundColor==="transparent"?void 0:A.adjustColor(o.backgroundColor,l),c=o.x,h=o.y,d=o.width,u=o.height;switch(o.type){case"server":{a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),A.applyStrokeStyle(e,o,l),e.strokeRect(c,h,d,u);const f=u*.05,g=d*.7,p=c+(d-g)/2;e.fillStyle=s;for(let m=0;m<3;m++)e.fillRect(p,h+u-(m+1)*f*2-f,g,f);break}case"loadBalancer":{const f=c+d/2,g=h+u/2;a&&(e.fillStyle=a,e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.stroke();const p=d*.3;e.beginPath(),e.moveTo(f-p,g),e.lineTo(f+p,g),e.stroke(),this.drawArchArrowhead(e,f+p,g,0),this.drawArchArrowhead(e,f-p,g,Math.PI);break}case"firewall":{a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),A.applyStrokeStyle(e,o,l),e.strokeRect(c,h,d,u);const f=4,g=3,p=u*.15;e.beginPath(),e.moveTo(c,h+p),e.lineTo(c+d,h+p),e.stroke();const m=(u-p)/f,y=d/g;e.beginPath();for(let w=1;w<f;w++)e.moveTo(c,h+p+w*m),e.lineTo(c+d,h+p+w*m);for(let w=0;w<f;w++){const v=w%2===0?0:y/2;for(let x=1;x<g;x++){const k=c+x*y+v;k<c+d&&(e.moveTo(k,h+w*m),e.lineTo(k,h+(w+1)*m))}}e.stroke();break}case"user":{const f=Math.min(d,u)*.25,g=c+d/2;a&&(e.fillStyle=a,e.beginPath(),e.arc(g,h+f,f,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.arc(g,h+f,f,0,Math.PI*2),e.stroke();const p=d*.8;e.beginPath(),e.moveTo(g-p/2,h+u),e.quadraticCurveTo(g,h+f*1.5,g+p/2,h+u),e.stroke();break}case"messageQueue":{a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),A.applyStrokeStyle(e,o,l),e.strokeRect(c,h,d,u);const f=4,g=d/f;e.beginPath();for(let p=1;p<f;p++)e.moveTo(c+p*g,h),e.lineTo(c+p*g,h+u);e.stroke();break}case"lambda":{const f=c+d/2,g=h+u/2,p=d*.4,m=u*.6,y=f-p/2,w=g-m/2,v=`M ${y+p} ${w} L ${y} ${w+m*.6} L ${y+p*.6} ${w+m*.5} L ${y} ${w+m} L ${y+p} ${w+m*.4} L ${y+p*.4} ${w+m*.5} Z`;a&&(e.fillStyle=a,e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.stroke(),e.fillStyle=s,e.fill(new Path2D(v));break}case"router":{const f=c+d/2,g=h+u/2;a&&(e.fillStyle=a,e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,d/2,u/2,0,0,Math.PI*2),e.stroke();const p=Math.min(d,u)*.3;e.beginPath();for(let m=0;m<4;m++){const y=Math.PI/2*m+Math.PI/4;e.moveTo(f,g),e.lineTo(f+p*Math.cos(y),g+p*Math.sin(y))}e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=A.adjustColor(o.strokeColor,l),c=o.x,h=o.y,d=o.width,u=o.height;switch(o.type){case"server":{e.rectangle(c,h,d,u,s);const f=d*.7,g=u*.05,p=c+(d-f)/2;for(let m=0;m<3;m++)e.rectangle(p,h+u-(m+1)*g*2-g,f,g,{...s,fillStyle:"solid",fill:a});break}case"loadBalancer":{const f=c+d/2,g=h+u/2;e.ellipse(f,g,d,u,s);const p=d*.3;e.line(f-p,g,f+p,g,s),this.drawSketchArrowhead(e,f+p,g,0,s),this.drawSketchArrowhead(e,f-p,g,Math.PI,s);break}case"firewall":{e.rectangle(c,h,d,u,s);const f=4,g=3,p=u/f,m=d/g;for(let y=1;y<f;y++)e.line(c,h+y*p,c+d,h+y*p,s);for(let y=0;y<f;y++){const w=y%2===0?0:m/2;for(let v=1;v<g;v++){const x=c+v*m+w;x<c+d&&e.line(x,h+y*p,x,h+(y+1)*p,s)}}break}case"user":{const f=Math.min(d,u)*.25,g=c+d/2;e.circle(g,h+f,f*2,s);const p=d*.8,m=`M ${g-p/2} ${h+u} Q ${g} ${h+f*1.5} ${g+p/2} ${h+u} Z`;e.path(m,s);break}case"messageQueue":{e.rectangle(c,h,d,u,s);const f=4,g=d/f;for(let p=1;p<f;p++)e.line(c+p*g,h,c+p*g,h+u,s);break}case"lambda":{const f=c+d/2,g=h+u/2,p=d*.4,m=u*.6,y=f-p/2,w=g-m/2,v=`M ${y+p} ${w} L ${y} ${w+m*.6} L ${y+p*.6} ${w+m*.5} L ${y} ${w+m} L ${y+p} ${w+m*.4} L ${y+p*.4} ${w+m*.5} Z`;e.ellipse(f,g,d,u,s),e.path(v,{...s,fillStyle:"solid",fill:a});break}case"router":{const f=c+d/2,g=h+u/2;e.ellipse(f,g,d,u,s);const p=Math.min(d,u)*.3;for(let m=0;m<4;m++){const y=Math.PI/2*m+Math.PI/4,w=f+p*Math.cos(y),v=g+p*Math.sin(y);e.line(f,g,w,v,s),this.drawSketchArrowhead(e,w,v,y,s)}break}}A.renderText(t,n,r)}drawArchArrowhead(t,n,r,e){t.beginPath(),t.moveTo(n-5*Math.cos(e-Math.PI/6),r-5*Math.sin(e-Math.PI/6)),t.lineTo(n,r),t.lineTo(n-5*Math.cos(e+Math.PI/6),r-5*Math.sin(e+Math.PI/6)),t.stroke()}drawSketchArrowhead(t,n,r,e,o){const s={x:n-10*Math.cos(e-Math.PI/6),y:r-10*Math.sin(e-Math.PI/6)},a={x:n-10*Math.cos(e+Math.PI/6),y:r-10*Math.sin(e+Math.PI/6)};t.line(n,r,s.x,s.y,o),t.line(n,r,a.x,a.y,o)}definePath(t,n){n.type==="loadBalancer"||n.type==="router"||n.type==="lambda"?t.ellipse(n.x+n.width/2,n.y+n.height/2,n.width/2,n.height/2,0,0,Math.PI*2):t.rect(n.x,n.y,n.width,n.height)}}class b1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.adjustColor(o.strokeColor,l),a=o.backgroundColor==="transparent"?void 0:A.adjustColor(o.backgroundColor,l),c=o.x,h=o.y,d=o.width,u=o.height;switch(o.type){case"browserWindow":{a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),e.strokeStyle=s,e.lineWidth=o.strokeWidth,e.strokeRect(c,h,d,u);const f=Math.min(u*.15,30);e.strokeRect(c,h,d,f);const g=4;for(let p=0;p<3;p++)e.beginPath(),e.arc(c+10+p*15,h+f/2,g,0,Math.PI*2),e.stroke();break}case"mobilePhone":{a&&(e.fillStyle=a,e.roundRect(c,h,d,u,20),e.fill()),e.strokeStyle=s,e.lineWidth=o.strokeWidth,e.beginPath(),e.roundRect(c,h,d,u,20),e.stroke();const g=10;e.strokeRect(c+g,h+g+20,d-2*g,u-2*g-40),e.beginPath(),e.arc(c+d/2,h+u-20,10,0,Math.PI*2),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"browserWindow":{e.rectangle(a,c,h,d,s);const u=Math.min(d*.15,30);e.rectangle(a,c,h,u,s);for(let f=0;f<3;f++)e.circle(a+10+f*15,c+u/2,8,s);break}case"mobilePhone":{const f=this.getRoundedRectPath(a,c,h,d,20);e.path(f,s);const g=10;e.rectangle(a+g,c+g+20,h-2*g,d-2*g-40,s),e.circle(a+h/2,c+d-20,20,s);break}}A.renderText(t,n,r)}getRoundedRectPath(t,n,r,e,o){const l=Math.min(Math.abs(r)/2,o),s=Math.min(Math.abs(e)/2,o);return`M ${t+l} ${n} L ${t+r-l} ${n} Q ${t+r} ${n} ${t+r} ${n+s} L ${t+r} ${n+e-s} Q ${t+r} ${n+e} ${t+r-l} ${n+e} L ${t+l} ${n+e} Q ${t} ${n+e} ${t} ${n+e-s} L ${t} ${n+s} Q ${t} ${n} ${t+l} ${n}`}definePath(t,n){const r=n.x,e=n.y,o=n.width,l=n.height;n.type==="mobilePhone"?t.roundRect(r,e,o,l,20):t.rect(r,e,o,l)}}class w1 extends bt{render(t){const{ctx:n,element:r,layerOpacity:e}=t,{cx:o,cy:l}=A.applyTransformations(n,r,e),s=r.drawProgress;s!==void 0&&s>=0&&s<100?this.renderDrawProgress(t,o,l):r.renderStyle==="architectural"?this.renderArchitectural(t,o,l):this.renderSketch(t,o,l),A.restoreTransformations(n)}renderArchitectural(t,n,r){this.renderCommon(t)}renderSketch(t,n,r){this.renderCommon(t)}renderCommon(t){const{ctx:n,element:r,isDarkMode:e}=t,o=A.adjustColor(r.strokeColor,e);if(r.type==="organicBranch"){const l=ft(r.points),s=r.controlPoints||[];if(l.length<2||s.length<2)return;const a={x:r.x+l[0].x,y:r.y+l[0].y},c={x:r.x+l[l.length-1].x,y:r.y+l[l.length-1].y},h=s[0],d=s[1];this.drawOrganicBranch(n,a,c,h,d,o,r.strokeWidth,r.text||"",o),this.renderFlow(t,a,c,h,d)}}renderFlow(t,n,r,e,o){const{ctx:l,element:s,isDarkMode:a}=t;if(!s.flowAnimation)return;const c=window.yappyGlobalTime||performance.now(),h=(s.flowSpeed??2)*50,d=c/1e3*h,u=A.adjustColor(s.flowColor||s.strokeColor,a),f=Math.max(2,s.strokeWidth*1.5),g=100/(s.flowDensity||3);l.save(),l.fillStyle=u,l.shadowBlur=s.flowStyle==="pulse"?f:0,l.shadowColor=u;const p=Math.sqrt((r.x-n.x)**2+(r.y-n.y)**2),m=Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2)+Math.sqrt((o.x-e.x)**2+(o.y-e.y)**2)+Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),y=(p+m)/2,w=Math.ceil(y/5);for(let v=0;v<=w;v++){const x=v/w;if((x*y+d)%g<h/10){const S=this.cubicBezier(n.x,e.x,o.x,r.x,x),M=this.cubicBezier(n.y,e.y,o.y,r.y,x),C=Math.min(1,x+.01),R=this.cubicBezier(n.x,e.x,o.x,r.x,C),E=this.cubicBezier(n.y,e.y,o.y,r.y,C),O=Math.atan2(E-M,R-S);this.drawPulse(l,S,M,f,s.flowStyle,O)}}l.restore()}drawPulse(t,n,r,e,o,l=0){if(t.save(),t.translate(n,r),t.rotate(l),o==="dashes")t.fillRect(-e,-e/2,e*2,e);else if(o==="pulse"){t.beginPath(),t.arc(0,0,e*1.5,0,Math.PI*2);const s=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=s,t.fill()}else t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill();t.restore()}cubicBezier(t,n,r,e,o){const l=1-o;return l*l*l*t+3*l*l*o*n+3*l*o*o*r+o*o*o*e}cubicBezierAngle(t,n,r,e,o){const l=3*(1-o)*(1-o)*(n.x-t.x)+6*(1-o)*o*(r.x-n.x)+3*o*o*(e.x-r.x),s=3*(1-o)*(1-o)*(n.y-t.y)+6*(1-o)*o*(r.y-n.y)+3*o*o*(e.y-r.y);return Math.atan2(s,l)}drawOrganicBranch(t,n,r,e,o,l,s,a,c){const d=[],u=[],f=Math.max(s*8,4),g=Math.max(s*2,2);for(let p=0;p<=20;p++){const m=p/20,y=this.cubicBezier(n.x,e.x,o.x,r.x,m),w=this.cubicBezier(n.y,e.y,o.y,r.y,m),v=this.cubicBezierAngle(n,e,o,r,m),k=(f+(g-f)*m)/2,S=Math.cos(v+Math.PI/2)*k,M=Math.sin(v+Math.PI/2)*k;d.push({x:y+S,y:w+M}),u.push({x:y-S,y:w-M})}t.beginPath(),t.moveTo(d[0].x,d[0].y);for(let p=1;p<d.length;p++)t.lineTo(d[p].x,d[p].y);t.lineTo(u[u.length-1].x,u[u.length-1].y);for(let p=u.length-2;p>=0;p--)t.lineTo(u[p].x,u[p].y);if(t.closePath(),t.fillStyle=l,t.fill(),a){t.save(),t.font="16px sans-serif",t.fillStyle=c,t.textAlign="center",t.textBaseline="middle";const p=this.cubicBezier(n.x,e.x,o.x,r.x,.5),m=this.cubicBezier(n.y,e.y,o.y,r.y,.5),y=this.cubicBezierAngle(n,e,o,r,.5),w=-15;t.translate(p,m);let v=y;(v>Math.PI/2||v<-Math.PI/2)&&(v+=Math.PI),t.rotate(v),t.fillText(a,0,w),t.restore()}}definePath(t,n){if(n.type==="organicBranch"){const r=ft(n.points),e=n.controlPoints||[];if(r.length<2||e.length<2)return;const o={x:n.x+r[0].x,y:n.y+r[0].y},l={x:n.x+r[r.length-1].x,y:n.y+r[r.length-1].y},s=e[0],a=e[1];t.moveTo(o.x,o.y),t.bezierCurveTo(s.x,s.y,a.x,a.y,l.x,l.y)}}}class v1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.adjustColor(o.strokeColor,l),a=o.backgroundColor==="transparent"?void 0:A.adjustColor(o.backgroundColor,l),c=o.x,h=o.y,d=o.width,u=o.height;switch(o.type){case"browser":{a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),A.applyStrokeStyle(e,o,l),e.strokeRect(c,h,d,u);const f=u*.15;e.beginPath(),e.moveTo(c,h+f),e.lineTo(c+d,h+f),e.stroke(),e.fillStyle=s;const g=f*.2;for(let p=0;p<3;p++)e.beginPath(),e.arc(c+f*(.5+p*.6),h+f/2,g,0,Math.PI*2),e.fill();break}case"ghostButton":{const f=Math.min(d,u)*.2;a&&(e.fillStyle=a,e.roundRect(c,h,d,u,f),e.fill()),A.applyStrokeStyle(e,o,l),e.roundRect(c,h,d,u,f),e.stroke();break}case"inputField":{if(a&&(e.fillStyle=a,e.fillRect(c,h,d,u)),A.applyStrokeStyle(e,o,l),e.strokeRect(c,h,d,u),e.beginPath(),e.moveTo(c+10,h+8),e.lineTo(c+10,h+u-8),e.stroke(),o.containerText){e.save(),e.textAlign="left";const f=c+25,g=Dt(e,o,o.containerText,d-30),p=h+(u-g.textHeight)/2+g.lineHeight/2;e.fillStyle=s,g.lines.forEach((m,y)=>{e.fillText(m,f,p+y*g.lineHeight)}),e.restore();return}break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=A.adjustColor(o.strokeColor,l),c=o.x,h=o.y,d=o.width,u=o.height;switch(o.type){case"browser":{e.rectangle(c,h,d,u,s);const f=u*.15;e.line(c,h+f,c+d,h+f,s);const g=f*.3;for(let p=0;p<3;p++)e.circle(c+f*(.5+p*.6),h+f/2,g,{...s,fillStyle:"solid",fill:a});break}case"ghostButton":{const f=Math.min(d,u)*.2,g=this.getRoundedRectPath(c,h,d,u,f);e.path(g,{...s,strokeLineDash:[4,4]});break}case"inputField":{e.rectangle(c,h,d,u,s),e.line(c+10,h+8,c+10,h+u-8,s);break}}A.renderText(t,n,r)}getRoundedRectPath(t,n,r,e,o){const l=Math.min(Math.abs(r)/2,o),s=Math.min(Math.abs(e)/2,o);return`M ${t+l} ${n} L ${t+r-l} ${n} Q ${t+r} ${n} ${t+r} ${n+s} L ${t+r} ${n+e-s} Q ${t+r} ${n+e} ${t+r-l} ${n+e} L ${t+l} ${n+e} Q ${t} ${n+e} ${t} ${n+e-s} L ${t} ${n+s} Q ${t} ${n} ${t+l} ${n}`}definePath(t,n){if(n.type==="ghostButton"){const r=Math.min(n.width,n.height)*.2;t.roundRect(n.x,n.y,n.width,n.height,r)}else t.rect(n.x,n.y,n.width,n.height)}}class x1 extends bt{render(t){const{ctx:n,element:r,layerOpacity:e}=t,{cx:o,cy:l}=A.applyTransformations(n,r,e),s=r.drawProgress;s!==void 0&&s>=0&&s<100?this.renderDrawProgress(t,o,l):r.renderStyle==="architectural"?this.renderArchitectural(t,o,l):this.renderSketch(t,o,l),A.restoreTransformations(n)}renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t;e.save(),A.applyStrokeStyle(e,o,l),e.beginPath(),this.definePath(e,o),e.stroke(),this.renderFlow(t);const s=ft(o.points);let a,c;s.length>=2?(a={x:o.x+s[0].x,y:o.y+s[0].y},c={x:o.x+s[s.length-1].x,y:o.y+s[s.length-1].y}):(a={x:o.x,y:o.y},c={x:o.x+o.width,y:o.y+o.height});let h;if(o.curveType==="bezier"){const d=o.controlPoints?.[0]||{x:a.x,y:a.y},u=o.controlPoints?.[1]||d;if(o.startArrowhead){const f=Math.atan2(a.y-d.y,a.x-d.x);this.drawArrowheadArchitectural(e,a.x,a.y,f,o.startArrowhead,o.startArrowheadSize||12)}if(o.endArrowhead){const f=Math.atan2(c.y-u.y,c.x-u.x);this.drawArrowheadArchitectural(e,c.x,c.y,f,o.endArrowhead,o.endArrowheadSize||12)}}else if(o.curveType==="elbow"&&s.length>=2){const d={x:o.x+s[0].x,y:o.y+s[0].y},u={x:o.x+s[1].x,y:o.y+s[1].y},f=Math.atan2(d.y-u.y,d.x-u.x);o.startArrowhead&&this.drawArrowheadArchitectural(e,d.x,d.y,f,o.startArrowhead,o.startArrowheadSize||12);const g={x:o.x+s[s.length-1].x,y:o.y+s[s.length-1].y},p={x:o.x+s[s.length-2].x,y:o.y+s[s.length-2].y},m=Math.atan2(g.y-p.y,g.x-p.x);o.endArrowhead&&this.drawArrowheadArchitectural(e,g.x,g.y,m,o.endArrowhead,o.endArrowheadSize||12)}else h=Math.atan2(c.y-a.y,c.x-a.x),o.startArrowhead&&this.drawArrowheadArchitectural(e,a.x,a.y,h+Math.PI,o.startArrowhead,o.startArrowheadSize||12),o.endArrowhead&&this.drawArrowheadArchitectural(e,c.x,c.y,h,o.endArrowhead,o.endArrowheadSize||12);e.restore()}renderSketch(t,n,r){this.renderCommon(t,n,r),this.renderFlow(t)}renderCommon(t,n,r){const{element:e,isDarkMode:o}=t,l=A.buildRenderOptions(e,o);e.curveType==="bezier"?this.renderBezier(t,l):e.curveType==="elbow"?this.renderElbow(t,l):this.renderStraight(t,l)}renderBezier(t,n){n={...n,fill:void 0};const{rc:r,element:e}=t,o=e.x+e.width,l=e.y+e.height,s=ft(e.points);let a={x:e.x,y:e.y},c={x:o,y:l};if(s.length>=2&&(a={x:e.x+s[0].x,y:e.y+s[0].y},c={x:e.x+s[s.length-1].x,y:e.y+s[s.length-1].y}),e.controlPoints&&e.controlPoints.length>0){const h=e.controlPoints[0];if(e.controlPoints.length>1){const d=e.controlPoints[1],u=`M ${a.x} ${a.y} C ${h.x} ${h.y}, ${d.x} ${d.y}, ${c.x} ${c.y}`;r.path(u,n),e.startArrowhead&&this.drawArrowhead(r,a.x,a.y,Math.atan2(a.y-h.y,a.x-h.x),e.startArrowhead,n,e.startArrowheadSize||12),e.endArrowhead&&this.drawArrowhead(r,c.x,c.y,Math.atan2(c.y-d.y,c.x-d.x),e.endArrowhead,n,e.endArrowheadSize||12)}else{const d=`M ${a.x} ${a.y} Q ${h.x} ${h.y}, ${c.x} ${c.y}`;r.path(d,n),e.startArrowhead&&this.drawArrowhead(r,a.x,a.y,Math.atan2(a.y-h.y,a.x-h.x),e.startArrowhead,n,e.startArrowheadSize||12),e.endArrowhead&&this.drawArrowhead(r,c.x,c.y,Math.atan2(c.y-h.y,c.x-h.x),e.endArrowhead,n,e.endArrowheadSize||12)}}else{const h=e.width,d=e.height;let u,f;Math.abs(h)>Math.abs(d)?(u={x:a.x+h/2,y:a.y},f={x:c.x-h/2,y:c.y}):(u={x:a.x,y:a.y+d/2},f={x:c.x,y:c.y-d/2});const g=`M ${a.x} ${a.y} C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`;r.path(g,n),e.startArrowhead&&this.drawArrowhead(r,a.x,a.y,Math.atan2(a.y-u.y,a.x-u.x),e.startArrowhead,n,e.startArrowheadSize||12),e.endArrowhead&&this.drawArrowhead(r,c.x,c.y,Math.atan2(c.y-f.y,c.x-f.x),e.endArrowhead,n,e.endArrowheadSize||12)}}renderElbow(t,n){n={...n,fill:void 0};const{rc:r,element:e}=t,o=ft(e.points),l=o&&o.length>0?o.map(a=>[e.x+a.x,e.y+a.y]):[[e.x,e.y],[e.x+e.width,e.y+e.height]];r.linearPath(l,n);const s=l.filter((a,c,h)=>c===0||Math.abs(a[0]-h[c-1][0])>.1||Math.abs(a[1]-h[c-1][1])>.1);if(e.startArrowhead&&s.length>=2){const a=Math.atan2(s[0][1]-s[1][1],s[0][0]-s[1][0]);this.drawArrowhead(r,s[0][0],s[0][1],a,e.startArrowhead,n,e.startArrowheadSize||12)}if(e.endArrowhead&&s.length>=2){const a=s.length,c=Math.atan2(s[a-1][1]-s[a-2][1],s[a-1][0]-s[a-2][0]);this.drawArrowhead(r,s[a-1][0],s[a-1][1],c,e.endArrowhead,n,e.endArrowheadSize||12)}}renderStraight(t,n){n={...n,fill:void 0};const{rc:r,element:e}=t,o=ft(e.points);let l,s;o.length>=2?(l={x:e.x+o[0].x,y:e.y+o[0].y},s={x:e.x+o[o.length-1].x,y:e.y+o[o.length-1].y}):(l={x:e.x,y:e.y},s={x:e.x+e.width,y:e.y+e.height}),r.line(l.x,l.y,s.x,s.y,n);const a=Math.atan2(s.y-l.y,s.x-l.x);e.startArrowhead&&this.drawArrowhead(r,l.x,l.y,a+Math.PI,e.startArrowhead,n,e.startArrowheadSize||12),e.endArrowhead&&this.drawArrowhead(r,s.x,s.y,a,e.endArrowhead,n,e.endArrowheadSize||12)}drawArrowhead(t,n,r,e,o,l,s=12){const a={x:n-s*Math.cos(e-Math.PI/6),y:r-s*Math.sin(e-Math.PI/6)},c={x:n-s*Math.cos(e+Math.PI/6),y:r-s*Math.sin(e+Math.PI/6)};if(o==="triangle"||o==="arrow")o==="triangle"?t.polygon([[n,r],[a.x,a.y],[c.x,c.y]],{...l,fill:"#ffffff",fillStyle:"solid"}):(t.line(n,r,a.x,a.y,l),t.line(n,r,c.x,c.y,l));else if(o==="circle"||o==="dot")t.circle(n,r,s,{...l,fill:o==="dot"?l.stroke:"#ffffff",fillStyle:"solid"});else if(o==="diamond"||o==="diamondFilled"){const h={x:n-s*2*Math.cos(e),y:r-s*2*Math.sin(e)},d={x:n-s*Math.cos(e),y:r-s*Math.sin(e)},u={x:d.x-s/2*Math.cos(e-Math.PI/2),y:d.y-s/2*Math.sin(e-Math.PI/2)},f={x:d.x-s/2*Math.cos(e+Math.PI/2),y:d.y-s/2*Math.sin(e+Math.PI/2)};t.polygon([[n,r],[u.x,u.y],[h.x,h.y],[f.x,f.y]],{...l,fill:o==="diamondFilled"?l.stroke:"#ffffff",fillStyle:"solid"})}else if(o==="crowsfoot"){const h={x:n-s*Math.cos(e-Math.PI/4),y:r-s*Math.sin(e-Math.PI/4)},d={x:n-s*Math.cos(e+Math.PI/4),y:r-s*Math.sin(e+Math.PI/4)},u={x:n-s*Math.cos(e),y:r-s*Math.sin(e)};t.line(n,r,h.x,h.y,l),t.line(n,r,d.x,d.y,l),t.line(n,r,u.x,u.y,l)}else if(o==="bar"){const h=n+Math.cos(e+Math.PI/2)*s,d=r+Math.sin(e+Math.PI/2)*s,u=n+Math.cos(e-Math.PI/2)*s,f=r+Math.sin(e-Math.PI/2)*s;t.line(h,d,u,f,l)}}drawArrowheadArchitectural(t,n,r,e,o,l=12){t.save(),t.translate(n,r),t.rotate(e),t.setLineDash([]),o==="triangle"||o==="arrow"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-l*Math.cos(Math.PI/6),-l*Math.sin(Math.PI/6)),o==="triangle"?(t.lineTo(-l*Math.cos(-Math.PI/6),-l*Math.sin(-Math.PI/6)),t.closePath(),t.fillStyle="#ffffff",t.fill()):(t.moveTo(0,0),t.lineTo(-l*Math.cos(-Math.PI/6),-l*Math.sin(-Math.PI/6))),t.stroke()):o==="circle"||o==="dot"?(t.beginPath(),t.arc(-l/2*Math.cos(0),0,l/2,0,Math.PI*2),o==="dot"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):o==="diamond"||o==="diamondFilled"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-l,-l/2),t.lineTo(-l*2,0),t.lineTo(-l,l/2),t.closePath(),o==="diamondFilled"?t.fillStyle=t.strokeStyle:t.fillStyle="#ffffff",t.fill(),t.stroke()):o==="crowsfoot"?(t.beginPath(),t.moveTo(0,0),t.lineTo(-l*Math.cos(Math.PI/4),-l*Math.sin(Math.PI/4)),t.moveTo(0,0),t.lineTo(-l*Math.cos(-Math.PI/4),-l*Math.sin(-Math.PI/4)),t.moveTo(0,0),t.lineTo(-l,0),t.stroke()):o==="bar"&&(t.beginPath(),t.moveTo(0,-l),t.lineTo(0,l),t.stroke()),t.restore()}renderFlow(t){const{ctx:n,element:r,isDarkMode:e}=t;if(!r.flowAnimation)return;const o=window.yappyGlobalTime||performance.now(),l=(r.flowSpeed??2)*50,s=o/1e3*l,a=A.adjustColor(r.flowColor||r.strokeColor,e),c=Math.max(2,r.strokeWidth*1.5),h=100/(r.flowDensity||3);n.save(),n.fillStyle=a,n.shadowBlur=r.flowStyle==="pulse"?c:0,n.shadowColor=a;const d=ft(r.points);let u,f;if(d.length>=2?(u={x:r.x+d[0].x,y:r.y+d[0].y},f={x:r.x+d[d.length-1].x,y:r.y+d[d.length-1].y}):(u={x:r.x,y:r.y},f={x:r.x+r.width,y:r.y+r.height}),r.curveType==="bezier"){let g,p;if(r.controlPoints&&r.controlPoints.length>0)g=r.controlPoints[0],p=r.controlPoints.length>1?r.controlPoints[1]:g;else{const x=r.width,k=r.height;Math.abs(x)>Math.abs(k)?(g={x:u.x+x/2,y:u.y},p={x:f.x-x/2,y:f.y}):(g={x:u.x,y:u.y+k/2},p={x:f.x,y:f.y-k/2})}const m=Math.sqrt((f.x-u.x)**2+(f.y-u.y)**2),y=Math.sqrt((g.x-u.x)**2+(g.y-u.y)**2)+Math.sqrt((p.x-g.x)**2+(p.y-g.y)**2)+Math.sqrt((f.x-p.x)**2+(f.y-p.y)**2),w=(m+y)/2,v=Math.ceil(w/5);for(let x=0;x<=v;x++){const k=x/v;if((k*w+s)%h<l/10){const M=dn(u.x,g.x,p.x,f.x,k),C=dn(u.y,g.y,p.y,f.y,k),R=Math.min(1,k+.01),E=dn(u.x,g.x,p.x,f.x,R),O=dn(u.y,g.y,p.y,f.y,R),z=Math.atan2(O-C,E-M);this.drawPulse(n,M,C,c,r.flowStyle,z)}}}else if(r.curveType==="elbow"&&d.length>=2){let g=0;for(let p=0;p<d.length-1;p++){const m={x:r.x+d[p].x,y:r.y+d[p].y},y={x:r.x+d[p+1].x,y:r.y+d[p+1].y},w=Math.sqrt((y.x-m.x)**2+(y.y-m.y)**2),v=Math.atan2(y.y-m.y,y.x-m.x),x=Math.ceil(w/5);for(let k=0;k<=x;k++){const S=k/x;if((g+S*w+s)%h<l/10){const C=m.x+(y.x-m.x)*S,R=m.y+(y.y-m.y)*S;this.drawPulse(n,C,R,c,r.flowStyle,v)}}g+=w}}else{const g=f.x-u.x,p=f.y-u.y,m=Math.sqrt(g*g+p*p),y=Math.atan2(p,g),w=Math.ceil(m/5);for(let v=0;v<=w;v++){const x=v/w;if((x*m+s)%h<l/10){const S=u.x+g*x,M=u.y+p*x;this.drawPulse(n,S,M,c,r.flowStyle,y)}}}n.restore()}drawPulse(t,n,r,e,o,l=0){if(t.save(),t.translate(n,r),t.rotate(l),o==="dashes")t.fillRect(-e,-e/2,e*2,e);else if(o==="pulse"){t.beginPath(),t.arc(0,0,e*1.5,0,Math.PI*2);const s=.5+.5*Math.sin(performance.now()/100);t.globalAlpha*=s,t.fill()}else t.beginPath(),t.arc(0,0,e,0,Math.PI*2),t.fill();t.restore()}definePath(t,n){const r=ft(n.points);let e,o;if(r.length>=2?(e={x:n.x+r[0].x,y:n.y+r[0].y},o={x:n.x+r[r.length-1].x,y:n.y+r[r.length-1].y}):(e={x:n.x,y:n.y},o={x:n.x+n.width,y:n.y+n.height}),n.curveType==="bezier"){const l=n.width,s=n.height;let a,c;n.controlPoints&&n.controlPoints.length>0?(a=n.controlPoints[0],n.controlPoints.length>1?(c=n.controlPoints[1],t.moveTo(e.x,e.y),t.bezierCurveTo(a.x,a.y,c.x,c.y,o.x,o.y)):(t.moveTo(e.x,e.y),t.quadraticCurveTo(a.x,a.y,o.x,o.y))):(Math.abs(l)>Math.abs(s)?(a={x:e.x+l/2,y:e.y},c={x:o.x-l/2,y:o.y}):(a={x:e.x,y:e.y+s/2},c={x:o.x,y:o.y-s/2}),t.moveTo(e.x,e.y),t.bezierCurveTo(a.x,a.y,c.x,c.y,o.x,o.y))}else if(n.curveType==="elbow"){const l=r&&r.length>0?r.map(s=>({x:n.x+s.x,y:n.y+s.y})):[e,o];t.moveTo(l[0].x,l[0].y);for(let s=1;s<l.length;s++)t.lineTo(l[s].x,l[s].y)}else t.moveTo(e.x,e.y),t.lineTo(o.x,o.y)}estimatePathLength(t){const n=ft(t.points);let r,e;if(n.length>=2?(r={x:t.x+n[0].x,y:t.y+n[0].y},e={x:t.x+n[n.length-1].x,y:t.y+n[n.length-1].y}):(r={x:t.x,y:t.y},e={x:t.x+t.width,y:t.y+t.height}),t.curveType==="bezier"){let o,l;if(t.controlPoints&&t.controlPoints.length>0)o=t.controlPoints[0],l=t.controlPoints.length>1?t.controlPoints[1]:o;else{const c=t.width,h=t.height;Math.abs(c)>Math.abs(h)?(o={x:r.x+c/2,y:r.y},l={x:e.x-c/2,y:e.y}):(o={x:r.x,y:r.y+h/2},l={x:e.x,y:e.y-h/2})}const s=Math.sqrt((e.x-r.x)**2+(e.y-r.y)**2),a=Math.sqrt((o.x-r.x)**2+(o.y-r.y)**2)+Math.sqrt((l.x-o.x)**2+(l.y-o.y)**2)+Math.sqrt((e.x-l.x)**2+(e.y-l.y)**2);return(s+a)/2}else if(t.curveType==="elbow"&&n.length>=2){let o=0;const l=n.map(s=>({x:t.x+s.x,y:t.y+s.y}));for(let s=0;s<l.length-1;s++)o+=Math.sqrt((l[s+1].x-l[s].x)**2+(l[s+1].y-l[s].y)**2);return o}else return Math.sqrt((e.x-r.x)**2+(e.y-r.y)**2)}}class k1 extends bt{render(t){const{ctx:n,element:r,layerOpacity:e}=t,{cx:o,cy:l}=A.applyTransformations(n,r,e);r.renderStyle==="architectural"?this.renderArchitectural(t,o,l):this.renderSketch(t,o,l),A.restoreTransformations(n)}renderArchitectural(t,n,r){this.renderCommon(t)}renderSketch(t,n,r){this.renderCommon(t)}renderCommon(t){const{ctx:n,element:r,isDarkMode:e,layerOpacity:o}=t;if(!r.points||r.points.length===0)return;let l=ft(r.points).map(a=>({x:r.x+a.x,y:r.y+a.y}));r.smoothing&&r.smoothing>0&&(l=this.smoothPoints(l,r.smoothing));const s=A.adjustColor(r.strokeColor,e);n.save(),n.strokeStyle=s,n.fillStyle=s,r.type==="fineliner"?this.renderFineliner(n,l,r.strokeWidth):r.type==="inkbrush"?this.renderInkbrush(n,l,r.strokeWidth,r.taperAmount,r.velocitySensitivity):r.type==="marker"?this.renderMarker(n,l,r.strokeWidth,r.opacity,o):r.type==="ink"&&this.renderFineliner(n,l,r.strokeWidth),n.restore()}smoothPoints(t,n){if(t.length<3)return t;const r=[t[0]],e=Math.floor(n/2)||1;for(let o=1;o<t.length-1;o++){let l=0,s=0,a=0;for(let c=Math.max(0,o-e);c<=Math.min(t.length-1,o+e);c++)l+=t[c].x,s+=t[c].y,a++;r.push({x:l/a,y:s/a})}return r.push(t[t.length-1]),r}renderFineliner(t,n,r){if(n.length<6){t.beginPath(),t.arc(n[0].x,n[0].y,r/2,0,Math.PI*2),t.fill();return}t.lineWidth=r,t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let o=1;o<n.length-2;o++){const l=(n[o].x+n[o+1].x)/2,s=(n[o].y+n[o+1].y)/2;t.quadraticCurveTo(n[o].x,n[o].y,l,s)}const e=n.length-1;t.quadraticCurveTo(n[e-1].x,n[e-1].y,n[e].x,n[e].y),t.stroke()}renderInkbrush(t,n,r,e=.15,o=.5){if(n.length<2){t.beginPath(),t.arc(n[0].x,n[0].y,r/2,0,Math.PI*2),t.fill();return}const l=[0];for(let p=1;p<n.length;p++){const m=n[p].x-n[p-1].x,y=n[p].y-n[p-1].y;l.push(Math.sqrt(m*m+y*y))}const s=[],a=3;for(let p=0;p<l.length;p++){let m=0,y=0;for(let w=Math.max(0,p-a);w<=Math.min(l.length-1,p+a);w++)m+=l[w],y++;s.push(m/y)}const c=Math.max(...s,1),h=r*(1-o*.7),d=r*(1+o*.5),u=[];for(let p=0;p<n.length;p++){const m=s[p]/c;let y=d-(d-h)*m;const w=Math.min(n.length*e,20);if(w>0&&(p<w&&(y*=p/w*.9+.1),p>n.length-w-1)){const v=n.length-1-p;y*=v/w*.9+.1}u.push(Math.max(y,.5))}t.beginPath();const f=[],g=[];for(let p=0;p<n.length;p++){let m,y;if(p===0){const v=n[1].x-n[0].x,x=n[1].y-n[0].y,k=Math.sqrt(v*v+x*x)||1;m=-x/k,y=v/k}else if(p===n.length-1){const v=n[p].x-n[p-1].x,x=n[p].y-n[p-1].y,k=Math.sqrt(v*v+x*x)||1;m=-x/k,y=v/k}else{const v=n[p].x-n[p-1].x,x=n[p].y-n[p-1].y,k=n[p+1].x-n[p].x,S=n[p+1].y-n[p].y,M=Math.sqrt(v*v+x*x)||1,C=Math.sqrt(k*k+S*S)||1;m=-(x/M+S/C)/2,y=(v/M+k/C)/2;const R=Math.sqrt(m*m+y*y)||1;m/=R,y/=R}const w=u[p]/2;f.push({x:n[p].x+m*w,y:n[p].y+y*w}),g.push({x:n[p].x-m*w,y:n[p].y-y*w})}if(f.length>=2){t.moveTo(f[0].x,f[0].y);for(let m=1;m<f.length-1;m++){const y=(f[m].x+f[m+1].x)/2,w=(f[m].y+f[m+1].y)/2;t.quadraticCurveTo(f[m].x,f[m].y,y,w)}t.lineTo(f[f.length-1].x,f[f.length-1].y);const p=n.length-1;t.arc(n[p].x,n[p].y,u[p]/2,Math.atan2(f[p].y-n[p].y,f[p].x-n[p].x),Math.atan2(g[p].y-n[p].y,g[p].x-n[p].x),!1);for(let m=g.length-2;m>0;m--){const y=(g[m].x+g[m-1].x)/2,w=(g[m].y+g[m-1].y)/2;t.quadraticCurveTo(g[m].x,g[m].y,y,w)}t.lineTo(g[0].x,g[0].y),t.arc(n[0].x,n[0].y,u[0]/2,Math.atan2(g[0].y-n[0].y,g[0].x-n[0].x),Math.atan2(f[0].y-n[0].y,f[0].x-n[0].x),!1)}t.closePath(),t.fill()}renderMarker(t,n,r,e,o){t.globalAlpha=(e??100)/100*o*.5,t.globalCompositeOperation="multiply",this.renderFineliner(t,n,r*4)}definePath(t,n){const r=ft(n.points).map(o=>({x:n.x+o.x,y:n.y+o.y}));if(r.length<2)return;if(r.length<6){t.moveTo(r[0].x,r[0].y);for(let o=1;o<r.length;o++)t.lineTo(r[o].x,r[o].y);return}t.moveTo(r[0].x,r[0].y);for(let o=1;o<r.length-2;o++){const l=(r[o].x+r[o+1].x)/2,s=(r[o].y+r[o+1].y)/2;t.quadraticCurveTo(r[o].x,r[o].y,l,s)}const e=r.length-1;t.quadraticCurveTo(r[e-1].x,r[e-1].y,r[e].x,r[e].y)}estimatePathLength(t){const n=ft(t.points);if(n.length<2)return 0;let r=0;for(let e=1;e<n.length;e++){const o=n[e].x-n[e-1].x,l=n[e].y-n[e-1].y;r+=Math.sqrt(o*o+l*l)}return r}}class S1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=A.adjustColor(o.strokeColor,l),c=o.backgroundColor==="transparent"?void 0:A.adjustColor(o.backgroundColor,l),h=Ft(o);if(!h)return;if(e.save(),e.translate(n,r),["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(o.type)&&h.type==="multi"){const u=s.fill&&s.fill!=="transparent"&&s.fill!=="none";h.shapes.forEach(f=>{u&&c&&(e.fillStyle=f.shade?A.shadeColor(c,f.shade):c,e.beginPath(),A.renderGeometry(e,f),e.fill()),A.applyStrokeStyle(e,o,l),f.shade&&(e.strokeStyle=A.shadeColor(e.strokeStyle,f.shade)),e.beginPath(),A.renderGeometry(e,f),e.stroke(),o.drawInnerBorder})}else if(s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&c&&(e.fillStyle=c,e.beginPath(),A.renderGeometry(e,h),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),A.renderGeometry(e,h),e.stroke(),o.drawInnerBorder){const f=o.innerBorderDistance||5,g=(o.width-f*2)/o.width,p=(o.height-f*2)/o.height;g>0&&p>0&&(e.save(),e.scale(g,p),e.strokeStyle=o.innerBorderColor||a,e.beginPath(),A.renderGeometry(e,h),e.stroke(),e.restore())}e.restore(),A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,ctx:o,element:l,isDarkMode:s}=t,a=A.buildRenderOptions(l,s),c=Ft(l);if(!c)return;o.save(),o.translate(n,r),this.renderSketchGeometry(e,c,a);const h=["solidBlock","cylinder","isometricCube","perspectiveBlock"].includes(l.type);if(l.drawInnerBorder&&!h){const d=l.innerBorderDistance||5,u=(l.width-d*2)/l.width,f=(l.height-d*2)/l.height;if(u>0&&f>0){const g={...a,stroke:l.innerBorderColor||a.stroke,fill:"none"};o.save(),o.scale(u,f),this.renderSketchGeometry(e,c,g),o.restore()}}o.restore(),A.renderText(t,n,r)}renderSketchGeometry(t,n,r){const e=n.shade&&r.fill&&r.fill!=="transparent"&&r.fill!=="none"?{...r,fill:A.shadeColor(r.fill,n.shade)}:r;if(n.type==="rect")t.rectangle(n.x,n.y,n.w,n.h,e);else if(n.type==="ellipse")t.ellipse(n.cx,n.cy,n.rx*2,n.ry*2,e);else if(n.type==="points"){const o=n.points.map(l=>[l.x,l.y]);n.isClosed===!1?t.linearPath(o,e):t.polygon(o,e)}else n.type==="path"?t.path(n.path,e):n.type==="multi"&&n.shapes.forEach(o=>this.renderSketchGeometry(t,o,e))}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class M1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l);e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.fillStyle=s.fill||"transparent",s.fill&&s.fill!=="none"&&e.fill(),A.applyStrokeStyle(e,o,l),e.stroke();const a=this.calculateLayout(e,o);this.drawDividers(e,o,a,s.stroke||"#000000",l),this.renderTexts(t,o,a)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l);e.rectangle(o.x,o.y,o.width,o.height,s);const c=document.createElement("canvas").getContext("2d"),h=this.calculateLayout(c,o);this.drawSketchDividers(e,o,h,s),this.renderTexts(t,o,h)}definePath(t,n){t.rect(n.x,n.y,n.width,n.height)}calculateLayout(t,n){const r=n.containerText||"";let e=30;if(r){const s=Dt(t,n,r,n.width-10);e=Math.max(30,s.textHeight+20)}const o=n.attributesText||"";let l=0;if(o){const s=Dt(t,{...n,fontSize:(n.fontSize||20)*.9},o,n.width-10);l=Math.max(20,s.textHeight+10)}else n.type==="umlClass"&&(l=20);return{headerHeight:e,attrHeight:l,hasAttributes:!!o||n.type==="umlClass",hasMethods:!!n.methodsText||n.type==="umlClass"}}drawDividers(t,n,r,e,o){t.strokeStyle=e,t.lineWidth=1;const l=n.y+r.headerHeight;l<n.y+n.height&&(A.applyStrokeStyle(t,n,o),t.stroke()),r.hasAttributes&&r.hasMethods&&l+r.attrHeight<n.y+n.height&&(A.applyStrokeStyle(t,n,o),t.stroke())}drawSketchDividers(t,n,r,e){const o=n.y+r.headerHeight;if(o<n.y+n.height&&t.line(n.x,o,n.x+n.width,o,e),r.hasAttributes&&r.hasMethods){const l=o+r.attrHeight;l<n.y+n.height&&t.line(n.x,l,n.x+n.width,l,e)}}renderTexts(t,n,r){const{ctx:e,isDarkMode:o}=t;if(n.containerText&&this.renderSectionText(e,n,n.containerText,n.x+n.width/2,n.y+r.headerHeight/2,n.width-10,"center",!0,o),n.attributesText){const l=n.y+r.headerHeight+10,s=(n.fontSize||20)*.9;this.renderSectionText(e,{...n,fontSize:s},n.attributesText,n.x+10,l,n.width-20,"left",!1,o)}if(n.methodsText){const l=n.y+r.headerHeight+r.attrHeight+10,s=(n.fontSize||20)*.9;this.renderSectionText(e,{...n,fontSize:s},n.methodsText,n.x+10,l,n.width-20,"left",!1,o)}}renderSectionText(t,n,r,e,o,l,s,a,c){if(!r)return;t.save(),t.font=hi({...n,fontWeight:a?"bold":n.fontWeight});const h=A.adjustColor(n.strokeColor||"#000",c);t.fillStyle=h,t.textAlign=s,t.textBaseline=s==="center"?"middle":"top";const d=Dt(t,n,r,l);d.lines.forEach((u,f)=>{const g=o+f*d.lineHeight-(s==="center"?(d.lines.length-1)*d.lineHeight/2:0);t.fillText(u,e,g)}),t.restore()}}class P1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.width,c=o.height,h=o.x,d=o.y;if(e.beginPath(),o.type==="umlActor")this.drawActorPath(e,h,d,a,c);else if(o.type==="umlUseCase"||o.type==="umlInterface")e.ellipse(h+a/2,d+c/2,a/2,c/2,0,0,Math.PI*2);else if(o.type==="umlPackage")this.drawPackagePath(e,h,d,a,c);else if(o.type==="umlNote")this.drawNotePath(e,h,d,a,c);else if(o.type==="umlComponent")e.rect(h,d,a,c);else if(o.type==="umlLifeline"){const u=Math.max(30,c*.2);e.rect(h,d,a,u)}else o.type==="umlFragment"&&e.rect(h,d,a,c);if(e.fillStyle=s.fill||"transparent",s.fill&&s.fill!=="none"&&e.fill(),e.lineWidth=o.strokeWidth,e.strokeStyle=s.stroke||"#000000",e.stroke(),o.type==="umlNote"){const u=Math.min(a,c)*.15;e.beginPath(),e.moveTo(h+a-u,d),e.lineTo(h+a-u,d+u),e.lineTo(h+a,d+u),e.stroke()}if(o.type==="umlComponent"){const u=Math.min(16,a*.15),f=Math.min(10,c*.08),g=h-u/2;e.fillStyle=s.fill||"transparent",e.strokeStyle=s.stroke||"#000000",e.beginPath(),e.rect(g,d+c*.25-f/2,u,f),s.fill&&s.fill!=="none"&&e.fill(),e.stroke(),e.beginPath(),e.rect(g,d+c*.55-f/2,u,f),s.fill&&s.fill!=="none"&&e.fill(),e.stroke()}if(o.type==="umlLifeline"){const u=Math.max(30,c*.2);e.save(),e.setLineDash([8,6]),e.beginPath(),e.moveTo(h+a/2,d+u),e.lineTo(h+a/2,d+c),e.stroke(),e.restore()}if(o.type==="umlFragment"){const u=Math.min(a*.3,60),f=Math.min(c*.12,22);e.fillStyle=s.fill||"transparent",e.strokeStyle=s.stroke||"#000000",e.beginPath(),e.moveTo(h,d),e.lineTo(h+u,d),e.lineTo(h+u,d+f),e.lineTo(h+u-5,d+f+5),e.lineTo(h,d+f+5),e.closePath(),s.fill&&s.fill!=="none"&&e.fill(),e.stroke()}if(o.type==="umlLifeline"){const u=Math.max(30,c*.2),f=o.y+u/2;A.renderText(t,n,f)}else A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.width,c=o.height,h=o.x,d=o.y;if(o.type==="umlActor"){const u=a*.15;e.circle(h+a/2,d+u,u*2,s),e.line(h+a/2,d+u*2,h+a/2,d+c*.6,s),e.line(h,d+c*.3,h+a,d+c*.3,s),e.line(h+a/2,d+c*.6,h,d+c,s),e.line(h+a/2,d+c*.6,h+a,d+c,s)}else if(o.type==="umlUseCase"||o.type==="umlInterface")e.ellipse(h+a/2,d+c/2,a,c,s);else if(o.type==="umlPackage"){const u=c*.15,f=a*.4,g=`M ${h} ${d} L ${h+f} ${d} L ${h+f} ${d+u} L ${h+a} ${d+u} L ${h+a} ${d+c} L ${h} ${d+c} Z`;e.path(g,s),e.line(h,d+u,h+f,d+u,s)}else if(o.type==="umlNote"){const u=Math.min(a,c)*.15,f=`M ${h} ${d} L ${h+a-u} ${d} L ${h+a} ${d+u} L ${h+a} ${d+c} L ${h} ${d+c} L ${h} ${d} Z`;e.path(f,s),e.path(`M ${h+a-u} ${d} L ${h+a-u} ${d+u} L ${h+a} ${d+u}`,s)}else if(o.type==="umlComponent"){e.rectangle(h,d,a,c,s);const u=Math.min(16,a*.15),f=Math.min(10,c*.08),g=h-u/2;e.rectangle(g,d+c*.25-f/2,u,f,s),e.rectangle(g,d+c*.55-f/2,u,f,s)}else if(o.type==="umlLifeline"){const u=Math.max(30,c*.2);e.rectangle(h,d,a,u,s);const f={...s,strokeLineDash:[8,6],fill:"none"};e.line(h+a/2,d+u,h+a/2,d+c,f)}else if(o.type==="umlFragment"){e.rectangle(h,d,a,c,s);const u=Math.min(a*.3,60),f=Math.min(c*.12,22),g=`M ${h} ${d} L ${h+u} ${d} L ${h+u} ${d+f} L ${h+u-5} ${d+f+5} L ${h} ${d+f+5} Z`;e.path(g,s)}if(o.type==="umlLifeline"){const u=Math.max(30,c*.2),f=o.y+u/2;A.renderText(t,n,f)}else A.renderText(t,n,r)}definePath(t,n){n.type==="umlActor"?this.drawActorPath(t,n.x,n.y,n.width,n.height):n.type==="umlUseCase"||n.type==="umlInterface"?t.ellipse(n.x+n.width/2,n.y+n.height/2,n.width/2,n.height/2,0,0,Math.PI*2):n.type==="umlPackage"?this.drawPackagePath(t,n.x,n.y,n.width,n.height):n.type==="umlNote"?this.drawNotePath(t,n.x,n.y,n.width,n.height):(n.type==="umlComponent"||n.type==="umlLifeline"||n.type==="umlFragment")&&t.rect(n.x,n.y,n.width,n.height)}drawActorPath(t,n,r,e,o){const l=e*.15;t.moveTo(n+e/2+l,r+l),t.arc(n+e/2,r+l,l,0,Math.PI*2),t.moveTo(n+e/2,r+l*2),t.lineTo(n+e/2,r+o*.6),t.moveTo(n,r+o*.3),t.lineTo(n+e,r+o*.3),t.moveTo(n+e/2,r+o*.6),t.lineTo(n,r+o),t.moveTo(n+e/2,r+o*.6),t.lineTo(n+e,r+o)}drawPackagePath(t,n,r,e,o){const l=o*.15,s=e*.4;t.moveTo(n,r),t.lineTo(n+s,r),t.lineTo(n+s,r+l),t.lineTo(n+e,r+l),t.lineTo(n+e,r+o),t.lineTo(n,r+o),t.closePath()}drawNotePath(t,n,r,e,o){const l=Math.min(e,o)*.15;t.moveTo(n,r),t.lineTo(n+e-l,r),t.lineTo(n+e,r+l),t.lineTo(n+e,r+o),t.lineTo(n,r+o),t.closePath()}}class C1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);e.beginPath(),s>0?e.roundRect(o.x,o.y,o.width,o.height,s):e.rect(o.x,o.y,o.width,o.height),e.fillStyle=a.fill||"transparent",a.fill&&a.fill!=="none"&&e.fill(),e.lineWidth=o.strokeWidth,e.strokeStyle=a.stroke||"#000000",e.stroke();const c=this.calculateLayout(e,o);this.drawDivider(e,o,c,a.stroke||"#000000",!1),this.renderTexts(t,o,c)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=this.getRadius(o),a=A.buildRenderOptions(o,l);if(s>0){const d=this.getRoundedRectPath(o.x,o.y,o.width,o.height,s);e.path(d,a)}else e.rectangle(o.x,o.y,o.width,o.height,a);const c=tf(),h=this.calculateLayout(c,o);this.drawDivider(null,o,h,a.stroke||"#000000",!0,e,a),this.renderTexts(t,o,h)}definePath(t,n){const r=this.getRadius(n);r>0?t.roundRect(n.x,n.y,n.width,n.height,r):t.rect(n.x,n.y,n.width,n.height)}getRadius(t){return Math.min(Math.abs(t.width),Math.abs(t.height))*.15}getRoundedRectPath(t,n,r,e,o){const l=Math.min(Math.abs(r)/2,o),s=Math.min(Math.abs(e)/2,o);return`M ${t+l} ${n} L ${t+r-l} ${n} Q ${t+r} ${n} ${t+r} ${n+s} L ${t+r} ${n+e-s} Q ${t+r} ${n+e} ${t+r-l} ${n+e} L ${t+l} ${n+e} Q ${t} ${n+e} ${t} ${n+e-s} L ${t} ${n+s} Q ${t} ${n} ${t+l} ${n}`}calculateLayout(t,n){const r=n.containerText||"";let e=Math.min(n.height,35);if(r){const o=Dt(t,n,r,n.width-20);e=Math.max(e,o.textHeight+15)}return{headerHeight:e}}drawDivider(t,n,r,e,o,l,s){const a=n.y+r.headerHeight;a<n.y+n.height&&(o&&l?l.line(n.x,a,n.x+n.width,a,s):t&&(t.strokeStyle=e,t.lineWidth=1,t.beginPath(),t.moveTo(n.x,a),t.lineTo(n.x+n.width,a),t.stroke()))}renderTexts(t,n,r){const{ctx:e,isDarkMode:o}=t;if(n.containerText&&this.renderSectionText(e,n,n.containerText,n.x+n.width/2,n.y+r.headerHeight/2,n.width-20,"center",!0,o),n.attributesText){const l=n.y+r.headerHeight+5,s=(n.fontSize||20)*.9;this.renderSectionText(e,{...n,fontSize:s},n.attributesText,n.x+10,l,n.width-20,"left",!1,o)}}renderSectionText(t,n,r,e,o,l,s,a,c){if(!r)return;t.save(),t.font=hi({...n,fontWeight:a?"bold":n.fontWeight});const h=A.adjustColor(n.strokeColor||"#000",c);t.fillStyle=h,t.textAlign=s,t.textBaseline=s==="center"?"middle":"top";const d=Dt(t,n,r,l);d.lines.forEach((u,f)=>{const g=o+f*d.lineHeight-(s==="center"?(d.lines.length-1)*d.lineHeight/2:0);t.fillText(u,e,g)}),t.restore()}}class _1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"stickFigure":{const u=Math.min(h,d)*.12,f=a+h/2,g=c+u,p=g+u,m=c+d*.6,y=p+(m-p)*.2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(f,p),e.lineTo(f,m),e.stroke(),e.beginPath(),e.moveTo(a+h*.15,y-d*.05),e.lineTo(f,y),e.lineTo(a+h*.85,y-d*.05),e.stroke(),e.beginPath(),e.moveTo(a+h*.2,c+d),e.lineTo(f,m),e.lineTo(a+h*.8,c+d),e.stroke();break}case"sittingPerson":{const u=Math.min(h,d)*.11,f=a+h/2,g=c+u,p=g+u,m=c+d*.55,y=p+(m-p)*.25;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(f,p),e.lineTo(f,m),e.stroke(),e.beginPath(),e.moveTo(a+h*.2,y+d*.05),e.lineTo(f,y),e.lineTo(a+h*.8,y+d*.05),e.stroke(),e.beginPath(),e.moveTo(f,m),e.lineTo(a+h*.8,m),e.stroke(),e.beginPath(),e.moveTo(a+h*.8,m),e.lineTo(a+h*.8,c+d),e.stroke();break}case"presentingPerson":{const u=Math.min(h,d)*.1,f=a+h*.3,g=c+u,p=g+u,m=c+d*.6,y=p+(m-p)*.15;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(f,p),e.lineTo(f,m),e.stroke(),e.beginPath(),e.moveTo(f,y),e.lineTo(a+h*.1,m),e.stroke(),e.beginPath(),e.moveTo(f,y),e.lineTo(a+h*.75,c+d*.1),e.stroke(),e.beginPath(),e.moveTo(a+h*.15,c+d),e.lineTo(f,m),e.lineTo(a+h*.45,c+d),e.stroke(),e.strokeRect(a+h*.55,c,h*.45,d*.5);break}case"handPointRight":{const u=this.getHandPointRightPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));break}case"thumbsUp":{const u=this.getThumbsUpPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));break}case"faceHappy":{this.renderFace(e,o,l,s,"happy");break}case"faceSad":{this.renderFace(e,o,l,s,"sad");break}case"faceConfused":{this.renderFace(e,o,l,s,"confused");break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"stickFigure":{const u=Math.min(h,d)*.12,f=a+h/2,g=c+u,p=g+u,m=c+d*.6,y=p+(m-p)*.2;e.circle(f,g,u*2,s),e.line(f,p,f,m,{...s,fill:"none"}),e.line(a+h*.15,y-d*.05,f,y,{...s,fill:"none"}),e.line(f,y,a+h*.85,y-d*.05,{...s,fill:"none"}),e.line(a+h*.2,c+d,f,m,{...s,fill:"none"}),e.line(f,m,a+h*.8,c+d,{...s,fill:"none"});break}case"sittingPerson":{const u=Math.min(h,d)*.11,f=a+h/2,g=c+u,p=g+u,m=c+d*.55,y=p+(m-p)*.25;e.circle(f,g,u*2,s),e.line(f,p,f,m,{...s,fill:"none"}),e.line(a+h*.2,y+d*.05,f,y,{...s,fill:"none"}),e.line(f,y,a+h*.8,y+d*.05,{...s,fill:"none"}),e.line(f,m,a+h*.8,m,{...s,fill:"none"}),e.line(a+h*.8,m,a+h*.8,c+d,{...s,fill:"none"});break}case"presentingPerson":{const u=Math.min(h,d)*.1,f=a+h*.3,g=c+u,p=g+u,m=c+d*.6,y=p+(m-p)*.15;e.circle(f,g,u*2,s),e.line(f,p,f,m,{...s,fill:"none"}),e.line(f,y,a+h*.1,m,{...s,fill:"none"}),e.line(f,y,a+h*.75,c+d*.1,{...s,fill:"none"}),e.line(a+h*.15,c+d,f,m,{...s,fill:"none"}),e.line(f,m,a+h*.45,c+d,{...s,fill:"none"}),e.rectangle(a+h*.55,c,h*.45,d*.5,s);break}case"handPointRight":{e.path(this.getHandPointRightPath(a,c,h,d),s);break}case"thumbsUp":{e.path(this.getThumbsUpPath(a,c,h,d),s);break}case"faceHappy":{this.renderFaceSketch(e,o,l,s,"happy");break}case"faceSad":{this.renderFaceSketch(e,o,l,s,"sad");break}case"faceConfused":{this.renderFaceSketch(e,o,l,s,"confused");break}}A.renderText(t,n,r)}renderFace(t,n,r,e,o){const l=n.x,s=n.y,a=n.width,c=n.height,h=Math.min(a,c)/2,d=l+a/2,u=s+c/2;e.fill&&e.fill!=="transparent"&&e.fill!=="none"&&(t.fillStyle=e.fill,t.beginPath(),t.ellipse(d,u,h,h,0,0,Math.PI*2),t.fill()),A.applyStrokeStyle(t,n,r),t.beginPath(),t.ellipse(d,u,h,h,0,0,Math.PI*2),t.stroke();const f=h*.08,g=u-h*.2,p=h*.3;t.beginPath(),t.arc(d-p,g,f,0,Math.PI*2),t.fillStyle=A.adjustColor(n.strokeColor||"#000000",r),t.fill(),t.beginPath(),t.arc(d+p,g,f,0,Math.PI*2),t.fill();const m=u+h*.25,y=h*.4;t.beginPath(),o==="happy"?t.arc(d,m-h*.05,y,.1,Math.PI-.1):o==="sad"?t.arc(d,m+h*.2,y,Math.PI+.1,-.1):(t.moveTo(d-y,m),t.quadraticCurveTo(d-y*.3,m-h*.1,d,m),t.quadraticCurveTo(d+y*.3,m+h*.1,d+y,m)),t.stroke(),o==="confused"&&(t.beginPath(),t.moveTo(d+p-f*2,g-h*.15),t.lineTo(d+p+f*2,g-h*.22),t.stroke())}renderFaceSketch(t,n,r,e,o){const l=n.x,s=n.y,a=n.width,c=n.height,h=Math.min(a,c)/2,d=l+a/2,u=s+c/2;t.circle(d,u,h*2,e);const f=h*.08,g=u-h*.2,p=h*.3,m=A.adjustColor(n.strokeColor||"#000000",r);t.circle(d-p,g,f*2,{...e,fill:m}),t.circle(d+p,g,f*2,{...e,fill:m});const y=u+h*.25,w=h*.4;if(o==="happy")t.arc(d,y-h*.05,w*2,w*2,.1,Math.PI-.1,!1,{...e,fill:"none"});else if(o==="sad")t.arc(d,y+h*.2,w*2,w*2,Math.PI+.1,-.1,!1,{...e,fill:"none"});else{const v=`M ${d-w} ${y} Q ${d-w*.3} ${y-h*.1} ${d} ${y} Q ${d+w*.3} ${y+h*.1} ${d+w} ${y}`;t.path(v,{...e,fill:"none"})}o==="confused"&&t.line(d+p-f*2,g-h*.15,d+p+f*2,g-h*.22,{...e,fill:"none"})}getHandPointRightPath(t,n,r,e){const o=t,l=t+r*.35,s=n+e*.15,a=n+e*.55,c=t+r,h=n+e*.08,d=n+e*.32,u=Math.min(r,e)*.06,f=t+r*.2,g=n,p=a,m=n+e,y=t+r*.08,w=l+r*.05,v=p+(m-p)*.33,x=p+(m-p)*.66;let k="";return k+=`M ${o} ${s}`,k+=` Q ${f-r*.05} ${g+e*.02} ${f} ${g}`,k+=` Q ${f+r*.08} ${g} ${l-r*.05} ${h+e*.02}`,k+=` L ${l} ${h}`,k+=` L ${c-u} ${h}`,k+=` Q ${c} ${h} ${c} ${(h+d)/2}`,k+=` Q ${c} ${d} ${c-u} ${d}`,k+=` L ${l} ${d}`,k+=` L ${w} ${p}`,k+=` Q ${w+r*.1} ${p+(v-p)*.5} ${w} ${v}`,k+=` Q ${w+r*.1} ${v+(x-v)*.5} ${w} ${x}`,k+=` Q ${w+r*.08} ${x+(m-x)*.5} ${w-r*.05} ${m}`,k+=` L ${y} ${m}`,k+=` Q ${o-r*.02} ${m} ${o} ${a}`,k+=" Z",k}getThumbsUpPath(t,n,r,e){const o=t+r*.1,l=t+r*.9,s=n+e*.42,a=n+e,c=Math.min(r,e)*.06,h=t+r*.28,d=t+r*.52,u=n,f=(d-h)/2;let g="";g+=`M ${h} ${s}`,g+=` L ${h} ${u+f}`,g+=` Q ${h} ${u} ${(h+d)/2} ${u}`,g+=` Q ${d} ${u} ${d} ${u+f}`,g+=` L ${d} ${s}`,g+=` L ${l-c} ${s}`,g+=` Q ${l} ${s} ${l} ${s+c}`,g+=` L ${l} ${a-c}`,g+=` Q ${l} ${a} ${l-c} ${a}`,g+=` L ${o+c} ${a}`,g+=` Q ${o} ${a} ${o} ${a-c}`,g+=` L ${o} ${s+c}`,g+=` Q ${o} ${s} ${o+c} ${s}`,g+=" Z";const p=s+(a-s)*.33,m=s+(a-s)*.63;return g+=` M ${d+r*.04} ${p} L ${l-r*.06} ${p}`,g+=` M ${d+r*.04} ${m} L ${l-r*.06} ${m}`,g}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class A1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"checkbox":{const u=Math.min(h,d)*.15;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,c,h,d,u),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,c,h,d,u),e.stroke();break}case"checkboxChecked":{const u=Math.min(h,d)*.15;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,c,h,d,u),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,c,h,d,u),e.stroke(),e.beginPath(),e.moveTo(a+h*.2,c+d*.5),e.lineTo(a+h*.42,c+d*.75),e.lineTo(a+h*.8,c+d*.25),e.lineWidth=Math.max(2,Math.min(h,d)*.08),e.stroke();break}case"numberedBadge":{const u=Math.min(h,d)/2,f=a+h/2,g=c+d/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke();break}case"questionMark":{const u=Math.min(h,d)/2,f=a+h/2,g=c+d/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke(),this.drawSymbol(e,o,l,"?",f,g,u);break}case"exclamationMark":{const u=Math.min(h,d)/2,f=a+h/2,g=c+d/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(f,g,u,u,0,0,Math.PI*2),e.stroke(),this.drawSymbol(e,o,l,"!",f,g,u);break}case"tag":{const u=this.getTagPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));const f=Math.min(h,d)*.06;e.beginPath(),e.arc(a+h*.15,c+d/2,f,0,Math.PI*2),e.stroke();break}case"pin":{const u=this.getPinPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));const f=Math.min(h,d)*.1,g=c+Math.min(h,d)*.3;e.beginPath(),e.arc(a+h/2,g,f,0,Math.PI*2),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();break}case"stamp":{const u=this.getStampPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));const f=Math.min(h,d)*.32;e.beginPath(),e.ellipse(a+h/2,c+d/2,f,f,0,0,Math.PI*2),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{ctx:e,rc:o,element:l,isDarkMode:s}=t,a=A.buildRenderOptions(l,s),c=l.x,h=l.y,d=l.width,u=l.height;switch(l.type){case"checkbox":{o.rectangle(c,h,d,u,a);break}case"checkboxChecked":{o.rectangle(c,h,d,u,a),o.line(c+d*.2,h+u*.5,c+d*.42,h+u*.75,{...a,fill:"none"}),o.line(c+d*.42,h+u*.75,c+d*.8,h+u*.25,{...a,fill:"none"});break}case"numberedBadge":{o.circle(c+d/2,h+u/2,Math.min(d,u),a);break}case"questionMark":{const f=Math.min(d,u)/2,g=c+d/2,p=h+u/2;o.circle(g,p,f*2,a),this.drawSymbol(e,l,s,"?",g,p,f);break}case"exclamationMark":{const f=Math.min(d,u)/2,g=c+d/2,p=h+u/2;o.circle(g,p,f*2,a),this.drawSymbol(e,l,s,"!",g,p,f);break}case"tag":{o.path(this.getTagPath(c,h,d,u),a);const f=Math.min(d,u)*.06;o.circle(c+d*.15,h+u/2,f*2,{...a,fill:"none"});break}case"pin":{o.path(this.getPinPath(c,h,d,u),a);const f=Math.min(d,u)*.1,g=A.adjustColor(l.strokeColor||"#000000",s);o.circle(c+d/2,h+Math.min(d,u)*.3,f*2,{...a,fill:g});break}case"stamp":{o.path(this.getStampPath(c,h,d,u),a);const f=Math.min(d,u)*.32;o.circle(c+d/2,h+u/2,f*2,{...a,fill:"none"});break}}A.renderText(t,n,r)}roundRect(t,n,r,e,o,l){t.beginPath(),t.moveTo(n+l,r),t.lineTo(n+e-l,r),t.quadraticCurveTo(n+e,r,n+e,r+l),t.lineTo(n+e,r+o-l),t.quadraticCurveTo(n+e,r+o,n+e-l,r+o),t.lineTo(n+l,r+o),t.quadraticCurveTo(n,r+o,n,r+o-l),t.lineTo(n,r+l),t.quadraticCurveTo(n,r,n+l,r),t.closePath()}drawSymbol(t,n,r,e,o,l,s){const a=s*1;t.font=`bold ${a}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillStyle=A.adjustColor(n.strokeColor||"#000000",r),t.fillText(e,o,l+a*.05)}getTagPath(t,n,r,e){const o=t+r*.08,l=Math.min(r,e)*.08;let s=`M ${o} ${n}`;return s+=` L ${t+r-l} ${n}`,s+=` Q ${t+r} ${n} ${t+r} ${n+l}`,s+=` L ${t+r} ${n+e-l}`,s+=` Q ${t+r} ${n+e} ${t+r-l} ${n+e}`,s+=` L ${o} ${n+e}`,s+=` L ${t} ${n+e/2}`,s+=" Z",s}getPinPath(t,n,r,e){const o=Math.min(r,e)*.3,l=t+r/2,s=n+o,a=n+e;let c=`M ${l} ${a}`;return c+=` C ${l-o*.6} ${s+o*1.5} ${l-o} ${s+o*.5} ${l-o} ${s}`,c+=` A ${o} ${o} 0 1 1 ${l+o} ${s}`,c+=` C ${l+o} ${s+o*.5} ${l+o*.6} ${s+o*1.5} ${l} ${a}`,c+=" Z",c}getStampPath(t,n,r,e){const o=t+r/2,l=n+e/2,s=Math.min(r,e)/2,a=s*.85,c=16;let h="";for(let d=0;d<c;d++){const u=Math.PI*2*d/c,f=Math.PI*2*(d+.5)/c,g=Math.PI*2*(d+1)/c,p=o+Math.cos(u)*s,m=l+Math.sin(u)*s,y=o+Math.cos(f)*a,w=l+Math.sin(f)*a,v=o+Math.cos(g)*s,x=l+Math.sin(g)*s;d===0&&(h=`M ${p} ${m}`),h+=` Q ${y} ${w} ${v} ${x}`}return h+=" Z",h}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class T1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"kubernetes":{const u=a+h/2,f=c+d/2,g=Math.min(h,d)/2,p=g*.35,m=7;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(u,f,g,g,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(u,f,g,g,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.ellipse(u,f,p,p,0,0,Math.PI*2),e.stroke();for(let y=0;y<m;y++){const w=Math.PI*2*y/m-Math.PI/2;e.beginPath(),e.moveTo(u+Math.cos(w)*p,f+Math.sin(w)*p),e.lineTo(u+Math.cos(w)*g*.85,f+Math.sin(w)*g*.85),e.stroke();const v=g*.08;e.beginPath(),e.arc(u+Math.cos(w)*g*.85,f+Math.sin(w)*g*.85,v,0,Math.PI*2),e.stroke()}break}case"container":{const u=Math.min(h,d)*.06;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,c,h,d,u),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,c,h,d,u),e.stroke();const f=3;for(let g=1;g<=f;g++){const p=c+d*g/(f+1);e.beginPath(),e.moveTo(a+h*.08,p),e.lineTo(a+h*.92,p),e.stroke()}break}case"apiGateway":{const u=Math.min(h,d)*.08;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,c,h,d,u),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,c,h,d,u),e.stroke();const f=c+d/2,g=a+h*.2,p=a+h*.8,m=d*.12;e.beginPath(),e.moveTo(g,f),e.lineTo(p-h*.1,f),e.stroke(),e.beginPath(),e.moveTo(p,f),e.lineTo(p-h*.1,f-m),e.lineTo(p-h*.1,f+m),e.closePath(),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();break}case"cdn":{const u=a+h/2,f=c+d/2,g=h/2,p=d/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(u,f,g,p,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(u,f,g,p,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.ellipse(u,f,g*.4,p,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(a,f),e.lineTo(a+h,f),e.stroke(),e.beginPath(),e.ellipse(u,f-p*.45,g*.88,p*.15,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.ellipse(u,f+p*.45,g*.88,p*.15,0,0,Math.PI*2),e.stroke();break}case"storageBlob":{const u=d*.15,f=c+u/2,g=c+d-u/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(a+h/2,f,h/2,u,0,0,Math.PI*2),e.fill(),e.beginPath(),e.moveTo(a,f),e.lineTo(a,g),e.ellipse(a+h/2,g,h/2,u,0,Math.PI,0,!0),e.lineTo(a+h,f),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(a+h/2,f,h/2,u,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(a,f),e.lineTo(a,g),e.stroke(),e.beginPath(),e.moveTo(a+h,f),e.lineTo(a+h,g),e.stroke(),e.beginPath(),e.ellipse(a+h/2,g,h/2,u,0,0,Math.PI),e.stroke();break}case"eventBus":{const u=d*.25,f=c+(d-u)/2,g=u/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,f,h,u,g),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,f,h,u,g),e.stroke();const p=3;for(let m=0;m<p;m++){const y=a+h*(.25+m*.25);e.beginPath(),e.moveTo(y,c),e.lineTo(y,f),e.stroke(),e.beginPath(),e.moveTo(y,f+u),e.lineTo(y,c+d),e.stroke();const w=Math.min(h,d)*.03;e.beginPath(),e.arc(y,c,w,0,Math.PI*2),e.stroke(),e.beginPath(),e.arc(y,c+d,w,0,Math.PI*2),e.stroke()}break}case"microservice":{const u=a+h/2,f=c+d/2,g=this.getHexPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(g))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(g));const p=Math.min(h,d)*.15,m=6,y=p*.65;e.beginPath();for(let w=0;w<m;w++){const v=Math.PI*2*w/m,x=Math.PI*2*(w+.3)/m,k=Math.PI*2*(w+.5)/m,S=Math.PI*2*(w+.8)/m;w===0&&e.moveTo(u+Math.cos(v)*y,f+Math.sin(v)*y),e.lineTo(u+Math.cos(x)*p,f+Math.sin(x)*p),e.lineTo(u+Math.cos(k)*p,f+Math.sin(k)*p),e.lineTo(u+Math.cos(S)*y,f+Math.sin(S)*y);const M=Math.PI*2*(w+1)/m;e.lineTo(u+Math.cos(M)*y,f+Math.sin(M)*y)}e.closePath(),e.stroke();break}case"shield":{const u=this.getShieldPath(a,c,h,d);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(new Path2D(u))),A.applyStrokeStyle(e,o,l),e.stroke(new Path2D(u));const f=Math.min(h,d)*.2,g=a+h/2,p=c+d*.42;e.beginPath(),e.moveTo(g-f,p),e.lineTo(g-f*.3,p+f*.7),e.lineTo(g+f,p-f*.5),e.lineWidth=Math.max(2,Math.min(h,d)*.05),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"kubernetes":{const u=a+h/2,f=c+d/2,g=Math.min(h,d)/2,p=g*.35,m=7;e.circle(u,f,g*2,s),e.circle(u,f,p*2,{...s,fill:"none"});for(let y=0;y<m;y++){const w=Math.PI*2*y/m-Math.PI/2,v=u+Math.cos(w)*p,x=f+Math.sin(w)*p,k=u+Math.cos(w)*g*.85,S=f+Math.sin(w)*g*.85;e.line(v,x,k,S,{...s,fill:"none"}),e.circle(k,S,g*.16,{...s,fill:"none"})}break}case"container":{e.rectangle(a,c,h,d,s);const u=3;for(let f=1;f<=u;f++){const g=c+d*f/(u+1);e.line(a+h*.08,g,a+h*.92,g,{...s,fill:"none"})}break}case"apiGateway":{e.rectangle(a,c,h,d,s);const u=c+d/2,f=a+h*.2,g=a+h*.8,p=d*.12;e.line(f,u,g-h*.1,u,{...s,fill:"none"}),e.polygon([[g,u],[g-h*.1,u-p],[g-h*.1,u+p]],{...s});break}case"cdn":{const u=a+h/2,f=c+d/2,g=h/2,p=d/2;e.ellipse(u,f,g*2,p*2,s),e.ellipse(u,f,g*.8,p*2,{...s,fill:"none"}),e.line(a,f,a+h,f,{...s,fill:"none"});break}case"storageBlob":{const u=d*.15,f=c+u/2,g=c+d-u/2;e.ellipse(a+h/2,f,h,u*2,s),e.line(a,f,a,g,{...s,fill:"none"}),e.line(a+h,f,a+h,g,{...s,fill:"none"}),e.arc(a+h/2,g,h,u*2,0,Math.PI,!1,{...s,fill:"none"});break}case"eventBus":{const u=d*.25,f=c+(d-u)/2;e.rectangle(a,f,h,u,s);const g=3;for(let p=0;p<g;p++){const m=a+h*(.25+p*.25);e.line(m,c,m,f,{...s,fill:"none"}),e.line(m,f+u,m,c+d,{...s,fill:"none"});const y=Math.min(h,d)*.03;e.circle(m,c,y*2,{...s,fill:"none"}),e.circle(m,c+d,y*2,{...s,fill:"none"})}break}case"microservice":{e.path(this.getHexPath(a,c,h,d),s);const u=a+h/2,f=c+d/2,g=Math.min(h,d)*.15,p=g*.65,m=6;let y="";for(let w=0;w<m;w++){const v=Math.PI*2*w/m,x=Math.PI*2*(w+.3)/m,k=Math.PI*2*(w+.5)/m,S=Math.PI*2*(w+.8)/m,M=Math.PI*2*(w+1)/m;w===0&&(y=`M ${u+Math.cos(v)*p} ${f+Math.sin(v)*p}`),y+=` L ${u+Math.cos(x)*g} ${f+Math.sin(x)*g}`,y+=` L ${u+Math.cos(k)*g} ${f+Math.sin(k)*g}`,y+=` L ${u+Math.cos(S)*p} ${f+Math.sin(S)*p}`,y+=` L ${u+Math.cos(M)*p} ${f+Math.sin(M)*p}`}y+=" Z",e.path(y,{...s,fill:"none"});break}case"shield":{e.path(this.getShieldPath(a,c,h,d),s);const u=Math.min(h,d)*.2,f=a+h/2,g=c+d*.42;e.line(f-u,g,f-u*.3,g+u*.7,{...s,fill:"none"}),e.line(f-u*.3,g+u*.7,f+u,g-u*.5,{...s,fill:"none"});break}}A.renderText(t,n,r)}roundRect(t,n,r,e,o,l){t.beginPath(),t.moveTo(n+l,r),t.lineTo(n+e-l,r),t.quadraticCurveTo(n+e,r,n+e,r+l),t.lineTo(n+e,r+o-l),t.quadraticCurveTo(n+e,r+o,n+e-l,r+o),t.lineTo(n+l,r+o),t.quadraticCurveTo(n,r+o,n,r+o-l),t.lineTo(n,r+l),t.quadraticCurveTo(n,r,n+l,r),t.closePath()}getHexPath(t,n,r,e){const o=t+r/2,l=n+e/2,s=r/2,a=e/2;let c="";for(let h=0;h<6;h++){const d=Math.PI*2*h/6-Math.PI/6,u=o+Math.cos(d)*s,f=l+Math.sin(d)*a;h===0?c=`M ${u} ${f}`:c+=` L ${u} ${f}`}return c+" Z"}getShieldPath(t,n,r,e){const o=t+r/2,l=n,s=n+e*.55,a=n+e;let c=`M ${o} ${l}`;return c+=` L ${t+r} ${l}`,c+=` L ${t+r} ${s}`,c+=` Q ${t+r} ${a*.85+l*.15} ${o} ${a}`,c+=` Q ${t} ${a*.85+l*.15} ${t} ${s}`,c+=` L ${t} ${l}`,c+=" Z",c}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class L1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"barChart":{const f=h*.08,g=(h-f*5)/4,p=[.5,.8,.35,.65],m=c+d;if(s.fill&&s.fill!=="transparent"&&s.fill!=="none"){e.fillStyle=s.fill;for(let y=0;y<4;y++){const w=a+f+y*(g+f),v=d*.85*p[y];e.fillRect(w,m-v,g,v)}}A.applyStrokeStyle(e,o,l);for(let y=0;y<4;y++){const w=a+f+y*(g+f),v=d*.85*p[y];e.strokeRect(w,m-v,g,v)}e.beginPath(),e.moveTo(a+f*.5,c+d*.05),e.lineTo(a+f*.5,m),e.lineTo(a+h-f*.5,m),e.stroke();break}case"pieChart":{const u=a+h/2,f=c+d/2,g=Math.min(h,d)/2,p=[0,.3,.55,.8];s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.ellipse(u,f,g,g,0,0,Math.PI*2),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.ellipse(u,f,g,g,0,0,Math.PI*2),e.stroke();for(const m of p){const y=m*Math.PI*2-Math.PI/2;e.beginPath(),e.moveTo(u,f),e.lineTo(u+Math.cos(y)*g,f+Math.sin(y)*g),e.stroke()}break}case"trendUp":{const u=h*.08,f=c+d*.92,g=[{px:a+u,py:c+d*.75},{px:a+h*.3,py:c+d*.55},{px:a+h*.55,py:c+d*.45},{px:a+h*.8,py:c+d*.2}],p=Math.min(h,d)*.1,m=g[g.length-1],y=g[g.length-2],w=Math.atan2(m.py-y.py,m.px-y.px),v=m.px+Math.cos(w)*p,x=m.py+Math.sin(w)*p;if(s.fill&&s.fill!=="transparent"&&s.fill!=="none"){e.fillStyle=s.fill,e.beginPath(),e.moveTo(g[0].px,f);for(const M of g)e.lineTo(M.px,M.py);e.lineTo(m.px,f),e.closePath(),e.fill()}A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(g[0].px,g[0].py);for(let M=1;M<g.length;M++)e.lineTo(g[M].px,g[M].py);e.lineTo(v,x),e.stroke();const k=w+Math.PI*.82,S=w-Math.PI*.82;e.beginPath(),e.moveTo(v,x),e.lineTo(v+Math.cos(k)*p,x+Math.sin(k)*p),e.lineTo(v+Math.cos(S)*p,x+Math.sin(S)*p),e.closePath(),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();for(const M of g)e.beginPath(),e.arc(M.px,M.py,Math.min(h,d)*.025,0,Math.PI*2),e.fill();A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(a+u*.5,f),e.lineTo(a+h-u*.5,f),e.stroke();break}case"trendDown":{const u=h*.08,f=c+d*.92,g=[{px:a+u,py:c+d*.15},{px:a+h*.3,py:c+d*.35},{px:a+h*.55,py:c+d*.5},{px:a+h*.8,py:c+d*.7}],p=Math.min(h,d)*.1,m=g[g.length-1],y=g[g.length-2],w=Math.atan2(m.py-y.py,m.px-y.px),v=m.px+Math.cos(w)*p,x=m.py+Math.sin(w)*p;if(s.fill&&s.fill!=="transparent"&&s.fill!=="none"){e.fillStyle=s.fill,e.beginPath(),e.moveTo(g[0].px,f);for(const M of g)e.lineTo(M.px,M.py);e.lineTo(m.px,f),e.closePath(),e.fill()}A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(g[0].px,g[0].py);for(let M=1;M<g.length;M++)e.lineTo(g[M].px,g[M].py);e.lineTo(v,x),e.stroke();const k=w+Math.PI*.82,S=w-Math.PI*.82;e.beginPath(),e.moveTo(v,x),e.lineTo(v+Math.cos(k)*p,x+Math.sin(k)*p),e.lineTo(v+Math.cos(S)*p,x+Math.sin(S)*p),e.closePath(),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();for(const M of g)e.beginPath(),e.arc(M.px,M.py,Math.min(h,d)*.025,0,Math.PI*2),e.fill();A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(a+u*.5,f),e.lineTo(a+h-u*.5,f),e.stroke();break}case"funnel":{const u=a,f=a+h,g=a+h*.3,p=a+h*.7,m=c+d*.35,y=c+d*.65,w=a+h*.1,v=a+h*.9,x=a+h*.22,k=a+h*.78;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(u,c),e.lineTo(f,c),e.lineTo(p,c+d),e.lineTo(g,c+d),e.closePath(),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(u,c),e.lineTo(f,c),e.lineTo(p,c+d),e.lineTo(g,c+d),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(w,m),e.lineTo(v,m),e.stroke(),e.beginPath(),e.moveTo(x,y),e.lineTo(k,y),e.stroke();break}case"gauge":{const u=a+h/2,f=c+d*.85,g=Math.min(h/2,d*.8);s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.arc(u,f,g,Math.PI,0),e.closePath(),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.arc(u,f,g,Math.PI,0),e.stroke();const p=g*.75;e.beginPath(),e.arc(u,f,p,Math.PI,0),e.stroke();for(let v=0;v<=5;v++){const x=Math.PI+Math.PI*v/5;e.beginPath(),e.moveTo(u+Math.cos(x)*p,f+Math.sin(x)*p),e.lineTo(u+Math.cos(x)*g,f+Math.sin(x)*g),e.stroke()}const m=Math.PI+Math.PI*.7,y=g*.65;e.beginPath(),e.moveTo(u,f),e.lineTo(u+Math.cos(m)*y,f+Math.sin(m)*y),e.lineWidth=Math.max(2,Math.min(h,d)*.03),e.stroke();const w=Math.min(h,d)*.04;e.beginPath(),e.arc(u,f,w,0,Math.PI*2),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();break}case"table":{const g=d*.28,p=(d-g)/3;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fillRect(a,c,h,g)),A.applyStrokeStyle(e,o,l),e.strokeRect(a,c,h,d),e.beginPath(),e.moveTo(a,c+g),e.lineTo(a+h,c+g),e.stroke();for(let y=1;y<3;y++){const w=c+g+p*y;e.beginPath(),e.moveTo(a,w),e.lineTo(a+h,w),e.stroke()}const m=h/3;for(let y=1;y<3;y++){const w=a+m*y;e.beginPath(),e.moveTo(w,c),e.lineTo(w,c+d),e.stroke()}break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"barChart":{const f=h*.08,g=(h-f*5)/4,p=[.5,.8,.35,.65],m=c+d;for(let y=0;y<4;y++){const w=a+f+y*(g+f),v=d*.85*p[y];e.rectangle(w,m-v,g,v,s)}e.line(a+f*.5,c+d*.05,a+f*.5,m,{...s,fill:"none"}),e.line(a+f*.5,m,a+h-f*.5,m,{...s,fill:"none"});break}case"pieChart":{const u=a+h/2,f=c+d/2,g=Math.min(h,d)/2;e.circle(u,f,g*2,s);const p=[0,.3,.55,.8];for(const m of p){const y=m*Math.PI*2-Math.PI/2;e.line(u,f,u+Math.cos(y)*g,f+Math.sin(y)*g,{...s,fill:"none"})}break}case"trendUp":{const u=h*.08,f=c+d*.92,g=[[a+u,c+d*.75],[a+h*.3,c+d*.55],[a+h*.55,c+d*.45],[a+h*.8,c+d*.2]],p=Math.min(h,d)*.1,m=g[g.length-1],y=g[g.length-2],w=Math.atan2(m[1]-y[1],m[0]-y[0]),v=m[0]+Math.cos(w)*p,x=m[1]+Math.sin(w)*p;e.linearPath([...g,[v,x]],{...s,fill:"none"});const k=w+Math.PI*.82,S=w-Math.PI*.82;e.polygon([[v,x],[v+Math.cos(k)*p,x+Math.sin(k)*p],[v+Math.cos(S)*p,x+Math.sin(S)*p]],s);const M=Math.min(h,d)*.025;for(const C of g)e.circle(C[0],C[1],M*2,s);e.line(a+u*.5,f,a+h-u*.5,f,{...s,fill:"none"});break}case"trendDown":{const u=h*.08,f=c+d*.92,g=[[a+u,c+d*.15],[a+h*.3,c+d*.35],[a+h*.55,c+d*.5],[a+h*.8,c+d*.7]],p=Math.min(h,d)*.1,m=g[g.length-1],y=g[g.length-2],w=Math.atan2(m[1]-y[1],m[0]-y[0]),v=m[0]+Math.cos(w)*p,x=m[1]+Math.sin(w)*p;e.linearPath([...g,[v,x]],{...s,fill:"none"});const k=w+Math.PI*.82,S=w-Math.PI*.82;e.polygon([[v,x],[v+Math.cos(k)*p,x+Math.sin(k)*p],[v+Math.cos(S)*p,x+Math.sin(S)*p]],s);const M=Math.min(h,d)*.025;for(const C of g)e.circle(C[0],C[1],M*2,s);e.line(a+u*.5,f,a+h-u*.5,f,{...s,fill:"none"});break}case"funnel":{const u=a,f=a+h,g=a+h*.3,p=a+h*.7;e.polygon([[u,c],[f,c],[p,c+d],[g,c+d]],s);const m=c+d*.35,y=a+h*.1,w=a+h*.9,v=c+d*.65,x=a+h*.22,k=a+h*.78;e.line(y,m,w,m,{...s,fill:"none"}),e.line(x,v,k,v,{...s,fill:"none"});break}case"gauge":{const u=a+h/2,f=c+d*.85,g=Math.min(h/2,d*.8),p=g*.75;e.arc(u,f,g*2,g*2,Math.PI,0,!1,s),e.arc(u,f,p*2,p*2,Math.PI,0,!1,{...s,fill:"none"});for(let v=0;v<=5;v++){const x=Math.PI+Math.PI*v/5;e.line(u+Math.cos(x)*p,f+Math.sin(x)*p,u+Math.cos(x)*g,f+Math.sin(x)*g,{...s,fill:"none"})}const m=Math.PI+Math.PI*.7,y=g*.65;e.line(u,f,u+Math.cos(m)*y,f+Math.sin(m)*y,{...s,fill:"none",strokeWidth:Math.max(2,Math.min(h,d)*.03)});const w=Math.min(h,d)*.04;e.circle(u,f,w*2,{...s});break}case"table":{const g=d*.28,p=(d-g)/3;e.rectangle(a,c,h,g,s),e.rectangle(a,c+g,h,d-g,{...s,fill:"none"});for(let y=1;y<3;y++){const w=c+g+p*y;e.line(a,w,a+h,w,{...s,fill:"none"})}const m=h/3;for(let y=1;y<3;y++){const w=a+m*y;e.line(w,c,w,c+d,{...s,fill:"none"})}break}}A.renderText(t,n,r)}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}class I1 extends bt{renderArchitectural(t,n,r){const{ctx:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"puzzlePiece":{const u=h*.15,f=d*.15,g=new Path2D;g.moveTo(a,c),g.lineTo(a+h*.35,c),g.lineTo(a+h*.35,c-f),g.arc(a+h*.5,c-f,h*.15,Math.PI,0),g.lineTo(a+h*.65,c),g.lineTo(a+h,c),g.lineTo(a+h,c+d*.35),g.lineTo(a+h+u,c+d*.35),g.arc(a+h+u,c+d*.5,d*.15,-Math.PI/2,Math.PI/2),g.lineTo(a+h,c+d*.65),g.lineTo(a+h,c+d),g.lineTo(a,c+d),g.lineTo(a,c),g.closePath(),s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fill(g)),A.applyStrokeStyle(e,o,l),e.stroke(g);break}case"chainLink":{const u=h*.55,f=d*.4,g=f/2;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,this.roundRect(e,a,c+d*.1,u,f,g),e.fill(),this.roundRect(e,a+h-u,c+d*.5,u,f,g),e.fill()),A.applyStrokeStyle(e,o,l),this.roundRect(e,a,c+d*.1,u,f,g),e.stroke(),this.roundRect(e,a+h-u,c+d*.5,u,f,g),e.stroke();break}case"bridge":{const u=c+d*.4,f=d*.12;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(a,u),e.quadraticCurveTo(a+h/2,c,a+h,u),e.lineTo(a+h,u+f),e.quadraticCurveTo(a+h/2,c+f,a,u+f),e.closePath(),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(a,u),e.quadraticCurveTo(a+h/2,c,a+h,u),e.stroke(),e.beginPath(),e.moveTo(a,u+f),e.lineTo(a+h,u+f),e.stroke();const g=3;for(let p=0;p<g;p++){const m=a+h*(.2+p*.3);e.beginPath(),e.moveTo(m,u+f),e.lineTo(m,c+d),e.stroke()}e.beginPath(),e.moveTo(a,c+d),e.lineTo(a+h,c+d),e.stroke();break}case"magnet":{const u=h*.28,f=h-u*2,g=d*.35,p=d-g;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(a,c),e.lineTo(a+u,c),e.lineTo(a+u,c+p),e.arc(a+h/2,c+p,f/2,Math.PI,0,!0),e.lineTo(a+h-u,c),e.lineTo(a+h,c),e.lineTo(a+h,c+p),e.arc(a+h/2,c+p,h/2,0,Math.PI),e.lineTo(a,c),e.closePath(),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(a,c),e.lineTo(a,c+p),e.arc(a+h/2,c+p,h/2,Math.PI,0),e.lineTo(a+h,c),e.stroke(),e.beginPath(),e.moveTo(a+u,c),e.lineTo(a+u,c+p),e.arc(a+h/2,c+p,f/2,Math.PI,0,!0),e.lineTo(a+h-u,c),e.stroke(),e.beginPath(),e.moveTo(a,c),e.lineTo(a+u,c),e.stroke(),e.beginPath(),e.moveTo(a+h-u,c),e.lineTo(a+h,c),e.stroke();const m=c+g*.5;e.beginPath(),e.moveTo(a,m),e.lineTo(a+u,m),e.stroke(),e.beginPath(),e.moveTo(a+h-u,m),e.lineTo(a+h,m),e.stroke();break}case"scale":{const u=h*.3,f=d*.08,g=a+h/2,p=c+d*.15,m=h*.18;A.applyStrokeStyle(e,o,l),s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.fillRect(g-u/2,c+d-f,u,f)),e.strokeRect(g-u/2,c+d-f,u,f),e.beginPath(),e.moveTo(g,c+d-f),e.lineTo(g,p),e.stroke(),e.beginPath(),e.moveTo(a+h*.08,p),e.lineTo(a+h*.92,p),e.stroke();const y=a+h*.08,w=c+d*.55;e.beginPath(),e.moveTo(y,p),e.lineTo(y-m*.3,w),e.stroke(),e.beginPath(),e.moveTo(y,p),e.lineTo(y+m*.3,w),e.stroke(),e.beginPath(),e.arc(y,w+m*.15,m,Math.PI,0),e.stroke();const v=a+h*.92;e.beginPath(),e.moveTo(v,p),e.lineTo(v-m*.3,w),e.stroke(),e.beginPath(),e.moveTo(v,p),e.lineTo(v+m*.3,w),e.stroke(),e.beginPath(),e.arc(v,w+m*.15,m,Math.PI,0),e.stroke(),e.beginPath(),e.moveTo(g-h*.04,p),e.lineTo(g+h*.04,p),e.lineTo(g,p-d*.06),e.closePath(),e.fillStyle=A.adjustColor(o.strokeColor||"#000000",l),e.fill();break}case"seedling":{const u=a+h/2,f=c+d*.75,g=c+d*.25,p=h*.3,m=d*.25;A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(u,f),e.quadraticCurveTo(u-h*.05,(f+g)/2,u,g),e.stroke(),s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(u,g+m*.5),e.quadraticCurveTo(u-p,g-m*.5,u-p*.3,g-m*.3),e.quadraticCurveTo(u-p*.1,g,u,g+m*.5),e.fill()),e.beginPath(),e.moveTo(u,g+m*.5),e.quadraticCurveTo(u-p,g-m*.5,u-p*.3,g-m*.3),e.quadraticCurveTo(u-p*.1,g,u,g+m*.5),e.stroke(),s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(u,g),e.quadraticCurveTo(u+p,g-m,u+p*.4,g-m*.8),e.quadraticCurveTo(u+p*.1,g-m*.3,u,g),e.fill()),e.beginPath(),e.moveTo(u,g),e.quadraticCurveTo(u+p,g-m,u+p*.4,g-m*.8),e.quadraticCurveTo(u+p*.1,g-m*.3,u,g),e.stroke(),e.beginPath(),e.arc(u,f,h*.25,Math.PI,0),e.stroke();break}case"tree":{const u=h*.18,f=Math.min(h,d*.55)*.48,g=c+d*.38,p=g+f*.5;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.arc(a+h/2,g,f,0,Math.PI*2),e.fill(),e.fillRect(a+h/2-u/2,p,u,c+d-p)),A.applyStrokeStyle(e,o,l),e.beginPath(),e.arc(a+h/2,g,f,0,Math.PI*2),e.stroke(),e.strokeRect(a+h/2-u/2,p,u,c+d-p);break}case"mountain":{const u=a+h*.45,f=c,g=a,p=a+h,m=c+d*.22;s.fill&&s.fill!=="transparent"&&s.fill!=="none"&&(e.fillStyle=s.fill,e.beginPath(),e.moveTo(u,f),e.lineTo(p,c+d),e.lineTo(g,c+d),e.closePath(),e.fill()),A.applyStrokeStyle(e,o,l),e.beginPath(),e.moveTo(u,f),e.lineTo(p,c+d),e.lineTo(g,c+d),e.closePath(),e.stroke();const y=u-h*.12,w=u+h*.14;e.beginPath(),e.moveTo(u,f),e.lineTo(w,m),e.lineTo(w-h*.05,m-d*.03),e.lineTo(w-h*.1,m+d*.02),e.lineTo(y+h*.05,m-d*.01),e.lineTo(y,m),e.closePath(),e.fillStyle="#ffffff",e.fill(),e.stroke();break}}A.renderText(t,n,r)}renderSketch(t,n,r){const{rc:e,element:o,isDarkMode:l}=t,s=A.buildRenderOptions(o,l),a=o.x,c=o.y,h=o.width,d=o.height;switch(o.type){case"puzzlePiece":{const u=this.getPuzzlePath(a,c,h,d);e.path(u,s);break}case"chainLink":{const u=h*.55,f=d*.4,g=f/2;e.rectangle(a,c+d*.1,u,f,{...s,borderRadius:g}),e.rectangle(a+h-u,c+d*.5,u,f,{...s,borderRadius:g});break}case"bridge":{const u=c+d*.4,f=d*.12,g=`M ${a} ${u} Q ${a+h/2} ${c} ${a+h} ${u}`;e.path(g,{...s,fill:"none"}),e.line(a,u+f,a+h,u+f,{...s,fill:"none"});for(let p=0;p<3;p++){const m=a+h*(.2+p*.3);e.line(m,u+f,m,c+d,{...s,fill:"none"})}e.line(a,c+d,a+h,c+d,{...s,fill:"none"});break}case"magnet":{const u=this.getMagnetPath(a,c,h,d);e.path(u,s);const f=h*.28,g=d*.35,p=c+g*.5;e.line(a,p,a+f,p,{...s,fill:"none"}),e.line(a+h-f,p,a+h,p,{...s,fill:"none"});break}case"scale":{const u=h*.3,f=d*.08,g=a+h/2,p=c+d*.15,m=h*.18,y=c+d*.55;e.rectangle(g-u/2,c+d-f,u,f,s),e.line(g,c+d-f,g,p,{...s,fill:"none"}),e.line(a+h*.08,p,a+h*.92,p,{...s,fill:"none"});const w=a+h*.08;e.line(w,p,w-m*.3,y,{...s,fill:"none"}),e.line(w,p,w+m*.3,y,{...s,fill:"none"}),e.arc(w,y+m*.15,m*2,m*2,Math.PI,0,!1,{...s,fill:"none"});const v=a+h*.92;e.line(v,p,v-m*.3,y,{...s,fill:"none"}),e.line(v,p,v+m*.3,y,{...s,fill:"none"}),e.arc(v,y+m*.15,m*2,m*2,Math.PI,0,!1,{...s,fill:"none"});break}case"seedling":{const u=a+h/2,f=c+d*.75,g=c+d*.25,p=h*.3,m=d*.25;e.path(`M ${u} ${f} Q ${u-h*.05} ${(f+g)/2} ${u} ${g}`,{...s,fill:"none"}),e.path(`M ${u} ${g+m*.5} Q ${u-p} ${g-m*.5} ${u-p*.3} ${g-m*.3} Q ${u-p*.1} ${g} ${u} ${g+m*.5}`,s),e.path(`M ${u} ${g} Q ${u+p} ${g-m} ${u+p*.4} ${g-m*.8} Q ${u+p*.1} ${g-m*.3} ${u} ${g}`,s),e.arc(u,f,h*.5,h*.5,Math.PI,0,!1,{...s,fill:"none"});break}case"tree":{const u=h*.18,f=Math.min(h,d*.55)*.48,g=c+d*.38,p=g+f*.5;e.circle(a+h/2,g,f*2,s),e.rectangle(a+h/2-u/2,p,u,c+d-p,{...s,fill:s.fill});break}case"mountain":{const u=a+h*.45;e.polygon([[u,c],[a+h,c+d],[a,c+d]],s);const f=c+d*.22,g=u-h*.12,p=u+h*.14;e.polygon([[u,c],[p,f],[p-h*.05,f-d*.03],[p-h*.1,f+d*.02],[g+h*.05,f-d*.01],[g,f]],{...s,fill:"#ffffff"});break}}A.renderText(t,n,r)}roundRect(t,n,r,e,o,l){t.beginPath(),t.moveTo(n+l,r),t.lineTo(n+e-l,r),t.quadraticCurveTo(n+e,r,n+e,r+l),t.lineTo(n+e,r+o-l),t.quadraticCurveTo(n+e,r+o,n+e-l,r+o),t.lineTo(n+l,r+o),t.quadraticCurveTo(n,r+o,n,r+o-l),t.lineTo(n,r+l),t.quadraticCurveTo(n,r,n+l,r),t.closePath()}getPuzzlePath(t,n,r,e){const o=r*.15,l=e*.15;let s=`M ${t} ${n}`;return s+=` L ${t+r*.35} ${n}`,s+=` A ${l} ${l} 0 0 1 ${t+r*.65} ${n}`,s+=` L ${t+r} ${n}`,s+=` L ${t+r} ${n+e*.35}`,s+=` A ${o} ${o} 0 0 1 ${t+r} ${n+e*.65}`,s+=` L ${t+r} ${n+e}`,s+=` L ${t} ${n+e}`,s+=" Z",s}getMagnetPath(t,n,r,e){const o=r*.28,l=e-e*.35,s=(r-o*2)/2,a=r/2;let c=`M ${t} ${n}`;return c+=` L ${t} ${n+l}`,c+=` A ${a} ${a} 0 0 0 ${t+r} ${n+l}`,c+=` L ${t+r} ${n}`,c+=` L ${t+r-o} ${n}`,c+=` L ${t+r-o} ${n+l}`,c+=` A ${s} ${s} 0 0 1 ${t+o} ${n+l}`,c+=` L ${t+o} ${n}`,c+=" Z",c}definePath(t,n){const r=Ft(n);r&&(t.translate(n.x+n.width/2,n.y+n.height/2),A.renderGeometry(t,r))}}function $1(){console.log("Registering all shapes including specialty..."),dt.register("rectangle",new l1),dt.register("circle",new c1),dt.register("diamond",new h1),dt.register("text",new d1),dt.register("image",new u1),dt.register("stickyNote",new f1);const i=new p1;["triangle","hexagon","octagon","parallelogram","trapezoid","rightTriangle","pentagon","septagon","polygon"].forEach(X=>dt.register(X,i));const n=new g1;["database","document","predefinedProcess","internalStorage"].forEach(X=>dt.register(X,n));const e=new y1;["starPerson","lightbulb","signpost","burstBlob","scroll","wavyDivider","doubleBanner","trophy","clock","gear","target","rocket","flag","key","magnifyingGlass","book","megaphone","eye","thoughtBubble"].forEach(X=>dt.register(X,e));const l=new m1;["server","loadBalancer","firewall","user","messageQueue","lambda","router"].forEach(X=>dt.register(X,l));const a=new b1;["browserWindow","mobilePhone"].forEach(X=>dt.register(X,a));const h=new w1;["organicBranch"].forEach(X=>dt.register(X,h));const u=new v1;["browser","ghostButton","inputField"].forEach(X=>dt.register(X,u));const g=new x1;dt.register("line",g),dt.register("arrow",g),dt.register("bezier",g);const p=new k1;["fineliner","inkbrush","marker","ink"].forEach(X=>dt.register(X,p));const y=new S1;["cloud","heart","star","burst","callout","speechBubble","ribbon","bracketLeft","bracketRight","cross","checkmark","capsule","arrowLeft","arrowRight","arrowUp","arrowDown","dfdProcess","dfdDataStore","isometricCube","solidBlock","cylinder","stateStart","stateEnd","stateSync","activationBar","externalEntity","perspectiveBlock","umlSignalSend","umlSignalReceive","umlProvidedInterface","umlRequiredInterface"].forEach(X=>dt.register(X,y));const v=new M1;dt.register("umlClass",v);const x=new C1;dt.register("umlState",x);const k=new P1;["umlInterface","umlActor","umlUseCase","umlNote","umlPackage","umlComponent","umlLifeline","umlFragment"].forEach(X=>dt.register(X,k));const M=new _1;["stickFigure","sittingPerson","presentingPerson","handPointRight","thumbsUp","faceHappy","faceSad","faceConfused"].forEach(X=>dt.register(X,M));const R=new A1;["checkbox","checkboxChecked","numberedBadge","questionMark","exclamationMark","tag","pin","stamp"].forEach(X=>dt.register(X,R));const O=new T1;["kubernetes","container","apiGateway","cdn","storageBlob","eventBus","microservice","shield"].forEach(X=>dt.register(X,O));const F=new L1;["barChart","pieChart","trendUp","trendDown","funnel","gauge","table"].forEach(X=>dt.register(X,F));const J=new I1;["puzzlePiece","chainLink","bridge","magnet","scale","seedling","tree","mountain"].forEach(X=>dt.register(X,J))}const R1="1.3.0",E1={version:R1};var N1=$('<button class=floating-settings-btn title="Toggle Properties (Alt+Enter)"style="position:fixed;bottom:5px;left:230px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease">'),O1=$('<button class=floating-settings-btn title="Shortcuts &amp; Help (?)"style="position:fixed;bottom:5px;left:290px;width:48px;height:48px;border-radius:50%;border:none;background:#ffffff;color:#4b5563;box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:1000;transition:all 0.2s ease;font-weight:bold;font-size:20px">?'),B1=$('<div style="position:fixed;bottom:8px;left:50%;transform:translateX(-50%);font-size:11px;color:var(--text-secondary, #6b7280);pointer-events:none;user-select:none;z-index:999;opacity:0.9">v'),D1=$("<div>");const z1=_t(()=>Ct(()=>import("./property-panel-CLPyb107.js"),__vite__mapDeps([16,1,2,3,17]),import.meta.url)),F1=_t(()=>Ct(()=>import("./layer-panel-lGN8R735.js"),__vite__mapDeps([18,1,2,3,19]),import.meta.url)),W1=_t(()=>Ct(()=>import("./command-palette-CO3X5UB7.js"),__vite__mapDeps([20,1,2,3,21]),import.meta.url)),j1=_t(()=>Ct(()=>import("./state-panel-DM7THTuo.js"),__vite__mapDeps([22,1,2,3,23]),import.meta.url).then(i=>({default:i.StatePanel}))),U1=_t(()=>Ct(()=>Promise.resolve().then(()=>Ac),void 0,import.meta.url)),q1=_t(()=>Ct(()=>import("./mindmap-action-toolbar-ziq6nTYP.js"),__vite__mapDeps([24,1,2,3,25]),import.meta.url).then(i=>({default:i.MindmapActionToolbar}))),H1=_t(()=>Ct(()=>import("./slide-navigator-DOT44yqr.js"),__vite__mapDeps([26,1,2,3,27]),import.meta.url).then(i=>({default:i.SlideNavigator}))),Y1=_t(()=>Ct(()=>import("./slide-control-toolbar-BwhnLEsy.js"),__vite__mapDeps([28,1,2,3]),import.meta.url).then(i=>({default:i.SlideControlToolbar}))),X1=_t(()=>Ct(()=>import("./presentation-controls-B6gxVAKE.js"),__vite__mapDeps([29,1,2,3]),import.meta.url).then(i=>({default:i.PresentationControls}))),G1=()=>(ye(()=>{console.log("App: Registering shapes..."),$1(),a1();const i=async r=>{if(Xa()||Ga()||Qa()||Za()||b.showExportDialog)return;if(r.key==="F5"){r.preventDefault(),Rn(!0);return}if(r.key==="Escape"&&b.appMode==="presentation"){r.preventDefault(),Rn(!1);return}const e=r.code,o=r.key.toLowerCase(),l=r.ctrlKey||r.metaKey;if(l){if(o==="s"&&r.altKey){r.preventDefault();return}else if(o==="k"){r.preventDefault(),Ca(!0);return}else if(o==="o"&&r.altKey){r.preventDefault(),Bn(!0);return}else if(o==="e"&&r.shiftKey){r.preventDefault(),$n(!0);return}}const s=r.target;if(!(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable)){if(l){if(o==="z"){r.preventDefault(),r.shiftKey?jn():sr();return}else if(o==="y"){r.preventDefault(),jn();return}else if(o==="a"){r.preventDefault(),P("selection",b.elements.map(c=>c.id));return}}if(r.altKey&&!r.ctrlKey&&!r.metaKey)if(e==="Enter"||o==="enter")r.preventDefault(),_e();else if(e==="KeyL"||o==="l")r.preventDefault(),qn();else if(e==="KeyM"||o==="m")r.preventDefault(),ai();else if(e==="KeyZ"||o==="z"){r.preventDefault();const c=!b.zenMode;xr(c),kr(!c)}else if(e==="KeyI"||o==="i")r.preventDefault(),Z("ink");else if(o==="\\"||e==="Backslash"){r.preventDefault();const c=b.showPropertyPanel||b.showLayerPanel;_e(!c),qn(!c)}else if(o==="["||e==="BracketLeft"){r.preventDefault();const h=b.layers.findIndex(d=>d.id===b.activeLayerId);h>0&&$i(h,h-1)}else if(o==="]"||e==="BracketRight"){r.preventDefault();const c=b.layers,h=c.findIndex(d=>d.id===b.activeLayerId);h!==-1&&h<c.length-1&&$i(h,h+1)}else if(o==="n"||e==="KeyN")r.preventDefault(),Gi();else if(o>="1"&&o<="9"){r.preventDefault();const c=parseInt(o)-1;yh(c)}else e==="ArrowRight"?(r.preventDefault(),ur()):e==="ArrowLeft"&&(r.preventDefault(),fr());if(r.ctrlKey||r.metaKey){if(o==="g")r.preventDefault(),r.shiftKey?gr():pr();else if(o==="m")r.preventDefault(),ya();else if(o==="c"||e==="KeyC")r.preventDefault(),r.altKey?Ar():await li();else if(o==="v"||e==="KeyV")r.preventDefault(),r.altKey?Tr():await Gn();else if(o==="x"||e==="KeyX")r.preventDefault(),await _r();else if(o==="]")r.preventDefault(),b.selection.length>0&&cr(b.selection);else if(o==="[")r.preventDefault(),b.selection.length>0&&hr(b.selection);else if(o==="d"){r.preventDefault();const c=b.elements.filter(h=>b.selection.includes(h.id));if(c.length>0){const h=new Map;c.forEach(f=>{f.groupIds?.forEach(g=>{h.has(g)||h.set(g,crypto.randomUUID())})});const d=20,u=c.map(f=>({...f,id:crypto.randomUUID(),x:f.x+d,y:f.y+d,groupIds:f.groupIds?.map(g=>h.get(g))}));P("elements",[...b.elements,...u]),P("selection",u.map(f=>f.id))}}return}if(!r.altKey&&!r.ctrlKey&&!r.metaKey){if(b.appMode==="presentation"){if(e==="PageDown"||e==="Enter"||e==="NumpadEnter"||e==="Space"||e==="ArrowRight"){r.preventDefault(),dr();return}else if(e==="ArrowLeft"||e==="PageUp"||e==="Backspace"){r.preventDefault(),ga();return}}if(e==="Home"){r.preventDefault(),b.states.length>0?si(b.states[0].id):Gt(0);return}if(o==="s")r.preventDefault(),Wh();else if(o==="f")r.preventDefault(),jh();else if(o==="?"&&r.shiftKey)r.preventDefault(),Yi(!0);else if(o==='"'||o==="'"&&r.shiftKey)r.preventDefault(),wr();else if(o===":"||o===";"&&r.shiftKey)r.preventDefault(),vr();else if(o==="delete"||o==="backspace")r.preventDefault(),b.selection.length>0&&oe(b.selection);else if(["arrowup","arrowdown","arrowleft","arrowright"].includes(o)){if(b.selection.length>0){r.preventDefault();const c=r.shiftKey?10:1;let h=0,d=0;o==="arrowup"?d=-c:o==="arrowdown"?d=c:o==="arrowleft"?h=-c:o==="arrowright"&&(h=c),pa(h,d,!0)}}else o==="tab"?b.selection.length===1&&(r.preventDefault(),ar(b.selection[0])):o==="enter"?b.selection.length===1&&(r.preventDefault(),lr(b.selection[0])):o===" "?b.selection.length>0&&(r.preventDefault(),ua()):r.shiftKey&&o==="n"?(r.preventDefault(),ka()):r.shiftKey&&o==="p"?(r.preventDefault(),Z("laser")):o==="v"||o==="1"?Z("selection"):o==="r"||o==="2"?Z("rectangle"):o==="o"||o==="3"?Z("circle"):o==="l"||o==="4"?Z("line"):o==="a"||o==="5"?Z("arrow"):o==="t"||o==="6"?Z("text"):o==="e"||o==="7"?Z("eraser"):o==="p"||o==="8"?Z("fineliner"):o==="9"||o==="i"?window.triggerImageUpload?.():o==="b"||o==="0"?Z("bezier"):o==="d"?Z("diamond"):o==="h"&&Z("pan")}}},t=()=>{!document.fullscreenElement&&b.appMode==="presentation"&&Rn(!1)},n=r=>{};window.addEventListener("keydown",i,!0),window.addEventListener("beforeunload",n),document.addEventListener("fullscreenchange",t),mt(()=>{window.removeEventListener("keydown",i,!0),window.removeEventListener("beforeunload",n),document.removeEventListener("fullscreenchange",t)})}),(()=>{var i=D1();return I(i,_(bo,{fallback:null,get children(){return[_(q,{get when(){return b.appMode!=="presentation"},get children(){return[_(q,{get when(){return b.showMainToolbar},get children(){return _(Jg,{})}}),_(q,{get when(){return!b.zenMode},get children(){return[_(z1,{}),_(F1,{}),_(i1,{})]}}),_(e1,{})]}}),_(kf,{}),_(q,{get when(){return b.docType==="slides"},get children(){return _(q,{get when(){return $e(()=>b.appMode!=="presentation"&&!b.zenMode)()&&b.showSlideNavigator},get fallback(){return _(q,{get when(){return b.appMode==="presentation"},get children(){return _(X1,{})}})},get children(){return _(H1,{})}})}}),_(q,{get when(){return b.appMode!=="presentation"},get children(){return[_(W1,{}),_(j1,{}),_(yy,{})]}}),_(q,{get when(){return b.appMode!=="presentation"},get children(){return[(()=>{var t=N1();return t.$$click=()=>_e(),I(t,_(bc,{size:24})),N(()=>t.classList.toggle("active",!!b.showPropertyPanel)),t})(),(()=>{var t=O1();return t.$$click=()=>Yi(!0),t})(),_(Y1,{}),_(q1,{})]}}),_(U1,{}),(()=>{var t=B1();return t.firstChild,I(t,()=>E1.version,null),t})()]}})),i})());ht(["click"]);const V1=document.getElementById("root");wc(()=>_(G1,{}),V1);export{pr as $,o2 as A,Sh as B,e2 as C,ch as D,lh as E,ce as F,ne as G,bi as H,gh as I,ph as J,wh as K,vh as L,mh as M,bh as N,fh as O,Ia as P,a2 as Q,Oh as R,ka as S,qn as T,Bh as U,$i as V,mr as W,l2 as X,Z as Y,sr as Z,jn as _,B as a,gr as a0,cr as a1,hr as a2,wr as a3,vr as a4,xr as a5,ai as a6,yr as a7,xa as a8,P as a9,Gu as aA,Vu as aB,h2 as aC,d2 as aD,pf as aE,ba as aa,Ca as ab,ma as ac,si as ad,dh as ae,uh as af,hh as ag,Oc as ah,ha as ai,Ny as aj,Gt as ak,sh as al,oh as am,ya as an,n2 as ao,ah as ap,Rn as aq,Sa as ar,Nh as as,Zc as at,hn as au,ga as av,dr as aw,$o as ax,my as ay,lo as az,Wn as b,ih as c,Hr as d,va as e,c2 as f,nt as g,xh as h,Ii as i,oe as j,Fh as k,Uh as l,s2 as m,ar as n,lr as o,Ta as p,Sr as q,t2 as r,b as s,_e as t,D as u,Se as v,Q as w,kh as x,i2 as y,r2 as z};
